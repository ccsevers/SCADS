<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>mesos/MesosEC2.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> deploylib
<span class="keyword">package</span> mesos

<span class="keyword">import</span> ec2._
<span class="keyword">import</span> config._

<span class="keyword">import</span> edu.berkeley.cs.scads.comm._

<span class="keyword">import</span> java.io.File
<span class="keyword">import</span> collection.<span title="object scala.collection.JavaConversions">JavaConversions</span>._
<span class="keyword">import</span> net.lag.logging.Logger
<span class="keyword">object</span> <a title="object deploylib.mesos.ServiceSchedulerDaemon" id="9635">ServiceSchedulerDaemon</a> <span title="ScalaObject" class="keyword">extends</span> optional.<span title="optional.Application">Application</span> <span class="delimiter">{</span>
  <span class="keyword">val</span> <a title="java.lang.String" id="68102">javaExecutorPath</a> = <span title="java.lang.String(&quot;/usr/local/mesos/frameworks/deploylib/java_executor&quot;)" class="string">&quot;/usr/local/mesos/frameworks/deploylib/java_executor&quot;</span>

  <span class="keyword">def</span> <a title="(mesosMaster: String, zooKeeperAddress: String)Unit" id="68104">main</a><span class="delimiter">(</span><a title="String" id="68106">mesosMaster</a>: <span title="String">String</span>, <a title="String" id="68107">zooKeeperAddress</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="object java.lang.System">System</span>.<span title="(x$1: java.lang.String)Unit">loadLibrary</span><span class="delimiter">(</span><span title="java.lang.String(&quot;mesos&quot;)" class="string">&quot;mesos&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="deploylib.mesos.ServiceScheduler" id="68109">scheduler</a> = <span title="deploylib.mesos.ServiceScheduler" class="keyword">new</span> <a href="ExperimentDaemon.scala.html#9596" title="deploylib.mesos.ServiceScheduler">ServiceScheduler</a><span class="delimiter">(</span>
      <a href="#68106" title="String">mesosMaster</a>,
      <a href="#68102" title="=&gt; java.lang.String">javaExecutorPath</a>
    <span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode" id="68110">serviceSchedulerNode</a> = <span title="(uri: String)edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">ZooKeeperNode</span><span class="delimiter">(</span><a href="#68107" title="String">zooKeeperAddress</a><span class="delimiter">)</span>
    <a href="#68110" title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">serviceSchedulerNode</a>.<span title="(d: Array[Byte])Unit">data</span> = <a href="#68109" title="deploylib.mesos.ServiceScheduler">scheduler</a>.<span title="=&gt; edu.berkeley.cs.scads.comm.RemoteActor">remoteHandle</span>.<span title="=&gt; Array[Byte]">toBytes</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Global state for setting and methods for running mesos on EC2.
 */</span>
<span class="keyword">object</span> <a title="object deploylib.mesos.MesosCluster" id="9637">MesosCluster</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="68477">logger</a> = <span title="()net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">//HACK</span>
  <span class="keyword">var</span> <a title="Seq[java.io.File]" id="68480">jarFiles</a>: <span title="Seq[java.io.File]">Seq</span><span class="delimiter">[</span>java.io.File<span class="delimiter">]</span> = _

  <span class="comment">/**
   * Start a new plain ubuntu ami, install java/mesos on it, bundle it as a new AMI.
   */</span>
  <span class="keyword">def</span> <a title="(region: deploylib.ec2.EC2Region)String" id="68482">buildNewAmi</a><span class="delimiter">(</span><a title="deploylib.ec2.EC2Region" id="68576">region</a>: <a href="../ec2/ec2.scala.html#9544" title="deploylib.ec2.EC2Region">EC2Region</a> = <a href="../ec2/ec2.scala.html#9542" title="object deploylib.ec2.EC2West">EC2West</a><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <a href="#68576" title="deploylib.ec2.EC2Region">region</a>.<a href="../ec2/ec2.scala.html#40952" title="()Unit">update</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.Buffer[region.EC2Instance]" id="68577">oldInst</a> = <a href="#68576" title="deploylib.ec2.EC2Region">region</a>.<a href="../ec2/ec2.scala.html#40934" title="=&gt; com.amazonaws.services.ec2.AmazonEC2Client">client</a>.<span title="()com.amazonaws.services.ec2.model.DescribeTagsResult">describeTags</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()java.util.List[com.amazonaws.services.ec2.model.TagDescription]">getTags</span><span title="(l: java.util.List[com.amazonaws.services.ec2.model.TagDescription])scala.collection.mutable.Buffer[com.amazonaws.services.ec2.model.TagDescription]" class="delimiter">(</span><span class="delimiter">)</span>
      .<span title="(p: com.amazonaws.services.ec2.model.TagDescription =&gt; Boolean)scala.collection.mutable.Buffer[com.amazonaws.services.ec2.model.TagDescription]">filter</span><span class="delimiter">(</span><a href="#68770" title="com.amazonaws.services.ec2.model.TagDescription">_</a>.<span title="()java.lang.String">getResourceType</span> <span title="(x$1: Any)Boolean">equals</span> <span title="java.lang.String(&quot;instance&quot;)" class="string">&quot;instance&quot;</span><span class="delimiter">)</span>
      .<span title="(p: com.amazonaws.services.ec2.model.TagDescription =&gt; Boolean)scala.collection.mutable.Buffer[com.amazonaws.services.ec2.model.TagDescription]">filter</span><span class="delimiter">(</span><a href="#68777" title="com.amazonaws.services.ec2.model.TagDescription">_</a>.<span title="()java.lang.String">getKey</span> <span title="(x$1: Any)Boolean">equals</span> <span title="java.lang.String(&quot;mesos&quot;)" class="string">&quot;mesos&quot;</span><span class="delimiter">)</span>
      .<span title="(p: com.amazonaws.services.ec2.model.TagDescription =&gt; Boolean)scala.collection.mutable.Buffer[com.amazonaws.services.ec2.model.TagDescription]">filter</span><span class="delimiter">(</span><a href="#68784" title="com.amazonaws.services.ec2.model.TagDescription">_</a>.<span title="()java.lang.String">getValue</span> <span title="(x$1: Any)Boolean">equals</span> <span title="java.lang.String(&quot;ami&quot;)" class="string">&quot;ami&quot;</span><span class="delimiter">)</span>
      .<span title="(f: com.amazonaws.services.ec2.model.TagDescription =&gt; region.EC2Instance)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[com.amazonaws.services.ec2.model.TagDescription],region.EC2Instance,scala.collection.mutable.Buffer[region.EC2Instance]])scala.collection.mutable.Buffer[region.EC2Instance]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,region.EC2Instance,scala.collection.mutable.Buffer[region.EC2Instance]]" class="delimiter">(</span><a title="com.amazonaws.services.ec2.model.TagDescription" id="68805">t</a> =&gt; <a href="#68576" title="deploylib.ec2.EC2Region">region</a>.<a href="../ec2/ec2.scala.html#40953" title="(instanceId: String)region.EC2Instance">getInstance</a><span class="delimiter">(</span><a href="#68805" title="com.amazonaws.services.ec2.model.TagDescription">t</a>.<span title="()java.lang.String">getResourceId</span><span class="delimiter">)</span><span class="delimiter">)</span>
      .<span title="(p: region.EC2Instance =&gt; Boolean)scala.collection.mutable.Buffer[region.EC2Instance]">filter</span><span class="delimiter">(</span><a title="region.EC2Instance" id="68860">i</a> =&gt; <span class="delimiter">(</span><a href="#68860" title="region.EC2Instance">i</a>.<a href="../ec2/ec2.scala.html#44731" title="=&gt; String">instanceState</a> <span title="(x$1: Any)Boolean">equals</span> <span title="java.lang.String(&quot;running&quot;)" class="string">&quot;running&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#68860" title="region.EC2Instance">i</a>.<a href="../ec2/ec2.scala.html#44731" title="=&gt; String">instanceState</a> <span title="(x$1: Any)Boolean">equals</span> <span title="java.lang.String(&quot;pending&quot;)" class="string">&quot;pending&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="region.EC2Instance" id="68578">inst</a> =
      <span title="region.EC2Instance" class="keyword">if</span><span class="delimiter">(</span><a href="#68577" title="scala.collection.mutable.Buffer[region.EC2Instance]">oldInst</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
        <a href="#68576" title="deploylib.ec2.EC2Region">region</a>.<a href="../ec2/ec2.scala.html#40959" title="(num: Int)Seq[region.EC2Instance]">runInstances</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="=&gt; region.EC2Instance">head</span>
      <span class="keyword">else</span>
        <a href="#68577" title="scala.collection.mutable.Buffer[region.EC2Instance]">oldInst</a>.<span title="=&gt; region.EC2Instance">head</span>

    <a href="#68578" title="region.EC2Instance">inst</a>.<a href="../ec2/ec2.scala.html#44720" title="object inst.tags">tags</a> <a href="../ec2/ec2.scala.html#46764" title="(key: String, value: String)Unit">+=</a> <span class="delimiter">(</span><span title="java.lang.String(&quot;mesos&quot;)" class="string">&quot;mesos&quot;</span>, <span title="java.lang.String(&quot;ami&quot;)" class="string">&quot;ami&quot;</span><span class="delimiter">)</span>
    <a href="#68578" title="region.EC2Instance">inst</a>.<a href="../ec2/ec2.scala.html#44736" title="()Unit">blockUntilRunning</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <a href="#68477" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;updating apt...&quot;)" class="string">&quot;updating apt...&quot;</span><span class="delimiter">)</span>
    <a href="#68578" title="region.EC2Instance">inst</a> <a href="../RemoteMachine.scala.html#25743" title="(cmd: String)Unit">!</a> <span title="java.lang.String(&quot;add-apt-repository \&quot;deb http://archive.canonical.com/ubuntu lucid partner\&quot;&quot;)" class="string">&quot;add-apt-repository \&quot;deb http://archive.canonical.com/ubuntu lucid partner\&quot;&quot;</span>
    <a href="#68578" title="region.EC2Instance">inst</a> <a href="../RemoteMachine.scala.html#25743" title="(cmd: String)Unit">!</a> <span title="java.lang.String(&quot;echo sun-java6-jdk shared/accepted-sun-dlj-v1-1 select true | /usr/bin/debconf-set-selections&quot;)" class="string">&quot;echo sun-java6-jdk shared/accepted-sun-dlj-v1-1 select true | /usr/bin/debconf-set-selections&quot;</span>
    <a href="#68578" title="region.EC2Instance">inst</a> <a href="../RemoteMachine.scala.html#25743" title="(cmd: String)Unit">!</a> <span title="java.lang.String(&quot;apt-get update&quot;)" class="string">&quot;apt-get update&quot;</span>
    <a href="#68477" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;installing java...&quot;)" class="string">&quot;installing java...&quot;</span><span class="delimiter">)</span>
    <a href="#68578" title="region.EC2Instance">inst</a> <a href="../RemoteMachine.scala.html#25743" title="(cmd: String)Unit">!</a> <span title="java.lang.String(&quot;yes | apt-get install -y sun-java6-jdk&quot;)" class="string">&quot;yes | apt-get install -y sun-java6-jdk&quot;</span>
    <a href="#68477" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;installing build env...&quot;)" class="string">&quot;installing build env...&quot;</span><span class="delimiter">)</span>
    <a href="#68578" title="region.EC2Instance">inst</a> <a href="../RemoteMachine.scala.html#25743" title="(cmd: String)Unit">!</a> <span title="java.lang.String(&quot;apt-get install -y build-essential&quot;)" class="string">&quot;apt-get install -y build-essential&quot;</span>
    <a href="#68477" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;installing git...&quot;)" class="string">&quot;installing git...&quot;</span><span class="delimiter">)</span>
    <a href="#68578" title="region.EC2Instance">inst</a> <a href="../RemoteMachine.scala.html#25743" title="(cmd: String)Unit">!</a> <span title="java.lang.String(&quot;apt-get install -y git-core&quot;)" class="string">&quot;apt-get install -y git-core&quot;</span>
    <a href="#68477" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;installing python...&quot;)" class="string">&quot;installing python...&quot;</span><span class="delimiter">)</span>
    <a href="#68578" title="region.EC2Instance">inst</a> <a href="../RemoteMachine.scala.html#25743" title="(cmd: String)Unit">!</a> <span title="java.lang.String(&quot;apt-get install -y python2.6-dev&quot;)" class="string">&quot;apt-get install -y python2.6-dev&quot;</span>
    <a href="#68477" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;installing swig...&quot;)" class="string">&quot;installing swig...&quot;</span><span class="delimiter">)</span>
    <a href="#68578" title="region.EC2Instance">inst</a> <a href="../RemoteMachine.scala.html#25743" title="(cmd: String)Unit">!</a> <span title="java.lang.String(&quot;apt-get install -y swig&quot;)" class="string">&quot;apt-get install -y swig&quot;</span>
    <a href="#68477" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;installing autoconf...&quot;)" class="string">&quot;installing autoconf...&quot;</span><span class="delimiter">)</span>
    <a href="#68578" title="region.EC2Instance">inst</a> <a href="../RemoteMachine.scala.html#25743" title="(cmd: String)Unit">!</a> <span title="java.lang.String(&quot;apt-get install -y autoconf&quot;)" class="string">&quot;apt-get install -y autoconf&quot;</span>
    <a href="#68477" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;cloning mesos&quot;)" class="string">&quot;cloning mesos&quot;</span><span class="delimiter">)</span>
    <a href="#68578" title="region.EC2Instance">inst</a> <a href="../RemoteMachine.scala.html#25743" title="(cmd: String)Unit">!</a> <span title="java.lang.String(&quot;git clone https://github.com/mesos/mesos.git&quot;)" class="string">&quot;git clone https://github.com/mesos/mesos.git&quot;</span>
    <a href="#68477" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;building and installing mesos...&quot;)" class="string">&quot;building and installing mesos...&quot;</span><span class="delimiter">)</span>
    <a href="#68578" title="region.EC2Instance">inst</a> <a href="../RemoteMachine.scala.html#25743" title="(cmd: String)Unit">!</a> <span title="java.lang.String(&quot;cd mesos; ./configure --with-python-headers=/usr/include/python2.6 --with-java-home=/usr/lib/jvm/java-6-sun --with-webui --with-included-zookeeper; make; make install&quot;)" class="string">&quot;cd mesos; ./configure --with-python-headers=/usr/include/python2.6 --with-java-home=/usr/lib/jvm/java-6-sun --with-webui --with-included-zookeeper; make; make install&quot;</span>

    <span class="keyword">val</span> <a title="java.lang.String" id="68579">bucketName</a> = <span class="delimiter">(</span><a href="#68576" title="deploylib.ec2.EC2Region">region</a>.<span title="()java.lang.Class[_]">getClass</span>.<span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">getName</span>.<span title="(n: Int)String">dropRight</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span><span class="delimiter">)</span>.<span title="()java.lang.String">toLowerCase</span>.<span title="(x$1: java.lang.String, x$2: java.lang.String)java.lang.String">replaceAll</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\\.&quot;)" class="string">&quot;\\.&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
    <a href="#68477" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;bundling ami as %s...&quot;)" class="string">&quot;bundling ami as %s...&quot;</span>, <a href="#68579" title="java.lang.String">bucketName</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="String" id="68580">ami</a> = <a href="#68578" title="region.EC2Instance">inst</a>.<a href="../ec2/ec2.scala.html#44740" title="(bucketName: String)String">bundleNewAMI</a><span class="delimiter">(</span><a href="#68579" title="java.lang.String">bucketName</a><span class="delimiter">)</span>
    <span class="comment">//inst.halt</span>
    <a href="#68580" title="String">ami</a>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Functions to help maintain a mesos cluster on EC2.
 */</span>
<span class="keyword">class</span> <a title="class Cluster extends java.lang.Object with deploylib.config.ConfigurationActions with ScalaObject" id="9640">Cluster</a><a href="#9640" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="deploylib.ec2.EC2Region" id="69095">region</a>: <a href="../ec2/ec2.scala.html#9544" title="deploylib.ec2.EC2Region">EC2Region</a> = <a href="../ec2/ec2.scala.html#9540" title="object deploylib.ec2.EC2East">EC2East</a>, <span class="keyword">val</span> <a title="Boolean" id="69096">useFT</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../config/ConfigurationActions.scala.html#9518" title="deploylib.config.ConfigurationActions">ConfigurationActions</a> <span class="delimiter">{</span>
  <span class="comment">/**
   * The location of mesos on the remote machine
   */</span>
  <span class="keyword">val</span> <a title="java.io.File" id="69002">mesosDir</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/usr/local/mesos&quot;)" class="string">&quot;/usr/local/mesos&quot;</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Location of the deploylib framework on the remote instances
   */</span>
  <span class="keyword">val</span> <a title="java.io.File" id="69004">frameworkDir</a> = <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#69002" title="=&gt; java.io.File">mesosDir</a>, <span title="java.lang.String(&quot;frameworks/deploylib&quot;)" class="string">&quot;frameworks/deploylib&quot;</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="java.io.File" id="69006">binDir</a> = <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#69002" title="=&gt; java.io.File">mesosDir</a>, <span title="java.lang.String(&quot;bin&quot;)" class="string">&quot;bin&quot;</span><span class="delimiter">)</span>

  <span class="comment">/**
   * The ami used when launching new instances
   */</span>
  <span class="keyword">val</span> <a title="java.lang.String" id="69008">mesosAmi</a> =
    <span title="java.lang.String" class="keyword">if</span> <span class="delimiter">(</span><a href="#69095" title="=&gt; deploylib.ec2.EC2Region">region</a>.<a href="../ec2/ec2.scala.html#40926" title="=&gt; String">endpoint</a> <span title="(x$1: java.lang.CharSequence)Boolean">contains</span> <span title="java.lang.String(&quot;west&quot;)" class="string">&quot;west&quot;</span><span class="delimiter">)</span> <span title="java.lang.String(&quot;ami-1f08545a&quot;)" class="string">&quot;ami-1f08545a&quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot;ami-d373b1ba&quot;)" class="string">&quot;ami-d373b1ba&quot;</span>

  <span class="comment">/**
   * The default availability zone used when launching new instances.
   */</span>
  <span class="keyword">val</span> <a title="java.lang.String" id="69010">defaultZone</a> =
    <span title="java.lang.String" class="keyword">if</span> <span class="delimiter">(</span><a href="#69095" title="=&gt; deploylib.ec2.EC2Region">region</a>.<a href="../ec2/ec2.scala.html#40926" title="=&gt; String">endpoint</a> <span title="(x$1: java.lang.CharSequence)Boolean">contains</span> <span title="java.lang.String(&quot;west&quot;)" class="string">&quot;west&quot;</span><span class="delimiter">)</span> <span title="java.lang.String(&quot;us-west-1a&quot;)" class="string">&quot;us-west-1a&quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot;us-east-1b&quot;)" class="string">&quot;us-east-1b&quot;</span>

  <span class="comment">/**
   * The zookeeper node where the service scheduler registers itself
   */</span>
  <span class="keyword">def</span> <a title="=&gt; edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode" id="69012">serviceSchedulerNode</a> = <a href="#69026" title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode" id="69412">zooKeeperRoot</a>.<a href="#69412" title="Int" id="69414">getOrCreate</a><span class="delimiter">(</span><a title="java.lang.String(&quot;serviceScheduler&quot;)" id="69413" class="string">&quot;serviceScheduler&quot;</a><span class="delimiter">)</span>

  <span class="comment">/**
   * A handle to the service scheduler for the cluster
   */</span>
  <span class="keyword">def</span> <a title="=&gt; deploylib.mesos.RemoteServiceScheduler" id="69013">serviceScheduler</a> = classOf<span title="java.lang.Class[deploylib.mesos.RemoteServiceScheduler](classOf[deploylib.mesos.RemoteServiceScheduler])" class="delimiter">[</span>RemoteServiceScheduler<span class="delimiter">]</span>.<span title="()deploylib.mesos.RemoteServiceScheduler">newInstance</span>.<span title="(data: Array[Byte])deploylib.mesos.RemoteServiceScheduler">parse</span><span class="delimiter">(</span><a href="#69012" title="=&gt; edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">serviceSchedulerNode</a>.<span title="=&gt; Array[Byte]">data</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Kills all instances running on EC2 for this mesos cluster cluster (masters, slaves, zookeepers)
   */</span>
  <span class="keyword">def</span> <a title="()Unit" id="69014">stopAllInstances</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="#69023" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">masters</a> <span title="(xs: scala.collection.GenTraversableOnce[Cluster.this.region.EC2Instance])scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">++</span> <a href="#69021" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">slaves</a> <a href="../package.scala.html#9838" title="(itr: Iterable[Cluster.this.region.EC2Instance])deploylib.ParallelSeq[Cluster.this.region.EC2Instance]">++</a> <a href="#69024" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">zooKeepers</a><span class="delimiter">)</span>.<a href="../Concurrent.scala.html#12258" title="(f: Cluster.this.region.EC2Instance =&gt; Unit)Unit">pforeach</a><span class="delimiter">(</span><a href="#70005" title="Cluster.this.region.EC2Instance">_</a>.<a href="../ec2/ec2.scala.html#44723" title="=&gt; Unit">halt</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Start and configure the mesos master, at least numSlaves mesos slaves, and zookeeper in parallel.
   */</span>
  <span class="keyword">def</span> <a title="(numSlaves: Int)Seq[Any]" id="69015">setup</a><span class="delimiter">(</span><a title="Int" id="70009">numSlaves</a>: <span title="Int">Int</span> = <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> = <span title="(elems: deploylib.Future[_ &gt;: Unit]*)Seq[deploylib.Future[_ &gt;: Unit]]">Seq</span><span class="delimiter">(</span>
    <a href="../Concurrent.scala.html#10057" title="(f: =&gt; Unit)deploylib.Future[Unit]">Future</a><span class="delimiter">(</span><a href="#69017" title="(zone: String, numMasters: Int, mesosAmi: Option[String])Unit">setupMesosMaster</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>,
    <a href="../Concurrent.scala.html#10057" title="(f: =&gt; Unit)deploylib.Future[Unit]">Future</a><span class="delimiter">(</span><a href="#69027" title="(numServers: Int)Unit">setupZooKeeper</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>,
    <a href="../Concurrent.scala.html#10057" title="(f: =&gt; Any)deploylib.Future[Any]">Future</a><span class="delimiter">(</span><span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#69021" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">slaves</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">&lt;</span> <a href="#70009" title="Int">numSlaves</a><span class="delimiter">)</span> <a href="#69036" title="(count: Int, zone: String, ami: String, updateDeploylibOnStart: Boolean)Seq[deploylib.ec2.package.EC2Instance]">addSlaves</a><span class="delimiter">(</span><a href="#70009" title="Int">numSlaves</a> <span title="(x: Int)Int">-</span> <a href="#69021" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">slaves</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">)</span>.<span title="(f: deploylib.Future[_ &gt;: Unit] =&gt; Any)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[deploylib.Future[_ &gt;: Unit]],Any,Seq[Any]])Seq[Any]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Any,Seq[Any]]" class="delimiter">(</span><a href="../Concurrent.scala.html#10070" title="()Any">_</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Update the jars and scripts for deploylib on the specified instances (default: all masters + slaves) using the current classSource
   */</span>
  <span class="keyword">def</span> <a title="(instances: Seq[deploylib.ec2.package.EC2Instance])Unit" id="69016">updateDeploylib</a><span class="delimiter">(</span><a title="Seq[deploylib.ec2.package.EC2Instance]" id="70200">instances</a>: <span title="Seq[deploylib.ec2.package.EC2Instance]">Seq</span><span class="delimiter">[</span>EC2Instance<span class="delimiter">]</span> = <span class="delimiter">(</span><a href="#69021" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">slaves</a> <span title="(xs: scala.collection.GenTraversableOnce[Cluster.this.region.EC2Instance])scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">++</span> <a href="#69023" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">masters</a><span class="delimiter">)</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="../package.scala.html#9838" title="(itr: Iterable[deploylib.ec2.package.EC2Instance])deploylib.ParallelSeq[deploylib.ec2.package.EC2Instance]">instances</a>.<a href="../Concurrent.scala.html#12258" title="(f: deploylib.ec2.package.EC2Instance =&gt; Unit)Unit">pforeach</a><span class="delimiter">(</span><a title="deploylib.ec2.package.EC2Instance" id="70278">inst</a> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="70279">executorScript</a> = <a href="../Util.scala.html#9503" title="object deploylib.Util">Util</a>.<a href="../Util.scala.html#30856" title="(file: java.io.File)String">readFile</a><span class="delimiter">(</span><span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><span title="java.lang.String(&quot;deploylib/src/main/resources/java_executor&quot;)" class="string">&quot;deploylib/src/main/resources/java_executor&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
        .<span title="(x$1: java.lang.String)Array[java.lang.String]">split</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>
        .<span title="(f: java.lang.String =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Array[java.lang.String],java.lang.String,Array[java.lang.String]])Array[java.lang.String]">map</span> <a href="#70731" title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">{</a>
        <span class="keyword">case</span> <a title="java.lang.String" id="70732">s</a> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#70732" title="java.lang.String">s</a> <span title="(x$1: java.lang.CharSequence)Boolean">contains</span> <span title="java.lang.String(&quot;CLASSPATH=&quot;)" class="string">&quot;CLASSPATH=&quot;</span><span class="delimiter">)</span> =&gt; <span title="java.lang.String(&quot;CLASSPATH=\'-cp /usr/local/mesos/lib/java/mesos.jar:&quot;)" class="string">&quot;CLASSPATH='-cp /usr/local/mesos/lib/java/mesos.jar:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#70278" title="deploylib.ec2.package.EC2Instance">inst</a>.<a href="../ec2/ec2.scala.html#44735" title="(jars: Seq[java.io.File])Seq[java.io.File]">pushJars</a><span class="delimiter">(</span><a href="#9637" title="object deploylib.mesos.MesosCluster">MesosCluster</a>.<a href="#68480" title="=&gt; Seq[java.io.File]">jarFiles</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\'&quot;)" class="string">&quot;'&quot;</span>
        <span class="keyword">case</span> <a title="java.lang.String" id="70736">s</a> =&gt; <a href="#70736" title="java.lang.String">s</a>
      <span class="delimiter">}</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>

      <a href="../config/ConfigurationActions.scala.html#38448" title="(target: deploylib.RemoteMachine, directory: java.io.File)java.io.File">createDirectory</a><span class="delimiter">(</span><a href="#70278" title="deploylib.ec2.package.EC2Instance">inst</a>, <a href="#69004" title="=&gt; java.io.File">frameworkDir</a><span class="delimiter">)</span>
      <a href="../config/ConfigurationActions.scala.html#38450" title="(target: deploylib.RemoteMachine, localFile: java.io.File, destination: java.io.File)java.io.File">uploadFile</a><span class="delimiter">(</span><a href="#70278" title="deploylib.ec2.package.EC2Instance">inst</a>, <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><span title="java.lang.String(&quot;deploylib/src/main/resources/config&quot;)" class="string">&quot;deploylib/src/main/resources/config&quot;</span><span class="delimiter">)</span>, <a href="#69004" title="=&gt; java.io.File">frameworkDir</a><span class="delimiter">)</span>
      <a href="../config/ConfigurationActions.scala.html#38449" title="(target: deploylib.RemoteMachine, filename: java.io.File, contents: String, mode: String)java.io.File">createFile</a><span title="Unit" class="delimiter">(</span><a href="#70278" title="deploylib.ec2.package.EC2Instance">inst</a>, <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#69004" title="=&gt; java.io.File">frameworkDir</a>, <span title="java.lang.String(&quot;java_executor&quot;)" class="string">&quot;java_executor&quot;</span><span class="delimiter">)</span>, <a href="#70279" title="String">executorScript</a>, <span title="java.lang.String(&quot;755&quot;)" class="string">&quot;755&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Configure the mesos master, starting instances if needed.
   */</span>
  <span class="keyword">def</span> <a title="(zone: String, numMasters: Int, mesosAmi: Option[String])Unit" id="69017">setupMesosMaster</a><span class="delimiter">(</span><a title="String" id="70018">zone</a>: <span title="String">String</span> = <a href="#69010" title="=&gt; java.lang.String">defaultZone</a>, <a title="Int" id="70019">numMasters</a>: <span title="Int">Int</span> = <span title="Int(1)" class="int">1</span>, <a title="Option[String]" id="70020">mesosAmi</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span title="object None">None</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#69023" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">masters</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">&lt;</span> <a href="#70019" title="Int">numMasters</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#70020" title="Option[String]">mesosAmi</a> <span title="Seq[deploylib.ec2.package.EC2Instance]" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Seq[deploylib.ec2.package.EC2Instance]">Some</span><span class="delimiter">(</span><a title="String" id="70919">ami</a><span class="delimiter">)</span> =&gt; <a href="#69035" title="(zone: String, count: Int, ami: String)Seq[deploylib.ec2.package.EC2Instance]">startMasters</a><span class="delimiter">(</span><a href="#70018" title="String">zone</a>, <a href="#70019" title="Int">numMasters</a> <span title="(x: Int)Int">-</span> <a href="#69023" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">masters</a>.<span title="=&gt; Int">size</span>, <a href="#70919" title="String">ami</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Seq[deploylib.ec2.package.EC2Instance]">None</span> =&gt; <a href="#69035" title="(zone: String, count: Int, ami: String)Seq[deploylib.ec2.package.EC2Instance]">startMasters</a><span class="delimiter">(</span><a href="#70018" title="String">zone</a>, <a href="#70019" title="Int">numMasters</a> <span title="(x: Int)Int">-</span> <a href="#69023" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">masters</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <a href="#69023" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">masters</a>.<span title="(f: Cluster.this.region.EC2Instance =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#70965" title="Cluster.this.region.EC2Instance">_</a>.<a href="../ec2/ec2.scala.html#44736" title="()Unit">blockUntilRunning</a><span class="delimiter">)</span>
    <a href="../package.scala.html#9838" title="(itr: Iterable[Cluster.this.region.EC2Instance])deploylib.ParallelSeq[Cluster.this.region.EC2Instance]">masters</a>.<a href="../Concurrent.scala.html#12258" title="(f: Cluster.this.region.EC2Instance =&gt; Unit)Unit">pforeach</a><span class="delimiter">(</span><a href="#70992" title="Cluster.this.region.EC2Instance">_</a>.<a href="../ec2/ec2.scala.html#44735" title="(jars: Seq[java.io.File])Seq[java.io.File]">pushJars</a><span title="Unit" class="delimiter">(</span><a href="#9637" title="object deploylib.mesos.MesosCluster">MesosCluster</a>.<a href="#68480" title="=&gt; Seq[java.io.File]">jarFiles</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#69044" title="=&gt; Unit">updateMasterConf</a>

    <a href="#69024" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">zooKeepers</a>.<span title="(f: Cluster.this.region.EC2Instance =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#71013" title="Cluster.this.region.EC2Instance">_</a>.<a href="../ec2/ec2.scala.html#44736" title="()Unit">blockUntilRunning</a><span class="delimiter">)</span>
    <a href="#69024" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">zooKeepers</a>.<span title="(f: Cluster.this.region.EC2Instance =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#71033" title="Cluster.this.region.EC2Instance">_</a>.<a href="../RemoteMachine.scala.html#25756" title="(port: Int)Unit">blockTillPortOpen</a><span class="delimiter">(</span><span title="Int(2181)" class="int">2181</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <a href="#69032" title="()Unit">restartMasters</a>
    <a href="#69018" title="=&gt; Unit">restartServiceScheduler</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Restart the service scheduler daemon running on the mesos master.
   * NOTE: this will kill any other java procs running on the master.
   */</span>
  <span class="keyword">def</span> <a title="=&gt; Unit" id="69018">restartServiceScheduler</a>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#69024" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">zooKeepers</a>.<span title="(f: Cluster.this.region.EC2Instance =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#71057" title="Cluster.this.region.EC2Instance">_</a>.<a href="../ec2/ec2.scala.html#44736" title="()Unit">blockUntilRunning</a><span class="delimiter">)</span>
    <a href="../package.scala.html#9838" title="(itr: Iterable[Cluster.this.region.EC2Instance])deploylib.ParallelSeq[Cluster.this.region.EC2Instance]">masters</a>.<a href="../Concurrent.scala.html#12258" title="(f: Cluster.this.region.EC2Instance =&gt; Unit)Unit">pforeach</a><span class="delimiter">(</span><a href="#71083" title="Cluster.this.region.EC2Instance">_</a>.<a href="../RemoteMachine.scala.html#25745" title="(cmd: String, timeout: Long)deploylib.ExecuteResponse">executeCommand</a><span title="Unit" class="delimiter">(</span><span title="java.lang.String(&quot;killall java&quot;)" class="string">&quot;killall java&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.lang.String" id="71038">serviceSchedulerCmd</a> =
        <span class="string">&quot;/$HOME/jrun -Dscads.comm.externalip=true deploylib.mesos.ServiceSchedulerDaemon &quot;</span> <span title="java.lang.String(&quot;/$HOME/jrun -Dscads.comm.externalip=true deploylib.mesos.ServiceSchedulerDaemon --mesosMaster &quot;)">+</span>
        <span class="string">&quot;--mesosMaster &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#69030" title="=&gt; String">clusterUrl</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span>
        <span title="java.lang.String(&quot;--zooKeeperAddress &quot;)" class="string">&quot;--zooKeeperAddress &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#69012" title="=&gt; edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">serviceSchedulerNode</a>.<span title="=&gt; java.lang.String">canonicalAddress</span>

    <a href="#69028" title="=&gt; Cluster.this.region.EC2Instance">firstMaster</a>.<a href="../RemoteMachine.scala.html#28098" title="(name: java.lang.String, cmd: java.lang.String)Cluster.this.region.EC2Instance#RemoteService">getService</a><span class="delimiter">(</span><span title="java.lang.String(&quot;service-scheduler&quot;)" class="string">&quot;service-scheduler&quot;</span>, <a href="#71038" title="java.lang.String">serviceSchedulerCmd</a><span class="delimiter">)</span>.<a href="../RemoteMachine.scala.html#28122" title="=&gt; Unit">restart</a>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(inst: deploylib.ec2.package.EC2Instance)deploylib.ServiceManager#RemoteService" id="69019">slaveService</a><span class="delimiter">(</span><a title="deploylib.ec2.package.EC2Instance" id="71094">inst</a>: <a href="../ec2/ec2.scala.html#40961" title="deploylib.ec2.package.EC2Instance">EC2Instance</a><span class="delimiter">)</span>: ServiceManager#<a href="../RemoteMachine.scala.html#28095" title="deploylib.ServiceManager#RemoteService">RemoteService</a> = <a href="#71094" title="deploylib.ec2.package.EC2Instance">inst</a>.<a href="../RemoteMachine.scala.html#28098" title="(name: String, cmd: String)inst.RemoteService">getService</a><span class="delimiter">(</span><span title="java.lang.String(&quot;mesos-slave&quot;)" class="string">&quot;mesos-slave&quot;</span>, <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#69006" title="=&gt; java.io.File">binDir</a>, <span title="java.lang.String(&quot;mesos-slave&quot;)" class="string">&quot;mesos-slave&quot;</span><span class="delimiter">)</span>.<span title="()java.lang.String">getCanonicalPath</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.Buffer[deploylib.ServiceManager#RemoteService]" id="69020">slaveServices</a> = <a href="#69021" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">slaves</a>.<span title="(f: Cluster.this.region.EC2Instance =&gt; deploylib.ServiceManager#RemoteService)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance],deploylib.ServiceManager#RemoteService,scala.collection.mutable.Buffer[deploylib.ServiceManager#RemoteService]])scala.collection.mutable.Buffer[deploylib.ServiceManager#RemoteService]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,deploylib.ServiceManager#RemoteService,scala.collection.mutable.Buffer[deploylib.ServiceManager#RemoteService]]" class="delimiter">(</span><a href="#69019" title="(inst: deploylib.ec2.package.EC2Instance)deploylib.ServiceManager#RemoteService">slaveService</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Returns a list of EC2Instances for all the slaves in the cluster
   */</span>
  <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]" id="69021">slaves</a> = <span class="delimiter">{</span>
    <a href="#69095" title="=&gt; deploylib.ec2.EC2Region">region</a>.<a href="../ec2/ec2.scala.html#40952" title="()Unit">update</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#69095" title="=&gt; deploylib.ec2.EC2Region">region</a>.<a href="../ec2/ec2.scala.html#40934" title="=&gt; com.amazonaws.services.ec2.AmazonEC2Client">client</a>.<span title="()com.amazonaws.services.ec2.model.DescribeTagsResult">describeTags</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()java.util.List[com.amazonaws.services.ec2.model.TagDescription]">getTags</span><span title="(l: java.util.List[com.amazonaws.services.ec2.model.TagDescription])scala.collection.mutable.Buffer[com.amazonaws.services.ec2.model.TagDescription]" class="delimiter">(</span><span class="delimiter">)</span>
      .<span title="(p: com.amazonaws.services.ec2.model.TagDescription =&gt; Boolean)scala.collection.mutable.Buffer[com.amazonaws.services.ec2.model.TagDescription]">filter</span><span class="delimiter">(</span><a href="#69832" title="com.amazonaws.services.ec2.model.TagDescription">_</a>.<span title="()java.lang.String">getResourceType</span> <span title="(x$1: Any)Boolean">equals</span> <span title="java.lang.String(&quot;instance&quot;)" class="string">&quot;instance&quot;</span><span class="delimiter">)</span>
      .<span title="(p: com.amazonaws.services.ec2.model.TagDescription =&gt; Boolean)scala.collection.mutable.Buffer[com.amazonaws.services.ec2.model.TagDescription]">filter</span><span class="delimiter">(</span><a href="#69839" title="com.amazonaws.services.ec2.model.TagDescription">_</a>.<span title="()java.lang.String">getKey</span> <span title="(x$1: Any)Boolean">equals</span> <span title="java.lang.String(&quot;mesos&quot;)" class="string">&quot;mesos&quot;</span><span class="delimiter">)</span>
      .<span title="(p: com.amazonaws.services.ec2.model.TagDescription =&gt; Boolean)scala.collection.mutable.Buffer[com.amazonaws.services.ec2.model.TagDescription]">filter</span><span class="delimiter">(</span><a href="#69846" title="com.amazonaws.services.ec2.model.TagDescription">_</a>.<span title="()java.lang.String">getValue</span> <span title="(x$1: Any)Boolean">equals</span> <span title="java.lang.String(&quot;slave&quot;)" class="string">&quot;slave&quot;</span><span class="delimiter">)</span>
      .<span title="(f: com.amazonaws.services.ec2.model.TagDescription =&gt; Cluster.this.region.EC2Instance)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[com.amazonaws.services.ec2.model.TagDescription],Cluster.this.region.EC2Instance,scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]])scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,Cluster.this.region.EC2Instance,scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]]" class="delimiter">(</span><a title="com.amazonaws.services.ec2.model.TagDescription" id="69867">t</a> =&gt; <a href="#69095" title="=&gt; deploylib.ec2.EC2Region">region</a>.<a href="../ec2/ec2.scala.html#40953" title="(instanceId: String)Cluster.this.region.EC2Instance">getInstance</a><span class="delimiter">(</span><a href="#69867" title="com.amazonaws.services.ec2.model.TagDescription">t</a>.<span title="()java.lang.String">getResourceId</span><span class="delimiter">)</span><span class="delimiter">)</span>
      .<span title="(p: Cluster.this.region.EC2Instance =&gt; Boolean)scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">filter</span><span class="delimiter">(</span><a title="Cluster.this.region.EC2Instance" id="69902">i</a> =&gt; <span class="delimiter">(</span><a href="#69902" title="Cluster.this.region.EC2Instance">i</a>.<a href="../ec2/ec2.scala.html#44731" title="=&gt; String">instanceState</a> <span title="(x$1: Any)Boolean">equals</span> <span title="java.lang.String(&quot;running&quot;)" class="string">&quot;running&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#69902" title="Cluster.this.region.EC2Instance">i</a>.<a href="../ec2/ec2.scala.html#44731" title="=&gt; String">instanceState</a> <span title="(x$1: Any)Boolean">equals</span> <span title="java.lang.String(&quot;pending&quot;)" class="string">&quot;pending&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance#RemoteService]" id="69022">masterServices</a> = <a href="#69023" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">masters</a>.<span title="(f: Cluster.this.region.EC2Instance =&gt; Cluster.this.region.EC2Instance#RemoteService)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance],Cluster.this.region.EC2Instance#RemoteService,scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance#RemoteService]])scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance#RemoteService]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,Cluster.this.region.EC2Instance#RemoteService,scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance#RemoteService]]" class="delimiter">(</span><a href="#71182" title="Cluster.this.region.EC2Instance">_</a>.<a href="../RemoteMachine.scala.html#28098" title="(name: String, cmd: String)x$15.RemoteService">getService</a><span class="delimiter">(</span><span title="java.lang.String(&quot;mesos-master&quot;)" class="string">&quot;mesos-master&quot;</span>, <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#69006" title="=&gt; java.io.File">binDir</a>, <span title="java.lang.String(&quot;mesos-master&quot;)" class="string">&quot;mesos-master&quot;</span><span class="delimiter">)</span>.<span title="()java.lang.String">getCanonicalPath</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Returns a list of EC2Instances for all the masters in the cluster
   */</span>
  <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]" id="69023">masters</a> = <span class="delimiter">{</span>
    <a href="#69095" title="=&gt; deploylib.ec2.EC2Region">region</a>.<a href="../ec2/ec2.scala.html#40952" title="()Unit">update</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#69095" title="=&gt; deploylib.ec2.EC2Region">region</a>.<a href="../ec2/ec2.scala.html#40934" title="=&gt; com.amazonaws.services.ec2.AmazonEC2Client">client</a>.<span title="()com.amazonaws.services.ec2.model.DescribeTagsResult">describeTags</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()java.util.List[com.amazonaws.services.ec2.model.TagDescription]">getTags</span><span title="(l: java.util.List[com.amazonaws.services.ec2.model.TagDescription])scala.collection.mutable.Buffer[com.amazonaws.services.ec2.model.TagDescription]" class="delimiter">(</span><span class="delimiter">)</span>
      .<span title="(p: com.amazonaws.services.ec2.model.TagDescription =&gt; Boolean)scala.collection.mutable.Buffer[com.amazonaws.services.ec2.model.TagDescription]">filter</span><span class="delimiter">(</span><a href="#69578" title="com.amazonaws.services.ec2.model.TagDescription">_</a>.<span title="()java.lang.String">getResourceType</span> <span title="(x$1: Any)Boolean">equals</span> <span title="java.lang.String(&quot;instance&quot;)" class="string">&quot;instance&quot;</span><span class="delimiter">)</span>
      .<span title="(p: com.amazonaws.services.ec2.model.TagDescription =&gt; Boolean)scala.collection.mutable.Buffer[com.amazonaws.services.ec2.model.TagDescription]">filter</span><span class="delimiter">(</span><a href="#69585" title="com.amazonaws.services.ec2.model.TagDescription">_</a>.<span title="()java.lang.String">getKey</span> <span title="(x$1: Any)Boolean">equals</span> <span title="java.lang.String(&quot;mesos&quot;)" class="string">&quot;mesos&quot;</span><span class="delimiter">)</span>
      .<span title="(p: com.amazonaws.services.ec2.model.TagDescription =&gt; Boolean)scala.collection.mutable.Buffer[com.amazonaws.services.ec2.model.TagDescription]">filter</span><span class="delimiter">(</span><a href="#69592" title="com.amazonaws.services.ec2.model.TagDescription">_</a>.<span title="()java.lang.String">getValue</span> <span title="(x$1: Any)Boolean">equals</span> <span title="java.lang.String(&quot;master&quot;)" class="string">&quot;master&quot;</span><span class="delimiter">)</span>
      .<span title="(f: com.amazonaws.services.ec2.model.TagDescription =&gt; Cluster.this.region.EC2Instance)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[com.amazonaws.services.ec2.model.TagDescription],Cluster.this.region.EC2Instance,scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]])scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,Cluster.this.region.EC2Instance,scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]]" class="delimiter">(</span><a title="com.amazonaws.services.ec2.model.TagDescription" id="69613">t</a> =&gt; <a href="#69095" title="=&gt; deploylib.ec2.EC2Region">region</a>.<a href="../ec2/ec2.scala.html#40953" title="(instanceId: String)Cluster.this.region.EC2Instance">getInstance</a><span class="delimiter">(</span><a href="#69613" title="com.amazonaws.services.ec2.model.TagDescription">t</a>.<span title="()java.lang.String">getResourceId</span><span class="delimiter">)</span><span class="delimiter">)</span>
      .<span title="(p: Cluster.this.region.EC2Instance =&gt; Boolean)scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">filter</span><span class="delimiter">(</span><a title="Cluster.this.region.EC2Instance" id="69648">i</a> =&gt; <span class="delimiter">(</span><a href="#69648" title="Cluster.this.region.EC2Instance">i</a>.<a href="../ec2/ec2.scala.html#44731" title="=&gt; String">instanceState</a> <span title="(x$1: Any)Boolean">equals</span> <span title="java.lang.String(&quot;running&quot;)" class="string">&quot;running&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#69648" title="Cluster.this.region.EC2Instance">i</a>.<a href="../ec2/ec2.scala.html#44731" title="=&gt; String">instanceState</a> <span title="(x$1: Any)Boolean">equals</span> <span title="java.lang.String(&quot;pending&quot;)" class="string">&quot;pending&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Returns a list of EC2Instances for all the zookeepers in the clsuter
   */</span>
  <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]" id="69024">zooKeepers</a> = <span class="delimiter">{</span>
    <a href="#69095" title="=&gt; deploylib.ec2.EC2Region">region</a>.<a href="../ec2/ec2.scala.html#40952" title="()Unit">update</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#69095" title="=&gt; deploylib.ec2.EC2Region">region</a>.<a href="../ec2/ec2.scala.html#40934" title="=&gt; com.amazonaws.services.ec2.AmazonEC2Client">client</a>.<span title="()com.amazonaws.services.ec2.model.DescribeTagsResult">describeTags</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()java.util.List[com.amazonaws.services.ec2.model.TagDescription]">getTags</span><span title="(l: java.util.List[com.amazonaws.services.ec2.model.TagDescription])scala.collection.mutable.Buffer[com.amazonaws.services.ec2.model.TagDescription]" class="delimiter">(</span><span class="delimiter">)</span>
      .<span title="(p: com.amazonaws.services.ec2.model.TagDescription =&gt; Boolean)scala.collection.mutable.Buffer[com.amazonaws.services.ec2.model.TagDescription]">filter</span><span class="delimiter">(</span><a href="#69259" title="com.amazonaws.services.ec2.model.TagDescription">_</a>.<span title="()java.lang.String">getResourceType</span> <span title="(x$1: Any)Boolean">equals</span> <span title="java.lang.String(&quot;instance&quot;)" class="string">&quot;instance&quot;</span><span class="delimiter">)</span>
      .<span title="(p: com.amazonaws.services.ec2.model.TagDescription =&gt; Boolean)scala.collection.mutable.Buffer[com.amazonaws.services.ec2.model.TagDescription]">filter</span><span class="delimiter">(</span><a href="#69266" title="com.amazonaws.services.ec2.model.TagDescription">_</a>.<span title="()java.lang.String">getKey</span> <span title="(x$1: Any)Boolean">equals</span> <span title="java.lang.String(&quot;mesos&quot;)" class="string">&quot;mesos&quot;</span><span class="delimiter">)</span>
      .<span title="(p: com.amazonaws.services.ec2.model.TagDescription =&gt; Boolean)scala.collection.mutable.Buffer[com.amazonaws.services.ec2.model.TagDescription]">filter</span><span class="delimiter">(</span><a href="#69273" title="com.amazonaws.services.ec2.model.TagDescription">_</a>.<span title="()java.lang.String">getValue</span> <span title="(x$1: Any)Boolean">equals</span> <span title="java.lang.String(&quot;zoo&quot;)" class="string">&quot;zoo&quot;</span><span class="delimiter">)</span>
      .<span title="(f: com.amazonaws.services.ec2.model.TagDescription =&gt; Cluster.this.region.EC2Instance)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[com.amazonaws.services.ec2.model.TagDescription],Cluster.this.region.EC2Instance,scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]])scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,Cluster.this.region.EC2Instance,scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]]" class="delimiter">(</span><a title="com.amazonaws.services.ec2.model.TagDescription" id="69294">t</a> =&gt; <a href="#69095" title="=&gt; deploylib.ec2.EC2Region">region</a>.<a href="../ec2/ec2.scala.html#40953" title="(instanceId: String)Cluster.this.region.EC2Instance">getInstance</a><span class="delimiter">(</span><a href="#69294" title="com.amazonaws.services.ec2.model.TagDescription">t</a>.<span title="()java.lang.String">getResourceId</span><span class="delimiter">)</span><span class="delimiter">)</span>
      .<span title="(p: Cluster.this.region.EC2Instance =&gt; Boolean)scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">filter</span><span class="delimiter">(</span><a title="Cluster.this.region.EC2Instance" id="69341">i</a> =&gt; <span class="delimiter">(</span><a href="#69341" title="Cluster.this.region.EC2Instance">i</a>.<a href="../ec2/ec2.scala.html#44731" title="=&gt; String">instanceState</a> <span title="(x$1: Any)Boolean">equals</span> <span title="java.lang.String(&quot;running&quot;)" class="string">&quot;running&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#69341" title="Cluster.this.region.EC2Instance">i</a>.<a href="../ec2/ec2.scala.html#44731" title="=&gt; String">instanceState</a> <span title="(x$1: Any)Boolean">equals</span> <span title="java.lang.String(&quot;pending&quot;)" class="string">&quot;pending&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Returns he canonical address for the zookeeper quorum for this cluster
   */</span>
  <span class="keyword">def</span> <a title="=&gt; String" id="69025">zooKeeperAddress</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;zk://%s/&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#69024" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">zooKeepers</a>.<span title="(f: Cluster.this.region.EC2Instance =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance],java.lang.String,scala.collection.mutable.Buffer[java.lang.String]])scala.collection.mutable.Buffer[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,java.lang.String,scala.collection.mutable.Buffer[java.lang.String]]" class="delimiter">(</span><a href="#69363" title="Cluster.this.region.EC2Instance">_</a>.<a href="../ec2/ec2.scala.html#44726" title="=&gt; String">publicDnsName</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;:2181&quot;)" class="string">&quot;:2181&quot;</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Returns a handle to the root of the the zookeeper quorum for this cluster
   */</span>
  <span class="keyword">def</span> <a title="=&gt; edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode" id="69026">zooKeeperRoot</a> = <span title="(uri: String)edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">ZooKeeperNode</span><span class="delimiter">(</span><a href="#69025" title="=&gt; String">zooKeeperAddress</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Configure all zookepers running to operate in a quorum.
   * Starts at at least numServers if they aren't already running.
   */</span>
  <span class="keyword">def</span> <a title="(numServers: Int)Unit" id="69027">setupZooKeeper</a><span class="delimiter">(</span><a title="Int" id="70032">numServers</a>: <span title="Int">Int</span> = <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="71217">missingServers</a> = <a href="#70032" title="Int">numServers</a> <span title="(x: Int)Int">-</span> <a href="#69024" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">zooKeepers</a>.<span title="=&gt; Int">size</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#71217" title="Int">missingServers</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Seq[Cluster.this.region.EC2Instance]" id="71231">ret</a> = <a href="#69095" title="=&gt; deploylib.ec2.EC2Region">region</a>.<a href="../ec2/ec2.scala.html#40960" title="(imageId: String, min: Int, max: Int, keyName: String, instanceType: String, location: String, userData: Option[String])Seq[Cluster.this.region.EC2Instance]">runInstances</a><span class="delimiter">(</span>
        <a href="#69008" title="=&gt; java.lang.String">mesosAmi</a>,
        <a href="#71217" title="Int">missingServers</a>,
        <a href="#71217" title="Int">missingServers</a>,
        <a href="#69095" title="=&gt; deploylib.ec2.EC2Region">region</a>.<a href="../ec2/ec2.scala.html#40931" title="=&gt; java.lang.String">keyName</a>,
        <span title="java.lang.String(&quot;m1.large&quot;)" class="string">&quot;m1.large&quot;</span>,
        <a href="#69010" title="=&gt; java.lang.String">defaultZone</a>,
        <span title="object None">None</span><span class="delimiter">)</span>

      <a href="#71231" title="Seq[Cluster.this.region.EC2Instance]">ret</a>.<span title="(f: Cluster.this.region.EC2Instance =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#71412" title="Cluster.this.region.EC2Instance">_</a>.<a href="../ec2/ec2.scala.html#44720" title="object x$23.tags">tags</a> <a href="../ec2/ec2.scala.html#46764" title="(key: String, value: String)Unit">+=</a> <span class="delimiter">(</span><span title="java.lang.String(&quot;mesos&quot;)" class="string">&quot;mesos&quot;</span>, <span title="java.lang.String(&quot;zoo&quot;)" class="string">&quot;zoo&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#71231" title="Seq[Cluster.this.region.EC2Instance]">ret</a>.<span title="(f: Cluster.this.region.EC2Instance =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#71423" title="Cluster.this.region.EC2Instance">_</a>.<a href="../ec2/ec2.scala.html#44736" title="()Unit">blockUntilRunning</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="scala.collection.mutable.Buffer[(Cluster.this.region.EC2Instance, Int)]" id="71218">servers</a> = <a href="#69024" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">zooKeepers</a>.<span title="(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance],(Cluster.this.region.EC2Instance, Int),scala.collection.mutable.Buffer[(Cluster.this.region.EC2Instance, Int)]])scala.collection.mutable.Buffer[(Cluster.this.region.EC2Instance, Int)]">zipWithIndex</span>

    <span class="keyword">val</span> <a title="List[String]" id="71219">serverList</a> = <a href="#71218" title="scala.collection.mutable.Buffer[(Cluster.this.region.EC2Instance, Int)]">servers</a>.<span title="(f: (Cluster.this.region.EC2Instance, Int) =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[(Cluster.this.region.EC2Instance, Int)],String,scala.collection.mutable.Buffer[String]])scala.collection.mutable.Buffer[String]">map</span> <a href="#71480" title="String" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="String" class="delimiter">(</span><a title="Cluster.this.region.EC2Instance" id="71483">server</a>, <a title="Int" id="71484">id</a>: <span title="Int">Int</span><span class="delimiter">)</span> =&gt; <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;server.%d=%s:3181:3182&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#71484" title="Int">id</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>, <a href="#71483" title="Cluster.this.region.EC2Instance">server</a>.<a href="../ec2/ec2.scala.html#44727" title="=&gt; String">privateDnsName</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>.<span title="=&gt; List[String]">toList</span>

    <span class="keyword">val</span> <a title="String" id="71220">cnf</a> =
      <span class="delimiter">(</span><span title="java.lang.String(&quot;dataDir=/mnt/zookeeper&quot;)" class="string">&quot;dataDir=/mnt/zookeeper&quot;</span> <a href="#71528" title="(x: String)List[String]">::</a>
        <span title="java.lang.String(&quot;clientPort=2181&quot;)" class="string">&quot;clientPort=2181&quot;</span> <a href="#71529" title="(x: String)List[String]">::</a>
        <span title="java.lang.String(&quot;tickTime=1000&quot;)" class="string">&quot;tickTime=1000&quot;</span> <a href="#71530" title="(x: String)List[String]">::</a>
        <span title="java.lang.String(&quot;initLimit=60&quot;)" class="string">&quot;initLimit=60&quot;</span> <a href="#71531" title="(x: String)List[String]">::</a>
        <span title="java.lang.String(&quot;syncLimit=30&quot;)" class="string">&quot;syncLimit=30&quot;</span> <a href="#71532" title="(x: String)List[String]">::</a>
        <span class="delimiter">(</span><span title="List[String]" class="keyword">if</span> <span class="delimiter">(</span><a href="#71218" title="scala.collection.mutable.Buffer[(Cluster.this.region.EC2Instance, Int)]">servers</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <a href="#71219" title="List[String]">serverList</a> <span class="keyword">else</span> <span title="object Nil">Nil</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="java.lang.String" id="71221">startCommand</a> = <span title="java.lang.String(&quot;/$HOME/jrun org.apache.zookeeper.server.quorum.QuorumPeerMain /mnt/zookeeper.cnf&quot;)" class="string">&quot;/$HOME/jrun org.apache.zookeeper.server.quorum.QuorumPeerMain /mnt/zookeeper.cnf&quot;</span>

    <a href="../package.scala.html#9838" title="(itr: Iterable[(Cluster.this.region.EC2Instance, Int)])deploylib.ParallelSeq[(Cluster.this.region.EC2Instance, Int)]">servers</a>.<a href="../Concurrent.scala.html#12258" title="(f: (Cluster.this.region.EC2Instance, Int) =&gt; Unit)Unit">pforeach</a> <a href="#71597" title="Unit" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="Unit" class="delimiter">(</span><a title="Cluster.this.region.EC2Instance" id="71600">server</a>, <a title="Int" id="71601">id</a>: <span title="Int">Int</span><span class="delimiter">)</span> =&gt;
        <a href="#71600" title="Cluster.this.region.EC2Instance">server</a> <a href="../RemoteMachine.scala.html#25743" title="(cmd: String)Unit">!</a> <span title="java.lang.String(&quot;mkdir -p /mnt/zookeeper&quot;)" class="string">&quot;mkdir -p /mnt/zookeeper&quot;</span>
        <a href="#71600" title="Cluster.this.region.EC2Instance">server</a>.<a href="../RemoteMachine.scala.html#25746" title="(file: java.io.File, contents: String)Unit">createFile</a><span class="delimiter">(</span><span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/mnt/zookeeper.cnf&quot;)" class="string">&quot;/mnt/zookeeper.cnf&quot;</span><span class="delimiter">)</span>, <a href="#71220" title="String">cnf</a><span class="delimiter">)</span>
        <a href="#71600" title="Cluster.this.region.EC2Instance">server</a>.<a href="../RemoteMachine.scala.html#25746" title="(file: java.io.File, contents: String)Unit">createFile</a><span class="delimiter">(</span><span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/mnt/zookeeper/myid&quot;)" class="string">&quot;/mnt/zookeeper/myid&quot;</span><span class="delimiter">)</span>, <span class="delimiter">(</span><a href="#71601" title="Int">id</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span>

        <span class="keyword">val</span> <a title="server.RemoteService" id="71602">zooService</a> = <a href="#71600" title="Cluster.this.region.EC2Instance">server</a>.<a href="../RemoteMachine.scala.html#28098" title="(name: String, cmd: String)server.RemoteService">getService</a><span class="delimiter">(</span><span title="java.lang.String(&quot;zookeeper&quot;)" class="string">&quot;zookeeper&quot;</span>, <a href="#71221" title="java.lang.String">startCommand</a><span class="delimiter">)</span>

        <a href="#71600" title="Cluster.this.region.EC2Instance">server</a>.<a href="../ec2/ec2.scala.html#44735" title="(jars: Seq[java.io.File])Seq[java.io.File]">pushJars</a><span class="delimiter">(</span><a href="#9637" title="object deploylib.mesos.MesosCluster">MesosCluster</a>.<a href="#68480" title="=&gt; Seq[java.io.File]">jarFiles</a><span class="delimiter">)</span>
        <a href="#71600" title="Cluster.this.region.EC2Instance">server</a>.<a href="../RemoteMachine.scala.html#25745" title="(cmd: String, timeout: Long)deploylib.ExecuteResponse">executeCommand</a><span class="delimiter">(</span><span title="java.lang.String(&quot;killall java&quot;)" class="string">&quot;killall java&quot;</span><span class="delimiter">)</span>
        <a href="#71602" title="server.RemoteService">zooService</a>.<a href="../RemoteMachine.scala.html#28120" title="=&gt; Unit">start</a>
    <span class="delimiter">}</span>

    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#71220" title="String">cnf</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Returns the EC2Instance for the first mesos master
   */</span>
  <span class="keyword">def</span> <a title="=&gt; Cluster.this.region.EC2Instance" id="69028">firstMaster</a> = <a href="#69023" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">masters</a>.<span title="=&gt; Cluster.this.region.EC2Instance">head</span>

  <span class="comment">/**
   * Copy the mesos binaries from the master to all slaves
   */</span>
  <span class="keyword">def</span> <a title="=&gt; Unit" id="69029">updateMesos</a> =
    <a href="../package.scala.html#9838" title="(itr: Iterable[Cluster.this.region.EC2Instance])deploylib.ParallelSeq[Cluster.this.region.EC2Instance]">slaves</a>.<a href="../Concurrent.scala.html#12258" title="(f: Cluster.this.region.EC2Instance =&gt; Unit)Unit">pforeach</a><span class="delimiter">(</span><a title="Cluster.this.region.EC2Instance" id="71645">s</a> =&gt;
      <a href="#69028" title="=&gt; Cluster.this.region.EC2Instance">firstMaster</a> <a href="../RemoteMachine.scala.html#25743" title="(cmd: String)Unit">!</a> <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;rsync -e 'ssh -o StrictHostKeyChecking=no' -av /usr/local/mesos root@%s:/usr/local/mesos&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#71645" title="Cluster.this.region.EC2Instance">s</a>.<a href="../ec2/ec2.scala.html#44726" title="=&gt; String">publicDnsName</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Returns the mesos cluster url
   */</span>
  <span class="keyword">def</span> <a title="=&gt; String" id="69030">clusterUrl</a>: <span title="String">String</span> =
    <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#69096" title="=&gt; Boolean">useFT</a><span class="delimiter">)</span>
      <span title="java.lang.String(&quot;zoo://&quot;)" class="string">&quot;zoo://&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#69026" title="=&gt; edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">zooKeeperRoot</a>.<span title="=&gt; edu.berkeley.cs.scads.comm.ZooKeeperProxy">proxy</span>.<span title="=&gt; Seq[String]">servers</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#69026" title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode" id="71652">zooKeeperRoot</a>.<a href="#71652" title="Int" id="71654">getOrCreate</a><span class="delimiter">(</span><a title="java.lang.String(&quot;mesos&quot;)" id="71653" class="string">&quot;mesos&quot;</a><span class="delimiter">)</span>.<span title="=&gt; String">path</span>
    <span class="keyword">else</span>
      <span title="java.lang.String(&quot;master@&quot;)" class="string">&quot;master@&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#69028" title="=&gt; Cluster.this.region.EC2Instance">firstMaster</a>.<a href="../ec2/ec2.scala.html#44726" title="=&gt; String">publicDnsName</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;:5050&quot;)" class="string">&quot;:5050&quot;</span>

  <span class="comment">/**
   * Restart the mesos-slave process for all slaves
   */</span>
  <span class="keyword">def</span> <a title="()Unit" id="69031">restartSlaves</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="../package.scala.html#9838" title="(itr: Iterable[deploylib.ServiceManager#RemoteService])deploylib.ParallelSeq[deploylib.ServiceManager#RemoteService]">slaveServices</a>.<a href="../Concurrent.scala.html#12258" title="(f: deploylib.ServiceManager#RemoteService =&gt; Unit)Unit">pforeach</a><span class="delimiter">(</span><a href="#71686" title="deploylib.ServiceManager#RemoteService">_</a>.<a href="../RemoteMachine.scala.html#28122" title="=&gt; Unit">restart</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Restart the mesos-master process for all masters
   */</span>
  <span class="keyword">def</span> <a title="()Unit" id="69032">restartMasters</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="../package.scala.html#9838" title="(itr: Iterable[Cluster.this.region.EC2Instance#RemoteService])deploylib.ParallelSeq[Cluster.this.region.EC2Instance#RemoteService]">masterServices</a>.<a href="../Concurrent.scala.html#12258" title="(f: Cluster.this.region.EC2Instance#RemoteService =&gt; Unit)Unit">pforeach</a><span class="delimiter">(</span><a href="#71717" title="Cluster.this.region.EC2Instance#RemoteService">_</a>.<a href="../RemoteMachine.scala.html#28122" title="=&gt; Unit">restart</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Restart masters, slaves, and the service scheduler.  Also kills any java procs running on slaves.
   */</span>
  <span class="keyword">def</span> <a title="()Unit" id="69033">restart</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#69032" title="()Unit">restartMasters</a>
    <a href="#69031" title="()Unit">restartSlaves</a>
    <a href="#69018" title="=&gt; Unit">restartServiceScheduler</a>
    <a href="../package.scala.html#9838" title="(itr: Iterable[Cluster.this.region.EC2Instance])deploylib.ParallelSeq[Cluster.this.region.EC2Instance]">slaves</a>.<a href="../Concurrent.scala.html#12258" title="(f: Cluster.this.region.EC2Instance =&gt; Unit)Unit">pforeach</a><span class="delimiter">(</span><a href="#71744" title="Cluster.this.region.EC2Instance">_</a>.<a href="../RemoteMachine.scala.html#25745" title="(cmd: String, timeout: Long)deploylib.ExecuteResponse">executeCommand</a><span title="Unit" class="delimiter">(</span><span title="java.lang.String(&quot;killall java&quot;)" class="string">&quot;killall java&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Update the slaves file for the mesos scripts located in /root/mesos-ec2
   */</span>
  @deprecated<span class="delimiter">(</span><span class="string">&quot;don't use the mesos scripts anymore&quot;</span>, <span class="string">&quot;v2.1.2&quot;</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="=&gt; Unit" id="69034">updateSlavesFile</a>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.io.File" id="71747">location</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/root/mesos-ec2/slaves&quot;)" class="string">&quot;/root/mesos-ec2/slaves&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="String" id="71748">contents</a> = <a href="#69021" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">slaves</a>.<span title="(f: Cluster.this.region.EC2Instance =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance],String,scala.collection.mutable.Buffer[String]])scala.collection.mutable.Buffer[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,String,scala.collection.mutable.Buffer[String]]" class="delimiter">(</span><a href="#71772" title="Cluster.this.region.EC2Instance">_</a>.<a href="../ec2/ec2.scala.html#44727" title="=&gt; String">privateDnsName</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>
    <a href="../package.scala.html#9838" title="(itr: Iterable[Cluster.this.region.EC2Instance])deploylib.ParallelSeq[Cluster.this.region.EC2Instance]">masters</a>.<a href="../Concurrent.scala.html#12258" title="(f: Cluster.this.region.EC2Instance =&gt; Unit)Unit">pforeach</a> <span class="delimiter">{</span>
      <a title="Cluster.this.region.EC2Instance" id="71825">master</a> =&gt;
        <a href="#71825" title="Cluster.this.region.EC2Instance">master</a>.<a href="../RemoteMachine.scala.html#25753" title="(remoteDir: java.io.File)Unit">mkdir</a><span class="delimiter">(</span><a href="package.scala.html#9830" title="implicit deploylib.mesos.package.toFile : (str: String)java.io.File" class="string">&quot;/root/mesos-ec2&quot;</a><span class="delimiter">)</span>
        <a href="../config/ConfigurationActions.scala.html#38449" title="(target: deploylib.RemoteMachine, filename: java.io.File, contents: String, mode: String)java.io.File">createFile</a><span title="Unit" class="delimiter">(</span><a href="#71825" title="Cluster.this.region.EC2Instance">master</a>, <a href="#71747" title="java.io.File">location</a>, <a href="#71748" title="String">contents</a>, <span title="java.lang.String(&quot;644&quot;)" class="string">&quot;644&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Start and configure the specified number of masters.
   */</span>
  <span class="keyword">def</span> <a title="(zone: String, count: Int, ami: String)Seq[deploylib.ec2.package.EC2Instance]" id="69035">startMasters</a><span class="delimiter">(</span><a title="String" id="70924">zone</a>: <span title="String">String</span> = <a href="#69010" title="=&gt; java.lang.String">defaultZone</a>, <a title="Int" id="70925">count</a>: <span title="Int">Int</span> = <span title="Int(1)" class="int">1</span>, <a title="String" id="70926">ami</a>: <span title="String">String</span> = <a href="#69008" title="=&gt; java.lang.String">mesosAmi</a><span class="delimiter">)</span>: <span title="Seq[deploylib.ec2.package.EC2Instance]">Seq</span><span class="delimiter">[</span>EC2Instance<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Seq[Cluster.this.region.EC2Instance]" id="71826">ret</a> = <a href="#69095" title="=&gt; deploylib.ec2.EC2Region">region</a>.<a href="../ec2/ec2.scala.html#40960" title="(imageId: String, min: Int, max: Int, keyName: String, instanceType: String, location: String, userData: Option[String])Seq[Cluster.this.region.EC2Instance]">runInstances</a><span class="delimiter">(</span>
      <a href="#70926" title="String">ami</a>,
      <a href="#70925" title="Int">count</a>,
      <a href="#70925" title="Int">count</a>,
      <a href="#69095" title="=&gt; deploylib.ec2.EC2Region">region</a>.<a href="../ec2/ec2.scala.html#40931" title="=&gt; java.lang.String">keyName</a>,
      <span title="java.lang.String(&quot;m1.large&quot;)" class="string">&quot;m1.large&quot;</span>,
      <a href="#70924" title="String">zone</a>,
      <span title="object None">None</span><span class="delimiter">)</span>

    <a href="../package.scala.html#9838" title="(itr: Iterable[Cluster.this.region.EC2Instance])deploylib.ParallelSeq[Cluster.this.region.EC2Instance]">ret</a>.<a href="../Concurrent.scala.html#12258" title="(f: Cluster.this.region.EC2Instance =&gt; Unit)Unit">pforeach</a><span class="delimiter">(</span><a title="Cluster.this.region.EC2Instance" id="71861">i</a> =&gt; <span class="delimiter">{</span>
      <a href="#71861" title="Cluster.this.region.EC2Instance">i</a>.<a href="../ec2/ec2.scala.html#44720" title="object i.tags">tags</a> <a href="../ec2/ec2.scala.html#46764" title="(key: String, value: String)Unit">+=</a> <span class="delimiter">(</span><span title="java.lang.String(&quot;mesos&quot;)" class="string">&quot;mesos&quot;</span>, <span title="java.lang.String(&quot;master&quot;)" class="string">&quot;master&quot;</span><span class="delimiter">)</span>
      <a href="#71861" title="Cluster.this.region.EC2Instance">i</a>.<a href="../ec2/ec2.scala.html#44736" title="()Unit">blockUntilRunning</a>
      <a href="#69043" title="(instances: Seq[deploylib.ec2.package.EC2Instance])Unit">updateSlaveConf</a><span class="delimiter">(</span><a href="#71861" title="Cluster.this.region.EC2Instance">i</a> <a href="#71865" title="(x: Cluster.this.region.EC2Instance)List[Cluster.this.region.EC2Instance]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    <a href="#69032" title="()Unit">restartMasters</a>
    <a href="#71826" title="Seq[Cluster.this.region.EC2Instance]">ret</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Add slaves to the cluster
   */</span>
  <span class="keyword">def</span> <a title="(count: Int, zone: String, ami: String, updateDeploylibOnStart: Boolean)Seq[deploylib.ec2.package.EC2Instance]" id="69036">addSlaves</a><span class="delimiter">(</span><a title="Int" id="70043">count</a>: <span title="Int">Int</span>, <a title="String" id="70048">zone</a>: <span title="String">String</span> = <a href="#69010" title="=&gt; java.lang.String">defaultZone</a>, <a title="String" id="70049">ami</a>: <span title="String">String</span> = <a href="#69008" title="=&gt; java.lang.String">mesosAmi</a>, <a title="Boolean" id="70050">updateDeploylibOnStart</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>: <span title="Seq[deploylib.ec2.package.EC2Instance]">Seq</span><span class="delimiter">[</span>EC2Instance<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Option[java.lang.String]" id="71873">userData</a> =
      <span title="Option[java.lang.String]" class="keyword">if</span> <span class="delimiter">(</span><a href="#70050" title="Boolean">updateDeploylibOnStart</a><span class="delimiter">)</span>
        <span title="object None">None</span>
      <span class="keyword">else</span>
        <span class="keyword">try</span> <span class="delimiter">{</span>
          <a href="#69023" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">masters</a>.<span title="(f: Cluster.this.region.EC2Instance =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#71893" title="Cluster.this.region.EC2Instance">_</a>.<a href="../ec2/ec2.scala.html#44736" title="()Unit">blockUntilRunning</a><span class="delimiter">)</span>
          <span title="(x: java.lang.String)Some[java.lang.String]">Some</span><span class="delimiter">(</span><span title="java.lang.String(&quot;url=&quot;)" class="string">&quot;url=&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#69030" title="=&gt; String">clusterUrl</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a title="None.type" id="71898">noMaster</a>: java.util.<span title="java.util.NoSuchElementException">NoSuchElementException</span> =&gt;
            <a href="../config/ConfigurationActions.scala.html#38446" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;No master found. Starting without userdata&quot;)" class="string">&quot;No master found. Starting without userdata&quot;</span><span class="delimiter">)</span>
            <span title="object None">None</span>
        <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="Seq[Cluster.this.region.EC2Instance]" id="71874">instances</a> = <a href="#69095" title="=&gt; deploylib.ec2.EC2Region">region</a>.<a href="../ec2/ec2.scala.html#40960" title="(imageId: String, min: Int, max: Int, keyName: String, instanceType: String, location: String, userData: Option[String])Seq[Cluster.this.region.EC2Instance]">runInstances</a><span class="delimiter">(</span>
      <a href="#70049" title="String">ami</a>,
      <a href="#70043" title="Int">count</a>,
      <a href="#70043" title="Int">count</a>,
      <a href="#69095" title="=&gt; deploylib.ec2.EC2Region">region</a>.<a href="../ec2/ec2.scala.html#40931" title="=&gt; java.lang.String">keyName</a>,
      <span title="java.lang.String(&quot;m1.large&quot;)" class="string">&quot;m1.large&quot;</span>,
      <a href="#70048" title="String">zone</a>,
      <a href="#71873" title="Option[java.lang.String]">userData</a><span class="delimiter">)</span>
    <a href="#71874" title="Seq[Cluster.this.region.EC2Instance]">instances</a>.<span title="(f: Cluster.this.region.EC2Instance =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#71933" title="Cluster.this.region.EC2Instance">_</a>.<a href="../ec2/ec2.scala.html#44720" title="object x$36.tags">tags</a> <a href="../ec2/ec2.scala.html#46764" title="(key: String, value: String)Unit">+=</a> <span class="delimiter">(</span><span title="java.lang.String(&quot;mesos&quot;)" class="string">&quot;mesos&quot;</span>, <span title="java.lang.String(&quot;slave&quot;)" class="string">&quot;slave&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#70050" title="Boolean">updateDeploylibOnStart</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">//Hack to avoid race condition where there are no masters yet because they haven't been tagged.</span>
      <a href="#71874" title="Seq[Cluster.this.region.EC2Instance]">instances</a>.<span title="=&gt; Cluster.this.region.EC2Instance">head</span>.<a href="../ec2/ec2.scala.html#44736" title="()Unit">blockUntilRunning</a>
      <a href="#69023" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">masters</a>.<span title="(f: Cluster.this.region.EC2Instance =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#71953" title="Cluster.this.region.EC2Instance">_</a>.<a href="../ec2/ec2.scala.html#44736" title="()Unit">blockUntilRunning</a><span class="delimiter">)</span>
      <a href="#69028" title="=&gt; Cluster.this.region.EC2Instance">firstMaster</a>.<a href="../RemoteMachine.scala.html#25756" title="(port: Int)Unit">blockTillPortOpen</a><span class="delimiter">(</span><span title="Int(5050)" class="int">5050</span><span class="delimiter">)</span>

      <a href="../package.scala.html#9838" title="(itr: Iterable[Cluster.this.region.EC2Instance])deploylib.ParallelSeq[Cluster.this.region.EC2Instance]">instances</a>.<a href="../Concurrent.scala.html#12258" title="(f: Cluster.this.region.EC2Instance =&gt; Unit)Unit">pforeach</a><span class="delimiter">(</span><a title="Cluster.this.region.EC2Instance" id="71979">i</a> =&gt; <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#71979" title="Cluster.this.region.EC2Instance">i</a>.<a href="../ec2/ec2.scala.html#44736" title="()Unit">blockUntilRunning</a>
        <a href="#69016" title="(instances: Seq[deploylib.ec2.package.EC2Instance])Unit">updateDeploylib</a><span class="delimiter">(</span><a href="#71979" title="Cluster.this.region.EC2Instance">i</a> <a href="#71980" title="(x: Cluster.this.region.EC2Instance)List[Cluster.this.region.EC2Instance]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span>
        <a href="#69043" title="(instances: Seq[deploylib.ec2.package.EC2Instance])Unit">updateSlaveConf</a><span class="delimiter">(</span><a href="#71979" title="Cluster.this.region.EC2Instance">i</a> <a href="#71984" title="(x: Cluster.this.region.EC2Instance)List[Cluster.this.region.EC2Instance]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span>
        <a href="#69019" title="(inst: deploylib.ec2.package.EC2Instance)deploylib.ServiceManager#RemoteService">slaveService</a><span class="delimiter">(</span><a href="#71979" title="Cluster.this.region.EC2Instance">i</a><span class="delimiter">)</span>.<a href="../RemoteMachine.scala.html#28120" title="=&gt; Unit">start</a>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Unit" id="71988">e</a> =&gt; <a href="../config/ConfigurationActions.scala.html#38446" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(thrown: Throwable, msg: String, items: Any*)Unit">error</span><span class="delimiter">(</span><a href="#71988" title="java.lang.Throwable">e</a>, <span title="java.lang.String(&quot;Failed to start slave on instance %s:%s&quot;)" class="string">&quot;Failed to start slave on instance %s:%s&quot;</span>, <a href="#71979" title="Cluster.this.region.EC2Instance">i</a>.<a href="../ec2/ec2.scala.html#44703" title="=&gt; String">instanceId</a>, <a href="#71979" title="Cluster.this.region.EC2Instance">i</a>.<a href="../ec2/ec2.scala.html#44726" title="=&gt; String">publicDnsName</a><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#71874" title="Seq[Cluster.this.region.EC2Instance]">instances</a>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">val</span> <a title="List[java.lang.String]" id="69037">baseConf</a> = <span class="delimiter">(</span>
    <span title="java.lang.String(&quot;webui_port=8080&quot;)" class="string">&quot;webui_port=8080&quot;</span> <a href="#69064" title="(x: java.lang.String)List[java.lang.String]">::</a>
      <span title="java.lang.String(&quot;work_dir=/mnt&quot;)" class="string">&quot;work_dir=/mnt&quot;</span> <a href="#69065" title="(x: java.lang.String)List[java.lang.String]">::</a>
      <span title="java.lang.String(&quot;log_dir=/mnt&quot;)" class="string">&quot;log_dir=/mnt&quot;</span> <a href="#69066" title="(x: java.lang.String)List[java.lang.String]">::</a>
      <span title="java.lang.String(&quot;switch_user=0&quot;)" class="string">&quot;switch_user=0&quot;</span> <a href="#69067" title="(x: java.lang.String)List[java.lang.String]">::</a>
      <span title="java.lang.String(&quot;shares_interval=30&quot;)" class="string">&quot;shares_interval=30&quot;</span> <a href="#69068" title="(x: java.lang.String)List[java.lang.String]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; List[java.lang.String]" id="69039">confWithUrl</a> = <span class="delimiter">(</span><span title="java.lang.String(&quot;master=&quot;)" class="string">&quot;master=&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#69030" title="=&gt; String">clusterUrl</a><span class="delimiter">)</span> <a href="#71996" title="(x: java.lang.String)List[java.lang.String]">::</a> <a href="#69037" title="=&gt; List[java.lang.String]">baseConf</a>

  <span class="comment">/**
   * Returns the contents of the mesos slave configuration file.
   */</span>
  <span class="keyword">def</span> <a title="(instance: deploylib.ec2.package.EC2Instance)String" id="69040">slaveConf</a><span class="delimiter">(</span><a title="deploylib.ec2.package.EC2Instance" id="72002">instance</a>: <a href="../ec2/ec2.scala.html#40961" title="deploylib.ec2.package.EC2Instance">EC2Instance</a><span class="delimiter">)</span> = <span class="delimiter">(</span><span class="delimiter">(</span><span title="java.lang.String(&quot;mem=&quot;)" class="string">&quot;mem=&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span class="delimiter">(</span><a href="#72002" title="deploylib.ec2.package.EC2Instance">instance</a>.<a href="../RemoteMachine.scala.html#25776" title="=&gt; instance.FreeStats">free</a>.<a href="../RemoteMachine.scala.html#35528" title="=&gt; Int">total</a> <span title="(x: Int)Int">-</span> <span title="Int(1024)" class="int">1024</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#72005" title="(x: java.lang.String)List[java.lang.String]">::</a>
    <a href="#69039" title="=&gt; List[java.lang.String]">confWithUrl</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>

  <span class="comment">/**
   * the location of the configuration file for both masters and slaves on the remote machine
   */</span>
  <span class="keyword">val</span> <a title="java.io.File" id="69041">confFile</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/usr/local/mesos/conf/mesos.conf&quot;)" class="string">&quot;/usr/local/mesos/conf/mesos.conf&quot;</span><span class="delimiter">)</span>


  <span class="comment">/**
   * Updates the slave configuration file on the specified instances (default all slaves)
   */</span>
  <span class="keyword">def</span> <a title="(instances: Seq[deploylib.ec2.package.EC2Instance])Unit" id="69043">updateSlaveConf</a><span class="delimiter">(</span><a title="Seq[deploylib.ec2.package.EC2Instance]" id="71864">instances</a>: <span title="Seq[deploylib.ec2.package.EC2Instance]">Seq</span><span class="delimiter">[</span>EC2Instance<span class="delimiter">]</span> = <a href="#69021" title="=&gt; scala.collection.mutable.Buffer[Cluster.this.region.EC2Instance]">slaves</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="../package.scala.html#9838" title="(itr: Iterable[deploylib.ec2.package.EC2Instance])deploylib.ParallelSeq[deploylib.ec2.package.EC2Instance]">instances</a>.<a href="../Concurrent.scala.html#12258" title="(f: deploylib.ec2.package.EC2Instance =&gt; Unit)Unit">pforeach</a><span class="delimiter">(</span><a title="deploylib.ec2.package.EC2Instance" id="72043">i</a> =&gt; <a href="#72043" title="deploylib.ec2.package.EC2Instance">i</a>.<a href="../RemoteMachine.scala.html#25746" title="(file: java.io.File, contents: String)Unit">createFile</a><span class="delimiter">(</span><a href="#69041" title="=&gt; java.io.File">confFile</a>, <a href="#69040" title="(instance: deploylib.ec2.package.EC2Instance)String">slaveConf</a><span class="delimiter">(</span><a href="#72043" title="deploylib.ec2.package.EC2Instance">i</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Updates the master configuration file on all masters.
   */</span>
  <span class="keyword">def</span> <a title="=&gt; Unit" id="69044">updateMasterConf</a>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="String" id="72044">masterConf</a> =
      <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#69096" title="=&gt; Boolean">useFT</a><span class="delimiter">)</span>
        <a href="#69039" title="=&gt; List[java.lang.String]">confWithUrl</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>
      <span class="keyword">else</span>
        <a href="#69037" title="=&gt; List[java.lang.String]">baseConf</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>

    <a href="../package.scala.html#9838" title="(itr: Iterable[Cluster.this.region.EC2Instance])deploylib.ParallelSeq[Cluster.this.region.EC2Instance]">masters</a>.<a href="../Concurrent.scala.html#12258" title="(f: Cluster.this.region.EC2Instance =&gt; Unit)Unit">pforeach</a><span class="delimiter">(</span><a href="#72075" title="Cluster.this.region.EC2Instance">_</a>.<a href="../RemoteMachine.scala.html#25746" title="(file: java.io.File, contents: String)Unit">createFile</a><span class="delimiter">(</span><a href="#69041" title="=&gt; java.io.File">confFile</a>, <a href="#72044" title="String">masterConf</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Returns S3 Cached jars for all jar files specified in MesosCluster.jarFiles.  This will upload any jar files that don't already exist
   */</span>
  <span class="keyword">def</span> <a title="=&gt; Seq[edu.berkeley.cs.scads.comm.S3CachedJar]" id="69045">classSource</a>: <span title="Seq[edu.berkeley.cs.scads.comm.S3CachedJar]">Seq</span><span class="delimiter">[</span>S3CachedJar<span class="delimiter">]</span> =
    <span title="Seq[edu.berkeley.cs.scads.comm.S3CachedJar]" class="keyword">if</span> <span class="delimiter">(</span><span title="object java.lang.System">System</span>.<span title="(x$1: java.lang.String)java.lang.String">getProperty</span><span class="delimiter">(</span><span title="java.lang.String(&quot;deploylib.classSource&quot;)" class="string">&quot;deploylib.classSource&quot;</span><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
      <a href="#69046" title="=&gt; Seq[String]">pushJars</a>.<span title="(f: String =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="package.scala.html#9830" title="implicit deploylib.mesos.package.toFile : (str: String)java.io.File">_</a>.<span title="()java.lang.String">getName</span><span class="delimiter">)</span>
        .<span title="(f: java.lang.String =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[java.lang.String],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="../ec2/s3cache.scala.html#9560" title="object deploylib.ec2.S3Cache">S3Cache</a>.<a href="../ec2/s3cache.scala.html#47774" title="(fileMd5: String)String">hashToUrl</a><span class="delimiter">)</span>
        .<span title="(f: String =&gt; edu.berkeley.cs.scads.comm.S3CachedJar)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],edu.berkeley.cs.scads.comm.S3CachedJar,Seq[edu.berkeley.cs.scads.comm.S3CachedJar]])Seq[edu.berkeley.cs.scads.comm.S3CachedJar]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.comm.S3CachedJar,Seq[edu.berkeley.cs.scads.comm.S3CachedJar]]" class="delimiter">(</span><span title="edu.berkeley.cs.scads.comm.S3CachedJar" class="keyword">new</span> <span title="edu.berkeley.cs.scads.comm.S3CachedJar">S3CachedJar</span><span class="delimiter">(</span><a href="#72196" title="String">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">else</span>
      <span title="object java.lang.System">System</span>.<span title="(x$1: java.lang.String)java.lang.String">getProperty</span><span class="delimiter">(</span><span title="java.lang.String(&quot;deploylib.classSource&quot;)" class="string">&quot;deploylib.classSource&quot;</span><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)Array[java.lang.String]">split</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><span title="java.lang.String(&quot;\\|&quot;)" class="string">&quot;\\|&quot;</span><span class="delimiter">)</span>.<span title="(f: java.lang.String =&gt; edu.berkeley.cs.scads.comm.S3CachedJar)(implicit bf: scala.collection.generic.CanBuildFrom[Array[java.lang.String],edu.berkeley.cs.scads.comm.S3CachedJar,Seq[edu.berkeley.cs.scads.comm.S3CachedJar]])Seq[edu.berkeley.cs.scads.comm.S3CachedJar]">map</span><span title="(implicit m: DummyImplicit)scala.collection.generic.CanBuildFrom[Array[_],edu.berkeley.cs.scads.comm.S3CachedJar,scala.collection.mutable.ArraySeq[edu.berkeley.cs.scads.comm.S3CachedJar]]" class="delimiter">(</span><span title="(url: String)edu.berkeley.cs.scads.comm.S3CachedJar">S3CachedJar</span><span class="delimiter">(</span><a href="#72668" title="java.lang.String">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">//TODO fix me.</span>
  <span class="keyword">def</span> <a title="=&gt; Seq[String]" id="69046">pushJars</a>: <span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Seq[java.io.File]" id="72693">jars</a> = <a href="#9637" title="object deploylib.mesos.MesosCluster">MesosCluster</a>.<a href="#68480" title="=&gt; Seq[java.io.File]">jarFiles</a>
    <span class="keyword">val</span> <a href="#72695" title="(Seq[java.io.File], Seq[java.io.File])" class="delimiter">(</a><a href="#72694" title="Seq[java.io.File]" id="72695">deploylib</a>, <a href="#72694" title="Seq[java.io.File]" id="72696">otherJars</a><span class="delimiter">)</span> = <a href="#72693" title="Seq[java.io.File]">jars</a>.<span title="(p: java.io.File =&gt; Boolean)(Seq[java.io.File], Seq[java.io.File])">partition</span><span title="(Seq[java.io.File], Seq[java.io.File]) @unchecked" class="delimiter">(</span><a href="#72701" title="java.io.File">_</a>.<span title="()java.lang.String">getName</span> <span title="(x$1: java.lang.CharSequence)Boolean">contains</span> <span title="java.lang.String(&quot;deploylib&quot;)" class="string">&quot;deploylib&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Seq[java.io.File]" id="72697">sortedJars</a> = <a href="#72695" title="Seq[java.io.File]">deploylib</a> <span title="(that: scala.collection.GenTraversableOnce[java.io.File])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[java.io.File],java.io.File,Seq[java.io.File]])Seq[java.io.File]">++</span> <a href="#72696" title="Seq[java.io.File]">otherJars</a>

    <a href="../config/ConfigurationActions.scala.html#38446" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Starting Jar upload&quot;)" class="string">&quot;Starting Jar upload&quot;</span><span class="delimiter">)</span>
    <a href="#72697" title="Seq[java.io.File]">sortedJars</a>.<span title="(f: java.io.File =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[java.io.File],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="../ec2/s3cache.scala.html#9560" title="object deploylib.ec2.S3Cache">S3Cache</a>.<a href="../ec2/s3cache.scala.html#47775" title="(file: java.io.File)String">getCacheUrl</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Create a public key on the master if it doesn't exist
   * Then add that to the authorized key file all of slaves
   * TODO: Dedup keys
   */</span>
  <span class="keyword">def</span> <a title="=&gt; Unit" id="69047">authorizeMaster</a>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.lang.String" id="72789">getKeyCommand</a> = <span title="java.lang.String(&quot;cat /$HOME/.ssh/id_rsa.pub&quot;)" class="string">&quot;cat /$HOME/.ssh/id_rsa.pub&quot;</span>
    <span class="keyword">val</span> <a title="String" id="72790">key</a> = <span class="keyword">try</span> <span class="delimiter">(</span><a href="#69028" title="=&gt; Cluster.this.region.EC2Instance">firstMaster</a> <a href="../RemoteMachine.scala.html#25744" title="(cmd: String)String">!?</a> <a href="#72789" title="java.lang.String">getKeyCommand</a><span class="delimiter">)</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="String" id="72791">u</a>: <a href="../RemoteMachine.scala.html#9483" title="deploylib.UnknownResponse">UnknownResponse</a> =&gt; <span class="delimiter">{</span>
        <a href="#69028" title="=&gt; Cluster.this.region.EC2Instance">firstMaster</a> <a href="../RemoteMachine.scala.html#25743" title="(cmd: String)Unit">!</a> <span title="java.lang.String(&quot;ssh-keygen -t rsa -f /$HOME/.ssh/id_rsa -N \&quot;\&quot;&quot;)" class="string">&quot;ssh-keygen -t rsa -f /$HOME/.ssh/id_rsa -N \&quot;\&quot;&quot;</span>
        <a href="#69028" title="=&gt; Cluster.this.region.EC2Instance">firstMaster</a> <a href="../RemoteMachine.scala.html#25744" title="(cmd: String)String">!?</a> <a href="#72789" title="java.lang.String">getKeyCommand</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <a href="../package.scala.html#9838" title="(itr: Iterable[Cluster.this.region.EC2Instance])deploylib.ParallelSeq[Cluster.this.region.EC2Instance]">slaves</a>.<a href="../Concurrent.scala.html#12258" title="(f: Cluster.this.region.EC2Instance =&gt; Unit)Unit">pforeach</a><span class="delimiter">(</span><a href="#72816" title="Cluster.this.region.EC2Instance">_</a>.<a href="../RemoteMachine.scala.html#25747" title="(file: java.io.File, contents: String)Unit">appendFile</a><span class="delimiter">(</span><span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/$HOME/.ssh/authorized_keys&quot;)" class="string">&quot;/$HOME/.ssh/authorized_keys&quot;</span><span class="delimiter">)</span>, <a href="#72790" title="String">key</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Tail stdout of the most recently started framework on all slaves and print the output to stdout of the local machine.
   * Used for debugging.
   */</span>
  <span class="keyword">def</span> <a title="=&gt; Unit" id="69048">tailSlaveLogs</a>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.io.File" id="72823">workDir</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/mnt/work&quot;)" class="string">&quot;/mnt/work&quot;</span><span class="delimiter">)</span>
    <a href="../package.scala.html#9838" title="(itr: Iterable[Cluster.this.region.EC2Instance])deploylib.ParallelSeq[Cluster.this.region.EC2Instance]">slaves</a>.<a href="../Concurrent.scala.html#12252" title="(f: Cluster.this.region.EC2Instance =&gt; (Cluster.this.region.EC2Instance, java.io.File))List[(Cluster.this.region.EC2Instance, java.io.File)]">pmap</a><span class="delimiter">(</span><a title="Cluster.this.region.EC2Instance" id="72857">s</a> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.io.File" id="72858">currentSlaveDir</a> = <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#72823" title="java.io.File">workDir</a>, <a href="#72857" title="Cluster.this.region.EC2Instance">s</a>.<a href="../RemoteMachine.scala.html#25762" title="(dir: java.io.File)Seq[s.RemoteFile]">ls</a><span class="delimiter">(</span><a href="#72823" title="java.io.File">workDir</a><span class="delimiter">)</span>.<span title="(f: s.RemoteFile =&gt; String)(implicit ord: scala.math.Ordering[String])Seq[s.RemoteFile]">sortBy</span><span title="object scala.math.Ordering.String" class="delimiter">(</span><a href="#73167" title="s.RemoteFile">_</a>.<a href="../RemoteMachine.scala.html#31414" title="=&gt; String">modDate</a><span class="delimiter">)</span>.<span title="=&gt; s.RemoteFile">last</span>.<a href="../RemoteMachine.scala.html#31408" title="=&gt; String">name</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.io.File" id="72859">currentFrameworkDir</a> = <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#72858" title="java.io.File">currentSlaveDir</a>, <a href="#72857" title="Cluster.this.region.EC2Instance">s</a>.<a href="../RemoteMachine.scala.html#25762" title="(dir: java.io.File)Seq[s.RemoteFile]">ls</a><span class="delimiter">(</span><a href="#72858" title="java.io.File">currentSlaveDir</a><span class="delimiter">)</span>.<span title="=&gt; s.RemoteFile">head</span>.<a href="../RemoteMachine.scala.html#31408" title="=&gt; String">name</a><span class="delimiter">)</span>
      <span title="(_1: Cluster.this.region.EC2Instance, _2: java.io.File)(Cluster.this.region.EC2Instance, java.io.File)" class="delimiter">(</span><a href="#72857" title="Cluster.this.region.EC2Instance">s</a>, <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#72859" title="java.io.File">currentFrameworkDir</a>, <span title="java.lang.String(&quot;0/stdout&quot;)" class="string">&quot;0/stdout&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>.<span title="(f: (Cluster.this.region.EC2Instance, java.io.File) =&gt; Unit)Unit">foreach</span> <a href="#74178" title="Unit" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="Unit" class="delimiter">(</span><a title="Cluster.this.region.EC2Instance" id="74181">s</a>, <a title="java.io.File" id="74182">l</a><span class="delimiter">)</span> =&gt; <a href="#74181" title="Cluster.this.region.EC2Instance">s</a>.<a href="../RemoteMachine.scala.html#25754" title="(remoteFile: java.io.File)Unit">watch</a><span class="delimiter">(</span><a href="#74182" title="java.io.File">l</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>