<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>mesos/ServiceScheduler.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> deploylib
<span class="keyword">package</span> mesos

<span class="keyword">import</span> org.apache.mesos._
<span class="keyword">import</span> org.apache.mesos.<span title="object org.apache.mesos.Protos">Protos</span>._
<span class="keyword">import</span> com.google.protobuf.ByteString

<span class="keyword">import</span> edu.berkeley.cs.scads.comm._

<span class="keyword">import</span> java.io.File
<span class="keyword">import</span> net.lag.logging.Logger

<span class="keyword">import</span> scala.collection.mutable.<span class="delimiter">{</span>Buffer, ListBuffer<span class="delimiter">}</span>
<span class="keyword">import</span> scala.collection.<span title="object scala.collection.JavaConversions">JavaConversions</span>._

<span class="keyword">object</span> <a title="object deploylib.mesos.LocalExperimentScheduler" id="9653">LocalExperimentScheduler</a> <span title="ScalaObject" class="delimiter">{</span>
  <span title="object java.lang.System">System</span>.<span title="(x$1: java.lang.String)Unit">loadLibrary</span><span class="delimiter">(</span><span title="java.lang.String(&quot;mesos&quot;)" class="string">&quot;mesos&quot;</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(name: String, mesosMaster: String, executor: String)deploylib.mesos.LocalExperimentScheduler" id="74255">apply</a><span class="delimiter">(</span><a title="String" id="74257">name</a>: <span title="String">String</span>, <a title="String" id="74262">mesosMaster</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;1@&quot;)" class="string">&quot;1@&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> java.net.<span title="object java.net.InetAddress">InetAddress</span>.<span title="()java.net.InetAddress">getLocalHost</span>.<span title="()java.lang.String">getHostAddress</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;:5050&quot;)" class="string">&quot;:5050&quot;</span>, <a title="String" id="74263">executor</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;/usr/local/mesos/frameworks/deploylib/java_executor&quot;)" class="string">&quot;/usr/local/mesos/frameworks/deploylib/java_executor&quot;</span><span class="delimiter">)</span> =
    <span title="deploylib.mesos.LocalExperimentScheduler" class="keyword">new</span> <a href="#9656" title="deploylib.mesos.LocalExperimentScheduler">LocalExperimentScheduler</a><span class="delimiter">(</span><a href="#74257" title="String">name</a>, <a href="#74262" title="String">mesosMaster</a>, <a href="#74263" title="String">executor</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">abstract</span> <span class="keyword">trait</span> <a title="trait ExperimentScheduler extends java.lang.Object" id="9655">ExperimentScheduler</a> <span title="java.lang.Object" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(processes: Seq[edu.berkeley.cs.scads.comm.JvmTask])Unit" id="57902">scheduleExperiment</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.comm.JvmTask]" id="57917">processes</a>: <span title="Seq[edu.berkeley.cs.scads.comm.JvmTask]">Seq</span><span class="delimiter">[</span>JvmTask<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class LocalExperimentScheduler extends java.lang.Object with org.apache.mesos.Scheduler with deploylib.mesos.ExperimentScheduler with ScalaObject" id="9656">LocalExperimentScheduler</a> <a href="#9656" title="ScalaObject" class="keyword">protected</a> <span class="delimiter">(</span><a title="String" id="58157">name</a>: <span title="String">String</span>, <a title="String" id="58158">mesosMaster</a>: <span title="String">String</span>, <a title="String" id="58159">executor</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="org.apache.mesos.Scheduler">Scheduler</span> <span class="keyword">with</span> <a href="#9655" title="deploylib.mesos.ExperimentScheduler">ExperimentScheduler</a> <span class="delimiter">{</span>
  <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="58102">logger</a> = <span title="()net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">var</span> <a title="Int" id="58105">taskId</a> = <span title="Int(0)" class="int">0</span>
  <span class="keyword">var</span> <a title="org.apache.mesos.MesosSchedulerDriver" id="58108">driver</a> = <span title="(x$1: org.apache.mesos.Scheduler, x$2: java.lang.String)org.apache.mesos.MesosSchedulerDriver" class="keyword">new</span> <span title="org.apache.mesos.MesosSchedulerDriver">MesosSchedulerDriver</span><span class="delimiter">(</span><a href="#9656" title="deploylib.mesos.LocalExperimentScheduler" class="keyword">this</a>, <a href="#58158" title="String">mesosMaster</a><span class="delimiter">)</span>

  case <span class="keyword">class</span> <a title="class Experiment extends java.lang.Object with ScalaObject with Product with Serializable" id="74445">Experiment</a><a href="#74445" title="ScalaObject" class="delimiter">(</a><span class="keyword">var</span> <a title="Seq[edu.berkeley.cs.scads.comm.JvmTask]" id="76301">processes</a>: <span title="Seq[edu.berkeley.cs.scads.comm.JvmTask]">Seq</span><span class="delimiter">[</span>JvmTask<span class="delimiter">]</span><span class="delimiter">)</span>
  <span class="keyword">var</span> <a title="java.util.concurrent.ConcurrentLinkedQueue[LocalExperimentScheduler.this.Experiment]" id="58114">outstandingExperiments</a> = <span title="java.util.concurrent.ConcurrentLinkedQueue[LocalExperimentScheduler.this.Experiment]" class="keyword">new</span> java.util.concurrent.<span title="java.util.concurrent.ConcurrentLinkedQueue[LocalExperimentScheduler.this.Experiment]">ConcurrentLinkedQueue</span><span class="delimiter">[</span>Experiment<span class="delimiter">]</span>
  <span class="keyword">var</span> <a title="List[edu.berkeley.cs.scads.comm.JvmTask]" id="58117">awaitingSiblings</a> = List<span class="delimiter">[</span>JvmTask<span class="delimiter">]</span><span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">var</span> <a title="List[org.apache.mesos.Protos.TaskID]" id="58120">taskIds</a> = List<span class="delimiter">[</span>TaskID<span class="delimiter">]</span><span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">var</span> <a title="List[List[org.apache.mesos.Protos.TaskID]]" id="58123">scheduledExperiments</a> = List<span class="delimiter">[</span>List<span class="delimiter">[</span>TaskID<span class="delimiter">]</span><span class="delimiter">]</span><span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="java.lang.Thread" id="58125">driverThread</a> = <a href="#74512" title="java.lang.Thread" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Thread" id="74512">Thread</a><span class="delimiter">(</span><span title="java.lang.String(&quot;ExperimentScheduler Mesos Driver Thread&quot;)" class="string">&quot;ExperimentScheduler Mesos Driver Thread&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="74514">run</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#58108" title="=&gt; org.apache.mesos.MesosSchedulerDriver">driver</a>.<span title="()Int">run</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span>
  <a href="#58125" title="=&gt; java.lang.Thread">driverThread</a>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(processes: Seq[edu.berkeley.cs.scads.comm.JvmTask])Unit" id="58127">scheduleExperiment</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.comm.JvmTask]" id="58374">processes</a>: <span title="Seq[edu.berkeley.cs.scads.comm.JvmTask]">Seq</span><span class="delimiter">[</span>JvmTask<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#9656" title="(x$1: Boolean)Boolean">synchronized</a> <span title="Unit" class="delimiter">{</span>
    <a href="#58114" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[LocalExperimentScheduler.this.Experiment]">outstandingExperiments</a>.<span title="(x$1: LocalExperimentScheduler.this.Experiment)Boolean">add</span><span class="delimiter">(</span><span title="LocalExperimentScheduler.this.Experiment" class="keyword">new</span> <a href="#74445" title="LocalExperimentScheduler.this.Experiment">Experiment</a><span class="delimiter">(</span><a href="#58374" title="Seq[edu.berkeley.cs.scads.comm.JvmTask]">processes</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(d: org.apache.mesos.SchedulerDriver)String" id="58128">getFrameworkName</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="74714">d</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span><span class="delimiter">)</span>: <span title="String">String</span> = <span title="java.lang.String(&quot;SCADS Service Framework: &quot;)" class="string">&quot;SCADS Service Framework: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#58157" title="String">name</a>
  <span class="keyword">val</span> <a title="org.apache.mesos.Protos.ExecutorID.Builder" id="58129">executorId</a> = <span title="object org.apache.mesos.Protos.ExecutorID">ExecutorID</span>.<span title="()org.apache.mesos.Protos.ExecutorID.Builder">newBuilder</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)org.apache.mesos.Protos.ExecutorID.Builder">setValue</span><span class="delimiter">(</span><span title="java.lang.String(&quot;javaExecutor&quot;)" class="string">&quot;javaExecutor&quot;</span><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(d: org.apache.mesos.SchedulerDriver)org.apache.mesos.Protos.ExecutorInfo" id="58131">getExecutorInfo</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="74716">d</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span><span class="delimiter">)</span>: <span title="org.apache.mesos.Protos.ExecutorInfo">ExecutorInfo</span> = <span title="object org.apache.mesos.Protos.ExecutorInfo">ExecutorInfo</span>.<span title="()org.apache.mesos.Protos.ExecutorInfo.Builder">newBuilder</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)org.apache.mesos.Protos.ExecutorInfo.Builder">setUri</span><span class="delimiter">(</span><a href="#58159" title="String">executor</a><span class="delimiter">)</span>.<span title="(x$1: org.apache.mesos.Protos.ExecutorID.Builder)org.apache.mesos.Protos.ExecutorInfo.Builder">setExecutorId</span><span class="delimiter">(</span><a href="#58129" title="=&gt; org.apache.mesos.Protos.ExecutorID.Builder">executorId</a><span class="delimiter">)</span>.<span title="()org.apache.mesos.Protos.ExecutorInfo">build</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(d: org.apache.mesos.SchedulerDriver, fid: org.apache.mesos.Protos.FrameworkID)Unit" id="58132">registered</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="74968">d</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span>, <a title="org.apache.mesos.Protos.FrameworkID" id="74969">fid</a>: <span title="org.apache.mesos.Protos.FrameworkID">FrameworkID</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#58102" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Registered SCADS Framework.  Fid: &quot;)" class="string">&quot;Registered SCADS Framework.  Fid: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#74969" title="org.apache.mesos.Protos.FrameworkID">fid</a><span class="delimiter">)</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(task: edu.berkeley.cs.scads.comm.JvmTask)String" id="58133">taskDescription</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.JvmTask" id="58297">task</a>: <span title="edu.berkeley.cs.scads.comm.JvmTask">JvmTask</span><span class="delimiter">)</span>: <span title="String">String</span> = <a href="#58297" title="edu.berkeley.cs.scads.comm.JvmTask">task</a> <span title="String" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a title="java.lang.String" id="74973">j</a>:<span title="edu.berkeley.cs.scads.comm.JvmMainTask">JvmMainTask</span> =&gt; <span class="delimiter">(</span><a href="#74973" title="edu.berkeley.cs.scads.comm.JvmMainTask">j</a>.<span title="=&gt; String">mainclass</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#74973" title="edu.berkeley.cs.scads.comm.JvmMainTask">j</a>.<span title="=&gt; Seq[String]">args</span><span class="delimiter">)</span>.<span title="(x$1: java.lang.String, x$2: java.lang.String)java.lang.String">replaceAll</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\&quot;&quot;)" class="string">&quot;\&quot;&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span class="comment">//HACK around bug in Mesos web ui...</span>
    <span class="keyword">case</span> <a title="java.lang.String" id="74974">j</a>:<span title="edu.berkeley.cs.scads.comm.JvmWebAppTask">JvmWebAppTask</span> =&gt; <a href="#74974" title="edu.berkeley.cs.scads.comm.JvmWebAppTask">j</a>.<span title="=&gt; edu.berkeley.cs.scads.comm.ClassSource">warFile</span>.<span title="()java.lang.String">toString</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(d: org.apache.mesos.SchedulerDriver, oid: org.apache.mesos.Protos.OfferID, offers: java.util.List[org.apache.mesos.Protos.SlaveOffer])Unit" id="58134">resourceOffer</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="74976">d</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span>, <a title="org.apache.mesos.Protos.OfferID" id="74977">oid</a>: <span title="org.apache.mesos.Protos.OfferID">OfferID</span>, <a title="java.util.List[org.apache.mesos.Protos.SlaveOffer]" id="74978">offers</a>: java.util.<span title="java.util.List[org.apache.mesos.Protos.SlaveOffer]">List</span><span class="delimiter">[</span>SlaveOffer<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#58117" title="=&gt; List[edu.berkeley.cs.scads.comm.JvmTask]">awaitingSiblings</a>.<span title="(x$1: Int)Int">synchronized</span> <span title="Unit" class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.util.LinkedList[org.apache.mesos.Protos.TaskDescription]" id="75126">tasks</a> = <span title="java.util.LinkedList[org.apache.mesos.Protos.TaskDescription]" class="keyword">new</span> java.util.<span title="java.util.LinkedList[org.apache.mesos.Protos.TaskDescription]">LinkedList</span><span class="delimiter">[</span>TaskDescription<span class="delimiter">]</span>

    <span title="Unit" class="keyword">while</span><span class="delimiter">(</span><a href="#74978" title="java.util.List[org.apache.mesos.Protos.SlaveOffer]">offers</a>.<span title="()Int">size</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#58114" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[LocalExperimentScheduler.this.Experiment]">outstandingExperiments</a>.<span title="()LocalExperimentScheduler.this.Experiment">peek</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#75127" title="()Unit" class="delimiter">{</a>
      <span class="keyword">val</span> <a title="LocalExperimentScheduler.this.Experiment" id="75481">currentExperiment</a> = <a href="#58114" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[LocalExperimentScheduler.this.Experiment]">outstandingExperiments</a>.<span title="()LocalExperimentScheduler.this.Experiment">peek</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.comm.JvmTask]" id="75482">scheduleNow</a> = <a href="#75481" title="LocalExperimentScheduler.this.Experiment">currentExperiment</a>.<a href="#76301" title="=&gt; Seq[edu.berkeley.cs.scads.comm.JvmTask]">processes</a>.<span title="(n: Int)Seq[edu.berkeley.cs.scads.comm.JvmTask]">take</span><span class="delimiter">(</span><a href="#74978" title="java.util.List[org.apache.mesos.Protos.SlaveOffer]">offers</a>.<span title="()Int">size</span><span class="delimiter">)</span>
      <a href="#75482" title="Seq[edu.berkeley.cs.scads.comm.JvmTask]">scheduleNow</a>.<span title="(n: Int)Seq[edu.berkeley.cs.scads.comm.JvmTask]">take</span><span class="delimiter">(</span><a href="#74978" title="java.util.List[org.apache.mesos.Protos.SlaveOffer]">offers</a>.<span title="()Int">size</span><span class="delimiter">)</span>.<span title="(f: edu.berkeley.cs.scads.comm.JvmTask =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.JvmTask" id="75509">proc</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="org.apache.mesos.Protos.SlaveOffer" id="75510">offer</a> = <a href="#74978" title="java.util.List[org.apache.mesos.Protos.SlaveOffer]">offers</a>.<span title="(x$1: Int)org.apache.mesos.Protos.SlaveOffer">remove</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
	<span class="keyword">val</span> <a title="String" id="75511">taskDesc</a> = <a href="#58133" title="(task: edu.berkeley.cs.scads.comm.JvmTask)String">taskDescription</a><span class="delimiter">(</span><a href="#75509" title="edu.berkeley.cs.scads.comm.JvmTask">proc</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="org.apache.mesos.Protos.TaskID" id="75512">curId</a> = <span title="object org.apache.mesos.Protos.TaskID">TaskID</span>.<span title="()org.apache.mesos.Protos.TaskID.Builder">newBuilder</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)org.apache.mesos.Protos.TaskID.Builder">setValue</span><span class="delimiter">(</span><a href="#58105" title="=&gt; Int">taskId</a>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span>.<span title="()org.apache.mesos.Protos.TaskID">build</span>
        <span class="keyword">val</span> <a title="org.apache.mesos.Protos.TaskDescription" id="75513">task</a> = <span title="object org.apache.mesos.Protos.TaskDescription">TaskDescription</span>.<span title="()org.apache.mesos.Protos.TaskDescription.Builder">newBuilder</span><span class="delimiter">(</span><span class="delimiter">)</span>
                                  .<span title="(x$1: org.apache.mesos.Protos.TaskID)org.apache.mesos.Protos.TaskDescription.Builder">setTaskId</span><span class="delimiter">(</span><a href="#75512" title="org.apache.mesos.Protos.TaskID">curId</a><span class="delimiter">)</span>
                                  .<span title="(x$1: org.apache.mesos.Protos.SlaveID)org.apache.mesos.Protos.TaskDescription.Builder">setSlaveId</span><span class="delimiter">(</span><a href="#75510" title="org.apache.mesos.Protos.SlaveOffer">offer</a>.<span title="()org.apache.mesos.Protos.SlaveID">getSlaveId</span><span class="delimiter">)</span>
                                  .<span title="(x$1: java.lang.Iterable[_ &lt;: org.apache.mesos.Protos.Resource])org.apache.mesos.Protos.TaskDescription.Builder">addAllResources</span><span class="delimiter">(</span><a href="#75510" title="org.apache.mesos.Protos.SlaveOffer">offer</a>.<span title="()java.util.List[org.apache.mesos.Protos.Resource]">getResourcesList</span><span class="delimiter">)</span>
                                  .<span title="(x$1: java.lang.String)org.apache.mesos.Protos.TaskDescription.Builder">setName</span><span class="delimiter">(</span><a href="#75511" title="String">taskDesc</a><span class="delimiter">)</span>
                                  .<span title="(x$1: com.google.protobuf.ByteString)org.apache.mesos.Protos.TaskDescription.Builder">setData</span><span class="delimiter">(</span><span title="object com.google.protobuf.ByteString">ByteString</span>.<span title="(x$1: Array[Byte])com.google.protobuf.ByteString">copyFrom</span><span class="delimiter">(</span><a href="Util.scala.html#66450" title="(task: edu.berkeley.cs.scads.comm.JvmTask)Array[Byte]">JvmTask</a><span class="delimiter">(</span><a href="#75509" title="edu.berkeley.cs.scads.comm.JvmTask">proc</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                                  .<span title="()org.apache.mesos.Protos.TaskDescription">build</span><span class="delimiter">(</span><span class="delimiter">)</span>

        <a href="#58102" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Scheduling task %d: %s&quot;)" class="string">&quot;Scheduling task %d: %s&quot;</span>, <a href="#58105" title="=&gt; Int">taskId</a>, <a href="#75511" title="String">taskDesc</a><span class="delimiter">)</span>
        <a href="#58120" title="(x$1: List[org.apache.mesos.Protos.TaskID])Unit">taskIds</a> <span title="(x: org.apache.mesos.Protos.TaskID)List[org.apache.mesos.Protos.TaskID]">::=</span> <a href="#75512" title="org.apache.mesos.Protos.TaskID">curId</a>
        <a href="#58102" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Assigning task %d to slave %s on %s&quot;)" class="string">&quot;Assigning task %d to slave %s on %s&quot;</span>, <a href="#58105" title="=&gt; Int">taskId</a>, <a href="#75510" title="org.apache.mesos.Protos.SlaveOffer">offer</a>.<span title="()org.apache.mesos.Protos.SlaveID">getSlaveId</span>, <a href="#75510" title="org.apache.mesos.Protos.SlaveOffer">offer</a>.<span title="()java.lang.String">getHostname</span><span class="delimiter">)</span>
        <a href="#58105" title="(x$1: Int)Unit">taskId</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
        <a href="#75126" title="java.util.LinkedList[org.apache.mesos.Protos.TaskDescription]">tasks</a>.<span title="(x$1: org.apache.mesos.Protos.TaskDescription)Boolean">add</span><span class="delimiter">(</span><a href="#75513" title="org.apache.mesos.Protos.TaskDescription">task</a><span class="delimiter">)</span>

        <a href="#58117" title="(x$1: List[edu.berkeley.cs.scads.comm.JvmTask])Unit">awaitingSiblings</a> <span title="(x: edu.berkeley.cs.scads.comm.JvmTask)List[edu.berkeley.cs.scads.comm.JvmTask]">::=</span> <a href="#75509" title="edu.berkeley.cs.scads.comm.JvmTask">proc</a>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <a href="#75481" title="LocalExperimentScheduler.this.Experiment">currentExperiment</a>.<a href="#76301" title="(x$1: Seq[edu.berkeley.cs.scads.comm.JvmTask])Unit">processes</a> = <a href="#75481" title="LocalExperimentScheduler.this.Experiment">currentExperiment</a>.<a href="#76301" title="=&gt; Seq[edu.berkeley.cs.scads.comm.JvmTask]">processes</a>.<span title="(n: Int)Seq[edu.berkeley.cs.scads.comm.JvmTask]">drop</span><span class="delimiter">(</span><a href="#75482" title="Seq[edu.berkeley.cs.scads.comm.JvmTask]">scheduleNow</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#75481" title="LocalExperimentScheduler.this.Experiment">currentExperiment</a>.<a href="#76301" title="=&gt; Seq[edu.berkeley.cs.scads.comm.JvmTask]">processes</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#58114" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[LocalExperimentScheduler.this.Experiment]">outstandingExperiments</a>.<span title="()LocalExperimentScheduler.this.Experiment">poll</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#58102" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Experiment Scheduled. Size: %d&quot;)" class="string">&quot;Experiment Scheduled. Size: %d&quot;</span>, <a href="#58117" title="=&gt; List[edu.berkeley.cs.scads.comm.JvmTask]">awaitingSiblings</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
        <a href="#58123" title="(x$1: List[List[org.apache.mesos.Protos.TaskID]])Unit">scheduledExperiments</a> <span title="(x: List[org.apache.mesos.Protos.TaskID])List[List[org.apache.mesos.Protos.TaskID]]">::=</span> <a href="#58120" title="=&gt; List[org.apache.mesos.Protos.TaskID]">taskIds</a>
        <a href="#58120" title="(x$1: List[org.apache.mesos.Protos.TaskID])Unit">taskIds</a> = List<span class="delimiter">[</span>TaskID<span class="delimiter">]</span><span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#58117" title="(x$1: List[edu.berkeley.cs.scads.comm.JvmTask])Unit">awaitingSiblings</a> = List<span class="delimiter">[</span>JvmTask<span class="delimiter">]</span><span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#58102" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Scheduled %d of %d processes&quot;)" class="string">&quot;Scheduled %d of %d processes&quot;</span>, <a href="#58117" title="=&gt; List[edu.berkeley.cs.scads.comm.JvmTask]">awaitingSiblings</a>.<span title="=&gt; Int">size</span>, <a href="#58117" title="=&gt; List[edu.berkeley.cs.scads.comm.JvmTask]">awaitingSiblings</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">+</span> <a href="#75481" title="LocalExperimentScheduler.this.Experiment">currentExperiment</a>.<a href="#76301" title="=&gt; Seq[edu.berkeley.cs.scads.comm.JvmTask]">processes</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <a href="#74976" title="org.apache.mesos.SchedulerDriver">d</a>.<span title="(x$1: org.apache.mesos.Protos.OfferID, x$2: java.util.Collection[org.apache.mesos.Protos.TaskDescription], x$3: java.util.Map[java.lang.String,java.lang.String])Int">replyToOffer</span><span class="delimiter">(</span><a href="#74977" title="org.apache.mesos.Protos.OfferID">oid</a>, <a href="#75126" title="java.util.LinkedList[org.apache.mesos.Protos.TaskDescription]">tasks</a>, <span title="[A, B](elems: (A, B)*)scala.collection.immutable.Map[A,B]">Map</span><span title="(elems: (String, String)*)scala.collection.immutable.Map[String,String]" class="delimiter">[</span><span title="String">String</span>,<span title="String">String</span><span class="delimiter">]</span><span title="(m: scala.collection.Map[String,String])java.util.Map[String,String]" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(d: org.apache.mesos.SchedulerDriver, status: org.apache.mesos.Protos.TaskStatus)Unit" id="58135">statusUpdate</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="75925">d</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span>, <a title="org.apache.mesos.Protos.TaskStatus" id="75926">status</a>: <span title="org.apache.mesos.Protos.TaskStatus">TaskStatus</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
	<span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#75926" title="org.apache.mesos.Protos.TaskStatus">status</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#58102" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Null status.&quot;)" class="string">&quot;Null status.&quot;</span><span class="delimiter">)</span>
	<span class="delimiter">}</span>
    <span class="keyword">else</span> <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#75926" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()org.apache.mesos.Protos.TaskState">getState</span> <span title="(x$1: AnyRef)Boolean">==</span> TaskState.<span title="org.apache.mesos.Protos.TaskState(value TASK_FAILED)">TASK_FAILED</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#58102" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Status Update for Task %s: %s&quot;)" class="string">&quot;Status Update for Task %s: %s&quot;</span>, <a href="#75926" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span>, <a href="#75926" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()org.apache.mesos.Protos.TaskState">getState</span><span class="delimiter">)</span>
      <a href="#58102" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(message: =&gt; AnyRef)Unit">ifWarning</span><span class="delimiter">(</span><span title="(x$1: Array[Byte])java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="#75926" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()com.google.protobuf.ByteString">getData</span>.<span title="()Array[Byte]">toByteArray</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="List[org.apache.mesos.Protos.TaskID]" id="75939">siblings</a> = <a href="#58123" title="=&gt; List[List[org.apache.mesos.Protos.TaskID]]">scheduledExperiments</a>.<span title="(p: List[org.apache.mesos.Protos.TaskID] =&gt; Boolean)Option[List[org.apache.mesos.Protos.TaskID]]">find</span><span class="delimiter">(</span><a href="#76197" title="List[org.apache.mesos.Protos.TaskID]">_</a> <span title="(elem: Any)Boolean">contains</span> <a href="#75926" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>.<span title="(default: =&gt; List[org.apache.mesos.Protos.TaskID])List[org.apache.mesos.Protos.TaskID]">getOrElse</span> <span class="delimiter">{</span>
        <a href="#58102" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Failed to locate siblings for task %s, can\'t kill stranded processes&quot;)" class="string">&quot;Failed to locate siblings for task %s, can't kill stranded processes&quot;</span>, <a href="#75926" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span>
      <span class="delimiter">}</span>
      <a href="#75939" title="List[org.apache.mesos.Protos.TaskID]">siblings</a>.<span title="(f: org.apache.mesos.Protos.TaskID =&gt; Int)Unit">foreach</span><span class="delimiter">(</span><a href="#75925" title="org.apache.mesos.SchedulerDriver">d</a>.<a href="#76237" title="(x$1: org.apache.mesos.Protos.TaskID)Int">killTask</a><span class="delimiter">)</span>
      <a href="#58102" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Killing Failed Experiment Siblings: %s&quot;)" class="string">&quot;Killing Failed Experiment Siblings: %s&quot;</span>, <a href="#75939" title="List[org.apache.mesos.Protos.TaskID]">siblings</a><span class="delimiter">)</span>
      <a href="#58123" title="(x$1: List[List[org.apache.mesos.Protos.TaskID]])Unit">scheduledExperiments</a> = <a href="#58123" title="=&gt; List[List[org.apache.mesos.Protos.TaskID]]">scheduledExperiments</a>.<span title="(p: List[org.apache.mesos.Protos.TaskID] =&gt; Boolean)List[List[org.apache.mesos.Protos.TaskID]]">filterNot</span><span class="delimiter">(</span><a href="#76248" title="List[org.apache.mesos.Protos.TaskID]">_</a> <span title="(that: Any)Boolean">equals</span> <a href="#75939" title="List[org.apache.mesos.Protos.TaskID]">siblings</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#58102" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Status Update for task %s: %s&quot;)" class="string">&quot;Status Update for task %s: %s&quot;</span>, <a href="#75926" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span>, <a href="#75926" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()org.apache.mesos.Protos.TaskState">getState</span><span class="delimiter">)</span>
      <a href="#58102" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(message: =&gt; AnyRef)Unit">ifDebug</span><span class="delimiter">(</span><span title="(x$1: Array[Byte])java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="#75926" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()com.google.protobuf.ByteString">getData</span>.<span title="()Array[Byte]">toByteArray</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Int" id="58136">stopDriver</a> = <a href="#58108" title="=&gt; org.apache.mesos.MesosSchedulerDriver">driver</a>.<span title="()Int">stop</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.SchedulerDriver, code: Int, message: String)Unit" id="58137">error</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="76263">driver</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span>, <a title="Int" id="76264">code</a>: <span title="Int">Int</span>, <a title="String" id="76265">message</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#58102" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;MESOS ERROR %d: %s&quot;)" class="string">&quot;MESOS ERROR %d: %s&quot;</span>, <a href="#76264" title="Int">code</a>, <a href="#76265" title="String">message</a><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.SchedulerDriver, slaveId: org.apache.mesos.Protos.SlaveID)Unit" id="58138">slaveLost</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="76271">driver</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span>, <a title="org.apache.mesos.Protos.SlaveID" id="76272">slaveId</a>: <span title="org.apache.mesos.Protos.SlaveID">SlaveID</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#58102" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;SLAVE LOST: %s&quot;)" class="string">&quot;SLAVE LOST: %s&quot;</span>, <a href="#76272" title="org.apache.mesos.Protos.SlaveID">slaveId</a><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.SchedulerDriver, slaveId: org.apache.mesos.Protos.SlaveID, executor: org.apache.mesos.Protos.ExecutorID, data: Array[Byte])Unit" id="58139">frameworkMessage</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="76278">driver</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span>, <a title="org.apache.mesos.Protos.SlaveID" id="76279">slaveId</a>: <span title="org.apache.mesos.Protos.SlaveID">SlaveID</span>, <a title="org.apache.mesos.Protos.ExecutorID" id="76280">executor</a>: <span title="org.apache.mesos.Protos.ExecutorID">ExecutorID</span>, <a title="Array[Byte]" id="76281">data</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#58102" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;FW Message: %s %s %s&quot;)" class="string">&quot;FW Message: %s %s %s&quot;</span>, <a href="#76279" title="org.apache.mesos.Protos.SlaveID">slaveId</a>, <a href="#76280" title="org.apache.mesos.Protos.ExecutorID">executor</a>, <span title="(x$1: Array[Byte])java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="#76281" title="Array[Byte]">data</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.SchedulerDriver, oid: org.apache.mesos.Protos.OfferID)Unit" id="58140">offerRescinded</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="76291">driver</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span>, <a title="org.apache.mesos.Protos.OfferID" id="76292">oid</a>: <span title="org.apache.mesos.Protos.OfferID">OfferID</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#58102" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Offer Rescinded: %s&quot;)" class="string">&quot;Offer Rescinded: %s&quot;</span>, <a href="#76292" title="org.apache.mesos.Protos.OfferID">oid</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>