<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>mesos/JavaExecutor.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> deploylib
<span class="keyword">package</span> mesos

<span class="keyword">import</span> java.net.URL

<span class="keyword">import</span> org.apache.commons.httpclient._
<span class="keyword">import</span> org.apache.commons.httpclient.methods._
<span class="keyword">import</span> net.lag.logging.Logger
<span class="keyword">import</span> net.lag.configgy.Configgy

<span class="keyword">import</span> ec2._
<span class="keyword">import</span> edu.berkeley.cs.avro.marker._
<span class="keyword">import</span> edu.berkeley.cs.scads.comm._

<span class="keyword">import</span> org.apache.mesos._
<span class="keyword">import</span> org.apache.mesos.<span title="object org.apache.mesos.Protos">Protos</span>._
<span class="keyword">import</span> com.google.protobuf.ByteString


<span class="keyword">import</span> java.io.<span class="delimiter">{</span> File, InputStream, BufferedReader, InputStreamReader, FileOutputStream <span class="delimiter">}</span>

<span class="keyword">import</span> scala.collection.<span title="object scala.collection.JavaConversions">JavaConversions</span>._
<span class="keyword">import</span> scala.util.Random

<span class="keyword">import</span> org.mortbay.jetty.Connector;
<span class="keyword">import</span> org.mortbay.jetty.<span class="delimiter">{</span>Server, Request<span class="delimiter">}</span>;
<span class="keyword">import</span> org.mortbay.jetty.nio.SelectChannelConnector;
<span class="keyword">import</span> org.mortbay.jetty.servlet.Context;
<span class="keyword">import</span> org.mortbay.jetty.servlet.ServletHolder;
<span class="keyword">import</span> org.mortbay.jetty.webapp.WebAppContext;
<span class="keyword">import</span> org.mortbay.jetty.handler.<span class="delimiter">{</span>ContextHandler, StatisticsHandler<span class="delimiter">}</span>
<span class="keyword">import</span> org.mortbay.jetty.handler.AbstractHandler
<span class="keyword">import</span> javax.servlet.http.<span class="delimiter">{</span>HttpServletResponse, HttpServletRequest<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object deploylib.mesos.JavaExecutor" id="9623">JavaExecutor</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(args: Array[String])Unit" id="59932">main</a><span class="delimiter">(</span><a title="Array[String]" id="59978">args</a>: <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="object java.lang.System">System</span>.<span title="(x$1: java.lang.String)Unit">loadLibrary</span><span class="delimiter">(</span><span title="java.lang.String(&quot;mesos&quot;)" class="string">&quot;mesos&quot;</span><span class="delimiter">)</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#59978" title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]">args</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Usage: JavaExecutor &lt;configFile&gt;&quot;)" class="string">&quot;Usage: JavaExecutor &lt;configFile&gt;&quot;</span><span class="delimiter">)</span>
      <span title="object java.lang.System">System</span>.<span title="(x$1: Int)Unit">exit</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span title="object net.lag.configgy.Configgy">Configgy</span>.<span title="(filename: String)Unit">configure</span><span class="delimiter">(</span><a href="#59978" title="(i: Int)String">args</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="org.apache.mesos.MesosExecutorDriver" id="59980">driver</a> = <span title="org.apache.mesos.MesosExecutorDriver" class="keyword">new</span> <span title="org.apache.mesos.MesosExecutorDriver">MesosExecutorDriver</span><span class="delimiter">(</span><span title="deploylib.mesos.JavaExecutor" class="keyword">new</span> <a href="#9625" title="deploylib.mesos.JavaExecutor">JavaExecutor</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#59980" title="org.apache.mesos.MesosExecutorDriver">driver</a>.<span title="()Int">run</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class JavaExecutor extends java.lang.Object with org.apache.mesos.Executor with ScalaObject" id="9625">JavaExecutor</a> <a href="#9625" title="ScalaObject" class="keyword">extends</a> <span title="org.apache.mesos.Executor">Executor</span> <span class="delimiter">{</span>
  <span class="keyword">val</span> <a title="net.lag.configgy.Config" id="59952">config</a> = <span title="object net.lag.configgy.Configgy">Configgy</span>.<span title="=&gt; net.lag.configgy.Config">config</span>
  <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="59954">logger</a> = <span title="()net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="org.apache.commons.httpclient.HttpClient" id="59956">httpClient</a> = <span title="org.apache.commons.httpclient.HttpClient" class="keyword">new</span> <span title="org.apache.commons.httpclient.HttpClient">HttpClient</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="java.io.File" id="59958">baseDir</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#59952" title="(key: String, defaultValue: String)String">config</a><span class="delimiter">(</span><span title="java.lang.String(&quot;javaexecutor.workdir&quot;)" class="string">&quot;javaexecutor.workdir&quot;</span>, <span title="java.lang.String(&quot;/tmp&quot;)" class="string">&quot;/tmp&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#59958" title="=&gt; java.io.File">baseDir</a>.<span title="()Boolean">exists</span><span class="delimiter">)</span> <a href="#59958" title="=&gt; java.io.File">baseDir</a>.<span title="()Boolean">mkdir</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="java.io.File" id="59960">jarCache</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#59952" title="(key: String, defaultValue: String)String">config</a><span class="delimiter">(</span><span title="java.lang.String(&quot;javaexecutor.jarcache&quot;)" class="string">&quot;javaexecutor.jarcache&quot;</span>, <span title="java.lang.String(&quot;/tmp/jarCache&quot;)" class="string">&quot;/tmp/jarCache&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#59960" title="=&gt; java.io.File">jarCache</a>.<span title="()Boolean">exists</span><span class="delimiter">)</span> <a href="#59960" title="=&gt; java.io.File">jarCache</a>.<span title="()Boolean">mkdir</span>

  <span class="comment">/* Keep a handle to all tasks that are running so we can kill it if needed later */</span>
  <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[String,JavaExecutor.this.RunningTask]" id="59962">runningTasks</a> = <span title="()scala.collection.mutable.HashMap[String,JavaExecutor.this.RunningTask]" class="keyword">new</span> scala.collection.mutable.<span title="scala.collection.mutable.HashMap[String,JavaExecutor.this.RunningTask]">HashMap</span><span class="delimiter">[</span>String, RunningTask<span class="delimiter">]</span>

  <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class RunningTask extends java.lang.Object with ScalaObject" id="59964">RunningTask</a> <a href="#59964" title="ScalaObject" class="delimiter">{</a>
    <span class="keyword">def</span> <a title="=&gt; Unit" id="60553">kill</a>: <span title="Unit">Unit</span>
  <span class="delimiter">}</span>

  <span class="keyword">class</span> <a title="class JettyApp extends JavaExecutor.this.RunningTask with ScalaObject" id="59965">JettyApp</a><a href="#59965" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="org.apache.mesos.Protos.TaskDescription" id="64470">taskDesc</a>: <span title="org.apache.mesos.Protos.TaskDescription">TaskDescription</span>, <span class="keyword">val</span> <a title="java.io.File" id="64471">warFile</a>: <span title="java.io.File">File</span>, <a title="Map[String,String]" id="64472">properties</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="org.apache.mesos.ExecutorDriver" id="64473">driver</a>: <span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#59964" title="JavaExecutor.this.RunningTask">RunningTask</a> <span class="delimiter">{</span>
    <span class="comment">/* Set the properies in the current JVM */</span>
    <a href="#64472" title="Map[String,String]">properties</a>.<span title="(f: (String, String) =&gt; java.lang.String)Unit">foreach</span> <a href="#64499" title="java.lang.String" class="delimiter">{</a> <span class="keyword">case</span> <span title="java.lang.String" class="delimiter">(</span><a title="String" id="64502">k</a>,<a title="String" id="64503">v</a><span class="delimiter">)</span> =&gt; <span title="object java.lang.System">System</span>.<span title="(x$1: java.lang.String, x$2: java.lang.String)java.lang.String">setProperty</span><span class="delimiter">(</span><a href="#64502" title="String">k</a>,<a href="#64503" title="String">v</a><span class="delimiter">)</span> <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="org.mortbay.jetty.Server" id="60568">server</a> = <span title="org.mortbay.jetty.Server" class="keyword">new</span> <span title="org.mortbay.jetty.Server">Server</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="org.mortbay.jetty.nio.SelectChannelConnector" id="60570">connector</a> = <span title="org.mortbay.jetty.nio.SelectChannelConnector" class="keyword">new</span> <span title="org.mortbay.jetty.nio.SelectChannelConnector">SelectChannelConnector</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#60570" title="=&gt; org.mortbay.jetty.nio.SelectChannelConnector">connector</a>.<span title="(x$1: Int)Unit">setPort</span><span class="delimiter">(</span><span title="object java.lang.Integer">Integer</span>.<span title="(x$1: java.lang.String, x$2: Int)java.lang.Integer">getInteger</span><span class="delimiter">(</span><span title="java.lang.String(&quot;jetty.port&quot;)" class="string">&quot;jetty.port&quot;</span>, <span title="Int(8080)" class="int">8080</span><span class="delimiter">)</span>.<span title="()Int">intValue</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#60568" title="=&gt; org.mortbay.jetty.Server">server</a>.<span title="(x$1: Array[org.mortbay.jetty.Connector])Unit">setConnectors</span><span class="delimiter">(</span><span title="[T](xs: T*)(implicit evidence$2: scala.reflect.ClassManifest[T])Array[T]">Array</span><span title="(xs: org.mortbay.jetty.Connector*)(implicit evidence$2: scala.reflect.ClassManifest[org.mortbay.jetty.Connector])Array[org.mortbay.jetty.Connector]" class="delimiter">[</span><span title="org.mortbay.jetty.Connector">Connector</span><span class="delimiter">]</span><span title="(clazz: java.lang.Class[_])scala.reflect.ClassManifest[org.mortbay.jetty.Connector]" class="delimiter">(</span><a href="#60570" title="=&gt; org.mortbay.jetty.nio.SelectChannelConnector">connector</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="org.mortbay.thread.QueuedThreadPool" id="60572">pool</a> = <span title="org.mortbay.thread.QueuedThreadPool" class="keyword">new</span> org.mortbay.thread.<span title="org.mortbay.thread.QueuedThreadPool">QueuedThreadPool</span>
    <a href="#59954" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Setting max thread pool size&quot;)" class="string">&quot;Setting max thread pool size&quot;</span><span class="delimiter">)</span>
    <a href="#60572" title="=&gt; org.mortbay.thread.QueuedThreadPool">pool</a>.<span title="(x$1: Int)Unit">setMaxThreads</span><span class="delimiter">(</span><span title="Int(5)" class="int">5</span><span class="delimiter">)</span>
    <a href="#60568" title="=&gt; org.mortbay.jetty.Server">server</a>.<span title="(x$1: org.mortbay.thread.ThreadPool)Unit">setThreadPool</span><span class="delimiter">(</span><a href="#60572" title="=&gt; org.mortbay.thread.QueuedThreadPool">pool</a><span class="delimiter">)</span>
    <a href="#59954" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;max pool size: %d&quot;)" class="string">&quot;max pool size: %d&quot;</span>,<a href="#60568" title="=&gt; org.mortbay.jetty.Server">server</a>.<span title="()org.mortbay.thread.ThreadPool">getThreadPool</span> <span title="Int" class="keyword">match</span> <span class="delimiter">{</span><span class="keyword">case</span> <a title="Int" id="64529">p</a>:org.mortbay.thread.<span title="org.mortbay.thread.QueuedThreadPool">QueuedThreadPool</span> =&gt; <a href="#64529" title="org.mortbay.thread.QueuedThreadPool">p</a>.<span title="()Int">getMaxThreads</span>; <span class="keyword">case</span> <span title="Int(-1)">_</span> =&gt; -<span title="Int(-1)" class="int">1</span><span class="delimiter">}</span><span class="delimiter">)</span>

    <span class="comment">/* Create context for webapp and wrap it with stats handler */</span>
    <span class="keyword">val</span> <a title="org.mortbay.jetty.handler.StatisticsHandler" id="60574">statsWebApp</a> = <span title="org.mortbay.jetty.handler.StatisticsHandler" class="keyword">new</span> <span title="org.mortbay.jetty.handler.StatisticsHandler">StatisticsHandler</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="org.mortbay.jetty.webapp.WebAppContext" id="60576">webapp</a> = <span title="org.mortbay.jetty.webapp.WebAppContext" class="keyword">new</span> <span title="org.mortbay.jetty.webapp.WebAppContext">WebAppContext</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#60576" title="=&gt; org.mortbay.jetty.webapp.WebAppContext">webapp</a>.<span title="(x$1: java.lang.String)Unit">setContextPath</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span class="delimiter">)</span>
    <a href="#60576" title="=&gt; org.mortbay.jetty.webapp.WebAppContext">webapp</a>.<span title="(x$1: java.lang.String)Unit">setWar</span><span class="delimiter">(</span><a href="#64471" title="=&gt; java.io.File">warFile</a>.<span title="()java.lang.String">getCanonicalPath</span><span class="delimiter">)</span>
    <a href="#60574" title="=&gt; org.mortbay.jetty.handler.StatisticsHandler">statsWebApp</a>.<span title="(x$1: org.mortbay.jetty.Handler)Unit">addHandler</span><span class="delimiter">(</span><a href="#60576" title="=&gt; org.mortbay.jetty.webapp.WebAppContext">webapp</a><span class="delimiter">)</span>

    @volatile <span class="keyword">var</span> <a title="Boolean" id="60579">running</a> = <span title="Boolean(true)" class="keyword">true</span>
    @volatile <span class="keyword">var</span> <a title="Double" id="60582">requestsPerSec</a> = <span title="Double(0.0)" class="double">0.0</span>
    @volatile <span class="keyword">var</span> <a title="Double" id="60585">cpuUtilization</a> = <span title="Double(0.0)" class="double">0.0</span>
    <span class="keyword">val</span> <a title="statsThread extends java.lang.Thread" id="60587">statsThread</a> = <a href="#62586" title="java.lang.Thread{val javaSysMon: com.jezhumble.javasysmon.JavaSysMon; def lastUsage: com.jezhumble.javasysmon.CpuTimes; def lastUsage_=(x$1: com.jezhumble.javasysmon.CpuTimes): Unit; def lastTime: Long; def lastTime_=(x$1: Long): Unit; def lastCount: Int; def lastCount_=(x$1: Int): Unit}" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Thread" id="62586">Thread</a><span class="delimiter">(</span><span title="java.lang.String(&quot;StatsThread&quot;)" class="string">&quot;StatsThread&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="com.jezhumble.javasysmon.JavaSysMon" id="62588">javaSysMon</a> = <span title="com.jezhumble.javasysmon.JavaSysMon" class="keyword">new</span> com.jezhumble.javasysmon.<span title="com.jezhumble.javasysmon.JavaSysMon">JavaSysMon</span>

      <span class="keyword">var</span> <a title="com.jezhumble.javasysmon.CpuTimes" id="62591">lastUsage</a> = <a href="#62588" title="=&gt; com.jezhumble.javasysmon.JavaSysMon">javaSysMon</a>.<span title="()com.jezhumble.javasysmon.CpuTimes">cpuTimes</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">var</span> <a title="Long" id="62594">lastTime</a> = <span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">var</span> <a title="Int" id="62597">lastCount</a> = <span title="Int(0)" class="int">0</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="62599">run</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
        <span title="Unit" class="keyword">while</span><span class="delimiter">(</span><a href="#60579" title="=&gt; Boolean">running</a><span class="delimiter">)</span> <a href="#62718" title="()Unit" class="delimiter">{</a>
          <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><span title="Long(30000L)" class="int">30000</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Long" id="62719">currentTime</a> = <span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Int" id="62720">currentCount</a> = <a href="#60574" title="=&gt; org.mortbay.jetty.handler.StatisticsHandler">statsWebApp</a>.<span title="()Int">getRequests</span><span class="delimiter">(</span><span class="delimiter">)</span>
	  <span class="keyword">val</span> <a title="com.jezhumble.javasysmon.CpuTimes" id="62721">cpuTimes</a> = <a href="#62588" title="=&gt; com.jezhumble.javasysmon.JavaSysMon">javaSysMon</a>.<span title="()com.jezhumble.javasysmon.CpuTimes">cpuTimes</span><span class="delimiter">(</span><span class="delimiter">)</span>

	  <a href="#60585" title="(x$1: Double)Unit">cpuUtilization</a> = <a href="#62721" title="com.jezhumble.javasysmon.CpuTimes">cpuTimes</a>.<span title="(x$1: com.jezhumble.javasysmon.CpuTimes)Float">getCpuUsage</span><span title="=&gt; Double" class="delimiter">(</span><a href="#62591" title="=&gt; com.jezhumble.javasysmon.CpuTimes">lastUsage</a><span class="delimiter">)</span>
	  <a href="#62591" title="(x$1: com.jezhumble.javasysmon.CpuTimes)Unit">lastUsage</a> = <a href="#62721" title="com.jezhumble.javasysmon.CpuTimes">cpuTimes</a>

          <a href="#60582" title="(x$1: Double)Unit">requestsPerSec</a> = <span class="delimiter">(</span><a href="#62720" title="Int">currentCount</a> <span title="(x: Int)Int">-</span> <a href="#62597" title="=&gt; Int">lastCount</a><span class="delimiter">)</span> <span title="=&gt; Double">/</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#62719" title="Long">currentTime</a> <span title="(x: Long)Long">-</span> <a href="#62594" title="=&gt; Long">lastTime</a><span class="delimiter">)</span> <span title="(x: Int)Long">/</span> <span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
          <a href="#59954" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Updating statistics at %d %d: %f&quot;)" class="string">&quot;Updating statistics at %d %d: %f&quot;</span>, <a href="#62719" title="Long">currentTime</a>, <a href="#62720" title="Int">currentCount</a>, <a href="#60582" title="=&gt; Double">requestsPerSec</a><span class="delimiter">)</span>
          <a href="#62594" title="(x$1: Long)Unit">lastTime</a> = <a href="#62719" title="Long">currentTime</a>
          <a href="#62597" title="(x$1: Int)Unit">lastCount</a> = <a href="#62720" title="Int">currentCount</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#60587" title="=&gt; java.lang.Thread{val javaSysMon: com.jezhumble.javasysmon.JavaSysMon; def lastUsage: com.jezhumble.javasysmon.CpuTimes; def lastUsage_=(x$1: com.jezhumble.javasysmon.CpuTimes): Unit; def lastTime: Long; def lastTime_=(x$1: Long): Unit; def lastCount: Int; def lastCount_=(x$1: Int): Unit}">statsThread</a>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="comment">/* Create a special context that reports /stats over http */</span>
    <span class="keyword">val</span> <a title="org.mortbay.jetty.handler.AbstractHandler" id="60589">statsHandler</a> = <a href="#62780" title="org.mortbay.jetty.handler.AbstractHandler" class="keyword">new</a> <a title="anonymous class $anon extends org.mortbay.jetty.handler.AbstractHandler" id="62780">AbstractHandler</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(target: String, request: javax.servlet.http.HttpServletRequest, response: javax.servlet.http.HttpServletResponse, dispatch: Int)Unit" id="62782">handle</a><span class="delimiter">(</span><a title="String" id="62783">target</a>: <span title="String">String</span>, <a title="javax.servlet.http.HttpServletRequest" id="62784">request</a>: <span title="javax.servlet.http.HttpServletRequest">HttpServletRequest</span>, <a title="javax.servlet.http.HttpServletResponse" id="62785">response</a>: <span title="javax.servlet.http.HttpServletResponse">HttpServletResponse</span>, <a title="Int" id="62786">dispatch</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>

        <a href="#62785" title="javax.servlet.http.HttpServletResponse">response</a>.<span title="(x$1: java.lang.String)Unit">setContentType</span><span class="delimiter">(</span><span title="java.lang.String(&quot;text/html&quot;)" class="string">&quot;text/html&quot;</span><span class="delimiter">)</span>
        <a href="#62785" title="javax.servlet.http.HttpServletResponse">response</a>.<span title="(x$1: Int)Unit">setStatus</span><span class="delimiter">(</span>HttpServletResponse.<span title="Int(200)">SC_OK</span><span class="delimiter">)</span>

        <span class="keyword">val</span> <a title="scala.xml.Elem" id="62908">statsXml</a> =
          &lt;<a title="scala.xml.Elem" id="63720">status</a>&gt;
            &lt;<a title="scala.xml.Elem" id="64029">CpuUtilization</a>&gt;
              <span class="delimiter">{</span><a href="#60585" title="=&gt; Double">cpuUtilization</a><span class="delimiter">}</span>
            &lt;/CpuUtilization&gt;
            &lt;<a title="scala.xml.Elem" id="64058">RequestRate</a>&gt;
              <span class="delimiter">{</span><a href="#60582" title="=&gt; Double">requestsPerSec</a><span class="delimiter">}</span>
            &lt;/RequestRate&gt;
            &lt;<a title="scala.xml.Elem" id="64059">RequestsTotal</a>&gt;
              <span class="delimiter">{</span><a href="#60574" title="=&gt; org.mortbay.jetty.handler.StatisticsHandler">statsWebApp</a>.<span title="()Int">getRequests</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">}</span>
            &lt;/RequestsTotal&gt;
          &lt;/status&gt;

        <a href="#62785" title="javax.servlet.http.HttpServletResponse">response</a>.<span title="()java.io.PrintWriter">getWriter</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)Unit">println</span><span class="delimiter">(</span><a href="#62908" title="scala.xml.Elem">statsXml</a>.<span title="()String">toString</span><span class="delimiter">)</span>
        <a href="#62784" title="javax.servlet.http.HttpServletRequest">request</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.mortbay.jetty.Request" class="delimiter">[</span><span title="org.mortbay.jetty.Request">Request</span><span class="delimiter">]</span>.<span title="(x$1: Boolean)Unit">setHandled</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="org.mortbay.jetty.handler.ContextHandler" id="60591">statsContext</a> = <span title="org.mortbay.jetty.handler.ContextHandler" class="keyword">new</span> <span title="org.mortbay.jetty.handler.ContextHandler">ContextHandler</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#60591" title="=&gt; org.mortbay.jetty.handler.ContextHandler">statsContext</a>.<span title="(x$1: java.lang.String)Unit">setContextPath</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/stats&quot;)" class="string">&quot;/stats&quot;</span><span class="delimiter">)</span>
    <a href="#60591" title="=&gt; org.mortbay.jetty.handler.ContextHandler">statsContext</a>.<span title="(x$1: org.mortbay.jetty.Handler)Unit">addHandler</span><span class="delimiter">(</span><a href="#60589" title="=&gt; org.mortbay.jetty.handler.AbstractHandler">statsHandler</a><span class="delimiter">)</span>

    <span class="comment">/* add both the webapp and the stats context to the running server */</span>
    <a href="#60568" title="=&gt; org.mortbay.jetty.Server">server</a>.<span title="(x$1: Array[org.mortbay.jetty.Handler])Unit">setHandlers</span><span class="delimiter">(</span><span title="(xs: org.mortbay.jetty.Handler*)(implicit evidence$2: scala.reflect.ClassManifest[org.mortbay.jetty.Handler])Array[org.mortbay.jetty.Handler]">Array</span><span title="(clazz: java.lang.Class[_])scala.reflect.ClassManifest[org.mortbay.jetty.Handler]" class="delimiter">(</span><a href="#60591" title="=&gt; org.mortbay.jetty.handler.ContextHandler">statsContext</a>, <a href="#60574" title="=&gt; org.mortbay.jetty.handler.StatisticsHandler">statsWebApp</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <a href="#60568" title="=&gt; org.mortbay.jetty.Server">server</a>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span title="Unit" class="keyword">while</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#60568" title="=&gt; org.mortbay.jetty.Server">server</a>.<span title="()Boolean">isRunning</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#64554" title="()Unit" class="delimiter">{</a>
      <a href="#59954" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Waiting for server to report isRunning == true&quot;)" class="string">&quot;Waiting for server to report isRunning == true&quot;</span><span class="delimiter">)</span>
      <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><span title="Long(1000L)" class="int">1000</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#64473" title="org.apache.mesos.ExecutorDriver">driver</a>.<span title="(x$1: org.apache.mesos.Protos.TaskStatus)Int">sendStatusUpdate</span><span class="delimiter">(</span>
      <span title="object org.apache.mesos.Protos.TaskStatus">TaskStatus</span>.<span title="()org.apache.mesos.Protos.TaskStatus.Builder">newBuilder</span><span class="delimiter">(</span><span class="delimiter">)</span>
                .<span title="(x$1: org.apache.mesos.Protos.TaskID)org.apache.mesos.Protos.TaskStatus.Builder">setTaskId</span><span class="delimiter">(</span><a href="#64470" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
                .<span title="(x$1: org.apache.mesos.Protos.TaskState)org.apache.mesos.Protos.TaskStatus.Builder">setState</span><span class="delimiter">(</span>TaskState.<span title="org.apache.mesos.Protos.TaskState(value TASK_RUNNING)">TASK_RUNNING</span><span class="delimiter">)</span>
                .<span title="()org.apache.mesos.Protos.TaskStatus">build</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; Unit" id="60593">kill</a> = <span class="delimiter">{</span>
      <a href="#60579" title="(x$1: Boolean)Unit">running</a> = <span title="Boolean(false)" class="keyword">false</span>
      <a href="#60568" title="=&gt; org.mortbay.jetty.Server">server</a>.<span title="()Unit">stop</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">class</span> <a title="class ForkedJvm extends JavaExecutor.this.RunningTask with java.lang.Runnable with ScalaObject" id="59966">ForkedJvm</a><a href="#59966" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="org.apache.mesos.Protos.TaskDescription" id="65550">taskDesc</a>: <span title="org.apache.mesos.Protos.TaskDescription">TaskDescription</span>, <span class="keyword">val</span> <a title="Int" id="65551">heapSize</a>: <span title="Int">Int</span>, <span class="keyword">val</span> <a title="String" id="65552">classpath</a>: <span title="String">String</span>, <span class="keyword">val</span> <a title="String" id="65553">mainClass</a>: <span title="String">String</span>, <span class="keyword">val</span> <a title="Seq[String]" id="65554">args</a>: <span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="Map[String,String]" id="65555">properties</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="Map[String,String]" id="65556">env</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="org.apache.mesos.ExecutorDriver" id="65557">driver</a>: <span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#59964" title="JavaExecutor.this.RunningTask">RunningTask</a> <span class="keyword">with</span> <span title="java.lang.Runnable">Runnable</span> <span class="delimiter">{</span>
     <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="64780">logger</a> = <span title="()net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#64780" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Requested memory: &quot;)" class="string">&quot;Requested memory: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#65551" title="=&gt; Int">heapSize</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="List[String]" id="64782">cmdLine</a> = <span title="[A](xs: A*)List[A]">List</span><span title="(xs: String*)List[String]" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/usr/bin/java&quot;)" class="string">&quot;/usr/bin/java&quot;</span>,
      <span title="java.lang.String(&quot;-server&quot;)" class="string">&quot;-server&quot;</span>,
      <span title="java.lang.String(&quot;-Xmx6G&quot;)" class="string">&quot;-Xmx6G&quot;</span>,<span class="comment">//HACK to deal with meoso not telling us the right amount of memory&quot;-Xmx&quot; + heapSize + &quot;M&quot;,</span>
      <span class="comment">//HACK to deal with mesos lying about available memory &quot;-Xms&quot; + heapSize + &quot;M&quot;,</span>
      <span title="java.lang.String(&quot;-XX:+HeapDumpOnOutOfMemoryError&quot;)" class="string">&quot;-XX:+HeapDumpOnOutOfMemoryError&quot;</span>,
      <span title="java.lang.String(&quot;-verbosegc&quot;)" class="string">&quot;-verbosegc&quot;</span>,
      <span title="java.lang.String(&quot;-XX:+UseConcMarkSweepGC&quot;)" class="string">&quot;-XX:+UseConcMarkSweepGC&quot;</span>,
      <span title="java.lang.String(&quot;-XX:MaxGCPauseMillis=200&quot;)" class="string">&quot;-XX:MaxGCPauseMillis=200&quot;</span>,
      <span title="java.lang.String(&quot;-Djava.library.path=&quot;)" class="string">&quot;-Djava.library.path=&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/usr/local/mesos/lib/java&quot;)" class="string">&quot;/usr/local/mesos/lib/java&quot;</span><span class="delimiter">)</span>,
      <a href="#65555" title="=&gt; Map[String,String]">properties</a>.<span title="(f: (String, String) =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[String,String],String,scala.collection.immutable.Iterable[String]])scala.collection.immutable.Iterable[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.Iterable.Coll,String,scala.collection.immutable.Iterable[String]]" class="delimiter">(</span><a title="(String, String)" id="64923">kv</a> =&gt; <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;-D%s=%s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#64923" title="(String, String)">kv</a>.<span title="=&gt; String">_1</span>, <a href="#64923" title="(String, String)">kv</a>.<span title="=&gt; String">_2</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span class="delimiter">)</span>,
      <span title="java.lang.String(&quot;-cp&quot;)" class="string">&quot;-cp&quot;</span>, <a href="#65552" title="=&gt; String">classpath</a>,
      <a href="#65553" title="=&gt; String">mainClass</a><span class="delimiter">)</span> <span title="(that: scala.collection.GenTraversableOnce[String])(implicit bf: scala.collection.generic.CanBuildFrom[List[String],String,List[String]])List[String]">++</span> <a href="#65554" title="=&gt; Seq[String]">args</a>

    <a href="#64780" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Execing: &quot;)" class="string">&quot;Execing: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#64782" title="=&gt; List[String]">cmdLine</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.io.File" id="64784">tempDir</a> = <a href="#59969" title="()java.io.File">newTempDir</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Array[String]" id="64786">envp</a> = <a href="#65556" title="Map[String,String]">env</a>.<span title="(f: (String, String) =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[String,String],String,scala.collection.immutable.Iterable[String]])scala.collection.immutable.Iterable[String]">map</span> <a href="#65103" title="String" class="delimiter">{</a> <span class="keyword">case</span> <span title="String" class="delimiter">(</span><a title="String" id="65106">key</a>, <a title="String" id="65107">value</a><span class="delimiter">)</span> =&gt; <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;%s=%s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#65106" title="String">key</a>, <a href="#65107" title="String">value</a><span class="delimiter">)</span> <span class="delimiter">}</span>.<span title="(implicit evidence$1: ClassManifest[String])Array[String]">toArray</span>
    <span class="keyword">val</span> <a title="java.lang.Process" id="64788">proc</a> = <span title="object java.lang.Runtime">Runtime</span>.<span title="()java.lang.Runtime">getRuntime</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: Array[java.lang.String], x$2: Array[java.lang.String], x$3: java.io.File)java.lang.Process">exec</span><span class="delimiter">(</span><a href="#64782" title="=&gt; List[String]">cmdLine</a>.<span title="(p: String =&gt; Boolean)List[String]">filter</span><span class="delimiter">(</span><a href="#65232" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">_</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<span title="(implicit evidence$1: ClassManifest[String])Array[String]">toArray</span>, <a href="#64786" title="=&gt; Array[String]">envp</a>, <a href="#64784" title="=&gt; java.io.File">tempDir</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="deploylib.mesos.StreamTailer" id="64790">stdout</a> = <a href="Util.scala.html#65539" title="deploylib.mesos.StreamTailer" class="keyword">new</a> <a href="Util.scala.html#9669" title="deploylib.mesos.StreamTailer">StreamTailer</a><span class="delimiter">(</span><a href="#64788" title="=&gt; java.lang.Process">proc</a>.<span title="()java.io.InputStream">getInputStream</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="deploylib.mesos.StreamTailer" id="64792">stderr</a> = <a href="Util.scala.html#65539" title="deploylib.mesos.StreamTailer" class="keyword">new</a> <a href="Util.scala.html#9669" title="deploylib.mesos.StreamTailer">StreamTailer</a><span class="delimiter">(</span><a href="#64788" title="=&gt; java.lang.Process">proc</a>.<span title="()java.io.InputStream">getErrorStream</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; Array[Byte]" id="64794">output</a> = <span title="(xs: java.lang.Object*)List[java.lang.Object]">List</span><span class="delimiter">(</span><a href="#64782" title="=&gt; List[String]">cmdLine</a>, <a href="#59966" title="JavaExecutor.this.ForkedJvm" class="keyword">this</a>, <span title="java.lang.String(&quot;===stdout===&quot;)" class="string">&quot;===stdout===&quot;</span>, <a href="#64790" title="=&gt; deploylib.mesos.StreamTailer">stdout</a>.<a href="Util.scala.html#65535" title="=&gt; String">tail</a>, <span title="java.lang.String(&quot;===stderr===&quot;)" class="string">&quot;===stderr===&quot;</span>, <a href="#64792" title="=&gt; deploylib.mesos.StreamTailer">stderr</a>.<a href="Util.scala.html#65535" title="=&gt; String">tail</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>.<span title="()Array[Byte]">getBytes</span>
    <span class="keyword">val</span> <a title="java.lang.Thread" id="64795">taskThread</a> = <span title="(x$1: java.lang.Runnable, x$2: java.lang.String)java.lang.Thread" class="keyword">new</span> <span title="java.lang.Thread">Thread</span><span class="delimiter">(</span><a href="#59966" title="JavaExecutor.this.ForkedJvm" class="keyword">this</a>, <span title="java.lang.String(&quot;Task &quot;)" class="string">&quot;Task &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#65550" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;Monitor&quot;)" class="string">&quot;Monitor&quot;</span><span class="delimiter">)</span>
    @volatile <span class="keyword">var</span> <a title="Boolean" id="64798">taskKilled</a> = <span title="Boolean(false)" class="keyword">false</span>
    <a href="#64795" title="=&gt; java.lang.Thread">taskThread</a>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="()Unit" id="64800">run</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="#65557" title="org.apache.mesos.ExecutorDriver">driver</a>.<span title="(x$1: org.apache.mesos.Protos.TaskStatus)Int">sendStatusUpdate</span><span class="delimiter">(</span>
        <span title="object org.apache.mesos.Protos.TaskStatus">TaskStatus</span>.<span title="()org.apache.mesos.Protos.TaskStatus.Builder">newBuilder</span><span class="delimiter">(</span><span class="delimiter">)</span>
          .<span title="(x$1: org.apache.mesos.Protos.TaskID)org.apache.mesos.Protos.TaskStatus.Builder">setTaskId</span><span class="delimiter">(</span><a href="#65550" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
          .<span title="(x$1: org.apache.mesos.Protos.TaskState)org.apache.mesos.Protos.TaskStatus.Builder">setState</span><span class="delimiter">(</span>TaskState.<span title="org.apache.mesos.Protos.TaskState(value TASK_RUNNING)">TASK_RUNNING</span><span class="delimiter">)</span>
          .<span title="(x$1: com.google.protobuf.ByteString)org.apache.mesos.Protos.TaskStatus.Builder">setData</span><span class="delimiter">(</span><span title="object com.google.protobuf.ByteString">ByteString</span>.<span title="(x$1: Array[Byte])com.google.protobuf.ByteString">copyFrom</span><span class="delimiter">(</span><a href="#64794" title="=&gt; Array[Byte]">output</a><span class="delimiter">)</span><span class="delimiter">)</span>
          .<span title="()org.apache.mesos.Protos.TaskStatus">build</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="Int" id="65655">result</a> = <a href="#64788" title="=&gt; java.lang.Process">proc</a>.<span title="()Int">waitFor</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#64780" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;TASK %s exitied with code %d&quot;)" class="string">&quot;TASK %s exitied with code %d&quot;</span>, <a href="#65550" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span>, <a href="#65655" title="Int">result</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="org.apache.mesos.Protos.TaskState" id="65656">finalTaskState</a> = <a href="#65655" title="Int">result</a> <span title="org.apache.mesos.Protos.TaskState" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="org.apache.mesos.Protos.TaskState(value TASK_FINISHED)" class="int">0</span> =&gt; TaskState.<span title="org.apache.mesos.Protos.TaskState(value TASK_FINISHED)">TASK_FINISHED</span>
        <span class="keyword">case</span> <span title="org.apache.mesos.Protos.TaskState(value TASK_FAILED)">_</span> =&gt; TaskState.<span title="org.apache.mesos.Protos.TaskState(value TASK_FAILED)">TASK_FAILED</span>
      <span class="delimiter">}</span>
      <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#64798" title="=&gt; Boolean">taskKilled</a><span class="delimiter">)</span>
        <a href="#65557" title="org.apache.mesos.ExecutorDriver">driver</a>.<span title="(x$1: org.apache.mesos.Protos.TaskStatus)Int">sendStatusUpdate</span><span class="delimiter">(</span>
          <span title="object org.apache.mesos.Protos.TaskStatus">TaskStatus</span>.<span title="()org.apache.mesos.Protos.TaskStatus.Builder">newBuilder</span><span class="delimiter">(</span><span class="delimiter">)</span>
            .<span title="(x$1: org.apache.mesos.Protos.TaskID)org.apache.mesos.Protos.TaskStatus.Builder">setTaskId</span><span class="delimiter">(</span><a href="#65550" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
            .<span title="(x$1: org.apache.mesos.Protos.TaskState)org.apache.mesos.Protos.TaskStatus.Builder">setState</span><span class="delimiter">(</span><a href="#65656" title="org.apache.mesos.Protos.TaskState">finalTaskState</a><span class="delimiter">)</span>
            .<span title="(x$1: com.google.protobuf.ByteString)org.apache.mesos.Protos.TaskStatus.Builder">setData</span><span class="delimiter">(</span><span title="object com.google.protobuf.ByteString">ByteString</span>.<span title="(x$1: Array[Byte])com.google.protobuf.ByteString">copyFrom</span><span class="delimiter">(</span><a href="#64794" title="=&gt; Array[Byte]">output</a><span class="delimiter">)</span><span class="delimiter">)</span>
            .<span title="()org.apache.mesos.Protos.TaskStatus">build</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <span title="Any" class="keyword">if</span><span class="delimiter">(</span><a href="#64790" title="=&gt; deploylib.mesos.StreamTailer">stdout</a>.<a href="Util.scala.html#65535" title="=&gt; String">tail</a> <span title="(x$1: java.lang.CharSequence)Boolean">contains</span> <span title="java.lang.String(&quot;A fatal error has been detected by the Java Runtime Environment&quot;)" class="string">&quot;A fatal error has been detected by the Java Runtime Environment&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#64780" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;SIGSEGV from forked JVM.  Killing node.&quot;)" class="string">&quot;SIGSEGV from forked JVM.  Killing node.&quot;</span><span class="delimiter">)</span>
        <span title="object java.lang.Runtime">Runtime</span>.<span title="()java.lang.Runtime">getRuntime</span>.<span title="(x$1: java.lang.String)java.lang.Process">exec</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/sbin/halt&quot;)" class="string">&quot;/sbin/halt&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#64780" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Cleaning up working directory %s for %s&quot;)" class="string">&quot;Cleaning up working directory %s for %s&quot;</span>, <a href="#64784" title="=&gt; java.io.File">tempDir</a>, <a href="#65550" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
      <a href="#59976" title="(f: java.io.File)Unit">deleteRecursive</a><span class="delimiter">(</span><a href="#64784" title="=&gt; java.io.File">tempDir</a><span class="delimiter">)</span>
      <a href="#64780" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Done cleaning up after Task %s&quot;)" class="string">&quot;Done cleaning up after Task %s&quot;</span>, <a href="#65550" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; Unit" id="64801">kill</a> = <span class="delimiter">{</span>
      <a href="#64780" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Killing Task %s&quot;)" class="string">&quot;Killing Task %s&quot;</span>, <a href="#65550" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
      <a href="#64798" title="(x$1: Boolean)Unit">taskKilled</a> = <span title="Boolean(true)" class="keyword">true</span>
      <a href="#64788" title="=&gt; java.lang.Process">proc</a>.<span title="()Unit">destroy</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(classSource: edu.berkeley.cs.scads.comm.ClassSource)java.io.File" id="59967">resolveClassSource</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.ClassSource" id="65818">classSource</a>: <span title="edu.berkeley.cs.scads.comm.ClassSource">ClassSource</span><span class="delimiter">)</span>: <span title="java.io.File">File</span> = <a href="#65818" title="edu.berkeley.cs.scads.comm.ClassSource">classSource</a> <span title="java.io.File" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="java.io.File">ServerSideJar</span><span class="delimiter">(</span><a title="String" id="65821">path</a><span class="delimiter">)</span> =&gt; <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#65821" title="String">path</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="java.io.File">S3CachedJar</span><span class="delimiter">(</span><a title="String" id="65827">urlString</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.net.URL" id="65828">jarUrl</a> = <span title="(x$1: java.lang.String)java.net.URL" class="keyword">new</span> <span title="java.net.URL">URL</span><span class="delimiter">(</span><a href="#65827" title="String">urlString</a><span class="delimiter">)</span>

      <span class="comment">//Note: this makes the assumption that the name of the file is the Md5 hash of the file.</span>
      <span class="keyword">var</span> <a title="java.lang.String" id="65829">jarMd5</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#65828" title="java.net.URL">jarUrl</a>.<span title="()java.lang.String">getFile</span><span class="delimiter">)</span>.<span title="()java.lang.String">getName</span>
      <span class="keyword">val</span> <a title="java.io.File" id="65830">cachedJar</a> = <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#59960" title="=&gt; java.io.File">jarCache</a>, <a href="#65829" title="java.lang.String">jarMd5</a><span class="delimiter">)</span>

      <span class="comment">//TODO: Locks incase there are multiple executors on a machine</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#65830" title="java.io.File">cachedJar</a>.<span title="()Boolean">exists</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <span title="=&gt; Boolean">!</span><span class="delimiter">(</span><a href="../Util.scala.html#9503" title="object deploylib.Util">Util</a>.<a href="../Util.scala.html#30854" title="(file: java.io.File)String">md5</a><span class="delimiter">(</span><a href="#65830" title="java.io.File">cachedJar</a><span class="delimiter">)</span> <span title="(x$1: Any)Boolean">equals</span> <a href="#65829" title="java.lang.String">jarMd5</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="org.apache.commons.httpclient.methods.GetMethod" id="65842">method</a> = <span title="(x$1: java.lang.String)org.apache.commons.httpclient.methods.GetMethod" class="keyword">new</span> <span title="org.apache.commons.httpclient.methods.GetMethod">GetMethod</span><span class="delimiter">(</span><a href="#65827" title="String">urlString</a><span class="delimiter">)</span>
        <a href="#59954" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Downloading %s&quot;)" class="string">&quot;Downloading %s&quot;</span>, <a href="#65827" title="String">urlString</a><span class="delimiter">)</span>
        <a href="#59956" title="=&gt; org.apache.commons.httpclient.HttpClient">httpClient</a>.<span title="(x$1: org.apache.commons.httpclient.HttpMethod)Int">executeMethod</span><span class="delimiter">(</span><a href="#65842" title="org.apache.commons.httpclient.methods.GetMethod">method</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="java.io.InputStream" id="65843">instream</a> = <a href="#65842" title="org.apache.commons.httpclient.methods.GetMethod">method</a>.<span title="()java.io.InputStream">getResponseBodyAsStream</span>
        <span class="keyword">val</span> <a title="java.io.FileOutputStream" id="65844">outstream</a> = <span title="(x$1: java.io.File)java.io.FileOutputStream" class="keyword">new</span> <span title="java.io.FileOutputStream">FileOutputStream</span><span class="delimiter">(</span><a href="#65830" title="java.io.File">cachedJar</a><span class="delimiter">)</span>

        <span class="keyword">var</span> <a title="Int" id="65845">x</a> = <a href="#65843" title="java.io.InputStream">instream</a>.<span title="()Int">read</span>
        <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#65845" title="Int">x</a> <span title="(x: Int)Boolean">!=</span> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <a href="#65846" title="()Unit" class="delimiter">{</a>
          <a href="#65844" title="java.io.FileOutputStream">outstream</a>.<span title="(x$1: Int)Unit">write</span><span class="delimiter">(</span><a href="#65845" title="Int">x</a><span class="delimiter">)</span>
          <a href="#65845" title="Int">x</a> = <a href="#65843" title="java.io.InputStream">instream</a>.<span title="()Int">read</span>
        <span class="delimiter">}</span>
        <a href="#65843" title="java.io.InputStream">instream</a>.<span title="()Unit">close</span>
        <a href="#65844" title="java.io.FileOutputStream">outstream</a>.<span title="()Unit">close</span>
        <a href="#59954" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Download of %s complete&quot;)" class="string">&quot;Download of %s complete&quot;</span>, <a href="#65827" title="String">urlString</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#65830" title="java.io.File">cachedJar</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(classSources: Seq[edu.berkeley.cs.scads.comm.ClassSource])String" id="59968">loadClasspath</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.comm.ClassSource]" id="66293">classSources</a>: <span title="Seq[edu.berkeley.cs.scads.comm.ClassSource]">Seq</span><span class="delimiter">[</span>ClassSource<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="String">String</span> = <a href="#66293" title="Seq[edu.berkeley.cs.scads.comm.ClassSource]">classSources</a>.<span title="(f: edu.berkeley.cs.scads.comm.ClassSource =&gt; java.io.File)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.comm.ClassSource],java.io.File,Seq[java.io.File]])Seq[java.io.File]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.io.File,Seq[java.io.File]]" class="delimiter">(</span><a href="#59967" title="(classSource: edu.berkeley.cs.scads.comm.ClassSource)java.io.File">resolveClassSource</a><span class="delimiter">)</span>.<span title="(f: java.io.File =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[java.io.File],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#66358" title="java.io.File">_</a>.<span title="()java.lang.String">getCanonicalPath</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span><span class="delimiter">)</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="()java.io.File" id="59969">newTempDir</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="java.io.File">File</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.io.File" id="66381">tempDir</a> = <span title="object java.io.File">File</span>.<span title="(x$1: java.lang.String, x$2: java.lang.String, x$3: java.io.File)java.io.File">createTempFile</span><span class="delimiter">(</span><span title="java.lang.String(&quot;workdir&quot;)" class="string">&quot;workdir&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <a href="#59958" title="=&gt; java.io.File">baseDir</a><span class="delimiter">)</span>
    <a href="#66381" title="java.io.File">tempDir</a>.<span title="()Boolean">delete</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#66381" title="java.io.File">tempDir</a>.<span title="()Boolean">mkdir</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#66381" title="java.io.File">tempDir</a>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(d: org.apache.mesos.ExecutorDriver, taskDesc: org.apache.mesos.Protos.TaskDescription)Unit" id="59970">launchTask</a><span class="delimiter">(</span><a title="org.apache.mesos.ExecutorDriver" id="66384">d</a>: <span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span>, <a title="org.apache.mesos.Protos.TaskDescription" id="66385">taskDesc</a>: <span title="org.apache.mesos.Protos.TaskDescription">TaskDescription</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#66384" title="org.apache.mesos.ExecutorDriver">d</a>.<span title="(x$1: org.apache.mesos.Protos.TaskStatus)Int">sendStatusUpdate</span><span class="delimiter">(</span>
      <span title="object org.apache.mesos.Protos.TaskStatus">TaskStatus</span>.<span title="()org.apache.mesos.Protos.TaskStatus.Builder">newBuilder</span><span class="delimiter">(</span><span class="delimiter">)</span>
        .<span title="(x$1: org.apache.mesos.Protos.TaskID)org.apache.mesos.Protos.TaskStatus.Builder">setTaskId</span><span class="delimiter">(</span><a href="#66385" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
        .<span title="(x$1: org.apache.mesos.Protos.TaskState)org.apache.mesos.Protos.TaskStatus.Builder">setState</span><span class="delimiter">(</span>TaskState.<span title="org.apache.mesos.Protos.TaskState(value TASK_STARTING)">TASK_STARTING</span><span class="delimiter">)</span>
        .<span title="()org.apache.mesos.Protos.TaskStatus">build</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Int" id="66387">launchDelay</a> = <span title="object scala.util.Random">Random</span>.<span title="(n: Int)Int">nextInt</span><span class="delimiter">(</span><span class="int">10</span> <span title="Int(10000)">*</span> <span class="int">1000</span><span class="delimiter">)</span>
    <a href="#59954" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Delaying startup %dms to avoid overloading zookeeper&quot;)" class="string">&quot;Delaying startup %dms to avoid overloading zookeeper&quot;</span>, <a href="#66387" title="Int">launchDelay</a><span class="delimiter">)</span>
    <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><a href="#66387" title="=&gt; Long">launchDelay</a><span class="delimiter">)</span>

    <a href="#59954" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Starting task&quot;)" class="string">&quot;Starting task&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#66385" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="JavaExecutor.this.RunningTask" id="66388">runningTask</a> = <a href="Util.scala.html#66449" title="(bytes: Array[Byte])edu.berkeley.cs.scads.comm.JvmTask">JvmTask</a><span class="delimiter">(</span><a href="#66385" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()com.google.protobuf.ByteString">getData</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()Array[Byte]">toByteArray</span><span class="delimiter">)</span> <span title="JavaExecutor.this.RunningTask" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="JavaExecutor.this.ForkedJvm">JvmMainTask</span><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.comm.ClassSource]" id="66464">classpath</a>, <a title="String" id="66465">mainclass</a>, <a title="Seq[String]" id="66466">args</a>, <a title="Map[String,String]" id="66467">props</a>, <a title="Map[String,String]" id="66468">env</a><span class="delimiter">)</span> =&gt;
        <span title="JavaExecutor.this.ForkedJvm" class="keyword">new</span> <a href="#59966" title="JavaExecutor.this.ForkedJvm">ForkedJvm</a><span class="delimiter">(</span><a href="#66385" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>,
          <a href="#66385" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="(l: java.util.List[org.apache.mesos.Protos.Resource])scala.collection.mutable.Buffer[org.apache.mesos.Protos.Resource]">getResourcesList</span>.<span title="(p: org.apache.mesos.Protos.Resource =&gt; Boolean)Option[org.apache.mesos.Protos.Resource]">find</span><span class="delimiter">(</span><a href="#66816" title="org.apache.mesos.Protos.Resource">_</a>.<span title="()java.lang.String">getName</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;mem&quot;)" class="string">&quot;mem&quot;</span><span class="delimiter">)</span>.<span title="(f: org.apache.mesos.Protos.Resource =&gt; Double)Option[Double]">map</span><span class="delimiter">(</span><a href="#66826" title="org.apache.mesos.Protos.Resource">_</a>.<span title="()org.apache.mesos.Protos.Resource.Scalar">getScalar</span>.<span title="()Double">getValue</span><span class="delimiter">)</span>.<span title="(default: =&gt; Double)Double">getOrElse</span><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;No memory specified in mesos task!&quot;)" class="string">&quot;No memory specified in mesos task!&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span>,
          <a href="#59968" title="(classSources: Seq[edu.berkeley.cs.scads.comm.ClassSource])String">loadClasspath</a><span class="delimiter">(</span><a href="#66464" title="Seq[edu.berkeley.cs.scads.comm.ClassSource]">classpath</a><span class="delimiter">)</span>,
          <a href="#66465" title="String">mainclass</a>,
          <a href="#66466" title="Seq[String]">args</a>,
          <a href="#66467" title="Map[String,String]">props</a>,
          <a href="#66468" title="Map[String,String]">env</a>, <a href="#66384" title="org.apache.mesos.ExecutorDriver">d</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="JavaExecutor.this.JettyApp">JvmWebAppTask</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.ClassSource" id="66940">warFile</a>, <a title="Map[String,String]" id="66941">properties</a><span class="delimiter">)</span> =&gt; <span title="JavaExecutor.this.JettyApp" class="keyword">new</span> <a href="#59965" title="JavaExecutor.this.JettyApp">JettyApp</a><span class="delimiter">(</span><a href="#66385" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>, <a href="#59967" title="(classSource: edu.berkeley.cs.scads.comm.ClassSource)java.io.File">resolveClassSource</a><span class="delimiter">(</span><a href="#66940" title="edu.berkeley.cs.scads.comm.ClassSource">warFile</a><span class="delimiter">)</span>, <a href="#66941" title="Map[String,String]">properties</a>, <a href="#66384" title="org.apache.mesos.ExecutorDriver">d</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#59962" title="=&gt; scala.collection.mutable.HashMap[String,JavaExecutor.this.RunningTask]">runningTasks</a> <span title="(kv: (String, JavaExecutor.this.RunningTask))JavaExecutor.this.runningTasks.type">+=</span> <span class="delimiter">(</span><span title="(_1: java.lang.String, _2: JavaExecutor.this.RunningTask)(java.lang.String, JavaExecutor.this.RunningTask)" class="delimiter">(</span><a href="#66385" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span>.<span title="()java.lang.String">getValue</span>, <a href="#66388" title="JavaExecutor.this.RunningTask">runningTask</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#59954" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Task %s started&quot;)" class="string">&quot;Task %s started&quot;</span>, <a href="#66385" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(d: org.apache.mesos.ExecutorDriver, taskId: org.apache.mesos.Protos.TaskID)Unit" id="59971">killTask</a><span class="delimiter">(</span><a title="org.apache.mesos.ExecutorDriver" id="66973">d</a>: <span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span>, <a title="org.apache.mesos.Protos.TaskID" id="66974">taskId</a>: <span title="org.apache.mesos.Protos.TaskID">TaskID</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#59962" title="=&gt; scala.collection.mutable.HashMap[String,JavaExecutor.this.RunningTask]">runningTasks</a>.<span title="(key: String)Option[JavaExecutor.this.RunningTask]">get</span><span class="delimiter">(</span><a href="#66974" title="org.apache.mesos.Protos.TaskID">taskId</a>.<span title="()java.lang.String">getValue</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="JavaExecutor.this.RunningTask" id="66980">runningTask</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#59954" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Killing task %s&quot;)" class="string">&quot;Killing task %s&quot;</span>, <a href="#66974" title="org.apache.mesos.Protos.TaskID">taskId</a><span class="delimiter">)</span>
        <a href="#66980" title="JavaExecutor.this.RunningTask">runningTask</a>.<a href="#60553" title="=&gt; Unit">kill</a>
        <a href="#66973" title="org.apache.mesos.ExecutorDriver">d</a>.<span title="(x$1: org.apache.mesos.Protos.TaskStatus)Int">sendStatusUpdate</span><span title="Unit" class="delimiter">(</span>
          <span title="object org.apache.mesos.Protos.TaskStatus">TaskStatus</span>.<span title="()org.apache.mesos.Protos.TaskStatus.Builder">newBuilder</span><span class="delimiter">(</span><span class="delimiter">)</span>
                    .<span title="(x$1: org.apache.mesos.Protos.TaskID)org.apache.mesos.Protos.TaskStatus.Builder">setTaskId</span><span class="delimiter">(</span><a href="#66974" title="org.apache.mesos.Protos.TaskID">taskId</a><span class="delimiter">)</span>
                    .<span title="()org.apache.mesos.Protos.TaskStatus">build</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="Unit">None</span> =&gt; <a href="#59954" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Asked to kill nonexistant task %s&quot;)" class="string">&quot;Asked to kill nonexistant task %s&quot;</span>, <a href="#66974" title="org.apache.mesos.Protos.TaskID">taskId</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.ExecutorDriver, code: Int, msg: String)Unit" id="59972">error</a><span class="delimiter">(</span><a title="org.apache.mesos.ExecutorDriver" id="66996">driver</a>: <span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span>, <a title="Int" id="66997">code</a>: <span title="Int">Int</span>, <a title="String" id="66998">msg</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#59954" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;MESOS ERROR %d: %s&quot;)" class="string">&quot;MESOS ERROR %d: %s&quot;</span>, <a href="#66997" title="Int">code</a>, <a href="#66998" title="String">msg</a><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.ExecutorDriver)Unit" id="59973">shutdown</a><span class="delimiter">(</span><a title="org.apache.mesos.ExecutorDriver" id="67004">driver</a>: <span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#59954" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Executor shutting down&quot;)" class="string">&quot;Executor shutting down&quot;</span><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.ExecutorDriver, data: Array[Byte])Unit" id="59974">frameworkMessage</a><span class="delimiter">(</span><a title="org.apache.mesos.ExecutorDriver" id="67008">driver</a>: <span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span>, <a title="Array[Byte]" id="67009">data</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#59954" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Received FW Message: %s&quot;)" class="string">&quot;Received FW Message: %s&quot;</span>, <a href="#67009" title="Array[Byte]">data</a><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.ExecutorDriver, args: org.apache.mesos.Protos.ExecutorArgs)Unit" id="59975">init</a><span class="delimiter">(</span><a title="org.apache.mesos.ExecutorDriver" id="67015">driver</a>:<span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span>, <a title="org.apache.mesos.Protos.ExecutorArgs" id="67016">args</a>: <span title="org.apache.mesos.Protos.ExecutorArgs">ExecutorArgs</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#59954" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Executor Init: %s&quot;)" class="string">&quot;Executor Init: %s&quot;</span>, <a href="#67016" title="org.apache.mesos.Protos.ExecutorArgs">args</a><span class="delimiter">)</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(f: java.io.File)Unit" id="59976">deleteRecursive</a><span class="delimiter">(</span><a title="java.io.File" id="65805">f</a>: <span title="java.io.File">File</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#65805" title="java.io.File">f</a>.<span title="()Boolean">isDirectory</span><span class="delimiter">)</span>
      <a href="#65805" title="java.io.File">f</a>.<span title="(xs: Array[java.io.File])scala.collection.mutable.ArrayOps[java.io.File]">listFiles</span>.<span title="(f: java.io.File =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#59976" title="(f: java.io.File)Unit">deleteRecursive</a><span class="delimiter">)</span>
    <a href="#65805" title="java.io.File">f</a>.<span title="()Boolean">delete</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>