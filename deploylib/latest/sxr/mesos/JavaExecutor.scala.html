<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>mesos/JavaExecutor.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> deploylib
<span class="keyword">package</span> mesos

<span class="keyword">import</span> java.net.URL

<span class="keyword">import</span> org.apache.commons.httpclient._
<span class="keyword">import</span> org.apache.commons.httpclient.methods._
<span class="keyword">import</span> net.lag.logging.Logger
<span class="keyword">import</span> net.lag.configgy.Configgy

<span class="keyword">import</span> ec2._
<span class="keyword">import</span> edu.berkeley.cs.avro.marker._
<span class="keyword">import</span> edu.berkeley.cs.scads.comm._

<span class="keyword">import</span> org.apache.mesos._
<span class="keyword">import</span> org.apache.mesos.<span title="object org.apache.mesos.Protos">Protos</span>._
<span class="keyword">import</span> com.google.protobuf.ByteString


<span class="keyword">import</span> java.io.<span class="delimiter">{</span> File, InputStream, BufferedReader, InputStreamReader, FileOutputStream <span class="delimiter">}</span>

<span class="keyword">import</span> scala.collection.<span title="object scala.collection.JavaConversions">JavaConversions</span>._
<span class="keyword">import</span> scala.util.Random

<span class="keyword">import</span> org.mortbay.jetty.Connector;
<span class="keyword">import</span> org.mortbay.jetty.<span class="delimiter">{</span>Server, Request<span class="delimiter">}</span>;
<span class="keyword">import</span> org.mortbay.jetty.nio.SelectChannelConnector;
<span class="keyword">import</span> org.mortbay.jetty.servlet.Context;
<span class="keyword">import</span> org.mortbay.jetty.servlet.ServletHolder;
<span class="keyword">import</span> org.mortbay.jetty.webapp.WebAppContext;
<span class="keyword">import</span> org.mortbay.jetty.handler.<span class="delimiter">{</span>ContextHandler, StatisticsHandler<span class="delimiter">}</span>
<span class="keyword">import</span> org.mortbay.jetty.handler.AbstractHandler
<span class="keyword">import</span> javax.servlet.http.<span class="delimiter">{</span>HttpServletResponse, HttpServletRequest<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object deploylib.mesos.JavaExecutor" id="9616">JavaExecutor</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(args: Array[String])Unit" id="59765">main</a><span class="delimiter">(</span><a title="Array[String]" id="59811">args</a>: <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="object java.lang.System">System</span>.<span title="(x$1: java.lang.String)Unit">loadLibrary</span><span class="delimiter">(</span><span title="java.lang.String(&quot;mesos&quot;)" class="string">&quot;mesos&quot;</span><span class="delimiter">)</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#59811" title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]">args</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Usage: JavaExecutor &lt;configFile&gt;&quot;)" class="string">&quot;Usage: JavaExecutor &lt;configFile&gt;&quot;</span><span class="delimiter">)</span>
      <span title="object java.lang.System">System</span>.<span title="(x$1: Int)Unit">exit</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span title="object net.lag.configgy.Configgy">Configgy</span>.<span title="(filename: String)Unit">configure</span><span class="delimiter">(</span><a href="#59811" title="(i: Int)String">args</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="org.apache.mesos.MesosExecutorDriver" id="59813">driver</a> = <span title="org.apache.mesos.MesosExecutorDriver" class="keyword">new</span> <span title="org.apache.mesos.MesosExecutorDriver">MesosExecutorDriver</span><span class="delimiter">(</span><span title="deploylib.mesos.JavaExecutor" class="keyword">new</span> <a href="#9618" title="deploylib.mesos.JavaExecutor">JavaExecutor</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#59813" title="org.apache.mesos.MesosExecutorDriver">driver</a>.<span title="()Int">run</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class JavaExecutor extends java.lang.Object with org.apache.mesos.Executor with ScalaObject" id="9618">JavaExecutor</a> <a href="#9618" title="ScalaObject" class="keyword">extends</a> <span title="org.apache.mesos.Executor">Executor</span> <span class="delimiter">{</span>
  <span class="keyword">val</span> <a title="net.lag.configgy.Config" id="59785">config</a> = <span title="object net.lag.configgy.Configgy">Configgy</span>.<span title="=&gt; net.lag.configgy.Config">config</span>
  <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="59787">logger</a> = <span title="()net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="org.apache.commons.httpclient.HttpClient" id="59789">httpClient</a> = <span title="org.apache.commons.httpclient.HttpClient" class="keyword">new</span> <span title="org.apache.commons.httpclient.HttpClient">HttpClient</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="java.io.File" id="59791">baseDir</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#59785" title="(key: String, defaultValue: String)String">config</a><span class="delimiter">(</span><span title="java.lang.String(&quot;javaexecutor.workdir&quot;)" class="string">&quot;javaexecutor.workdir&quot;</span>, <span title="java.lang.String(&quot;/tmp&quot;)" class="string">&quot;/tmp&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#59791" title="=&gt; java.io.File">baseDir</a>.<span title="()Boolean">exists</span><span class="delimiter">)</span> <a href="#59791" title="=&gt; java.io.File">baseDir</a>.<span title="()Boolean">mkdir</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="java.io.File" id="59793">jarCache</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#59785" title="(key: String, defaultValue: String)String">config</a><span class="delimiter">(</span><span title="java.lang.String(&quot;javaexecutor.jarcache&quot;)" class="string">&quot;javaexecutor.jarcache&quot;</span>, <span title="java.lang.String(&quot;/tmp/jarCache&quot;)" class="string">&quot;/tmp/jarCache&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#59793" title="=&gt; java.io.File">jarCache</a>.<span title="()Boolean">exists</span><span class="delimiter">)</span> <a href="#59793" title="=&gt; java.io.File">jarCache</a>.<span title="()Boolean">mkdir</span>

  <span class="comment">/* Keep a handle to all tasks that are running so we can kill it if needed later */</span>
  <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[String,JavaExecutor.this.RunningTask]" id="59795">runningTasks</a> = <span title="()scala.collection.mutable.HashMap[String,JavaExecutor.this.RunningTask]" class="keyword">new</span> scala.collection.mutable.<span title="scala.collection.mutable.HashMap[String,JavaExecutor.this.RunningTask]">HashMap</span><span class="delimiter">[</span>String, RunningTask<span class="delimiter">]</span>

  <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class RunningTask extends java.lang.Object with ScalaObject" id="59797">RunningTask</a> <a href="#59797" title="ScalaObject" class="delimiter">{</a>
    <span class="keyword">def</span> <a title="=&gt; Unit" id="60386">kill</a>: <span title="Unit">Unit</span>
  <span class="delimiter">}</span>

  <span class="keyword">class</span> <a title="class JettyApp extends JavaExecutor.this.RunningTask with ScalaObject" id="59798">JettyApp</a><a href="#59798" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="org.apache.mesos.Protos.TaskDescription" id="64303">taskDesc</a>: <span title="org.apache.mesos.Protos.TaskDescription">TaskDescription</span>, <span class="keyword">val</span> <a title="java.io.File" id="64304">warFile</a>: <span title="java.io.File">File</span>, <a title="Map[String,String]" id="64305">properties</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="org.apache.mesos.ExecutorDriver" id="64306">driver</a>: <span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#59797" title="JavaExecutor.this.RunningTask">RunningTask</a> <span class="delimiter">{</span>
    <span class="comment">/* Set the properies in the current JVM */</span>
    <a href="#64305" title="Map[String,String]">properties</a>.<span title="(f: (String, String) =&gt; java.lang.String)Unit">foreach</span> <a href="#64332" title="java.lang.String" class="delimiter">{</a> <span class="keyword">case</span> <span title="java.lang.String" class="delimiter">(</span><a title="String" id="64335">k</a>,<a title="String" id="64336">v</a><span class="delimiter">)</span> =&gt; <span title="object java.lang.System">System</span>.<span title="(x$1: java.lang.String, x$2: java.lang.String)java.lang.String">setProperty</span><span class="delimiter">(</span><a href="#64335" title="String">k</a>,<a href="#64336" title="String">v</a><span class="delimiter">)</span> <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="org.mortbay.jetty.Server" id="60401">server</a> = <span title="org.mortbay.jetty.Server" class="keyword">new</span> <span title="org.mortbay.jetty.Server">Server</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="org.mortbay.jetty.nio.SelectChannelConnector" id="60403">connector</a> = <span title="org.mortbay.jetty.nio.SelectChannelConnector" class="keyword">new</span> <span title="org.mortbay.jetty.nio.SelectChannelConnector">SelectChannelConnector</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#60403" title="=&gt; org.mortbay.jetty.nio.SelectChannelConnector">connector</a>.<span title="(x$1: Int)Unit">setPort</span><span class="delimiter">(</span><span title="object java.lang.Integer">Integer</span>.<span title="(x$1: java.lang.String, x$2: Int)java.lang.Integer">getInteger</span><span class="delimiter">(</span><span title="java.lang.String(&quot;jetty.port&quot;)" class="string">&quot;jetty.port&quot;</span>, <span title="Int(8080)" class="int">8080</span><span class="delimiter">)</span>.<span title="()Int">intValue</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#60401" title="=&gt; org.mortbay.jetty.Server">server</a>.<span title="(x$1: Array[org.mortbay.jetty.Connector])Unit">setConnectors</span><span class="delimiter">(</span><span title="[T](xs: T*)(implicit evidence$2: scala.reflect.ClassManifest[T])Array[T]">Array</span><span title="(xs: org.mortbay.jetty.Connector*)(implicit evidence$2: scala.reflect.ClassManifest[org.mortbay.jetty.Connector])Array[org.mortbay.jetty.Connector]" class="delimiter">[</span><span title="org.mortbay.jetty.Connector">Connector</span><span class="delimiter">]</span><span title="(clazz: java.lang.Class[_])scala.reflect.ClassManifest[org.mortbay.jetty.Connector]" class="delimiter">(</span><a href="#60403" title="=&gt; org.mortbay.jetty.nio.SelectChannelConnector">connector</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="org.mortbay.thread.QueuedThreadPool" id="60405">pool</a> = <span title="org.mortbay.thread.QueuedThreadPool" class="keyword">new</span> org.mortbay.thread.<span title="org.mortbay.thread.QueuedThreadPool">QueuedThreadPool</span>
    <a href="#59787" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Setting max thread pool size&quot;)" class="string">&quot;Setting max thread pool size&quot;</span><span class="delimiter">)</span>
    <a href="#60405" title="=&gt; org.mortbay.thread.QueuedThreadPool">pool</a>.<span title="(x$1: Int)Unit">setMaxThreads</span><span class="delimiter">(</span><span title="Int(5)" class="int">5</span><span class="delimiter">)</span>
    <a href="#60401" title="=&gt; org.mortbay.jetty.Server">server</a>.<span title="(x$1: org.mortbay.thread.ThreadPool)Unit">setThreadPool</span><span class="delimiter">(</span><a href="#60405" title="=&gt; org.mortbay.thread.QueuedThreadPool">pool</a><span class="delimiter">)</span>
    <a href="#59787" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;max pool size: %d&quot;)" class="string">&quot;max pool size: %d&quot;</span>,<a href="#60401" title="=&gt; org.mortbay.jetty.Server">server</a>.<span title="()org.mortbay.thread.ThreadPool">getThreadPool</span> <span title="Int" class="keyword">match</span> <span class="delimiter">{</span><span class="keyword">case</span> <a title="Int" id="64362">p</a>:org.mortbay.thread.<span title="org.mortbay.thread.QueuedThreadPool">QueuedThreadPool</span> =&gt; <a href="#64362" title="org.mortbay.thread.QueuedThreadPool">p</a>.<span title="()Int">getMaxThreads</span>; <span class="keyword">case</span> <span title="Int(-1)">_</span> =&gt; -<span title="Int(-1)" class="int">1</span><span class="delimiter">}</span><span class="delimiter">)</span>

    <span class="comment">/* Create context for webapp and wrap it with stats handler */</span>
    <span class="keyword">val</span> <a title="org.mortbay.jetty.handler.StatisticsHandler" id="60407">statsWebApp</a> = <span title="org.mortbay.jetty.handler.StatisticsHandler" class="keyword">new</span> <span title="org.mortbay.jetty.handler.StatisticsHandler">StatisticsHandler</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="org.mortbay.jetty.webapp.WebAppContext" id="60409">webapp</a> = <span title="org.mortbay.jetty.webapp.WebAppContext" class="keyword">new</span> <span title="org.mortbay.jetty.webapp.WebAppContext">WebAppContext</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#60409" title="=&gt; org.mortbay.jetty.webapp.WebAppContext">webapp</a>.<span title="(x$1: java.lang.String)Unit">setContextPath</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span class="delimiter">)</span>
    <a href="#60409" title="=&gt; org.mortbay.jetty.webapp.WebAppContext">webapp</a>.<span title="(x$1: java.lang.String)Unit">setWar</span><span class="delimiter">(</span><a href="#64304" title="=&gt; java.io.File">warFile</a>.<span title="()java.lang.String">getCanonicalPath</span><span class="delimiter">)</span>
    <a href="#60407" title="=&gt; org.mortbay.jetty.handler.StatisticsHandler">statsWebApp</a>.<span title="(x$1: org.mortbay.jetty.Handler)Unit">addHandler</span><span class="delimiter">(</span><a href="#60409" title="=&gt; org.mortbay.jetty.webapp.WebAppContext">webapp</a><span class="delimiter">)</span>

    @volatile <span class="keyword">var</span> <a title="Boolean" id="60412">running</a> = <span title="Boolean(true)" class="keyword">true</span>
    @volatile <span class="keyword">var</span> <a title="Double" id="60415">requestsPerSec</a> = <span title="Double(0.0)" class="double">0.0</span>
    @volatile <span class="keyword">var</span> <a title="Double" id="60418">cpuUtilization</a> = <span title="Double(0.0)" class="double">0.0</span>
    <span class="keyword">val</span> <a title="statsThread extends java.lang.Thread" id="60420">statsThread</a> = <a href="#62419" title="java.lang.Thread{val javaSysMon: com.jezhumble.javasysmon.JavaSysMon; def lastUsage: com.jezhumble.javasysmon.CpuTimes; def lastUsage_=(x$1: com.jezhumble.javasysmon.CpuTimes): Unit; def lastTime: Long; def lastTime_=(x$1: Long): Unit; def lastCount: Int; def lastCount_=(x$1: Int): Unit}" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Thread" id="62419">Thread</a><span class="delimiter">(</span><span title="java.lang.String(&quot;StatsThread&quot;)" class="string">&quot;StatsThread&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="com.jezhumble.javasysmon.JavaSysMon" id="62421">javaSysMon</a> = <span title="com.jezhumble.javasysmon.JavaSysMon" class="keyword">new</span> com.jezhumble.javasysmon.<span title="com.jezhumble.javasysmon.JavaSysMon">JavaSysMon</span>

      <span class="keyword">var</span> <a title="com.jezhumble.javasysmon.CpuTimes" id="62424">lastUsage</a> = <a href="#62421" title="=&gt; com.jezhumble.javasysmon.JavaSysMon">javaSysMon</a>.<span title="()com.jezhumble.javasysmon.CpuTimes">cpuTimes</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">var</span> <a title="Long" id="62427">lastTime</a> = <span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">var</span> <a title="Int" id="62430">lastCount</a> = <span title="Int(0)" class="int">0</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="62432">run</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
        <span title="Unit" class="keyword">while</span><span class="delimiter">(</span><a href="#60412" title="=&gt; Boolean">running</a><span class="delimiter">)</span> <a href="#62551" title="()Unit" class="delimiter">{</a>
          <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><span title="Long(30000L)" class="int">30000</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Long" id="62552">currentTime</a> = <span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Int" id="62553">currentCount</a> = <a href="#60407" title="=&gt; org.mortbay.jetty.handler.StatisticsHandler">statsWebApp</a>.<span title="()Int">getRequests</span><span class="delimiter">(</span><span class="delimiter">)</span>
	  <span class="keyword">val</span> <a title="com.jezhumble.javasysmon.CpuTimes" id="62554">cpuTimes</a> = <a href="#62421" title="=&gt; com.jezhumble.javasysmon.JavaSysMon">javaSysMon</a>.<span title="()com.jezhumble.javasysmon.CpuTimes">cpuTimes</span><span class="delimiter">(</span><span class="delimiter">)</span>

	  <a href="#60418" title="(x$1: Double)Unit">cpuUtilization</a> = <a href="#62554" title="com.jezhumble.javasysmon.CpuTimes">cpuTimes</a>.<span title="(x$1: com.jezhumble.javasysmon.CpuTimes)Float">getCpuUsage</span><span title="=&gt; Double" class="delimiter">(</span><a href="#62424" title="=&gt; com.jezhumble.javasysmon.CpuTimes">lastUsage</a><span class="delimiter">)</span>
	  <a href="#62424" title="(x$1: com.jezhumble.javasysmon.CpuTimes)Unit">lastUsage</a> = <a href="#62554" title="com.jezhumble.javasysmon.CpuTimes">cpuTimes</a>

          <a href="#60415" title="(x$1: Double)Unit">requestsPerSec</a> = <span class="delimiter">(</span><a href="#62553" title="Int">currentCount</a> <span title="(x: Int)Int">-</span> <a href="#62430" title="=&gt; Int">lastCount</a><span class="delimiter">)</span> <span title="=&gt; Double">/</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#62552" title="Long">currentTime</a> <span title="(x: Long)Long">-</span> <a href="#62427" title="=&gt; Long">lastTime</a><span class="delimiter">)</span> <span title="(x: Int)Long">/</span> <span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
          <a href="#59787" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Updating statistics at %d %d: %f&quot;)" class="string">&quot;Updating statistics at %d %d: %f&quot;</span>, <a href="#62552" title="Long">currentTime</a>, <a href="#62553" title="Int">currentCount</a>, <a href="#60415" title="=&gt; Double">requestsPerSec</a><span class="delimiter">)</span>
          <a href="#62427" title="(x$1: Long)Unit">lastTime</a> = <a href="#62552" title="Long">currentTime</a>
          <a href="#62430" title="(x$1: Int)Unit">lastCount</a> = <a href="#62553" title="Int">currentCount</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#60420" title="=&gt; java.lang.Thread{val javaSysMon: com.jezhumble.javasysmon.JavaSysMon; def lastUsage: com.jezhumble.javasysmon.CpuTimes; def lastUsage_=(x$1: com.jezhumble.javasysmon.CpuTimes): Unit; def lastTime: Long; def lastTime_=(x$1: Long): Unit; def lastCount: Int; def lastCount_=(x$1: Int): Unit}">statsThread</a>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="comment">/* Create a special context that reports /stats over http */</span>
    <span class="keyword">val</span> <a title="org.mortbay.jetty.handler.AbstractHandler" id="60422">statsHandler</a> = <a href="#62613" title="org.mortbay.jetty.handler.AbstractHandler" class="keyword">new</a> <a title="anonymous class $anon extends org.mortbay.jetty.handler.AbstractHandler" id="62613">AbstractHandler</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(target: String, request: javax.servlet.http.HttpServletRequest, response: javax.servlet.http.HttpServletResponse, dispatch: Int)Unit" id="62615">handle</a><span class="delimiter">(</span><a title="String" id="62616">target</a>: <span title="String">String</span>, <a title="javax.servlet.http.HttpServletRequest" id="62617">request</a>: <span title="javax.servlet.http.HttpServletRequest">HttpServletRequest</span>, <a title="javax.servlet.http.HttpServletResponse" id="62618">response</a>: <span title="javax.servlet.http.HttpServletResponse">HttpServletResponse</span>, <a title="Int" id="62619">dispatch</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>

        <a href="#62618" title="javax.servlet.http.HttpServletResponse">response</a>.<span title="(x$1: java.lang.String)Unit">setContentType</span><span class="delimiter">(</span><span title="java.lang.String(&quot;text/html&quot;)" class="string">&quot;text/html&quot;</span><span class="delimiter">)</span>
        <a href="#62618" title="javax.servlet.http.HttpServletResponse">response</a>.<span title="(x$1: Int)Unit">setStatus</span><span class="delimiter">(</span>HttpServletResponse.<span title="Int(200)">SC_OK</span><span class="delimiter">)</span>

        <span class="keyword">val</span> <a title="scala.xml.Elem" id="62741">statsXml</a> =
          &lt;<a title="scala.xml.Elem" id="63553">status</a>&gt;
            &lt;<a title="scala.xml.Elem" id="63862">CpuUtilization</a>&gt;
              <span class="delimiter">{</span><a href="#60418" title="=&gt; Double">cpuUtilization</a><span class="delimiter">}</span>
            &lt;/CpuUtilization&gt;
            &lt;<a title="scala.xml.Elem" id="63891">RequestRate</a>&gt;
              <span class="delimiter">{</span><a href="#60415" title="=&gt; Double">requestsPerSec</a><span class="delimiter">}</span>
            &lt;/RequestRate&gt;
            &lt;<a title="scala.xml.Elem" id="63892">RequestsTotal</a>&gt;
              <span class="delimiter">{</span><a href="#60407" title="=&gt; org.mortbay.jetty.handler.StatisticsHandler">statsWebApp</a>.<span title="()Int">getRequests</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">}</span>
            &lt;/RequestsTotal&gt;
          &lt;/status&gt;

        <a href="#62618" title="javax.servlet.http.HttpServletResponse">response</a>.<span title="()java.io.PrintWriter">getWriter</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)Unit">println</span><span class="delimiter">(</span><a href="#62741" title="scala.xml.Elem">statsXml</a>.<span title="()String">toString</span><span class="delimiter">)</span>
        <a href="#62617" title="javax.servlet.http.HttpServletRequest">request</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.mortbay.jetty.Request" class="delimiter">[</span><span title="org.mortbay.jetty.Request">Request</span><span class="delimiter">]</span>.<span title="(x$1: Boolean)Unit">setHandled</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="org.mortbay.jetty.handler.ContextHandler" id="60424">statsContext</a> = <span title="org.mortbay.jetty.handler.ContextHandler" class="keyword">new</span> <span title="org.mortbay.jetty.handler.ContextHandler">ContextHandler</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#60424" title="=&gt; org.mortbay.jetty.handler.ContextHandler">statsContext</a>.<span title="(x$1: java.lang.String)Unit">setContextPath</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/stats&quot;)" class="string">&quot;/stats&quot;</span><span class="delimiter">)</span>
    <a href="#60424" title="=&gt; org.mortbay.jetty.handler.ContextHandler">statsContext</a>.<span title="(x$1: org.mortbay.jetty.Handler)Unit">addHandler</span><span class="delimiter">(</span><a href="#60422" title="=&gt; org.mortbay.jetty.handler.AbstractHandler">statsHandler</a><span class="delimiter">)</span>

    <span class="comment">/* add both the webapp and the stats context to the running server */</span>
    <a href="#60401" title="=&gt; org.mortbay.jetty.Server">server</a>.<span title="(x$1: Array[org.mortbay.jetty.Handler])Unit">setHandlers</span><span class="delimiter">(</span><span title="(xs: org.mortbay.jetty.Handler*)(implicit evidence$2: scala.reflect.ClassManifest[org.mortbay.jetty.Handler])Array[org.mortbay.jetty.Handler]">Array</span><span title="(clazz: java.lang.Class[_])scala.reflect.ClassManifest[org.mortbay.jetty.Handler]" class="delimiter">(</span><a href="#60424" title="=&gt; org.mortbay.jetty.handler.ContextHandler">statsContext</a>, <a href="#60407" title="=&gt; org.mortbay.jetty.handler.StatisticsHandler">statsWebApp</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <a href="#60401" title="=&gt; org.mortbay.jetty.Server">server</a>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span title="Unit" class="keyword">while</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#60401" title="=&gt; org.mortbay.jetty.Server">server</a>.<span title="()Boolean">isRunning</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#64387" title="()Unit" class="delimiter">{</a>
      <a href="#59787" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Waiting for server to report isRunning == true&quot;)" class="string">&quot;Waiting for server to report isRunning == true&quot;</span><span class="delimiter">)</span>
      <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><span title="Long(1000L)" class="int">1000</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#64306" title="org.apache.mesos.ExecutorDriver">driver</a>.<span title="(x$1: org.apache.mesos.Protos.TaskStatus)Int">sendStatusUpdate</span><span class="delimiter">(</span>
      <span title="object org.apache.mesos.Protos.TaskStatus">TaskStatus</span>.<span title="()org.apache.mesos.Protos.TaskStatus.Builder">newBuilder</span><span class="delimiter">(</span><span class="delimiter">)</span>
                .<span title="(x$1: org.apache.mesos.Protos.TaskID)org.apache.mesos.Protos.TaskStatus.Builder">setTaskId</span><span class="delimiter">(</span><a href="#64303" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
                .<span title="(x$1: org.apache.mesos.Protos.TaskState)org.apache.mesos.Protos.TaskStatus.Builder">setState</span><span class="delimiter">(</span>TaskState.<span title="org.apache.mesos.Protos.TaskState(value TASK_RUNNING)">TASK_RUNNING</span><span class="delimiter">)</span>
                .<span title="()org.apache.mesos.Protos.TaskStatus">build</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; Unit" id="60426">kill</a> = <span class="delimiter">{</span>
      <a href="#60412" title="(x$1: Boolean)Unit">running</a> = <span title="Boolean(false)" class="keyword">false</span>
      <a href="#60401" title="=&gt; org.mortbay.jetty.Server">server</a>.<span title="()Unit">stop</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">class</span> <a title="class ForkedJvm extends JavaExecutor.this.RunningTask with java.lang.Runnable with ScalaObject" id="59799">ForkedJvm</a><a href="#59799" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="org.apache.mesos.Protos.TaskDescription" id="65383">taskDesc</a>: <span title="org.apache.mesos.Protos.TaskDescription">TaskDescription</span>, <span class="keyword">val</span> <a title="Int" id="65384">heapSize</a>: <span title="Int">Int</span>, <span class="keyword">val</span> <a title="String" id="65385">classpath</a>: <span title="String">String</span>, <span class="keyword">val</span> <a title="String" id="65386">mainClass</a>: <span title="String">String</span>, <span class="keyword">val</span> <a title="Seq[String]" id="65387">args</a>: <span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="Map[String,String]" id="65388">properties</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="Map[String,String]" id="65389">env</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="org.apache.mesos.ExecutorDriver" id="65390">driver</a>: <span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#59797" title="JavaExecutor.this.RunningTask">RunningTask</a> <span class="keyword">with</span> <span title="java.lang.Runnable">Runnable</span> <span class="delimiter">{</span>
     <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="64613">logger</a> = <span title="()net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#64613" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Requested memory: &quot;)" class="string">&quot;Requested memory: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#65384" title="=&gt; Int">heapSize</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="List[String]" id="64615">cmdLine</a> = <span title="[A](xs: A*)List[A]">List</span><span title="(xs: String*)List[String]" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/usr/bin/java&quot;)" class="string">&quot;/usr/bin/java&quot;</span>,
      <span title="java.lang.String(&quot;-server&quot;)" class="string">&quot;-server&quot;</span>,
      <span title="java.lang.String(&quot;-Xmx&quot;)" class="string">&quot;-Xmx&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#65384" title="=&gt; Int">heapSize</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;M&quot;)" class="string">&quot;M&quot;</span>,
      <span class="comment">//HACK to deal with mesos lying about available memory &quot;-Xms&quot; + heapSize + &quot;M&quot;,</span>
      <span title="java.lang.String(&quot;-XX:+HeapDumpOnOutOfMemoryError&quot;)" class="string">&quot;-XX:+HeapDumpOnOutOfMemoryError&quot;</span>,
      <span title="java.lang.String(&quot;-verbosegc&quot;)" class="string">&quot;-verbosegc&quot;</span>,
      <span title="java.lang.String(&quot;-XX:+UseConcMarkSweepGC&quot;)" class="string">&quot;-XX:+UseConcMarkSweepGC&quot;</span>,
      <span title="java.lang.String(&quot;-XX:MaxGCPauseMillis=200&quot;)" class="string">&quot;-XX:MaxGCPauseMillis=200&quot;</span>,
      <span title="java.lang.String(&quot;-Djava.library.path=&quot;)" class="string">&quot;-Djava.library.path=&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/usr/local/mesos/lib/java&quot;)" class="string">&quot;/usr/local/mesos/lib/java&quot;</span><span class="delimiter">)</span>,
      <a href="#65388" title="=&gt; Map[String,String]">properties</a>.<span title="(f: (String, String) =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[String,String],String,scala.collection.immutable.Iterable[String]])scala.collection.immutable.Iterable[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.Iterable.Coll,String,scala.collection.immutable.Iterable[String]]" class="delimiter">(</span><a title="(String, String)" id="64756">kv</a> =&gt; <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;-D%s=%s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#64756" title="(String, String)">kv</a>.<span title="=&gt; String">_1</span>, <a href="#64756" title="(String, String)">kv</a>.<span title="=&gt; String">_2</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span class="delimiter">)</span>,
      <span title="java.lang.String(&quot;-cp&quot;)" class="string">&quot;-cp&quot;</span>, <a href="#65385" title="=&gt; String">classpath</a>,
      <a href="#65386" title="=&gt; String">mainClass</a><span class="delimiter">)</span> <span title="(that: scala.collection.GenTraversableOnce[String])(implicit bf: scala.collection.generic.CanBuildFrom[List[String],String,List[String]])List[String]">++</span> <a href="#65387" title="=&gt; Seq[String]">args</a>

    <a href="#64613" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Execing: &quot;)" class="string">&quot;Execing: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#64615" title="=&gt; List[String]">cmdLine</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.io.File" id="64617">tempDir</a> = <a href="#59802" title="()java.io.File">newTempDir</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Array[String]" id="64619">envp</a> = <a href="#65389" title="Map[String,String]">env</a>.<span title="(f: (String, String) =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[String,String],String,scala.collection.immutable.Iterable[String]])scala.collection.immutable.Iterable[String]">map</span> <a href="#64936" title="String" class="delimiter">{</a> <span class="keyword">case</span> <span title="String" class="delimiter">(</span><a title="String" id="64939">key</a>, <a title="String" id="64940">value</a><span class="delimiter">)</span> =&gt; <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;%s=%s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#64939" title="String">key</a>, <a href="#64940" title="String">value</a><span class="delimiter">)</span> <span class="delimiter">}</span>.<span title="(implicit evidence$1: ClassManifest[String])Array[String]">toArray</span>
    <span class="keyword">val</span> <a title="java.lang.Process" id="64621">proc</a> = <span title="object java.lang.Runtime">Runtime</span>.<span title="()java.lang.Runtime">getRuntime</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: Array[java.lang.String], x$2: Array[java.lang.String], x$3: java.io.File)java.lang.Process">exec</span><span class="delimiter">(</span><a href="#64615" title="=&gt; List[String]">cmdLine</a>.<span title="(p: String =&gt; Boolean)List[String]">filter</span><span class="delimiter">(</span><a href="#65065" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">_</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<span title="(implicit evidence$1: ClassManifest[String])Array[String]">toArray</span>, <a href="#64619" title="=&gt; Array[String]">envp</a>, <a href="#64617" title="=&gt; java.io.File">tempDir</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="deploylib.mesos.StreamTailer" id="64623">stdout</a> = <a href="Util.scala.html#65372" title="deploylib.mesos.StreamTailer" class="keyword">new</a> <a href="Util.scala.html#9663" title="deploylib.mesos.StreamTailer">StreamTailer</a><span class="delimiter">(</span><a href="#64621" title="=&gt; java.lang.Process">proc</a>.<span title="()java.io.InputStream">getInputStream</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="deploylib.mesos.StreamTailer" id="64625">stderr</a> = <a href="Util.scala.html#65372" title="deploylib.mesos.StreamTailer" class="keyword">new</a> <a href="Util.scala.html#9663" title="deploylib.mesos.StreamTailer">StreamTailer</a><span class="delimiter">(</span><a href="#64621" title="=&gt; java.lang.Process">proc</a>.<span title="()java.io.InputStream">getErrorStream</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; Array[Byte]" id="64627">output</a> = <span title="(xs: java.lang.Object*)List[java.lang.Object]">List</span><span class="delimiter">(</span><a href="#64615" title="=&gt; List[String]">cmdLine</a>, <a href="#59799" title="JavaExecutor.this.ForkedJvm" class="keyword">this</a>, <span title="java.lang.String(&quot;===stdout===&quot;)" class="string">&quot;===stdout===&quot;</span>, <a href="#64623" title="=&gt; deploylib.mesos.StreamTailer">stdout</a>.<a href="Util.scala.html#65368" title="=&gt; String">tail</a>, <span title="java.lang.String(&quot;===stderr===&quot;)" class="string">&quot;===stderr===&quot;</span>, <a href="#64625" title="=&gt; deploylib.mesos.StreamTailer">stderr</a>.<a href="Util.scala.html#65368" title="=&gt; String">tail</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>.<span title="()Array[Byte]">getBytes</span>
    <span class="keyword">val</span> <a title="java.lang.Thread" id="64628">taskThread</a> = <span title="(x$1: java.lang.Runnable, x$2: java.lang.String)java.lang.Thread" class="keyword">new</span> <span title="java.lang.Thread">Thread</span><span class="delimiter">(</span><a href="#59799" title="JavaExecutor.this.ForkedJvm" class="keyword">this</a>, <span title="java.lang.String(&quot;Task &quot;)" class="string">&quot;Task &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#65383" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;Monitor&quot;)" class="string">&quot;Monitor&quot;</span><span class="delimiter">)</span>
    @volatile <span class="keyword">var</span> <a title="Boolean" id="64631">taskKilled</a> = <span title="Boolean(false)" class="keyword">false</span>
    <a href="#64628" title="=&gt; java.lang.Thread">taskThread</a>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="()Unit" id="64633">run</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="#65390" title="org.apache.mesos.ExecutorDriver">driver</a>.<span title="(x$1: org.apache.mesos.Protos.TaskStatus)Int">sendStatusUpdate</span><span class="delimiter">(</span>
        <span title="object org.apache.mesos.Protos.TaskStatus">TaskStatus</span>.<span title="()org.apache.mesos.Protos.TaskStatus.Builder">newBuilder</span><span class="delimiter">(</span><span class="delimiter">)</span>
          .<span title="(x$1: org.apache.mesos.Protos.TaskID)org.apache.mesos.Protos.TaskStatus.Builder">setTaskId</span><span class="delimiter">(</span><a href="#65383" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
          .<span title="(x$1: org.apache.mesos.Protos.TaskState)org.apache.mesos.Protos.TaskStatus.Builder">setState</span><span class="delimiter">(</span>TaskState.<span title="org.apache.mesos.Protos.TaskState(value TASK_RUNNING)">TASK_RUNNING</span><span class="delimiter">)</span>
          .<span title="(x$1: com.google.protobuf.ByteString)org.apache.mesos.Protos.TaskStatus.Builder">setData</span><span class="delimiter">(</span><span title="object com.google.protobuf.ByteString">ByteString</span>.<span title="(x$1: Array[Byte])com.google.protobuf.ByteString">copyFrom</span><span class="delimiter">(</span><a href="#64627" title="=&gt; Array[Byte]">output</a><span class="delimiter">)</span><span class="delimiter">)</span>
          .<span title="()org.apache.mesos.Protos.TaskStatus">build</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="Int" id="65488">result</a> = <a href="#64621" title="=&gt; java.lang.Process">proc</a>.<span title="()Int">waitFor</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#64613" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;TASK %s exitied with code %d&quot;)" class="string">&quot;TASK %s exitied with code %d&quot;</span>, <a href="#65383" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span>, <a href="#65488" title="Int">result</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="org.apache.mesos.Protos.TaskState" id="65489">finalTaskState</a> = <a href="#65488" title="Int">result</a> <span title="org.apache.mesos.Protos.TaskState" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="org.apache.mesos.Protos.TaskState(value TASK_FINISHED)" class="int">0</span> =&gt; TaskState.<span title="org.apache.mesos.Protos.TaskState(value TASK_FINISHED)">TASK_FINISHED</span>
        <span class="keyword">case</span> <span title="org.apache.mesos.Protos.TaskState(value TASK_FAILED)">_</span> =&gt; TaskState.<span title="org.apache.mesos.Protos.TaskState(value TASK_FAILED)">TASK_FAILED</span>
      <span class="delimiter">}</span>
      <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#64631" title="=&gt; Boolean">taskKilled</a><span class="delimiter">)</span>
        <a href="#65390" title="org.apache.mesos.ExecutorDriver">driver</a>.<span title="(x$1: org.apache.mesos.Protos.TaskStatus)Int">sendStatusUpdate</span><span class="delimiter">(</span>
          <span title="object org.apache.mesos.Protos.TaskStatus">TaskStatus</span>.<span title="()org.apache.mesos.Protos.TaskStatus.Builder">newBuilder</span><span class="delimiter">(</span><span class="delimiter">)</span>
            .<span title="(x$1: org.apache.mesos.Protos.TaskID)org.apache.mesos.Protos.TaskStatus.Builder">setTaskId</span><span class="delimiter">(</span><a href="#65383" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
            .<span title="(x$1: org.apache.mesos.Protos.TaskState)org.apache.mesos.Protos.TaskStatus.Builder">setState</span><span class="delimiter">(</span><a href="#65489" title="org.apache.mesos.Protos.TaskState">finalTaskState</a><span class="delimiter">)</span>
            .<span title="(x$1: com.google.protobuf.ByteString)org.apache.mesos.Protos.TaskStatus.Builder">setData</span><span class="delimiter">(</span><span title="object com.google.protobuf.ByteString">ByteString</span>.<span title="(x$1: Array[Byte])com.google.protobuf.ByteString">copyFrom</span><span class="delimiter">(</span><a href="#64627" title="=&gt; Array[Byte]">output</a><span class="delimiter">)</span><span class="delimiter">)</span>
            .<span title="()org.apache.mesos.Protos.TaskStatus">build</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <span title="Any" class="keyword">if</span><span class="delimiter">(</span><a href="#64623" title="=&gt; deploylib.mesos.StreamTailer">stdout</a>.<a href="Util.scala.html#65368" title="=&gt; String">tail</a> <span title="(x$1: java.lang.CharSequence)Boolean">contains</span> <span title="java.lang.String(&quot;A fatal error has been detected by the Java Runtime Environment&quot;)" class="string">&quot;A fatal error has been detected by the Java Runtime Environment&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#64613" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;SIGSEGV from forked JVM.  Killing node.&quot;)" class="string">&quot;SIGSEGV from forked JVM.  Killing node.&quot;</span><span class="delimiter">)</span>
        <span title="object java.lang.Runtime">Runtime</span>.<span title="()java.lang.Runtime">getRuntime</span>.<span title="(x$1: java.lang.String)java.lang.Process">exec</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/sbin/halt&quot;)" class="string">&quot;/sbin/halt&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#64613" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Cleaning up working directory %s for %s&quot;)" class="string">&quot;Cleaning up working directory %s for %s&quot;</span>, <a href="#64617" title="=&gt; java.io.File">tempDir</a>, <a href="#65383" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
      <a href="#59809" title="(f: java.io.File)Unit">deleteRecursive</a><span class="delimiter">(</span><a href="#64617" title="=&gt; java.io.File">tempDir</a><span class="delimiter">)</span>
      <a href="#64613" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Done cleaning up after Task %s&quot;)" class="string">&quot;Done cleaning up after Task %s&quot;</span>, <a href="#65383" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; Unit" id="64634">kill</a> = <span class="delimiter">{</span>
      <a href="#64613" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Killing Task %s&quot;)" class="string">&quot;Killing Task %s&quot;</span>, <a href="#65383" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
      <a href="#64631" title="(x$1: Boolean)Unit">taskKilled</a> = <span title="Boolean(true)" class="keyword">true</span>
      <a href="#64621" title="=&gt; java.lang.Process">proc</a>.<span title="()Unit">destroy</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(classSource: edu.berkeley.cs.scads.comm.ClassSource)java.io.File" id="59800">resolveClassSource</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.ClassSource" id="65651">classSource</a>: <span title="edu.berkeley.cs.scads.comm.ClassSource">ClassSource</span><span class="delimiter">)</span>: <span title="java.io.File">File</span> = <a href="#65651" title="edu.berkeley.cs.scads.comm.ClassSource">classSource</a> <span title="java.io.File" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="java.io.File">ServerSideJar</span><span class="delimiter">(</span><a title="String" id="65654">path</a><span class="delimiter">)</span> =&gt; <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#65654" title="String">path</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="java.io.File">S3CachedJar</span><span class="delimiter">(</span><a title="String" id="65660">urlString</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.net.URL" id="65661">jarUrl</a> = <span title="(x$1: java.lang.String)java.net.URL" class="keyword">new</span> <span title="java.net.URL">URL</span><span class="delimiter">(</span><a href="#65660" title="String">urlString</a><span class="delimiter">)</span>

      <span class="comment">//Note: this makes the assumption that the name of the file is the Md5 hash of the file.</span>
      <span class="keyword">var</span> <a title="java.lang.String" id="65662">jarMd5</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#65661" title="java.net.URL">jarUrl</a>.<span title="()java.lang.String">getFile</span><span class="delimiter">)</span>.<span title="()java.lang.String">getName</span>
      <span class="keyword">val</span> <a title="java.io.File" id="65663">cachedJar</a> = <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#59793" title="=&gt; java.io.File">jarCache</a>, <a href="#65662" title="java.lang.String">jarMd5</a><span class="delimiter">)</span>

      <span class="comment">//TODO: Locks incase there are multiple executors on a machine</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#65663" title="java.io.File">cachedJar</a>.<span title="()Boolean">exists</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <span title="=&gt; Boolean">!</span><span class="delimiter">(</span><a href="../Util.scala.html#9501" title="object deploylib.Util">Util</a>.<a href="../Util.scala.html#30727" title="(file: java.io.File)String">md5</a><span class="delimiter">(</span><a href="#65663" title="java.io.File">cachedJar</a><span class="delimiter">)</span> <span title="(x$1: Any)Boolean">equals</span> <a href="#65662" title="java.lang.String">jarMd5</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="org.apache.commons.httpclient.methods.GetMethod" id="65675">method</a> = <span title="(x$1: java.lang.String)org.apache.commons.httpclient.methods.GetMethod" class="keyword">new</span> <span title="org.apache.commons.httpclient.methods.GetMethod">GetMethod</span><span class="delimiter">(</span><a href="#65660" title="String">urlString</a><span class="delimiter">)</span>
        <a href="#59787" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Downloading %s&quot;)" class="string">&quot;Downloading %s&quot;</span>, <a href="#65660" title="String">urlString</a><span class="delimiter">)</span>
        <a href="#59789" title="=&gt; org.apache.commons.httpclient.HttpClient">httpClient</a>.<span title="(x$1: org.apache.commons.httpclient.HttpMethod)Int">executeMethod</span><span class="delimiter">(</span><a href="#65675" title="org.apache.commons.httpclient.methods.GetMethod">method</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="java.io.InputStream" id="65676">instream</a> = <a href="#65675" title="org.apache.commons.httpclient.methods.GetMethod">method</a>.<span title="()java.io.InputStream">getResponseBodyAsStream</span>
        <span class="keyword">val</span> <a title="java.io.FileOutputStream" id="65677">outstream</a> = <span title="(x$1: java.io.File)java.io.FileOutputStream" class="keyword">new</span> <span title="java.io.FileOutputStream">FileOutputStream</span><span class="delimiter">(</span><a href="#65663" title="java.io.File">cachedJar</a><span class="delimiter">)</span>

        <span class="keyword">var</span> <a title="Int" id="65678">x</a> = <a href="#65676" title="java.io.InputStream">instream</a>.<span title="()Int">read</span>
        <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#65678" title="Int">x</a> <span title="(x: Int)Boolean">!=</span> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <a href="#65679" title="()Unit" class="delimiter">{</a>
          <a href="#65677" title="java.io.FileOutputStream">outstream</a>.<span title="(x$1: Int)Unit">write</span><span class="delimiter">(</span><a href="#65678" title="Int">x</a><span class="delimiter">)</span>
          <a href="#65678" title="Int">x</a> = <a href="#65676" title="java.io.InputStream">instream</a>.<span title="()Int">read</span>
        <span class="delimiter">}</span>
        <a href="#65676" title="java.io.InputStream">instream</a>.<span title="()Unit">close</span>
        <a href="#65677" title="java.io.FileOutputStream">outstream</a>.<span title="()Unit">close</span>
        <a href="#59787" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Download of %s complete&quot;)" class="string">&quot;Download of %s complete&quot;</span>, <a href="#65660" title="String">urlString</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#65663" title="java.io.File">cachedJar</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(classSources: Seq[edu.berkeley.cs.scads.comm.ClassSource])String" id="59801">loadClasspath</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.comm.ClassSource]" id="66126">classSources</a>: <span title="Seq[edu.berkeley.cs.scads.comm.ClassSource]">Seq</span><span class="delimiter">[</span>ClassSource<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="String">String</span> = <a href="#66126" title="Seq[edu.berkeley.cs.scads.comm.ClassSource]">classSources</a>.<span title="(f: edu.berkeley.cs.scads.comm.ClassSource =&gt; java.io.File)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.comm.ClassSource],java.io.File,Seq[java.io.File]])Seq[java.io.File]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.io.File,Seq[java.io.File]]" class="delimiter">(</span><a href="#59800" title="(classSource: edu.berkeley.cs.scads.comm.ClassSource)java.io.File">resolveClassSource</a><span class="delimiter">)</span>.<span title="(f: java.io.File =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[java.io.File],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#66191" title="java.io.File">_</a>.<span title="()java.lang.String">getCanonicalPath</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span><span class="delimiter">)</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="()java.io.File" id="59802">newTempDir</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="java.io.File">File</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.io.File" id="66214">tempDir</a> = <span title="object java.io.File">File</span>.<span title="(x$1: java.lang.String, x$2: java.lang.String, x$3: java.io.File)java.io.File">createTempFile</span><span class="delimiter">(</span><span title="java.lang.String(&quot;workdir&quot;)" class="string">&quot;workdir&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <a href="#59791" title="=&gt; java.io.File">baseDir</a><span class="delimiter">)</span>
    <a href="#66214" title="java.io.File">tempDir</a>.<span title="()Boolean">delete</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#66214" title="java.io.File">tempDir</a>.<span title="()Boolean">mkdir</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#66214" title="java.io.File">tempDir</a>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(d: org.apache.mesos.ExecutorDriver, taskDesc: org.apache.mesos.Protos.TaskDescription)Unit" id="59803">launchTask</a><span class="delimiter">(</span><a title="org.apache.mesos.ExecutorDriver" id="66217">d</a>: <span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span>, <a title="org.apache.mesos.Protos.TaskDescription" id="66218">taskDesc</a>: <span title="org.apache.mesos.Protos.TaskDescription">TaskDescription</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#66217" title="org.apache.mesos.ExecutorDriver">d</a>.<span title="(x$1: org.apache.mesos.Protos.TaskStatus)Int">sendStatusUpdate</span><span class="delimiter">(</span>
      <span title="object org.apache.mesos.Protos.TaskStatus">TaskStatus</span>.<span title="()org.apache.mesos.Protos.TaskStatus.Builder">newBuilder</span><span class="delimiter">(</span><span class="delimiter">)</span>
        .<span title="(x$1: org.apache.mesos.Protos.TaskID)org.apache.mesos.Protos.TaskStatus.Builder">setTaskId</span><span class="delimiter">(</span><a href="#66218" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
        .<span title="(x$1: org.apache.mesos.Protos.TaskState)org.apache.mesos.Protos.TaskStatus.Builder">setState</span><span class="delimiter">(</span>TaskState.<span title="org.apache.mesos.Protos.TaskState(value TASK_STARTING)">TASK_STARTING</span><span class="delimiter">)</span>
        .<span title="()org.apache.mesos.Protos.TaskStatus">build</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Int" id="66220">launchDelay</a> = <span title="object scala.util.Random">Random</span>.<span title="(n: Int)Int">nextInt</span><span class="delimiter">(</span><span class="int">10</span> <span title="Int(10000)">*</span> <span class="int">1000</span><span class="delimiter">)</span>
    <a href="#59787" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Delaying startup %dms to avoid overloading zookeeper&quot;)" class="string">&quot;Delaying startup %dms to avoid overloading zookeeper&quot;</span>, <a href="#66220" title="Int">launchDelay</a><span class="delimiter">)</span>
    <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><a href="#66220" title="=&gt; Long">launchDelay</a><span class="delimiter">)</span>

    <a href="#59787" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Starting task&quot;)" class="string">&quot;Starting task&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#66218" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="JavaExecutor.this.RunningTask" id="66221">runningTask</a> = <a href="Util.scala.html#66282" title="(bytes: Array[Byte])edu.berkeley.cs.scads.comm.JvmTask">JvmTask</a><span class="delimiter">(</span><a href="#66218" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()com.google.protobuf.ByteString">getData</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()Array[Byte]">toByteArray</span><span class="delimiter">)</span> <span title="JavaExecutor.this.RunningTask" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="JavaExecutor.this.ForkedJvm">JvmMainTask</span><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.comm.ClassSource]" id="66297">classpath</a>, <a title="String" id="66298">mainclass</a>, <a title="Seq[String]" id="66299">args</a>, <a title="Map[String,String]" id="66300">props</a>, <a title="Map[String,String]" id="66301">env</a><span class="delimiter">)</span> =&gt;
        <span title="JavaExecutor.this.ForkedJvm" class="keyword">new</span> <a href="#59799" title="JavaExecutor.this.ForkedJvm">ForkedJvm</a><span class="delimiter">(</span><a href="#66218" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>,
          <a href="#66218" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="(l: java.util.List[org.apache.mesos.Protos.Resource])scala.collection.mutable.Buffer[org.apache.mesos.Protos.Resource]">getResourcesList</span>.<span title="(p: org.apache.mesos.Protos.Resource =&gt; Boolean)Option[org.apache.mesos.Protos.Resource]">find</span><span class="delimiter">(</span><a href="#66649" title="org.apache.mesos.Protos.Resource">_</a>.<span title="()java.lang.String">getName</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;mem&quot;)" class="string">&quot;mem&quot;</span><span class="delimiter">)</span>.<span title="(f: org.apache.mesos.Protos.Resource =&gt; Double)Option[Double]">map</span><span class="delimiter">(</span><a href="#66659" title="org.apache.mesos.Protos.Resource">_</a>.<span title="()org.apache.mesos.Protos.Resource.Scalar">getScalar</span>.<span title="()Double">getValue</span><span class="delimiter">)</span>.<span title="(default: =&gt; Double)Double">getOrElse</span><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;No memory specified in mesos task!&quot;)" class="string">&quot;No memory specified in mesos task!&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span>,
          <a href="#59801" title="(classSources: Seq[edu.berkeley.cs.scads.comm.ClassSource])String">loadClasspath</a><span class="delimiter">(</span><a href="#66297" title="Seq[edu.berkeley.cs.scads.comm.ClassSource]">classpath</a><span class="delimiter">)</span>,
          <a href="#66298" title="String">mainclass</a>,
          <a href="#66299" title="Seq[String]">args</a>,
          <a href="#66300" title="Map[String,String]">props</a>,
          <a href="#66301" title="Map[String,String]">env</a>, <a href="#66217" title="org.apache.mesos.ExecutorDriver">d</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="JavaExecutor.this.JettyApp">JvmWebAppTask</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.ClassSource" id="66773">warFile</a>, <a title="Map[String,String]" id="66774">properties</a><span class="delimiter">)</span> =&gt; <span title="JavaExecutor.this.JettyApp" class="keyword">new</span> <a href="#59798" title="JavaExecutor.this.JettyApp">JettyApp</a><span class="delimiter">(</span><a href="#66218" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>, <a href="#59800" title="(classSource: edu.berkeley.cs.scads.comm.ClassSource)java.io.File">resolveClassSource</a><span class="delimiter">(</span><a href="#66773" title="edu.berkeley.cs.scads.comm.ClassSource">warFile</a><span class="delimiter">)</span>, <a href="#66774" title="Map[String,String]">properties</a>, <a href="#66217" title="org.apache.mesos.ExecutorDriver">d</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#59795" title="=&gt; scala.collection.mutable.HashMap[String,JavaExecutor.this.RunningTask]">runningTasks</a> <span title="(kv: (String, JavaExecutor.this.RunningTask))JavaExecutor.this.runningTasks.type">+=</span> <span class="delimiter">(</span><span title="(_1: java.lang.String, _2: JavaExecutor.this.RunningTask)(java.lang.String, JavaExecutor.this.RunningTask)" class="delimiter">(</span><a href="#66218" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span>.<span title="()java.lang.String">getValue</span>, <a href="#66221" title="JavaExecutor.this.RunningTask">runningTask</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#59787" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Task %s started&quot;)" class="string">&quot;Task %s started&quot;</span>, <a href="#66218" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(d: org.apache.mesos.ExecutorDriver, taskId: org.apache.mesos.Protos.TaskID)Unit" id="59804">killTask</a><span class="delimiter">(</span><a title="org.apache.mesos.ExecutorDriver" id="66806">d</a>: <span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span>, <a title="org.apache.mesos.Protos.TaskID" id="66807">taskId</a>: <span title="org.apache.mesos.Protos.TaskID">TaskID</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#59795" title="=&gt; scala.collection.mutable.HashMap[String,JavaExecutor.this.RunningTask]">runningTasks</a>.<span title="(key: String)Option[JavaExecutor.this.RunningTask]">get</span><span class="delimiter">(</span><a href="#66807" title="org.apache.mesos.Protos.TaskID">taskId</a>.<span title="()java.lang.String">getValue</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="JavaExecutor.this.RunningTask" id="66813">runningTask</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#59787" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Killing task %s&quot;)" class="string">&quot;Killing task %s&quot;</span>, <a href="#66807" title="org.apache.mesos.Protos.TaskID">taskId</a><span class="delimiter">)</span>
        <a href="#66813" title="JavaExecutor.this.RunningTask">runningTask</a>.<a href="#60386" title="=&gt; Unit">kill</a>
        <a href="#66806" title="org.apache.mesos.ExecutorDriver">d</a>.<span title="(x$1: org.apache.mesos.Protos.TaskStatus)Int">sendStatusUpdate</span><span title="Unit" class="delimiter">(</span>
          <span title="object org.apache.mesos.Protos.TaskStatus">TaskStatus</span>.<span title="()org.apache.mesos.Protos.TaskStatus.Builder">newBuilder</span><span class="delimiter">(</span><span class="delimiter">)</span>
                    .<span title="(x$1: org.apache.mesos.Protos.TaskID)org.apache.mesos.Protos.TaskStatus.Builder">setTaskId</span><span class="delimiter">(</span><a href="#66807" title="org.apache.mesos.Protos.TaskID">taskId</a><span class="delimiter">)</span>
                    .<span title="()org.apache.mesos.Protos.TaskStatus">build</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="Unit">None</span> =&gt; <a href="#59787" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Asked to kill nonexistant task %s&quot;)" class="string">&quot;Asked to kill nonexistant task %s&quot;</span>, <a href="#66807" title="org.apache.mesos.Protos.TaskID">taskId</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.ExecutorDriver, code: Int, msg: String)Unit" id="59805">error</a><span class="delimiter">(</span><a title="org.apache.mesos.ExecutorDriver" id="66829">driver</a>: <span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span>, <a title="Int" id="66830">code</a>: <span title="Int">Int</span>, <a title="String" id="66831">msg</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#59787" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;MESOS ERROR %d: %s&quot;)" class="string">&quot;MESOS ERROR %d: %s&quot;</span>, <a href="#66830" title="Int">code</a>, <a href="#66831" title="String">msg</a><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.ExecutorDriver)Unit" id="59806">shutdown</a><span class="delimiter">(</span><a title="org.apache.mesos.ExecutorDriver" id="66837">driver</a>: <span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#59787" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Executor shutting down&quot;)" class="string">&quot;Executor shutting down&quot;</span><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.ExecutorDriver, data: Array[Byte])Unit" id="59807">frameworkMessage</a><span class="delimiter">(</span><a title="org.apache.mesos.ExecutorDriver" id="66841">driver</a>: <span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span>, <a title="Array[Byte]" id="66842">data</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#59787" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Received FW Message: %s&quot;)" class="string">&quot;Received FW Message: %s&quot;</span>, <a href="#66842" title="Array[Byte]">data</a><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.ExecutorDriver, args: org.apache.mesos.Protos.ExecutorArgs)Unit" id="59808">init</a><span class="delimiter">(</span><a title="org.apache.mesos.ExecutorDriver" id="66848">driver</a>:<span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span>, <a title="org.apache.mesos.Protos.ExecutorArgs" id="66849">args</a>: <span title="org.apache.mesos.Protos.ExecutorArgs">ExecutorArgs</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#59787" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Executor Init: %s&quot;)" class="string">&quot;Executor Init: %s&quot;</span>, <a href="#66849" title="org.apache.mesos.Protos.ExecutorArgs">args</a><span class="delimiter">)</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(f: java.io.File)Unit" id="59809">deleteRecursive</a><span class="delimiter">(</span><a title="java.io.File" id="65638">f</a>: <span title="java.io.File">File</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#65638" title="java.io.File">f</a>.<span title="()Boolean">isDirectory</span><span class="delimiter">)</span>
      <a href="#65638" title="java.io.File">f</a>.<span title="(xs: Array[java.io.File])scala.collection.mutable.ArrayOps[java.io.File]">listFiles</span>.<span title="(f: java.io.File =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#59809" title="(f: java.io.File)Unit">deleteRecursive</a><span class="delimiter">)</span>
    <a href="#65638" title="java.io.File">f</a>.<span title="()Boolean">delete</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>