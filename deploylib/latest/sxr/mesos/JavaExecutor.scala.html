<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>mesos/JavaExecutor.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> deploylib
<span class="keyword">package</span> mesos

<span class="keyword">import</span> java.net.URL

<span class="keyword">import</span> org.apache.commons.httpclient._
<span class="keyword">import</span> org.apache.commons.httpclient.methods._
<span class="keyword">import</span> net.lag.logging.Logger
<span class="keyword">import</span> net.lag.configgy.Configgy

<span class="keyword">import</span> ec2._
<span class="keyword">import</span> edu.berkeley.cs.avro.marker._
<span class="keyword">import</span> edu.berkeley.cs.scads.comm._

<span class="keyword">import</span> org.apache.mesos._
<span class="keyword">import</span> org.apache.mesos.<span title="object org.apache.mesos.Protos">Protos</span>._
<span class="keyword">import</span> com.google.protobuf.ByteString


<span class="keyword">import</span> java.io.<span class="delimiter">{</span> File, InputStream, BufferedReader, InputStreamReader, FileOutputStream <span class="delimiter">}</span>

<span class="keyword">import</span> scala.collection.<span title="object scala.collection.JavaConversions">JavaConversions</span>._
<span class="keyword">import</span> scala.util.Random

<span class="keyword">import</span> org.mortbay.jetty.Connector;
<span class="keyword">import</span> org.mortbay.jetty.<span class="delimiter">{</span>Server, Request<span class="delimiter">}</span>;
<span class="keyword">import</span> org.mortbay.jetty.nio.SelectChannelConnector;
<span class="keyword">import</span> org.mortbay.jetty.servlet.Context;
<span class="keyword">import</span> org.mortbay.jetty.servlet.ServletHolder;
<span class="keyword">import</span> org.mortbay.jetty.webapp.WebAppContext;
<span class="keyword">import</span> org.mortbay.jetty.handler.<span class="delimiter">{</span>ContextHandler, StatisticsHandler<span class="delimiter">}</span>
<span class="keyword">import</span> org.mortbay.jetty.handler.AbstractHandler
<span class="keyword">import</span> javax.servlet.http.<span class="delimiter">{</span>HttpServletResponse, HttpServletRequest<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object deploylib.mesos.JavaExecutor" id="9768">JavaExecutor</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(args: Array[String])Unit" id="42730">main</a><span class="delimiter">(</span><a title="Array[String]" id="42776">args</a>: <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="object java.lang.System">System</span>.<span title="(x$1: java.lang.String)Unit">loadLibrary</span><span class="delimiter">(</span><span title="java.lang.String(&quot;mesos&quot;)" class="string">&quot;mesos&quot;</span><span class="delimiter">)</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#42776" title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]">args</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Usage: JavaExecutor &lt;configFile&gt;&quot;)" class="string">&quot;Usage: JavaExecutor &lt;configFile&gt;&quot;</span><span class="delimiter">)</span>
      <span title="object java.lang.System">System</span>.<span title="(x$1: Int)Unit">exit</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span title="object net.lag.configgy.Configgy">Configgy</span>.<span title="(filename: String)Unit">configure</span><span class="delimiter">(</span><a href="#42776" title="(i: Int)String">args</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="org.apache.mesos.MesosExecutorDriver" id="42778">driver</a> = <span title="org.apache.mesos.MesosExecutorDriver" class="keyword">new</span> <span title="org.apache.mesos.MesosExecutorDriver">MesosExecutorDriver</span><span class="delimiter">(</span><span title="deploylib.mesos.JavaExecutor" class="keyword">new</span> <a href="#9770" title="deploylib.mesos.JavaExecutor">JavaExecutor</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#42778" title="org.apache.mesos.MesosExecutorDriver">driver</a>.<span title="()Int">run</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class JavaExecutor extends java.lang.Object with org.apache.mesos.Executor with ScalaObject" id="9770">JavaExecutor</a> <a href="#9770" title="ScalaObject" class="keyword">extends</a> <span title="org.apache.mesos.Executor">Executor</span> <span class="delimiter">{</span>
  <span class="keyword">val</span> <a title="net.lag.configgy.Config" id="42750">config</a> = <span title="object net.lag.configgy.Configgy">Configgy</span>.<span title="=&gt; net.lag.configgy.Config">config</span>
  <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="42752">logger</a> = <span title="()net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="org.apache.commons.httpclient.HttpClient" id="42754">httpClient</a> = <span title="org.apache.commons.httpclient.HttpClient" class="keyword">new</span> <span title="org.apache.commons.httpclient.HttpClient">HttpClient</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="java.io.File" id="42756">baseDir</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#42750" title="(key: String, defaultValue: String)String">config</a><span class="delimiter">(</span><span title="java.lang.String(&quot;javaexecutor.workdir&quot;)" class="string">&quot;javaexecutor.workdir&quot;</span>, <span title="java.lang.String(&quot;/tmp&quot;)" class="string">&quot;/tmp&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#42756" title="=&gt; java.io.File">baseDir</a>.<span title="()Boolean">exists</span><span class="delimiter">)</span> <a href="#42756" title="=&gt; java.io.File">baseDir</a>.<span title="()Boolean">mkdir</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="java.io.File" id="42758">jarCache</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#42750" title="(key: String, defaultValue: String)String">config</a><span class="delimiter">(</span><span title="java.lang.String(&quot;javaexecutor.jarcache&quot;)" class="string">&quot;javaexecutor.jarcache&quot;</span>, <span title="java.lang.String(&quot;/tmp/jarCache&quot;)" class="string">&quot;/tmp/jarCache&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#42758" title="=&gt; java.io.File">jarCache</a>.<span title="()Boolean">exists</span><span class="delimiter">)</span> <a href="#42758" title="=&gt; java.io.File">jarCache</a>.<span title="()Boolean">mkdir</span>

  <span class="comment">/* Keep a handle to all tasks that are running so we can kill it if needed later */</span>
  <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[String,JavaExecutor.this.RunningTask]" id="42760">runningTasks</a> = <span title="()scala.collection.mutable.HashMap[String,JavaExecutor.this.RunningTask]" class="keyword">new</span> scala.collection.mutable.<span title="scala.collection.mutable.HashMap[String,JavaExecutor.this.RunningTask]">HashMap</span><span class="delimiter">[</span>String, RunningTask<span class="delimiter">]</span>

  <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class RunningTask extends java.lang.Object with ScalaObject" id="42762">RunningTask</a> <a href="#42762" title="ScalaObject" class="delimiter">{</a>
    <span class="keyword">def</span> <a title="=&gt; Unit" id="43714">kill</a>: <span title="Unit">Unit</span>
  <span class="delimiter">}</span>

  <span class="keyword">class</span> <a title="class JettyApp extends JavaExecutor.this.RunningTask with ScalaObject" id="42763">JettyApp</a><a href="#42763" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="org.apache.mesos.Protos.TaskDescription" id="47839">taskDesc</a>: <span title="org.apache.mesos.Protos.TaskDescription">TaskDescription</span>, <span class="keyword">val</span> <a title="java.io.File" id="47840">warFile</a>: <span title="java.io.File">File</span>, <a title="Map[String,String]" id="47841">properties</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="org.apache.mesos.ExecutorDriver" id="47842">driver</a>: <span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#42762" title="JavaExecutor.this.RunningTask">RunningTask</a> <span class="delimiter">{</span>
    <span class="comment">/* Set the properies in the current JVM */</span>
    <a href="#47841" title="Map[String,String]">properties</a>.<span title="(f: (String, String) =&gt; java.lang.String)Unit">foreach</span> <a href="#47959" title="java.lang.String" class="delimiter">{</a> <span class="keyword">case</span> <span title="java.lang.String" class="delimiter">(</span><a title="String" id="47962">k</a>,<a title="String" id="47963">v</a><span class="delimiter">)</span> =&gt; <span title="object java.lang.System">System</span>.<span title="(x$1: java.lang.String, x$2: java.lang.String)java.lang.String">setProperty</span><span class="delimiter">(</span><a href="#47962" title="String">k</a>,<a href="#47963" title="String">v</a><span class="delimiter">)</span> <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="org.mortbay.jetty.Server" id="43729">server</a> = <span title="org.mortbay.jetty.Server" class="keyword">new</span> <span title="org.mortbay.jetty.Server">Server</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="org.mortbay.jetty.nio.SelectChannelConnector" id="43731">connector</a> = <span title="org.mortbay.jetty.nio.SelectChannelConnector" class="keyword">new</span> <span title="org.mortbay.jetty.nio.SelectChannelConnector">SelectChannelConnector</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#43731" title="=&gt; org.mortbay.jetty.nio.SelectChannelConnector">connector</a>.<span title="(x$1: Int)Unit">setPort</span><span class="delimiter">(</span><span title="object java.lang.Integer">Integer</span>.<span title="(x$1: java.lang.String, x$2: Int)java.lang.Integer">getInteger</span><span class="delimiter">(</span><span title="java.lang.String(&quot;jetty.port&quot;)" class="string">&quot;jetty.port&quot;</span>, <span title="Int(8080)" class="int">8080</span><span class="delimiter">)</span>.<span title="()Int">intValue</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#43729" title="=&gt; org.mortbay.jetty.Server">server</a>.<span title="(x$1: Array[org.mortbay.jetty.Connector])Unit">setConnectors</span><span class="delimiter">(</span><span title="[T](xs: T*)(implicit evidence$2: scala.reflect.ClassManifest[T])Array[T]">Array</span><span title="(xs: org.mortbay.jetty.Connector*)(implicit evidence$2: scala.reflect.ClassManifest[org.mortbay.jetty.Connector])Array[org.mortbay.jetty.Connector]" class="delimiter">[</span><span title="org.mortbay.jetty.Connector">Connector</span><span class="delimiter">]</span><span title="(clazz: java.lang.Class[_])scala.reflect.ClassManifest[org.mortbay.jetty.Connector]" class="delimiter">(</span><a href="#43731" title="=&gt; org.mortbay.jetty.nio.SelectChannelConnector">connector</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="org.mortbay.thread.QueuedThreadPool" id="43733">pool</a> = <span title="org.mortbay.thread.QueuedThreadPool" class="keyword">new</span> org.mortbay.thread.<span title="org.mortbay.thread.QueuedThreadPool">QueuedThreadPool</span>
    <a href="#42752" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Setting max thread pool size&quot;)" class="string">&quot;Setting max thread pool size&quot;</span><span class="delimiter">)</span>
    <a href="#43733" title="=&gt; org.mortbay.thread.QueuedThreadPool">pool</a>.<span title="(x$1: Int)Unit">setMaxThreads</span><span class="delimiter">(</span><span title="Int(5)" class="int">5</span><span class="delimiter">)</span>
    <a href="#43729" title="=&gt; org.mortbay.jetty.Server">server</a>.<span title="(x$1: org.mortbay.thread.ThreadPool)Unit">setThreadPool</span><span class="delimiter">(</span><a href="#43733" title="=&gt; org.mortbay.thread.QueuedThreadPool">pool</a><span class="delimiter">)</span>
    <a href="#42752" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;max pool size: %d&quot;)" class="string">&quot;max pool size: %d&quot;</span>,<a href="#43729" title="=&gt; org.mortbay.jetty.Server">server</a>.<span title="()org.mortbay.thread.ThreadPool">getThreadPool</span> <span title="Int" class="keyword">match</span> <span class="delimiter">{</span><span class="keyword">case</span> <a title="Int" id="47989">p</a>:org.mortbay.thread.<span title="org.mortbay.thread.QueuedThreadPool">QueuedThreadPool</span> =&gt; <a href="#47989" title="org.mortbay.thread.QueuedThreadPool">p</a>.<span title="()Int">getMaxThreads</span>; <span class="keyword">case</span> <span title="Int(-1)">_</span> =&gt; -<span title="Int(-1)" class="int">1</span><span class="delimiter">}</span><span class="delimiter">)</span>

    <span class="comment">/* Create context for webapp and wrap it with stats handler */</span>
    <span class="keyword">val</span> <a title="org.mortbay.jetty.handler.StatisticsHandler" id="43735">statsWebApp</a> = <span title="org.mortbay.jetty.handler.StatisticsHandler" class="keyword">new</span> <span title="org.mortbay.jetty.handler.StatisticsHandler">StatisticsHandler</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="org.mortbay.jetty.webapp.WebAppContext" id="43737">webapp</a> = <span title="org.mortbay.jetty.webapp.WebAppContext" class="keyword">new</span> <span title="org.mortbay.jetty.webapp.WebAppContext">WebAppContext</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#43737" title="=&gt; org.mortbay.jetty.webapp.WebAppContext">webapp</a>.<span title="(x$1: java.lang.String)Unit">setContextPath</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span class="delimiter">)</span>
    <a href="#43737" title="=&gt; org.mortbay.jetty.webapp.WebAppContext">webapp</a>.<span title="(x$1: java.lang.String)Unit">setWar</span><span class="delimiter">(</span><a href="#47840" title="=&gt; java.io.File">warFile</a>.<span title="()java.lang.String">getCanonicalPath</span><span class="delimiter">)</span>
    <a href="#43735" title="=&gt; org.mortbay.jetty.handler.StatisticsHandler">statsWebApp</a>.<span title="(x$1: org.mortbay.jetty.Handler)Unit">addHandler</span><span class="delimiter">(</span><a href="#43737" title="=&gt; org.mortbay.jetty.webapp.WebAppContext">webapp</a><span class="delimiter">)</span>

    @volatile <span class="keyword">var</span> <a title="Boolean" id="43740">running</a> = <span title="Boolean(true)" class="keyword">true</span>
    @volatile <span class="keyword">var</span> <a title="Double" id="43743">requestsPerSec</a> = <span title="Double(0.0)" class="double">0.0</span>
    @volatile <span class="keyword">var</span> <a title="Double" id="43746">cpuUtilization</a> = <span title="Double(0.0)" class="double">0.0</span>
    <span class="keyword">val</span> <a title="statsThread extends java.lang.Thread" id="43748">statsThread</a> = <a href="#45747" title="java.lang.Thread{val javaSysMon: com.jezhumble.javasysmon.JavaSysMon; def lastUsage: com.jezhumble.javasysmon.CpuTimes; def lastUsage_=(x$1: com.jezhumble.javasysmon.CpuTimes): Unit; def lastTime: Long; def lastTime_=(x$1: Long): Unit; def lastCount: Int; def lastCount_=(x$1: Int): Unit}" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Thread" id="45747">Thread</a><span class="delimiter">(</span><span title="java.lang.String(&quot;StatsThread&quot;)" class="string">&quot;StatsThread&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="com.jezhumble.javasysmon.JavaSysMon" id="45749">javaSysMon</a> = <span title="com.jezhumble.javasysmon.JavaSysMon" class="keyword">new</span> com.jezhumble.javasysmon.<span title="com.jezhumble.javasysmon.JavaSysMon">JavaSysMon</span>

      <span class="keyword">var</span> <a title="com.jezhumble.javasysmon.CpuTimes" id="45752">lastUsage</a> = <a href="#45749" title="=&gt; com.jezhumble.javasysmon.JavaSysMon">javaSysMon</a>.<span title="()com.jezhumble.javasysmon.CpuTimes">cpuTimes</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">var</span> <a title="Long" id="45755">lastTime</a> = <span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">var</span> <a title="Int" id="45758">lastCount</a> = <span title="Int(0)" class="int">0</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="45760">run</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
        <span title="Unit" class="keyword">while</span><span class="delimiter">(</span><a href="#43740" title="=&gt; Boolean">running</a><span class="delimiter">)</span> <a href="#45879" title="()Unit" class="delimiter">{</a>
          <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><span title="Long(30000L)" class="int">30000</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Long" id="45880">currentTime</a> = <span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Int" id="45881">currentCount</a> = <a href="#43735" title="=&gt; org.mortbay.jetty.handler.StatisticsHandler">statsWebApp</a>.<span title="()Int">getRequests</span><span class="delimiter">(</span><span class="delimiter">)</span>
	  <span class="keyword">val</span> <a title="com.jezhumble.javasysmon.CpuTimes" id="45882">cpuTimes</a> = <a href="#45749" title="=&gt; com.jezhumble.javasysmon.JavaSysMon">javaSysMon</a>.<span title="()com.jezhumble.javasysmon.CpuTimes">cpuTimes</span><span class="delimiter">(</span><span class="delimiter">)</span>

	  <a href="#43746" title="(x$1: Double)Unit">cpuUtilization</a> = <a href="#45882" title="com.jezhumble.javasysmon.CpuTimes">cpuTimes</a>.<span title="(x$1: com.jezhumble.javasysmon.CpuTimes)Float">getCpuUsage</span><span title="=&gt; Double" class="delimiter">(</span><a href="#45752" title="=&gt; com.jezhumble.javasysmon.CpuTimes">lastUsage</a><span class="delimiter">)</span>
	  <a href="#45752" title="(x$1: com.jezhumble.javasysmon.CpuTimes)Unit">lastUsage</a> = <a href="#45882" title="com.jezhumble.javasysmon.CpuTimes">cpuTimes</a>

          <a href="#43743" title="(x$1: Double)Unit">requestsPerSec</a> = <span class="delimiter">(</span><a href="#45881" title="Int">currentCount</a> <span title="(x: Int)Int">-</span> <a href="#45758" title="=&gt; Int">lastCount</a><span class="delimiter">)</span> <span title="=&gt; Double">/</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#45880" title="Long">currentTime</a> <span title="(x: Long)Long">-</span> <a href="#45755" title="=&gt; Long">lastTime</a><span class="delimiter">)</span> <span title="(x: Int)Long">/</span> <span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
          <a href="#42752" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Updating statistics at %d %d: %f&quot;)" class="string">&quot;Updating statistics at %d %d: %f&quot;</span>, <a href="#45880" title="Long">currentTime</a>, <a href="#45881" title="Int">currentCount</a>, <a href="#43743" title="=&gt; Double">requestsPerSec</a><span class="delimiter">)</span>
          <a href="#45755" title="(x$1: Long)Unit">lastTime</a> = <a href="#45880" title="Long">currentTime</a>
          <a href="#45758" title="(x$1: Int)Unit">lastCount</a> = <a href="#45881" title="Int">currentCount</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#43748" title="=&gt; java.lang.Thread{val javaSysMon: com.jezhumble.javasysmon.JavaSysMon; def lastUsage: com.jezhumble.javasysmon.CpuTimes; def lastUsage_=(x$1: com.jezhumble.javasysmon.CpuTimes): Unit; def lastTime: Long; def lastTime_=(x$1: Long): Unit; def lastCount: Int; def lastCount_=(x$1: Int): Unit}">statsThread</a>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="comment">/* Create a special context that reports /stats over http */</span>
    <span class="keyword">val</span> <a title="org.mortbay.jetty.handler.AbstractHandler" id="43750">statsHandler</a> = <a href="#45941" title="org.mortbay.jetty.handler.AbstractHandler" class="keyword">new</a> <a title="anonymous class $anon extends org.mortbay.jetty.handler.AbstractHandler" id="45941">AbstractHandler</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(target: String, request: javax.servlet.http.HttpServletRequest, response: javax.servlet.http.HttpServletResponse, dispatch: Int)Unit" id="45943">handle</a><span class="delimiter">(</span><a title="String" id="45944">target</a>: <span title="String">String</span>, <a title="javax.servlet.http.HttpServletRequest" id="45945">request</a>: <span title="javax.servlet.http.HttpServletRequest">HttpServletRequest</span>, <a title="javax.servlet.http.HttpServletResponse" id="45946">response</a>: <span title="javax.servlet.http.HttpServletResponse">HttpServletResponse</span>, <a title="Int" id="45947">dispatch</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>

        <a href="#45946" title="javax.servlet.http.HttpServletResponse">response</a>.<span title="(x$1: java.lang.String)Unit">setContentType</span><span class="delimiter">(</span><span title="java.lang.String(&quot;text/html&quot;)" class="string">&quot;text/html&quot;</span><span class="delimiter">)</span>
        <a href="#45946" title="javax.servlet.http.HttpServletResponse">response</a>.<span title="(x$1: Int)Unit">setStatus</span><span class="delimiter">(</span>HttpServletResponse.<span title="Int(200)">SC_OK</span><span class="delimiter">)</span>

        <span class="keyword">val</span> <a title="scala.xml.Elem" id="46069">statsXml</a> =
          &lt;<a title="scala.xml.Elem" id="46881">status</a>&gt;
            &lt;<a title="scala.xml.Elem" id="47191">CpuUtilization</a>&gt;
              <span class="delimiter">{</span><a href="#43746" title="=&gt; Double">cpuUtilization</a><span class="delimiter">}</span>
            &lt;/CpuUtilization&gt;
            &lt;<a title="scala.xml.Elem" id="47220">RequestRate</a>&gt;
              <span class="delimiter">{</span><a href="#43743" title="=&gt; Double">requestsPerSec</a><span class="delimiter">}</span>
            &lt;/RequestRate&gt;
            &lt;<a title="scala.xml.Elem" id="47221">RequestsTotal</a>&gt;
              <span class="delimiter">{</span><a href="#43735" title="=&gt; org.mortbay.jetty.handler.StatisticsHandler">statsWebApp</a>.<span title="()Int">getRequests</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">}</span>
            &lt;/RequestsTotal&gt;
          &lt;/status&gt;

        <a href="#45946" title="javax.servlet.http.HttpServletResponse">response</a>.<span title="()java.io.PrintWriter">getWriter</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)Unit">println</span><span class="delimiter">(</span><a href="#46069" title="scala.xml.Elem">statsXml</a>.<span title="()String">toString</span><span class="delimiter">)</span>
        <a href="#45945" title="javax.servlet.http.HttpServletRequest">request</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.mortbay.jetty.Request" class="delimiter">[</span><span title="org.mortbay.jetty.Request">Request</span><span class="delimiter">]</span>.<span title="(x$1: Boolean)Unit">setHandled</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="org.mortbay.jetty.handler.ContextHandler" id="43752">statsContext</a> = <span title="org.mortbay.jetty.handler.ContextHandler" class="keyword">new</span> <span title="org.mortbay.jetty.handler.ContextHandler">ContextHandler</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#43752" title="=&gt; org.mortbay.jetty.handler.ContextHandler">statsContext</a>.<span title="(x$1: java.lang.String)Unit">setContextPath</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/stats&quot;)" class="string">&quot;/stats&quot;</span><span class="delimiter">)</span>
    <a href="#43752" title="=&gt; org.mortbay.jetty.handler.ContextHandler">statsContext</a>.<span title="(x$1: org.mortbay.jetty.Handler)Unit">addHandler</span><span class="delimiter">(</span><a href="#43750" title="=&gt; org.mortbay.jetty.handler.AbstractHandler">statsHandler</a><span class="delimiter">)</span>

    <span class="comment">/* add both the webapp and the stats context to the running server */</span>
    <a href="#43729" title="=&gt; org.mortbay.jetty.Server">server</a>.<span title="(x$1: Array[org.mortbay.jetty.Handler])Unit">setHandlers</span><span class="delimiter">(</span><span title="(xs: org.mortbay.jetty.Handler*)(implicit evidence$2: scala.reflect.ClassManifest[org.mortbay.jetty.Handler])Array[org.mortbay.jetty.Handler]">Array</span><span title="(clazz: java.lang.Class[_])scala.reflect.ClassManifest[org.mortbay.jetty.Handler]" class="delimiter">(</span><a href="#43752" title="=&gt; org.mortbay.jetty.handler.ContextHandler">statsContext</a>, <a href="#43735" title="=&gt; org.mortbay.jetty.handler.StatisticsHandler">statsWebApp</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <a href="#43729" title="=&gt; org.mortbay.jetty.Server">server</a>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span title="Unit" class="keyword">while</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#43729" title="=&gt; org.mortbay.jetty.Server">server</a>.<span title="()Boolean">isRunning</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#48014" title="()Unit" class="delimiter">{</a>
      <a href="#42752" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Waiting for server to report isRunning == true&quot;)" class="string">&quot;Waiting for server to report isRunning == true&quot;</span><span class="delimiter">)</span>
      <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><span title="Long(1000L)" class="int">1000</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#47842" title="org.apache.mesos.ExecutorDriver">driver</a>.<span title="(x$1: org.apache.mesos.Protos.TaskStatus)Int">sendStatusUpdate</span><span class="delimiter">(</span>
      <span title="object org.apache.mesos.Protos.TaskStatus">TaskStatus</span>.<span title="()org.apache.mesos.Protos.TaskStatus.Builder">newBuilder</span><span class="delimiter">(</span><span class="delimiter">)</span>
                .<span title="(x$1: org.apache.mesos.Protos.TaskID)org.apache.mesos.Protos.TaskStatus.Builder">setTaskId</span><span class="delimiter">(</span><a href="#47839" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
                .<span title="(x$1: org.apache.mesos.Protos.TaskState)org.apache.mesos.Protos.TaskStatus.Builder">setState</span><span class="delimiter">(</span>TaskState.<span title="org.apache.mesos.Protos.TaskState(value TASK_RUNNING)">TASK_RUNNING</span><span class="delimiter">)</span>
                .<span title="()org.apache.mesos.Protos.TaskStatus">build</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; Unit" id="43754">kill</a> = <span class="delimiter">{</span>
      <a href="#43740" title="(x$1: Boolean)Unit">running</a> = <span title="Boolean(false)" class="keyword">false</span>
      <a href="#43729" title="=&gt; org.mortbay.jetty.Server">server</a>.<span title="()Unit">stop</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">class</span> <a title="class ForkedJvm extends JavaExecutor.this.RunningTask with java.lang.Runnable with ScalaObject" id="42764">ForkedJvm</a><a href="#42764" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="org.apache.mesos.Protos.TaskDescription" id="49819">taskDesc</a>: <span title="org.apache.mesos.Protos.TaskDescription">TaskDescription</span>, <span class="keyword">val</span> <a title="Int" id="49820">heapSize</a>: <span title="Int">Int</span>, <span class="keyword">val</span> <a title="String" id="49821">classpath</a>: <span title="String">String</span>, <span class="keyword">val</span> <a title="String" id="49822">mainClass</a>: <span title="String">String</span>, <span class="keyword">val</span> <a title="Seq[String]" id="49823">args</a>: <span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="Map[String,String]" id="49824">properties</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="Map[String,String]" id="49825">env</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="org.apache.mesos.ExecutorDriver" id="49826">driver</a>: <span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#42762" title="JavaExecutor.this.RunningTask">RunningTask</a> <span class="keyword">with</span> <span title="java.lang.Runnable">Runnable</span> <span class="delimiter">{</span>
     <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="48240">logger</a> = <span title="()net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#48240" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Requested memory: &quot;)" class="string">&quot;Requested memory: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#49820" title="=&gt; Int">heapSize</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="List[String]" id="48242">cmdLine</a> = <span title="[A](xs: A*)List[A]">List</span><span title="(xs: String*)List[String]" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/usr/bin/java&quot;)" class="string">&quot;/usr/bin/java&quot;</span>,
      <span title="java.lang.String(&quot;-server&quot;)" class="string">&quot;-server&quot;</span>,
      <span title="java.lang.String(&quot;-Xmx6G&quot;)" class="string">&quot;-Xmx6G&quot;</span>,<span class="comment">//HACK to deal with meoso not telling us the right amount of memory&quot;-Xmx&quot; + heapSize + &quot;M&quot;,</span>
      <span class="comment">//HACK to deal with mesos lying about available memory &quot;-Xms&quot; + heapSize + &quot;M&quot;,</span>
      <span title="java.lang.String(&quot;-XX:+HeapDumpOnOutOfMemoryError&quot;)" class="string">&quot;-XX:+HeapDumpOnOutOfMemoryError&quot;</span>,
      <span title="java.lang.String(&quot;-verbosegc&quot;)" class="string">&quot;-verbosegc&quot;</span>,
      <span title="java.lang.String(&quot;-XX:+UseConcMarkSweepGC&quot;)" class="string">&quot;-XX:+UseConcMarkSweepGC&quot;</span>,
      <span title="java.lang.String(&quot;-XX:MaxGCPauseMillis=200&quot;)" class="string">&quot;-XX:MaxGCPauseMillis=200&quot;</span>,
      <span title="java.lang.String(&quot;-Djava.library.path=&quot;)" class="string">&quot;-Djava.library.path=&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/usr/local/mesos/lib/java&quot;)" class="string">&quot;/usr/local/mesos/lib/java&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(that: scala.collection.GenTraversableOnce[String])(implicit bf: scala.collection.generic.CanBuildFrom[List[String],String,List[String]])List[String]">++</span>
      <a href="#49824" title="=&gt; Map[String,String]">properties</a>.<span title="(f: (String, String) =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[String,String],String,scala.collection.immutable.Iterable[String]])scala.collection.immutable.Iterable[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.Iterable.Coll,String,scala.collection.immutable.Iterable[String]]" class="delimiter">(</span><a title="(String, String)" id="48437">kv</a> =&gt; <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;-D%s=%s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#48437" title="(String, String)">kv</a>.<span title="=&gt; String">_1</span>, <a href="#48437" title="(String, String)">kv</a>.<span title="=&gt; String">_2</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(that: scala.collection.GenTraversableOnce[String])(implicit bf: scala.collection.generic.CanBuildFrom[List[String],String,List[String]])List[String]">++</span>
      <span title="(elems: String*)Seq[String]">Seq</span><span class="delimiter">(</span><span title="java.lang.String(&quot;-cp&quot;)" class="string">&quot;-cp&quot;</span>, <a href="#49821" title="=&gt; String">classpath</a>, <a href="#49822" title="=&gt; String">mainClass</a><span class="delimiter">)</span> <span title="(that: scala.collection.GenTraversableOnce[String])(implicit bf: scala.collection.generic.CanBuildFrom[List[String],String,List[String]])List[String]">++</span> <a href="#49823" title="=&gt; Seq[String]">args</a>

    <a href="#48240" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Execing: &quot;)" class="string">&quot;Execing: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#48242" title="=&gt; List[String]">cmdLine</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.io.File" id="48244">tempDir</a> = <a href="#42767" title="()java.io.File">newTempDir</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Array[String]" id="48246">envp</a> = <a href="#49825" title="Map[String,String]">env</a>.<span title="(f: (String, String) =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[String,String],String,scala.collection.immutable.Iterable[String]])scala.collection.immutable.Iterable[String]">map</span> <a href="#49297" title="String" class="delimiter">{</a> <span class="keyword">case</span> <span title="String" class="delimiter">(</span><a title="String" id="49300">key</a>, <a title="String" id="49301">value</a><span class="delimiter">)</span> =&gt; <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;%s=%s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#49300" title="String">key</a>, <a href="#49301" title="String">value</a><span class="delimiter">)</span> <span class="delimiter">}</span>.<span title="(implicit evidence$1: ClassManifest[String])Array[String]">toArray</span>
    <span class="keyword">val</span> <a title="java.lang.Process" id="48248">proc</a> = <span title="object java.lang.Runtime">Runtime</span>.<span title="()java.lang.Runtime">getRuntime</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: Array[java.lang.String], x$2: Array[java.lang.String], x$3: java.io.File)java.lang.Process">exec</span><span class="delimiter">(</span><a href="#48242" title="=&gt; List[String]">cmdLine</a>.<span title="(p: String =&gt; Boolean)List[String]">filter</span><span class="delimiter">(</span><a href="#49455" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">_</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<span title="(implicit evidence$1: ClassManifest[String])Array[String]">toArray</span>, <a href="#48246" title="=&gt; Array[String]">envp</a>, <a href="#48244" title="=&gt; java.io.File">tempDir</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="deploylib.mesos.StreamTailer" id="48250">stdout</a> = <a href="mesos/Util.scala.html#65295" title="deploylib.mesos.StreamTailer" class="keyword">new</a> <a href="mesos/Util.scala.html#9717" title="deploylib.mesos.StreamTailer">StreamTailer</a><span class="delimiter">(</span><a href="#48248" title="=&gt; java.lang.Process">proc</a>.<span title="()java.io.InputStream">getInputStream</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="deploylib.mesos.StreamTailer" id="48252">stderr</a> = <a href="mesos/Util.scala.html#65295" title="deploylib.mesos.StreamTailer" class="keyword">new</a> <a href="mesos/Util.scala.html#9717" title="deploylib.mesos.StreamTailer">StreamTailer</a><span class="delimiter">(</span><a href="#48248" title="=&gt; java.lang.Process">proc</a>.<span title="()java.io.InputStream">getErrorStream</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; Array[Byte]" id="48254">output</a> = <span title="(xs: java.lang.Object*)List[java.lang.Object]">List</span><span class="delimiter">(</span><a href="#48242" title="=&gt; List[String]">cmdLine</a>, <a href="#42764" title="JavaExecutor.this.ForkedJvm" class="keyword">this</a>, <span title="java.lang.String(&quot;===stdout===&quot;)" class="string">&quot;===stdout===&quot;</span>, <a href="#48250" title="=&gt; deploylib.mesos.StreamTailer">stdout</a>.<a href="mesos/Util.scala.html#65291" title="=&gt; String">tail</a>, <span title="java.lang.String(&quot;===stderr===&quot;)" class="string">&quot;===stderr===&quot;</span>, <a href="#48252" title="=&gt; deploylib.mesos.StreamTailer">stderr</a>.<a href="mesos/Util.scala.html#65291" title="=&gt; String">tail</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>.<span title="()Array[Byte]">getBytes</span>
    <span class="keyword">val</span> <a title="java.lang.Thread" id="48255">taskThread</a> = <span title="(x$1: java.lang.Runnable, x$2: java.lang.String)java.lang.Thread" class="keyword">new</span> <span title="java.lang.Thread">Thread</span><span class="delimiter">(</span><a href="#42764" title="JavaExecutor.this.ForkedJvm" class="keyword">this</a>, <span title="java.lang.String(&quot;Task &quot;)" class="string">&quot;Task &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#49819" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;Monitor&quot;)" class="string">&quot;Monitor&quot;</span><span class="delimiter">)</span>
    @volatile <span class="keyword">var</span> <a title="Boolean" id="48258">taskKilled</a> = <span title="Boolean(false)" class="keyword">false</span>
    <a href="#48255" title="=&gt; java.lang.Thread">taskThread</a>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="()Unit" id="48260">run</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="#49826" title="org.apache.mesos.ExecutorDriver">driver</a>.<span title="(x$1: org.apache.mesos.Protos.TaskStatus)Int">sendStatusUpdate</span><span class="delimiter">(</span>
        <span title="object org.apache.mesos.Protos.TaskStatus">TaskStatus</span>.<span title="()org.apache.mesos.Protos.TaskStatus.Builder">newBuilder</span><span class="delimiter">(</span><span class="delimiter">)</span>
          .<span title="(x$1: org.apache.mesos.Protos.TaskID)org.apache.mesos.Protos.TaskStatus.Builder">setTaskId</span><span class="delimiter">(</span><a href="#49819" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
          .<span title="(x$1: org.apache.mesos.Protos.TaskState)org.apache.mesos.Protos.TaskStatus.Builder">setState</span><span class="delimiter">(</span>TaskState.<span title="org.apache.mesos.Protos.TaskState(value TASK_RUNNING)">TASK_RUNNING</span><span class="delimiter">)</span>
          .<span title="(x$1: com.google.protobuf.ByteString)org.apache.mesos.Protos.TaskStatus.Builder">setData</span><span class="delimiter">(</span><span title="object com.google.protobuf.ByteString">ByteString</span>.<span title="(x$1: Array[Byte])com.google.protobuf.ByteString">copyFrom</span><span class="delimiter">(</span><a href="#48254" title="=&gt; Array[Byte]">output</a><span class="delimiter">)</span><span class="delimiter">)</span>
          .<span title="()org.apache.mesos.Protos.TaskStatus">build</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="Int" id="49934">result</a> = <a href="#48248" title="=&gt; java.lang.Process">proc</a>.<span title="()Int">waitFor</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#48240" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;TASK %s exitied with code %d&quot;)" class="string">&quot;TASK %s exitied with code %d&quot;</span>, <a href="#49819" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span>, <a href="#49934" title="Int">result</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="org.apache.mesos.Protos.TaskState" id="49935">finalTaskState</a> = <a href="#49934" title="Int">result</a> <span title="org.apache.mesos.Protos.TaskState" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="org.apache.mesos.Protos.TaskState(value TASK_FINISHED)" class="int">0</span> =&gt; TaskState.<span title="org.apache.mesos.Protos.TaskState(value TASK_FINISHED)">TASK_FINISHED</span>
        <span class="keyword">case</span> <span title="org.apache.mesos.Protos.TaskState(value TASK_FAILED)">_</span> =&gt; TaskState.<span title="org.apache.mesos.Protos.TaskState(value TASK_FAILED)">TASK_FAILED</span>
      <span class="delimiter">}</span>
      <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#48258" title="=&gt; Boolean">taskKilled</a><span class="delimiter">)</span>
        <a href="#49826" title="org.apache.mesos.ExecutorDriver">driver</a>.<span title="(x$1: org.apache.mesos.Protos.TaskStatus)Int">sendStatusUpdate</span><span class="delimiter">(</span>
          <span title="object org.apache.mesos.Protos.TaskStatus">TaskStatus</span>.<span title="()org.apache.mesos.Protos.TaskStatus.Builder">newBuilder</span><span class="delimiter">(</span><span class="delimiter">)</span>
            .<span title="(x$1: org.apache.mesos.Protos.TaskID)org.apache.mesos.Protos.TaskStatus.Builder">setTaskId</span><span class="delimiter">(</span><a href="#49819" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
            .<span title="(x$1: org.apache.mesos.Protos.TaskState)org.apache.mesos.Protos.TaskStatus.Builder">setState</span><span class="delimiter">(</span><a href="#49935" title="org.apache.mesos.Protos.TaskState">finalTaskState</a><span class="delimiter">)</span>
            .<span title="(x$1: com.google.protobuf.ByteString)org.apache.mesos.Protos.TaskStatus.Builder">setData</span><span class="delimiter">(</span><span title="object com.google.protobuf.ByteString">ByteString</span>.<span title="(x$1: Array[Byte])com.google.protobuf.ByteString">copyFrom</span><span class="delimiter">(</span><a href="#48254" title="=&gt; Array[Byte]">output</a><span class="delimiter">)</span><span class="delimiter">)</span>
            .<span title="()org.apache.mesos.Protos.TaskStatus">build</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <span title="Any" class="keyword">if</span><span class="delimiter">(</span><a href="#48250" title="=&gt; deploylib.mesos.StreamTailer">stdout</a>.<a href="mesos/Util.scala.html#65291" title="=&gt; String">tail</a> <span title="(x$1: java.lang.CharSequence)Boolean">contains</span> <span title="java.lang.String(&quot;A fatal error has been detected by the Java Runtime Environment&quot;)" class="string">&quot;A fatal error has been detected by the Java Runtime Environment&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#48240" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;SIGSEGV from forked JVM.  Killing node.&quot;)" class="string">&quot;SIGSEGV from forked JVM.  Killing node.&quot;</span><span class="delimiter">)</span>
        <span title="object java.lang.Runtime">Runtime</span>.<span title="()java.lang.Runtime">getRuntime</span>.<span title="(x$1: java.lang.String)java.lang.Process">exec</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/sbin/halt&quot;)" class="string">&quot;/sbin/halt&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#48240" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Cleaning up working directory %s for %s&quot;)" class="string">&quot;Cleaning up working directory %s for %s&quot;</span>, <a href="#48244" title="=&gt; java.io.File">tempDir</a>, <a href="#49819" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
      <a href="#42774" title="(f: java.io.File)Unit">deleteRecursive</a><span class="delimiter">(</span><a href="#48244" title="=&gt; java.io.File">tempDir</a><span class="delimiter">)</span>
      <a href="#48240" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Done cleaning up after Task %s&quot;)" class="string">&quot;Done cleaning up after Task %s&quot;</span>, <a href="#49819" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; Unit" id="48261">kill</a> = <span class="delimiter">{</span>
      <a href="#48240" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Killing Task %s&quot;)" class="string">&quot;Killing Task %s&quot;</span>, <a href="#49819" title="=&gt; org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
      <a href="#48258" title="(x$1: Boolean)Unit">taskKilled</a> = <span title="Boolean(true)" class="keyword">true</span>
      <a href="#48248" title="=&gt; java.lang.Process">proc</a>.<span title="()Unit">destroy</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(classSource: deploylib.mesos.ClassSource)java.io.File" id="42765">resolveClassSource</a><span class="delimiter">(</span><a title="deploylib.mesos.ClassSource" id="50266">classSource</a>: <a href="mesos/Messages.scala.html#104925" title="deploylib.mesos.ClassSource">ClassSource</a><span class="delimiter">)</span>: <span title="java.io.File">File</span> = <a href="#50266" title="deploylib.mesos.ClassSource">classSource</a> <span title="java.io.File" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="java.io.File">ServerSideJar</span><span class="delimiter">(</span><a title="String" id="50305">path</a><span class="delimiter">)</span> =&gt; <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#50305" title="String">path</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="java.io.File">S3CachedJar</span><span class="delimiter">(</span><a title="String" id="50346">urlString</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.net.URL" id="50347">jarUrl</a> = <span title="(x$1: java.lang.String)java.net.URL" class="keyword">new</span> <span title="java.net.URL">URL</span><span class="delimiter">(</span><a href="#50346" title="String">urlString</a><span class="delimiter">)</span>

      <span class="comment">//Note: this makes the assumption that the name of the file is the Md5 hash of the file.</span>
      <span class="keyword">var</span> <a title="java.lang.String" id="50348">jarMd5</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#50347" title="java.net.URL">jarUrl</a>.<span title="()java.lang.String">getFile</span><span class="delimiter">)</span>.<span title="()java.lang.String">getName</span>
      <span class="keyword">val</span> <a title="java.io.File" id="50349">cachedJar</a> = <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#42758" title="=&gt; java.io.File">jarCache</a>, <a href="#50348" title="java.lang.String">jarMd5</a><span class="delimiter">)</span>

      <span class="comment">//TODO: Locks incase there are multiple executors on a machine</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#50349" title="java.io.File">cachedJar</a>.<span title="()Boolean">exists</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <span title="=&gt; Boolean">!</span><span class="delimiter">(</span><a href="Util.scala.html#9503" title="object deploylib.Util">Util</a>.<a href="Util.scala.html#30927" title="(file: java.io.File)String">md5</a><span class="delimiter">(</span><a href="#50349" title="java.io.File">cachedJar</a><span class="delimiter">)</span> <span title="(x$1: Any)Boolean">equals</span> <a href="#50348" title="java.lang.String">jarMd5</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="org.apache.commons.httpclient.methods.GetMethod" id="50482">method</a> = <span title="(x$1: java.lang.String)org.apache.commons.httpclient.methods.GetMethod" class="keyword">new</span> <span title="org.apache.commons.httpclient.methods.GetMethod">GetMethod</span><span class="delimiter">(</span><a href="#50346" title="String">urlString</a><span class="delimiter">)</span>
        <a href="#42752" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Downloading %s&quot;)" class="string">&quot;Downloading %s&quot;</span>, <a href="#50346" title="String">urlString</a><span class="delimiter">)</span>
        <a href="#42754" title="=&gt; org.apache.commons.httpclient.HttpClient">httpClient</a>.<span title="(x$1: org.apache.commons.httpclient.HttpMethod)Int">executeMethod</span><span class="delimiter">(</span><a href="#50482" title="org.apache.commons.httpclient.methods.GetMethod">method</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="java.io.InputStream" id="50483">instream</a> = <a href="#50482" title="org.apache.commons.httpclient.methods.GetMethod">method</a>.<span title="()java.io.InputStream">getResponseBodyAsStream</span>
        <span class="keyword">val</span> <a title="java.io.FileOutputStream" id="50484">outstream</a> = <span title="(x$1: java.io.File)java.io.FileOutputStream" class="keyword">new</span> <span title="java.io.FileOutputStream">FileOutputStream</span><span class="delimiter">(</span><a href="#50349" title="java.io.File">cachedJar</a><span class="delimiter">)</span>

        <span class="keyword">var</span> <a title="Int" id="50485">x</a> = <a href="#50483" title="java.io.InputStream">instream</a>.<span title="()Int">read</span>
        <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#50485" title="Int">x</a> <span title="(x: Int)Boolean">!=</span> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <a href="#50486" title="()Unit" class="delimiter">{</a>
          <a href="#50484" title="java.io.FileOutputStream">outstream</a>.<span title="(x$1: Int)Unit">write</span><span class="delimiter">(</span><a href="#50485" title="Int">x</a><span class="delimiter">)</span>
          <a href="#50485" title="Int">x</a> = <a href="#50483" title="java.io.InputStream">instream</a>.<span title="()Int">read</span>
        <span class="delimiter">}</span>
        <a href="#50483" title="java.io.InputStream">instream</a>.<span title="()Unit">close</span>
        <a href="#50484" title="java.io.FileOutputStream">outstream</a>.<span title="()Unit">close</span>
        <a href="#42752" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Download of %s complete&quot;)" class="string">&quot;Download of %s complete&quot;</span>, <a href="#50346" title="String">urlString</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#50349" title="java.io.File">cachedJar</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(classSources: Seq[deploylib.mesos.ClassSource])String" id="42766">loadClasspath</a><span class="delimiter">(</span><a title="Seq[deploylib.mesos.ClassSource]" id="51083">classSources</a>: <span title="Seq[deploylib.mesos.ClassSource]">Seq</span><span class="delimiter">[</span>ClassSource<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="String">String</span> = <a href="#51083" title="Seq[deploylib.mesos.ClassSource]">classSources</a>.<span title="(f: deploylib.mesos.ClassSource =&gt; java.io.File)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[deploylib.mesos.ClassSource],java.io.File,Seq[java.io.File]])Seq[java.io.File]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.io.File,Seq[java.io.File]]" class="delimiter">(</span><a href="#42765" title="(classSource: deploylib.mesos.ClassSource)java.io.File">resolveClassSource</a><span class="delimiter">)</span>.<span title="(f: java.io.File =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[java.io.File],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#51152" title="java.io.File">_</a>.<span title="()java.lang.String">getCanonicalPath</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span><span class="delimiter">)</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="()java.io.File" id="42767">newTempDir</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="java.io.File">File</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.io.File" id="51187">tempDir</a> = <span title="object java.io.File">File</span>.<span title="(x$1: java.lang.String, x$2: java.lang.String, x$3: java.io.File)java.io.File">createTempFile</span><span class="delimiter">(</span><span title="java.lang.String(&quot;workdir&quot;)" class="string">&quot;workdir&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <a href="#42756" title="=&gt; java.io.File">baseDir</a><span class="delimiter">)</span>
    <a href="#51187" title="java.io.File">tempDir</a>.<span title="()Boolean">delete</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#51187" title="java.io.File">tempDir</a>.<span title="()Boolean">mkdir</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#51187" title="java.io.File">tempDir</a>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(d: org.apache.mesos.ExecutorDriver, taskDesc: org.apache.mesos.Protos.TaskDescription)Unit" id="42768">launchTask</a><span class="delimiter">(</span><a title="org.apache.mesos.ExecutorDriver" id="51190">d</a>: <span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span>, <a title="org.apache.mesos.Protos.TaskDescription" id="51191">taskDesc</a>: <span title="org.apache.mesos.Protos.TaskDescription">TaskDescription</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#51190" title="org.apache.mesos.ExecutorDriver">d</a>.<span title="(x$1: org.apache.mesos.Protos.TaskStatus)Int">sendStatusUpdate</span><span class="delimiter">(</span>
      <span title="object org.apache.mesos.Protos.TaskStatus">TaskStatus</span>.<span title="()org.apache.mesos.Protos.TaskStatus.Builder">newBuilder</span><span class="delimiter">(</span><span class="delimiter">)</span>
        .<span title="(x$1: org.apache.mesos.Protos.TaskID)org.apache.mesos.Protos.TaskStatus.Builder">setTaskId</span><span class="delimiter">(</span><a href="#51191" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
        .<span title="(x$1: org.apache.mesos.Protos.TaskState)org.apache.mesos.Protos.TaskStatus.Builder">setState</span><span class="delimiter">(</span>TaskState.<span title="org.apache.mesos.Protos.TaskState(value TASK_STARTING)">TASK_STARTING</span><span class="delimiter">)</span>
        .<span title="()org.apache.mesos.Protos.TaskStatus">build</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Int" id="51193">launchDelay</a> = <span title="object scala.util.Random">Random</span>.<span title="(n: Int)Int">nextInt</span><span class="delimiter">(</span><span class="int">10</span> <span title="Int(10000)">*</span> <span class="int">1000</span><span class="delimiter">)</span>
    <a href="#42752" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Delaying startup %dms to avoid overloading zookeeper&quot;)" class="string">&quot;Delaying startup %dms to avoid overloading zookeeper&quot;</span>, <a href="#51193" title="Int">launchDelay</a><span class="delimiter">)</span>
    <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><a href="#51193" title="=&gt; Long">launchDelay</a><span class="delimiter">)</span>

    <a href="#42752" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Starting task&quot;)" class="string">&quot;Starting task&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#51191" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="JavaExecutor.this.RunningTask" id="51194">runningTask</a> = <a href="mesos/Messages.scala.html#58032" title="(bytes: Array[Byte])deploylib.mesos.JvmTask">JvmTask</a><span class="delimiter">(</span><a href="#51191" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()com.google.protobuf.ByteString">getData</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()Array[Byte]">toByteArray</span><span class="delimiter">)</span> <span title="JavaExecutor.this.RunningTask" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="JavaExecutor.this.ForkedJvm">JvmMainTask</span><span class="delimiter">(</span><a title="Seq[deploylib.mesos.ClassSource]" id="51328">classpath</a>, <a title="String" id="51329">mainclass</a>, <a title="Seq[String]" id="51330">args</a>, <a title="Map[String,String]" id="51331">props</a>, <a title="Map[String,String]" id="51332">env</a><span class="delimiter">)</span> =&gt;
        <span title="JavaExecutor.this.ForkedJvm" class="keyword">new</span> <a href="#42764" title="JavaExecutor.this.ForkedJvm">ForkedJvm</a><span class="delimiter">(</span><a href="#51191" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>,
          <a href="#51191" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="(l: java.util.List[org.apache.mesos.Protos.Resource])scala.collection.mutable.Buffer[org.apache.mesos.Protos.Resource]">getResourcesList</span>.<span title="(p: org.apache.mesos.Protos.Resource =&gt; Boolean)Option[org.apache.mesos.Protos.Resource]">find</span><span class="delimiter">(</span><a href="#51740" title="org.apache.mesos.Protos.Resource">_</a>.<span title="()java.lang.String">getName</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;mem&quot;)" class="string">&quot;mem&quot;</span><span class="delimiter">)</span>.<span title="(f: org.apache.mesos.Protos.Resource =&gt; Double)Option[Double]">map</span><span class="delimiter">(</span><a href="#51750" title="org.apache.mesos.Protos.Resource">_</a>.<span title="()org.apache.mesos.Protos.Resource.Scalar">getScalar</span>.<span title="()Double">getValue</span><span class="delimiter">)</span>.<span title="(default: =&gt; Double)Double">getOrElse</span><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;No memory specified in mesos task!&quot;)" class="string">&quot;No memory specified in mesos task!&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span>,
          <a href="#42766" title="(classSources: Seq[deploylib.mesos.ClassSource])String">loadClasspath</a><span class="delimiter">(</span><a href="#51328" title="Seq[deploylib.mesos.ClassSource]">classpath</a><span class="delimiter">)</span>,
          <a href="#51329" title="String">mainclass</a>,
          <a href="#51330" title="Seq[String]">args</a>,
          <a href="#51331" title="Map[String,String]">props</a>,
          <a href="#51332" title="Map[String,String]">env</a>, <a href="#51190" title="org.apache.mesos.ExecutorDriver">d</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="JavaExecutor.this.JettyApp">JvmWebAppTask</span><span class="delimiter">(</span><a title="deploylib.mesos.ClassSource" id="51864">warFile</a>, <a title="Map[String,String]" id="51865">properties</a><span class="delimiter">)</span> =&gt; <span title="JavaExecutor.this.JettyApp" class="keyword">new</span> <a href="#42763" title="JavaExecutor.this.JettyApp">JettyApp</a><span class="delimiter">(</span><a href="#51191" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>, <a href="#42765" title="(classSource: deploylib.mesos.ClassSource)java.io.File">resolveClassSource</a><span class="delimiter">(</span><a href="#51864" title="deploylib.mesos.ClassSource">warFile</a><span class="delimiter">)</span>, <a href="#51865" title="Map[String,String]">properties</a>, <a href="#51190" title="org.apache.mesos.ExecutorDriver">d</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#42760" title="=&gt; scala.collection.mutable.HashMap[String,JavaExecutor.this.RunningTask]">runningTasks</a> <span title="(kv: (String, JavaExecutor.this.RunningTask))JavaExecutor.this.runningTasks.type">+=</span> <span class="delimiter">(</span><span title="(_1: java.lang.String, _2: JavaExecutor.this.RunningTask)(java.lang.String, JavaExecutor.this.RunningTask)" class="delimiter">(</span><a href="#51191" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span>.<span title="()java.lang.String">getValue</span>, <a href="#51194" title="JavaExecutor.this.RunningTask">runningTask</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#42752" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Task %s started&quot;)" class="string">&quot;Task %s started&quot;</span>, <a href="#51191" title="org.apache.mesos.Protos.TaskDescription">taskDesc</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(d: org.apache.mesos.ExecutorDriver, taskId: org.apache.mesos.Protos.TaskID)Unit" id="42769">killTask</a><span class="delimiter">(</span><a title="org.apache.mesos.ExecutorDriver" id="51898">d</a>: <span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span>, <a title="org.apache.mesos.Protos.TaskID" id="51899">taskId</a>: <span title="org.apache.mesos.Protos.TaskID">TaskID</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#42760" title="=&gt; scala.collection.mutable.HashMap[String,JavaExecutor.this.RunningTask]">runningTasks</a>.<span title="(key: String)Option[JavaExecutor.this.RunningTask]">get</span><span class="delimiter">(</span><a href="#51899" title="org.apache.mesos.Protos.TaskID">taskId</a>.<span title="()java.lang.String">getValue</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="JavaExecutor.this.RunningTask" id="51912">runningTask</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#42752" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Killing task %s&quot;)" class="string">&quot;Killing task %s&quot;</span>, <a href="#51899" title="org.apache.mesos.Protos.TaskID">taskId</a><span class="delimiter">)</span>
        <a href="#51912" title="JavaExecutor.this.RunningTask">runningTask</a>.<a href="#43714" title="=&gt; Unit">kill</a>
        <a href="#51898" title="org.apache.mesos.ExecutorDriver">d</a>.<span title="(x$1: org.apache.mesos.Protos.TaskStatus)Int">sendStatusUpdate</span><span title="Unit" class="delimiter">(</span>
          <span title="object org.apache.mesos.Protos.TaskStatus">TaskStatus</span>.<span title="()org.apache.mesos.Protos.TaskStatus.Builder">newBuilder</span><span class="delimiter">(</span><span class="delimiter">)</span>
                    .<span title="(x$1: org.apache.mesos.Protos.TaskID)org.apache.mesos.Protos.TaskStatus.Builder">setTaskId</span><span class="delimiter">(</span><a href="#51899" title="org.apache.mesos.Protos.TaskID">taskId</a><span class="delimiter">)</span>
                    .<span title="()org.apache.mesos.Protos.TaskStatus">build</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="Unit">None</span> =&gt; <a href="#42752" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Asked to kill nonexistant task %s&quot;)" class="string">&quot;Asked to kill nonexistant task %s&quot;</span>, <a href="#51899" title="org.apache.mesos.Protos.TaskID">taskId</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.ExecutorDriver, code: Int, msg: String)Unit" id="42770">error</a><span class="delimiter">(</span><a title="org.apache.mesos.ExecutorDriver" id="51928">driver</a>: <span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span>, <a title="Int" id="51929">code</a>: <span title="Int">Int</span>, <a title="String" id="51930">msg</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#42752" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;MESOS ERROR %d: %s&quot;)" class="string">&quot;MESOS ERROR %d: %s&quot;</span>, <a href="#51929" title="Int">code</a>, <a href="#51930" title="String">msg</a><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.ExecutorDriver)Unit" id="42771">shutdown</a><span class="delimiter">(</span><a title="org.apache.mesos.ExecutorDriver" id="51936">driver</a>: <span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#42752" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Executor shutting down&quot;)" class="string">&quot;Executor shutting down&quot;</span><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.ExecutorDriver, data: Array[Byte])Unit" id="42772">frameworkMessage</a><span class="delimiter">(</span><a title="org.apache.mesos.ExecutorDriver" id="51940">driver</a>: <span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span>, <a title="Array[Byte]" id="51941">data</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#42752" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Received FW Message: %s&quot;)" class="string">&quot;Received FW Message: %s&quot;</span>, <a href="#51941" title="Array[Byte]">data</a><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.ExecutorDriver, args: org.apache.mesos.Protos.ExecutorArgs)Unit" id="42773">init</a><span class="delimiter">(</span><a title="org.apache.mesos.ExecutorDriver" id="51947">driver</a>:<span title="org.apache.mesos.ExecutorDriver">ExecutorDriver</span>, <a title="org.apache.mesos.Protos.ExecutorArgs" id="51948">args</a>: <span title="org.apache.mesos.Protos.ExecutorArgs">ExecutorArgs</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#42752" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Executor Init: %s&quot;)" class="string">&quot;Executor Init: %s&quot;</span>, <a href="#51948" title="org.apache.mesos.Protos.ExecutorArgs">args</a><span class="delimiter">)</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(f: java.io.File)Unit" id="42774">deleteRecursive</a><span class="delimiter">(</span><a title="java.io.File" id="50253">f</a>: <span title="java.io.File">File</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#50253" title="java.io.File">f</a>.<span title="()Boolean">isDirectory</span><span class="delimiter">)</span>
      <a href="#50253" title="java.io.File">f</a>.<span title="(xs: Array[java.io.File])scala.collection.mutable.ArrayOps[java.io.File]">listFiles</span>.<span title="(f: java.io.File =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#42774" title="(f: java.io.File)Unit">deleteRecursive</a><span class="delimiter">)</span>
    <a href="#50253" title="java.io.File">f</a>.<span title="()Boolean">delete</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>