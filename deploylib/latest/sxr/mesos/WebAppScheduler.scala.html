<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>mesos/WebAppScheduler.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> deploylib
<span class="keyword">package</span> mesos

<span class="keyword">import</span> java.net.URL
<span class="keyword">import</span> java.sql.<span class="delimiter">{</span>Connection, DriverManager, ResultSet, SQLException<span class="delimiter">}</span>
<span class="keyword">import</span> java.util.Date

<span class="keyword">import</span> org.apache.mesos._
<span class="keyword">import</span> org.apache.mesos.<span title="object org.apache.mesos.Protos">Protos</span>._
<span class="keyword">import</span> com.google.protobuf.ByteString


<span class="keyword">import</span> edu.berkeley.cs.scads.comm._
<span class="keyword">import</span> net.lag.logging.Logger
<span class="keyword">import</span> scala.collection.<span title="object scala.collection.JavaConversions">JavaConversions</span>._
<span class="keyword">import</span> scala.collection.immutable.HashMap

<span class="keyword">import</span> org.apache.commons.httpclient._
<span class="keyword">import</span> org.apache.commons.httpclient.methods._
<span class="keyword">import</span> org.apache.commons.httpclient.params._

<span class="keyword">object</span> <a title="object deploylib.mesos.WebAppScheduler" id="9682">WebAppScheduler</a> <span title="ScalaObject" class="delimiter">{</span>
  <span title="object java.lang.System">System</span>.<span title="(x$1: java.lang.String)Unit">loadLibrary</span><span class="delimiter">(</span><span title="java.lang.String(&quot;mesos&quot;)" class="string">&quot;mesos&quot;</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/* serverCapacity is the number of requests per second that a single application server can handle */</span>
<span class="keyword">class</span> <a title="class WebAppScheduler extends java.lang.Object with org.apache.mesos.Scheduler with ScalaObject" id="9684">WebAppScheduler</a> <a href="#9684" title="ScalaObject" class="keyword">protected</a><span class="delimiter">(</span><a title="String" id="77245">name</a>: <span title="String">String</span>, <a title="String" id="77246">mesosMaster</a>: <span title="String">String</span>, <a title="String" id="77247">executor</a>: <span title="String">String</span>, <a title="edu.berkeley.cs.scads.comm.ClassSource" id="77248">warFile</a>: <span title="edu.berkeley.cs.scads.comm.ClassSource">ClassSource</span>, <a title="Map[String,String]" id="77249">properties</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="String" id="77250">zkWebServerListRoot</a>: <span title="String">String</span>, <a title="Int" id="77251">serverCapacity</a>: <span title="Int">Int</span>, <span class="keyword">var</span> <a title="Int" id="77252">minServers</a>: <span title="Int">Int</span>, <a title="=&gt; Option[String]" id="77253">statsServer</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span title="object None">None</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="org.apache.mesos.Scheduler">Scheduler</span> <span class="delimiter">{</span>
  scheduler =&gt;

  <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="77175">logger</a> = <span title="()net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">var</span> <a title="List[String =&gt; Unit]" id="77178">listeners</a>: <span title="List[String =&gt; Unit]">List</span><span class="delimiter">[</span>String =&gt; Unit<span class="delimiter">]</span> = <span title="object Nil">Nil</span>
  <span class="keyword">var</span> <a title="org.apache.mesos.MesosSchedulerDriver" id="77181">driver</a> = <span title="(x$1: org.apache.mesos.Scheduler, x$2: java.lang.String)org.apache.mesos.MesosSchedulerDriver" class="keyword">new</span> <span title="org.apache.mesos.MesosSchedulerDriver">MesosSchedulerDriver</span><span class="delimiter">(</span><a href="#9684" title="deploylib.mesos.WebAppScheduler" class="keyword">this</a>, <a href="#77246" title="String">mesosMaster</a><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="java.lang.Thread" id="77183">driverThread</a> = <a href="#77362" title="java.lang.Thread" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Thread" id="77362">Thread</a><span class="delimiter">(</span><span title="java.lang.String(&quot;ExperimentScheduler Mesos Driver Thread&quot;)" class="string">&quot;ExperimentScheduler Mesos Driver Thread&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="77364">run</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#77181" title="=&gt; org.apache.mesos.MesosSchedulerDriver">driver</a>.<span title="()Int">run</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">//set up mysql connection for statistics</span>
  <span class="keyword">val</span> <a title="Option[Option[java.sql.Statement]]" id="77185">statement</a> = <a href="#77253" title="Option[String]">statsServer</a>.<span title="(f: String =&gt; Option[java.sql.Statement])Option[Option[java.sql.Statement]]">map</span><span class="delimiter">(</span><a title="String" id="77382">connString</a> =&gt; <span class="delimiter">{</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.sql.Connection" id="77383">conn</a> = <span title="object java.sql.DriverManager">DriverManager</span>.<span title="(x$1: java.lang.String)java.sql.Connection">getConnection</span><span class="delimiter">(</span><a href="#77382" title="String">connString</a><span class="delimiter">)</span>
      <span title="(x: java.sql.Statement)Some[java.sql.Statement]">Some</span><span class="delimiter">(</span><a href="#77383" title="java.sql.Connection">conn</a>.<span title="(x$1: Int, x$2: Int)java.sql.Statement">createStatement</span><span class="delimiter">(</span>ResultSet.<span title="Int(1003)">TYPE_FORWARD_ONLY</span>, ResultSet.<span title="Int(1008)">CONCUR_UPDATABLE</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="None.type" id="78081">e</a>: <span title="java.sql.SQLException">SQLException</span> =&gt; <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Connection to SQL Database failed with connection string %s.&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#77382" title="String">connString</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="object None">None</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(func: String =&gt; Unit)Unit" id="77187">registerActionListener</a><span class="delimiter">(</span><a title="String =&gt; Unit" id="78528">func</a>: String =&gt; Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#77178" title="(x$1: List[String =&gt; Unit])Unit">listeners</a> <span title="(x: String =&gt; Unit)List[String =&gt; Unit]">::=</span> <a href="#78528" title="String =&gt; Unit">func</a>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(action: String)Unit" id="77188">recordAction</a><span class="delimiter">(</span><a title="String" id="78539">action</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#77178" title="=&gt; List[String =&gt; Unit]">listeners</a>.<span title="(f: String =&gt; Unit =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#78570" title="(v1: String)Unit">_</a><span class="delimiter">(</span><a href="#78539" title="String">action</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="Int" id="77189">port</a> = <span title="Int(8080)" class="int">8080</span>
  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode" id="77191">zkWebServerList</a> = <span title="(uri: String)edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">ZooKeeperNode</span><span class="delimiter">(</span><a href="#77250" title="String">zkWebServerListRoot</a><span class="delimiter">)</span>
  <span class="keyword">var</span> <a title="Boolean" id="77194">runMonitorThread</a> = <span title="Boolean(true)" class="keyword">true</span>
  <span class="keyword">var</span> <a title="Int" id="77197">numToKill</a> = <span title="Int(0)" class="int">0</span>
  <span class="keyword">var</span> <a title="Int" id="77200">killTimer</a> = <span title="Int(0)" class="int">0</span>
  @volatile <span class="keyword">var</span> <a title="Int" id="77203">targetNumServers</a>: <span title="Int">Int</span> = <a href="#77252" title="=&gt; Int">minServers</a>
  <span class="keyword">var</span> <a title="Double" id="77206">smoothedWorkload</a> = <span title="Double(0.0)" class="double">0.0</span>
  <span class="comment">// The smoothed version of the aggregate workload</span>
  <span class="keyword">var</span> <a title="Double" id="77209">smoothedUtilization</a> = <span title="Double(0.0)" class="double">0.0</span>
  <span class="keyword">var</span> <a title="scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]" id="77212">servers</a> = <span title="scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]" class="keyword">new</span> <span title="scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">HashMap</span><span class="delimiter">[</span>TaskID, String<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">var</span> <a title="scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]" id="77215">pendingServers</a> = <span title="scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]" class="keyword">new</span> <span title="scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">HashMap</span><span class="delimiter">[</span>TaskID, String<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">var</span> <a title="scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,Int]" id="77218">unresponsiveServers</a> = <span title="scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,Int]" class="keyword">new</span> <span title="scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,Int]">HashMap</span><span class="delimiter">[</span>TaskID, Int<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Periodically query all of the webapp servers currently thought
   * to be alive (i.e. in the servers HashMap), calculate the aggregate
   * request rate to the application, and then derive the target number
   * of webapp servers necessary to satisfy that request rate. Kill some
   * webapp server mesos tasks if the app is currently over provisioned.
   * If more are needed, they will be acquired by resourceOffer().
   *
   * @param period - frequency with which targetNumServers recalculated
   * @param unresponsiveRequestLimit - Wait to kill a webapp server until you have failed to retrieve its request rate this many times.
   * @param rampUpWorkloadWeight - Smooth adding webapp servers by weighing in history. Must be geq 0.0 and lt 1.0.
   * @param rampDownWorkloadWeight - Smooth killing webapp servers by weighing in history. Must be geq 0.0 and lt 1.0.
   */</span>
  <span class="keyword">class</span> <a title="class monitorThread extends java.lang.Object with java.lang.Runnable with ScalaObject" id="77221">monitorThread</a><a href="#77221" title="ScalaObject" class="delimiter">(</a><a title="Int" id="78502">period</a>: <span title="Int">Int</span> = <span class="int">1000</span> <span title="Int(30000)">*</span> <span class="int">30</span>,
                      <a title="Int" id="78503">unresponsiveRequestLimit</a>: <span title="Int">Int</span> = <span title="Int(3)" class="int">3</span>,
                      <a title="Double" id="78504">rampUpWorkloadWeight</a>: <span title="Double">Double</span> = <span title="Double(0.9)" class="double">0.9</span>,
                      <a title="Double" id="78505">rampDownWorkloadWeight</a>: <span title="Double">Double</span> = <span title="Double(0.01)" class="double">0.01</span>,
                      <a title="Double" id="78506">rampUpUtilizationWeight</a>: <span title="Double">Double</span> = <span title="Double(0.9)" class="double">0.9</span>,
                      <a title="Double" id="78507">rampDownUtilizationWeight</a>: <span title="Double">Double</span> = <span title="Double(0.05)" class="double">0.05</span>,
                      <a title="Double" id="78508">utilizationThreshold</a>: <span title="Double">Double</span> = <span title="Double(0.4)" class="double">0.40</span>
                       <span class="delimiter">)</span> <span class="keyword">extends</span> <span title="java.lang.Runnable">Runnable</span> <span class="delimiter">{</span>
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="org.apache.commons.httpclient.params.HttpClientParams" id="78489">params</a> = <span title="org.apache.commons.httpclient.params.HttpClientParams" class="keyword">new</span> <span title="org.apache.commons.httpclient.params.HttpClientParams">HttpClientParams</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#78489" title="=&gt; org.apache.commons.httpclient.params.HttpClientParams">params</a>.<span title="(x$1: Int)Unit">setSoTimeout</span><span class="delimiter">(</span><span title="Int(5000)" class="int">5000</span><span class="delimiter">)</span>
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="org.apache.commons.httpclient.HttpClient" id="78491">httpClient</a> = <span title="(x$1: org.apache.commons.httpclient.params.HttpClientParams)org.apache.commons.httpclient.HttpClient" class="keyword">new</span> <span title="org.apache.commons.httpclient.HttpClient">HttpClient</span><span class="delimiter">(</span><a href="#78489" title="=&gt; org.apache.commons.httpclient.params.HttpClientParams">params</a><span class="delimiter">)</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="78493">run</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#77194" title="=&gt; Boolean">runMonitorThread</a><span class="delimiter">)</span> <a href="#78593" title="()Unit" class="delimiter">{</a>
        <span class="comment">// Calculate the average web server request rate</span>
        <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Beginging collection of workload statistics&quot;)" class="string">&quot;Beginging collection of workload statistics&quot;</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Seq[(Double, Double)]" id="78594">stats</a> = <span class="keyword">for</span> <span class="delimiter">(</span><span class="delimiter">(</span><a title="org.apache.mesos.Protos.TaskID" id="78666">taskID</a>, <a title="String" id="78667">slaveHostname</a><span class="delimiter">)</span> &lt;- <a href="#77212" title="=&gt; scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">servers</a>.<a href="#78639" title="(f: (org.apache.mesos.Protos.TaskID, String) =&gt; (Double, Double))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(org.apache.mesos.Protos.TaskID, String)],(Double, Double),Seq[(Double, Double)]])Seq[(Double, Double)]">toSeq</a><span class="delimiter">)</span> <span class="keyword">yield</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="String" id="78668">slaveUrl</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;http://%s:%d/stats/&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#78667" title="String">slaveHostname</a>, <a href="#77189" title="=&gt; Int">port</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="org.apache.commons.httpclient.methods.GetMethod" id="78669">method</a> = <span title="(x$1: java.lang.String)org.apache.commons.httpclient.methods.GetMethod" class="keyword">new</span> <span title="org.apache.commons.httpclient.methods.GetMethod">GetMethod</span><span class="delimiter">(</span><a href="#78668" title="String">slaveUrl</a><span class="delimiter">)</span>
          <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Getting status from %s.&quot;)" class="string">&quot;Getting status from %s.&quot;</span>, <a href="#78668" title="String">slaveUrl</a><span class="delimiter">)</span>
          <span class="keyword">try</span> <span class="delimiter">{</span>
            <a href="#78491" title="=&gt; org.apache.commons.httpclient.HttpClient">httpClient</a>.<span title="(x$1: org.apache.commons.httpclient.HttpMethod)Int">executeMethod</span><span class="delimiter">(</span><a href="#78669" title="org.apache.commons.httpclient.methods.GetMethod">method</a><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="scala.xml.Elem" id="78679">xml</a> = scala.xml.<span title="object scala.xml.XML">XML</span>.<span title="(string: String)scala.xml.Elem">loadString</span><span class="delimiter">(</span><a href="#78669" title="org.apache.commons.httpclient.methods.GetMethod">method</a>.<span title="()java.lang.String">getResponseBodyAsString</span><span class="delimiter">)</span>
            <a href="#77218" title="(x$1: scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,Int])Unit">unresponsiveServers</a> <span title="(key: org.apache.mesos.Protos.TaskID)scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,Int]">-=</span> <a href="#78666" title="org.apache.mesos.Protos.TaskID">taskID</a>
            <span title="(_1: Double, _2: Double)(Double, Double)" class="delimiter">(</span><span class="delimiter">(</span><a href="#78679" title="scala.xml.Elem">xml</a> <span title="(that: String)scala.xml.NodeSeq">\</span> <span title="java.lang.String(&quot;RequestRate&quot;)" class="string">&quot;RequestRate&quot;</span><span class="delimiter">)</span>.<span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">text</span>.<span title="=&gt; Double">toDouble</span>, <span class="delimiter">(</span><a href="#78679" title="scala.xml.Elem">xml</a> <span title="(that: String)scala.xml.NodeSeq">\</span> <span title="java.lang.String(&quot;CpuUtilization&quot;)" class="string">&quot;CpuUtilization&quot;</span><span class="delimiter">)</span>.<span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">text</span>.<span title="=&gt; Double">toDouble</span><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a title="(Double, Double)" id="78965">e</a> =&gt;
              <a href="#77218" title="(x$1: scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,Int])Unit">unresponsiveServers</a> <span title="(kv: (org.apache.mesos.Protos.TaskID, Int))scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,Int]">+=</span> <a href="#78666" title="(x: org.apache.mesos.Protos.TaskID)ArrowAssoc[org.apache.mesos.Protos.TaskID]">taskID</a> <span title="(y: Int)(org.apache.mesos.Protos.TaskID, Int)">-&gt;</span> <span class="delimiter">(</span><a href="#77218" title="=&gt; scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,Int]">unresponsiveServers</a>.<span title="(key: org.apache.mesos.Protos.TaskID)Option[Int]">get</span><span class="delimiter">(</span><a href="#78666" title="org.apache.mesos.Protos.TaskID">taskID</a><span class="delimiter">)</span>.<span title="(default: =&gt; Int)Int">getOrElse</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
              <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Couldn\'t get RequestRate from %s for %d iterations..&quot;)" class="string">&quot;Couldn't get RequestRate from %s for %d iterations..&quot;</span>, <a href="#78668" title="String">slaveUrl</a>, <a href="#77218" title="(key: org.apache.mesos.Protos.TaskID)Int">unresponsiveServers</a><span class="delimiter">(</span><a href="#78666" title="org.apache.mesos.Protos.TaskID">taskID</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#77218" title="(key: org.apache.mesos.Protos.TaskID)Int">unresponsiveServers</a><span class="delimiter">(</span><a href="#78666" title="org.apache.mesos.Protos.TaskID">taskID</a><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;</span> <a href="#78503" title="Int">unresponsiveRequestLimit</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#77181" title="=&gt; org.apache.mesos.MesosSchedulerDriver">driver</a>.<span title="(x$1: org.apache.mesos.Protos.TaskID)Int">killTask</span><span class="delimiter">(</span><a href="#78666" title="org.apache.mesos.Protos.TaskID">taskID</a><span class="delimiter">)</span>
                <a href="#77212" title="(x$1: scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String])Unit">servers</a> <span title="(key: org.apache.mesos.Protos.TaskID)scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">-=</span> <a href="#78666" title="org.apache.mesos.Protos.TaskID">taskID</a>
                <a href="#77188" title="(action: String)Unit">recordAction</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Webapp Director killed an unresponsive webapp server of %s's. Weakness will not be tolerated!&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#77245" title="String">name</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
              <span title="(_1: Double, _2: Double)(Double, Double)" class="delimiter">(</span><span title="Double(0.0)" class="double">0.0</span>, <span title="Double(0.0)" class="double">0.0</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>

        <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Current Workload: %s&quot;)" class="string">&quot;Current Workload: %s&quot;</span>, <a href="#78594" title="Seq[(Double, Double)]">stats</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Double" id="78595">aggregateReqRate</a> = <a href="#78594" title="Seq[(Double, Double)]">stats</a>.<span title="(f: (Double, Double) =&gt; Double)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Double, Double)],Double,Seq[Double]])Seq[Double]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Double,Seq[Double]]" class="delimiter">(</span><a href="#79197" title="(Double, Double)">_</a>.<span title="=&gt; Double">_1</span><span class="delimiter">)</span>.<span title="(implicit num: Numeric[Double])Double">sum</span>
        <span class="keyword">val</span> <a title="Double" id="78596">totalUtilization</a> = <a href="#78594" title="Seq[(Double, Double)]">stats</a>.<span title="(f: (Double, Double) =&gt; Double)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Double, Double)],Double,Seq[Double]])Seq[Double]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Double,Seq[Double]]" class="delimiter">(</span><a href="#79690" title="(Double, Double)">_</a>.<span title="=&gt; Double">_2</span><span class="delimiter">)</span>.<span title="(implicit num: Numeric[Double])Double">sum</span>
        <span class="keyword">val</span> <a title="Double" id="78597">averageUtilization</a> = <a href="#78596" title="Double">totalUtilization</a> <span title="(x: Int)Double">/</span> <a href="#77212" title="=&gt; scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">servers</a>.<span title="=&gt; Int">size</span>

        <span class="comment">/*
          if (aggregateReqRate &gt; smoothedWorkload) { // ramping up
            smoothedWorkload = smoothedWorkload + (aggregateReqRate - smoothedWorkload) * rampUpWorkloadWeight
          } else { // ramping down
            smoothedWorkload = smoothedWorkload + (aggregateReqRate - smoothedWorkload) * rampDownWorkloadWeight
          }
          targetNumServers = math.max(minServers, math.ceil(smoothedWorkload / serverCapacity).toInt)
    */</span>

        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#78596" title="Double">totalUtilization</a> <span title="(x: Double)Boolean">&gt;</span> <a href="#77209" title="=&gt; Double">smoothedUtilization</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#77209" title="(x$1: Double)Unit">smoothedUtilization</a> = <a href="#77209" title="=&gt; Double">smoothedUtilization</a> <span title="(x: Double)Double">+</span> <span class="delimiter">(</span><a href="#78596" title="Double">totalUtilization</a> <span title="(x: Double)Double">-</span> <a href="#77209" title="=&gt; Double">smoothedUtilization</a><span class="delimiter">)</span> <span title="(x: Double)Double">*</span> <a href="#78506" title="Double">rampUpUtilizationWeight</a>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="comment">// ramping down</span>
          <a href="#77209" title="(x$1: Double)Unit">smoothedUtilization</a> = <a href="#77209" title="=&gt; Double">smoothedUtilization</a> <span title="(x: Double)Double">+</span> <span class="delimiter">(</span><a href="#78596" title="Double">totalUtilization</a> <span title="(x: Double)Double">-</span> <a href="#77209" title="=&gt; Double">smoothedUtilization</a><span class="delimiter">)</span> <span title="(x: Double)Double">*</span> <a href="#78507" title="Double">rampDownUtilizationWeight</a>
        <span class="delimiter">}</span>
        <a href="#77203" title="(x$1: Int)Unit">targetNumServers</a> = math.<span title="(x: Int, y: Int)Int">max</span><span class="delimiter">(</span><a href="#77252" title="=&gt; Int">minServers</a>, math.<span title="(x: Double)Double">ceil</span><span class="delimiter">(</span><a href="#77209" title="=&gt; Double">smoothedUtilization</a> <span title="(x: Double)Double">/</span> <a href="#78508" title="Double">utilizationThreshold</a><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span><span class="delimiter">)</span>

        <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Current Aggregate Workload: %f req/sec (%f smoothed), targetServers=%d&quot;)" class="string">&quot;Current Aggregate Workload: %f req/sec (%f smoothed), targetServers=%d&quot;</span>, <a href="#78595" title="Double">aggregateReqRate</a>, <a href="#77206" title="=&gt; Double">smoothedWorkload</a>, <a href="#77203" title="=&gt; Int">targetNumServers</a><span class="delimiter">)</span>

        <span class="comment">//TODO: Error Handling</span>
        <a href="#77185" title="=&gt; Option[Option[java.sql.Statement]]">statement</a>.<span title="(f: Option[java.sql.Statement] =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Option[java.sql.Statement]" id="79773">s</a> =&gt; <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="java.util.Date" id="79774">now</a> = <span title="java.util.Date" class="keyword">new</span> <span title="java.util.Date">Date</span>
          <span class="keyword">val</span> <a title="java.lang.String" id="79775">sqlInsertCmd</a> = <span title="java.lang.String(&quot;INSERT INTO appReqRate (timestamp, webAppID, aggRequestRate, targetNumServers, actualNumServers, averageUtilization)&quot;)" class="string">&quot;INSERT INTO appReqRate (timestamp, webAppID, aggRequestRate, targetNumServers, actualNumServers, averageUtilization)&quot;</span> <span title="(x$1: Any)java.lang.String">+</span>
            <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;VALUES (%d, '%s', %f, %d, %d, %f)&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#79774" title="java.util.Date">now</a>.<span title="()Long">getTime</span>, <a href="#77245" title="String">name</a>, <a href="#78595" title="Double">aggregateReqRate</a>, <a href="#77203" title="=&gt; Int">targetNumServers</a>.<span title="=&gt; Int">toInt</span>, <a href="#77212" title="=&gt; scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">servers</a>.<span title="=&gt; Int">size</span>, <a href="#78597" title="Double">averageUtilization</a><span class="delimiter">)</span>
          <span class="keyword">try</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="Option[Int]" id="79854">numResults</a> = <a href="#79773" title="Option[java.sql.Statement]">s</a>.<span title="(f: java.sql.Statement =&gt; Int)Option[Int]">map</span><span class="delimiter">(</span><a href="#79859" title="java.sql.Statement">_</a>.<span title="(x$1: java.lang.String)Int">executeUpdate</span><span class="delimiter">(</span><a href="#79775" title="java.lang.String">sqlInsertCmd</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#79854" title="Option[Int]">numResults</a>.<span title="(default: =&gt; Int)Int">getOrElse</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
              <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;SQL INSERT statment failed.&quot;)" class="string">&quot;SQL INSERT statment failed.&quot;</span><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a title="Unit" id="79875">e</a>: <span title="java.sql.SQLException">SQLException</span> =&gt; <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(thrown: Throwable, msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><a href="#79875" title="java.sql.SQLException">e</a>, <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;SQL INSERT statement failed: %s.&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#79775" title="java.lang.String">sqlInsertCmd</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>

        <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;aggregateReqRate is &quot;)" class="string">&quot;aggregateReqRate is &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#78595" title="Double">aggregateReqRate</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;, targetNumServers is &quot;)" class="string">&quot;, targetNumServers is &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#77203" title="=&gt; Int">targetNumServers</a><span class="delimiter">)</span>

        <span class="comment">// if necessary, kill backends</span>
        <span class="keyword">val</span> <a title="Int" id="78598">numToKill</a> = <a href="#77212" title="=&gt; scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">servers</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">-</span> <a href="#77203" title="implicit scala.LowPriorityImplicits.floatWrapper : (x: Float)scala.runtime.RichFloat">targetNumServers</a>.<span title="=&gt; Float">ceil</span>.<span title="=&gt; Int">toInt</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#78598" title="Int">numToKill</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#77223" title="(numServers: Int)Unit">killTasks</a><span class="delimiter">(</span><a href="#78598" title="Int">numToKill</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><a href="#78502" title="=&gt; Long">period</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(numServers: Int)Unit" id="77223">killTasks</a><span class="delimiter">(</span><a title="Int" id="79901">numServers</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Calling driver.kill() for %d webservers.&quot;)" class="string">&quot;Calling driver.kill() for %d webservers.&quot;</span>, <a href="#77197" title="=&gt; Int">numToKill</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]" id="79904">toKill</a> = <a href="#77212" title="=&gt; scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">servers</a>.<span title="(n: Int)scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">take</span><span class="delimiter">(</span><a href="#77197" title="=&gt; Int">numToKill</a><span class="delimiter">)</span>
    <a href="#79904" title="scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">toKill</a>.<span title="(f: (org.apache.mesos.Protos.TaskID, String) =&gt; Unit)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String],Unit,scala.collection.immutable.Iterable[Unit]])scala.collection.immutable.Iterable[Unit]">map</span> <a href="#79926" title="Unit" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="Unit" class="delimiter">(</span><a title="org.apache.mesos.Protos.TaskID" id="79929">victimID</a>, <a title="String" id="79930">victimHost</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Killing task %d on node %s.&quot;)" class="string">&quot;Killing task %d on node %s.&quot;</span>, <a href="#79929" title="org.apache.mesos.Protos.TaskID">victimID</a>, <a href="#79930" title="String">victimHost</a><span class="delimiter">)</span>
        <a href="#77181" title="=&gt; org.apache.mesos.MesosSchedulerDriver">driver</a>.<span title="(x$1: org.apache.mesos.Protos.TaskID)Int">killTask</span><span class="delimiter">(</span><a href="#79929" title="org.apache.mesos.Protos.TaskID">victimID</a><span class="delimiter">)</span>
        <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Removing webserver task &quot;)" class="string">&quot;Removing webserver task &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#79929" title="org.apache.mesos.Protos.TaskID">victimID</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; on host &quot;)" class="string">&quot; on host &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#79930" title="String">victimHost</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; from hashmap of servers.&quot;)" class="string">&quot; from hashmap of servers.&quot;</span><span class="delimiter">)</span>
        <a href="#77188" title="(action: String)Unit">recordAction</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Webapp Director killed an unecessary webapp server of %s's. Inefficiencies will not be tolerated!&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#77245" title="String">name</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#77212" title="(x$1: scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String])Unit">servers</a> <span title="(key: org.apache.mesos.Protos.TaskID)scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">-=</span> <a href="#79929" title="org.apache.mesos.Protos.TaskID">victimID</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#77239" title="()Unit">updateZooWebServerList</a><span class="delimiter">(</span><span class="delimiter">)</span>;
  <span class="delimiter">}</span>

  <span class="keyword">val</span> <a title="java.lang.Thread" id="77224">monitoringThread</a> = <span title="(x$1: java.lang.Runnable, x$2: java.lang.String)java.lang.Thread" class="keyword">new</span> <span title="java.lang.Thread">Thread</span><span class="delimiter">(</span><a href="#78502" title="WebAppScheduler.this.monitorThread" class="keyword">new</a> <a href="#77221" title="WebAppScheduler.this.monitorThread">monitorThread</a><span class="delimiter">(</span><span class="delimiter">)</span>, <span title="java.lang.String(&quot;WebAppScheduler Monitoring Thread&quot;)" class="string">&quot;WebAppScheduler Monitoring Thread&quot;</span><span class="delimiter">)</span>
  <a href="#77224" title="=&gt; java.lang.Thread">monitoringThread</a>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <a href="#77183" title="=&gt; java.lang.Thread">driverThread</a>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Periodically sends an http GET request to a server until it responds
   * with a status 200 or until a timeout. If the timeout is reached, kills
   * the mesos task so that it doesn't become a zombie task.
   *
   * @param taskId - the mesos taskId associated with this web app server.
   * @param serverHostname - the hostname of the web app server that was started.
   * @param sleepPeriod - how often, in ms, to check for a successful server response. Default is 10 seconds.
   * @param timeout - how long, in ms, to spend checking for an http 200 status response before giving up and killing the mesos task associated with the server. Default is 5 minutes.
   */</span>
  <span class="keyword">class</span> <a title="class WebAppPrimerThread extends java.lang.Object with java.lang.Runnable with ScalaObject" id="77227">WebAppPrimerThread</a><a href="#77227" title="ScalaObject" class="delimiter">(</a><a title="org.apache.mesos.Protos.TaskID" id="80066">taskId</a>: <span title="org.apache.mesos.Protos.TaskID">TaskID</span>, <a title="String" id="80067">serverHostname</a>: <span title="String">String</span>, <a title="Int" id="80072">numSuccessRequired</a>: <span title="Int">Int</span> = <span title="Int(100)" class="int">100</span>, <a title="Int" id="80073">sleepPeriod</a>: <span title="Int">Int</span> = <span class="int">10</span> <span title="Int(10000)">*</span> <span class="int">1000</span>, <a title="Int" id="80074">timeout</a>: <span title="Int">Int</span> = <span class="int">5</span> * <span class="int">60</span> <span title="Int(300000)">*</span> <span class="int">1000</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="java.lang.Runnable">Runnable</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="org.apache.commons.httpclient.HttpClient" id="80055">httpClient</a> = <span title="org.apache.commons.httpclient.HttpClient" class="keyword">new</span> <span title="org.apache.commons.httpclient.HttpClient">HttpClient</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="80057">run</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">var</span> <a title="Int" id="80089">timeoutCountdown</a> = <a href="#80074" title="Int">timeout</a>
      <span class="keyword">var</span> <a title="Int" id="80090">numSuccesses</a> = <span title="Int(0)" class="int">0</span>
      <span class="keyword">var</span> <a title="Boolean" id="80091">serverIsUp</a> = <span title="Boolean(false)" class="keyword">false</span>
      <span class="keyword">var</span> <a title="Boolean" id="80092">exitThread</a> = <span title="Boolean(false)" class="keyword">false</span>
      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#80092" title="Boolean">exitThread</a><span class="delimiter">)</span> <a href="#80093" title="()Unit" class="delimiter">{</a>
        <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><a href="#80073" title="=&gt; Long">sleepPeriod</a><span class="delimiter">)</span>
        <a href="#80089" title="Int">timeoutCountdown</a> <span title="(x: Int)Int">-=</span> <a href="#80073" title="Int">sleepPeriod</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#80089" title="Int">timeoutCountdown</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;The webserver on host %s never came up, killing the mesos task associated with it now.&quot;)" class="string">&quot;The webserver on host %s never came up, killing the mesos task associated with it now.&quot;</span>, <a href="#80067" title="String">serverHostname</a><span class="delimiter">)</span>
          <a href="#77181" title="=&gt; org.apache.mesos.MesosSchedulerDriver">driver</a>.<span title="(x$1: org.apache.mesos.Protos.TaskID)Int">killTask</span><span class="delimiter">(</span><a href="#80066" title="org.apache.mesos.Protos.TaskID">taskId</a><span class="delimiter">)</span>
          <a href="#77215" title="(x$1: scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String])Unit">pendingServers</a> <span title="(key: org.apache.mesos.Protos.TaskID)scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">-=</span> <a href="#80066" title="org.apache.mesos.Protos.TaskID">taskId</a>
          <a href="#77188" title="(action: String)Unit">recordAction</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;The webserver for app %s killed webapp server task on host %s because it never responded, it was weak and deserved to be killed.&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#77245" title="String">name</a>, <a href="#80066" title="org.apache.mesos.Protos.TaskID">taskId</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#80092" title="Boolean">exitThread</a> = <span title="Boolean(true)" class="keyword">true</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="String" id="80128">appUrl</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;http://%s:%d/&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#80067" title="String">serverHostname</a>, <a href="#77189" title="=&gt; Int">port</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="org.apache.commons.httpclient.methods.GetMethod" id="80129">method</a> = <span title="(x$1: java.lang.String)org.apache.commons.httpclient.methods.GetMethod" class="keyword">new</span> <span title="org.apache.commons.httpclient.methods.GetMethod">GetMethod</span><span class="delimiter">(</span><a href="#80128" title="String">appUrl</a><span class="delimiter">)</span>
          <a href="#80135" title="Unit" class="keyword">do</a> <span class="delimiter">{</span>
            <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Sending a priming HTTP request to %s.&quot;)" class="string">&quot;Sending a priming HTTP request to %s.&quot;</span>, <a href="#80128" title="String">appUrl</a><span class="delimiter">)</span>
            <span class="keyword">try</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="Int" id="80140">status</a> = <a href="#80055" title="=&gt; org.apache.commons.httpclient.HttpClient">httpClient</a>.<span title="(x$1: org.apache.commons.httpclient.HttpMethod)Int">executeMethod</span><span class="delimiter">(</span><a href="#80129" title="org.apache.commons.httpclient.methods.GetMethod">method</a><span class="delimiter">)</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#80140" title="Int">status</a> <span title="(x: Int)Boolean">==</span> <span title="Int(200)" class="int">200</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#80091" title="Boolean">serverIsUp</a> = <span title="Boolean(true)" class="keyword">true</span>
                <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Server %s contacted successfully&quot;)" class="string">&quot;Server %s contacted successfully&quot;</span>, <a href="#80128" title="String">appUrl</a><span class="delimiter">)</span>
                <a href="#80090" title="Int">numSuccesses</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
                <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#80090" title="Int">numSuccesses</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="#80072" title="Int">numSuccessRequired</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <a href="#80092" title="Boolean">exitThread</a> = <span title="Boolean(true)" class="keyword">true</span>
                  <a href="#9684" title="WebAppScheduler.this.type">scheduler</a>.<span title="(x$1: Unit)Unit">synchronized</span> <span class="delimiter">{</span>
                    <a href="#77212" title="(x$1: scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String])Unit">servers</a> <span title="(kv: (org.apache.mesos.Protos.TaskID, String))scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">+=</span> <a href="#80066" title="(x: org.apache.mesos.Protos.TaskID)ArrowAssoc[org.apache.mesos.Protos.TaskID]">taskId</a> <span title="(y: String)(org.apache.mesos.Protos.TaskID, String)">-&gt;</span> <a href="#80067" title="String">serverHostname</a>
                    <a href="#77215" title="(x$1: scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String])Unit">pendingServers</a> <span title="(key: org.apache.mesos.Protos.TaskID)scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">-=</span> <a href="#80066" title="org.apache.mesos.Protos.TaskID">taskId</a>
                  <span class="delimiter">}</span>
                  <a href="#77239" title="()Unit">updateZooWebServerList</a><span class="delimiter">(</span><span class="delimiter">)</span>
                  <a href="#77188" title="(action: String)Unit">recordAction</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Webapp Director added a webapp server for %s. Good luck young server!&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#77245" title="String">name</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="delimiter">}</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <a title="Unit" id="80287">e</a> =&gt;
                <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;priming GET request to %s failed.&quot;)" class="string">&quot;priming GET request to %s failed.&quot;</span>, <a href="#80128" title="String">appUrl</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span> <span class="keyword">while</span> <span class="delimiter">(</span><a href="#80091" title="Boolean">serverIsUp</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#80092" title="Boolean">exitThread</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(d: org.apache.mesos.SchedulerDriver)String" id="77229">getFrameworkName</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="80292">d</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span><span class="delimiter">)</span>: <span title="String">String</span> = <span title="java.lang.String(&quot;WebAppScheduler: &quot;)" class="string">&quot;WebAppScheduler: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#77245" title="String">name</a>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(d: org.apache.mesos.SchedulerDriver)org.apache.mesos.Protos.ExecutorInfo" id="77230">getExecutorInfo</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="80294">d</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span><span class="delimiter">)</span>: <span title="org.apache.mesos.Protos.ExecutorInfo">ExecutorInfo</span> = <span title="object org.apache.mesos.Protos.ExecutorInfo">ExecutorInfo</span>.<span title="()org.apache.mesos.Protos.ExecutorInfo.Builder">newBuilder</span>.<span title="(x$1: java.lang.String)org.apache.mesos.Protos.ExecutorInfo.Builder">setUri</span><span class="delimiter">(</span><a href="#77247" title="String">executor</a><span class="delimiter">)</span>.<span title="()org.apache.mesos.Protos.ExecutorInfo">build</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(d: org.apache.mesos.SchedulerDriver, fid: org.apache.mesos.Protos.FrameworkID)Unit" id="77231">registered</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="80299">d</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span>, <a title="org.apache.mesos.Protos.FrameworkID" id="80300">fid</a>: <span title="org.apache.mesos.Protos.FrameworkID">FrameworkID</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Registered Framework.  Fid: &quot;)" class="string">&quot;Registered Framework.  Fid: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#80300" title="org.apache.mesos.Protos.FrameworkID">fid</a><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.JvmWebAppTask" id="77232">webAppTask</a> = <span title="(warFile: edu.berkeley.cs.scads.comm.ClassSource, properties: Map[String,String])edu.berkeley.cs.scads.comm.JvmWebAppTask">JvmWebAppTask</span><span class="delimiter">(</span><a href="#77248" title="edu.berkeley.cs.scads.comm.ClassSource">warFile</a>, <a href="#77249" title="Map[String,String]">properties</a><span class="delimiter">)</span>
  <span class="keyword">var</span> <a title="Int" id="77235">taskIdCounter</a> = <span title="Int(0)" class="int">0</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.SchedulerDriver, oid: org.apache.mesos.Protos.OfferID, offers: java.util.List[org.apache.mesos.Protos.SlaveOffer])Unit" id="77237">resourceOffer</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="80304">driver</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span>, <a title="org.apache.mesos.Protos.OfferID" id="80305">oid</a>: <span title="org.apache.mesos.Protos.OfferID">OfferID</span>, <a title="java.util.List[org.apache.mesos.Protos.SlaveOffer]" id="80306">offers</a>: java.util.<span title="java.util.List[org.apache.mesos.Protos.SlaveOffer]">List</span><span class="delimiter">[</span>SlaveOffer<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="scala.collection.mutable.Buffer[org.apache.mesos.Protos.TaskDescription]" id="80308">tasks</a> = <a href="#80306" title="(l: java.util.List[org.apache.mesos.Protos.SlaveOffer])scala.collection.mutable.Buffer[org.apache.mesos.Protos.SlaveOffer]">offers</a>.<span title="(f: org.apache.mesos.Protos.SlaveOffer =&gt; scala.collection.GenTraversableOnce[org.apache.mesos.Protos.TaskDescription])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[org.apache.mesos.Protos.SlaveOffer],org.apache.mesos.Protos.TaskDescription,scala.collection.mutable.Buffer[org.apache.mesos.Protos.TaskDescription]])scala.collection.mutable.Buffer[org.apache.mesos.Protos.TaskDescription]">flatMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,org.apache.mesos.Protos.TaskDescription,scala.collection.mutable.Buffer[org.apache.mesos.Protos.TaskDescription]]" class="delimiter">(</span><a title="org.apache.mesos.Protos.SlaveOffer" id="80604">offer</a> =&gt; <span class="delimiter">{</span>
      <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;In resourceOffer, taskIdCounter is &quot;)" class="string">&quot;In resourceOffer, taskIdCounter is &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#77235" title="=&gt; Int">taskIdCounter</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;, targetNumServers is &quot;)" class="string">&quot;, targetNumServers is &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#77203" title="=&gt; Int">targetNumServers</a><span class="delimiter">)</span>
      <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;servers.size is %d.&quot;)" class="string">&quot;servers.size is %d.&quot;</span>, <a href="#77212" title="=&gt; scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">servers</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;pendingServers.size is %d.&quot;)" class="string">&quot;pendingServers.size is %d.&quot;</span>, <a href="#77215" title="=&gt; scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">pendingServers</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <span title="List[org.apache.mesos.Protos.TaskDescription]" class="keyword">if</span> <span class="delimiter">(</span><a href="#77212" title="=&gt; scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">servers</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">+</span> <a href="#77215" title="=&gt; scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">pendingServers</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">&lt;</span> <a href="#77203" title="=&gt; Int">targetNumServers</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;adding server %s as task %d&quot;)" class="string">&quot;adding server %s as task %d&quot;</span>, <a href="#80604" title="org.apache.mesos.Protos.SlaveOffer">offer</a>.<span title="()java.lang.String">getHostname</span>, <a href="#77235" title="=&gt; Int">taskIdCounter</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="org.apache.mesos.Protos.TaskID" id="80627">newTaskId</a> = <span title="object org.apache.mesos.Protos.TaskID">TaskID</span>.<span title="()org.apache.mesos.Protos.TaskID.Builder">newBuilder</span>.<span title="(x$1: java.lang.String)org.apache.mesos.Protos.TaskID.Builder">setValue</span><span class="delimiter">(</span><a href="#77235" title="=&gt; Int">taskIdCounter</a>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span>.<span title="()org.apache.mesos.Protos.TaskID">build</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#77235" title="(x$1: Int)Unit">taskIdCounter</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>

        <a href="#9684" title="WebAppScheduler.this.type">scheduler</a>.<span title="(x$1: Unit)Unit">synchronized</span> <span class="delimiter">{</span>
          <a href="#77215" title="(x$1: scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String])Unit">pendingServers</a> <span title="(kv: (org.apache.mesos.Protos.TaskID, String))scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">+=</span> <a href="#80627" title="(x: org.apache.mesos.Protos.TaskID)ArrowAssoc[org.apache.mesos.Protos.TaskID]">newTaskId</a> <span title="(y: java.lang.String)(org.apache.mesos.Protos.TaskID, java.lang.String)">-&gt;</span> <a href="#80604" title="org.apache.mesos.Protos.SlaveOffer">offer</a>.<span title="()java.lang.String">getHostname</span>
        <span class="delimiter">}</span>

        <span title="(x$1: java.lang.Runnable)java.lang.Thread" class="keyword">new</span> <span title="java.lang.Thread">Thread</span><span class="delimiter">(</span><a href="#80072" title="WebAppScheduler.this.WebAppPrimerThread" class="keyword">new</a> <a href="#77227" title="WebAppScheduler.this.WebAppPrimerThread">WebAppPrimerThread</a><span class="delimiter">(</span><a href="#80627" title="org.apache.mesos.Protos.TaskID">newTaskId</a>, <a href="#80604" title="org.apache.mesos.Protos.SlaveOffer">offer</a>.<span title="()java.lang.String">getHostname</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>

        <span class="keyword">var</span> <a title="List[org.apache.mesos.Protos.TaskDescription]" id="80628">td</a> = <span title="object org.apache.mesos.Protos.TaskDescription">TaskDescription</span>.<span title="()org.apache.mesos.Protos.TaskDescription.Builder">newBuilder</span>
                                .<span title="(x$1: org.apache.mesos.Protos.TaskID)org.apache.mesos.Protos.TaskDescription.Builder">setTaskId</span><span class="delimiter">(</span><a href="#80627" title="org.apache.mesos.Protos.TaskID">newTaskId</a><span class="delimiter">)</span>
                                .<span title="(x$1: org.apache.mesos.Protos.SlaveID)org.apache.mesos.Protos.TaskDescription.Builder">setSlaveId</span><span class="delimiter">(</span><a href="#80604" title="org.apache.mesos.Protos.SlaveOffer">offer</a>.<span title="()org.apache.mesos.Protos.SlaveID">getSlaveId</span><span class="delimiter">)</span>
                                .<span title="(x$1: java.lang.String)org.apache.mesos.Protos.TaskDescription.Builder">setName</span><span class="delimiter">(</span><a href="#77232" title="=&gt; edu.berkeley.cs.scads.comm.JvmWebAppTask">webAppTask</a>.<span title="()String">toString</span><span class="delimiter">)</span>
                                .<span title="(x$1: java.lang.Iterable[_ &lt;: org.apache.mesos.Protos.Resource])org.apache.mesos.Protos.TaskDescription.Builder">addAllResources</span><span class="delimiter">(</span><a href="#80604" title="org.apache.mesos.Protos.SlaveOffer">offer</a>.<span title="()java.util.List[org.apache.mesos.Protos.Resource]">getResourcesList</span><span class="delimiter">)</span>
                                .<span title="(x$1: com.google.protobuf.ByteString)org.apache.mesos.Protos.TaskDescription.Builder">setData</span><span class="delimiter">(</span><span title="object com.google.protobuf.ByteString">ByteString</span>.<span title="(x$1: Array[Byte])com.google.protobuf.ByteString">copyFrom</span><span class="delimiter">(</span><a href="Util.scala.html#66283" title="(task: edu.berkeley.cs.scads.comm.JvmTask)Array[Byte]">JvmTask</a><span class="delimiter">(</span><a href="#77232" title="=&gt; edu.berkeley.cs.scads.comm.JvmWebAppTask">webAppTask</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                                .<span title="()org.apache.mesos.Protos.TaskDescription">build</span><span class="delimiter">(</span><span class="delimiter">)</span> <a href="#80757" title="(x: org.apache.mesos.Protos.TaskDescription)List[org.apache.mesos.Protos.TaskDescription]">::</a> <span title="object Nil">Nil</span>
        <a href="#80628" title="List[org.apache.mesos.Protos.TaskDescription]">td</a>
      <span class="delimiter">}</span>
      <span class="keyword">else</span>
        <span title="object Nil">Nil</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    <a href="#80304" title="org.apache.mesos.SchedulerDriver">driver</a>.<span title="(x$1: org.apache.mesos.Protos.OfferID, x$2: java.util.Collection[org.apache.mesos.Protos.TaskDescription], x$3: java.util.Map[java.lang.String,java.lang.String])Int">replyToOffer</span><span title="Unit" class="delimiter">(</span><a href="#80305" title="org.apache.mesos.Protos.OfferID">oid</a>, <a href="#80308" title="(b: scala.collection.mutable.Buffer[org.apache.mesos.Protos.TaskDescription])java.util.List[org.apache.mesos.Protos.TaskDescription]">tasks</a>, <span title="[A, B](elems: (A, B)*)scala.collection.immutable.Map[A,B]">Map</span><span title="(elems: (String, String)*)scala.collection.immutable.Map[String,String]" class="delimiter">[</span><span title="String">String</span>, <span title="String">String</span><span class="delimiter">]</span><span title="(m: scala.collection.Map[String,String])java.util.Map[String,String]" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>


  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(d: org.apache.mesos.SchedulerDriver, status: org.apache.mesos.Protos.TaskStatus)Unit" id="77238">statusUpdate</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="80947">d</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span>, <a title="org.apache.mesos.Protos.TaskStatus" id="80948">status</a>: <span title="org.apache.mesos.Protos.TaskStatus">TaskStatus</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#80948" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()org.apache.mesos.Protos.TaskState">getState</span> <span title="(x$1: AnyRef)Boolean">==</span> TaskState.<span title="org.apache.mesos.Protos.TaskState(value TASK_FAILED)">TASK_FAILED</span> <span title="(x: Boolean)Boolean">||</span> <a href="#80948" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()org.apache.mesos.Protos.TaskState">getState</span> <span title="(x$1: AnyRef)Boolean">==</span> TaskState.<span title="org.apache.mesos.Protos.TaskState(value TASK_LOST)">TASK_LOST</span> <span title="(x: Boolean)Boolean">||</span> <a href="#80948" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()org.apache.mesos.Protos.TaskState">getState</span> <span title="(x$1: AnyRef)Boolean">==</span> TaskState.<span title="org.apache.mesos.Protos.TaskState(value TASK_KILLED)">TASK_KILLED</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Status Update for Task %d: %s&quot;)" class="string">&quot;Status Update for Task %d: %s&quot;</span>, <a href="#80948" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span>, <a href="#80948" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()org.apache.mesos.Protos.TaskState">getState</span><span class="delimiter">)</span>
      <span class="comment">//TODO: restarted failed app servers</span>
    <span class="delimiter">}</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Status Update: &quot;)" class="string">&quot;Status Update: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#80948" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#80948" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()org.apache.mesos.Protos.TaskState">getState</span><span class="delimiter">)</span>
      <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(message: =&gt; AnyRef)Unit">ifDebug</span><span class="delimiter">(</span><span title="(x$1: Array[Byte])java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="#80948" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()com.google.protobuf.ByteString">getData</span>.<span title="()Array[Byte]">toByteArray</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="77239">updateZooWebServerList</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="String" id="80017">serverList</a> = <a href="#77212" title="=&gt; scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">servers</a>.<span title="=&gt; Iterable[String]">values</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>
    <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Updating zookeeper list of webservers to %s&quot;)" class="string">&quot;Updating zookeeper list of webservers to %s&quot;</span>, <a href="#80017" title="String">serverList</a><span class="delimiter">)</span>
    <a href="#77191" title="=&gt; edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">zkWebServerList</a>.<span title="(d: Array[Byte])Unit">data</span> = <a href="#80017" title="String">serverList</a>.<span title="()Array[Byte]">getBytes</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Unit" id="77240">kill</a> = <span class="delimiter">{</span>
    <a href="#77181" title="=&gt; org.apache.mesos.MesosSchedulerDriver">driver</a>.<span title="()Int">stop</span>
    <a href="#77194" title="(x$1: Boolean)Unit">runMonitorThread</a> = <span title="Boolean(false)" class="keyword">false</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.SchedulerDriver, code: Int, message: String)Unit" id="77241">error</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="80981">driver</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span>, <a title="Int" id="80982">code</a>: <span title="Int">Int</span>, <a title="String" id="80983">message</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;MESOS ERROR %d: %s&quot;)" class="string">&quot;MESOS ERROR %d: %s&quot;</span>, <a href="#80982" title="Int">code</a>, <a href="#80983" title="String">message</a><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.SchedulerDriver, slaveId: org.apache.mesos.Protos.SlaveID)Unit" id="77242">slaveLost</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="80989">driver</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span>, <a title="org.apache.mesos.Protos.SlaveID" id="80990">slaveId</a>: <span title="org.apache.mesos.Protos.SlaveID">SlaveID</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;SLAVE LOST: %s&quot;)" class="string">&quot;SLAVE LOST: %s&quot;</span>, <a href="#80990" title="org.apache.mesos.Protos.SlaveID">slaveId</a><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.SchedulerDriver, slaveId: org.apache.mesos.Protos.SlaveID, executor: org.apache.mesos.Protos.ExecutorID, data: Array[Byte])Unit" id="77243">frameworkMessage</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="80996">driver</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span>, <a title="org.apache.mesos.Protos.SlaveID" id="80997">slaveId</a>: <span title="org.apache.mesos.Protos.SlaveID">SlaveID</span>, <a title="org.apache.mesos.Protos.ExecutorID" id="80998">executor</a>: <span title="org.apache.mesos.Protos.ExecutorID">ExecutorID</span>, <a title="Array[Byte]" id="80999">data</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;FW Message: %s %s %s&quot;)" class="string">&quot;FW Message: %s %s %s&quot;</span>, <a href="#80997" title="org.apache.mesos.Protos.SlaveID">slaveId</a>, <a href="#80998" title="org.apache.mesos.Protos.ExecutorID">executor</a>, <span title="(x$1: Array[Byte])java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="#80999" title="Array[Byte]">data</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.SchedulerDriver, oid: org.apache.mesos.Protos.OfferID)Unit" id="77244">offerRescinded</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="81009">driver</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span>, <a title="org.apache.mesos.Protos.OfferID" id="81010">oid</a>: <span title="org.apache.mesos.Protos.OfferID">OfferID</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#77175" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Offer Rescinded: %s&quot;)" class="string">&quot;Offer Rescinded: %s&quot;</span>, <a href="#81010" title="org.apache.mesos.Protos.OfferID">oid</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>