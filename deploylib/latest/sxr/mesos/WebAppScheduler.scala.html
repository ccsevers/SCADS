<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>mesos/WebAppScheduler.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> deploylib
<span class="keyword">package</span> mesos

<span class="keyword">import</span> java.net.URL
<span class="keyword">import</span> java.sql.<span class="delimiter">{</span>Connection, DriverManager, ResultSet, SQLException<span class="delimiter">}</span>
<span class="keyword">import</span> java.util.Date

<span class="keyword">import</span> org.apache.mesos._
<span class="keyword">import</span> org.apache.mesos.<span title="object org.apache.mesos.Protos">Protos</span>._
<span class="keyword">import</span> com.google.protobuf.ByteString


<span class="keyword">import</span> edu.berkeley.cs.scads.comm._
<span class="keyword">import</span> net.lag.logging.Logger
<span class="keyword">import</span> scala.collection.<span title="object scala.collection.JavaConversions">JavaConversions</span>._
<span class="keyword">import</span> scala.collection.immutable.HashMap

<span class="keyword">import</span> org.apache.commons.httpclient._
<span class="keyword">import</span> org.apache.commons.httpclient.methods._
<span class="keyword">import</span> org.apache.commons.httpclient.params._

<span class="keyword">object</span> <a title="object deploylib.mesos.WebAppScheduler" id="9819">WebAppScheduler</a> <span title="ScalaObject" class="delimiter">{</span>
  <span title="object java.lang.System">System</span>.<span title="(x$1: java.lang.String)Unit">loadLibrary</span><span class="delimiter">(</span><span title="java.lang.String(&quot;mesos&quot;)" class="string">&quot;mesos&quot;</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/* serverCapacity is the number of requests per second that a single application server can handle */</span>
<span class="keyword">class</span> <a title="class WebAppScheduler extends java.lang.Object with org.apache.mesos.Scheduler with ScalaObject" id="9821">WebAppScheduler</a> <a href="#9821" title="ScalaObject" class="keyword">protected</a><span class="delimiter">(</span><a title="String" id="64821">name</a>: <span title="String">String</span>, <a title="String" id="64822">mesosMaster</a>: <span title="String">String</span>, <a title="String" id="64823">executor</a>: <span title="String">String</span>, <a title="deploylib.mesos.ClassSource" id="64824">warFile</a>: <a href="mesos/Messages.scala.html#104925" title="deploylib.mesos.ClassSource">ClassSource</a>, <a title="Map[String,String]" id="64825">properties</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="String" id="64826">zkWebServerListRoot</a>: <span title="String">String</span>, <a title="Int" id="64827">serverCapacity</a>: <span title="Int">Int</span>, <span class="keyword">var</span> <a title="Int" id="64828">minServers</a>: <span title="Int">Int</span>, <a title="=&gt; Option[String]" id="64829">statsServer</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span title="object None">None</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="org.apache.mesos.Scheduler">Scheduler</span> <span class="delimiter">{</span>
  scheduler =&gt;

  <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="64751">logger</a> = <span title="()net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">var</span> <a title="List[String =&gt; Unit]" id="64754">listeners</a>: <span title="List[String =&gt; Unit]">List</span><span class="delimiter">[</span>String =&gt; Unit<span class="delimiter">]</span> = <span title="object Nil">Nil</span>
  <span class="keyword">var</span> <a title="org.apache.mesos.MesosSchedulerDriver" id="64757">driver</a> = <span title="(x$1: org.apache.mesos.Scheduler, x$2: java.lang.String)org.apache.mesos.MesosSchedulerDriver" class="keyword">new</span> <span title="org.apache.mesos.MesosSchedulerDriver">MesosSchedulerDriver</span><span class="delimiter">(</span><a href="#9821" title="deploylib.mesos.WebAppScheduler" class="keyword">this</a>, <a href="#64822" title="String">mesosMaster</a><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="java.lang.Thread" id="64759">driverThread</a> = <a href="#64939" title="java.lang.Thread" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Thread" id="64939">Thread</a><span class="delimiter">(</span><span title="java.lang.String(&quot;ExperimentScheduler Mesos Driver Thread&quot;)" class="string">&quot;ExperimentScheduler Mesos Driver Thread&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="64941">run</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#64757" title="=&gt; org.apache.mesos.MesosSchedulerDriver">driver</a>.<span title="()Int">run</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">//set up mysql connection for statistics</span>
  <span class="keyword">val</span> <a title="Option[Option[java.sql.Statement]]" id="64761">statement</a> = <a href="#64829" title="Option[String]">statsServer</a>.<span title="(f: String =&gt; Option[java.sql.Statement])Option[Option[java.sql.Statement]]">map</span><span class="delimiter">(</span><a title="String" id="64959">connString</a> =&gt; <span class="delimiter">{</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.sql.Connection" id="64960">conn</a> = <span title="object java.sql.DriverManager">DriverManager</span>.<span title="(x$1: java.lang.String)java.sql.Connection">getConnection</span><span class="delimiter">(</span><a href="#64959" title="String">connString</a><span class="delimiter">)</span>
      <span title="(x: java.sql.Statement)Some[java.sql.Statement]">Some</span><span class="delimiter">(</span><a href="#64960" title="java.sql.Connection">conn</a>.<span title="(x$1: Int, x$2: Int)java.sql.Statement">createStatement</span><span class="delimiter">(</span>ResultSet.<span title="Int(1003)">TYPE_FORWARD_ONLY</span>, ResultSet.<span title="Int(1008)">CONCUR_UPDATABLE</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="None.type" id="65688">e</a>: <span title="java.sql.SQLException">SQLException</span> =&gt; <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Connection to SQL Database failed with connection string %s.&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#64959" title="String">connString</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="object None">None</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(func: String =&gt; Unit)Unit" id="64763">registerActionListener</a><span class="delimiter">(</span><a title="String =&gt; Unit" id="66134">func</a>: String =&gt; Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#64754" title="(x$1: List[String =&gt; Unit])Unit">listeners</a> <span title="(x: String =&gt; Unit)List[String =&gt; Unit]">::=</span> <a href="#66134" title="String =&gt; Unit">func</a>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(action: String)Unit" id="64764">recordAction</a><span class="delimiter">(</span><a title="String" id="66146">action</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#64754" title="=&gt; List[String =&gt; Unit]">listeners</a>.<span title="(f: String =&gt; Unit =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#66179" title="(v1: String)Unit">_</a><span class="delimiter">(</span><a href="#66146" title="String">action</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="Int" id="64765">port</a> = <span title="Int(8080)" class="int">8080</span>
  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode" id="64767">zkWebServerList</a> = <span title="(uri: String)edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">ZooKeeperNode</span><span class="delimiter">(</span><a href="#64826" title="String">zkWebServerListRoot</a><span class="delimiter">)</span>
  <span class="keyword">var</span> <a title="Boolean" id="64770">runMonitorThread</a> = <span title="Boolean(true)" class="keyword">true</span>
  <span class="keyword">var</span> <a title="Int" id="64773">numToKill</a> = <span title="Int(0)" class="int">0</span>
  <span class="keyword">var</span> <a title="Int" id="64776">killTimer</a> = <span title="Int(0)" class="int">0</span>
  @volatile <span class="keyword">var</span> <a title="Int" id="64779">targetNumServers</a>: <span title="Int">Int</span> = <a href="#64828" title="=&gt; Int">minServers</a>
  <span class="keyword">var</span> <a title="Double" id="64782">smoothedWorkload</a> = <span title="Double(0.0)" class="double">0.0</span>
  <span class="comment">// The smoothed version of the aggregate workload</span>
  <span class="keyword">var</span> <a title="Double" id="64785">smoothedUtilization</a> = <span title="Double(0.0)" class="double">0.0</span>
  <span class="keyword">var</span> <a title="scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]" id="64788">servers</a> = <span title="scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]" class="keyword">new</span> <span title="scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">HashMap</span><span class="delimiter">[</span>TaskID, String<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">var</span> <a title="scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]" id="64791">pendingServers</a> = <span title="scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]" class="keyword">new</span> <span title="scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">HashMap</span><span class="delimiter">[</span>TaskID, String<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">var</span> <a title="scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,Int]" id="64794">unresponsiveServers</a> = <span title="scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,Int]" class="keyword">new</span> <span title="scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,Int]">HashMap</span><span class="delimiter">[</span>TaskID, Int<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Periodically query all of the webapp servers currently thought
   * to be alive (i.e. in the servers HashMap), calculate the aggregate
   * request rate to the application, and then derive the target number
   * of webapp servers necessary to satisfy that request rate. Kill some
   * webapp server mesos tasks if the app is currently over provisioned.
   * If more are needed, they will be acquired by resourceOffer().
   *
   * @param period - frequency with which targetNumServers recalculated
   * @param unresponsiveRequestLimit - Wait to kill a webapp server until you have failed to retrieve its request rate this many times.
   * @param rampUpWorkloadWeight - Smooth adding webapp servers by weighing in history. Must be geq 0.0 and lt 1.0.
   * @param rampDownWorkloadWeight - Smooth killing webapp servers by weighing in history. Must be geq 0.0 and lt 1.0.
   */</span>
  <span class="keyword">class</span> <a title="class monitorThread extends java.lang.Object with java.lang.Runnable with ScalaObject" id="64797">monitorThread</a><a href="#64797" title="ScalaObject" class="delimiter">(</a><a title="Int" id="66110">period</a>: <span title="Int">Int</span> = <span class="int">1000</span> <span title="Int(30000)">*</span> <span class="int">30</span>,
                      <a title="Int" id="66111">unresponsiveRequestLimit</a>: <span title="Int">Int</span> = <span title="Int(3)" class="int">3</span>,
                      <a title="Double" id="66112">rampUpWorkloadWeight</a>: <span title="Double">Double</span> = <span title="Double(0.9)" class="double">0.9</span>,
                      <a title="Double" id="66113">rampDownWorkloadWeight</a>: <span title="Double">Double</span> = <span title="Double(0.01)" class="double">0.01</span>,
                      <a title="Double" id="66114">rampUpUtilizationWeight</a>: <span title="Double">Double</span> = <span title="Double(0.9)" class="double">0.9</span>,
                      <a title="Double" id="66115">rampDownUtilizationWeight</a>: <span title="Double">Double</span> = <span title="Double(0.05)" class="double">0.05</span>,
                      <a title="Double" id="66116">utilizationThreshold</a>: <span title="Double">Double</span> = <span title="Double(0.4)" class="double">0.40</span>
                       <span class="delimiter">)</span> <span class="keyword">extends</span> <span title="java.lang.Runnable">Runnable</span> <span class="delimiter">{</span>
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="org.apache.commons.httpclient.params.HttpClientParams" id="66097">params</a> = <span title="org.apache.commons.httpclient.params.HttpClientParams" class="keyword">new</span> <span title="org.apache.commons.httpclient.params.HttpClientParams">HttpClientParams</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#66097" title="=&gt; org.apache.commons.httpclient.params.HttpClientParams">params</a>.<span title="(x$1: Int)Unit">setSoTimeout</span><span class="delimiter">(</span><span title="Int(5000)" class="int">5000</span><span class="delimiter">)</span>
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="org.apache.commons.httpclient.HttpClient" id="66099">httpClient</a> = <span title="(x$1: org.apache.commons.httpclient.params.HttpClientParams)org.apache.commons.httpclient.HttpClient" class="keyword">new</span> <span title="org.apache.commons.httpclient.HttpClient">HttpClient</span><span class="delimiter">(</span><a href="#66097" title="=&gt; org.apache.commons.httpclient.params.HttpClientParams">params</a><span class="delimiter">)</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="66101">run</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#64770" title="=&gt; Boolean">runMonitorThread</a><span class="delimiter">)</span> <a href="#66202" title="()Unit" class="delimiter">{</a>
        <span class="comment">// Calculate the average web server request rate</span>
        <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Beginging collection of workload statistics&quot;)" class="string">&quot;Beginging collection of workload statistics&quot;</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Seq[(Double, Double)]" id="66203">stats</a> = <span class="keyword">for</span> <span class="delimiter">(</span><span class="delimiter">(</span><a title="org.apache.mesos.Protos.TaskID" id="66277">taskID</a>, <a title="String" id="66278">slaveHostname</a><span class="delimiter">)</span> &lt;- <a href="#64788" title="=&gt; scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">servers</a>.<a href="#66250" title="(f: (org.apache.mesos.Protos.TaskID, String) =&gt; (Double, Double))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(org.apache.mesos.Protos.TaskID, String)],(Double, Double),Seq[(Double, Double)]])Seq[(Double, Double)]">toSeq</a><span class="delimiter">)</span> <span class="keyword">yield</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="String" id="66279">slaveUrl</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;http://%s:%d/stats/&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#66278" title="String">slaveHostname</a>, <a href="#64765" title="=&gt; Int">port</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="org.apache.commons.httpclient.methods.GetMethod" id="66280">method</a> = <span title="(x$1: java.lang.String)org.apache.commons.httpclient.methods.GetMethod" class="keyword">new</span> <span title="org.apache.commons.httpclient.methods.GetMethod">GetMethod</span><span class="delimiter">(</span><a href="#66279" title="String">slaveUrl</a><span class="delimiter">)</span>
          <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Getting status from %s.&quot;)" class="string">&quot;Getting status from %s.&quot;</span>, <a href="#66279" title="String">slaveUrl</a><span class="delimiter">)</span>
          <span class="keyword">try</span> <span class="delimiter">{</span>
            <a href="#66099" title="=&gt; org.apache.commons.httpclient.HttpClient">httpClient</a>.<span title="(x$1: org.apache.commons.httpclient.HttpMethod)Int">executeMethod</span><span class="delimiter">(</span><a href="#66280" title="org.apache.commons.httpclient.methods.GetMethod">method</a><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="scala.xml.Elem" id="66290">xml</a> = scala.xml.<span title="object scala.xml.XML">XML</span>.<span title="(string: String)scala.xml.Elem">loadString</span><span class="delimiter">(</span><a href="#66280" title="org.apache.commons.httpclient.methods.GetMethod">method</a>.<span title="()java.lang.String">getResponseBodyAsString</span><span class="delimiter">)</span>
            <a href="#64794" title="(x$1: scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,Int])Unit">unresponsiveServers</a> <span title="(key: org.apache.mesos.Protos.TaskID)scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,Int]">-=</span> <a href="#66277" title="org.apache.mesos.Protos.TaskID">taskID</a>
            <span title="(_1: Double, _2: Double)(Double, Double)" class="delimiter">(</span><span class="delimiter">(</span><a href="#66290" title="scala.xml.Elem">xml</a> <span title="(that: String)scala.xml.NodeSeq">\</span> <span title="java.lang.String(&quot;RequestRate&quot;)" class="string">&quot;RequestRate&quot;</span><span class="delimiter">)</span>.<span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">text</span>.<span title="=&gt; Double">toDouble</span>, <span class="delimiter">(</span><a href="#66290" title="scala.xml.Elem">xml</a> <span title="(that: String)scala.xml.NodeSeq">\</span> <span title="java.lang.String(&quot;CpuUtilization&quot;)" class="string">&quot;CpuUtilization&quot;</span><span class="delimiter">)</span>.<span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">text</span>.<span title="=&gt; Double">toDouble</span><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a title="(Double, Double)" id="66576">e</a> =&gt;
              <a href="#64794" title="(x$1: scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,Int])Unit">unresponsiveServers</a> <span title="(kv: (org.apache.mesos.Protos.TaskID, Int))scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,Int]">+=</span> <a href="#66277" title="(x: org.apache.mesos.Protos.TaskID)ArrowAssoc[org.apache.mesos.Protos.TaskID]">taskID</a> <span title="(y: Int)(org.apache.mesos.Protos.TaskID, Int)">-&gt;</span> <span class="delimiter">(</span><a href="#64794" title="=&gt; scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,Int]">unresponsiveServers</a>.<span title="(key: org.apache.mesos.Protos.TaskID)Option[Int]">get</span><span class="delimiter">(</span><a href="#66277" title="org.apache.mesos.Protos.TaskID">taskID</a><span class="delimiter">)</span>.<span title="(default: =&gt; Int)Int">getOrElse</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
              <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Couldn\'t get RequestRate from %s for %d iterations..&quot;)" class="string">&quot;Couldn't get RequestRate from %s for %d iterations..&quot;</span>, <a href="#66279" title="String">slaveUrl</a>, <a href="#64794" title="(key: org.apache.mesos.Protos.TaskID)Int">unresponsiveServers</a><span class="delimiter">(</span><a href="#66277" title="org.apache.mesos.Protos.TaskID">taskID</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#64794" title="(key: org.apache.mesos.Protos.TaskID)Int">unresponsiveServers</a><span class="delimiter">(</span><a href="#66277" title="org.apache.mesos.Protos.TaskID">taskID</a><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;</span> <a href="#66111" title="Int">unresponsiveRequestLimit</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#64757" title="=&gt; org.apache.mesos.MesosSchedulerDriver">driver</a>.<span title="(x$1: org.apache.mesos.Protos.TaskID)Int">killTask</span><span class="delimiter">(</span><a href="#66277" title="org.apache.mesos.Protos.TaskID">taskID</a><span class="delimiter">)</span>
                <a href="#64788" title="(x$1: scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String])Unit">servers</a> <span title="(key: org.apache.mesos.Protos.TaskID)scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">-=</span> <a href="#66277" title="org.apache.mesos.Protos.TaskID">taskID</a>
                <a href="#64764" title="(action: String)Unit">recordAction</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Webapp Director killed an unresponsive webapp server of %s's. Weakness will not be tolerated!&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#64821" title="String">name</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
              <span title="(_1: Double, _2: Double)(Double, Double)" class="delimiter">(</span><span title="Double(0.0)" class="double">0.0</span>, <span title="Double(0.0)" class="double">0.0</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>

        <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Current Workload: %s&quot;)" class="string">&quot;Current Workload: %s&quot;</span>, <a href="#66203" title="Seq[(Double, Double)]">stats</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Double" id="66204">aggregateReqRate</a> = <a href="#66203" title="Seq[(Double, Double)]">stats</a>.<span title="(f: (Double, Double) =&gt; Double)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Double, Double)],Double,Seq[Double]])Seq[Double]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Double,Seq[Double]]" class="delimiter">(</span><a href="#66810" title="(Double, Double)">_</a>.<span title="=&gt; Double">_1</span><span class="delimiter">)</span>.<span title="(implicit num: Numeric[Double])Double">sum</span>
        <span class="keyword">val</span> <a title="Double" id="66205">totalUtilization</a> = <a href="#66203" title="Seq[(Double, Double)]">stats</a>.<span title="(f: (Double, Double) =&gt; Double)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Double, Double)],Double,Seq[Double]])Seq[Double]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Double,Seq[Double]]" class="delimiter">(</span><a href="#67303" title="(Double, Double)">_</a>.<span title="=&gt; Double">_2</span><span class="delimiter">)</span>.<span title="(implicit num: Numeric[Double])Double">sum</span>
        <span class="keyword">val</span> <a title="Double" id="66206">averageUtilization</a> = <a href="#66205" title="Double">totalUtilization</a> <span title="(x: Int)Double">/</span> <a href="#64788" title="=&gt; scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">servers</a>.<span title="=&gt; Int">size</span>

        <span class="comment">/*
          if (aggregateReqRate &gt; smoothedWorkload) { // ramping up
            smoothedWorkload = smoothedWorkload + (aggregateReqRate - smoothedWorkload) * rampUpWorkloadWeight
          } else { // ramping down
            smoothedWorkload = smoothedWorkload + (aggregateReqRate - smoothedWorkload) * rampDownWorkloadWeight
          }
          targetNumServers = math.max(minServers, math.ceil(smoothedWorkload / serverCapacity).toInt)
    */</span>

        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#66205" title="Double">totalUtilization</a> <span title="(x: Double)Boolean">&gt;</span> <a href="#64785" title="=&gt; Double">smoothedUtilization</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#64785" title="(x$1: Double)Unit">smoothedUtilization</a> = <a href="#64785" title="=&gt; Double">smoothedUtilization</a> <span title="(x: Double)Double">+</span> <span class="delimiter">(</span><a href="#66205" title="Double">totalUtilization</a> <span title="(x: Double)Double">-</span> <a href="#64785" title="=&gt; Double">smoothedUtilization</a><span class="delimiter">)</span> <span title="(x: Double)Double">*</span> <a href="#66114" title="Double">rampUpUtilizationWeight</a>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="comment">// ramping down</span>
          <a href="#64785" title="(x$1: Double)Unit">smoothedUtilization</a> = <a href="#64785" title="=&gt; Double">smoothedUtilization</a> <span title="(x: Double)Double">+</span> <span class="delimiter">(</span><a href="#66205" title="Double">totalUtilization</a> <span title="(x: Double)Double">-</span> <a href="#64785" title="=&gt; Double">smoothedUtilization</a><span class="delimiter">)</span> <span title="(x: Double)Double">*</span> <a href="#66115" title="Double">rampDownUtilizationWeight</a>
        <span class="delimiter">}</span>
        <a href="#64779" title="(x$1: Int)Unit">targetNumServers</a> = math.<span title="(x: Int, y: Int)Int">max</span><span class="delimiter">(</span><a href="#64828" title="=&gt; Int">minServers</a>, math.<span title="(x: Double)Double">ceil</span><span class="delimiter">(</span><a href="#64785" title="=&gt; Double">smoothedUtilization</a> <span title="(x: Double)Double">/</span> <a href="#66116" title="Double">utilizationThreshold</a><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span><span class="delimiter">)</span>

        <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Current Aggregate Workload: %f req/sec (%f smoothed), targetServers=%d&quot;)" class="string">&quot;Current Aggregate Workload: %f req/sec (%f smoothed), targetServers=%d&quot;</span>, <a href="#66204" title="Double">aggregateReqRate</a>, <a href="#64782" title="=&gt; Double">smoothedWorkload</a>, <a href="#64779" title="=&gt; Int">targetNumServers</a><span class="delimiter">)</span>

        <span class="comment">//TODO: Error Handling</span>
        <a href="#64761" title="=&gt; Option[Option[java.sql.Statement]]">statement</a>.<span title="(f: Option[java.sql.Statement] =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Option[java.sql.Statement]" id="67386">s</a> =&gt; <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="java.util.Date" id="67387">now</a> = <span title="java.util.Date" class="keyword">new</span> <span title="java.util.Date">Date</span>
          <span class="keyword">val</span> <a title="java.lang.String" id="67388">sqlInsertCmd</a> = <span title="java.lang.String(&quot;INSERT INTO appReqRate (timestamp, webAppID, aggRequestRate, targetNumServers, actualNumServers, averageUtilization)&quot;)" class="string">&quot;INSERT INTO appReqRate (timestamp, webAppID, aggRequestRate, targetNumServers, actualNumServers, averageUtilization)&quot;</span> <span title="(x$1: Any)java.lang.String">+</span>
            <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;VALUES (%d, '%s', %f, %d, %d, %f)&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#67387" title="java.util.Date">now</a>.<span title="()Long">getTime</span>, <a href="#64821" title="String">name</a>, <a href="#66204" title="Double">aggregateReqRate</a>, <a href="#64779" title="=&gt; Int">targetNumServers</a>.<span title="=&gt; Int">toInt</span>, <a href="#64788" title="=&gt; scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">servers</a>.<span title="=&gt; Int">size</span>, <a href="#66206" title="Double">averageUtilization</a><span class="delimiter">)</span>
          <span class="keyword">try</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="Option[Int]" id="67467">numResults</a> = <a href="#67386" title="Option[java.sql.Statement]">s</a>.<span title="(f: java.sql.Statement =&gt; Int)Option[Int]">map</span><span class="delimiter">(</span><a href="#67472" title="java.sql.Statement">_</a>.<span title="(x$1: java.lang.String)Int">executeUpdate</span><span class="delimiter">(</span><a href="#67388" title="java.lang.String">sqlInsertCmd</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#67467" title="Option[Int]">numResults</a>.<span title="(default: =&gt; Int)Int">getOrElse</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
              <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;SQL INSERT statment failed.&quot;)" class="string">&quot;SQL INSERT statment failed.&quot;</span><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a title="Unit" id="67488">e</a>: <span title="java.sql.SQLException">SQLException</span> =&gt; <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(thrown: Throwable, msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><a href="#67488" title="java.sql.SQLException">e</a>, <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;SQL INSERT statement failed: %s.&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#67388" title="java.lang.String">sqlInsertCmd</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>

        <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;aggregateReqRate is &quot;)" class="string">&quot;aggregateReqRate is &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#66204" title="Double">aggregateReqRate</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;, targetNumServers is &quot;)" class="string">&quot;, targetNumServers is &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#64779" title="=&gt; Int">targetNumServers</a><span class="delimiter">)</span>

        <span class="comment">// if necessary, kill backends</span>
        <span class="keyword">val</span> <a title="Int" id="66207">numToKill</a> = <a href="#64788" title="=&gt; scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">servers</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">-</span> <a href="#64779" title="implicit scala.LowPriorityImplicits.floatWrapper : (x: Float)scala.runtime.RichFloat">targetNumServers</a>.<span title="=&gt; Float">ceil</span>.<span title="=&gt; Int">toInt</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#66207" title="Int">numToKill</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#64799" title="(numServers: Int)Unit">killTasks</a><span class="delimiter">(</span><a href="#66207" title="Int">numToKill</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><a href="#66110" title="=&gt; Long">period</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(numServers: Int)Unit" id="64799">killTasks</a><span class="delimiter">(</span><a title="Int" id="67514">numServers</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Calling driver.kill() for %d webservers.&quot;)" class="string">&quot;Calling driver.kill() for %d webservers.&quot;</span>, <a href="#64773" title="=&gt; Int">numToKill</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]" id="67517">toKill</a> = <a href="#64788" title="=&gt; scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">servers</a>.<span title="(n: Int)scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">take</span><span class="delimiter">(</span><a href="#64773" title="=&gt; Int">numToKill</a><span class="delimiter">)</span>
    <a href="#67517" title="scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">toKill</a>.<span title="(f: (org.apache.mesos.Protos.TaskID, String) =&gt; Unit)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String],Unit,scala.collection.immutable.Iterable[Unit]])scala.collection.immutable.Iterable[Unit]">map</span> <a href="#67539" title="Unit" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="Unit" class="delimiter">(</span><a title="org.apache.mesos.Protos.TaskID" id="67542">victimID</a>, <a title="String" id="67543">victimHost</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Killing task %d on node %s.&quot;)" class="string">&quot;Killing task %d on node %s.&quot;</span>, <a href="#67542" title="org.apache.mesos.Protos.TaskID">victimID</a>, <a href="#67543" title="String">victimHost</a><span class="delimiter">)</span>
        <a href="#64757" title="=&gt; org.apache.mesos.MesosSchedulerDriver">driver</a>.<span title="(x$1: org.apache.mesos.Protos.TaskID)Int">killTask</span><span class="delimiter">(</span><a href="#67542" title="org.apache.mesos.Protos.TaskID">victimID</a><span class="delimiter">)</span>
        <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Removing webserver task &quot;)" class="string">&quot;Removing webserver task &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#67542" title="org.apache.mesos.Protos.TaskID">victimID</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; on host &quot;)" class="string">&quot; on host &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#67543" title="String">victimHost</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; from hashmap of servers.&quot;)" class="string">&quot; from hashmap of servers.&quot;</span><span class="delimiter">)</span>
        <a href="#64764" title="(action: String)Unit">recordAction</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Webapp Director killed an unecessary webapp server of %s's. Inefficiencies will not be tolerated!&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#64821" title="String">name</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#64788" title="(x$1: scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String])Unit">servers</a> <span title="(key: org.apache.mesos.Protos.TaskID)scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">-=</span> <a href="#67542" title="org.apache.mesos.Protos.TaskID">victimID</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#64815" title="()Unit">updateZooWebServerList</a><span class="delimiter">(</span><span class="delimiter">)</span>;
  <span class="delimiter">}</span>

  <span class="keyword">val</span> <a title="java.lang.Thread" id="64800">monitoringThread</a> = <span title="(x$1: java.lang.Runnable, x$2: java.lang.String)java.lang.Thread" class="keyword">new</span> <span title="java.lang.Thread">Thread</span><span class="delimiter">(</span><a href="#66110" title="WebAppScheduler.this.monitorThread" class="keyword">new</a> <a href="#64797" title="WebAppScheduler.this.monitorThread">monitorThread</a><span class="delimiter">(</span><span class="delimiter">)</span>, <span title="java.lang.String(&quot;WebAppScheduler Monitoring Thread&quot;)" class="string">&quot;WebAppScheduler Monitoring Thread&quot;</span><span class="delimiter">)</span>
  <a href="#64800" title="=&gt; java.lang.Thread">monitoringThread</a>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <a href="#64759" title="=&gt; java.lang.Thread">driverThread</a>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Periodically sends an http GET request to a server until it responds
   * with a status 200 or until a timeout. If the timeout is reached, kills
   * the mesos task so that it doesn't become a zombie task.
   *
   * @param taskId - the mesos taskId associated with this web app server.
   * @param serverHostname - the hostname of the web app server that was started.
   * @param sleepPeriod - how often, in ms, to check for a successful server response. Default is 10 seconds.
   * @param timeout - how long, in ms, to spend checking for an http 200 status response before giving up and killing the mesos task associated with the server. Default is 5 minutes.
   */</span>
  <span class="keyword">class</span> <a title="class WebAppPrimerThread extends java.lang.Object with java.lang.Runnable with ScalaObject" id="64803">WebAppPrimerThread</a><a href="#64803" title="ScalaObject" class="delimiter">(</a><a title="org.apache.mesos.Protos.TaskID" id="67666">taskId</a>: <span title="org.apache.mesos.Protos.TaskID">TaskID</span>, <a title="String" id="67667">serverHostname</a>: <span title="String">String</span>, <a title="Int" id="67672">numSuccessRequired</a>: <span title="Int">Int</span> = <span title="Int(100)" class="int">100</span>, <a title="Int" id="67673">sleepPeriod</a>: <span title="Int">Int</span> = <span class="int">10</span> <span title="Int(10000)">*</span> <span class="int">1000</span>, <a title="Int" id="67674">timeout</a>: <span title="Int">Int</span> = <span class="int">5</span> * <span class="int">60</span> <span title="Int(300000)">*</span> <span class="int">1000</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="java.lang.Runnable">Runnable</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="org.apache.commons.httpclient.HttpClient" id="67655">httpClient</a> = <span title="org.apache.commons.httpclient.HttpClient" class="keyword">new</span> <span title="org.apache.commons.httpclient.HttpClient">HttpClient</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="67657">run</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">var</span> <a title="Int" id="67689">timeoutCountdown</a> = <a href="#67674" title="Int">timeout</a>
      <span class="keyword">var</span> <a title="Int" id="67690">numSuccesses</a> = <span title="Int(0)" class="int">0</span>
      <span class="keyword">var</span> <a title="Boolean" id="67691">serverIsUp</a> = <span title="Boolean(false)" class="keyword">false</span>
      <span class="keyword">var</span> <a title="Boolean" id="67692">exitThread</a> = <span title="Boolean(false)" class="keyword">false</span>
      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#67692" title="Boolean">exitThread</a><span class="delimiter">)</span> <a href="#67693" title="()Unit" class="delimiter">{</a>
        <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><a href="#67673" title="=&gt; Long">sleepPeriod</a><span class="delimiter">)</span>
        <a href="#67689" title="Int">timeoutCountdown</a> <span title="(x: Int)Int">-=</span> <a href="#67673" title="Int">sleepPeriod</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#67689" title="Int">timeoutCountdown</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;The webserver on host %s never came up, killing the mesos task associated with it now.&quot;)" class="string">&quot;The webserver on host %s never came up, killing the mesos task associated with it now.&quot;</span>, <a href="#67667" title="String">serverHostname</a><span class="delimiter">)</span>
          <a href="#64757" title="=&gt; org.apache.mesos.MesosSchedulerDriver">driver</a>.<span title="(x$1: org.apache.mesos.Protos.TaskID)Int">killTask</span><span class="delimiter">(</span><a href="#67666" title="org.apache.mesos.Protos.TaskID">taskId</a><span class="delimiter">)</span>
          <a href="#64791" title="(x$1: scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String])Unit">pendingServers</a> <span title="(key: org.apache.mesos.Protos.TaskID)scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">-=</span> <a href="#67666" title="org.apache.mesos.Protos.TaskID">taskId</a>
          <a href="#64764" title="(action: String)Unit">recordAction</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;The webserver for app %s killed webapp server task on host %s because it never responded, it was weak and deserved to be killed.&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#64821" title="String">name</a>, <a href="#67666" title="org.apache.mesos.Protos.TaskID">taskId</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#67692" title="Boolean">exitThread</a> = <span title="Boolean(true)" class="keyword">true</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="String" id="67728">appUrl</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;http://%s:%d/&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#67667" title="String">serverHostname</a>, <a href="#64765" title="=&gt; Int">port</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="org.apache.commons.httpclient.methods.GetMethod" id="67729">method</a> = <span title="(x$1: java.lang.String)org.apache.commons.httpclient.methods.GetMethod" class="keyword">new</span> <span title="org.apache.commons.httpclient.methods.GetMethod">GetMethod</span><span class="delimiter">(</span><a href="#67728" title="String">appUrl</a><span class="delimiter">)</span>
          <a href="#67735" title="Unit" class="keyword">do</a> <span class="delimiter">{</span>
            <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Sending a priming HTTP request to %s.&quot;)" class="string">&quot;Sending a priming HTTP request to %s.&quot;</span>, <a href="#67728" title="String">appUrl</a><span class="delimiter">)</span>
            <span class="keyword">try</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="Int" id="67740">status</a> = <a href="#67655" title="=&gt; org.apache.commons.httpclient.HttpClient">httpClient</a>.<span title="(x$1: org.apache.commons.httpclient.HttpMethod)Int">executeMethod</span><span class="delimiter">(</span><a href="#67729" title="org.apache.commons.httpclient.methods.GetMethod">method</a><span class="delimiter">)</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#67740" title="Int">status</a> <span title="(x: Int)Boolean">==</span> <span title="Int(200)" class="int">200</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#67691" title="Boolean">serverIsUp</a> = <span title="Boolean(true)" class="keyword">true</span>
                <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Server %s contacted successfully&quot;)" class="string">&quot;Server %s contacted successfully&quot;</span>, <a href="#67728" title="String">appUrl</a><span class="delimiter">)</span>
                <a href="#67690" title="Int">numSuccesses</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
                <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#67690" title="Int">numSuccesses</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="#67672" title="Int">numSuccessRequired</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <a href="#67692" title="Boolean">exitThread</a> = <span title="Boolean(true)" class="keyword">true</span>
                  <a href="#9821" title="WebAppScheduler.this.type">scheduler</a>.<span title="(x$1: Unit)Unit">synchronized</span> <span class="delimiter">{</span>
                    <a href="#64788" title="(x$1: scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String])Unit">servers</a> <span title="(kv: (org.apache.mesos.Protos.TaskID, String))scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">+=</span> <a href="#67666" title="(x: org.apache.mesos.Protos.TaskID)ArrowAssoc[org.apache.mesos.Protos.TaskID]">taskId</a> <span title="(y: String)(org.apache.mesos.Protos.TaskID, String)">-&gt;</span> <a href="#67667" title="String">serverHostname</a>
                    <a href="#64791" title="(x$1: scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String])Unit">pendingServers</a> <span title="(key: org.apache.mesos.Protos.TaskID)scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">-=</span> <a href="#67666" title="org.apache.mesos.Protos.TaskID">taskId</a>
                  <span class="delimiter">}</span>
                  <a href="#64815" title="()Unit">updateZooWebServerList</a><span class="delimiter">(</span><span class="delimiter">)</span>
                  <a href="#64764" title="(action: String)Unit">recordAction</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Webapp Director added a webapp server for %s. Good luck young server!&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#64821" title="String">name</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="delimiter">}</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <a title="Unit" id="67887">e</a> =&gt;
                <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;priming GET request to %s failed.&quot;)" class="string">&quot;priming GET request to %s failed.&quot;</span>, <a href="#67728" title="String">appUrl</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span> <span class="keyword">while</span> <span class="delimiter">(</span><a href="#67691" title="Boolean">serverIsUp</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#67692" title="Boolean">exitThread</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(d: org.apache.mesos.SchedulerDriver)String" id="64805">getFrameworkName</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="67892">d</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span><span class="delimiter">)</span>: <span title="String">String</span> = <span title="java.lang.String(&quot;WebAppScheduler: &quot;)" class="string">&quot;WebAppScheduler: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#64821" title="String">name</a>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(d: org.apache.mesos.SchedulerDriver)org.apache.mesos.Protos.ExecutorInfo" id="64806">getExecutorInfo</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="67894">d</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span><span class="delimiter">)</span>: <span title="org.apache.mesos.Protos.ExecutorInfo">ExecutorInfo</span> = <span title="object org.apache.mesos.Protos.ExecutorInfo">ExecutorInfo</span>.<span title="()org.apache.mesos.Protos.ExecutorInfo.Builder">newBuilder</span>.<span title="(x$1: java.lang.String)org.apache.mesos.Protos.ExecutorInfo.Builder">setUri</span><span class="delimiter">(</span><a href="#64823" title="String">executor</a><span class="delimiter">)</span>.<span title="()org.apache.mesos.Protos.ExecutorInfo">build</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(d: org.apache.mesos.SchedulerDriver, fid: org.apache.mesos.Protos.FrameworkID)Unit" id="64807">registered</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="67899">d</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span>, <a title="org.apache.mesos.Protos.FrameworkID" id="67900">fid</a>: <span title="org.apache.mesos.Protos.FrameworkID">FrameworkID</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Registered Framework.  Fid: &quot;)" class="string">&quot;Registered Framework.  Fid: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#67900" title="org.apache.mesos.Protos.FrameworkID">fid</a><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="deploylib.mesos.JvmWebAppTask" id="64808">webAppTask</a> = <a href="mesos/Messages.scala.html#75239" title="(warFile: deploylib.mesos.ClassSource, properties: Map[String,String])deploylib.mesos.JvmWebAppTask">JvmWebAppTask</a><span class="delimiter">(</span><a href="#64824" title="deploylib.mesos.ClassSource">warFile</a>, <a href="#64825" title="Map[String,String]">properties</a><span class="delimiter">)</span>
  <span class="keyword">var</span> <a title="Int" id="64811">taskIdCounter</a> = <span title="Int(0)" class="int">0</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.SchedulerDriver, oid: org.apache.mesos.Protos.OfferID, offers: java.util.List[org.apache.mesos.Protos.SlaveOffer])Unit" id="64813">resourceOffer</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="67904">driver</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span>, <a title="org.apache.mesos.Protos.OfferID" id="67905">oid</a>: <span title="org.apache.mesos.Protos.OfferID">OfferID</span>, <a title="java.util.List[org.apache.mesos.Protos.SlaveOffer]" id="67906">offers</a>: java.util.<span title="java.util.List[org.apache.mesos.Protos.SlaveOffer]">List</span><span class="delimiter">[</span>SlaveOffer<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="scala.collection.mutable.Buffer[org.apache.mesos.Protos.TaskDescription]" id="67908">tasks</a> = <a href="#67906" title="(l: java.util.List[org.apache.mesos.Protos.SlaveOffer])scala.collection.mutable.Buffer[org.apache.mesos.Protos.SlaveOffer]">offers</a>.<span title="(f: org.apache.mesos.Protos.SlaveOffer =&gt; scala.collection.GenTraversableOnce[org.apache.mesos.Protos.TaskDescription])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[org.apache.mesos.Protos.SlaveOffer],org.apache.mesos.Protos.TaskDescription,scala.collection.mutable.Buffer[org.apache.mesos.Protos.TaskDescription]])scala.collection.mutable.Buffer[org.apache.mesos.Protos.TaskDescription]">flatMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,org.apache.mesos.Protos.TaskDescription,scala.collection.mutable.Buffer[org.apache.mesos.Protos.TaskDescription]]" class="delimiter">(</span><a title="org.apache.mesos.Protos.SlaveOffer" id="68184">offer</a> =&gt; <span class="delimiter">{</span>
      <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;In resourceOffer, taskIdCounter is &quot;)" class="string">&quot;In resourceOffer, taskIdCounter is &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#64811" title="=&gt; Int">taskIdCounter</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;, targetNumServers is &quot;)" class="string">&quot;, targetNumServers is &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#64779" title="=&gt; Int">targetNumServers</a><span class="delimiter">)</span>
      <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;servers.size is %d.&quot;)" class="string">&quot;servers.size is %d.&quot;</span>, <a href="#64788" title="=&gt; scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">servers</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;pendingServers.size is %d.&quot;)" class="string">&quot;pendingServers.size is %d.&quot;</span>, <a href="#64791" title="=&gt; scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">pendingServers</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <span title="List[org.apache.mesos.Protos.TaskDescription]" class="keyword">if</span> <span class="delimiter">(</span><a href="#64788" title="=&gt; scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">servers</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">+</span> <a href="#64791" title="=&gt; scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">pendingServers</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">&lt;</span> <a href="#64779" title="=&gt; Int">targetNumServers</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;adding server %s as task %d&quot;)" class="string">&quot;adding server %s as task %d&quot;</span>, <a href="#68184" title="org.apache.mesos.Protos.SlaveOffer">offer</a>.<span title="()java.lang.String">getHostname</span>, <a href="#64811" title="=&gt; Int">taskIdCounter</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="org.apache.mesos.Protos.TaskID" id="68207">newTaskId</a> = <span title="object org.apache.mesos.Protos.TaskID">TaskID</span>.<span title="()org.apache.mesos.Protos.TaskID.Builder">newBuilder</span>.<span title="(x$1: java.lang.String)org.apache.mesos.Protos.TaskID.Builder">setValue</span><span class="delimiter">(</span><a href="#64811" title="=&gt; Int">taskIdCounter</a>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span>.<span title="()org.apache.mesos.Protos.TaskID">build</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#64811" title="(x$1: Int)Unit">taskIdCounter</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>

        <a href="#9821" title="WebAppScheduler.this.type">scheduler</a>.<span title="(x$1: Unit)Unit">synchronized</span> <span class="delimiter">{</span>
          <a href="#64791" title="(x$1: scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String])Unit">pendingServers</a> <span title="(kv: (org.apache.mesos.Protos.TaskID, String))scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">+=</span> <a href="#68207" title="(x: org.apache.mesos.Protos.TaskID)ArrowAssoc[org.apache.mesos.Protos.TaskID]">newTaskId</a> <span title="(y: java.lang.String)(org.apache.mesos.Protos.TaskID, java.lang.String)">-&gt;</span> <a href="#68184" title="org.apache.mesos.Protos.SlaveOffer">offer</a>.<span title="()java.lang.String">getHostname</span>
        <span class="delimiter">}</span>

        <span title="(x$1: java.lang.Runnable)java.lang.Thread" class="keyword">new</span> <span title="java.lang.Thread">Thread</span><span class="delimiter">(</span><a href="#67672" title="WebAppScheduler.this.WebAppPrimerThread" class="keyword">new</a> <a href="#64803" title="WebAppScheduler.this.WebAppPrimerThread">WebAppPrimerThread</a><span class="delimiter">(</span><a href="#68207" title="org.apache.mesos.Protos.TaskID">newTaskId</a>, <a href="#68184" title="org.apache.mesos.Protos.SlaveOffer">offer</a>.<span title="()java.lang.String">getHostname</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>

        <span class="keyword">var</span> <a title="List[org.apache.mesos.Protos.TaskDescription]" id="68208">td</a> = <span title="object org.apache.mesos.Protos.TaskDescription">TaskDescription</span>.<span title="()org.apache.mesos.Protos.TaskDescription.Builder">newBuilder</span>
                                .<span title="(x$1: org.apache.mesos.Protos.TaskID)org.apache.mesos.Protos.TaskDescription.Builder">setTaskId</span><span class="delimiter">(</span><a href="#68207" title="org.apache.mesos.Protos.TaskID">newTaskId</a><span class="delimiter">)</span>
                                .<span title="(x$1: org.apache.mesos.Protos.SlaveID)org.apache.mesos.Protos.TaskDescription.Builder">setSlaveId</span><span class="delimiter">(</span><a href="#68184" title="org.apache.mesos.Protos.SlaveOffer">offer</a>.<span title="()org.apache.mesos.Protos.SlaveID">getSlaveId</span><span class="delimiter">)</span>
                                .<span title="(x$1: java.lang.String)org.apache.mesos.Protos.TaskDescription.Builder">setName</span><span class="delimiter">(</span><a href="#64808" title="=&gt; deploylib.mesos.JvmWebAppTask">webAppTask</a>.<a href="mesos/Messages.scala.html#75239" title="()String">toString</a><span class="delimiter">)</span>
                                .<span title="(x$1: java.lang.Iterable[_ &lt;: org.apache.mesos.Protos.Resource])org.apache.mesos.Protos.TaskDescription.Builder">addAllResources</span><span class="delimiter">(</span><a href="#68184" title="org.apache.mesos.Protos.SlaveOffer">offer</a>.<span title="()java.util.List[org.apache.mesos.Protos.Resource]">getResourcesList</span><span class="delimiter">)</span>
                                .<span title="(x$1: com.google.protobuf.ByteString)org.apache.mesos.Protos.TaskDescription.Builder">setData</span><span class="delimiter">(</span><span title="object com.google.protobuf.ByteString">ByteString</span>.<span title="(x$1: Array[Byte])com.google.protobuf.ByteString">copyFrom</span><span class="delimiter">(</span><a href="mesos/Messages.scala.html#58033" title="(task: deploylib.mesos.JvmTask)Array[Byte]">JvmTask</a><span class="delimiter">(</span><a href="#64808" title="=&gt; deploylib.mesos.JvmWebAppTask">webAppTask</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                                .<span title="()org.apache.mesos.Protos.TaskDescription">build</span><span class="delimiter">(</span><span class="delimiter">)</span> <a href="#68337" title="(x: org.apache.mesos.Protos.TaskDescription)List[org.apache.mesos.Protos.TaskDescription]">::</a> <span title="object Nil">Nil</span>
        <a href="#68208" title="List[org.apache.mesos.Protos.TaskDescription]">td</a>
      <span class="delimiter">}</span>
      <span class="keyword">else</span>
        <span title="object Nil">Nil</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    <a href="#67904" title="org.apache.mesos.SchedulerDriver">driver</a>.<span title="(x$1: org.apache.mesos.Protos.OfferID, x$2: java.util.Collection[org.apache.mesos.Protos.TaskDescription], x$3: java.util.Map[java.lang.String,java.lang.String])Int">replyToOffer</span><span title="Unit" class="delimiter">(</span><a href="#67905" title="org.apache.mesos.Protos.OfferID">oid</a>, <a href="#67908" title="(b: scala.collection.mutable.Buffer[org.apache.mesos.Protos.TaskDescription])java.util.List[org.apache.mesos.Protos.TaskDescription]">tasks</a>, <span title="[A, B](elems: (A, B)*)scala.collection.immutable.Map[A,B]">Map</span><span title="(elems: (String, String)*)scala.collection.immutable.Map[String,String]" class="delimiter">[</span><span title="String">String</span>, <span title="String">String</span><span class="delimiter">]</span><span title="(m: scala.collection.Map[String,String])java.util.Map[String,String]" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>


  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(d: org.apache.mesos.SchedulerDriver, status: org.apache.mesos.Protos.TaskStatus)Unit" id="64814">statusUpdate</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="68535">d</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span>, <a title="org.apache.mesos.Protos.TaskStatus" id="68536">status</a>: <span title="org.apache.mesos.Protos.TaskStatus">TaskStatus</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#68536" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()org.apache.mesos.Protos.TaskState">getState</span> <span title="(x$1: AnyRef)Boolean">==</span> TaskState.<span title="org.apache.mesos.Protos.TaskState(value TASK_FAILED)">TASK_FAILED</span> <span title="(x: Boolean)Boolean">||</span> <a href="#68536" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()org.apache.mesos.Protos.TaskState">getState</span> <span title="(x$1: AnyRef)Boolean">==</span> TaskState.<span title="org.apache.mesos.Protos.TaskState(value TASK_LOST)">TASK_LOST</span> <span title="(x: Boolean)Boolean">||</span> <a href="#68536" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()org.apache.mesos.Protos.TaskState">getState</span> <span title="(x$1: AnyRef)Boolean">==</span> TaskState.<span title="org.apache.mesos.Protos.TaskState(value TASK_KILLED)">TASK_KILLED</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Status Update for Task %d: %s&quot;)" class="string">&quot;Status Update for Task %d: %s&quot;</span>, <a href="#68536" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span>, <a href="#68536" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()org.apache.mesos.Protos.TaskState">getState</span><span class="delimiter">)</span>
      <span class="comment">//TODO: restarted failed app servers</span>
    <span class="delimiter">}</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Status Update: &quot;)" class="string">&quot;Status Update: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#68536" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()org.apache.mesos.Protos.TaskID">getTaskId</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#68536" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()org.apache.mesos.Protos.TaskState">getState</span><span class="delimiter">)</span>
      <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(message: =&gt; AnyRef)Unit">ifDebug</span><span class="delimiter">(</span><span title="(x$1: Array[Byte])java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="#68536" title="org.apache.mesos.Protos.TaskStatus">status</a>.<span title="()com.google.protobuf.ByteString">getData</span>.<span title="()Array[Byte]">toByteArray</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="64815">updateZooWebServerList</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="String" id="67605">serverList</a> = <a href="#64788" title="=&gt; scala.collection.immutable.HashMap[org.apache.mesos.Protos.TaskID,String]">servers</a>.<span title="=&gt; Iterable[String]">values</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>
    <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Updating zookeeper list of webservers to %s&quot;)" class="string">&quot;Updating zookeeper list of webservers to %s&quot;</span>, <a href="#67605" title="String">serverList</a><span class="delimiter">)</span>
    <a href="#64767" title="=&gt; edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">zkWebServerList</a>.<span title="(d: Array[Byte])Unit">data</span> = <a href="#67605" title="String">serverList</a>.<span title="()Array[Byte]">getBytes</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Unit" id="64816">kill</a> = <span class="delimiter">{</span>
    <a href="#64757" title="=&gt; org.apache.mesos.MesosSchedulerDriver">driver</a>.<span title="()Int">stop</span>
    <a href="#64770" title="(x$1: Boolean)Unit">runMonitorThread</a> = <span title="Boolean(false)" class="keyword">false</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.SchedulerDriver, code: Int, message: String)Unit" id="64817">error</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="68569">driver</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span>, <a title="Int" id="68570">code</a>: <span title="Int">Int</span>, <a title="String" id="68571">message</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;MESOS ERROR %d: %s&quot;)" class="string">&quot;MESOS ERROR %d: %s&quot;</span>, <a href="#68570" title="Int">code</a>, <a href="#68571" title="String">message</a><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.SchedulerDriver, slaveId: org.apache.mesos.Protos.SlaveID)Unit" id="64818">slaveLost</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="68577">driver</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span>, <a title="org.apache.mesos.Protos.SlaveID" id="68578">slaveId</a>: <span title="org.apache.mesos.Protos.SlaveID">SlaveID</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;SLAVE LOST: %s&quot;)" class="string">&quot;SLAVE LOST: %s&quot;</span>, <a href="#68578" title="org.apache.mesos.Protos.SlaveID">slaveId</a><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.SchedulerDriver, slaveId: org.apache.mesos.Protos.SlaveID, executor: org.apache.mesos.Protos.ExecutorID, data: Array[Byte])Unit" id="64819">frameworkMessage</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="68584">driver</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span>, <a title="org.apache.mesos.Protos.SlaveID" id="68585">slaveId</a>: <span title="org.apache.mesos.Protos.SlaveID">SlaveID</span>, <a title="org.apache.mesos.Protos.ExecutorID" id="68586">executor</a>: <span title="org.apache.mesos.Protos.ExecutorID">ExecutorID</span>, <a title="Array[Byte]" id="68587">data</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;FW Message: %s %s %s&quot;)" class="string">&quot;FW Message: %s %s %s&quot;</span>, <a href="#68585" title="org.apache.mesos.Protos.SlaveID">slaveId</a>, <a href="#68586" title="org.apache.mesos.Protos.ExecutorID">executor</a>, <span title="(x$1: Array[Byte])java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="#68587" title="Array[Byte]">data</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(driver: org.apache.mesos.SchedulerDriver, oid: org.apache.mesos.Protos.OfferID)Unit" id="64820">offerRescinded</a><span class="delimiter">(</span><a title="org.apache.mesos.SchedulerDriver" id="68597">driver</a>: <span title="org.apache.mesos.SchedulerDriver">SchedulerDriver</span>, <a title="org.apache.mesos.Protos.OfferID" id="68598">oid</a>: <span title="org.apache.mesos.Protos.OfferID">OfferID</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#64751" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Offer Rescinded: %s&quot;)" class="string">&quot;Offer Rescinded: %s&quot;</span>, <a href="#68598" title="org.apache.mesos.Protos.OfferID">oid</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>