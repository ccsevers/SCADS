<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>rcluster/RCluster.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> deploylib.rcluster

<span class="keyword">import</span> deploylib._
<span class="keyword">import</span> deploylib.runit._

<span class="keyword">import</span> java.io.File
<span class="keyword">import</span> scala.util.matching.Regex
<span class="keyword">import</span> ch.ethz.ssh2.<span class="delimiter">{</span> Connection, Session, ChannelCondition, SCPClient <span class="delimiter">}</span>

<span class="comment">/**
 * Convienence methods for working with the RCluster
 */</span>
<span class="keyword">object</span> <a title="object deploylib.rcluster.RCluster" id="9792">RCluster</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">val</span> <a title="List[deploylib.rcluster.RClusterNode]" id="82226">nodes</a> = <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">1</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <span title="Int(40)" class="int">40</span><span class="delimiter">)</span>.<span title="=&gt; List[Int]">toList</span>.<span title="(f: Int =&gt; deploylib.rcluster.RClusterNode)(implicit bf: scala.collection.generic.CanBuildFrom[List[Int],deploylib.rcluster.RClusterNode,List[deploylib.rcluster.RClusterNode]])List[deploylib.rcluster.RClusterNode]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,deploylib.rcluster.RClusterNode,List[deploylib.rcluster.RClusterNode]]" class="delimiter">(</span><span title="deploylib.rcluster.RClusterNode" class="keyword">new</span> <a href="#9794" title="deploylib.rcluster.RClusterNode">RClusterNode</a><span class="delimiter">(</span><a href="#82372" title="Int">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Returns an array of all rcluster nodes that respond to a simple command in less than 5 seconds
   */</span>
  <span class="keyword">def</span> <a title="(timeout: Int)List[deploylib.rcluster.RClusterNode]" id="82228">activeNodes</a><span class="delimiter">(</span><a title="Int" id="82431">timeout</a>: <span title="Int">Int</span> = <span title="Int(10000)" class="int">10000</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="List[(deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse])]" id="82432">check</a> = <a href="#82226" title="=&gt; List[deploylib.rcluster.RClusterNode]">nodes</a>.<span title="(f: deploylib.rcluster.RClusterNode =&gt; (deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse]))(implicit bf: scala.collection.generic.CanBuildFrom[List[deploylib.rcluster.RClusterNode],(deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse]),List[(deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse])]])List[(deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse])]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,(deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse]),List[(deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse])]]" class="delimiter">(</span><span class="delimiter">(</span><a title="deploylib.rcluster.RClusterNode" id="82449">n</a><span class="delimiter">)</span> =&gt; <span title="(_1: deploylib.rcluster.RClusterNode, _2: deploylib.Future[deploylib.ExecuteResponse])(deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse])" class="delimiter">(</span><a href="#82449" title="deploylib.rcluster.RClusterNode">n</a>, <a href="../Concurrent.scala.html#10047" title="(f: =&gt; deploylib.ExecuteResponse)deploylib.Future[deploylib.ExecuteResponse]">Future</a><span class="delimiter">(</span><a href="#82449" title="deploylib.rcluster.RClusterNode">n</a>.<a href="../RemoteMachine.scala.html#25743" title="(cmd: String)deploylib.ExecuteResponse">executeCommand</a><span class="delimiter">(</span><span title="java.lang.String(&quot;hostname&quot;)" class="string">&quot;hostname&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><a href="#82431" title="=&gt; Long">timeout</a><span class="delimiter">)</span>
    <a href="#82432" title="List[(deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse])]">check</a>.<span title="(f: (deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse]) =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="(deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse])" id="82509">c</a><span class="delimiter">)</span> =&gt; <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#82509" title="(deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse])">c</a>.<span title="=&gt; deploylib.Future[deploylib.ExecuteResponse]">_2</span>.<a href="../Concurrent.scala.html#10058" title="=&gt; Boolean">isDone</a><span class="delimiter">)</span> <a href="#82509" title="(deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse])">c</a>.<span title="=&gt; deploylib.Future[deploylib.ExecuteResponse]">_2</span>.<a href="../Concurrent.scala.html#10057" title="()Unit">cancel</a><span class="delimiter">)</span>
    <a href="#82432" title="List[(deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse])]">check</a>.<span title="(p: (deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse]) =&gt; Boolean)List[(deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse])]">filter</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="(deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse])" id="82514">c</a><span class="delimiter">)</span> =&gt; <a href="#82514" title="(deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse])">c</a>.<span title="=&gt; deploylib.Future[deploylib.ExecuteResponse]">_2</span>.<a href="../Concurrent.scala.html#10058" title="=&gt; Boolean">isDone</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#82514" title="(deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse])">c</a>.<span title="=&gt; deploylib.Future[deploylib.ExecuteResponse]">_2</span>.<a href="../Concurrent.scala.html#10059" title="=&gt; Boolean">success</a><span class="delimiter">)</span>.<span title="(f: (deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse]) =&gt; deploylib.rcluster.RClusterNode)(implicit bf: scala.collection.generic.CanBuildFrom[List[(deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse])],deploylib.rcluster.RClusterNode,List[deploylib.rcluster.RClusterNode]])List[deploylib.rcluster.RClusterNode]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,deploylib.rcluster.RClusterNode,List[deploylib.rcluster.RClusterNode]]" class="delimiter">(</span><span class="delimiter">(</span><a title="(deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse])" id="82542">c</a><span class="delimiter">)</span> =&gt; <a href="#82542" title="(deploylib.rcluster.RClusterNode, deploylib.Future[deploylib.ExecuteResponse])">c</a>.<span title="=&gt; deploylib.rcluster.RClusterNode">_1</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Concrete child of a RemoteMachine customized for working with the RCluster
 */</span>
<span class="keyword">class</span> <a title="class RClusterNode extends deploylib.RemoteMachine with deploylib.runit.RunitManager with ScalaObject" id="9794">RClusterNode</a><a href="#9794" title="ScalaObject" class="delimiter">(</a><a title="Int" id="82144">num</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../RemoteMachine.scala.html#9495" title="deploylib.RemoteMachine">RemoteMachine</a> <span class="keyword">with</span> <a href="../runit/RunitManager.scala.html#9800" title="deploylib.runit.RunitManager">RunitManager</a> <span class="delimiter">{</span>
  <span class="keyword">val</span> <a title="java.lang.String" id="81948">hostname</a> = <span title="java.lang.String(&quot;r&quot;)" class="string">&quot;r&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#82144" title="Int">num</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.millennium.berkeley.edu&quot;)" class="string">&quot;.millennium.berkeley.edu&quot;</span>
  <span class="keyword">val</span> <a title="String" id="81950">username</a> = <a href="../Util.scala.html#9509" title="object deploylib.Util">Util</a>.<a href="../Util.scala.html#30719" title="=&gt; String">username</a>
  <span class="keyword">val</span> <a title="java.io.File" id="81952">rootDirectory</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/scratch/&quot;)" class="string">&quot;/scratch/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../Util.scala.html#9509" title="object deploylib.Util">Util</a>.<a href="../Util.scala.html#30719" title="=&gt; String">username</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="java.io.File" id="81954">runitBinaryPath</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/work/&quot;)" class="string">&quot;/work/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../Util.scala.html#9509" title="object deploylib.Util">Util</a>.<a href="../Util.scala.html#30719" title="=&gt; String">username</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;/runit&quot;)" class="string">&quot;/runit&quot;</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="java.io.File" id="81956">javaCmd</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/usr/lib/jvm/java-6-sun/bin/java&quot;)" class="string">&quot;/usr/lib/jvm/java-6-sun/bin/java&quot;</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="()Unit" id="81958">setupRunit</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="../RemoteMachine.scala.html#25743" title="(cmd: String)deploylib.ExecuteResponse">executeCommand</a><span class="delimiter">(</span><span title="java.lang.String(&quot;mkdir -p &quot;)" class="string">&quot;mkdir -p &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../RemoteMachine.scala.html#25728" title="=&gt; java.io.File">serviceRoot</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">ExecuteResponse</span><span class="delimiter">(</span>Some<span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> =&gt; <a href="../RemoteMachine.scala.html#25730" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Service Directory Created&quot;)" class="string">&quot;Service Directory Created&quot;</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="Unit" id="82595">e</a>: <a href="../RemoteMachine.scala.html#9488" title="deploylib.ExecuteResponse">ExecuteResponse</a> =&gt; <a href="../RemoteMachine.scala.html#25730" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Unexpected execution result while creating service directory: &quot;)" class="string">&quot;Unexpected execution result while creating service directory: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#82595" title="deploylib.ExecuteResponse">e</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="82587">runsvdirCommand</a> = <span title="scala.util.matching.Regex" class="keyword">new</span> <span title="scala.util.matching.Regex">Regex</span><span class="delimiter">(</span><span title="java.lang.String(&quot;runsvdir &quot;)" class="string">&quot;runsvdir &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../RemoteMachine.scala.html#25728" title="=&gt; java.io.File">serviceRoot</a><span class="delimiter">)</span>

    <a href="../RemoteMachine.scala.html#25743" title="(cmd: String)deploylib.ExecuteResponse">executeCommand</a><span class="delimiter">(</span><span title="java.lang.String(&quot;ps ax | grep runsvdir&quot;)" class="string">&quot;ps ax | grep runsvdir&quot;</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">ExecuteResponse</span><span class="delimiter">(</span>Some<span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <a title="String" id="82603">whatsRunning</a>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#82587" title="scala.util.matching.Regex">runsvdirCommand</a>.<span title="(source: java.lang.CharSequence)Option[String]">findFirstIn</span><span class="delimiter">(</span><a href="#82603" title="String">whatsRunning</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt; <a href="../RemoteMachine.scala.html#25730" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;runsvdir already running on &quot;)" class="string">&quot;runsvdir already running on &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#9794" title="deploylib.rcluster.RClusterNode" class="keyword">this</a><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit">None</span> =&gt; <span class="delimiter">{</span>
            <a href="../RemoteMachine.scala.html#25730" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Starting runsv since we only found &quot;)" class="string">&quot;Starting runsv since we only found &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#82603" title="String">whatsRunning</a><span class="delimiter">)</span>
            <a href="../RemoteMachine.scala.html#25730" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Result: %s&quot;)" class="string">&quot;Result: %s&quot;</span>, <a href="../RemoteMachine.scala.html#25743" title="(cmd: String)deploylib.ExecuteResponse">executeCommand</a><span class="delimiter">(</span><span title="java.lang.String(&quot;/bin/bash -c \&quot;PATH=&quot;)" class="string">&quot;/bin/bash -c \&quot;PATH=&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#81954" title="=&gt; java.io.File">runitBinaryPath</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; /usr/bin/nohup &quot;)" class="string">&quot; /usr/bin/nohup &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../RemoteMachine.scala.html#25722" title="=&gt; java.io.File">runsvdirCmd</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../RemoteMachine.scala.html#25728" title="=&gt; java.io.File">serviceRoot</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\&quot;&amp;&quot;)" class="string">&quot;\&quot;&amp;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a title="Unit" id="82617">e</a>: <a href="../RemoteMachine.scala.html#9488" title="deploylib.ExecuteResponse">ExecuteResponse</a> =&gt; <a href="../RemoteMachine.scala.html#25730" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Unexpected execution result while checking for runsvdir: &quot;)" class="string">&quot;Unexpected execution result while checking for runsvdir: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#82617" title="deploylib.ExecuteResponse">e</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(localFile: java.io.File)java.io.File" id="81959">cacheFile</a><span class="delimiter">(</span><a title="java.io.File" id="81962">localFile</a>: <span title="java.io.File">File</span><span class="delimiter">)</span>: <span title="java.io.File">File</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="String" id="82620">localMd5</a> = <a href="../Util.scala.html#9509" title="object deploylib.Util">Util</a>.<a href="../Util.scala.html#30725" title="(file: java.io.File)String">md5</a><span class="delimiter">(</span><a href="#81962" title="java.io.File">localFile</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.io.File" id="82621">cacheFile</a> = <span title="(x$1: java.lang.String, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/work/deploylib/cache&quot;)" class="string">&quot;/work/deploylib/cache&quot;</span>, <a href="#82620" title="String">localMd5</a><span class="delimiter">)</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#82620" title="String">localMd5</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../RemoteMachine.scala.html#25749" title="(remoteFile: java.io.File)String">md5</a><span class="delimiter">(</span><a href="#82621" title="java.io.File">cacheFile</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="../RemoteMachine.scala.html#25730" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Not uploading &quot;)" class="string">&quot;Not uploading &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#81962" title="java.io.File">localFile</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; as the hashes match&quot;)" class="string">&quot; as the hashes match&quot;</span><span class="delimiter">)</span>
    <span class="keyword">else</span>
      <a href="../RemoteMachine.scala.html#25738" title="(func: ch.ethz.ssh2.Connection =&gt; Unit, numTries: Int)Unit">useConnection</a><span class="delimiter">(</span><span class="delimiter">(</span><a title="ch.ethz.ssh2.Connection" id="82637">c</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="ch.ethz.ssh2.SCPClient" id="82638">scp</a> = <span title="ch.ethz.ssh2.SCPClient" class="keyword">new</span> <span title="ch.ethz.ssh2.SCPClient">SCPClient</span><span class="delimiter">(</span><a href="#82637" title="ch.ethz.ssh2.Connection">c</a><span class="delimiter">)</span>
        <a href="../RemoteMachine.scala.html#25730" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Hashes don\'t match, uploading %s to %s %s&quot;)" class="string">&quot;Hashes don't match, uploading %s to %s %s&quot;</span>, <a href="#81962" title="java.io.File">localFile</a>, <a href="#82621" title="java.io.File">cacheFile</a>.<span title="()java.lang.String">getName</span>, <a href="#82621" title="java.io.File">cacheFile</a>.<span title="()java.lang.String">getParent</span><span class="delimiter">)</span>
        <a href="#82638" title="ch.ethz.ssh2.SCPClient">scp</a>.<span title="(x$1: java.lang.String, x$2: java.lang.String, x$3: java.lang.String, x$4: java.lang.String)Unit">put</span><span class="delimiter">(</span><a href="#81962" title="java.io.File">localFile</a>.<span title="()java.lang.String">getCanonicalPath</span>, <a href="#82621" title="java.io.File">cacheFile</a>.<span title="()java.lang.String">getName</span>, <a href="#82621" title="java.io.File">cacheFile</a>.<span title="()java.lang.String">getParent</span>, <span title="java.lang.String(&quot;0755&quot;)" class="string">&quot;0755&quot;</span><span class="delimiter">)</span>
        <a href="../RemoteMachine.scala.html#25730" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Upload of &quot;)" class="string">&quot;Upload of &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#81962" title="java.io.File">localFile</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; complete&quot;)" class="string">&quot; complete&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
    <a href="#82621" title="java.io.File">cacheFile</a>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(localFile: java.io.File, remoteDirectory: java.io.File)Unit" id="81960">upload</a><span class="delimiter">(</span><a title="java.io.File" id="82652">localFile</a>: <span title="java.io.File">File</span>, <a title="java.io.File" id="82653">remoteDirectory</a>: <span title="java.io.File">File</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.io.File" id="82655">remoteFile</a> = <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#82653" title="java.io.File">remoteDirectory</a>, <a href="#82652" title="java.io.File">localFile</a>.<span title="()java.lang.String">getName</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.io.File" id="82656">cacheFilePath</a> = <a href="#81959" title="(localFile: java.io.File)java.io.File">cacheFile</a><span class="delimiter">(</span><a href="#82652" title="java.io.File">localFile</a><span class="delimiter">)</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#82656" title="java.io.File">cacheFilePath</a>.<span title="()java.lang.String">getName</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../RemoteMachine.scala.html#25749" title="(remoteFile: java.io.File)String">md5</a><span class="delimiter">(</span><a href="#82655" title="java.io.File">remoteFile</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="../RemoteMachine.scala.html#25730" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Not copying &quot;)" class="string">&quot;Not copying &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#82652" title="java.io.File">localFile</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; from cache as it matches&quot;)" class="string">&quot; from cache as it matches&quot;</span><span class="delimiter">)</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="../RemoteMachine.scala.html#25743" title="(cmd: String)deploylib.ExecuteResponse">executeCommand</a><span class="delimiter">(</span><span title="java.lang.String(&quot;cp &quot;)" class="string">&quot;cp &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#82656" title="java.io.File">cacheFilePath</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#82655" title="java.io.File">remoteFile</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Unit">ExecuteResponse</span><span class="delimiter">(</span>Some<span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, _, _<span class="delimiter">)</span> =&gt; <a href="../RemoteMachine.scala.html#25730" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Success&quot;)" class="string">&quot;Success&quot;</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <a href="../RemoteMachine.scala.html#25730" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">error</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Copy error&quot;)" class="string">&quot;Copy error&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>