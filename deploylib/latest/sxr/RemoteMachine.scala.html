<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>RemoteMachine.scala</title>
        <script type="text/javascript" src="jquery-all.js"></script>
        <script type="text/javascript" src="linked.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> deploylib

<span class="keyword">import</span> java.io.<span class="delimiter">{</span>File, BufferedReader, InputStreamReader<span class="delimiter">}</span>
<span class="keyword">import</span> net.lag.logging.Logger
<span class="keyword">import</span> ch.ethz.ssh2.<span class="delimiter">{</span>Connection, Session, ChannelCondition, SCPClient<span class="delimiter">}</span>

<span class="keyword">import</span> scala.collection.generic.SeqForwarder

<span class="comment">/**
 * Holds the results of the execution of a command on the remote machine.
 * @param status - the integer status code returned by the command if one was returned, otherwise None
 * @param stdout - a string with all of the data that was output on STDOUT by the command
 * @param stderr - a string with all of the data that was output on STDERR by the command
 */</span>
case <span class="keyword">class</span> <a title="class ExecuteResponse extends java.lang.Object with ScalaObject with Product with Serializable" id="35254">ExecuteResponse</a><a href="#35254" title="ScalaObject" class="delimiter">(</a><a title="Option[Int]" id="28931">status</a>: <span title="Option[Int]">Option</span><span class="delimiter">[</span>Int<span class="delimiter">]</span>, <a title="String" id="28932">stdout</a>: <span title="String">String</span>, <a title="String" id="28933">stderr</a>: <span title="String">String</span><span class="delimiter">)</span>

case <span class="keyword">class</span> <a title="class UnknownResponse extends java.lang.Exception with ScalaObject with Product with Serializable" id="35250">UnknownResponse</a><a href="#35250" title="ScalaObject" class="delimiter">(</a><a title="deploylib.ExecuteResponse" id="35247">er</a>: <a href="#35254" title="deploylib.ExecuteResponse">ExecuteResponse</a><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="java.lang.Exception">Exception</span>

<span class="comment">/**
 * A trait that allows remote machine to maintain a list of 'tags' that are stored
 * in a file in the user home directory on the remote machine.
 */</span>
<span class="keyword">trait</span> <a title="trait Taggable extends java.lang.Object with ScalaObject" id="9606">Taggable</a> <span title="ScalaObject" class="delimiter">{</span>
  self: RemoteMachine =&gt;

  <span class="keyword">val</span> <a title="java.io.File" id="20766">tagFile</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><span title="java.lang.String(&quot;~/.deploylib_tags&quot;)" class="string">&quot;~/.deploylib_tags&quot;</span><span class="delimiter">)</span>

  <span class="keyword">object</span> <a title="object Taggable.this.tags" id="20768">tags</a> <span title="ScalaObject" class="keyword">extends</span> <span title="scala.collection.generic.SeqForwarder[String]">SeqForwarder</span><span class="delimiter">[</span>String<span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; Seq[String]" id="21140">getTags</a>: <span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <a href="#9606" title="Taggable.this.type">self</a> <a href="#20796" title="(cmd: String)Unit">!</a> <span class="delimiter">(</span><span title="java.lang.String(&quot;touch &quot;)" class="string">&quot;touch &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#20766" title="=&gt; java.io.File">tagFile</a><span class="delimiter">)</span>
      <a href="#20804" title="(remoteFile: java.io.File)String">catFile</a><span class="delimiter">(</span><a href="#20766" title="=&gt; java.io.File">tagFile</a><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)Array[java.lang.String]">split</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>.<span title="(p: java.lang.String =&gt; Boolean)Array[java.lang.String]">filterNot</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.WrappedArray[java.lang.String]" class="delimiter">(</span><a href="#22785" title="java.lang.String">_</a> <span title="(x$1: Any)Boolean">equals</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(tags: Set[String])Unit" id="21141">setTags</a><span class="delimiter">(</span><a title="Set[String]" id="22796">tags</a>: <span title="Set[String]">Set</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
      <a href="#20799" title="(file: java.io.File, contents: String, mode: String)Unit">createFile</a><span class="delimiter">(</span><a href="#20766" title="=&gt; java.io.File">tagFile</a>, <a href="#22796" title="Set[String]">tags</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="=&gt; Seq[String]" id="21142">underlying</a> = <a href="#21140" title="=&gt; Seq[String]">getTags</a>

    <span class="keyword">def</span> <a title="(tag: String)Unit" id="21143">+=</a><span class="delimiter">(</span><a title="String" id="23160">tag</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
      <a href="#21141" title="(tags: Set[String])Unit">setTags</a><span class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">(</span><a href="#21140" title="=&gt; Seq[String]">getTags</a> <span title="(elem: String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],String,Seq[String]])Seq[String]">:+</span> <a href="#23160" title="String">tag</a><span class="delimiter">)</span>.<span title="scala.collection.immutable.Set[String]">toSet</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(tag: String)Unit" id="21144">-=</a><span class="delimiter">(</span><a title="String" id="25166">tag</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
      <a href="#21141" title="(tags: Set[String])Unit">setTags</a><span class="delimiter">(</span><a href="#21140" title="=&gt; Seq[String]">getTags</a>.<span title="(p: String =&gt; Boolean)Seq[String]">filterNot</span><span class="delimiter">(</span><a href="#25173" title="String">_</a> <span title="(x$1: Any)Boolean">equals</span> <a href="#25166" title="String">tag</a><span class="delimiter">)</span>.<span title="scala.collection.immutable.Set[String]">toSet</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait Sudo extends deploylib.RemoteMachine with ScalaObject" id="9607">Sudo</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#9611" title="deploylib.RemoteMachine">RemoteMachine</a> <span class="delimiter">{</span>
  <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">def</span> <a title="(cmd: String)String" id="25192">prepareCommand</a><span class="delimiter">(</span><a title="String" id="25195">cmd</a>: <span title="String">String</span><span class="delimiter">)</span> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;sudo bash -c '%s'&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#25195" title="String">cmd</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait ServiceManager extends deploylib.RemoteMachine with ScalaObject" id="9608">ServiceManager</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#9611" title="deploylib.RemoteMachine">RemoteMachine</a> <span class="delimiter">{</span>
  self =&gt;

  <span class="keyword">val</span> <a title="java.io.File" id="25208">serviceDir</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><span title="java.lang.String(&quot;$HOME/deploylib/services&quot;)" class="string">&quot;$HOME/deploylib/services&quot;</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="java.io.File" id="25210">logDir</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><span title="java.lang.String(&quot;$HOME/deploylib/logs&quot;)" class="string">&quot;$HOME/deploylib/logs&quot;</span><span class="delimiter">)</span>

  case <span class="keyword">class</span> <a title="class RemoteService extends java.lang.Object with ScalaObject with Product with Serializable" id="25301">RemoteService</a><a href="#25301" title="ScalaObject" class="delimiter">(</a><a title="String" id="25337">name</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.io.File" id="25230">runScript</a> = <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> java.io.<span title="java.io.File">File</span><span class="delimiter">(</span><a href="#25208" title="=&gt; java.io.File">serviceDir</a>, <a href="#25337" title="=&gt; String">name</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.sh&quot;)" class="string">&quot;.sh&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.io.File" id="25232">pidFile</a> = <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> java.io.<span title="java.io.File">File</span><span class="delimiter">(</span><a href="#25208" title="=&gt; java.io.File">serviceDir</a>, <a href="#25337" title="=&gt; String">name</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.pid&quot;)" class="string">&quot;.pid&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.io.File" id="25234">logFile</a> = <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> java.io.<span title="java.io.File">File</span><span class="delimiter">(</span><a href="#25210" title="=&gt; java.io.File">logDir</a>, <a href="#25337" title="=&gt; String">name</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.log&quot;)" class="string">&quot;.log&quot;</span><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(cmd: String)RemoteService.this.type" id="25236">setCmd</a><span class="delimiter">(</span><a title="String" id="25269">cmd</a>: <span title="String">String</span><span class="delimiter">)</span>: <span class="keyword">this</span>.<span class="keyword">type</span> = <span class="delimiter">{</span>
      <a href="#20806" title="(remoteDir: java.io.File)Unit">mkdir</a><span class="delimiter">(</span><a href="#25208" title="=&gt; java.io.File">serviceDir</a><span class="delimiter">)</span>
      <a href="#20806" title="(remoteDir: java.io.File)Unit">mkdir</a><span class="delimiter">(</span><a href="#25210" title="=&gt; java.io.File">logDir</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.lang.String" id="25271">serviceScript</a> = <span title="java.lang.String(&quot;#!/bin/bash\012&quot;)" class="string">&quot;#!/bin/bash\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#25269" title="String">cmd</a>
      <a href="#20799" title="(file: java.io.File, contents: String, mode: String)Unit">createFile</a><span class="delimiter">(</span><a href="#25230" title="=&gt; java.io.File">runScript</a>, <a href="#25271" title="java.lang.String">serviceScript</a><span class="delimiter">)</span>
      <a href="#9608" title="ServiceManager.this.type">self</a> <a href="#20796" title="(cmd: String)Unit">!</a> <span class="delimiter">(</span><span title="java.lang.String(&quot;chmod 755 &quot;)" class="string">&quot;chmod 755 &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#25230" title="=&gt; java.io.File">runScript</a><span class="delimiter">)</span>
      <a href="#25301" title="RemoteService.this.type" class="keyword">this</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; Unit" id="25237">start</a> = <a href="#9608" title="ServiceManager.this.type">self</a> <a href="#20796" title="(cmd: String)Unit">!</a> <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;start-stop-daemon --make-pidfile --start --background --pidfile %s --exec %s &gt;&gt; %s 2&gt;&amp;1&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#25232" title="=&gt; java.io.File">pidFile</a>, <a href="#25230" title="=&gt; java.io.File">runScript</a>, <a href="#25234" title="=&gt; java.io.File">logFile</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="=&gt; deploylib.ExecuteResponse" id="25238">stop</a> = <a href="#9608" title="ServiceManager.this.type">self</a>.<a href="#20798" title="(cmd: String, timeout: Long)deploylib.ExecuteResponse">executeCommand</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;start-stop-daemon --stop --pidfile %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#25232" title="=&gt; java.io.File">pidFile</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="=&gt; Unit" id="25239">restart</a> = <span class="delimiter">{</span>
      <a href="#25238" title="=&gt; deploylib.ExecuteResponse">stop</a>; <a href="#25237" title="=&gt; Unit">start</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(name: String, cmd: String)ServiceManager.this.RemoteService" id="25215">getService</a><span class="delimiter">(</span><a title="String" id="25333">name</a>: <span title="String">String</span>, <a title="String" id="25334">cmd</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#25301" title="(name: String)ServiceManager.this.RemoteService">RemoteService</a><span class="delimiter">(</span><a href="#25333" title="String">name</a><span class="delimiter">)</span>.<a href="#25236" title="(cmd: java.lang.String)ServiceManager.this.RemoteService">setCmd</a><span class="delimiter">(</span><a href="#25334" title="String">cmd</a><span class="delimiter">)</span>
<span class="delimiter">}</span>


<span class="keyword">object</span> <a title="object deploylib.RemoteMachine" id="9609">RemoteMachine</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="=&gt; java.io.File" id="21328">findPrivateKey</a>: <span title="java.io.File">File</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; java.io.File" id="25350">defaultKeyFiles</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.lang.String" id="25351">specifiedKey</a> = <span title="object java.lang.System">System</span>.<span title="(x$1: java.lang.String)java.lang.String">getenv</span><span class="delimiter">(</span><span title="java.lang.String(&quot;DEPLOYLIB_SSHKEY&quot;)" class="string">&quot;DEPLOYLIB_SSHKEY&quot;</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.io.File" id="25352">rsa</a> = <span title="(x$1: java.lang.String, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><span title="object java.lang.System">System</span>.<span title="(x$1: java.lang.String)java.lang.String">getProperty</span><span class="delimiter">(</span><span title="java.lang.String(&quot;user.home&quot;)" class="string">&quot;user.home&quot;</span><span class="delimiter">)</span>, <span title="java.lang.String(&quot;.ssh/id_rsa&quot;)" class="string">&quot;.ssh/id_rsa&quot;</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.io.File" id="25353">dsa</a> = <span title="(x$1: java.lang.String, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><span title="object java.lang.System">System</span>.<span title="(x$1: java.lang.String)java.lang.String">getProperty</span><span class="delimiter">(</span><span title="java.lang.String(&quot;user.home&quot;)" class="string">&quot;user.home&quot;</span><span class="delimiter">)</span>, <span title="java.lang.String(&quot;.ssh/id_dsa&quot;)" class="string">&quot;.ssh/id_dsa&quot;</span><span class="delimiter">)</span>

      <span title="java.io.File" class="keyword">if</span> <span class="delimiter">(</span><a href="#25351" title="java.lang.String">specifiedKey</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#25351" title="java.lang.String">specifiedKey</a><span class="delimiter">)</span>
      <span class="keyword">else</span> <span title="java.io.File" class="keyword">if</span> <span class="delimiter">(</span><a href="#25352" title="java.io.File">rsa</a>.<span title="()Boolean">exists</span><span class="delimiter">)</span> <a href="#25352" title="java.io.File">rsa</a>
      <span class="keyword">else</span> <span title="java.io.File" class="keyword">if</span> <span class="delimiter">(</span><a href="#25353" title="java.io.File">dsa</a>.<span title="()Boolean">exists</span><span class="delimiter">)</span> <a href="#25353" title="java.io.File">dsa</a>
      <span class="keyword">else</span> <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;No private key found&quot;)" class="string">&quot;No private key found&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="package.scala.html#9886" title="object deploylib.package.Config">Config</a>.<span title="(key: String)Option[String]">getString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;deploylib.private_key&quot;)" class="string">&quot;deploylib.private_key&quot;</span><span class="delimiter">)</span> <span title="java.io.File" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="java.io.File">Some</span><span class="delimiter">(</span><a title="String" id="26283">pk</a><span class="delimiter">)</span> =&gt;
        <span class="keyword">val</span> <a title="java.io.File" id="26284">f</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#26283" title="String">pk</a><span class="delimiter">)</span>
        <span title="java.io.File" class="keyword">if</span> <span class="delimiter">(</span><a href="#26284" title="java.io.File">f</a>.<span title="()Boolean">exists</span><span class="delimiter">)</span> <a href="#26284" title="java.io.File">f</a>
        <span class="keyword">else</span> <a href="#25350" title="=&gt; java.io.File">defaultKeyFiles</a>
      <span class="keyword">case</span> <span title="java.io.File">None</span> =&gt; <a href="#25350" title="=&gt; java.io.File">defaultKeyFiles</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; java.io.File" id="21329">findPublicKey</a>: <span title="java.io.File">File</span> =
    <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#21328" title="=&gt; java.io.File">findPrivateKey</a>.<span title="()java.lang.String">getCanonicalPath</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.pub&quot;)" class="string">&quot;.pub&quot;</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Provides a framework for interacting (running commands, uploading/downloading files, etc) with a generic remote machine.
 */</span>
<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class RemoteMachine extends java.lang.Object with ScalaObject" id="9611">RemoteMachine</a> <a href="#9611" title="ScalaObject" class="delimiter">{</a>
  self =&gt;

  <span class="keyword">import</span> <a href="#9609" title="object deploylib.RemoteMachine">RemoteMachine</a>._

  <span class="comment">/**
   * The hostname that the ssh connection is established with
   */</span>
  <span class="keyword">val</span> <a title="=&gt; String" id="20774">hostname</a>: <span title="String">String</span>

  <span class="comment">/**
   * The username used to authenticate with the remote ssh server
   */</span>
  <span class="keyword">val</span> <a title="=&gt; String" id="20775">username</a>: <span title="String">String</span>

  <span class="comment">/**
   * The private key used to authenticate with the remote ssh server
   */</span>
  <span class="keyword">val</span> <a title="java.io.File" id="20776">privateKey</a>: <span title="java.io.File">File</span> = <a href="#21328" title="=&gt; java.io.File">findPrivateKey</a>

  <span class="comment">/**
   * The default root directory for operations (The user should have read write permissions to this directory)
   */</span>
  <span class="keyword">val</span> <a title="=&gt; java.io.File" id="20778">rootDirectory</a>: <span title="java.io.File">File</span>

  <span class="comment">/**
   * The location of the java command on the remote machine
   */</span>
  <span class="keyword">val</span> <a title="=&gt; java.io.File" id="20779">javaCmd</a>: <span title="java.io.File">File</span>

  <span class="comment">/**
   * The services that are assigned to be deployed to this remote machine.
   */</span>
  <span class="keyword">protected</span> <span class="keyword">var</span> <a title="Set[deploylib.Service]" id="20781">assignedServices</a>: <span title="Set[deploylib.Service]">Set</span><span class="delimiter">[</span>Service<span class="delimiter">]</span> = <span title="(elems: deploylib.Service*)scala.collection.immutable.Set[deploylib.Service]">Set</span><span class="delimiter">(</span><span class="delimiter">)</span>

  @deprecated<span class="delimiter">(</span><span class="string">&quot;use getService&quot;</span>, <span class="string">&quot;v2.1.2&quot;</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(service: deploylib.Service)Unit" id="20783">addService</a><span class="delimiter">(</span><a title="deploylib.Service" id="26779">service</a>: <a href="Service.scala.html#9493" title="deploylib.Service">Service</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#20781" title="(x$1: Set[deploylib.Service])Unit">assignedServices</a> <span title="(elem: deploylib.Service)scala.collection.immutable.Set[deploylib.Service]">+=</span> <a href="#26779" title="deploylib.Service">service</a>
  <span class="delimiter">}</span>

  <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="20784">logger</a> = <span title="()net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="ch.ethz.ssh2.Connection" id="20787">connection</a>: <span title="ch.ethz.ssh2.Connection">Connection</span> = <span title="Null(null)" class="keyword">null</span>

  <span class="keyword">protected</span> <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="[A](a: A)Option[A]" id="20789">toOption</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="20791">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A" id="26431">a</a>: <a href="#20791" title="A">A</a><span class="delimiter">)</span> = <span title="(x: A)Option[A]">Option</span><span class="delimiter">(</span><a href="#26431" title="A">a</a><span class="delimiter">)</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(cmd: String)String" id="20792">prepareCommand</a><span class="delimiter">(</span><a title="String" id="25197">cmd</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#25197" title="String">cmd</a>

  <span class="comment">/**
   * Provide an ssh connection to the server.  If one is not already available or has been disconnected, create one.
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="[ReturnType](func: ch.ethz.ssh2.Connection =&gt; ReturnType, numTries: Int)ReturnType" id="20793">useConnection</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="27195">ReturnType</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="ch.ethz.ssh2.Connection =&gt; ReturnType" id="27190">func</a>: <span class="delimiter">(</span>Connection<span class="delimiter">)</span> =&gt; ReturnType, <a title="Int" id="27193">numTries</a>: <span title="Int">Int</span> = <span title="Int(5)" class="int">5</span><span class="delimiter">)</span>: <a href="#27195" title="ReturnType">ReturnType</a> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(e: Exception)ReturnType" id="27198">onFailure</a><span class="delimiter">(</span><a title="Exception" id="27199">e</a>: <span title="Exception">Exception</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="#20787" title="(x$1: ch.ethz.ssh2.Connection)Unit">connection</a> = <span title="Null(null)" class="keyword">null</span>
      <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Connection to &quot;)" class="string">&quot;Connection to &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#20774" title="=&gt; String">hostname</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; failed: %s&quot;)" class="string">&quot; failed: %s&quot;</span>, <a href="#27199" title="Exception">e</a><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#27193" title="Int">numTries</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Number of tries exceeded&quot;)" class="string">&quot;Number of tries exceeded&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#27199" title="Exception">e</a><span class="delimiter">)</span>
      <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><span class="int">30</span> <span title="Long(30000L)">*</span> <span class="int">1000</span><span class="delimiter">)</span>
      <a href="#20793" title="(func: ch.ethz.ssh2.Connection =&gt; ReturnType, numTries: Int)ReturnType">useConnection</a><span class="delimiter">(</span><a href="#27190" title="ch.ethz.ssh2.Connection =&gt; ReturnType">func</a>, <a href="#27193" title="Int">numTries</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><a href="#20787" title="=&gt; ch.ethz.ssh2.Connection">connection</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#9611" title="(x$1: AnyVal)AnyVal">synchronized</a> <span class="delimiter">{</span>
        <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><a href="#20787" title="=&gt; ch.ethz.ssh2.Connection">connection</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#20787" title="(x$1: ch.ethz.ssh2.Connection)Unit">connection</a> = <span title="ch.ethz.ssh2.Connection" class="keyword">new</span> <span title="ch.ethz.ssh2.Connection">Connection</span><span class="delimiter">(</span><a href="#20774" title="=&gt; String">hostname</a><span class="delimiter">)</span>
          <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Connecting to &quot;)" class="string">&quot;Connecting to &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#20774" title="=&gt; String">hostname</a><span class="delimiter">)</span>
          <a href="#20787" title="=&gt; ch.ethz.ssh2.Connection">connection</a>.<span title="()ch.ethz.ssh2.ConnectionInfo">connect</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Authenticating with username &quot;)" class="string">&quot;Authenticating with username &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#20775" title="=&gt; String">username</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; privateKey &quot;)" class="string">&quot; privateKey &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#20776" title="=&gt; java.io.File">privateKey</a><span class="delimiter">)</span>
          <a href="#20787" title="=&gt; ch.ethz.ssh2.Connection">connection</a>.<span title="(x$1: java.lang.String, x$2: java.io.File, x$3: java.lang.String)Boolean">authenticateWithPublicKey</span><span class="delimiter">(</span><a href="#20775" title="=&gt; String">username</a>, <a href="#20776" title="=&gt; java.io.File">privateKey</a>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <a href="#27190" title="(v1: ch.ethz.ssh2.Connection)ReturnType">func</a><span class="delimiter">(</span><a href="#20787" title="=&gt; ch.ethz.ssh2.Connection">connection</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="ReturnType" id="27796">e</a>: java.io.<span title="java.io.IOException">IOException</span> =&gt; <a href="#27198" title="(e: Exception)ReturnType">onFailure</a><span class="delimiter">(</span><a href="#27796" title="java.io.IOException">e</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="ReturnType" id="27806">e</a>: java.net.<span title="java.net.SocketException">SocketException</span> =&gt; <a href="#27198" title="(e: Exception)ReturnType">onFailure</a><span class="delimiter">(</span><a href="#27806" title="java.net.SocketException">e</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="ReturnType" id="27810">e</a>: java.lang.<span title="java.lang.IllegalStateException">IllegalStateException</span> =&gt; <a href="#27198" title="(e: Exception)ReturnType">onFailure</a><span class="delimiter">(</span><a href="#27810" title="java.lang.IllegalStateException">e</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Executes a command and throw an error if it doesn't return 0
   */</span>
  <span class="keyword">def</span> <a title="(cmd: String)Unit" id="20796">!</a><span class="delimiter">(</span><a title="String" id="21322">cmd</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#20798" title="(cmd: String, timeout: Long)deploylib.ExecuteResponse">executeCommand</a><span class="delimiter">(</span><a href="#21322" title="String">cmd</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="Unit">ExecuteResponse</span><span class="delimiter">(</span>Some<span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <a title="String" id="21335">stdout</a>, <a title="String" id="21336">stderr</a><span class="delimiter">)</span> =&gt; <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;===stdout %s: %s===\012%s===stderr %s:%s===%s\012&quot;)" class="string">&quot;===stdout %s: %s===\n%s===stderr %s:%s===%s\n&quot;</span>, <a href="#20774" title="=&gt; String">hostname</a>, <a href="#21322" title="String">cmd</a>, <a href="#21335" title="String">stdout</a>, <a href="#20774" title="=&gt; String">hostname</a>, <a href="#21322" title="String">cmd</a>, <a href="#21336" title="String">stderr</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="Nothing">ExecuteResponse</span><span class="delimiter">(</span>_, <a title="String" id="21642">stdout</a>, <a title="String" id="21643">stderr</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;===stdout %s: %s===\012%s===stderr %s:%s===%s\012&quot;)" class="string">&quot;===stdout %s: %s===\n%s===stderr %s:%s===%s\n&quot;</span>, <a href="#20774" title="=&gt; String">hostname</a>, <a href="#21322" title="String">cmd</a>, <a href="#21642" title="String">stdout</a>, <a href="#20774" title="=&gt; String">hostname</a>, <a href="#21322" title="String">cmd</a>, <a href="#21643" title="String">stderr</a><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Cmd: &quot;)" class="string">&quot;Cmd: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#21322" title="String">cmd</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; failed&quot;)" class="string">&quot; failed&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Execute a command on the remote machine and return stdout as a string.  Throws an exception if the command doesn't exit with status code 0.
   */</span>
  <span class="keyword">def</span> <a title="(cmd: String)String" id="20797">!?</a><span class="delimiter">(</span><a title="String" id="27820">cmd</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#20798" title="(cmd: String, timeout: Long)deploylib.ExecuteResponse">executeCommand</a><span class="delimiter">(</span><a href="#27820" title="String">cmd</a><span class="delimiter">)</span> <span title="String" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="String">ExecuteResponse</span><span class="delimiter">(</span>Some<span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <a title="String" id="27824">stdout</a>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> =&gt; <a href="#27824" title="String">stdout</a>
    <span class="keyword">case</span> <a title="Nothing" id="27825">err</a> =&gt; <span title="Nothing" class="keyword">throw</span> <span title="deploylib.UnknownResponse" class="keyword">new</span> <a href="#35250" title="deploylib.UnknownResponse">UnknownResponse</a><span class="delimiter">(</span><a href="#27825" title="deploylib.ExecuteResponse">err</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Execute a command sync with a maximum timeout to wait for result
   * and return the result as an ExecuteResponse
   */</span>
  <span class="keyword">def</span> <a title="(cmd: String, timeout: Long)deploylib.ExecuteResponse" id="20798">executeCommand</a><span class="delimiter">(</span><a title="String" id="21325">cmd</a>: <span title="String">String</span>, <a title="Long" id="21331">timeout</a>: <span title="Long">Long</span> = <span title="Long(0L)" class="int">0</span><span class="delimiter">)</span>: <a href="#35254" title="deploylib.ExecuteResponse">ExecuteResponse</a> = <span class="delimiter">{</span>
    <a href="#20793" title="(func: ch.ethz.ssh2.Connection =&gt; deploylib.ExecuteResponse, numTries: Int)deploylib.ExecuteResponse">useConnection</a><span class="delimiter">(</span><span class="delimiter">(</span><a title="ch.ethz.ssh2.Connection" id="27832">c</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="StringBuilder" id="27833">stdout</a> = <span title="()StringBuilder" class="keyword">new</span> <span title="StringBuilder">StringBuilder</span>
      <span class="keyword">val</span> <a title="StringBuilder" id="27834">stderr</a> = <span title="()StringBuilder" class="keyword">new</span> <span title="StringBuilder">StringBuilder</span>

      <span class="keyword">val</span> <a title="ch.ethz.ssh2.Session" id="27835">session</a> = <a href="#20787" title="=&gt; ch.ethz.ssh2.Connection">connection</a>.<span title="()ch.ethz.ssh2.Session">openSession</span>
      <span class="keyword">val</span> <a title="java.io.BufferedReader" id="27836">outReader</a> = <span title="(x$1: java.io.Reader)java.io.BufferedReader" class="keyword">new</span> <span title="java.io.BufferedReader">BufferedReader</span><span class="delimiter">(</span><span title="java.io.InputStreamReader" class="keyword">new</span> <span title="java.io.InputStreamReader">InputStreamReader</span><span class="delimiter">(</span><a href="#27835" title="ch.ethz.ssh2.Session">session</a>.<span title="()java.io.InputStream">getStdout</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.io.BufferedReader" id="27837">errReader</a> = <span title="(x$1: java.io.Reader)java.io.BufferedReader" class="keyword">new</span> <span title="java.io.BufferedReader">BufferedReader</span><span class="delimiter">(</span><span title="java.io.InputStreamReader" class="keyword">new</span> <span title="java.io.InputStreamReader">InputStreamReader</span><span class="delimiter">(</span><a href="#27835" title="ch.ethz.ssh2.Session">session</a>.<span title="()java.io.InputStream">getStderr</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Executing: &quot;)" class="string">&quot;Executing: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#21325" title="String">cmd</a><span class="delimiter">)</span>
      <a href="#27835" title="ch.ethz.ssh2.Session">session</a>.<span title="(x$1: java.lang.String)Unit">execCommand</span><span class="delimiter">(</span><a href="#20792" title="(cmd: String)String">prepareCommand</a><span class="delimiter">(</span><a href="#21325" title="String">cmd</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">var</span> <a title="Boolean" id="27838">continue</a> = <span title="Boolean(true)" class="keyword">true</span>
      <span class="keyword">var</span> <a title="java.lang.Integer" id="27839">exitStatus</a>: java.lang.<span title="java.lang.Integer">Integer</span> = <span title="Null(null)" class="keyword">null</span>
      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#27838" title="Boolean">continue</a><span class="delimiter">)</span> <a href="#27840" title="()Unit" class="delimiter">{</a>
        <span class="keyword">val</span> <a title="Int" id="28688">status</a> = <a href="#27835" title="ch.ethz.ssh2.Session">session</a>.<span title="(x$1: Int, x$2: Long)Int">waitForCondition</span><span class="delimiter">(</span>ChannelCondition.STDOUT_DATA |
          ChannelCondition.STDERR_DATA |
          ChannelCondition.EXIT_STATUS |
          ChannelCondition.EXIT_SIGNAL |
          ChannelCondition.EOF |
          ChannelCondition.CLOSED <span title="Int(127)">|</span>
          ChannelCondition.TIMEOUT, <a href="#21331" title="Long">timeout</a><span class="delimiter">)</span>

        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#28688" title="Int">status</a> <span title="(x: Int)Int">&amp;</span> ChannelCondition.<span title="Int(4)">STDOUT_DATA</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#27836" title="java.io.BufferedReader">outReader</a>.<span title="()Boolean">ready</span><span class="delimiter">)</span> <a href="#28729" title="()Unit" class="delimiter">{</a>
            <span class="keyword">val</span> <a title="java.lang.String" id="28730">line</a> = <a href="#27836" title="java.io.BufferedReader">outReader</a>.<span title="()java.lang.String">readLine</span><span class="delimiter">(</span><span class="delimiter">)</span>
            <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#28730" title="java.lang.String">line</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Received STDOUT_DATA: &quot;)" class="string">&quot;Received STDOUT_DATA: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#28730" title="java.lang.String">line</a><span class="delimiter">)</span>
              <a href="#27833" title="StringBuilder">stdout</a>.<span title="(s: String)StringBuilder">append</span><span class="delimiter">(</span><a href="#28730" title="java.lang.String">line</a><span class="delimiter">)</span>
              <a href="#27833" title="StringBuilder">stdout</a>.<span title="(s: String)StringBuilder">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#28688" title="Int">status</a> <span title="(x: Int)Int">&amp;</span> ChannelCondition.<span title="Int(8)">STDERR_DATA</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#27837" title="java.io.BufferedReader">errReader</a>.<span title="()Boolean">ready</span><span class="delimiter">)</span> <a href="#28851" title="()Unit" class="delimiter">{</a>
            <span class="keyword">val</span> <a title="java.lang.String" id="28852">line</a> = <a href="#27837" title="java.io.BufferedReader">errReader</a>.<span title="()java.lang.String">readLine</span><span class="delimiter">(</span><span class="delimiter">)</span>
            <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#28852" title="java.lang.String">line</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Received STDERR_DATA: &quot;)" class="string">&quot;Received STDERR_DATA: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#28852" title="java.lang.String">line</a><span class="delimiter">)</span>
              <a href="#27834" title="StringBuilder">stderr</a>.<span title="(s: String)StringBuilder">append</span><span class="delimiter">(</span><a href="#28852" title="java.lang.String">line</a><span class="delimiter">)</span>
              <a href="#27834" title="StringBuilder">stderr</a>.<span title="(s: String)StringBuilder">append</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#28688" title="Int">status</a> <span title="(x: Int)Int">&amp;</span> ChannelCondition.<span title="Int(32)">EXIT_STATUS</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Received EXIT_STATUS&quot;)" class="string">&quot;Received EXIT_STATUS&quot;</span><span class="delimiter">)</span>
          <a href="#27839" title="java.lang.Integer">exitStatus</a> = <a href="#27835" title="ch.ethz.ssh2.Session">session</a>.<span title="()java.lang.Integer">getExitStatus</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#28688" title="Int">status</a> <span title="(x: Int)Int">&amp;</span> ChannelCondition.<span title="Int(64)">EXIT_SIGNAL</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Received EXIT_SIGNAL: &quot;)" class="string">&quot;Received EXIT_SIGNAL: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#27835" title="ch.ethz.ssh2.Session">session</a>.<span title="()java.lang.String">getExitSignal</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#28688" title="Int">status</a> <span title="(x: Int)Int">&amp;</span> ChannelCondition.<span title="Int(16)">EOF</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Received EOF&quot;)" class="string">&quot;Received EOF&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#28688" title="Int">status</a> <span title="(x: Int)Int">&amp;</span> ChannelCondition.<span title="Int(2)">CLOSED</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Received CLOSED&quot;)" class="string">&quot;Received CLOSED&quot;</span><span class="delimiter">)</span>
          <a href="#27838" title="Boolean">continue</a> = <span title="Boolean(false)" class="keyword">false</span>
        <span class="delimiter">}</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#28688" title="Int">status</a> <span title="(x: Int)Int">&amp;</span> ChannelCondition.<span title="Int(1)">TIMEOUT</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Received TIMEOUT&quot;)" class="string">&quot;Received TIMEOUT&quot;</span><span class="delimiter">)</span>
          <a href="#27838" title="Boolean">continue</a> = <span title="Boolean(false)" class="keyword">false</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <a href="#27835" title="ch.ethz.ssh2.Session">session</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#35254" title="(status: Option[Int], stdout: String, stderr: String)deploylib.ExecuteResponse">ExecuteResponse</a><span class="delimiter">(</span><span title="(x: Int)Some[Int]">Some</span><span class="delimiter">(</span><a href="#27839" title="java.lang.Integer">exitStatus</a>.<span title="()Int">intValue</span><span class="delimiter">)</span>, <a href="#27833" title="StringBuilder">stdout</a>.<span title="()java.lang.String">toString</span>, <a href="#27834" title="StringBuilder">stderr</a>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Create a file on the remote machine with the given contents
   * @param file - The desired path of the file. If the given path is relative, the file will be created in the rootDirectory
   * @param contents - A string with the desired contents of the file
   */</span>
  <span class="keyword">def</span> <a title="(file: java.io.File, contents: String, mode: String)Unit" id="20799">createFile</a><span class="delimiter">(</span><a title="java.io.File" id="22917">file</a>: <span title="java.io.File">File</span>, <a title="String" id="22918">contents</a>: <span title="String">String</span>, <a title="String" id="22921">mode</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;644&quot;)" class="string">&quot;644&quot;</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#20793" title="(func: ch.ethz.ssh2.Connection =&gt; Unit, numTries: Int)Unit">useConnection</a><span class="delimiter">(</span><span class="delimiter">(</span><a title="ch.ethz.ssh2.Connection" id="28952">c</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Creating file %s: %s %s&quot;)" class="string">&quot;Creating file %s: %s %s&quot;</span>, <a href="#22917" title="java.io.File">file</a>, <a href="#22918" title="String">contents</a>, <a href="#20792" title="(cmd: String)String">prepareCommand</a><span class="delimiter">(</span><span title="java.lang.String(&quot;cat &gt; &quot;)" class="string">&quot;cat &gt; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#22917" title="java.io.File">file</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ch.ethz.ssh2.Session" id="28953">session</a> = <a href="#20787" title="=&gt; ch.ethz.ssh2.Connection">connection</a>.<span title="()ch.ethz.ssh2.Session">openSession</span>
      <a href="#28953" title="ch.ethz.ssh2.Session">session</a>.<span title="(x$1: java.lang.String)Unit">execCommand</span><span class="delimiter">(</span><a href="#20792" title="(cmd: String)String">prepareCommand</a><span class="delimiter">(</span><span title="java.lang.String(&quot;cat &gt; &quot;)" class="string">&quot;cat &gt; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#22917" title="java.io.File">file</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#28953" title="ch.ethz.ssh2.Session">session</a>.<span title="()java.io.OutputStream">getStdin</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: Array[Byte])Unit">write</span><span class="delimiter">(</span><a href="#22918" title="String">contents</a>.<span title="()Array[Byte]">getBytes</span><span class="delimiter">)</span>
      <a href="#28953" title="ch.ethz.ssh2.Session">session</a>.<span title="()java.io.OutputStream">getStdin</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#28953" title="ch.ethz.ssh2.Session">session</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
    <a href="#9611" title="RemoteMachine.this.type" class="keyword">this</a> <a href="#20796" title="(cmd: String)Unit">!</a> <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;chmod %s %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#22921" title="String">mode</a>, <a href="#22917" title="java.io.File">file</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Append to file on the remote machine with the given contents
   * @param file - The desired path of the file. If the given path is relative, the file will be created in the rootDirectory
   * @param contents - A string to be appended to the file
   */</span>
  <span class="keyword">def</span> <a title="(file: java.io.File, contents: String)Unit" id="20800">appendFile</a><span class="delimiter">(</span><a title="java.io.File" id="28983">file</a>: <span title="java.io.File">File</span>, <a title="String" id="28984">contents</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#20793" title="(func: ch.ethz.ssh2.Connection =&gt; Unit, numTries: Int)Unit">useConnection</a><span class="delimiter">(</span><span class="delimiter">(</span><a title="ch.ethz.ssh2.Connection" id="28990">c</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="ch.ethz.ssh2.Session" id="28991">session</a> = <a href="#20787" title="=&gt; ch.ethz.ssh2.Connection">connection</a>.<span title="()ch.ethz.ssh2.Session">openSession</span>
      <a href="#28991" title="ch.ethz.ssh2.Session">session</a>.<span title="(x$1: java.lang.String)Unit">execCommand</span><span class="delimiter">(</span><a href="#20792" title="(cmd: String)String">prepareCommand</a><span class="delimiter">(</span><span title="java.lang.String(&quot;cat &gt;&gt; &quot;)" class="string">&quot;cat &gt;&gt; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#28983" title="java.io.File">file</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#28991" title="ch.ethz.ssh2.Session">session</a>.<span title="()java.io.OutputStream">getStdin</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: Array[Byte])Unit">write</span><span class="delimiter">(</span><a href="#28984" title="String">contents</a>.<span title="()Array[Byte]">getBytes</span><span class="delimiter">)</span>
      <a href="#28991" title="ch.ethz.ssh2.Session">session</a>.<span title="()java.io.OutputStream">getStdin</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#28991" title="ch.ethz.ssh2.Session">session</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>


  <span class="comment">/**
   * Upload a file to the remote machine.  Before performing the transfer check the md5hash of the local file and any existing file to ensure we don't waste bandwidth.
   */</span>
  <span class="keyword">def</span> <a title="(localFile: java.io.File, remoteDirectory: java.io.File)Unit" id="20801">upload</a><span class="delimiter">(</span><a title="java.io.File" id="29002">localFile</a>: <span title="java.io.File">File</span>, <a title="java.io.File" id="29003">remoteDirectory</a>: <span title="java.io.File">File</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="Util.scala.html#9503" title="object deploylib.Util">Util</a>.<a href="Util.scala.html#30927" title="(file: java.io.File)String">md5</a><span class="delimiter">(</span><a href="#29002" title="java.io.File">localFile</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#20803" title="(remoteFile: java.io.File)String">md5</a><span class="delimiter">(</span><span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#29003" title="java.io.File">remoteDirectory</a>, <a href="#29002" title="java.io.File">localFile</a>.<span title="()java.lang.String">getName</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Not uploading &quot;)" class="string">&quot;Not uploading &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29002" title="java.io.File">localFile</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; as the hashes match&quot;)" class="string">&quot; as the hashes match&quot;</span><span class="delimiter">)</span>
    <span class="keyword">else</span>
      <a href="#20793" title="(func: ch.ethz.ssh2.Connection =&gt; Unit, numTries: Int)Unit">useConnection</a><span class="delimiter">(</span><span class="delimiter">(</span><a title="ch.ethz.ssh2.Connection" id="29071">c</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="ch.ethz.ssh2.SCPClient" id="29072">scp</a> = <span title="ch.ethz.ssh2.SCPClient" class="keyword">new</span> <span title="ch.ethz.ssh2.SCPClient">SCPClient</span><span class="delimiter">(</span><a href="#20787" title="=&gt; ch.ethz.ssh2.Connection">connection</a><span class="delimiter">)</span>
        <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Hashes don\'t match, uploading &quot;)" class="string">&quot;Hashes don't match, uploading &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29002" title="java.io.File">localFile</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; to &quot;)" class="string">&quot; to &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29003" title="java.io.File">remoteDirectory</a><span class="delimiter">)</span>
        <a href="#29072" title="ch.ethz.ssh2.SCPClient">scp</a>.<span title="(x$1: java.lang.String, x$2: java.lang.String)Unit">put</span><span class="delimiter">(</span><a href="#29002" title="java.io.File">localFile</a>.<span title="()java.lang.String">toString</span>, <a href="#29003" title="java.io.File">remoteDirectory</a>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span>
        <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Upload of &quot;)" class="string">&quot;Upload of &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29002" title="java.io.File">localFile</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; complete&quot;)" class="string">&quot; complete&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Downloads a file from the remote machine.
   */</span>
  <span class="keyword">def</span> <a title="(remoteFile: java.io.File, localDirectory: java.io.File)Unit" id="20802">download</a><span class="delimiter">(</span><a title="java.io.File" id="29132">remoteFile</a>: <span title="java.io.File">File</span>, <a title="java.io.File" id="29133">localDirectory</a>: <span title="java.io.File">File</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="ch.ethz.ssh2.SCPClient" id="29135">scp</a> = <span title="ch.ethz.ssh2.SCPClient" class="keyword">new</span> <span title="ch.ethz.ssh2.SCPClient">SCPClient</span><span class="delimiter">(</span><a href="#20787" title="=&gt; ch.ethz.ssh2.Connection">connection</a><span class="delimiter">)</span>
    <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Downloading &quot;)" class="string">&quot;Downloading &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29132" title="java.io.File">remoteFile</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; to &quot;)" class="string">&quot; to &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29133" title="java.io.File">localDirectory</a><span class="delimiter">)</span>
    <a href="#29135" title="ch.ethz.ssh2.SCPClient">scp</a>.<span title="(x$1: java.lang.String, x$2: java.lang.String)Unit">get</span><span class="delimiter">(</span><a href="#29132" title="java.io.File">remoteFile</a>.<span title="()java.lang.String">toString</span>, <a href="#29133" title="java.io.File">localDirectory</a>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span>
    <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Transfer of &quot;)" class="string">&quot;Transfer of &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29132" title="java.io.File">remoteFile</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; complete&quot;)" class="string">&quot; complete&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * returns an md5 hash of the specified remote file
   */</span>
  <span class="keyword">def</span> <a title="(remoteFile: java.io.File)String" id="20803">md5</a><span class="delimiter">(</span><a title="java.io.File" id="29059">remoteFile</a>: <span title="java.io.File">File</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.lang.String" id="29144">failureResponse</a> = <span title="java.lang.String(&quot;md5sum: &quot;)" class="string">&quot;md5sum: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29059" title="java.io.File">remoteFile</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: No such file or directory&quot;)" class="string">&quot;: No such file or directory&quot;</span>
    <a href="#20798" title="(cmd: String, timeout: Long)deploylib.ExecuteResponse">executeCommand</a><span class="delimiter">(</span><span title="java.lang.String(&quot;md5sum &quot;)" class="string">&quot;md5sum &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29059" title="java.io.File">remoteFile</a><span class="delimiter">)</span> <span title="String" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="java.lang.String">ExecuteResponse</span><span class="delimiter">(</span>Some<span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <a title="String" id="29146">result</a>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="java.lang.String" id="29147">hash</a> = <a href="#29146" title="String">result</a>.<span title="(x$1: java.lang.String)Array[java.lang.String]">split</span><span title="(i: Int)java.lang.String" class="delimiter">(</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
        <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Got hash: &quot;)" class="string">&quot;Got hash: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29147" title="java.lang.String">hash</a><span class="delimiter">)</span>
        <a href="#29147" title="java.lang.String">hash</a>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="java.lang.String">ExecuteResponse</span><span class="delimiter">(</span>Some<span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <a title="String" id="29153">failureResponse</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Hash command returned with an error&quot;)" class="string">&quot;Hash command returned with an error&quot;</span><span class="delimiter">)</span>
        <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a title="java.lang.String" id="29156">e</a>: <a href="#35254" title="deploylib.ExecuteResponse">ExecuteResponse</a> =&gt; <span class="delimiter">{</span>
        <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Unexpected response while calculating md5: &quot;)" class="string">&quot;Unexpected response while calculating md5: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29156" title="deploylib.ExecuteResponse">e</a><span class="delimiter">)</span>
        <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Return the contents of the remote file as a string.
   */</span>
  <span class="keyword">def</span> <a title="(remoteFile: java.io.File)String" id="20804">catFile</a><span class="delimiter">(</span><a title="java.io.File" id="21652">remoteFile</a>: <span title="java.io.File">File</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <a href="#20798" title="(cmd: String, timeout: Long)deploylib.ExecuteResponse">executeCommand</a><span class="delimiter">(</span><span title="java.lang.String(&quot;cat &quot;)" class="string">&quot;cat &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#21652" title="java.io.File">remoteFile</a><span class="delimiter">)</span> <span title="String" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="String">ExecuteResponse</span><span class="delimiter">(</span>Some<span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <a title="String" id="29160">data</a>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> =&gt; <a href="#29160" title="String">data</a>
      <span class="keyword">case</span> <a title="java.lang.String" id="29161">e</a>: <a href="#35254" title="deploylib.ExecuteResponse">ExecuteResponse</a> =&gt; <span class="delimiter">{</span>
        <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Unexpected response during cat: &quot;)" class="string">&quot;Unexpected response during cat: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29161" title="deploylib.ExecuteResponse">e</a><span class="delimiter">)</span>
        <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * return the last numLines from the specified file
   */</span>
  <span class="keyword">def</span> <a title="(remoteFile: java.io.File, numLines: Int)String" id="20805">tail</a><span class="delimiter">(</span><a title="java.io.File" id="29164">remoteFile</a>: <span title="java.io.File">File</span>, <a title="Int" id="29167">numLines</a>: <span title="Int">Int</span> = <span title="Int(20)" class="int">20</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <a href="#20798" title="(cmd: String, timeout: Long)deploylib.ExecuteResponse">executeCommand</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;tail -n %d &quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#29167" title="Int">numLines</a><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29164" title="java.io.File">remoteFile</a><span class="delimiter">)</span> <span title="String" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="String">ExecuteResponse</span><span class="delimiter">(</span>Some<span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <a title="String" id="29172">logTail</a>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> =&gt; <a href="#29172" title="String">logTail</a>
      <span class="keyword">case</span> <a title="java.lang.String" id="29173">e</a>: <a href="#35254" title="deploylib.ExecuteResponse">ExecuteResponse</a> =&gt; <span class="delimiter">{</span>
        <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Unexpected response while tailing log: &quot;)" class="string">&quot;Unexpected response while tailing log: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29173" title="deploylib.ExecuteResponse">e</a><span class="delimiter">)</span>
        <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * create directories on the remote machine.
   */</span>
  <span class="keyword">def</span> <a title="(remoteDir: java.io.File)Unit" id="20806">mkdir</a><span class="delimiter">(</span><a title="java.io.File" id="25272">remoteDir</a>: <span title="java.io.File">File</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#20798" title="(cmd: String, timeout: Long)deploylib.ExecuteResponse">executeCommand</a><span class="delimiter">(</span><span title="java.lang.String(&quot;mkdir -p &quot;)" class="string">&quot;mkdir -p &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#25272" title="java.io.File">remoteDir</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">ExecuteResponse</span><span class="delimiter">(</span>Some<span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, _, _<span class="delimiter">)</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
      <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Unexpected response while making directory &quot;)" class="string">&quot;Unexpected response while making directory &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#25272" title="java.io.File">remoteDir</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * run tail -F on the specifed file in a seperate thread.  all ouput is printed on local stdout.
   */</span>
  <span class="keyword">def</span> <a title="(remoteFile: java.io.File)Unit" id="20807">watch</a><span class="delimiter">(</span><a title="java.io.File" id="29179">remoteFile</a>: <span title="java.io.File">File</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#20793" title="(func: ch.ethz.ssh2.Connection =&gt; Unit, numTries: Int)Unit">useConnection</a><span class="delimiter">(</span><span class="delimiter">(</span><a title="ch.ethz.ssh2.Connection" id="29185">c</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="ch.ethz.ssh2.Session" id="29186">session</a> = <a href="#20787" title="=&gt; ch.ethz.ssh2.Connection">connection</a>.<span title="()ch.ethz.ssh2.Session">openSession</span>
      <span class="keyword">val</span> <a title="java.io.BufferedReader" id="29187">outReader</a> = <span title="(x$1: java.io.Reader)java.io.BufferedReader" class="keyword">new</span> <span title="java.io.BufferedReader">BufferedReader</span><span class="delimiter">(</span><span title="java.io.InputStreamReader" class="keyword">new</span> <span title="java.io.InputStreamReader">InputStreamReader</span><span class="delimiter">(</span><a href="#29186" title="ch.ethz.ssh2.Session">session</a>.<span title="()java.io.InputStream">getStdout</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="#29186" title="ch.ethz.ssh2.Session">session</a>.<span title="(x$1: java.lang.String)Unit">execCommand</span><span class="delimiter">(</span><a href="#20792" title="(cmd: String)String">prepareCommand</a><span class="delimiter">(</span><span title="java.lang.String(&quot;tail -F &quot;)" class="string">&quot;tail -F &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29179" title="java.io.File">remoteFile</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="java.lang.Thread" id="29188">thread</a> = <a href="#29193" title="java.lang.Thread" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Thread" id="29193">Thread</a><span class="delimiter">(</span><span title="java.lang.String(&quot;FileWatcher-&quot;)" class="string">&quot;FileWatcher-&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#20774" title="=&gt; String">hostname</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="29195">run</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
          <span class="keyword">var</span> <a title="java.lang.String" id="29199">line</a> = <a href="#29187" title="java.io.BufferedReader">outReader</a>.<span title="()java.lang.String">readLine</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#29199" title="java.lang.String">line</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#29200" title="()Unit" class="delimiter">{</a>
            <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#20774" title="=&gt; String">hostname</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29199" title="java.lang.String">line</a><span class="delimiter">)</span>
            <a href="#29199" title="java.lang.String">line</a> = <a href="#29187" title="java.io.BufferedReader">outReader</a>.<span title="()java.lang.String">readLine</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <a href="#29186" title="ch.ethz.ssh2.Session">session</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <a href="#29188" title="java.lang.Thread">thread</a>.<span title="(x$1: Boolean)Unit">setDaemon</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
      <a href="#29188" title="java.lang.Thread">thread</a>.<span title="()Unit">start</span>
      <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Watching &quot;)" class="string">&quot;Watching &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29179" title="java.io.File">remoteFile</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; on thread &quot;)" class="string">&quot; on thread &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29188" title="java.lang.Thread">thread</a><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Block until the specified file is created on the remote machine.
   */</span>
  <span class="keyword">def</span> <a title="(file: java.io.File)Unit" id="20808">blockTillFileCreated</a><span class="delimiter">(</span><a title="java.io.File" id="29285">file</a>: <span title="java.io.File">File</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#20793" title="(func: ch.ethz.ssh2.Connection =&gt; Unit, numTries: Int)Unit">useConnection</a><span class="delimiter">(</span><span class="delimiter">(</span><a title="ch.ethz.ssh2.Connection" id="29291">c</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="ch.ethz.ssh2.Session" id="29292">session</a> = <a href="#20787" title="=&gt; ch.ethz.ssh2.Connection">connection</a>.<span title="()ch.ethz.ssh2.Session">openSession</span>
      <a href="#29292" title="ch.ethz.ssh2.Session">session</a>.<span title="(x$1: java.lang.String)Unit">execCommand</span><span class="delimiter">(</span><span title="java.lang.String(&quot;tail -F &quot;)" class="string">&quot;tail -F &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29285" title="java.io.File">file</a><span class="delimiter">)</span>

      <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Blocking till &quot;)" class="string">&quot;Blocking till &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29285" title="java.io.File">file</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;exists&quot;)" class="string">&quot;exists&quot;</span><span class="delimiter">)</span>

      <span class="keyword">var</span> <a title="Int" id="29293">status</a> = <a href="#29292" title="ch.ethz.ssh2.Session">session</a>.<span title="(x$1: Int, x$2: Long)Int">waitForCondition</span><span class="delimiter">(</span>ChannelCondition.STDOUT_DATA |
        ChannelCondition.EXIT_STATUS |
        ChannelCondition.EXIT_SIGNAL |
        ChannelCondition.EOF <span title="Int(118)">|</span>
        ChannelCondition.CLOSED, <span title="Long(10000L)" class="int">10000</span><span class="delimiter">)</span>

      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#29293" title="Int">status</a> <span title="(x: Int)Int">&amp;</span> ChannelCondition.<span title="Int(4)">STDOUT_DATA</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#29312" title="()Unit" class="delimiter">{</a>
        <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Waiting for the creation of &quot;)" class="string">&quot;Waiting for the creation of &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29285" title="java.io.File">file</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; on &quot;)" class="string">&quot; on &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#20774" title="=&gt; String">hostname</a><span class="delimiter">)</span>
        <a href="#29293" title="Int">status</a> = <a href="#29292" title="ch.ethz.ssh2.Session">session</a>.<span title="(x$1: Int, x$2: Long)Int">waitForCondition</span><span class="delimiter">(</span>ChannelCondition.STDOUT_DATA |
          ChannelCondition.EXIT_STATUS |
          ChannelCondition.EXIT_SIGNAL |
          ChannelCondition.EOF <span title="Int(118)">|</span>
          ChannelCondition.CLOSED, <span title="Long(10000L)" class="int">10000</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Block until we can make a connection to the given port, checking every 5 seconds.
   */</span>
  <span class="keyword">def</span> <a title="(port: Int)Unit" id="20809">blockTillPortOpen</a><span class="delimiter">(</span><a title="Int" id="29343">port</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Boolean" id="29345">connected</a> = <span title="Boolean(false)" class="keyword">false</span>

    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#29345" title="Boolean">connected</a><span class="delimiter">)</span> <a href="#29346" title="()Unit" class="delimiter">{</a>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="java.net.Socket" id="29347">s</a> = <span title="(x$1: java.lang.String, x$2: Int)java.net.Socket" class="keyword">new</span> java.net.<span title="java.net.Socket">Socket</span><span class="delimiter">(</span><a href="#20774" title="=&gt; String">hostname</a>, <a href="#29343" title="Int">port</a><span class="delimiter">)</span>
        <a href="#29345" title="Boolean">connected</a> = <span title="Boolean(true)" class="keyword">true</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Unit" id="29642">ce</a>: java.net.<span title="java.net.ConnectException">ConnectException</span> =&gt; <span class="delimiter">{</span>
          <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Connection to &quot;)" class="string">&quot;Connection to &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#20774" title="=&gt; String">hostname</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29343" title="Int">port</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; failed, waiting 5 seconds&quot;)" class="string">&quot; failed, waiting 5 seconds&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><span title="Long(5000L)" class="int">5000</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Use netstat to check if a port is currently bound to a listening socket on the remote machine.
   */</span>
  <span class="keyword">def</span> <a title="(port: Int)Boolean" id="20810">isPortAvailableToListen</a><span class="delimiter">(</span><a title="Int" id="29650">port</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <a href="#20798" title="(cmd: String, timeout: Long)deploylib.ExecuteResponse">executeCommand</a><span class="delimiter">(</span><span title="java.lang.String(&quot;netstat -aln | grep -v unix | grep LISTEN | egrep \'\\b&quot;)" class="string">&quot;netstat -aln | grep -v unix | grep LISTEN | egrep '\\b&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29650" title="Int">port</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\\b\'&quot;)" class="string">&quot;\\b'&quot;</span><span class="delimiter">)</span> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Boolean">ExecuteResponse</span><span class="delimiter">(</span>Some<span class="delimiter">(</span>_<span class="delimiter">)</span>, <a title="String" id="29653">result</a>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#29653" title="String">result</a>.<span title="()java.lang.String">trim</span>.<span title="()Boolean">isEmpty</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a title="Boolean" id="29654">e</a>: <a href="#35254" title="deploylib.ExecuteResponse">ExecuteResponse</a> =&gt; <span class="delimiter">{</span>
        <a href="#20784" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Unexpected response while executing netstat: &quot;)" class="string">&quot;Unexpected response while executing netstat: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29654" title="deploylib.ExecuteResponse">e</a><span class="delimiter">)</span>
        <span title="Boolean(false)" class="keyword">false</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Kill all processes currently tailing a file.
   */</span>
  <span class="keyword">def</span> <a title="()Unit" id="20811">stopWatches</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#20798" title="(cmd: String, timeout: Long)deploylib.ExecuteResponse">executeCommand</a><span title="Unit" class="delimiter">(</span><span title="java.lang.String(&quot;killall tail&quot;)" class="string">&quot;killall tail&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  case <span class="keyword">class</span> <a title="class RemoteFile extends java.lang.Object with ScalaObject with Product with Serializable" id="29725">RemoteFile</a><a href="#29725" title="ScalaObject" class="delimiter">(</a><a title="String" id="31432">name</a>: <span title="String">String</span>, <a title="String" id="31433">owner</a>: <span title="String">String</span>, <a title="String" id="31434">permissions</a>: <span title="String">String</span>, <a title="String" id="31435">modDate</a>: <span title="String">String</span>, <a title="String" id="31436">size</a>: <span title="String">String</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Return a list of RemoteFiles found in dir on the remote machine.
   */</span>
  <span class="keyword">def</span> <a title="(dir: java.io.File)Seq[RemoteMachine.this.RemoteFile]" id="20815">ls</a><span class="delimiter">(</span><a title="java.io.File" id="29921">dir</a>: <span title="java.io.File">File</span><span class="delimiter">)</span>: <span title="Seq[RemoteMachine.this.RemoteFile]">Seq</span><span class="delimiter">[</span>RemoteFile<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#20798" title="(cmd: String, timeout: Long)deploylib.ExecuteResponse">executeCommand</a><span class="delimiter">(</span><span title="java.lang.String(&quot;ls -lh &quot;)" class="string">&quot;ls -lh &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#29921" title="java.io.File">dir</a><span class="delimiter">)</span> <span title="Seq[RemoteMachine.this.RemoteFile]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Seq[RemoteMachine.this.RemoteFile]">ExecuteResponse</span><span class="delimiter">(</span>Some<span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <a title="String" id="29924">data</a>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#29924" title="String">data</a>.<span title="(x$1: java.lang.String)Array[java.lang.String]">split</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>.<span title="(n: Int)Array[java.lang.String]">drop</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="(f: java.lang.String =&gt; RemoteMachine.this.RemoteFile)(implicit bf: scala.collection.generic.CanBuildFrom[Array[java.lang.String],RemoteMachine.this.RemoteFile,Seq[RemoteMachine.this.RemoteFile]])Seq[RemoteMachine.this.RemoteFile]">map</span><span title="(implicit m: DummyImplicit)scala.collection.generic.CanBuildFrom[Array[_],RemoteMachine.this.RemoteFile,scala.collection.mutable.ArraySeq[RemoteMachine.this.RemoteFile]]" class="delimiter">(</span><a title="java.lang.String" id="30502">l</a> =&gt; <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Array[java.lang.String]" id="30503">parts</a> = <a href="#30502" title="java.lang.String">l</a>.<span title="(x$1: java.lang.String)Array[java.lang.String]">split</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span class="delimiter">)</span>.<span title="(f: java.lang.String =&gt; scala.collection.GenTraversableOnce[java.lang.String])(implicit bf: scala.collection.generic.CanBuildFrom[Array[java.lang.String],java.lang.String,Array[java.lang.String]])Array[java.lang.String]">flatMap</span> <a href="#30960" title="Iterable[java.lang.String]" class="delimiter">{</a>
            <span class="keyword">case</span> <span title="scala.collection.immutable.Nil.type" class="string">&quot;&quot;</span> =&gt; <span title="object Nil">Nil</span>;
            <span class="keyword">case</span> <a title="Iterable[java.lang.String]" id="31164">x</a> =&gt; <span title="(x: java.lang.String)Some[java.lang.String]">Some</span><span title="(xo: Option[java.lang.String])Iterable[java.lang.String]" class="delimiter">(</span><a href="#31164" title="java.lang.String">x</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <a href="#29725" title="(name: String, owner: String, permissions: String, modDate: String, size: String)RemoteMachine.this.RemoteFile">RemoteFile</a><span class="delimiter">(</span><a href="#30503" title="(i: Int)java.lang.String">parts</a><span class="delimiter">(</span><span title="Int(7)" class="int">7</span><span class="delimiter">)</span>, <a href="#30503" title="(i: Int)java.lang.String">parts</a><span class="delimiter">(</span><span title="Int(2)" class="int">2</span><span class="delimiter">)</span>, <a href="#30503" title="(i: Int)java.lang.String">parts</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <a href="#30503" title="(i: Int)java.lang.String">parts</a><span class="delimiter">(</span><span title="Int(5)" class="int">5</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#30503" title="(i: Int)java.lang.String">parts</a><span class="delimiter">(</span><span title="Int(6)" class="int">6</span><span class="delimiter">)</span>, <a href="#30503" title="(i: Int)java.lang.String">parts</a><span class="delimiter">(</span><span title="Int(4)" class="int">4</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a title="Nothing" id="31471">er</a> =&gt; <span title="Nothing" class="keyword">throw</span> <span title="deploylib.UnknownResponse" class="keyword">new</span> <a href="#35250" title="deploylib.UnknownResponse">UnknownResponse</a><span class="delimiter">(</span><a href="#31471" title="deploylib.ExecuteResponse">er</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  case <span class="keyword">class</span> <a title="class RemoteJavaProcess extends java.lang.Object with ScalaObject with Product with Serializable" id="31512">RemoteJavaProcess</a><a href="#31512" title="ScalaObject" class="delimiter">(</a><a title="Int" id="35236">pid</a>: <span title="Int">Int</span>, <a title="String" id="35237">main</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="deploylib.RemoteMachine" id="31479">remoteMachine</a> = <a href="#9611" title="deploylib.RemoteMachine">self</a>

    <span class="comment">/**
     * Return a string containing a stack dump for all the threads.
     */</span>
    <span class="keyword">def</span> <a title="=&gt; String" id="31481">stack</a> = <a href="#9611" title="RemoteMachine.this.type">self</a> <a href="#20797" title="(cmd: String)String">!?</a> <span class="delimiter">(</span><span title="java.lang.String(&quot;jstack &quot;)" class="string">&quot;jstack &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#35236" title="=&gt; Int">pid</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Return a list of all the java processes running on the remote machine.
   */</span>
  <span class="keyword">def</span> <a title="=&gt; Seq[RemoteMachine.this.RemoteJavaProcess]" id="20819">jps</a>: <span title="Seq[RemoteMachine.this.RemoteJavaProcess]">Seq</span><span class="delimiter">[</span>RemoteJavaProcess<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="31568">javaProcessRegEx</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;(\d+) (\S+)&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>
    <a href="#20798" title="(cmd: String, timeout: Long)deploylib.ExecuteResponse">executeCommand</a><span class="delimiter">(</span><span title="java.lang.String(&quot;jps&quot;)" class="string">&quot;jps&quot;</span><span class="delimiter">)</span> <span title="Seq[RemoteMachine.this.RemoteJavaProcess]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Seq[RemoteMachine.this.RemoteJavaProcess]">ExecuteResponse</span><span class="delimiter">(</span>Some<span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <a title="String" id="31573">out</a>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#31573" title="String">out</a>.<span title="(x$1: java.lang.String)Array[java.lang.String]">split</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>.<span title="(f: java.lang.String =&gt; scala.collection.GenTraversableOnce[RemoteMachine.this.RemoteJavaProcess])(implicit bf: scala.collection.generic.CanBuildFrom[Array[java.lang.String],RemoteMachine.this.RemoteJavaProcess,Seq[RemoteMachine.this.RemoteJavaProcess]])Seq[RemoteMachine.this.RemoteJavaProcess]">flatMap</span> <a href="#32036" title="Iterable[RemoteMachine.this.RemoteJavaProcess]" class="delimiter">{</a>
          <span class="keyword">case</span> <a href="#31568" title="Iterable[Nothing]">javaProcessRegEx</a><span class="delimiter">(</span><a title="String" id="32038">pid</a>, <span title="java.lang.String(&quot;jps&quot;)" class="string">&quot;jps&quot;</span><span class="delimiter">)</span> =&gt; <span title="(xo: Option[Nothing])Iterable[Nothing]">None</span>
          <span class="keyword">case</span> <a href="#31568" title="Iterable[RemoteMachine.this.RemoteJavaProcess]">javaProcessRegEx</a><span class="delimiter">(</span><a title="String" id="32097">pid</a>, <a title="String" id="32098">main</a><span class="delimiter">)</span> =&gt; <span title="(x: RemoteMachine.this.RemoteJavaProcess)Some[RemoteMachine.this.RemoteJavaProcess]">Some</span><span title="(xo: Option[RemoteMachine.this.RemoteJavaProcess])Iterable[RemoteMachine.this.RemoteJavaProcess]" class="delimiter">(</span><span title="RemoteMachine.this.RemoteJavaProcess" class="keyword">new</span> <a href="#31512" title="RemoteMachine.this.RemoteJavaProcess">RemoteJavaProcess</a><span class="delimiter">(</span><a href="#32097" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">pid</a>.<span title="=&gt; Int">toInt</span>, <a href="#32098" title="String">main</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a title="Nothing" id="32252">er</a> =&gt; <span title="Nothing" class="keyword">throw</span> <span title="deploylib.UnknownResponse" class="keyword">new</span> <a href="#35250" title="deploylib.UnknownResponse">UnknownResponse</a><span class="delimiter">(</span><a href="#32252" title="deploylib.ExecuteResponse">er</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  case <span class="keyword">class</span> <a title="class RemoteProcess extends java.lang.Object with ScalaObject with Product with Serializable" id="32386">RemoteProcess</a><a href="#32386" title="ScalaObject" class="delimiter">(</a><a title="String" id="33886">user</a>: <span title="String">String</span>, <a title="Int" id="33887">pid</a>: <span title="Int">Int</span>, <a title="Float" id="33888">cpu</a>: <span title="Float">Float</span>, <a title="Float" id="33889">mem</a>: <span title="Float">Float</span>, <a title="Int" id="33890">vsz</a>: <span title="Int">Int</span>, <a title="Int" id="33891">rss</a>: <span title="Int">Int</span>, <a title="String" id="33892">tty</a>: <span title="String">String</span>, <a title="String" id="33893">stat</a>: <span title="String">String</span>, <a title="String" id="33894">start</a>: <span title="String">String</span>, <a title="String" id="33895">time</a>: <span title="String">String</span>, <a title="String" id="33896">command</a>: <span title="String">String</span><span class="delimiter">)</span>

  <span class="comment">/**
   * lists the processes running on the remote machine.
   * Expects:
   * USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
   * root         1  0.0  0.0  23708  1952 ?        Ss   01:00   0:00 /sbin/init
   */</span>
  <span class="keyword">def</span> <a title="=&gt; Seq[RemoteMachine.this.RemoteProcess]" id="20823">ps</a>: <span title="Seq[RemoteMachine.this.RemoteProcess]">Seq</span><span class="delimiter">[</span>RemoteProcess<span class="delimiter">]</span> =
    <span class="delimiter">(</span><a href="#9611" title="RemoteMachine.this.type" class="keyword">this</a> <a href="#20797" title="(cmd: String)String">!?</a> <span title="java.lang.String(&quot;ps aux&quot;)" class="string">&quot;ps aux&quot;</span><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)Array[java.lang.String]">split</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>.<span title="(n: Int)Array[java.lang.String]">drop</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      .<span title="(f: java.lang.String =&gt; Array[java.lang.String])(implicit bf: scala.collection.generic.CanBuildFrom[Array[java.lang.String],Array[java.lang.String],Array[Array[java.lang.String]]])Array[Array[java.lang.String]]">map</span><span title="(xs: Array[Array[java.lang.String]])scala.collection.mutable.ArrayOps[Array[java.lang.String]]" class="delimiter">(</span><a href="#33375" title="java.lang.String">_</a>.<span title="(x$1: java.lang.String)Array[java.lang.String]">split</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\\s+&quot;)" class="string">&quot;\\s+&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      .<span title="(f: Array[java.lang.String] =&gt; RemoteMachine.this.RemoteProcess)(implicit bf: scala.collection.generic.CanBuildFrom[Array[Array[java.lang.String]],RemoteMachine.this.RemoteProcess,Seq[RemoteMachine.this.RemoteProcess]])Seq[RemoteMachine.this.RemoteProcess]">map</span><span title="(implicit m: DummyImplicit)scala.collection.generic.CanBuildFrom[Array[_],RemoteMachine.this.RemoteProcess,scala.collection.mutable.ArraySeq[RemoteMachine.this.RemoteProcess]]" class="delimiter">(</span><a title="Array[java.lang.String]" id="33885">rp</a> =&gt; <a href="#32386" title="(user: String, pid: Int, cpu: Float, mem: Float, vsz: Int, rss: Int, tty: String, stat: String, start: String, time: String, command: String)RemoteMachine.this.RemoteProcess">RemoteProcess</a><span class="delimiter">(</span><a href="#33885" title="(i: Int)java.lang.String">rp</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>,
      <a href="#33885" title="(i: Int)java.lang.String">rp</a><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span>,
      <a href="#33885" title="(i: Int)java.lang.String">rp</a><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="delimiter">(</span><span title="Int(2)" class="int">2</span><span class="delimiter">)</span>.<span title="=&gt; Float">toFloat</span>,
      <a href="#33885" title="(i: Int)java.lang.String">rp</a><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="delimiter">(</span><span title="Int(3)" class="int">3</span><span class="delimiter">)</span>.<span title="=&gt; Float">toFloat</span>,
      <a href="#33885" title="(i: Int)java.lang.String">rp</a><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="delimiter">(</span><span title="Int(4)" class="int">4</span><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span>,
      <a href="#33885" title="(i: Int)java.lang.String">rp</a><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="delimiter">(</span><span title="Int(5)" class="int">5</span><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span>,
      <a href="#33885" title="(i: Int)java.lang.String">rp</a><span class="delimiter">(</span><span title="Int(6)" class="int">6</span><span class="delimiter">)</span>,
      <a href="#33885" title="(i: Int)java.lang.String">rp</a><span class="delimiter">(</span><span title="Int(7)" class="int">7</span><span class="delimiter">)</span>,
      <a href="#33885" title="(i: Int)java.lang.String">rp</a><span class="delimiter">(</span><span title="Int(8)" class="int">8</span><span class="delimiter">)</span>,
      <a href="#33885" title="(i: Int)java.lang.String">rp</a><span class="delimiter">(</span><span title="Int(9)" class="int">9</span><span class="delimiter">)</span>,
      <a href="#33885" title="(i: Int)java.lang.String">rp</a><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>


  case <span class="keyword">class</span> <a title="class FreeStats extends java.lang.Object with ScalaObject with Product with Serializable" id="34037">FreeStats</a><a href="#34037" title="ScalaObject" class="delimiter">(</a><a title="Int" id="34766">total</a>: <span title="Int">Int</span>, <a title="Int" id="34767">used</a>: <span title="Int">Int</span>, <a title="Int" id="34768">free</a>: <span title="Int">Int</span>, <a title="Int" id="34769">shared</a>: <span title="Int">Int</span>, <a title="Int" id="34770">buffers</a>: <span title="Int">Int</span>, <a title="Int" id="34771">cached</a>: <span title="Int">Int</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="20827">freeResponse</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;.*Mem:\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+).*&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>
  <span class="comment">/**
   * Returns the result of the command free.
   *
   * Parsed as:
   * total       used       free     shared    buffers     cached
   * Mem:       7864548    4332752    3531796          0      78112    2640248
   */</span>
  <span class="keyword">def</span> <a title="=&gt; RemoteMachine.this.FreeStats" id="20829">free</a> = <span class="delimiter">(</span><a href="#9611" title="RemoteMachine.this.type" class="keyword">this</a> <a href="#20797" title="(cmd: String)String">!?</a> <span title="java.lang.String(&quot;free -m&quot;)" class="string">&quot;free -m&quot;</span><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)Array[java.lang.String]">split</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>.<span title="(f: java.lang.String =&gt; scala.collection.GenTraversableOnce[RemoteMachine.this.FreeStats])(implicit bf: scala.collection.generic.CanBuildFrom[Array[java.lang.String],RemoteMachine.this.FreeStats,Array[RemoteMachine.this.FreeStats]])Array[RemoteMachine.this.FreeStats]">flatMap</span> <a href="#34757" title="(xs: Array[RemoteMachine.this.FreeStats])scala.collection.mutable.ArrayOps[RemoteMachine.this.FreeStats]" class="delimiter">{</a>
    <span class="keyword">case</span> <a href="#20827" title="List[RemoteMachine.this.FreeStats]">freeResponse</a><span class="delimiter">(</span><a title="String" id="34759">total</a>, <a title="String" id="34760">used</a>, <a title="String" id="34761">freeMem</a>, <a title="String" id="34762">shared</a>, <a title="String" id="34763">buffers</a>, <a title="String" id="34764">cached</a><span class="delimiter">)</span> =&gt;
      <a href="#34037" title="(total: Int, used: Int, free: Int, shared: Int, buffers: Int, cached: Int)RemoteMachine.this.FreeStats">FreeStats</a><span class="delimiter">(</span><a href="#34759" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">total</a>.<span title="=&gt; Int">toInt</span>, <a href="#34760" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">used</a>.<span title="=&gt; Int">toInt</span>, <a href="#34761" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">freeMem</a>.<span title="=&gt; Int">toInt</span>, <a href="#34762" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">shared</a>.<span title="=&gt; Int">toInt</span>, <a href="#34763" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">buffers</a>.<span title="=&gt; Int">toInt</span>, <a href="#34764" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">cached</a>.<span title="=&gt; Int">toInt</span><span class="delimiter">)</span> <a href="#34765" title="(x: RemoteMachine.this.FreeStats)List[RemoteMachine.this.FreeStats]">::</a> <span title="object Nil">Nil</span>
    <span class="keyword">case</span> <span title="scala.collection.immutable.Nil.type">_</span> =&gt; <span title="object Nil">Nil</span>
  <span class="delimiter">}</span>.<span title="=&gt; RemoteMachine.this.FreeStats">head</span>


  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="20830">toString</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="String">String</span> = <span title="java.lang.String(&quot;&lt;RemoteMachine &quot;)" class="string">&quot;&lt;RemoteMachine &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#20775" title="=&gt; String">username</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;@&quot;)" class="string">&quot;@&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#20774" title="=&gt; String">hostname</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;&gt;&quot;)" class="string">&quot;&gt;&quot;</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>