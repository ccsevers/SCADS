<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>runit/RunitManager.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> deploylib.runit

<span class="keyword">import</span> deploylib._
<span class="keyword">import</span> java.io.File

<span class="comment">/**
 * Allows the management of services controlled by Runit on the remote machine
 */</span>
<span class="keyword">abstract</span> <span class="keyword">trait</span> <a title="trait RunitManager extends deploylib.RemoteMachine with ScalaObject" id="9808">RunitManager</a> <span title="ScalaObject" class="keyword">extends</span> <a href="../RemoteMachine.scala.html#9489" title="deploylib.RemoteMachine">RemoteMachine</a> <span class="delimiter">{</span>
  <span class="keyword">val</span> <a title="=&gt; java.io.File" id="38566">runitBinaryPath</a>: <span title="java.io.File">File</span>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.io.File" id="38568">runsvdirCmd</a>: <span title="java.io.File">File</span> = <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#38566" title="=&gt; java.io.File">runitBinaryPath</a>, <span title="java.lang.String(&quot;runsvdir&quot;)" class="string">&quot;runsvdir&quot;</span><span class="delimiter">)</span>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.io.File" id="38570">svCmd</a>: <span title="java.io.File">File</span> = <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#38566" title="=&gt; java.io.File">runitBinaryPath</a>, <span title="java.lang.String(&quot;sv&quot;)" class="string">&quot;sv&quot;</span><span class="delimiter">)</span>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.io.File" id="38572">svlogdCmd</a>: <span title="java.io.File">File</span> = <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#38566" title="=&gt; java.io.File">runitBinaryPath</a>, <span title="java.lang.String(&quot;svlogd&quot;)" class="string">&quot;svlogd&quot;</span><span class="delimiter">)</span>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.io.File" id="38574">serviceRoot</a> = <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="../RemoteMachine.scala.html#25725" title="=&gt; java.io.File">rootDirectory</a>, <span title="java.lang.String(&quot;services&quot;)" class="string">&quot;services&quot;</span><span class="delimiter">)</span>

	<span class="keyword">def</span> <a title="=&gt; List[deploylib.runit.RunitService]" id="38575">services</a>: <span title="List[deploylib.runit.RunitService]">List</span><span class="delimiter">[</span>RunitService<span class="delimiter">]</span> = <span class="delimiter">{</span>
		<a href="../RemoteMachine.scala.html#25745" title="(cmd: String, timeout: Long)deploylib.ExecuteResponse">executeCommand</a><span class="delimiter">(</span><span title="java.lang.String(&quot;cd &quot;)" class="string">&quot;cd &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#38573" title="=&gt; java.io.File">serviceRoot</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;;ls&quot;)" class="string">&quot;;ls&quot;</span><span class="delimiter">)</span> <span title="List[deploylib.runit.RunitService]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="List[deploylib.runit.RunitService]">ExecuteResponse</span><span class="delimiter">(</span>Some<span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> =&gt; List<span class="delimiter">[</span>RunitService<span class="delimiter">]</span><span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>
			<span class="keyword">case</span> <span title="List[deploylib.runit.RunitService]">ExecuteResponse</span><span class="delimiter">(</span>Some<span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <a title="String" id="83627">services</a>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> =&gt; <a href="#83627" title="String">services</a>.<span title="(x$1: java.lang.String)Array[java.lang.String]">split</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>.<span title="=&gt; List[java.lang.String]">toList</span>.<span title="(f: java.lang.String =&gt; deploylib.runit.RunitService)(implicit bf: scala.collection.generic.CanBuildFrom[List[java.lang.String],deploylib.runit.RunitService,List[deploylib.runit.RunitService]])List[deploylib.runit.RunitService]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,deploylib.runit.RunitService,List[deploylib.runit.RunitService]]" class="delimiter">(</span><span title="deploylib.runit.RunitService" class="keyword">new</span> <a href="RunitService.scala.html#9824" title="deploylib.runit.RunitService">RunitService</a><span class="delimiter">(</span><a href="#9808" title="deploylib.runit.RunitManager" class="keyword">this</a>, <a href="#83795" title="java.lang.String">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
			<span class="keyword">case</span> <a title="List[deploylib.runit.RunitService]" id="83827">e</a>: <a href="../RemoteMachine.scala.html#9480" title="deploylib.ExecuteResponse">ExecuteResponse</a> =&gt; <span class="delimiter">{</span>
				<a href="../RemoteMachine.scala.html#25731" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">fatal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Unexpected ExecuteResponse while listing services: &quot;)" class="string">&quot;Unexpected ExecuteResponse while listing services: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#83827" title="deploylib.ExecuteResponse">e</a><span class="delimiter">)</span>
				List<span class="delimiter">[</span>RunitService<span class="delimiter">]</span><span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>
			<span class="delimiter">}</span>
		<span class="delimiter">}</span>
	<span class="delimiter">}</span>

	<span class="keyword">def</span> <a title="=&gt; Unit" id="38576">clearAll</a>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
		<a href="#38575" title="=&gt; List[deploylib.runit.RunitService]">services</a>.<span title="(f: deploylib.runit.RunitService =&gt; deploylib.ExecuteResponse)Unit">foreach</span><span class="delimiter">(</span><a title="deploylib.runit.RunitService" id="83866">s</a> =&gt; <span class="delimiter">{</span>
				<a href="#83866" title="deploylib.runit.RunitService">s</a>.<a href="RunitService.scala.html#38603" title="=&gt; Unit">stop</a>
				<a href="../RemoteMachine.scala.html#25731" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;deleting &quot;)" class="string">&quot;deleting &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#83866" title="deploylib.runit.RunitService">s</a>.<a href="RunitService.scala.html#38586" title="=&gt; java.io.File">serviceDir</a>, <span title="java.lang.String(&quot;*&quot;)" class="string">&quot;*&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
				<a href="../RemoteMachine.scala.html#25745" title="(cmd: String, timeout: Long)deploylib.ExecuteResponse">executeCommand</a><span class="delimiter">(</span><span title="java.lang.String(&quot;rm -rf &quot;)" class="string">&quot;rm -rf &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#83866" title="deploylib.runit.RunitService">s</a>.<a href="RunitService.scala.html#38586" title="=&gt; java.io.File">serviceDir</a><span class="delimiter">)</span>
		<span class="delimiter">}</span><span class="delimiter">)</span>
	<span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>