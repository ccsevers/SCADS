<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>client/Stores.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs.scads.storage

<span class="keyword">import</span> edu.berkeley.cs.avro.runtime._
<span class="keyword">import</span> edu.berkeley.cs.avro.marker._
<span class="keyword">import</span> edu.berkeley.cs.scads.comm._

<span class="keyword">import</span> org.apache.avro.Schema 
<span class="keyword">import</span> org.apache.avro.generic._
<span class="keyword">import</span> org.apache.avro.util._

<span class="keyword">import</span> collection.mutable.Queue
<span class="keyword">import</span> collection.<span title="object scala.collection.JavaConversions">JavaConversions</span>._

<span class="keyword">trait</span> <a title="trait BaseKeyValueStoreImpl[K &lt;: org.apache.avro.generic.IndexedRecord, V &lt;: org.apache.avro.generic.IndexedRecord, B] extends java.lang.Object with edu.berkeley.cs.scads.storage.KeyValueStoreLike[K,V,B] with edu.berkeley.cs.scads.storage.Serializer[K,V,B] with edu.berkeley.cs.scads.storage.Protocol with ScalaObject" id="9705">BaseKeyValueStoreImpl</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: org.apache.avro.generic.IndexedRecord" id="9706">K</a> &lt;: IndexedRecord, <a title="&gt;: Nothing &lt;: org.apache.avro.generic.IndexedRecord" id="9707">V</a> &lt;: IndexedRecord, <a title="&gt;: Nothing &lt;: Any" id="9708">B</a><span class="delimiter">]</span>
  <span title="ScalaObject" class="keyword">extends</span> <a href="Interfaces.scala.html#9593" title="edu.berkeley.cs.scads.storage.KeyValueStoreLike[K,V,B]">KeyValueStoreLike</a><span class="delimiter">[</span>K, V, B<span class="delimiter">]</span>
  <span class="keyword">with</span> <a href="Interfaces.scala.html#9601" title="edu.berkeley.cs.scads.storage.Serializer[K,V,B]">Serializer</a><span class="delimiter">[</span>K, V, B<span class="delimiter">]</span>
  <span class="keyword">with</span> <a href="Interfaces.scala.html#9610" title="edu.berkeley.cs.scads.storage.Protocol">Protocol</a> <span class="delimiter">{</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(that: TraversableOnce[B])Unit" id="33562">++=</a><span class="delimiter">(</span><a title="TraversableOnce[B]" id="43380">that</a>: <span title="TraversableOnce[B]">TraversableOnce</span><span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#43380" title="TraversableOnce[B]">that</a>.<span title="=&gt; Iterable[B]">toIterable</span>.<span title="(f: B =&gt; (Array[Byte], Array[Byte]))(implicit bf: scala.collection.generic.CanBuildFrom[Iterable[B],(Array[Byte], Array[Byte]),Iterable[(Array[Byte], Array[Byte])]])Iterable[(Array[Byte], Array[Byte])]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Iterable.Coll,(Array[Byte], Array[Byte]),Iterable[(Array[Byte], Array[Byte])]]" class="delimiter">(</span><a href="Interfaces.scala.html#33097" title="(b: B)(Array[Byte], Array[Byte])">bulkToBytes</a><span class="delimiter">)</span>.<span title="(f: (Array[Byte], Array[Byte]) =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="(Array[Byte], Array[Byte])" id="43464">b</a> =&gt; <a href="Interfaces.scala.html#13534" title="(key: Array[Byte], value: Array[Byte])Unit">putBulkBytes</a><span class="delimiter">(</span><a href="#43464" title="(Array[Byte], Array[Byte])">b</a>.<span title="=&gt; Array[Byte]">_1</span>, <a href="#43464" title="(Array[Byte], Array[Byte])">b</a>.<span title="=&gt; Array[Byte]">_2</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="Interfaces.scala.html#13533" title="()Unit">flushBulkBytes</a>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(key: K)Option[V]" id="33563">get</a><span class="delimiter">(</span><a title="K" id="33570">key</a>: <a href="#9706" title="K">K</a><span class="delimiter">)</span>: <span title="Option[V]">Option</span><span class="delimiter">[</span>V<span class="delimiter">]</span> =
    <a href="Interfaces.scala.html#13530" title="(key: Array[Byte])Option[Array[Byte]]">getBytes</a><span class="delimiter">(</span><a href="Interfaces.scala.html#33095" title="(key: K)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="#33570" title="K">key</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(f: Array[Byte] =&gt; V)Option[V]">map</span> <a href="Interfaces.scala.html#33093" title="(bytes: Array[Byte])V">bytesToValue</a>     

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(key: K, value: Option[V])Unit" id="33564">put</a><span class="delimiter">(</span><a title="K" id="33585">key</a>: <a href="#9706" title="K">K</a>, <a title="Option[V]" id="33586">value</a>: <span title="Option[V]">Option</span><span class="delimiter">[</span>V<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="Interfaces.scala.html#13531" title="(key: Array[Byte], value: Option[Array[Byte]])Unit">putBytes</a><span class="delimiter">(</span><a href="Interfaces.scala.html#33095" title="(key: K)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="#33585" title="K">key</a><span class="delimiter">)</span>, <a href="#33586" title="Option[V]">value</a>.<span title="(f: V =&gt; Array[Byte])Option[Array[Byte]]">map</span><span class="delimiter">(</span><a title="V" id="63746">v</a> =&gt; <a href="Interfaces.scala.html#33096" title="(value: V)Array[Byte]">valueToBytes</a><span class="delimiter">(</span><a href="#63746" title="V">v</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(key: K, value: Option[V])edu.berkeley.cs.scads.comm.ScadsFuture[Unit]" id="33565">asyncPut</a><span class="delimiter">(</span><a title="K" id="63749">key</a>: <a href="#9706" title="K">K</a>, <a title="Option[V]" id="63750">value</a>: <span title="Option[V]">Option</span><span class="delimiter">[</span>V<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="edu.berkeley.cs.scads.comm.ScadsFuture[Unit]">ScadsFuture</span><span class="delimiter">[</span>Unit<span class="delimiter">]</span> =
    <a href="Interfaces.scala.html#13532" title="(key: Array[Byte], value: Option[Array[Byte]])edu.berkeley.cs.scads.comm.ScadsFuture[Unit]">asyncPutBytes</a><span class="delimiter">(</span><a href="Interfaces.scala.html#33095" title="(key: K)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="#63749" title="K">key</a><span class="delimiter">)</span>, <a href="#63750" title="Option[V]">value</a>.<span title="(f: V =&gt; Array[Byte])Option[Array[Byte]]">map</span><span class="delimiter">(</span><a href="Interfaces.scala.html#33096" title="(value: V)Array[Byte]">valueToBytes</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(key: K)edu.berkeley.cs.scads.comm.ScadsFuture[Option[V]]" id="33566">asyncGet</a><span class="delimiter">(</span><a title="K" id="42675">key</a>: <a href="#9706" title="K">K</a><span class="delimiter">)</span>: <span title="edu.berkeley.cs.scads.comm.ScadsFuture[Option[V]]">ScadsFuture</span><span class="delimiter">[</span>Option<span class="delimiter">[</span>V<span class="delimiter">]</span><span class="delimiter">]</span> =
    <a href="Interfaces.scala.html#13535" title="(key: Array[Byte])edu.berkeley.cs.scads.comm.ScadsFuture[Option[Array[Byte]]]">asyncGetBytes</a><span class="delimiter">(</span><a href="Interfaces.scala.html#33095" title="(key: K)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="#42675" title="K">key</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: Option[Array[Byte]] =&gt; Option[V])edu.berkeley.cs.scads.comm.ScadsFuture[Option[V]]">map</span><span class="delimiter">(</span><a href="#63763" title="Option[Array[Byte]]">_</a>.<span title="(f: Array[Byte] =&gt; V)Option[V]">map</span><span class="delimiter">(</span><a href="Interfaces.scala.html#33093" title="(bytes: Array[Byte])V">bytesToValue</a><span class="delimiter">)</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">private</span><span class="delimiter">[</span>storage<span class="delimiter">]</span> <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.storage.BaseRangeKeyValueStoreImpl" id="9709">BaseRangeKeyValueStoreImpl</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">final</span> <span class="keyword">val</span> <a title="java.lang.String(&quot;&quot;)" id="44443">MinString</a> = <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span> 
  <span class="keyword">final</span> <span class="keyword">val</span> <a title="java.lang.String" id="44445">MaxString</a> = <span title="(x$1: Array[Byte])java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><span title="object Array">Array</span>.<span title="[T](n: Int)(elem: =&gt; T)(implicit evidence$9: scala.reflect.ClassManifest[T])Array[T]">fill</span><span title="(n: Int)(elem: =&gt; Byte)(implicit evidence$9: scala.reflect.ClassManifest[Byte])Array[Byte]" class="delimiter">[</span><span title="Byte">Byte</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="Int(20)" class="int">20</span><span class="delimiter">)</span><span title="=&gt; scala.reflect.AnyValManifest[Byte]" class="delimiter">(</span><span title="Int(127)" class="int">127</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Byte" class="delimiter">[</span><span title="Byte">Byte</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait BaseRangeKeyValueStoreImpl[K &lt;: org.apache.avro.generic.IndexedRecord, V &lt;: org.apache.avro.generic.IndexedRecord, B] extends java.lang.Object with edu.berkeley.cs.scads.storage.RangeKeyValueStoreLike[K,V,B] with edu.berkeley.cs.scads.storage.BaseKeyValueStoreImpl[K,V,B] with edu.berkeley.cs.scads.storage.RangeProtocol with ScalaObject" id="9711">BaseRangeKeyValueStoreImpl</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: org.apache.avro.generic.IndexedRecord" id="9712">K</a> &lt;: IndexedRecord, <a title="&gt;: Nothing &lt;: org.apache.avro.generic.IndexedRecord" id="9713">V</a> &lt;: IndexedRecord, <a title="&gt;: Nothing &lt;: Any" id="9714">B</a><span class="delimiter">]</span>
  <span title="ScalaObject" class="keyword">extends</span> <a href="Interfaces.scala.html#9597" title="edu.berkeley.cs.scads.storage.RangeKeyValueStoreLike[K,V,B]">RangeKeyValueStoreLike</a><span class="delimiter">[</span>K, V, B<span class="delimiter">]</span>
  <span class="keyword">with</span> <a href="#9705" title="edu.berkeley.cs.scads.storage.BaseKeyValueStoreImpl[K,V,B]">BaseKeyValueStoreImpl</a><span class="delimiter">[</span>K, V, B<span class="delimiter">]</span>
  <span class="keyword">with</span> <a href="Interfaces.scala.html#9611" title="edu.berkeley.cs.scads.storage.RangeProtocol">RangeProtocol</a> <span class="delimiter">{</span>

  <span class="keyword">import</span> <a href="#9709" title="object edu.berkeley.cs.scads.storage.BaseRangeKeyValueStoreImpl">BaseRangeKeyValueStoreImpl</a>._
  <span class="keyword">import</span> <span title="object org.apache.avro.Schema">Schema</span>._

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(fieldType: org.apache.avro.Schema.Type, fieldSchema: org.apache.avro.Schema)Any" id="33551">minVal</a><span class="delimiter">(</span><a title="org.apache.avro.Schema.Type" id="46862">fieldType</a>: <span title="org.apache.avro.Schema.Type">Type</span>, <a title="org.apache.avro.Schema" id="46863">fieldSchema</a>: <span title="org.apache.avro.Schema">Schema</span><span class="delimiter">)</span>: <span title="Any">Any</span> = <a href="#46862" title="org.apache.avro.Schema.Type">fieldType</a> <span title="Any" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="Boolean(false)">Type</span>.<span title="org.apache.avro.Schema.Type(value BOOLEAN)">BOOLEAN</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
    <span class="keyword">case</span> <span title="Double(4.9E-324)">Type</span>.<span title="org.apache.avro.Schema.Type(value DOUBLE)">DOUBLE</span> =&gt; java.lang.Double.<span title="Double(4.9E-324)">MIN_VALUE</span>
    <span class="keyword">case</span> <span title="Float(1.4E-45)">Type</span>.<span title="org.apache.avro.Schema.Type(value FLOAT)">FLOAT</span> =&gt; java.lang.Float.<span title="Float(1.4E-45)">MIN_VALUE</span>
    <span class="keyword">case</span> <span title="Int(-2147483648)">Type</span>.<span title="org.apache.avro.Schema.Type(value INT)">INT</span> =&gt; java.lang.Integer.<span title="Int(-2147483648)">MIN_VALUE</span>
    <span class="keyword">case</span> <span title="Long(-9223372036854775808L)">Type</span>.<span title="org.apache.avro.Schema.Type(value LONG)">LONG</span> =&gt; java.lang.Long.<span title="Long(-9223372036854775808L)">MIN_VALUE</span>
    <span class="keyword">case</span> <span title="org.apache.avro.util.Utf8">Type</span>.<span title="org.apache.avro.Schema.Type(value STRING)">STRING</span> =&gt; <span title="(x$1: java.lang.String)org.apache.avro.util.Utf8" class="keyword">new</span> <span title="org.apache.avro.util.Utf8">Utf8</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)">MinString</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="org.apache.avro.generic.IndexedRecord">Type</span>.<span title="org.apache.avro.Schema.Type(value RECORD)">RECORD</span> =&gt;
      <a href="#33553" title="(keyPrefix: org.apache.avro.generic.IndexedRecord, keyFactory: () =&gt; org.apache.avro.generic.IndexedRecord)(fillFunc: (org.apache.avro.Schema.Type, org.apache.avro.Schema) =&gt; Any)org.apache.avro.generic.IndexedRecord">fillOutKey</a><span class="delimiter">(</span><a href="Interfaces.scala.html#33098" title="(schema: org.apache.avro.Schema)org.apache.avro.generic.IndexedRecord">newRecord</a><span class="delimiter">(</span><a href="#46863" title="org.apache.avro.Schema">fieldSchema</a><span class="delimiter">)</span>, <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="Interfaces.scala.html#33098" title="(schema: org.apache.avro.Schema)org.apache.avro.generic.IndexedRecord">newRecord</a><span class="delimiter">(</span><a href="#46863" title="org.apache.avro.Schema">fieldSchema</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#33551" title="(fieldType: org.apache.avro.Schema.Type, fieldSchema: org.apache.avro.Schema)Any">minVal</a> _<span class="delimiter">)</span>
    <span class="keyword">case</span> <a title="Nothing" id="63806">unsupportedType</a> =&gt;
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Invalid key type in partial key getRange. &quot;)" class="string">&quot;Invalid key type in partial key getRange. &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#63806" title="org.apache.avro.Schema.Type">unsupportedType</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; not supported for inquality queries.&quot;)" class="string">&quot; not supported for inquality queries.&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(fieldType: org.apache.avro.Schema.Type, fieldSchema: org.apache.avro.Schema)Any" id="33552">maxVal</a><span class="delimiter">(</span><a title="org.apache.avro.Schema.Type" id="46887">fieldType</a>: <span title="org.apache.avro.Schema.Type">Type</span>, <a title="org.apache.avro.Schema" id="46888">fieldSchema</a>: <span title="org.apache.avro.Schema">Schema</span><span class="delimiter">)</span>: <span title="Any">Any</span> = <a href="#46887" title="org.apache.avro.Schema.Type">fieldType</a> <span title="Any" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="Boolean(true)">Type</span>.<span title="org.apache.avro.Schema.Type(value BOOLEAN)">BOOLEAN</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">case</span> <span title="Double(1.7976931348623157E308)">Type</span>.<span title="org.apache.avro.Schema.Type(value DOUBLE)">DOUBLE</span> =&gt; java.lang.Double.<span title="Double(1.7976931348623157E308)">MAX_VALUE</span>
    <span class="keyword">case</span> <span title="Float(3.4028235E38)">Type</span>.<span title="org.apache.avro.Schema.Type(value FLOAT)">FLOAT</span> =&gt; java.lang.Float.<span title="Float(3.4028235E38)">MAX_VALUE</span>
    <span class="keyword">case</span> <span title="Int(2147483647)">Type</span>.<span title="org.apache.avro.Schema.Type(value INT)">INT</span> =&gt; java.lang.Integer.<span title="Int(2147483647)">MAX_VALUE</span>
    <span class="keyword">case</span> <span title="Long(9223372036854775807L)">Type</span>.<span title="org.apache.avro.Schema.Type(value LONG)">LONG</span> =&gt; java.lang.Long.<span title="Long(9223372036854775807L)">MAX_VALUE</span>
    <span class="keyword">case</span> <span title="org.apache.avro.util.Utf8">Type</span>.<span title="org.apache.avro.Schema.Type(value STRING)">STRING</span> =&gt; <span title="(x$1: java.lang.String)org.apache.avro.util.Utf8" class="keyword">new</span> <span title="org.apache.avro.util.Utf8">Utf8</span><span class="delimiter">(</span><a href="#44445" title="=&gt; java.lang.String">MaxString</a><span class="delimiter">)</span> 
    <span class="keyword">case</span> <span title="org.apache.avro.generic.IndexedRecord">Type</span>.<span title="org.apache.avro.Schema.Type(value RECORD)">RECORD</span> =&gt; 
      <a href="#33553" title="(keyPrefix: org.apache.avro.generic.IndexedRecord, keyFactory: () =&gt; org.apache.avro.generic.IndexedRecord)(fillFunc: (org.apache.avro.Schema.Type, org.apache.avro.Schema) =&gt; Any)org.apache.avro.generic.IndexedRecord">fillOutKey</a><span class="delimiter">(</span><a href="Interfaces.scala.html#33098" title="(schema: org.apache.avro.Schema)org.apache.avro.generic.IndexedRecord">newRecord</a><span class="delimiter">(</span><a href="#46888" title="org.apache.avro.Schema">fieldSchema</a><span class="delimiter">)</span>, <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="Interfaces.scala.html#33098" title="(schema: org.apache.avro.Schema)org.apache.avro.generic.IndexedRecord">newRecord</a><span class="delimiter">(</span><a href="#46888" title="org.apache.avro.Schema">fieldSchema</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#33552" title="(fieldType: org.apache.avro.Schema.Type, fieldSchema: org.apache.avro.Schema)Any">maxVal</a> _<span class="delimiter">)</span>
    <span class="keyword">case</span> <a title="Nothing" id="63824">unsupportedType</a> =&gt;
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Invalid key type in partial key getRange. &quot;)" class="string">&quot;Invalid key type in partial key getRange. &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#63824" title="org.apache.avro.Schema.Type">unsupportedType</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; not supported for inquality queries.&quot;)" class="string">&quot; not supported for inquality queries.&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="[R &lt;: org.apache.avro.generic.IndexedRecord](keyPrefix: R, keyFactory: () =&gt; R)(fillFunc: (org.apache.avro.Schema.Type, org.apache.avro.Schema) =&gt; Any)R" id="33553">fillOutKey</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: org.apache.avro.generic.IndexedRecord" id="33555">R</a> &lt;: IndexedRecord<span class="delimiter">]</span><span class="delimiter">(</span><a title="R" id="46850">keyPrefix</a>: <a href="#33555" title="R">R</a>, <a title="() =&gt; R" id="46851">keyFactory</a>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; R<span class="delimiter">)</span><span class="delimiter">(</span><a title="(org.apache.avro.Schema.Type, org.apache.avro.Schema) =&gt; Any" id="46852">fillFunc</a>: <span class="delimiter">(</span>Type, Schema<span class="delimiter">)</span> =&gt; Any<span class="delimiter">)</span>: <a href="#33555" title="R">R</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="R" id="63829">filledRec</a> = <a href="#46851" title="()R">keyFactory</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <a href="#46850" title="R">keyPrefix</a>.<span title="()org.apache.avro.Schema">getSchema</span>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>.<span title="(f: org.apache.avro.Schema.Field =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="org.apache.avro.Schema.Field" id="64223">field</a> =&gt; <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#46850" title="R">keyPrefix</a>.<span title="(x$1: Int)java.lang.Object">get</span><span class="delimiter">(</span><a href="#64223" title="org.apache.avro.Schema.Field">field</a>.<span title="()Int">pos</span><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
       <a href="#63829" title="R">filledRec</a>.<span title="(x$1: Int, x$2: Any)Unit">put</span><span class="delimiter">(</span><a href="#64223" title="org.apache.avro.Schema.Field">field</a>.<span title="()Int">pos</span>, <a href="#46852" title="(v1: org.apache.avro.Schema.Type, v2: org.apache.avro.Schema)Any">fillFunc</a><span class="delimiter">(</span><a href="#64223" title="org.apache.avro.Schema.Field">field</a>.<span title="()org.apache.avro.Schema">schema</span>.<span title="()org.apache.avro.Schema.Type">getType</span>, <a href="#64223" title="org.apache.avro.Schema.Field">field</a>.<span title="()org.apache.avro.Schema">schema</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">else</span>
       <a href="#63829" title="R">filledRec</a>.<span title="(x$1: Int, x$2: Any)Unit">put</span><span class="delimiter">(</span><a href="#64223" title="org.apache.avro.Schema.Field">field</a>.<span title="()Int">pos</span>, <a href="#46850" title="R">keyPrefix</a>.<span title="(x$1: Int)java.lang.Object">get</span><span class="delimiter">(</span><a href="#64223" title="org.apache.avro.Schema.Field">field</a>.<span title="()Int">pos</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
    <a href="#63829" title="R">filledRec</a>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(start: Option[K], end: Option[K], limit: Option[Int], offset: Option[Int], ascending: Boolean)Seq[B]" id="33556">getRange</a><span class="delimiter">(</span><a title="Option[K]" id="46818">start</a>: <span title="Option[K]">Option</span><span class="delimiter">[</span>K<span class="delimiter">]</span>,
                        <a title="Option[K]" id="46819">end</a>: <span title="Option[K]">Option</span><span class="delimiter">[</span>K<span class="delimiter">]</span>,
                        <a title="Option[Int]" id="46820">limit</a>: <span title="Option[Int]">Option</span><span class="delimiter">[</span>Int<span class="delimiter">]</span>,
                        <a title="Option[Int]" id="46821">offset</a>: <span title="Option[Int]">Option</span><span class="delimiter">[</span>Int<span class="delimiter">]</span>,
                        <a title="Boolean" id="46822">ascending</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> =
    <a href="Interfaces.scala.html#33567" title="(start: Option[Array[Byte]], end: Option[Array[Byte]], limit: Option[Int], offset: Option[Int], ascending: Boolean)Seq[(Array[Byte], Array[Byte])]">getKeys</a><span class="delimiter">(</span><a href="#46818" title="Option[K]">start</a>.<span title="(f: K =&gt; K)Option[K]">map</span><span class="delimiter">(</span><a title="K" id="46849">prefix</a> =&gt; <a href="#33553" title="(keyPrefix: K, keyFactory: () =&gt; K)(fillFunc: (org.apache.avro.Schema.Type, org.apache.avro.Schema) =&gt; Any)K">fillOutKey</a><span class="delimiter">(</span><a href="#46849" title="K">prefix</a>, <a href="Interfaces.scala.html#33099" title="=&gt; K">newKeyInstance</a> _<span class="delimiter">)</span><span class="delimiter">(</span><a href="#33551" title="(fieldType: org.apache.avro.Schema.Type, fieldSchema: org.apache.avro.Schema)Any">minVal</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: K =&gt; Array[Byte])Option[Array[Byte]]">map</span><span class="delimiter">(</span><a href="Interfaces.scala.html#33095" title="(key: K)Array[Byte]">keyToBytes</a><span class="delimiter">)</span>, <a href="#46819" title="Option[K]">end</a>.<span title="(f: K =&gt; K)Option[K]">map</span><span class="delimiter">(</span><a title="K" id="46880">prefix</a> =&gt; <a href="#33553" title="(keyPrefix: K, keyFactory: () =&gt; K)(fillFunc: (org.apache.avro.Schema.Type, org.apache.avro.Schema) =&gt; Any)K">fillOutKey</a><span class="delimiter">(</span><a href="#46880" title="K">prefix</a>, <a href="Interfaces.scala.html#33099" title="=&gt; K">newKeyInstance</a> _<span class="delimiter">)</span><span class="delimiter">(</span><a href="#33552" title="(fieldType: org.apache.avro.Schema.Type, fieldSchema: org.apache.avro.Schema)Any">maxVal</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: K =&gt; Array[Byte])Option[Array[Byte]]">map</span><span class="delimiter">(</span><a href="Interfaces.scala.html#33095" title="(key: K)Array[Byte]">keyToBytes</a><span class="delimiter">)</span>, <a href="#46820" title="Option[Int]">limit</a>, <a href="#46821" title="Option[Int]">offset</a>, <a href="#46822" title="Boolean">ascending</a><span class="delimiter">)</span>.<span title="(f: (Array[Byte], Array[Byte]) =&gt; B)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Array[Byte], Array[Byte])],B,Seq[B]])Seq[B]">map</span> <a href="#46930" title="B" class="delimiter">{</a> 
      <span class="keyword">case</span> <span title="B" class="delimiter">(</span><a title="Array[Byte]" id="46933">k</a>,<a title="Array[Byte]" id="46934">v</a><span class="delimiter">)</span> =&gt; <a href="Interfaces.scala.html#33094" title="(k: Array[Byte], v: Array[Byte])B">bytesToBulk</a><span class="delimiter">(</span><a href="#46933" title="Array[Byte]">k</a>, <a href="#46934" title="Array[Byte]">v</a><span class="delimiter">)</span> 
    <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(start: Option[K], end: Option[K], limit: Option[Int], offset: Option[Int], ascending: Boolean)edu.berkeley.cs.scads.comm.ScadsFuture[Seq[B]]" id="33557">asyncGetRange</a><span class="delimiter">(</span><a title="Option[K]" id="64232">start</a>: <span title="Option[K]">Option</span><span class="delimiter">[</span>K<span class="delimiter">]</span>,
                             <a title="Option[K]" id="64233">end</a>: <span title="Option[K]">Option</span><span class="delimiter">[</span>K<span class="delimiter">]</span>,
                             <a title="Option[Int]" id="64234">limit</a>: <span title="Option[Int]">Option</span><span class="delimiter">[</span>Int<span class="delimiter">]</span>,
                             <a title="Option[Int]" id="64235">offset</a>: <span title="Option[Int]">Option</span><span class="delimiter">[</span>Int<span class="delimiter">]</span>,
                             <a title="Boolean" id="64236">ascending</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> =
    <a href="Interfaces.scala.html#33568" title="(start: Option[Array[Byte]], end: Option[Array[Byte]], limit: Option[Int], offset: Option[Int], ascending: Boolean)edu.berkeley.cs.scads.comm.ScadsFuture[Seq[(Array[Byte], Array[Byte])]]">asyncGetKeys</a><span class="delimiter">(</span><a href="#64232" title="Option[K]">start</a>.<span title="(f: K =&gt; K)Option[K]">map</span><span class="delimiter">(</span><a title="K" id="64248">prefix</a> =&gt; <a href="#33553" title="(keyPrefix: K, keyFactory: () =&gt; K)(fillFunc: (org.apache.avro.Schema.Type, org.apache.avro.Schema) =&gt; Any)K">fillOutKey</a><span class="delimiter">(</span><a href="#64248" title="K">prefix</a>, <a href="Interfaces.scala.html#33099" title="=&gt; K">newKeyInstance</a> _<span class="delimiter">)</span><span class="delimiter">(</span><a href="#33551" title="(fieldType: org.apache.avro.Schema.Type, fieldSchema: org.apache.avro.Schema)Any">minVal</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: K =&gt; Array[Byte])Option[Array[Byte]]">map</span><span class="delimiter">(</span><a href="Interfaces.scala.html#33095" title="(key: K)Array[Byte]">keyToBytes</a><span class="delimiter">)</span>, <a href="#64233" title="Option[K]">end</a>.<span title="(f: K =&gt; K)Option[K]">map</span><span class="delimiter">(</span><a title="K" id="64270">prefix</a> =&gt; <a href="#33553" title="(keyPrefix: K, keyFactory: () =&gt; K)(fillFunc: (org.apache.avro.Schema.Type, org.apache.avro.Schema) =&gt; Any)K">fillOutKey</a><span class="delimiter">(</span><a href="#64270" title="K">prefix</a>, <a href="Interfaces.scala.html#33099" title="=&gt; K">newKeyInstance</a> _<span class="delimiter">)</span><span class="delimiter">(</span><a href="#33552" title="(fieldType: org.apache.avro.Schema.Type, fieldSchema: org.apache.avro.Schema)Any">maxVal</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: K =&gt; Array[Byte])Option[Array[Byte]]">map</span><span class="delimiter">(</span><a href="Interfaces.scala.html#33095" title="(key: K)Array[Byte]">keyToBytes</a><span class="delimiter">)</span>, <a href="#64234" title="Option[Int]">limit</a>, <a href="#64235" title="Option[Int]">offset</a>, <a href="#64236" title="Boolean">ascending</a><span class="delimiter">)</span>.<span title="(f: Seq[(Array[Byte], Array[Byte])] =&gt; Seq[B])edu.berkeley.cs.scads.comm.ScadsFuture[Seq[B]]">map</span><span class="delimiter">(</span><a href="#64291" title="Seq[(Array[Byte], Array[Byte])]">_</a>.<span title="(f: (Array[Byte], Array[Byte]) =&gt; B)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Array[Byte], Array[Byte])],B,Seq[B]])Seq[B]">map</span> <a href="#64308" title="B" class="delimiter">{</a> <span class="keyword">case</span> <span title="B" class="delimiter">(</span><a title="Array[Byte]" id="64311">k</a>, <a title="Array[Byte]" id="64312">v</a><span class="delimiter">)</span> =&gt; <a href="Interfaces.scala.html#33094" title="(k: Array[Byte], v: Array[Byte])B">bytesToBulk</a><span class="delimiter">(</span><a href="#64311" title="Array[Byte]">k</a>, <a href="#64312" title="Array[Byte]">v</a><span class="delimiter">)</span> <span class="delimiter">}</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/** Hash partition */</span>
<span class="keyword">trait</span> <a title="trait KeyValueStore[K &lt;: org.apache.avro.generic.IndexedRecord, V &lt;: org.apache.avro.generic.IndexedRecord] extends java.lang.Object with edu.berkeley.cs.scads.storage.BaseKeyValueStoreImpl[K,V,(K, V)] with edu.berkeley.cs.scads.storage.KeyValueSerializer[K,V] with ScalaObject" id="9715">KeyValueStore</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: org.apache.avro.generic.IndexedRecord" id="9716">K</a> &lt;: IndexedRecord, <a title="&gt;: Nothing &lt;: org.apache.avro.generic.IndexedRecord" id="9717">V</a> &lt;: IndexedRecord<span class="delimiter">]</span>
  <span title="ScalaObject" class="keyword">extends</span> <a href="#9705" title="edu.berkeley.cs.scads.storage.BaseKeyValueStoreImpl[K,V,(K, V)]">BaseKeyValueStoreImpl</a><span class="delimiter">[</span>K, V, <span class="delimiter">(</span>K, V<span class="delimiter">)</span><span class="delimiter">]</span>
  <span class="keyword">with</span> <a href="Interfaces.scala.html#9605" title="edu.berkeley.cs.scads.storage.KeyValueSerializer[K,V]">KeyValueSerializer</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> <span class="delimiter">{</span>

  <span class="keyword">def</span> <a title="=&gt; Iterator[(K, V)]" id="40646">iterator</a>: <span title="Iterator[(K, V)]">Iterator</span><span class="delimiter">[</span><span class="delimiter">(</span>K, V<span class="delimiter">)</span><span class="delimiter">]</span> = sys.<span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="java.lang.String(&quot;iterator&quot;)" class="string">&quot;iterator&quot;</span><span class="delimiter">)</span>

<span class="delimiter">}</span>

<span class="keyword">private</span><span class="delimiter">[</span>storage<span class="delimiter">]</span> <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.storage.RangeKeyValueStore" id="9718">RangeKeyValueStore</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">val</span> <a title="Int" id="33888">windowSize</a> = <span title="Int(16)" class="int">16</span>
<span class="delimiter">}</span>

<span class="comment">/** Range partition */</span>
<span class="keyword">trait</span> <a title="trait RangeKeyValueStore[K &lt;: org.apache.avro.generic.IndexedRecord, V &lt;: org.apache.avro.generic.IndexedRecord] extends java.lang.Object with edu.berkeley.cs.scads.storage.BaseRangeKeyValueStoreImpl[K,V,(K, V)] with edu.berkeley.cs.scads.storage.KeyValueSerializer[K,V] with ScalaObject" id="9720">RangeKeyValueStore</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: org.apache.avro.generic.IndexedRecord" id="9721">K</a> &lt;: IndexedRecord, <a title="&gt;: Nothing &lt;: org.apache.avro.generic.IndexedRecord" id="9722">V</a> &lt;: IndexedRecord<span class="delimiter">]</span>
  <span title="ScalaObject" class="keyword">extends</span> <a href="#9711" title="edu.berkeley.cs.scads.storage.BaseRangeKeyValueStoreImpl[K,V,(K, V)]">BaseRangeKeyValueStoreImpl</a><span class="delimiter">[</span>K, V, <span class="delimiter">(</span>K, V<span class="delimiter">)</span><span class="delimiter">]</span>
  <span class="keyword">with</span> <a href="Interfaces.scala.html#9605" title="edu.berkeley.cs.scads.storage.KeyValueSerializer[K,V]">KeyValueSerializer</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> <span class="delimiter">{</span>

  <span class="keyword">import</span> <a href="#9718" title="object edu.berkeley.cs.scads.storage.RangeKeyValueStore">RangeKeyValueStore</a>._

  <span class="keyword">def</span> <a title="=&gt; Iterator[(K, V)]" id="33560">iterator</a>: <span title="Iterator[(K, V)]">Iterator</span><span class="delimiter">[</span><span class="delimiter">(</span>K, V<span class="delimiter">)</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#64343" title="java.lang.Object with Iterator[(K, V)]{}" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with Iterator[(K, V)]" id="64343">Iterator</a><span class="delimiter">[</span><span class="delimiter">(</span>K, V<span class="delimiter">)</span><span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">private</span> <span class="keyword">var</span> <a title="Option[Array[Byte]]" id="64515">lastFetchKey</a>: <span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span> = <span title="object None">None</span>
      <span class="keyword">private</span> <span class="keyword">var</span> <a title="Boolean" id="64518">isDone</a> = <span title="Boolean(false)" class="keyword">false</span>
      <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.Queue[(Array[Byte], Array[Byte])]" id="64520">buf</a> = <span title="scala.collection.mutable.Queue[(Array[Byte], Array[Byte])]" class="keyword">new</span> <span title="scala.collection.mutable.Queue[(Array[Byte], Array[Byte])]">Queue</span><span class="delimiter">[</span><span class="delimiter">(</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>, Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">]</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="64522">hasNext</a> = 
        <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#64518" title="=&gt; Boolean">isDone</a><span class="delimiter">)</span> <span title="=&gt; Boolean">!</span><a href="#64520" title="=&gt; scala.collection.mutable.Queue[(Array[Byte], Array[Byte])]">buf</a>.<span title="=&gt; Boolean">isEmpty</span> 
        <span class="keyword">else</span> <span class="delimiter">{</span>
          <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#64520" title="=&gt; scala.collection.mutable.Queue[(Array[Byte], Array[Byte])]">buf</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="comment">// need to fetch and update buffer/isDone flag</span>
            <span class="keyword">val</span> <a title="Seq[(Array[Byte], Array[Byte])]" id="64539">recs</a> = <a href="Interfaces.scala.html#33567" title="(start: Option[Array[Byte]], end: Option[Array[Byte]], limit: Option[Int], offset: Option[Int], ascending: Boolean)Seq[(Array[Byte], Array[Byte])]">getKeys</a><span class="delimiter">(</span><a href="#64515" title="=&gt; Option[Array[Byte]]">lastFetchKey</a>, <span title="object None">None</span>, <span title="(x: Int)Some[Int]">Some</span><span class="delimiter">(</span><a href="#33888" title="=&gt; Int">windowSize</a><span class="delimiter">)</span>, <a href="#64515" title="=&gt; Option[Array[Byte]]">lastFetchKey</a>.<span title="(f: Array[Byte] =&gt; Int)Option[Int]">map</span><span class="delimiter">(</span><a title="Array[Byte]" id="64547">_</a> =&gt; <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="(alternative: =&gt; Option[Int])Option[Int]">orElse</span><span class="delimiter">(</span><span title="(x: Int)Some[Int]">Some</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> 
            <a href="#64515" title="(x$1: Option[Array[Byte]])Unit">lastFetchKey</a> = <span title="(x: Array[Byte])Some[Array[Byte]]">Some</span><span class="delimiter">(</span><a href="#64539" title="Seq[(Array[Byte], Array[Byte])]">recs</a>.<span title="=&gt; (Array[Byte], Array[Byte])">last</span>.<span title="=&gt; Array[Byte]">_1</span><span class="delimiter">)</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#64539" title="Seq[(Array[Byte], Array[Byte])]">recs</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">&lt;</span> <a href="#33888" title="=&gt; Int">windowSize</a><span class="delimiter">)</span>
              <a href="#64518" title="(x$1: Boolean)Unit">isDone</a> = <span title="Boolean(true)" class="keyword">true</span>
            <a href="#64520" title="=&gt; scala.collection.mutable.Queue[(Array[Byte], Array[Byte])]">buf</a> <span title="(xs: scala.collection.TraversableOnce[(Array[Byte], Array[Byte])])this.buf.type">++=</span> <a href="#64539" title="Seq[(Array[Byte], Array[Byte])]">recs</a>
            <span title="=&gt; Boolean">!</span><a href="#64520" title="=&gt; scala.collection.mutable.Queue[(Array[Byte], Array[Byte])]">buf</a>.<span title="=&gt; Boolean">isEmpty</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Boolean(true)" class="keyword">true</span> <span class="comment">// if buf is not empty then we have more</span>
        <span class="delimiter">}</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()(K, V)" id="64523">next</a> = <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#64522" title="=&gt; Boolean">hasNext</a><span class="delimiter">)</span>
          <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;next on empty iterator&quot;)" class="string">&quot;next on empty iterator&quot;</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a href="#64572" title="(Array[Byte], Array[Byte])" class="delimiter">(</a><a href="#64571" title="Array[Byte]" id="64572">k</a>, <a href="#64571" title="Array[Byte]" id="64573">v</a><span class="delimiter">)</span> = <a href="#64520" title="=&gt; scala.collection.mutable.Queue[(Array[Byte], Array[Byte])]">buf</a>.<span title="()(Array[Byte], Array[Byte])">dequeue</span><span title="(Array[Byte], Array[Byte]) @unchecked" class="delimiter">(</span><span class="delimiter">)</span>
        <span title="(_1: K, _2: V)(K, V)" class="delimiter">(</span><a href="Interfaces.scala.html#33092" title="(bytes: Array[Byte])K">bytesToKey</a><span class="delimiter">(</span><a href="#64572" title="Array[Byte]">k</a><span class="delimiter">)</span>, <a href="Interfaces.scala.html#33093" title="(bytes: Array[Byte])V">bytesToValue</a><span class="delimiter">(</span><a href="#64573" title="Array[Byte]">v</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait RecordStore[RecType &lt;: org.apache.avro.generic.IndexedRecord] extends java.lang.Object with edu.berkeley.cs.scads.storage.Namespace with edu.berkeley.cs.scads.storage.KeyPartitionable with edu.berkeley.cs.scads.storage.GlobalMetadata with edu.berkeley.cs.scads.storage.BaseRangeKeyValueStoreImpl[org.apache.avro.generic.IndexedRecord,org.apache.avro.generic.IndexedRecord,RecType] with ScalaObject" id="9723">RecordStore</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: org.apache.avro.generic.IndexedRecord" id="9724">RecType</a> &lt;: IndexedRecord<span class="delimiter">]</span> <span title="ScalaObject" class="keyword">extends</span> <a href="Namespace.scala.html#9625" title="edu.berkeley.cs.scads.storage.Namespace">Namespace</a>
  <span class="keyword">with</span> <a href="Interfaces.scala.html#9617" title="edu.berkeley.cs.scads.storage.KeyPartitionable">KeyPartitionable</a>
  <span class="keyword">with</span> <a href="Interfaces.scala.html#9618" title="edu.berkeley.cs.scads.storage.GlobalMetadata">GlobalMetadata</a>
  <span class="keyword">with</span> <a href="#9711" title="edu.berkeley.cs.scads.storage.BaseRangeKeyValueStoreImpl[org.apache.avro.generic.IndexedRecord,org.apache.avro.generic.IndexedRecord,RecType]">BaseRangeKeyValueStoreImpl</a><span class="delimiter">[</span>IndexedRecord, IndexedRecord, RecType<span class="delimiter">]</span> <span class="delimiter">{</span>

  <span class="keyword">def</span> <a title="(key: org.apache.avro.generic.IndexedRecord)edu.berkeley.cs.scads.comm.ScadsFuture[Option[RecType]]" id="40838">asyncGetRecord</a><span class="delimiter">(</span><a title="org.apache.avro.generic.IndexedRecord" id="40907">key</a>: <span title="org.apache.avro.generic.IndexedRecord">IndexedRecord</span><span class="delimiter">)</span>: <span title="edu.berkeley.cs.scads.comm.ScadsFuture[Option[RecType]]">ScadsFuture</span><span class="delimiter">[</span>Option<span class="delimiter">[</span>RecType<span class="delimiter">]</span><span class="delimiter">]</span>
  <span class="keyword">def</span> <a title="(key: org.apache.avro.generic.IndexedRecord)Option[RecType]" id="40839">getRecord</a><span class="delimiter">(</span><a title="org.apache.avro.generic.IndexedRecord" id="40937">key</a>: <span title="org.apache.avro.generic.IndexedRecord">IndexedRecord</span><span class="delimiter">)</span>: <span title="Option[RecType]">Option</span><span class="delimiter">[</span>RecType<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="(fields: Any*)Option[RecType]" id="40840">lookupRecord</a><span class="delimiter">(</span><a title="Any*" id="64597">fields</a>: <span title="Any*">Any</span>*<span class="delimiter">)</span>: <span title="Option[RecType]">Option</span><span class="delimiter">[</span>RecType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="org.apache.avro.generic.GenericData.Record" id="64599">rec</a> = <span title="org.apache.avro.generic.GenericData.Record" class="keyword">new</span> <span title="object org.apache.avro.generic.GenericData">GenericData</span>.<span title="org.apache.avro.generic.GenericData.Record">Record</span><span class="delimiter">(</span><a href="Interfaces.scala.html#13627" title="=&gt; org.apache.avro.Schema">keySchema</a><span class="delimiter">)</span>
    <a href="#64597" title="Any*">fields</a>.<span title="(f: Any =&gt; Any)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[Any],Any,Seq[Any]])Seq[Any]">map</span> <a href="#64618" title="Any" class="delimiter">{</a>
      <span class="keyword">case</span> <a title="org.apache.avro.util.Utf8" id="64619">s</a>: <span title="String">String</span> =&gt; <span title="(x$1: java.lang.String)org.apache.avro.util.Utf8" class="keyword">new</span> <span title="org.apache.avro.util.Utf8">Utf8</span><span class="delimiter">(</span><a href="#64619" title="String">s</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="Any" id="64624">o</a> =&gt; <a href="#64624" title="Any">o</a>
    <span class="delimiter">}</span>.<span title="(implicit bf: scala.collection.generic.CanBuildFrom[Seq[Any],(Any, Int),Seq[(Any, Int)]])Seq[(Any, Int)]">zipWithIndex</span>.<span title="(f: (Any, Int) =&gt; Unit)Unit">foreach</span> <a href="#64699" title="Unit" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="Unit" class="delimiter">(</span><a title="Any" id="64702">v</a>, <a title="Int" id="64703">idx</a><span class="delimiter">)</span> =&gt; <a href="#64599" title="org.apache.avro.generic.GenericData.Record">rec</a>.<span title="(x$1: Int, x$2: Any)Unit">put</span><span class="delimiter">(</span><a href="#64703" title="Int">idx</a>, <a href="#64702" title="Any">v</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#40839" title="(key: org.apache.avro.generic.IndexedRecord)Option[RecType]">getRecord</a><span class="delimiter">(</span><a href="#64599" title="org.apache.avro.generic.GenericData.Record">rec</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Reads the first 1000 * clustersize / replication factor keys from the sequence and
   * repartitions the cluster so the data is distributed evenly.  Note the data in the
   * sequence must be randomly distributed for this to work.
   */</span>
  <span class="keyword">def</span> <a title="(data: Seq[RecType], replicationFactor: Int)Unit" id="40841">repartition</a><span class="delimiter">(</span><a title="Seq[RecType]" id="43109">data</a>: <span title="Seq[RecType]">Seq</span><span class="delimiter">[</span>RecType<span class="delimiter">]</span>, <a title="Int" id="43110">replicationFactor</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.comm.StorageService]" id="64709">servers</a> = <a href="Namespace.scala.html#13586" title="=&gt; edu.berkeley.cs.scads.storage.ScadsCluster">cluster</a>.<a href="ScadsCluster.scala.html#38035" title="()List[edu.berkeley.cs.scads.comm.StorageService]">getAvailableServers</a>
    <span class="keyword">val</span> <a title="Int" id="64710">samplesPerServer</a> = <span title="Int(10000)" class="int">10000</span>
    <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#64709" title="List[edu.berkeley.cs.scads.comm.StorageService]">servers</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">%</span> <a href="#43110" title="Int">replicationFactor</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span>, <span title="java.lang.String(&quot;num servers must divide evenly by replication factor&quot;)" class="string">&quot;num servers must divide evenly by replication factor&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="64711">numPartitions</a> = <a href="#64709" title="List[edu.berkeley.cs.scads.comm.StorageService]">servers</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">/</span> <a href="#43110" title="Int">replicationFactor</a>
    <span class="keyword">val</span> <a title="Int" id="64712">numSamples</a> = <a href="#64710" title="Int">samplesPerServer</a> <span title="(x: Int)Int">*</span> <a href="#64711" title="Int">numPartitions</a>

    <span class="keyword">val</span> <a title="scala.collection.immutable.IndexedSeq[RecType]" id="64713">samples</a> = <a href="#43109" title="Seq[RecType]">data</a>.<span title="(n: Int)Seq[RecType]">take</span><span class="delimiter">(</span><a href="#64712" title="Int">numSamples</a><span class="delimiter">)</span>.<span title="(lt: (RecType, RecType) =&gt; Boolean)Seq[RecType]">sortWith</span><span class="delimiter">(</span><a href="#64741" title="(record: RecType)edu.berkeley.cs.avro.runtime.RichIndexedRecord[RecType]">_</a> <span title="(lhs: RecType)Boolean">&lt;</span> <a href="#64742" title="RecType">_</a><span class="delimiter">)</span>.<span title="scala.collection.immutable.IndexedSeq[RecType]">toIndexedSeq</span>
    <span class="keyword">val</span> <a title="Int" id="64714">splitSize</a> = <a href="#64713" title="scala.collection.immutable.IndexedSeq[RecType]">samples</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">/</span> <a href="#64711" title="Int">numPartitions</a>
    <span class="keyword">val</span> <a title="scala.collection.immutable.IndexedSeq[Option[RecType]]" id="64715">splits</a> = <span title="object None">None</span> <a href="#64819" title="(elem: Option[RecType])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[Some[RecType]],Option[RecType],scala.collection.immutable.IndexedSeq[Option[RecType]]])scala.collection.immutable.IndexedSeq[Option[RecType]]">+:</a> <span class="delimiter">(</span><a href="#64714" title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt">splitSize</a> <span title="(end: Int)scala.collection.immutable.Range">until</span> <a href="#64714" title="Int">splitSize</a> <span title="(x: Int)Int">*</span> <a href="#64711" title="Int">numPartitions</a> <span title="(step: Int)scala.collection.immutable.Range">by</span> <a href="#64714" title="Int">splitSize</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; RecType)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[Int],RecType,scala.collection.immutable.IndexedSeq[RecType]])scala.collection.immutable.IndexedSeq[RecType]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq.Coll,RecType,scala.collection.immutable.IndexedSeq[RecType]]" class="delimiter">(</span><a href="#64713" title="scala.collection.immutable.IndexedSeq[RecType]">samples</a><span class="delimiter">)</span>.<span title="(f: RecType =&gt; Some[RecType])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[RecType],Some[RecType],scala.collection.immutable.IndexedSeq[Some[RecType]]])scala.collection.immutable.IndexedSeq[Some[RecType]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq.Coll,Some[RecType],scala.collection.immutable.IndexedSeq[Some[RecType]]]" class="delimiter">(</span><span title="(x: RecType)Some[RecType]">Some</span><span class="delimiter">(</span><a href="#64967" title="RecType">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <a href="Namespace.scala.html#13589" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Sampled Key Splits for %s: %s&quot;)" class="string">&quot;Sampled Key Splits for %s: %s&quot;</span>, <a href="Namespace.scala.html#13587" title="=&gt; String">namespace</a>, <a href="#64715" title="scala.collection.immutable.IndexedSeq[Option[RecType]]">splits</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.immutable.IndexedSeq[Option[Array[Byte]]]" id="64716">byteSplits</a> = <a href="#64715" title="scala.collection.immutable.IndexedSeq[Option[RecType]]">splits</a>.<span title="(f: Option[RecType] =&gt; Option[Array[Byte]])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[Option[RecType]],Option[Array[Byte]],scala.collection.immutable.IndexedSeq[Option[Array[Byte]]]])scala.collection.immutable.IndexedSeq[Option[Array[Byte]]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq.Coll,Option[Array[Byte]],scala.collection.immutable.IndexedSeq[Option[Array[Byte]]]]" class="delimiter">(</span><a href="#65106" title="Option[RecType]">_</a>.<span title="(f: RecType =&gt; Array[Byte])Option[Array[Byte]]">map</span><span class="delimiter">(</span><a href="Interfaces.scala.html#33095" title="(key: org.apache.avro.generic.IndexedRecord)Array[Byte]">keyToBytes</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.immutable.IndexedSeq[(Option[Array[Byte]], List[edu.berkeley.cs.scads.comm.StorageService])]" id="64717">partitions</a> = <a href="#64716" title="scala.collection.immutable.IndexedSeq[Option[Array[Byte]]]">byteSplits</a> <span title="(that: scala.collection.GenIterable[List[edu.berkeley.cs.scads.comm.StorageService]])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[Option[Array[Byte]]],(Option[Array[Byte]], List[edu.berkeley.cs.scads.comm.StorageService]),scala.collection.immutable.IndexedSeq[(Option[Array[Byte]], List[edu.berkeley.cs.scads.comm.StorageService])]])scala.collection.immutable.IndexedSeq[(Option[Array[Byte]], List[edu.berkeley.cs.scads.comm.StorageService])]">zip</span> <a href="#64709" title="List[edu.berkeley.cs.scads.comm.StorageService]">servers</a>.<span title="(size: Int)Iterator[List[edu.berkeley.cs.scads.comm.StorageService]]">grouped</span><span class="delimiter">(</span><a href="#43110" title="Int">replicationFactor</a><span class="delimiter">)</span>.<span title="=&gt; List[List[edu.berkeley.cs.scads.comm.StorageService]]">toList</span>
    <a href="Namespace.scala.html#13589" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Sampled Partition Scheme for %s: %s&quot;)" class="string">&quot;Sampled Partition Scheme for %s: %s&quot;</span>, <a href="Namespace.scala.html#13587" title="=&gt; String">namespace</a> , <a href="#64717" title="scala.collection.immutable.IndexedSeq[(Option[Array[Byte]], List[edu.berkeley.cs.scads.comm.StorageService])]">partitions</a><span class="delimiter">)</span>

    <a href="Interfaces.scala.html#38003" title="(scheme: Seq[(Option[Array[Byte]], Seq[edu.berkeley.cs.scads.comm.StorageService])])Unit">setPartitionScheme</a><span class="delimiter">(</span><a href="#64717" title="scala.collection.immutable.IndexedSeq[(Option[Array[Byte]], List[edu.berkeley.cs.scads.comm.StorageService])]">partitions</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>