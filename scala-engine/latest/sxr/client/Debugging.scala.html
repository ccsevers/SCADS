<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>client/Debugging.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs
<span class="keyword">package</span> scads
<span class="keyword">package</span> storage

<span class="keyword">import</span> comm._
<span class="keyword">import</span> org.apache.avro.generic.IndexedRecord

<span class="keyword">trait</span> <a title="trait DebuggingClient extends java.lang.Object with ScalaObject" id="9530">DebuggingClient</a> <span title="ScalaObject" class="delimiter">{</span>
  self: Namespace
    <span class="keyword">with</span> KeyRangeRoutable
    <span class="keyword">with</span> ParFuture
    <span class="keyword">with</span> Serializer<span class="delimiter">[</span>IndexedRecord, IndexedRecord, _<span class="delimiter">]</span> =&gt;

  <span class="comment">/*
  def iterateOverRange(startKey: Option[KeyType], endKey: Option[KeyType]): Iterator[RangeType] = {
    val partitions = serversForKeyRange(startKey, endKey)
    partitions.map(p =&gt; new ActorlessPartitionIterator(p.values.head, p.startKey, p.endKey
	      .foldLeft(Iterator.empty.asInstanceOf[Iterator[Record]])(_ ++ _)
	      .map(rec =&gt; extractRangeTypeFromRecord(rec.key, rec.value).get)
  }
  */</span>

  <span class="comment">// For debugging only</span>
  <span class="keyword">def</span> <a title="=&gt; Unit" id="34012">dumpDistribution</a>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="Namespace.scala.html#13592" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012Key Distribution for %s&quot;)" class="string">&quot;\nKey Distribution for %s&quot;</span>, <a href="Namespace.scala.html#13590" title="=&gt; String">namespace</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.comm.MessageFuture]" id="34023">futures</a> = <a href="Interfaces.scala.html#13651" title="(start: Option[Array[Byte]], end: Option[Array[Byte]])Seq[edu.berkeley.cs.scads.storage.RangeDesc]">serversForKeyRange</a><span class="delimiter">(</span><span title="object None">None</span>, <span title="object None">None</span><span class="delimiter">)</span>.<span title="(f: edu.berkeley.cs.scads.storage.RangeDesc =&gt; scala.collection.GenTraversableOnce[edu.berkeley.cs.scads.comm.MessageFuture])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.storage.RangeDesc],edu.berkeley.cs.scads.comm.MessageFuture,Seq[edu.berkeley.cs.scads.comm.MessageFuture]])Seq[edu.berkeley.cs.scads.comm.MessageFuture]">flatMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.comm.MessageFuture,Seq[edu.berkeley.cs.scads.comm.MessageFuture]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.RangeDesc" id="34056">r</a> =&gt;
      <a href="#34056" title="edu.berkeley.cs.scads.storage.RangeDesc">r</a>.<a href="Interfaces.scala.html#27803" title="=&gt; Seq[edu.berkeley.cs.scads.comm.PartitionService]">servers</a>.<span title="(f: edu.berkeley.cs.scads.comm.PartitionService =&gt; edu.berkeley.cs.scads.comm.MessageFuture)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.comm.PartitionService],edu.berkeley.cs.scads.comm.MessageFuture,Seq[edu.berkeley.cs.scads.comm.MessageFuture]])Seq[edu.berkeley.cs.scads.comm.MessageFuture]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.comm.MessageFuture,Seq[edu.berkeley.cs.scads.comm.MessageFuture]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.PartitionService" id="34073">p</a> =&gt; <a href="#34073" title="edu.berkeley.cs.scads.comm.PartitionService">p</a> <span title="(body: edu.berkeley.cs.scads.comm.MessageBody)edu.berkeley.cs.scads.comm.MessageFuture">!!</span> <span title="(minKey: Option[Array[Byte]], maxKey: Option[Array[Byte]])edu.berkeley.cs.scads.comm.CountRangeRequest">CountRangeRequest</span><span class="delimiter">(</span><a href="#34056" title="edu.berkeley.cs.scads.storage.RangeDesc">r</a>.<a href="Interfaces.scala.html#27799" title="=&gt; Option[Array[Byte]]">startKey</a>, <a href="#34056" title="edu.berkeley.cs.scads.storage.RangeDesc">r</a>.<a href="Interfaces.scala.html#27801" title="=&gt; Option[Array[Byte]]">endKey</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <a href="#34023" title="Seq[edu.berkeley.cs.scads.comm.MessageFuture]">futures</a>.<span title="(f: edu.berkeley.cs.scads.comm.MessageFuture =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.MessageFuture" id="34191">f</a> =&gt;
      <a href="#34191" title="()edu.berkeley.cs.scads.comm.MessageBody">f</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Unit">CountRangeResponse</span><span class="delimiter">(</span><a title="Int" id="34231">num</a><span class="delimiter">)</span> =&gt; <a href="Namespace.scala.html#13592" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;%s: %d&quot;)" class="string">&quot;%s: %d&quot;</span>, <a href="#34191" title="edu.berkeley.cs.scads.comm.MessageFuture">f</a>.<span title="=&gt; Option[edu.berkeley.cs.scads.comm.RemoteActorProxy]">source</span>, <a href="#34231" title="Int">num</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <a href="Namespace.scala.html#13592" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Invalid response from %s&quot;)" class="string">&quot;Invalid response from %s&quot;</span>, <a href="#34191" title="edu.berkeley.cs.scads.comm.MessageFuture">f</a>.<span title="=&gt; Option[edu.berkeley.cs.scads.comm.RemoteActorProxy]">source</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Seq[Int]" id="34024">counts</a> = <a href="#34023" title="Seq[edu.berkeley.cs.scads.comm.MessageFuture]">futures</a>.<span title="(f: edu.berkeley.cs.scads.comm.MessageFuture =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.comm.MessageFuture],Int,Seq[Int]])Seq[Int]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Int,Seq[Int]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.MessageFuture" id="34257">f</a> =&gt;
      <a href="#34257" title="()edu.berkeley.cs.scads.comm.MessageBody">f</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="Int" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Int">CountRangeResponse</span><span class="delimiter">(</span><a title="Int" id="34262">num</a><span class="delimiter">)</span> =&gt; <a href="#34262" title="Int">num</a>
        <span class="keyword">case</span> <span title="Int(0)">_</span> =&gt; <span title="Int(0)" class="int">0</span>
      <span class="delimiter">}</span>
    <span class="delimiter">)</span>

    <a href="Namespace.scala.html#13592" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Max Skew: %d, %f&quot;)" class="string">&quot;Max Skew: %d, %f&quot;</span>, <a href="#34024" title="Seq[Int]">counts</a>.<span title="(implicit cmp: Ordering[Int])Int">max</span> <span title="(x: Int)Int">-</span> <a href="#34024" title="Seq[Int]">counts</a>.<span title="(implicit cmp: Ordering[Int])Int">min</span>, <span class="delimiter">(</span><a href="#34024" title="Seq[Int]">counts</a>.<span title="(implicit cmp: Ordering[Int])Int">max</span> <span title="(x: Int)Int">-</span> <a href="#34024" title="Seq[Int]">counts</a>.<span title="(implicit cmp: Ordering[Int])Int">min</span><span class="delimiter">)</span>.<span title="=&gt; Float">toFloat</span> <span title="(x: Int)Float">/</span> <a href="#34024" title="Seq[Int]">counts</a>.<span title="(implicit cmp: Ordering[Int])Int">max</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Unit" id="34013">dumpWorkload</a>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.storage.RangeDesc]" id="36188">partitions</a> = <a href="Interfaces.scala.html#13651" title="(start: Option[Array[Byte]], end: Option[Array[Byte]])Seq[edu.berkeley.cs.scads.storage.RangeDesc]">serversForKeyRange</a><span class="delimiter">(</span><span title="object None">None</span>, <span title="object None">None</span><span class="delimiter">)</span>
    <a href="Namespace.scala.html#13592" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012Stats for namespace %s: %d partitions&quot;)" class="string">&quot;\nStats for namespace %s: %d partitions&quot;</span>, <a href="Namespace.scala.html#13590" title="=&gt; String">namespace</a>, <a href="#36188" title="Seq[edu.berkeley.cs.scads.storage.RangeDesc]">partitions</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Seq[(Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)])]" id="36189">futures</a> = <a href="#36188" title="Seq[edu.berkeley.cs.scads.storage.RangeDesc]">partitions</a>.<span title="(f: edu.berkeley.cs.scads.storage.RangeDesc =&gt; (Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)]))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.storage.RangeDesc],(Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)]),Seq[(Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)])]])Seq[(Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)])]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)]),Seq[(Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)])]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.RangeDesc" id="36211">p</a> =&gt;
      <span title="(_1: Option[Array[Byte]], _2: Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)])(Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)])" class="delimiter">(</span><a href="#36211" title="edu.berkeley.cs.scads.storage.RangeDesc">p</a>.<a href="Interfaces.scala.html#27799" title="=&gt; Option[Array[Byte]]">startKey</a>, <a href="#36211" title="edu.berkeley.cs.scads.storage.RangeDesc">p</a>.<a href="Interfaces.scala.html#27803" title="=&gt; Seq[edu.berkeley.cs.scads.comm.PartitionService]">servers</a>.<span title="(f: edu.berkeley.cs.scads.comm.PartitionService =&gt; (edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.comm.PartitionService],(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture),Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)]])Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture),Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.PartitionService" id="36232">s</a> =&gt; <span title="(_1: edu.berkeley.cs.scads.comm.PartitionService, _2: edu.berkeley.cs.scads.comm.MessageFuture)(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)" class="delimiter">(</span><a href="#36232" title="edu.berkeley.cs.scads.comm.PartitionService">s</a>, <a href="#36232" title="edu.berkeley.cs.scads.comm.PartitionService">s</a> <span title="(body: edu.berkeley.cs.scads.comm.MessageBody)edu.berkeley.cs.scads.comm.MessageFuture">!!</span> <span title="()edu.berkeley.cs.scads.comm.GetWorkloadStats">GetWorkloadStats</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>


    <a href="#36189" title="Seq[(Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)])]">futures</a>.<span title="(f: (Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)]) =&gt; Unit)Unit">foreach</span> <a href="#36362" title="Unit" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="Unit" class="delimiter">(</span><a title="Option[Array[Byte]]" id="36365">startKey</a>, <a title="Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)]" id="36366">replicas</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="Namespace.scala.html#13592" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;==%s==&quot;)" class="string">&quot;==%s==&quot;</span>, <a href="#36365" title="Option[Array[Byte]]">startKey</a>.<span title="(f: Array[Byte] =&gt; org.apache.avro.generic.IndexedRecord)Option[org.apache.avro.generic.IndexedRecord]">map</span><span class="delimiter">(</span><a href="Interfaces.scala.html#33095" title="(bytes: Array[Byte])org.apache.avro.generic.IndexedRecord">bytesToKey</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#36366" title="Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)]">replicas</a>.<span title="(f: (edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture) =&gt; (edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageBody))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)],(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageBody),Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageBody)]])Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageBody)]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageBody),Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageBody)]]" class="delimiter">(</span><a title="(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)" id="36393">f</a> =&gt; <span title="(_1: edu.berkeley.cs.scads.comm.PartitionService, _2: edu.berkeley.cs.scads.comm.MessageBody)(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageBody)" class="delimiter">(</span><a href="#36393" title="(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)">f</a>.<span title="=&gt; edu.berkeley.cs.scads.comm.PartitionService">_1</span>, <a href="#36393" title="(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)">f</a>.<span title="()edu.berkeley.cs.scads.comm.MessageBody">_2</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: (edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageBody) =&gt; Unit)Unit">foreach</span> <a href="#36446" title="Unit" class="delimiter">{</a>
          <span class="keyword">case</span> <span title="Unit" class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.PartitionService" id="36449">hander</a>, GetWorkloadStatsResponse<span class="delimiter">(</span><a title="Int" id="36502">getCount</a>, <a title="Int" id="36503">putCount</a>, _<span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="Namespace.scala.html#13592" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;%s: %d gets, %d puts&quot;)" class="string">&quot;%s: %d gets, %d puts&quot;</span>, <a href="#36449" title="edu.berkeley.cs.scads.comm.PartitionService">hander</a>, <a href="#36502" title="Int">getCount</a>, <a href="#36503" title="Int">putCount</a><span class="delimiter">)</span>
          <span class="keyword">case</span> <a title="Unit" id="36508">m</a> =&gt; <a href="Namespace.scala.html#13592" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Invalid message received for workload stats %s&quot;)" class="string">&quot;Invalid message received for workload stats %s&quot;</span>, <a href="#36508" title="(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageBody)">m</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="Seq[(Int, Int)]" id="36190">values</a> =
      <a href="#36189" title="Seq[(Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)])]">futures</a>.<span title="(f: (Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)]) =&gt; scala.collection.GenTraversableOnce[(Int, Int)])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)])],(Int, Int),Seq[(Int, Int)]])Seq[(Int, Int)]">flatMap</span> <a href="#36531" title="Seq[(Int, Int)]" class="delimiter">{</a>
        <span class="keyword">case</span> <span title="Seq[(Int, Int)]" class="delimiter">(</span><a title="Option[Array[Byte]]" id="36534">startKey</a>, <a title="Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)]" id="36535">replicas</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <a href="#36535" title="Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)]">replicas</a>.<span title="(f: (edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture) =&gt; (edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageBody))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)],(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageBody),Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageBody)]])Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageBody)]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageBody),Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageBody)]]" class="delimiter">(</span><a title="(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)" id="36552">f</a> =&gt; <span title="(_1: edu.berkeley.cs.scads.comm.PartitionService, _2: edu.berkeley.cs.scads.comm.MessageBody)(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageBody)" class="delimiter">(</span><a href="#36552" title="(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)">f</a>.<span title="=&gt; edu.berkeley.cs.scads.comm.PartitionService">_1</span>, <a href="#36552" title="(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture)">f</a>.<span title="()edu.berkeley.cs.scads.comm.MessageBody">_2</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: (edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageBody) =&gt; (Int, Int))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageBody)],(Int, Int),Seq[(Int, Int)]])Seq[(Int, Int)]">map</span> <a href="#36600" title="(Int, Int)" class="delimiter">{</a>
            <span class="keyword">case</span> <span title="(Int, Int)" class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.PartitionService" id="36603">hander</a>, GetWorkloadStatsResponse<span class="delimiter">(</span><a title="Int" id="36605">x</a>, <a title="Int" id="36606">y</a>, _<span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span title="(_1: Int, _2: Int)(Int, Int)" class="delimiter">(</span><a href="#36605" title="Int">x</a>, <a href="#36606" title="Int">y</a><span class="delimiter">)</span>
            <span class="keyword">case</span> <a title="(Int, Int)" id="36613">m</a> =&gt; <span class="delimiter">{</span>
              <a href="Namespace.scala.html#13592" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Invalid message received for workload stats %s&quot;)" class="string">&quot;Invalid message received for workload stats %s&quot;</span>, <a href="#36613" title="(edu.berkeley.cs.scads.comm.PartitionService, edu.berkeley.cs.scads.comm.MessageBody)">m</a><span class="delimiter">)</span>
              <span title="(_1: Int, _2: Int)(Int, Int)" class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <a href="Namespace.scala.html#13592" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;getDiff: %d, putDiff: %d\012&quot;)" class="string">&quot;getDiff: %d, putDiff: %d\n&quot;</span>, <a href="#36190" title="Seq[(Int, Int)]">values</a>.<span title="(f: (Int, Int) =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Int, Int)],Int,Seq[Int]])Seq[Int]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Int,Seq[Int]]" class="delimiter">(</span><a href="#36688" title="(Int, Int)">_</a>.<span title="=&gt; Int">_1</span><span class="delimiter">)</span>.<span title="(implicit cmp: Ordering[Int])Int">max</span> <span title="(x: Int)Int">-</span> <a href="#36190" title="Seq[(Int, Int)]">values</a>.<span title="(f: (Int, Int) =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Int, Int)],Int,Seq[Int]])Seq[Int]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Int,Seq[Int]]" class="delimiter">(</span><a href="#36792" title="(Int, Int)">_</a>.<span title="=&gt; Int">_1</span><span class="delimiter">)</span>.<span title="(implicit cmp: Ordering[Int])Int">min</span>, <a href="#36190" title="Seq[(Int, Int)]">values</a>.<span title="(f: (Int, Int) =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Int, Int)],Int,Seq[Int]])Seq[Int]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Int,Seq[Int]]" class="delimiter">(</span><a href="#36886" title="(Int, Int)">_</a>.<span title="=&gt; Int">_2</span><span class="delimiter">)</span>.<span title="(implicit cmp: Ordering[Int])Int">max</span> <span title="(x: Int)Int">-</span> <a href="#36190" title="Seq[(Int, Int)]">values</a>.<span title="(f: (Int, Int) =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Int, Int)],Int,Seq[Int]])Seq[Int]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Int,Seq[Int]]" class="delimiter">(</span><a href="#36984" title="(Int, Int)">_</a>.<span title="=&gt; Int">_2</span><span class="delimiter">)</span>.<span title="(implicit cmp: Ordering[Int])Int">min</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">//HACK</span>
  <span class="keyword">def</span> <a title="=&gt; Unit" id="34014">rebalance</a>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.storage.RangeDesc]" id="37070">partitions</a> = <a href="Interfaces.scala.html#13651" title="(start: Option[Array[Byte]], end: Option[Array[Byte]])Seq[edu.berkeley.cs.scads.storage.RangeDesc]">serversForKeyRange</a><span class="delimiter">(</span><span title="object None">None</span>, <span title="object None">None</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Seq[(Int, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]" id="37071">distribution</a> = <a href="../util/ParFuture.scala.html#13646" title="(futures: Seq[(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))], timeout: Long)(f: PartialFunction[(edu.berkeley.cs.scads.comm.MessageBody, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])),(Int, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))])Seq[(Int, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]">waitForAndThrowException</a><span class="delimiter">(</span><a href="#37070" title="Seq[edu.berkeley.cs.scads.storage.RangeDesc]">partitions</a>.<span title="(f: edu.berkeley.cs.scads.storage.RangeDesc =&gt; scala.collection.GenTraversableOnce[(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.storage.RangeDesc],(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])),Seq[(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]])Seq[(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]">flatMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])),Seq[(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.RangeDesc" id="37117">p</a> =&gt; <a href="#37117" title="edu.berkeley.cs.scads.storage.RangeDesc">p</a>.<a href="Interfaces.scala.html#27803" title="=&gt; Seq[edu.berkeley.cs.scads.comm.PartitionService]">servers</a>.<span title="(f: edu.berkeley.cs.scads.comm.PartitionService =&gt; (edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.comm.PartitionService],(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])),Seq[(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]])Seq[(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])),Seq[(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.PartitionService" id="37134">s</a> =&gt; <span title="(_1: edu.berkeley.cs.scads.comm.MessageFuture, _2: (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))" class="delimiter">(</span><a href="#37134" title="edu.berkeley.cs.scads.comm.PartitionService">s</a> <span title="(body: edu.berkeley.cs.scads.comm.MessageBody)edu.berkeley.cs.scads.comm.MessageFuture">!!</span> <span title="(minKey: Option[Array[Byte]], maxKey: Option[Array[Byte]])edu.berkeley.cs.scads.comm.CountRangeRequest">CountRangeRequest</span><span class="delimiter">(</span><a href="#37117" title="edu.berkeley.cs.scads.storage.RangeDesc">p</a>.<a href="Interfaces.scala.html#27799" title="=&gt; Option[Array[Byte]]">startKey</a>, <a href="#37117" title="edu.berkeley.cs.scads.storage.RangeDesc">p</a>.<a href="Interfaces.scala.html#27801" title="=&gt; Option[Array[Byte]]">endKey</a><span class="delimiter">)</span>, <span title="(_1: edu.berkeley.cs.scads.comm.PartitionService, _2: Option[org.apache.avro.generic.IndexedRecord], _3: Option[org.apache.avro.generic.IndexedRecord])(edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])" class="delimiter">(</span><a href="#37134" title="edu.berkeley.cs.scads.comm.PartitionService">s</a>, <a href="#37117" title="edu.berkeley.cs.scads.storage.RangeDesc">p</a>.<a href="Interfaces.scala.html#27799" title="=&gt; Option[Array[Byte]]">startKey</a>.<span title="(f: Array[Byte] =&gt; org.apache.avro.generic.IndexedRecord)Option[org.apache.avro.generic.IndexedRecord]">map</span><span class="delimiter">(</span><a href="Interfaces.scala.html#33095" title="(bytes: Array[Byte])org.apache.avro.generic.IndexedRecord">bytesToKey</a><span class="delimiter">)</span>, <a href="#37117" title="edu.berkeley.cs.scads.storage.RangeDesc">p</a>.<a href="Interfaces.scala.html#27801" title="=&gt; Option[Array[Byte]]">endKey</a>.<span title="(f: Array[Byte] =&gt; org.apache.avro.generic.IndexedRecord)Option[org.apache.avro.generic.IndexedRecord]">map</span><span class="delimiter">(</span><a href="Interfaces.scala.html#33095" title="(bytes: Array[Byte])org.apache.avro.generic.IndexedRecord">bytesToKey</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#37219" title="(Int, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="(Int, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))" class="delimiter">(</span>CountRangeResponse<span class="delimiter">(</span><a title="Int" id="37223">c</a><span class="delimiter">)</span>, <a title="(edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])" id="37224">p</a><span class="delimiter">)</span> =&gt; <span title="(_1: Int, _2: (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))(Int, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))" class="delimiter">(</span><a href="#37223" title="Int">c</a>, <a href="#37224" title="(edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])">p</a><span class="delimiter">)</span> <span class="delimiter">}</span>
    <a href="Namespace.scala.html#13592" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;==distribution==&quot;)" class="string">&quot;==distribution==&quot;</span><span class="delimiter">)</span>
    <a href="#37071" title="Seq[(Int, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]">distribution</a>.<span title="(f: (Int, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])) =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="Namespace.scala.html#13592" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;%s: %s&quot;)" class="string">&quot;%s: %s&quot;</span>, <a href="Namespace.scala.html#13590" title="=&gt; String">namespace</a>, <a href="#37251" title="(Int, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Seq[(Int, Int, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]" id="37072">workload</a> = <a href="../util/ParFuture.scala.html#13646" title="(futures: Seq[(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))], timeout: Long)(f: PartialFunction[(edu.berkeley.cs.scads.comm.MessageBody, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])),(Int, Int, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))])Seq[(Int, Int, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]">waitForAndThrowException</a><span class="delimiter">(</span><a href="#37070" title="Seq[edu.berkeley.cs.scads.storage.RangeDesc]">partitions</a>.<span title="(f: edu.berkeley.cs.scads.storage.RangeDesc =&gt; scala.collection.GenTraversableOnce[(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.storage.RangeDesc],(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])),Seq[(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]])Seq[(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]">flatMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])),Seq[(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.RangeDesc" id="37273">p</a> =&gt; <a href="#37273" title="edu.berkeley.cs.scads.storage.RangeDesc">p</a>.<a href="Interfaces.scala.html#27803" title="=&gt; Seq[edu.berkeley.cs.scads.comm.PartitionService]">servers</a>.<span title="(f: edu.berkeley.cs.scads.comm.PartitionService =&gt; (edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.comm.PartitionService],(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])),Seq[(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]])Seq[(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])),Seq[(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.PartitionService" id="37290">s</a> =&gt; <span title="(_1: edu.berkeley.cs.scads.comm.MessageFuture, _2: (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))(edu.berkeley.cs.scads.comm.MessageFuture, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))" class="delimiter">(</span><a href="#37290" title="edu.berkeley.cs.scads.comm.PartitionService">s</a> <span title="(body: edu.berkeley.cs.scads.comm.MessageBody)edu.berkeley.cs.scads.comm.MessageFuture">!!</span> <span title="()edu.berkeley.cs.scads.comm.GetWorkloadStats">GetWorkloadStats</span><span class="delimiter">(</span><span class="delimiter">)</span>, <span title="(_1: edu.berkeley.cs.scads.comm.PartitionService, _2: Option[org.apache.avro.generic.IndexedRecord], _3: Option[org.apache.avro.generic.IndexedRecord])(edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])" class="delimiter">(</span><a href="#37290" title="edu.berkeley.cs.scads.comm.PartitionService">s</a>, <a href="#37273" title="edu.berkeley.cs.scads.storage.RangeDesc">p</a>.<a href="Interfaces.scala.html#27799" title="=&gt; Option[Array[Byte]]">startKey</a>.<span title="(f: Array[Byte] =&gt; org.apache.avro.generic.IndexedRecord)Option[org.apache.avro.generic.IndexedRecord]">map</span><span class="delimiter">(</span><a href="Interfaces.scala.html#33095" title="(bytes: Array[Byte])org.apache.avro.generic.IndexedRecord">bytesToKey</a><span class="delimiter">)</span>, <a href="#37273" title="edu.berkeley.cs.scads.storage.RangeDesc">p</a>.<a href="Interfaces.scala.html#27801" title="=&gt; Option[Array[Byte]]">endKey</a>.<span title="(f: Array[Byte] =&gt; org.apache.avro.generic.IndexedRecord)Option[org.apache.avro.generic.IndexedRecord]">map</span><span class="delimiter">(</span><a href="Interfaces.scala.html#33095" title="(bytes: Array[Byte])org.apache.avro.generic.IndexedRecord">bytesToKey</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#37368" title="(Int, Int, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="(Int, Int, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))" class="delimiter">(</span>GetWorkloadStatsResponse<span class="delimiter">(</span><a title="Int" id="37372">gets</a>, <a title="Int" id="37373">puts</a>, _<span class="delimiter">)</span>, <a title="(edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])" id="37374">p</a><span class="delimiter">)</span> =&gt; <span title="(_1: Int, _2: Int, _3: (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))(Int, Int, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))" class="delimiter">(</span><a href="#37372" title="Int">gets</a>, <a href="#37373" title="Int">puts</a>, <a href="#37374" title="(edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])">p</a><span class="delimiter">)</span> <span class="delimiter">}</span>
    <a href="Namespace.scala.html#13592" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;==workload==&quot;)" class="string">&quot;==workload==&quot;</span><span class="delimiter">)</span>
    <a href="#37072" title="Seq[(Int, Int, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]">workload</a>.<span title="(f: (Int, Int, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])) =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="Namespace.scala.html#13592" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;%s: %s&quot;)" class="string">&quot;%s: %s&quot;</span>, <a href="Namespace.scala.html#13590" title="=&gt; String">namespace</a>, <a href="#37404" title="(Int, Int, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Seq[Int]" id="37073">counts</a> = <a href="#37071" title="Seq[(Int, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]">distribution</a>.<span title="(f: (Int, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])) =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Int, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))],Int,Seq[Int]])Seq[Int]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Int,Seq[Int]]" class="delimiter">(</span><a href="#37426" title="(Int, (edu.berkeley.cs.scads.comm.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))">_</a>.<span title="=&gt; Int">_1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="37074">total</a> = <a href="#37073" title="Seq[Int]">counts</a>.<span title="(implicit num: Numeric[Int])Int">sum</span>
    <span class="keyword">val</span> <a title="Int" id="37075">desiredKeysPerServer</a> = <a href="#37074" title="Int">total</a> <span title="(x: Int)Int">/</span> <a href="#37070" title="Seq[edu.berkeley.cs.scads.storage.RangeDesc]">partitions</a>.<span title="=&gt; Int">size</span>
    <a href="Namespace.scala.html#13592" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;%s: desiredKeysPerServer: %d&quot;)" class="string">&quot;%s: desiredKeysPerServer: %d&quot;</span>, <a href="Namespace.scala.html#13590" title="=&gt; String">namespace</a>, <a href="#37075" title="Int">desiredKeysPerServer</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>