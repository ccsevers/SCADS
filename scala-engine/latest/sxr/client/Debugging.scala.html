<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>client/Debugging.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs
<span class="keyword">package</span> scads
<span class="keyword">package</span> storage

<span class="keyword">import</span> comm._
<span class="keyword">import</span> org.apache.avro.generic.IndexedRecord

<span class="keyword">trait</span> <a title="trait DebuggingClient extends java.lang.Object with ScalaObject" id="9777">DebuggingClient</a> <span title="ScalaObject" class="delimiter">{</span>
  self: Namespace
    <span class="keyword">with</span> KeyRangeRoutable
    <span class="keyword">with</span> ParFuture
    <span class="keyword">with</span> Serializer<span class="delimiter">[</span>IndexedRecord, IndexedRecord, _<span class="delimiter">]</span> =&gt;

  <span class="comment">/*
  def iterateOverRange(startKey: Option[KeyType], endKey: Option[KeyType]): Iterator[RangeType] = {
    val partitions = serversForKeyRange(startKey, endKey)
    partitions.map(p =&gt; new ActorlessPartitionIterator(p.values.head, p.startKey, p.endKey
	      .foldLeft(Iterator.empty.asInstanceOf[Iterator[Record]])(_ ++ _)
	      .map(rec =&gt; extractRangeTypeFromRecord(rec.key, rec.value).get)
  }
  */</span>

  <span class="comment">// For debugging only</span>
  <span class="keyword">def</span> <a title="=&gt; Unit" id="38119">dumpDistribution</a>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="Namespace.scala.html#27902" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012Key Distribution for %s&quot;)" class="string">&quot;\nKey Distribution for %s&quot;</span>, <a href="Namespace.scala.html#27900" title="=&gt; String">namespace</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]" id="38130">futures</a> = <a href="Interfaces.scala.html#27961" title="(start: Option[Array[Byte]], end: Option[Array[Byte]])Seq[edu.berkeley.cs.scads.storage.RangeDesc]">serversForKeyRange</a><span class="delimiter">(</span><span title="object None">None</span>, <span title="object None">None</span><span class="delimiter">)</span>.<span title="(f: edu.berkeley.cs.scads.storage.RangeDesc =&gt; scala.collection.GenTraversableOnce[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.storage.RangeDesc],edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage],Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]])Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]">flatMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage],Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.RangeDesc" id="38163">r</a> =&gt;
      <a href="#38163" title="edu.berkeley.cs.scads.storage.RangeDesc">r</a>.<a href="Interfaces.scala.html#31379" title="=&gt; Seq[edu.berkeley.cs.scads.storage.PartitionService]">servers</a>.<span title="(f: edu.berkeley.cs.scads.storage.PartitionService =&gt; edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.storage.PartitionService],edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage],Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]])Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage],Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.PartitionService" id="38180">p</a> =&gt; <a href="#38180" title="edu.berkeley.cs.scads.storage.PartitionService">p</a> <span title="(body: edu.berkeley.cs.scads.storage.StorageMessage)edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">!!</span> <a href="../Messages.scala.html#23515" title="(minKey: Option[Array[Byte]], maxKey: Option[Array[Byte]])edu.berkeley.cs.scads.storage.CountRangeRequest">CountRangeRequest</a><span class="delimiter">(</span><a href="#38163" title="edu.berkeley.cs.scads.storage.RangeDesc">r</a>.<a href="Interfaces.scala.html#31375" title="=&gt; Option[Array[Byte]]">startKey</a>, <a href="#38163" title="edu.berkeley.cs.scads.storage.RangeDesc">r</a>.<a href="Interfaces.scala.html#31377" title="=&gt; Option[Array[Byte]]">endKey</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <a href="#38130" title="Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]">futures</a>.<span title="(f: edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage] =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]" id="38239">f</a> =&gt;
      <a href="#38239" title="()edu.berkeley.cs.scads.storage.StorageMessage">f</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Unit">CountRangeResponse</span><span class="delimiter">(</span><a title="Int" id="38243">num</a><span class="delimiter">)</span> =&gt; <a href="Namespace.scala.html#27902" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;%s: %d&quot;)" class="string">&quot;%s: %d&quot;</span>, <a href="#38239" title="edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">f</a>.<span title="=&gt; Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]]">source</span>, <a href="#38243" title="Int">num</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <a href="Namespace.scala.html#27902" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Invalid response from %s&quot;)" class="string">&quot;Invalid response from %s&quot;</span>, <a href="#38239" title="edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">f</a>.<span title="=&gt; Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]]">source</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Seq[Int]" id="38131">counts</a> = <a href="#38130" title="Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]">futures</a>.<span title="(f: edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage] =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]],Int,Seq[Int]])Seq[Int]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Int,Seq[Int]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]" id="38269">f</a> =&gt;
      <a href="#38269" title="()edu.berkeley.cs.scads.storage.StorageMessage">f</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="Int" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Int">CountRangeResponse</span><span class="delimiter">(</span><a title="Int" id="38273">num</a><span class="delimiter">)</span> =&gt; <a href="#38273" title="Int">num</a>
        <span class="keyword">case</span> <span title="Int(0)">_</span> =&gt; <span title="Int(0)" class="int">0</span>
      <span class="delimiter">}</span>
    <span class="delimiter">)</span>

    <a href="Namespace.scala.html#27902" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Max Skew: %d, %f&quot;)" class="string">&quot;Max Skew: %d, %f&quot;</span>, <a href="#38131" title="Seq[Int]">counts</a>.<span title="(implicit cmp: Ordering[Int])Int">max</span> <span title="(x: Int)Int">-</span> <a href="#38131" title="Seq[Int]">counts</a>.<span title="(implicit cmp: Ordering[Int])Int">min</span>, <span class="delimiter">(</span><a href="#38131" title="Seq[Int]">counts</a>.<span title="(implicit cmp: Ordering[Int])Int">max</span> <span title="(x: Int)Int">-</span> <a href="#38131" title="Seq[Int]">counts</a>.<span title="(implicit cmp: Ordering[Int])Int">min</span><span class="delimiter">)</span>.<span title="=&gt; Float">toFloat</span> <span title="(x: Int)Float">/</span> <a href="#38131" title="Seq[Int]">counts</a>.<span title="(implicit cmp: Ordering[Int])Int">max</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Unit" id="38120">dumpWorkload</a>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.storage.RangeDesc]" id="39997">partitions</a> = <a href="Interfaces.scala.html#27961" title="(start: Option[Array[Byte]], end: Option[Array[Byte]])Seq[edu.berkeley.cs.scads.storage.RangeDesc]">serversForKeyRange</a><span class="delimiter">(</span><span title="object None">None</span>, <span title="object None">None</span><span class="delimiter">)</span>
    <a href="Namespace.scala.html#27902" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012Stats for namespace %s: %d partitions&quot;)" class="string">&quot;\nStats for namespace %s: %d partitions&quot;</span>, <a href="Namespace.scala.html#27900" title="=&gt; String">namespace</a>, <a href="#39997" title="Seq[edu.berkeley.cs.scads.storage.RangeDesc]">partitions</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Seq[(Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])])]" id="39998">futures</a> = <a href="#39997" title="Seq[edu.berkeley.cs.scads.storage.RangeDesc]">partitions</a>.<span title="(f: edu.berkeley.cs.scads.storage.RangeDesc =&gt; (Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])]))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.storage.RangeDesc],(Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])]),Seq[(Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])])]])Seq[(Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])])]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])]),Seq[(Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])])]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.RangeDesc" id="40020">p</a> =&gt;
      <span title="(_1: Option[Array[Byte]], _2: Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])])(Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])])" class="delimiter">(</span><a href="#40020" title="edu.berkeley.cs.scads.storage.RangeDesc">p</a>.<a href="Interfaces.scala.html#31375" title="=&gt; Option[Array[Byte]]">startKey</a>, <a href="#40020" title="edu.berkeley.cs.scads.storage.RangeDesc">p</a>.<a href="Interfaces.scala.html#31379" title="=&gt; Seq[edu.berkeley.cs.scads.storage.PartitionService]">servers</a>.<span title="(f: edu.berkeley.cs.scads.storage.PartitionService =&gt; (edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.storage.PartitionService],(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]),Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])]])Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]),Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.PartitionService" id="40041">s</a> =&gt; <span title="(_1: edu.berkeley.cs.scads.storage.PartitionService, _2: edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])" class="delimiter">(</span><a href="#40041" title="edu.berkeley.cs.scads.storage.PartitionService">s</a>, <a href="#40041" title="edu.berkeley.cs.scads.storage.PartitionService">s</a> <span title="(body: edu.berkeley.cs.scads.storage.StorageMessage)edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">!!</span> <a href="../Messages.scala.html#23789" title="()edu.berkeley.cs.scads.storage.GetWorkloadStats">GetWorkloadStats</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>


    <a href="#39998" title="Seq[(Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])])]">futures</a>.<span title="(f: (Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])]) =&gt; Unit)Unit">foreach</span> <a href="#40145" title="Unit" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="Unit" class="delimiter">(</span><a title="Option[Array[Byte]]" id="40148">startKey</a>, <a title="Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])]" id="40149">replicas</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="Namespace.scala.html#27902" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;==%s==&quot;)" class="string">&quot;==%s==&quot;</span>, <a href="#40148" title="Option[Array[Byte]]">startKey</a>.<span title="(f: Array[Byte] =&gt; org.apache.avro.generic.IndexedRecord)Option[org.apache.avro.generic.IndexedRecord]">map</span><span class="delimiter">(</span><a href="Interfaces.scala.html#36270" title="(bytes: Array[Byte])org.apache.avro.generic.IndexedRecord">bytesToKey</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#40149" title="Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])]">replicas</a>.<span title="(f: (edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]) =&gt; (edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.storage.StorageMessage))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])],(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.storage.StorageMessage),Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.storage.StorageMessage)]])Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.storage.StorageMessage)]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.storage.StorageMessage),Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.storage.StorageMessage)]]" class="delimiter">(</span><a title="(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])" id="40176">f</a> =&gt; <span title="(_1: edu.berkeley.cs.scads.storage.PartitionService, _2: edu.berkeley.cs.scads.storage.StorageMessage)(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.storage.StorageMessage)" class="delimiter">(</span><a href="#40176" title="(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])">f</a>.<span title="=&gt; edu.berkeley.cs.scads.storage.PartitionService">_1</span>, <a href="#40176" title="(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])">f</a>.<span title="()edu.berkeley.cs.scads.storage.StorageMessage">_2</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: (edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.storage.StorageMessage) =&gt; Unit)Unit">foreach</span> <a href="#40229" title="Unit" class="delimiter">{</a>
          <span class="keyword">case</span> <span title="Unit" class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.PartitionService" id="40232">hander</a>, GetWorkloadStatsResponse<span class="delimiter">(</span><a title="Int" id="40233">getCount</a>, <a title="Int" id="40234">putCount</a>, _<span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="Namespace.scala.html#27902" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;%s: %d gets, %d puts&quot;)" class="string">&quot;%s: %d gets, %d puts&quot;</span>, <a href="#40232" title="edu.berkeley.cs.scads.storage.PartitionService">hander</a>, <a href="#40233" title="Int">getCount</a>, <a href="#40234" title="Int">putCount</a><span class="delimiter">)</span>
          <span class="keyword">case</span> <a title="Unit" id="40239">m</a> =&gt; <a href="Namespace.scala.html#27902" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Invalid message received for workload stats %s&quot;)" class="string">&quot;Invalid message received for workload stats %s&quot;</span>, <a href="#40239" title="(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.storage.StorageMessage)">m</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="Seq[(Int, Int)]" id="39999">values</a> =
      <a href="#39998" title="Seq[(Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])])]">futures</a>.<span title="(f: (Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])]) =&gt; scala.collection.GenTraversableOnce[(Int, Int)])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Option[Array[Byte]], Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])])],(Int, Int),Seq[(Int, Int)]])Seq[(Int, Int)]">flatMap</span> <a href="#40262" title="Seq[(Int, Int)]" class="delimiter">{</a>
        <span class="keyword">case</span> <span title="Seq[(Int, Int)]" class="delimiter">(</span><a title="Option[Array[Byte]]" id="40265">startKey</a>, <a title="Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])]" id="40266">replicas</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <a href="#40266" title="Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])]">replicas</a>.<span title="(f: (edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]) =&gt; (edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.storage.StorageMessage))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])],(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.storage.StorageMessage),Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.storage.StorageMessage)]])Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.storage.StorageMessage)]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.storage.StorageMessage),Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.storage.StorageMessage)]]" class="delimiter">(</span><a title="(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])" id="40283">f</a> =&gt; <span title="(_1: edu.berkeley.cs.scads.storage.PartitionService, _2: edu.berkeley.cs.scads.storage.StorageMessage)(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.storage.StorageMessage)" class="delimiter">(</span><a href="#40283" title="(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])">f</a>.<span title="=&gt; edu.berkeley.cs.scads.storage.PartitionService">_1</span>, <a href="#40283" title="(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])">f</a>.<span title="()edu.berkeley.cs.scads.storage.StorageMessage">_2</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: (edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.storage.StorageMessage) =&gt; (Int, Int))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.storage.StorageMessage)],(Int, Int),Seq[(Int, Int)]])Seq[(Int, Int)]">map</span> <a href="#40331" title="(Int, Int)" class="delimiter">{</a>
            <span class="keyword">case</span> <span title="(Int, Int)" class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.PartitionService" id="40334">hander</a>, GetWorkloadStatsResponse<span class="delimiter">(</span><a title="Int" id="40335">x</a>, <a title="Int" id="40336">y</a>, _<span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span title="(_1: Int, _2: Int)(Int, Int)" class="delimiter">(</span><a href="#40335" title="Int">x</a>, <a href="#40336" title="Int">y</a><span class="delimiter">)</span>
            <span class="keyword">case</span> <a title="(Int, Int)" id="40343">m</a> =&gt; <span class="delimiter">{</span>
              <a href="Namespace.scala.html#27902" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Invalid message received for workload stats %s&quot;)" class="string">&quot;Invalid message received for workload stats %s&quot;</span>, <a href="#40343" title="(edu.berkeley.cs.scads.storage.PartitionService, edu.berkeley.cs.scads.storage.StorageMessage)">m</a><span class="delimiter">)</span>
              <span title="(_1: Int, _2: Int)(Int, Int)" class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <a href="Namespace.scala.html#27902" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;getDiff: %d, putDiff: %d\012&quot;)" class="string">&quot;getDiff: %d, putDiff: %d\n&quot;</span>, <a href="#39999" title="Seq[(Int, Int)]">values</a>.<span title="(f: (Int, Int) =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Int, Int)],Int,Seq[Int]])Seq[Int]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Int,Seq[Int]]" class="delimiter">(</span><a href="#40418" title="(Int, Int)">_</a>.<span title="=&gt; Int">_1</span><span class="delimiter">)</span>.<span title="(implicit cmp: Ordering[Int])Int">max</span> <span title="(x: Int)Int">-</span> <a href="#39999" title="Seq[(Int, Int)]">values</a>.<span title="(f: (Int, Int) =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Int, Int)],Int,Seq[Int]])Seq[Int]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Int,Seq[Int]]" class="delimiter">(</span><a href="#40522" title="(Int, Int)">_</a>.<span title="=&gt; Int">_1</span><span class="delimiter">)</span>.<span title="(implicit cmp: Ordering[Int])Int">min</span>, <a href="#39999" title="Seq[(Int, Int)]">values</a>.<span title="(f: (Int, Int) =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Int, Int)],Int,Seq[Int]])Seq[Int]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Int,Seq[Int]]" class="delimiter">(</span><a href="#40616" title="(Int, Int)">_</a>.<span title="=&gt; Int">_2</span><span class="delimiter">)</span>.<span title="(implicit cmp: Ordering[Int])Int">max</span> <span title="(x: Int)Int">-</span> <a href="#39999" title="Seq[(Int, Int)]">values</a>.<span title="(f: (Int, Int) =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Int, Int)],Int,Seq[Int]])Seq[Int]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Int,Seq[Int]]" class="delimiter">(</span><a href="#40714" title="(Int, Int)">_</a>.<span title="=&gt; Int">_2</span><span class="delimiter">)</span>.<span title="(implicit cmp: Ordering[Int])Int">min</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">//HACK</span>
  <span class="keyword">def</span> <a title="=&gt; Unit" id="38121">rebalance</a>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.storage.RangeDesc]" id="40800">partitions</a> = <a href="Interfaces.scala.html#27961" title="(start: Option[Array[Byte]], end: Option[Array[Byte]])Seq[edu.berkeley.cs.scads.storage.RangeDesc]">serversForKeyRange</a><span class="delimiter">(</span><span title="object None">None</span>, <span title="object None">None</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Seq[(Int, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]" id="40801">distribution</a> = <a href="../util/ParFuture.scala.html#27956" title="(futures: Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))], timeout: Long)(f: PartialFunction[(edu.berkeley.cs.scads.storage.StorageMessage, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])),(Int, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))])Seq[(Int, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]">waitForAndThrowException</a><span class="delimiter">(</span><a href="#40800" title="Seq[edu.berkeley.cs.scads.storage.RangeDesc]">partitions</a>.<span title="(f: edu.berkeley.cs.scads.storage.RangeDesc =&gt; scala.collection.GenTraversableOnce[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.storage.RangeDesc],(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])),Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]])Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]">flatMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])),Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.RangeDesc" id="40851">p</a> =&gt; <a href="#40851" title="edu.berkeley.cs.scads.storage.RangeDesc">p</a>.<a href="Interfaces.scala.html#31379" title="=&gt; Seq[edu.berkeley.cs.scads.storage.PartitionService]">servers</a>.<span title="(f: edu.berkeley.cs.scads.storage.PartitionService =&gt; (edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.storage.PartitionService],(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])),Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]])Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])),Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.PartitionService" id="40868">s</a> =&gt; <span title="(_1: edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], _2: (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))" class="delimiter">(</span><a href="#40868" title="edu.berkeley.cs.scads.storage.PartitionService">s</a> <span title="(body: edu.berkeley.cs.scads.storage.StorageMessage)edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">!!</span> <a href="../Messages.scala.html#23515" title="(minKey: Option[Array[Byte]], maxKey: Option[Array[Byte]])edu.berkeley.cs.scads.storage.CountRangeRequest">CountRangeRequest</a><span class="delimiter">(</span><a href="#40851" title="edu.berkeley.cs.scads.storage.RangeDesc">p</a>.<a href="Interfaces.scala.html#31375" title="=&gt; Option[Array[Byte]]">startKey</a>, <a href="#40851" title="edu.berkeley.cs.scads.storage.RangeDesc">p</a>.<a href="Interfaces.scala.html#31377" title="=&gt; Option[Array[Byte]]">endKey</a><span class="delimiter">)</span>, <span title="(_1: edu.berkeley.cs.scads.storage.PartitionService, _2: Option[org.apache.avro.generic.IndexedRecord], _3: Option[org.apache.avro.generic.IndexedRecord])(edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])" class="delimiter">(</span><a href="#40868" title="edu.berkeley.cs.scads.storage.PartitionService">s</a>, <a href="#40851" title="edu.berkeley.cs.scads.storage.RangeDesc">p</a>.<a href="Interfaces.scala.html#31375" title="=&gt; Option[Array[Byte]]">startKey</a>.<span title="(f: Array[Byte] =&gt; org.apache.avro.generic.IndexedRecord)Option[org.apache.avro.generic.IndexedRecord]">map</span><span class="delimiter">(</span><a href="Interfaces.scala.html#36270" title="(bytes: Array[Byte])org.apache.avro.generic.IndexedRecord">bytesToKey</a><span class="delimiter">)</span>, <a href="#40851" title="edu.berkeley.cs.scads.storage.RangeDesc">p</a>.<a href="Interfaces.scala.html#31377" title="=&gt; Option[Array[Byte]]">endKey</a>.<span title="(f: Array[Byte] =&gt; org.apache.avro.generic.IndexedRecord)Option[org.apache.avro.generic.IndexedRecord]">map</span><span class="delimiter">(</span><a href="Interfaces.scala.html#36270" title="(bytes: Array[Byte])org.apache.avro.generic.IndexedRecord">bytesToKey</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#40954" title="(Int, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="(Int, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))" class="delimiter">(</span>CountRangeResponse<span class="delimiter">(</span><a title="Int" id="40957">c</a><span class="delimiter">)</span>, <a title="(edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])" id="40958">p</a><span class="delimiter">)</span> =&gt; <span title="(_1: Int, _2: (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))(Int, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))" class="delimiter">(</span><a href="#40957" title="Int">c</a>, <a href="#40958" title="(edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])">p</a><span class="delimiter">)</span> <span class="delimiter">}</span>
    <a href="Namespace.scala.html#27902" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;==distribution==&quot;)" class="string">&quot;==distribution==&quot;</span><span class="delimiter">)</span>
    <a href="#40801" title="Seq[(Int, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]">distribution</a>.<span title="(f: (Int, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])) =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="Namespace.scala.html#27902" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;%s: %s&quot;)" class="string">&quot;%s: %s&quot;</span>, <a href="Namespace.scala.html#27900" title="=&gt; String">namespace</a>, <a href="#40985" title="(Int, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Seq[(Int, Int, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]" id="40802">workload</a> = <a href="../util/ParFuture.scala.html#27956" title="(futures: Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))], timeout: Long)(f: PartialFunction[(edu.berkeley.cs.scads.storage.StorageMessage, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])),(Int, Int, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))])Seq[(Int, Int, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]">waitForAndThrowException</a><span class="delimiter">(</span><a href="#40800" title="Seq[edu.berkeley.cs.scads.storage.RangeDesc]">partitions</a>.<span title="(f: edu.berkeley.cs.scads.storage.RangeDesc =&gt; scala.collection.GenTraversableOnce[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.storage.RangeDesc],(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])),Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]])Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]">flatMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])),Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.RangeDesc" id="41007">p</a> =&gt; <a href="#41007" title="edu.berkeley.cs.scads.storage.RangeDesc">p</a>.<a href="Interfaces.scala.html#31379" title="=&gt; Seq[edu.berkeley.cs.scads.storage.PartitionService]">servers</a>.<span title="(f: edu.berkeley.cs.scads.storage.PartitionService =&gt; (edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.storage.PartitionService],(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])),Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]])Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])),Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.PartitionService" id="41024">s</a> =&gt; <span title="(_1: edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], _2: (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))" class="delimiter">(</span><a href="#41024" title="edu.berkeley.cs.scads.storage.PartitionService">s</a> <span title="(body: edu.berkeley.cs.scads.storage.StorageMessage)edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">!!</span> <a href="../Messages.scala.html#23789" title="()edu.berkeley.cs.scads.storage.GetWorkloadStats">GetWorkloadStats</a><span class="delimiter">(</span><span class="delimiter">)</span>, <span title="(_1: edu.berkeley.cs.scads.storage.PartitionService, _2: Option[org.apache.avro.generic.IndexedRecord], _3: Option[org.apache.avro.generic.IndexedRecord])(edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])" class="delimiter">(</span><a href="#41024" title="edu.berkeley.cs.scads.storage.PartitionService">s</a>, <a href="#41007" title="edu.berkeley.cs.scads.storage.RangeDesc">p</a>.<a href="Interfaces.scala.html#31375" title="=&gt; Option[Array[Byte]]">startKey</a>.<span title="(f: Array[Byte] =&gt; org.apache.avro.generic.IndexedRecord)Option[org.apache.avro.generic.IndexedRecord]">map</span><span class="delimiter">(</span><a href="Interfaces.scala.html#36270" title="(bytes: Array[Byte])org.apache.avro.generic.IndexedRecord">bytesToKey</a><span class="delimiter">)</span>, <a href="#41007" title="edu.berkeley.cs.scads.storage.RangeDesc">p</a>.<a href="Interfaces.scala.html#31377" title="=&gt; Option[Array[Byte]]">endKey</a>.<span title="(f: Array[Byte] =&gt; org.apache.avro.generic.IndexedRecord)Option[org.apache.avro.generic.IndexedRecord]">map</span><span class="delimiter">(</span><a href="Interfaces.scala.html#36270" title="(bytes: Array[Byte])org.apache.avro.generic.IndexedRecord">bytesToKey</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#41107" title="(Int, Int, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="(Int, Int, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))" class="delimiter">(</span>GetWorkloadStatsResponse<span class="delimiter">(</span><a title="Int" id="41110">gets</a>, <a title="Int" id="41111">puts</a>, _<span class="delimiter">)</span>, <a title="(edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])" id="41112">p</a><span class="delimiter">)</span> =&gt; <span title="(_1: Int, _2: Int, _3: (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))(Int, Int, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))" class="delimiter">(</span><a href="#41110" title="Int">gets</a>, <a href="#41111" title="Int">puts</a>, <a href="#41112" title="(edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])">p</a><span class="delimiter">)</span> <span class="delimiter">}</span>
    <a href="Namespace.scala.html#27902" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;==workload==&quot;)" class="string">&quot;==workload==&quot;</span><span class="delimiter">)</span>
    <a href="#40802" title="Seq[(Int, Int, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]">workload</a>.<span title="(f: (Int, Int, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])) =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="Namespace.scala.html#27902" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;%s: %s&quot;)" class="string">&quot;%s: %s&quot;</span>, <a href="Namespace.scala.html#27900" title="=&gt; String">namespace</a>, <a href="#41142" title="(Int, Int, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Seq[Int]" id="40803">counts</a> = <a href="#40801" title="Seq[(Int, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))]">distribution</a>.<span title="(f: (Int, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord])) =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Int, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))],Int,Seq[Int]])Seq[Int]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Int,Seq[Int]]" class="delimiter">(</span><a href="#41164" title="(Int, (edu.berkeley.cs.scads.storage.PartitionService, Option[org.apache.avro.generic.IndexedRecord], Option[org.apache.avro.generic.IndexedRecord]))">_</a>.<span title="=&gt; Int">_1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="40804">total</a> = <a href="#40803" title="Seq[Int]">counts</a>.<span title="(implicit num: Numeric[Int])Int">sum</span>
    <span class="keyword">val</span> <a title="Int" id="40805">desiredKeysPerServer</a> = <a href="#40804" title="Int">total</a> <span title="(x: Int)Int">/</span> <a href="#40800" title="Seq[edu.berkeley.cs.scads.storage.RangeDesc]">partitions</a>.<span title="=&gt; Int">size</span>
    <a href="Namespace.scala.html#27902" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;%s: desiredKeysPerServer: %d&quot;)" class="string">&quot;%s: desiredKeysPerServer: %d&quot;</span>, <a href="Namespace.scala.html#27900" title="=&gt; String">namespace</a>, <a href="#40805" title="Int">desiredKeysPerServer</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>