<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>util/ParFuture.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs.scads
<span class="keyword">package</span> storage

<span class="keyword">import</span> edu.berkeley.cs.scads.comm._


<span class="keyword">import</span> java.util.concurrent.TimeUnit

<span class="comment">/**
 * Simple helper trait for parallel future handling
 */</span>
<span class="keyword">trait</span> <a title="trait ParFuture extends java.lang.Object with ScalaObject" id="10128">ParFuture</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="comment">/**
   * Blocks until each future in futures has been collected. Upon collection,
   * the result of the future is applied to f, and the results are collected
   * and returned.
   */</span>
  <span class="keyword">def</span> <a title="[Data, T](futures: Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], Data)], timeout: Long)(f: PartialFunction[(edu.berkeley.cs.scads.storage.StorageMessage, Data),T])Seq[Either[Throwable,T]]" id="27951">waitFor</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="60222">Data</a>, <a title="&gt;: Nothing &lt;: Any" id="60223">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], Data)]" id="60046">futures</a>: <span title="Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], Data)]">Seq</span><span class="delimiter">[</span><span class="delimiter">(</span>MessageFuture<span class="delimiter">[</span>StorageMessage<span class="delimiter">]</span>, Data<span class="delimiter">)</span><span class="delimiter">]</span>, <a title="Long" id="60219">timeout</a>: <span title="Long">Long</span> = <span title="Long(15000L)" class="int">15000</span><span class="delimiter">)</span>
                      <span class="delimiter">(</span><a title="PartialFunction[(edu.berkeley.cs.scads.storage.StorageMessage, Data),T]" id="60048">f</a>: <span title="PartialFunction[(edu.berkeley.cs.scads.storage.StorageMessage, Data),T]">PartialFunction</span><span class="delimiter">[</span><span class="delimiter">(</span>StorageMessage, Data<span class="delimiter">)</span>, T<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Seq[Either[Throwable,T]]">Seq</span><span class="delimiter">[</span>Either<span class="delimiter">[</span>Throwable, T<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(elem: (edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], Data))Either[Throwable,(edu.berkeley.cs.scads.storage.StorageMessage, Data)]" id="86954">trapException</a><span class="delimiter">(</span><a title="(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], Data)" id="86955">elem</a>: <span title="(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], Data)" class="delimiter">(</span>MessageFuture<span class="delimiter">[</span>StorageMessage<span class="delimiter">]</span>, Data<span class="delimiter">)</span><span class="delimiter">)</span>: <span title="Either[Throwable,(edu.berkeley.cs.scads.storage.StorageMessage, Data)]">Either</span><span class="delimiter">[</span>Throwable, <span class="delimiter">(</span>StorageMessage, Data<span class="delimiter">)</span><span class="delimiter">]</span> =
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#86955" title="(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], Data)">elem</a>.<span title="=&gt; edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">_1</span>
          .<span title="(timeout: Long, unit: java.util.concurrent.TimeUnit)Option[edu.berkeley.cs.scads.storage.StorageMessage]">get</span><span class="delimiter">(</span><a href="#60219" title="Long">timeout</a>, TimeUnit.<span title="java.util.concurrent.TimeUnit(value MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>
          .<span title="(f: edu.berkeley.cs.scads.storage.StorageMessage =&gt; Right[Nothing,(edu.berkeley.cs.scads.storage.StorageMessage, Data)])Option[Right[Nothing,(edu.berkeley.cs.scads.storage.StorageMessage, Data)]]">map</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.StorageMessage" id="86963">e</a> =&gt; <span title="(b: (edu.berkeley.cs.scads.storage.StorageMessage, Data))Right[Nothing,(edu.berkeley.cs.scads.storage.StorageMessage, Data)]">Right</span><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.storage.StorageMessage, _2: Data)(edu.berkeley.cs.scads.storage.StorageMessage, Data)" class="delimiter">(</span><a href="#86963" title="edu.berkeley.cs.scads.storage.StorageMessage">e</a>, <a href="#86955" title="(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], Data)">elem</a>.<span title="=&gt; Data">_2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          .<span title="(default: =&gt; Product with Serializable with Either[java.lang.RuntimeException,(edu.berkeley.cs.scads.storage.StorageMessage, Data)])Product with Serializable with Either[java.lang.RuntimeException,(edu.berkeley.cs.scads.storage.StorageMessage, Data)]">getOrElse</span><span class="delimiter">(</span><span title="(a: java.lang.RuntimeException)Left[java.lang.RuntimeException,Nothing]">Left</span><span class="delimiter">(</span><span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;TIMEOUT&quot;)" class="string">&quot;TIMEOUT&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Left[java.lang.Throwable,Nothing]" id="87072">e</a> =&gt; <span title="(a: java.lang.Throwable)Left[java.lang.Throwable,Nothing]">Left</span><span class="delimiter">(</span><a href="#87072" title="java.lang.Throwable">e</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <a href="#60046" title="Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], Data)]">futures</a>.<span title="(f: (edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], Data) =&gt; Product with Serializable with Either[Throwable,T])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], Data)],Product with Serializable with Either[Throwable,T],Seq[Either[Throwable,T]]])Seq[Either[Throwable,T]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Product with Serializable with Either[Throwable,T],Seq[Product with Serializable with Either[Throwable,T]]]" class="delimiter">(</span><a title="(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], Data)" id="87102">ftch</a> =&gt;
      <a href="#86954" title="(elem: (edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], Data))Either[Throwable,(edu.berkeley.cs.scads.storage.StorageMessage, Data)]">trapException</a><span class="delimiter">(</span><a href="#87102" title="(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], Data)">ftch</a><span class="delimiter">)</span>.<span title="(fa: Throwable =&gt; Product with Serializable with Either[Throwable,T], fb: (edu.berkeley.cs.scads.storage.StorageMessage, Data) =&gt; Product with Serializable with Either[Throwable,T])Product with Serializable with Either[Throwable,T]">fold</span><span class="delimiter">(</span>
        <a title="Throwable" id="87109">ex</a> =&gt; <span title="(a: Throwable)Left[Throwable,Nothing]">Left</span><span class="delimiter">(</span><a href="#87109" title="Throwable">ex</a><span class="delimiter">)</span>,
        <a title="(edu.berkeley.cs.scads.storage.StorageMessage, Data)" id="87115">msg</a> =&gt; <a href="#60048" title="PartialFunction[(edu.berkeley.cs.scads.storage.StorageMessage, Data),T]">f</a>.<span title="(v1: (edu.berkeley.cs.scads.storage.StorageMessage, Data))Option[T]">lift</span><span class="delimiter">(</span><a href="#87115" title="(edu.berkeley.cs.scads.storage.StorageMessage, Data)">msg</a><span class="delimiter">)</span>.<span title="(f: T =&gt; Right[Nothing,T])Option[Right[Nothing,T]]">map</span><span class="delimiter">(</span><span title="(b: T)Right[Nothing,T]">Right</span><span class="delimiter">(</span><a href="#87121" title="T">_</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(default: =&gt; Product with Serializable with Either[java.lang.RuntimeException,T])Product with Serializable with Either[java.lang.RuntimeException,T]">getOrElse</span><span class="delimiter">(</span><span title="(a: java.lang.RuntimeException)Left[java.lang.RuntimeException,Nothing]">Left</span><span class="delimiter">(</span><span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Unexpected message received: &quot;)" class="string">&quot;Unexpected message received: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#87115" title="(edu.berkeley.cs.scads.storage.StorageMessage, Data)">msg</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>


  <span class="keyword">def</span> <a title="[Data, T](futures: Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], Data)], timeout: Long)(f: PartialFunction[(edu.berkeley.cs.scads.storage.StorageMessage, Data),T])Seq[T]" id="27956">waitForAndThrowException</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="40813">Data</a>, <a title="&gt;: Nothing &lt;: Any" id="40814">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], Data)]" id="40806">futures</a>: <span title="Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], Data)]">Seq</span><span class="delimiter">[</span><span class="delimiter">(</span>MessageFuture<span class="delimiter">[</span>StorageMessage<span class="delimiter">]</span>, Data<span class="delimiter">)</span><span class="delimiter">]</span>, <a title="Long" id="40810">timeout</a>: <span title="Long">Long</span> = <span title="Long(15000L)" class="int">15000</span><span class="delimiter">)</span>
                                       <span class="delimiter">(</span><a title="PartialFunction[(edu.berkeley.cs.scads.storage.StorageMessage, Data),T]" id="40808">f</a>: <span title="PartialFunction[(edu.berkeley.cs.scads.storage.StorageMessage, Data),T]">PartialFunction</span><span class="delimiter">[</span><span class="delimiter">(</span>StorageMessage, Data<span class="delimiter">)</span>, T<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Seq[T]">Seq</span><span class="delimiter">[</span>T<span class="delimiter">]</span> =
    <a href="#27951" title="(futures: Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], Data)], timeout: Long)(f: PartialFunction[(edu.berkeley.cs.scads.storage.StorageMessage, Data),T])Seq[Either[Throwable,T]]">waitFor</a><span class="delimiter">(</span><a href="#40806" title="Seq[(edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage], Data)]">futures</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#40808" title="PartialFunction[(edu.berkeley.cs.scads.storage.StorageMessage, Data),T]">f</a><span class="delimiter">)</span>.<span title="(f: Either[Throwable,T] =&gt; T)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[Either[Throwable,T]],T,Seq[T]])Seq[T]">map</span> <a href="#87248" title="T" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="Nothing">Left</span><span class="delimiter">(</span><a title="Throwable" id="87250">ex</a><span class="delimiter">)</span> =&gt; <span title="Nothing" class="keyword">throw</span> <a href="#87250" title="Throwable">ex</a>
      <span class="keyword">case</span> <span title="T">Right</span><span class="delimiter">(</span><a title="T" id="87252">t</a><span class="delimiter">)</span> =&gt; <a href="#87252" title="T">t</a>
    <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>