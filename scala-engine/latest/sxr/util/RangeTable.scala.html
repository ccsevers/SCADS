<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>util/RangeTable.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs.scads.util

<span class="keyword">import</span> java.util.<span class="delimiter">{</span>Comparator, Arrays<span class="delimiter">}</span>
<span class="keyword">import</span> net.lag.logging.Logger

<span class="comment">/**
 * Range Table data structure. Allows to split the range -inf to inf in arbitrary sub-ranges and assign values per sub-range.
 * The operations are thread-safe
 *
 * Constructor assigns values to the range -inf to inf. This range can than be split by split(key). Keys are compared with the given
 * comparator
 *
 * TODO RangeTable should be fully immutable (also for adding values). Makes programming the protocols easier
 */</span>
<span class="keyword">class</span> <a title="class RangeTable[KeyType, ValueType] extends java.lang.Object with ScalaObject" id="9980">RangeTable</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="9981">KeyType</a>, <a title="&gt;: Nothing &lt;: Any" id="9982">ValueType</a><span class="delimiter">]</span><a href="#9980" title="ScalaObject" class="delimiter">(</a>
        <span class="keyword">val</span> <a title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="40019">rTable</a>: <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Array</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span>,
        <span class="keyword">val</span> <a title="java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="40020">keyComparator</a>: <span title="java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Comparator</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span>,
        <span class="keyword">val</span> <a title="(Seq[ValueType], Seq[ValueType]) =&gt; Boolean" id="40021">mergeCondition</a>: <span class="delimiter">(</span>Seq<span class="delimiter">[</span>ValueType<span class="delimiter">]</span>, Seq<span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span> =&gt; Boolean<span class="delimiter">)</span> <span class="delimiter">{</span>
  <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#40019" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span> , <span title="java.lang.String(&quot;At least the startKey (None) has to exist at any time&quot;)" class="string">&quot;At least the startKey (None) has to exist at any time&quot;</span><span class="delimiter">)</span>
  <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#40019" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">head</span>.<a href="#96306" title="=&gt; Option[KeyType]">startKey</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="object None">None</span>, <span title="java.lang.String(&quot;First key has to be None, but was &quot;)" class="string">&quot;First key has to be None, but was &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#40019" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">head</span>.<a href="#96306" title="=&gt; Option[KeyType]">startKey</a> <span class="delimiter">)</span>

  <span class="keyword">protected</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="38463">logger</a> = <span title="()net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">/**
   *  Helper constructor for creating the Comparator
   */</span>
  <span class="keyword">def</span> <a title="(rTable: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]], keyComp: (KeyType, KeyType) =&gt; Int, mergeCondition: (Seq[ValueType], Seq[ValueType]) =&gt; Boolean)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="38464" class="keyword">this</a><span class="delimiter">(</span><a title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="40013">rTable</a>: <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Array</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span>,
           <a title="(KeyType, KeyType) =&gt; Int" id="40014">keyComp</a>: <span class="delimiter">(</span>KeyType, KeyType<span class="delimiter">)</span> =&gt; Int,
           <a title="(Seq[ValueType], Seq[ValueType]) =&gt; Boolean" id="40015">mergeCondition</a>: <span class="delimiter">(</span>Seq<span class="delimiter">[</span>ValueType<span class="delimiter">]</span>, Seq<span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span> =&gt; Boolean<span class="delimiter">)</span> = <span title="Unit" class="delimiter">{</span>
    <a href="#9980" title="RangeTable.this.type" class="keyword">this</a> <span class="delimiter">(</span><a href="#40013" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>,
      <a href="#93873" title="java.lang.Object with java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="93873">Comparator</a><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">def</span> <a title="(a: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType], b: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])Int" id="93875">compare</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="93876">a</a>: <a href="#96313" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span>, <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="93877">b</a>: <a href="#96313" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
          <span title="(_1: Option[KeyType], _2: Option[KeyType])(Option[KeyType], Option[KeyType])" class="delimiter">(</span><a href="#93876" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">a</a>.<a href="#96306" title="=&gt; Option[KeyType]">startKey</a>, <a href="#93877" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">b</a>.<a href="#96306" title="=&gt; Option[KeyType]">startKey</a><span class="delimiter">)</span> <span title="Int" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="Int(0)" class="delimiter">(</span><span title="object None">None</span>, <span title="object None">None</span><span class="delimiter">)</span> =&gt; <span title="Int(0)" class="int">0</span>
            <span class="keyword">case</span> <span title="Int(-1)" class="delimiter">(</span><span title="object None">None</span>, _<span class="delimiter">)</span> =&gt; -<span title="Int(-1)" class="int">1</span>
            <span class="keyword">case</span> <span title="Int(1)" class="delimiter">(</span>_, <span title="object None">None</span><span class="delimiter">)</span> =&gt; <span title="Int(1)" class="int">1</span>
            <span class="keyword">case</span> <span title="Int" class="delimiter">(</span>Some<span class="delimiter">(</span><a title="KeyType" id="93898">a</a><span class="delimiter">)</span>, Some<span class="delimiter">(</span><a title="KeyType" id="93900">b</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#40014" title="(v1: KeyType, v2: KeyType)Int">keyComp</a><span class="delimiter">(</span><a href="#93898" title="KeyType">a</a>, <a href="#93900" title="KeyType">b</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>,
      <a href="#40015" title="(Seq[ValueType], Seq[ValueType]) =&gt; Boolean">mergeCondition</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Creates a new RangeTable from a Simple Seq
   */</span>
  <span class="keyword">def</span> <a title="(initRanges: Seq[(Option[KeyType], Seq[ValueType])], keyComp: (KeyType, KeyType) =&gt; Int, mergeCondition: (Seq[ValueType], Seq[ValueType]) =&gt; Boolean)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="38465" class="keyword">this</a><span class="delimiter">(</span><a title="Seq[(Option[KeyType], Seq[ValueType])]" id="40007">initRanges</a>: <span title="Seq[(Option[KeyType], Seq[ValueType])]">Seq</span><span class="delimiter">[</span><span class="delimiter">(</span>Option<span class="delimiter">[</span>KeyType<span class="delimiter">]</span>, Seq<span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">]</span>,
           <a title="(KeyType, KeyType) =&gt; Int" id="40008">keyComp</a>: <span class="delimiter">(</span>KeyType, KeyType<span class="delimiter">)</span> =&gt; Int,
           <a title="(Seq[ValueType], Seq[ValueType]) =&gt; Boolean" id="40009">mergeCondition</a>: <span class="delimiter">(</span>Seq<span class="delimiter">[</span>ValueType<span class="delimiter">]</span>, Seq<span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span> =&gt; Boolean<span class="delimiter">)</span> =
    <a href="#38464" title="(rTable: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]], keyComp: (KeyType, KeyType) =&gt; Int, mergeCondition: (Seq[ValueType], Seq[ValueType]) =&gt; Boolean)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">this</a> <span class="delimiter">(</span><a href="#40007" title="Seq[(Option[KeyType], Seq[ValueType])]">initRanges</a>.<span title="(f: (Option[KeyType], Seq[ValueType]) =&gt; edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Option[KeyType], Seq[ValueType])],edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType],Seq[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]])Seq[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType],Seq[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]]" class="delimiter">(</span><a title="(Option[KeyType], Seq[ValueType])" id="93928">item</a> =&gt; <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#96313" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><a href="#93928" title="(Option[KeyType], Seq[ValueType])">item</a>.<span title="=&gt; Option[KeyType]">_1</span>, <a href="#93928" title="(Option[KeyType], Seq[ValueType])">item</a>.<span title="=&gt; Seq[ValueType]">_2</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(implicit evidence$1: ClassManifest[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">toArray</span>, <a href="#40008" title="(KeyType, KeyType) =&gt; Int">keyComp</a>, <a href="#40009" title="(Seq[ValueType], Seq[ValueType]) =&gt; Boolean">mergeCondition</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Helper case class to return all ranges (left, center, right) for a given key
   */</span>
  case <span class="keyword">class</span> <a title="class RangeBound extends java.lang.Object with ScalaObject with Product with Serializable" id="94011">RangeBound</a><a href="#94011" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="94194">left</a>: <a href="#96313" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="94195">center</a>: <a href="#96313" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="94196">right</a>: <a href="#96313" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">)</span>


  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(key: KeyType)Int" id="38469">binarySearch</a><span class="delimiter">(</span><a title="KeyType" id="94062">key</a>: <a href="#9981" title="KeyType">KeyType</a><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <a href="#38470" title="(key: Option[KeyType])Int">binarySearch</a><span class="delimiter">(</span><span title="(x: KeyType)Some[KeyType]">Some</span><span class="delimiter">(</span><a href="#94062" title="KeyType">key</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>


  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(key: Option[KeyType])Int" id="38470">binarySearch</a><span class="delimiter">(</span><a title="Option[KeyType]" id="94068">key</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="94075">pKey</a> = <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#96313" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><a href="#94068" title="Option[KeyType]">key</a>, <span title="object Nil">Nil</span><span class="delimiter">)</span>
    <span title="object java.util.Arrays">Arrays</span>.<span title="(x$1: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType] with java.lang.Object], x$2: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType], x$3: java.util.Comparator[_ &gt;: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])Int">binarySearch</span><span class="delimiter">(</span><a href="#40019" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>, <a href="#94075" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">pKey</a>, <a href="#40020" title="=&gt; java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">keyComparator</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * If the key is inside the range binarysearch returns a neg. value. This calc corrects it.
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(idx: Int)Int" id="38471">calcMidIdx</a><span class="delimiter">(</span><a title="Int" id="94121">idx</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">(</span><a href="#94121" title="Int">idx</a> <span title="(x: Int)Int">*</span> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <span title="(x: Int)Int">-</span> <span title="Int(2)" class="int">2</span>

  <span class="comment">/**
   * Returns the idx for the corresponding range
   */</span>
  <span class="keyword">def</span> <a title="(key: Option[KeyType])Int" id="38472">idxForKey</a><span class="delimiter">(</span><a title="Option[KeyType]" id="94131">key</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="94133">bpos</a> = <a href="#38470" title="(key: Option[KeyType])Int">binarySearch</a><span class="delimiter">(</span><a href="#94131" title="Option[KeyType]">key</a><span class="delimiter">)</span>

    <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#94133" title="Int">bpos</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="comment">//nb is in range. This is the most common case, should be placed first</span>
      <a href="#38471" title="(idx: Int)Int">calcMidIdx</a><span class="delimiter">(</span><a href="#94133" title="Int">bpos</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#94133" title="Int">bpos</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#40019" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
      <a href="#94133" title="Int">bpos</a>
    <span class="keyword">else</span>
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;A key always has to belong to a range. Probably the given comparison function is incorrect.&quot;)" class="string">&quot;A key always has to belong to a range. Probably the given comparison function is incorrect.&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Returns the list of values which are attached to the range for the given key
   */</span>
  <span class="keyword">def</span> <a title="(key: KeyType)Seq[ValueType]" id="38473">valuesForKey</a><span class="delimiter">(</span><a title="KeyType" id="56829">key</a>: <a href="#9981" title="KeyType">KeyType</a><span class="delimiter">)</span>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span> = <a href="#38474" title="(key: Option[KeyType])Seq[ValueType]">valuesForKey</a><span class="delimiter">(</span><span title="(x: KeyType)Option[KeyType]">Option</span><span class="delimiter">(</span><a href="#56829" title="KeyType">key</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Returns all values attached to the range for the given key
   */</span>
  <span class="keyword">def</span> <a title="(key: Option[KeyType])Seq[ValueType]" id="38474">valuesForKey</a><span class="delimiter">(</span><a title="Option[KeyType]" id="56826">key</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#40019" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#38472" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#56826" title="Option[KeyType]">key</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="#96307" title="=&gt; Seq[ValueType]">values</a>
  <span class="delimiter">}</span>


  <span class="comment">/**
   * Returns the surrounding ranges for a key
   * If the value is in the most left range starting with None, the left and center range will be the same
   * Warning: Right ranges can be just a placeholder for None with an empty set of servers
   *
   */</span>
  <span class="keyword">def</span> <a title="(key: KeyType)RangeTable.this.RangeBound" id="38475">lowerUpperBound</a><span class="delimiter">(</span><a title="KeyType" id="57912">key</a> : <a href="#9981" title="KeyType">KeyType</a><span class="delimiter">)</span> : <a href="#94011" title="RangeTable.this.RangeBound">RangeBound</a> = <a href="#38476" title="(startKey: Option[KeyType])RangeTable.this.RangeBound">lowerUpperBound</a><span class="delimiter">(</span><span title="(x: KeyType)Some[KeyType]">Some</span><span class="delimiter">(</span><a href="#57912" title="KeyType">key</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(startKey: Option[KeyType])RangeTable.this.RangeBound" id="38476">lowerUpperBound</a><span class="delimiter">(</span><a title="Option[KeyType]" id="57907">startKey</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#94011" title="RangeTable.this.RangeBound">RangeBound</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="94170">idx</a> = <a href="#38472" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#57907" title="Option[KeyType]">startKey</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="94171">lowerBound</a> = <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">if</span> <span class="delimiter">(</span><a href="#94170" title="Int">idx</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#40019" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#40019" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#94170" title="Int">idx</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="94172">upperBound</a> = <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">if</span> <span class="delimiter">(</span><a href="#94170" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span> <span title="(x: Int)Boolean">==</span> <a href="#40019" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#96313" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><span title="object None">None</span>, <span title="object Nil">Nil</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#40019" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#94170" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <a href="#94011" title="(left: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType], center: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType], right: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])RangeTable.this.RangeBound">RangeBound</a><span class="delimiter">(</span><a href="#94171" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">lowerBound</a>, <a href="#40019" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#94170" title="Int">idx</a><span class="delimiter">)</span>, <a href="#94172" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">upperBound</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(key: KeyType)Boolean" id="38477">isSplitKey</a><span class="delimiter">(</span><a title="KeyType" id="57902">key</a>: <a href="#9981" title="KeyType">KeyType</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="94204">bpos</a> = <a href="#38469" title="(key: KeyType)Int">binarySearch</a><span class="delimiter">(</span><a href="#57902" title="KeyType">key</a><span class="delimiter">)</span>
    <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#94204" title="Int">bpos</a> <span title="(x: Int)Boolean">==</span> <a href="#40019" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
      <span title="Boolean(false)" class="keyword">false</span>
    <span class="keyword">else</span> <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#94204" title="Int">bpos</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">else</span>
      <span title="Boolean(false)" class="keyword">false</span>
  <span class="delimiter">}</span>


  <span class="comment">/**
   * Returns all ranges from startKey to endKey
   */</span>
  <span class="keyword">def</span> <a title="(startKey: Option[KeyType], endKey: Option[KeyType])Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="38478">valuesForRange</a><span class="delimiter">(</span><a title="Option[KeyType]" id="59784">startKey</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span>, <a title="Option[KeyType]" id="59785">endKey</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Array</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="(_1: Option[KeyType], _2: Option[KeyType])(Option[KeyType], Option[KeyType])" class="delimiter">(</span><a href="#59784" title="Option[KeyType]">startKey</a>, <a href="#59785" title="Option[KeyType]">endKey</a><span class="delimiter">)</span> <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Nothing" class="delimiter">(</span><span title="object None">None</span>, <span title="object None">None</span><span class="delimiter">)</span> =&gt; <span title="Nothing" class="keyword">return</span> <a href="#40019" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>
      <span class="keyword">case</span> <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" class="delimiter">(</span><span title="object None">None</span>, <a title="Option[KeyType]" id="94229">e</a><span class="delimiter">)</span> =&gt; <a href="#40019" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="(from: Int, until: Int)Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">slice</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#38472" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#94229" title="Option[KeyType]">e</a><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" class="delimiter">(</span><a title="Option[KeyType]" id="94361">s</a>, <span title="object None">None</span><span class="delimiter">)</span> =&gt; <a href="#40019" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="(from: Int, until: Int)Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">slice</span><span class="delimiter">(</span><a href="#38472" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#94361" title="Option[KeyType]">s</a><span class="delimiter">)</span>, <a href="#40019" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" class="delimiter">(</span><a title="Option[KeyType]" id="94610">s</a>, <a title="Option[KeyType]" id="94611">e</a><span class="delimiter">)</span> =&gt; <a href="#40019" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="(from: Int, until: Int)Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">slice</span><span class="delimiter">(</span><a href="#38472" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#94610" title="Option[KeyType]">s</a><span class="delimiter">)</span>, <a href="#38472" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#94611" title="Option[KeyType]">e</a><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


  <span class="comment">/**
   * Splits the range at the key position. The left range includes the split key
   * The values are either left or right attached.
   * If the splitKey already exists, null is returned.
   *
   */</span>
  <span class="keyword">def</span> <a title="(key: KeyType, values: Seq[ValueType], leftAttached: Boolean)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="38479">split</a><span class="delimiter">(</span><a title="KeyType" id="57981">key</a>: <a href="#9981" title="KeyType">KeyType</a>, <a title="Seq[ValueType]" id="57982">values</a>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span>, <a title="Boolean" id="57985">leftAttached</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>: <a href="#9980" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="94739">idx</a> = <a href="#38469" title="(key: KeyType)Int">binarySearch</a><span class="delimiter">(</span><a href="#57981" title="KeyType">key</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#94739" title="Int">idx</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#94739" title="Int">idx</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#40019" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">else</span>
      <a href="#94739" title="Int">idx</a> = <a href="#38471" title="(idx: Int)Int">calcMidIdx</a><span class="delimiter">(</span><a href="#94739" title="Int">idx</a><span class="delimiter">)</span>
    <span title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">if</span> <span class="delimiter">(</span><a href="#57985" title="Boolean">leftAttached</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#38480" title="(key: KeyType, leftValues: Seq[ValueType], rightValues: Seq[ValueType])edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">split</a><span class="delimiter">(</span><a href="#57981" title="KeyType">key</a>, <a href="#57982" title="Seq[ValueType]">values</a>, <a href="#40019" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#94739" title="Int">idx</a><span class="delimiter">)</span>.<a href="#96307" title="=&gt; Seq[ValueType]">values</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#38480" title="(key: KeyType, leftValues: Seq[ValueType], rightValues: Seq[ValueType])edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">split</a><span class="delimiter">(</span><a href="#57981" title="KeyType">key</a>, <a href="#40019" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#94739" title="Int">idx</a><span class="delimiter">)</span>.<a href="#96307" title="=&gt; Seq[ValueType]">values</a>, <a href="#57982" title="Seq[ValueType]">values</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Splits the range at the key position. The left range includes the split key
   * The values are either left or right attached.
   *
   */</span>
  <span class="keyword">def</span> <a title="(key: KeyType, leftValues: Seq[ValueType], rightValues: Seq[ValueType])edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="38480">split</a><span class="delimiter">(</span><a title="KeyType" id="57974">key</a>: <a href="#9981" title="KeyType">KeyType</a>, <a title="Seq[ValueType]" id="57975">leftValues</a>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span>, <a title="Seq[ValueType]" id="57976">rightValues</a>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#9980" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="94889">idx</a> = <a href="#38469" title="(key: KeyType)Int">binarySearch</a><span class="delimiter">(</span><a href="#57974" title="KeyType">key</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#94889" title="Int">idx</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#94889" title="Int">idx</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#40019" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">else</span>
      <a href="#94889" title="Int">idx</a> = <a href="#38471" title="(idx: Int)Int">calcMidIdx</a><span class="delimiter">(</span><a href="#94889" title="Int">idx</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="94890">newRTable</a> = <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" class="keyword">new</span> <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Array</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="#40019" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span title="object java.lang.System">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#40019" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>, <span title="Int(0)" class="int">0</span>, <a href="#94890" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <span title="Int(0)" class="int">0</span>, <a href="#94889" title="Int">idx</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#94889" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(2)" class="int">2</span> <span title="(x: Int)Boolean">&lt;</span> <a href="#94890" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <span title="object java.lang.System">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#40019" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>, <a href="#94889" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>, <a href="#94890" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <a href="#94889" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(2)" class="int">2</span>, <a href="#40019" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <a href="#94889" title="Int">idx</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <a href="#94890" title="(i: Int, x: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])Unit">newRTable</a><span class="delimiter">(</span><a href="#94889" title="Int">idx</a><span class="delimiter">)</span> = <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#96313" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">(</span><a href="#40019" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#94889" title="Int">idx</a><span class="delimiter">)</span>.<a href="#96306" title="=&gt; Option[KeyType]">startKey</a>, <a href="#57975" title="Seq[ValueType]">leftValues</a><span class="delimiter">)</span>
    <a href="#94890" title="(i: Int, x: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])Unit">newRTable</a><span class="delimiter">(</span><a href="#94889" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> = <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#96313" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">(</span><span title="(x: KeyType)Option[KeyType]">Option</span><span class="delimiter">(</span><a href="#57974" title="KeyType">key</a><span class="delimiter">)</span>, <a href="#57976" title="Seq[ValueType]">rightValues</a><span class="delimiter">)</span>
    <span title="Nothing" class="keyword">return</span> <span title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">new</span> <a href="#9980" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><a href="#94890" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <a href="#40020" title="=&gt; java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">keyComparator</a>, <a href="#40021" title="=&gt; (Seq[ValueType], Seq[ValueType]) =&gt; Boolean">mergeCondition</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>


  <span class="comment">/**
   * Checks if the given range is an existing range
   */</span>
  <span class="keyword">def</span> <a title="(startKey: Option[KeyType], endKey: Option[KeyType])Boolean" id="38481">checkRange</a><span class="delimiter">(</span><a title="Option[KeyType]" id="95344">startKey</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span>, <a title="Option[KeyType]" id="95345">endKey</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="95347">idx</a> = <a href="#38470" title="(key: Option[KeyType])Int">binarySearch</a><span class="delimiter">(</span><a href="#95344" title="Option[KeyType]">startKey</a><span class="delimiter">)</span>
    <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#95347" title="Int">idx</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#40019" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <a href="#95347" title="Int">idx</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#95344" title="Option[KeyType]">startKey</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#40019" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#95347" title="Int">idx</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#95345" title="Option[KeyType]">endKey</a>.<span title="=&gt; Boolean">isEmpty</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#95344" title="Option[KeyType]">startKey</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#40019" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#95347" title="Int">idx</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#95345" title="Option[KeyType]">endKey</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#40019" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#95347" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


  <span class="comment">/**
   *  Merges the ranges left and right from the key. Per default the left values overwrite the right values.
   */</span>
  <span class="keyword">def</span> <a title="(key: KeyType, deleteLeft: Boolean)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="38482">merge</a><span class="delimiter">(</span><a title="KeyType" id="58149">key</a>: <a href="#9981" title="KeyType">KeyType</a>, <a title="Boolean" id="58152">deleteLeft</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>: <a href="#9980" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="95379">bpos</a> = <a href="#38469" title="(key: KeyType)Int">binarySearch</a><span class="delimiter">(</span><a href="#58149" title="KeyType">key</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#95379" title="Int">bpos</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">||</span> <a href="#95379" title="Int">bpos</a> <span title="(x: Int)Boolean">==</span> <a href="#40019" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <span title="Null(null)" class="keyword">null</span>
    <span title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">if</span> <span class="delimiter">(</span><a href="#58152" title="Boolean">deleteLeft</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Nothing" class="keyword">return</span> <a href="#38485" title="(key: KeyType, values: Seq[ValueType])edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">merge</a><span class="delimiter">(</span><a href="#58149" title="KeyType">key</a>, <a href="#40019" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#95379" title="Int">bpos</a><span class="delimiter">)</span>.<a href="#96307" title="=&gt; Seq[ValueType]">values</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span title="Nothing" class="keyword">return</span> <a href="#38485" title="(key: KeyType, values: Seq[ValueType])edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">merge</a><span class="delimiter">(</span><a href="#58149" title="KeyType">key</a>, <a href="#40019" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#95379" title="Int">bpos</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<a href="#96307" title="=&gt; Seq[ValueType]">values</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(key: KeyType)Boolean" id="38483">checkMergeCondition</a><span class="delimiter">(</span><a title="KeyType" id="58099">key</a>: <a href="#9981" title="KeyType">KeyType</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="95410">bpos</a> = <a href="#38469" title="(key: KeyType)Int">binarySearch</a><span class="delimiter">(</span><a href="#58099" title="KeyType">key</a><span class="delimiter">)</span>
    <a href="#38484" title="(bpos: Int)Boolean">checkMergeCondition</a><span class="delimiter">(</span><a href="#95410" title="Int">bpos</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(bpos: Int)Boolean" id="38484">checkMergeCondition</a><span class="delimiter">(</span><a title="Int" id="95421">bpos</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#95421" title="Int">bpos</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">||</span> <a href="#95421" title="Int">bpos</a> <span title="(x: Int)Boolean">==</span> <a href="#40019" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span><span class="delimiter">{</span>
      <a href="#38462" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;[%s] Merge Condition failed - key is not a split key&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#9980" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span><span class="keyword">else</span> <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#40021" title="(v1: Seq[ValueType], v2: Seq[ValueType])Boolean">mergeCondition</a><span class="delimiter">(</span><a href="#40019" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#95421" title="Int">bpos</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<a href="#96307" title="=&gt; Seq[ValueType]">values</a>, <a href="#40019" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#95421" title="Int">bpos</a><span class="delimiter">)</span>.<a href="#96307" title="=&gt; Seq[ValueType]">values</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">{</span>
      <a href="#38462" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;[%s] Merge Condition failed - sets are not equal. $s != $s&quot;)" class="string">&quot;[%s] Merge Condition failed - sets are not equal. $s != $s&quot;</span>, <a href="#9980" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">this</a>, <a href="#40019" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#95421" title="Int">bpos</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <a href="#40019" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#95421" title="Int">bpos</a><span class="delimiter">)</span> <span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span><span class="keyword">else</span>
      <span title="Nothing" class="keyword">return</span> <span title="Boolean(true)" class="keyword">true</span>
  <span class="delimiter">}</span>


  <span class="comment">/**
   * Merges the ranges left and right from the key. The new partition is assigned the given set of servers.
   */</span>
  <span class="keyword">def</span> <a title="(key: KeyType, values: Seq[ValueType])edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="38485">merge</a><span class="delimiter">(</span><a title="KeyType" id="58144">key</a>: <a href="#9981" title="KeyType">KeyType</a>, <a title="Seq[ValueType]" id="58145">values</a>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#9980" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="95452">bpos</a> = <a href="#38469" title="(key: KeyType)Int">binarySearch</a><span class="delimiter">(</span><a href="#58144" title="KeyType">key</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#38484" title="(bpos: Int)Boolean">checkMergeCondition</a><span class="delimiter">(</span><a href="#95452" title="Int">bpos</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">val</span> <a title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="95453">newRTable</a>: <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Array</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span> = <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" class="keyword">new</span> <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Array</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="#40019" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span title="object java.lang.System">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#40019" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>, <span title="Int(0)" class="int">0</span>, <a href="#95453" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <span title="Int(0)" class="int">0</span>, <a href="#95452" title="Int">bpos</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#95452" title="Int">bpos</a> <span title="(x: Int)Boolean">!=</span> <a href="#95453" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
      <span title="object java.lang.System">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#40019" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>, <a href="#95452" title="Int">bpos</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>, <a href="#95453" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <a href="#95452" title="Int">bpos</a>, <a href="#95453" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <a href="#95452" title="Int">bpos</a><span class="delimiter">)</span>
    <a href="#95453" title="(i: Int, x: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])Unit">newRTable</a><span class="delimiter">(</span><a href="#95452" title="Int">bpos</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> = <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#96313" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">(</span><a href="#95453" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">newRTable</a><span class="delimiter">(</span><a href="#95452" title="Int">bpos</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<a href="#96306" title="=&gt; Option[KeyType]">startKey</a>, <a href="#58145" title="Seq[ValueType]">values</a><span class="delimiter">)</span>
    <span title="Nothing" class="keyword">return</span> <span title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">new</span> <a href="#9980" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><a href="#95453" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <a href="#40020" title="=&gt; java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">keyComparator</a>, <a href="#40021" title="=&gt; (Seq[ValueType], Seq[ValueType]) =&gt; Boolean">mergeCondition</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Seq[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="38486">ranges</a>: <span title="Seq[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Seq</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="#40019" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Seq[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">toSeq</span>

  <span class="keyword">def</span> <a title="(key: KeyType, value: ValueType)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="38487">addValueToRange</a><span class="delimiter">(</span><a title="KeyType" id="58332">key</a>: <a href="#9981" title="KeyType">KeyType</a>, <a title="ValueType" id="58333">value</a>: <a href="#9982" title="ValueType">ValueType</a><span class="delimiter">)</span>: <a href="#9980" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <a href="#38488" title="(key: Option[KeyType], value: ValueType)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">addValueToRange</a><span class="delimiter">(</span><span title="(x: KeyType)Option[KeyType]">Option</span><span class="delimiter">(</span><a href="#58332" title="KeyType">key</a><span class="delimiter">)</span>, <a href="#58333" title="ValueType">value</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(key: Option[KeyType], value: ValueType)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="38488">addValueToRange</a><span class="delimiter">(</span><a title="Option[KeyType]" id="58327">key</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span>, <a title="ValueType" id="58328">value</a>: <a href="#9982" title="ValueType">ValueType</a><span class="delimiter">)</span>: <a href="#9980" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="95764">idx</a> = <a href="#38472" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#58327" title="Option[KeyType]">key</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="95765">range</a> = <a href="#40019" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#95764" title="Int">idx</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="95766">newRTable</a> = <a href="#40019" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="()Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">clone</span>
    <a href="#95766" title="(i: Int, x: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])Unit">newRTable</a><span class="delimiter">(</span><a href="#95764" title="Int">idx</a><span class="delimiter">)</span> = <a href="#95765" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">range</a>.<a href="#38939" title="(value: ValueType)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">add</a><span class="delimiter">(</span><a href="#58328" title="ValueType">value</a><span class="delimiter">)</span>
    <span title="Nothing" class="keyword">return</span> <span title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">new</span> <a href="#9980" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><a href="#95766" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <a href="#40020" title="=&gt; java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">keyComparator</a>, <a href="#40021" title="=&gt; (Seq[ValueType], Seq[ValueType]) =&gt; Boolean">mergeCondition</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(key: KeyType, value: ValueType)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="38489">removeValueFromRange</a><span class="delimiter">(</span><a title="KeyType" id="58260">key</a>: <a href="#9981" title="KeyType">KeyType</a>, <a title="ValueType" id="58261">value</a>: <a href="#9982" title="ValueType">ValueType</a><span class="delimiter">)</span>: <a href="#9980" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <a href="#38490" title="(key: Option[KeyType], value: ValueType)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">removeValueFromRange</a><span class="delimiter">(</span><span title="(x: KeyType)Option[KeyType]">Option</span><span class="delimiter">(</span><a href="#58260" title="KeyType">key</a><span class="delimiter">)</span>, <a href="#58261" title="ValueType">value</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(key: Option[KeyType], value: ValueType)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="38490">removeValueFromRange</a><span class="delimiter">(</span><a title="Option[KeyType]" id="58255">key</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span>, <a title="ValueType" id="58256">value</a>: <a href="#9982" title="ValueType">ValueType</a><span class="delimiter">)</span>: <a href="#9980" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="95785">idx</a> = <a href="#38472" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#58255" title="Option[KeyType]">key</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="95786">range</a> = <a href="#40019" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#95785" title="Int">idx</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="95787">newRTable</a> = <a href="#40019" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="()Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">clone</span>
    <a href="#95787" title="(i: Int, x: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])Unit">newRTable</a><span class="delimiter">(</span><a href="#95785" title="Int">idx</a><span class="delimiter">)</span> = <a href="#95786" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">range</a>.<a href="#38940" title="(value: ValueType)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">remove</a><span class="delimiter">(</span><a href="#58256" title="ValueType">value</a><span class="delimiter">)</span>
    <span title="Nothing" class="keyword">return</span> <span title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">new</span> <a href="#9980" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><a href="#95787" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <a href="#40020" title="=&gt; java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">keyComparator</a>, <a href="#40021" title="=&gt; (Seq[ValueType], Seq[ValueType]) =&gt; Boolean">mergeCondition</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(key: Option[KeyType], values: Seq[ValueType])edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="38491">replaceValues</a><span class="delimiter">(</span><a title="Option[KeyType]" id="95797">key</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span>, <a title="Seq[ValueType]" id="95798">values</a>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#9980" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="95800">idx</a> = <a href="#38472" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#95797" title="Option[KeyType]">key</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="95801">newRTable</a> = <a href="#40019" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="()Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">clone</span>
    <a href="#95801" title="(i: Int, x: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])Unit">newRTable</a><span class="delimiter">(</span><a href="#95800" title="Int">idx</a><span class="delimiter">)</span> = <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#96313" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">(</span><a href="#95801" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">newRTable</a><span class="delimiter">(</span><a href="#95800" title="Int">idx</a><span class="delimiter">)</span>.<a href="#96306" title="=&gt; Option[KeyType]">startKey</a>, <a href="#95798" title="Seq[ValueType]">values</a><span class="delimiter">)</span>
    <span title="Nothing" class="keyword">return</span> <span title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">new</span> <a href="#9980" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><a href="#95801" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <a href="#40020" title="=&gt; java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">keyComparator</a>, <a href="#40021" title="=&gt; (Seq[ValueType], Seq[ValueType]) =&gt; Boolean">mergeCondition</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.lang.String" id="38492">toString</a> = <span class="delimiter">{</span>
    <span title="java.lang.String(&quot;RTable(&quot;)" class="string">&quot;RTable(&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span> <a href="#95822" title="(z: java.lang.String)(op: (java.lang.String, edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]) =&gt; java.lang.String)java.lang.String">/:</a> <a href="#40019" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#96092" title="java.lang.String">_</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#96093" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">_</a><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;)&quot;)" class="string">&quot;)&quot;</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>


<span class="comment">/**
 * Represents a range inside RangeTable. StartKey is included in the range
 * TODO Should be an inner class of RangeTable, but it is impossible to create a RangeType without an existing parent object
 */</span>
case <span class="keyword">class</span> <a title="class RangeType[KeyType, ValueType] extends java.lang.Object with ScalaObject with Product with Serializable" id="96313">RangeType</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="39884">KeyType</a>, <a title="&gt;: Nothing &lt;: Any" id="39885">ValueType</a><span class="delimiter">]</span><a href="#96313" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="Option[KeyType]" id="96306">startKey</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="Seq[ValueType]" id="96307">values</a>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(value: ValueType)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="38939">add</a><span class="delimiter">(</span><a title="ValueType" id="95769">value</a>: <a href="#39885" title="ValueType">ValueType</a><span class="delimiter">)</span>: <a href="#96313" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#96307" title="=&gt; Seq[ValueType]">values</a>.<span title="(elem: ValueType)Int">indexOf</span><span class="delimiter">(</span><a href="#95769" title="ValueType">value</a><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.IllegalArgumentException" class="keyword">new</span> <span title="java.lang.IllegalArgumentException">IllegalArgumentException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Value already exists&quot;)" class="string">&quot;Value already exists&quot;</span><span class="delimiter">)</span>
    <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#96313" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">(</span><a href="#96306" title="=&gt; Option[KeyType]">startKey</a>, <a href="#95769" title="ValueType">value</a> <a href="#96131" title="(elem: ValueType)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[ValueType],ValueType,Seq[ValueType]])Seq[ValueType]">+:</a> <a href="#96307" title="=&gt; Seq[ValueType]">values</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Removes a value from the Range
   */</span>
  <span class="keyword">def</span> <a title="(value: ValueType)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="38940">remove</a><span class="delimiter">(</span><a title="ValueType" id="95790">value</a>: <a href="#39885" title="ValueType">ValueType</a><span class="delimiter">)</span>: <a href="#96313" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#96307" title="=&gt; Seq[ValueType]">values</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;It is not allowed to delete the last element in a range&quot;)" class="string">&quot;It is not allowed to delete the last element in a range&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#96313" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">(</span><a href="#96306" title="=&gt; Option[KeyType]">startKey</a>, <a href="#96307" title="=&gt; Seq[ValueType]">values</a>.<span title="(p: ValueType =&gt; Boolean)Seq[ValueType]">filterNot</span><span class="delimiter">(</span><a href="#96196" title="ValueType">_</a> <span title="(x$1: Any)Boolean">==</span> <a href="#95790" title="ValueType">value</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.lang.String" id="38941">toString</a> = <span class="delimiter">{</span>
    <span title="java.lang.String" class="keyword">if</span> <span class="delimiter">(</span><a href="#96307" title="=&gt; Seq[ValueType]">values</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>
      <span title="java.lang.String(&quot;[&quot;)" class="string">&quot;[&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#96306" title="=&gt; Option[KeyType]">startKey</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;:()]&quot;)" class="string">&quot;:()]&quot;</span>
    <span class="keyword">else</span>
      <span title="java.lang.String(&quot;[&quot;)" class="string">&quot;[&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#96306" title="=&gt; Option[KeyType]">startKey</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;:(&quot;)" class="string">&quot;:(&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span class="delimiter">(</span><a href="#96307" title="=&gt; Seq[ValueType]">values</a>.<span title="=&gt; ValueType">head</span>.<span title="()java.lang.String">toString</span> <a href="#96209" title="(z: java.lang.String)(op: (java.lang.String, ValueType) =&gt; java.lang.String)java.lang.String">/:</a> <a href="#96307" title="=&gt; Seq[ValueType]">values</a>.<span title="=&gt; Seq[ValueType]">tail</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#96226" title="java.lang.String">_</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#96227" title="ValueType">_</a><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;)]&quot;)" class="string">&quot;)]&quot;</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>