<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>util/RangeTable.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs.scads.util

<span class="keyword">import</span> java.util.<span class="delimiter">{</span>Comparator, Arrays<span class="delimiter">}</span>
<span class="keyword">import</span> net.lag.logging.Logger

<span class="comment">/**
 * Range Table data structure. Allows to split the range -inf to inf in arbitrary sub-ranges and assign values per sub-range.
 * The operations are thread-safe
 *
 * Constructor assigns values to the range -inf to inf. This range can than be split by split(key). Keys are compared with the given
 * comparator
 *
 * TODO RangeTable should be fully immutable (also for adding values). Makes programming the protocols easier
 */</span>
<span class="keyword">class</span> <a title="class RangeTable[KeyType, ValueType] extends java.lang.Object with ScalaObject" id="10593">RangeTable</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="10594">KeyType</a>, <a title="&gt;: Nothing &lt;: Any" id="10595">ValueType</a><span class="delimiter">]</span><a href="#10593" title="ScalaObject" class="delimiter">(</a>
        <span class="keyword">val</span> <a title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="46932">rTable</a>: <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Array</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span>,
        <span class="keyword">val</span> <a title="java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="46933">keyComparator</a>: <span title="java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Comparator</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span>,
        <span class="keyword">val</span> <a title="(Seq[ValueType], Seq[ValueType]) =&gt; Boolean" id="46934">mergeCondition</a>: <span class="delimiter">(</span>Seq<span class="delimiter">[</span>ValueType<span class="delimiter">]</span>, Seq<span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span> =&gt; Boolean<span class="delimiter">)</span> <span class="delimiter">{</span>
  <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#46932" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span> , <span title="java.lang.String(&quot;At least the startKey (None) has to exist at any time&quot;)" class="string">&quot;At least the startKey (None) has to exist at any time&quot;</span><span class="delimiter">)</span>
  <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#46932" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">head</span>.<a href="#115756" title="=&gt; Option[KeyType]">startKey</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="object None">None</span>, <span title="java.lang.String(&quot;First key has to be None, but was &quot;)" class="string">&quot;First key has to be None, but was &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#46932" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">head</span>.<a href="#115756" title="=&gt; Option[KeyType]">startKey</a> <span class="delimiter">)</span>

  <span class="keyword">protected</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="45376">logger</a> = <span title="()net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">/**
   *  Helper constructor for creating the Comparator
   */</span>
  <span class="keyword">def</span> <a title="(rTable: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]], keyComp: (KeyType, KeyType) =&gt; Int, mergeCondition: (Seq[ValueType], Seq[ValueType]) =&gt; Boolean)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="45377" class="keyword">this</a><span class="delimiter">(</span><a title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="46926">rTable</a>: <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Array</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span>,
           <a title="(KeyType, KeyType) =&gt; Int" id="46927">keyComp</a>: <span class="delimiter">(</span>KeyType, KeyType<span class="delimiter">)</span> =&gt; Int,
           <a title="(Seq[ValueType], Seq[ValueType]) =&gt; Boolean" id="46928">mergeCondition</a>: <span class="delimiter">(</span>Seq<span class="delimiter">[</span>ValueType<span class="delimiter">]</span>, Seq<span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span> =&gt; Boolean<span class="delimiter">)</span> = <span title="Unit" class="delimiter">{</span>
    <a href="#10593" title="RangeTable.this.type" class="keyword">this</a> <span class="delimiter">(</span><a href="#46926" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>,
      <a href="#113287" title="java.lang.Object with java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="113287">Comparator</a><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">def</span> <a title="(a: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType], b: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])Int" id="113289">compare</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="113290">a</a>: <a href="#115763" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span>, <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="113291">b</a>: <a href="#115763" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
          <span title="(_1: Option[KeyType], _2: Option[KeyType])(Option[KeyType], Option[KeyType])" class="delimiter">(</span><a href="#113290" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">a</a>.<a href="#115756" title="=&gt; Option[KeyType]">startKey</a>, <a href="#113291" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">b</a>.<a href="#115756" title="=&gt; Option[KeyType]">startKey</a><span class="delimiter">)</span> <span title="Int" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="Int(0)" class="delimiter">(</span><span title="object None">None</span>, <span title="object None">None</span><span class="delimiter">)</span> =&gt; <span title="Int(0)" class="int">0</span>
            <span class="keyword">case</span> <span title="Int(-1)" class="delimiter">(</span><span title="object None">None</span>, _<span class="delimiter">)</span> =&gt; -<span title="Int(-1)" class="int">1</span>
            <span class="keyword">case</span> <span title="Int(1)" class="delimiter">(</span>_, <span title="object None">None</span><span class="delimiter">)</span> =&gt; <span title="Int(1)" class="int">1</span>
            <span class="keyword">case</span> <span title="Int" class="delimiter">(</span>Some<span class="delimiter">(</span><a title="KeyType" id="113312">a</a><span class="delimiter">)</span>, Some<span class="delimiter">(</span><a title="KeyType" id="113314">b</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#46927" title="(v1: KeyType, v2: KeyType)Int">keyComp</a><span class="delimiter">(</span><a href="#113312" title="KeyType">a</a>, <a href="#113314" title="KeyType">b</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>,
      <a href="#46928" title="(Seq[ValueType], Seq[ValueType]) =&gt; Boolean">mergeCondition</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Creates a new RangeTable from a Simple Seq
   */</span>
  <span class="keyword">def</span> <a title="(initRanges: Seq[(Option[KeyType], Seq[ValueType])], keyComp: (KeyType, KeyType) =&gt; Int, mergeCondition: (Seq[ValueType], Seq[ValueType]) =&gt; Boolean)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="45378" class="keyword">this</a><span class="delimiter">(</span><a title="Seq[(Option[KeyType], Seq[ValueType])]" id="46920">initRanges</a>: <span title="Seq[(Option[KeyType], Seq[ValueType])]">Seq</span><span class="delimiter">[</span><span class="delimiter">(</span>Option<span class="delimiter">[</span>KeyType<span class="delimiter">]</span>, Seq<span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">]</span>,
           <a title="(KeyType, KeyType) =&gt; Int" id="46921">keyComp</a>: <span class="delimiter">(</span>KeyType, KeyType<span class="delimiter">)</span> =&gt; Int,
           <a title="(Seq[ValueType], Seq[ValueType]) =&gt; Boolean" id="46922">mergeCondition</a>: <span class="delimiter">(</span>Seq<span class="delimiter">[</span>ValueType<span class="delimiter">]</span>, Seq<span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span> =&gt; Boolean<span class="delimiter">)</span> =
    <a href="#45377" title="(rTable: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]], keyComp: (KeyType, KeyType) =&gt; Int, mergeCondition: (Seq[ValueType], Seq[ValueType]) =&gt; Boolean)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">this</a> <span class="delimiter">(</span><a href="#46920" title="Seq[(Option[KeyType], Seq[ValueType])]">initRanges</a>.<span title="(f: (Option[KeyType], Seq[ValueType]) =&gt; edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Option[KeyType], Seq[ValueType])],edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType],Seq[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]])Seq[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType],Seq[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]]" class="delimiter">(</span><a title="(Option[KeyType], Seq[ValueType])" id="113342">item</a> =&gt; <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#115763" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><a href="#113342" title="(Option[KeyType], Seq[ValueType])">item</a>.<span title="=&gt; Option[KeyType]">_1</span>, <a href="#113342" title="(Option[KeyType], Seq[ValueType])">item</a>.<span title="=&gt; Seq[ValueType]">_2</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(implicit evidence$1: ClassManifest[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">toArray</span>, <a href="#46921" title="(KeyType, KeyType) =&gt; Int">keyComp</a>, <a href="#46922" title="(Seq[ValueType], Seq[ValueType]) =&gt; Boolean">mergeCondition</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Helper case class to return all ranges (left, center, right) for a given key
   */</span>
  case <span class="keyword">class</span> <a title="class RangeBound extends java.lang.Object with ScalaObject with Product with Serializable" id="113425">RangeBound</a><a href="#113425" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="113608">left</a>: <a href="#115763" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="113609">center</a>: <a href="#115763" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="113610">right</a>: <a href="#115763" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">)</span>


  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(key: KeyType)Int" id="45382">binarySearch</a><span class="delimiter">(</span><a title="KeyType" id="113476">key</a>: <a href="#10594" title="KeyType">KeyType</a><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <a href="#45383" title="(key: Option[KeyType])Int">binarySearch</a><span class="delimiter">(</span><span title="(x: KeyType)Some[KeyType]">Some</span><span class="delimiter">(</span><a href="#113476" title="KeyType">key</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>


  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(key: Option[KeyType])Int" id="45383">binarySearch</a><span class="delimiter">(</span><a title="Option[KeyType]" id="113482">key</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="113489">pKey</a> = <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#115763" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><a href="#113482" title="Option[KeyType]">key</a>, <span title="object Nil">Nil</span><span class="delimiter">)</span>
    <span title="object java.util.Arrays">Arrays</span>.<span title="(x$1: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType] with java.lang.Object], x$2: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType], x$3: java.util.Comparator[_ &gt;: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])Int">binarySearch</span><span class="delimiter">(</span><a href="#46932" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>, <a href="#113489" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">pKey</a>, <a href="#46933" title="=&gt; java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">keyComparator</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * If the key is inside the range binarysearch returns a neg. value. This calc corrects it.
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(idx: Int)Int" id="45384">calcMidIdx</a><span class="delimiter">(</span><a title="Int" id="113535">idx</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">(</span><a href="#113535" title="Int">idx</a> <span title="(x: Int)Int">*</span> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <span title="(x: Int)Int">-</span> <span title="Int(2)" class="int">2</span>

  <span class="comment">/**
   * Returns the idx for the corresponding range
   */</span>
  <span class="keyword">def</span> <a title="(key: Option[KeyType])Int" id="45385">idxForKey</a><span class="delimiter">(</span><a title="Option[KeyType]" id="113545">key</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="113547">bpos</a> = <a href="#45383" title="(key: Option[KeyType])Int">binarySearch</a><span class="delimiter">(</span><a href="#113545" title="Option[KeyType]">key</a><span class="delimiter">)</span>

    <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#113547" title="Int">bpos</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="comment">//nb is in range. This is the most common case, should be placed first</span>
      <a href="#45384" title="(idx: Int)Int">calcMidIdx</a><span class="delimiter">(</span><a href="#113547" title="Int">bpos</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#113547" title="Int">bpos</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#46932" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
      <a href="#113547" title="Int">bpos</a>
    <span class="keyword">else</span>
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;A key always has to belong to a range. Probably the given comparison function is incorrect.&quot;)" class="string">&quot;A key always has to belong to a range. Probably the given comparison function is incorrect.&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Returns the list of values which are attached to the range for the given key
   */</span>
  <span class="keyword">def</span> <a title="(key: KeyType)Seq[ValueType]" id="45386">valuesForKey</a><span class="delimiter">(</span><a title="KeyType" id="63427">key</a>: <a href="#10594" title="KeyType">KeyType</a><span class="delimiter">)</span>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span> = <a href="#45387" title="(key: Option[KeyType])Seq[ValueType]">valuesForKey</a><span class="delimiter">(</span><span title="(x: KeyType)Option[KeyType]">Option</span><span class="delimiter">(</span><a href="#63427" title="KeyType">key</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Returns all values attached to the range for the given key
   */</span>
  <span class="keyword">def</span> <a title="(key: Option[KeyType])Seq[ValueType]" id="45387">valuesForKey</a><span class="delimiter">(</span><a title="Option[KeyType]" id="63424">key</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#46932" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#45385" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#63424" title="Option[KeyType]">key</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="#115757" title="=&gt; Seq[ValueType]">values</a>
  <span class="delimiter">}</span>


  <span class="comment">/**
   * Returns the surrounding ranges for a key
   * If the value is in the most left range starting with None, the left and center range will be the same
   * Warning: Right ranges can be just a placeholder for None with an empty set of servers
   *
   */</span>
  <span class="keyword">def</span> <a title="(key: KeyType)RangeTable.this.RangeBound" id="45388">lowerUpperBound</a><span class="delimiter">(</span><a title="KeyType" id="64292">key</a> : <a href="#10594" title="KeyType">KeyType</a><span class="delimiter">)</span> : <a href="#113425" title="RangeTable.this.RangeBound">RangeBound</a> = <a href="#45389" title="(startKey: Option[KeyType])RangeTable.this.RangeBound">lowerUpperBound</a><span class="delimiter">(</span><span title="(x: KeyType)Some[KeyType]">Some</span><span class="delimiter">(</span><a href="#64292" title="KeyType">key</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(startKey: Option[KeyType])RangeTable.this.RangeBound" id="45389">lowerUpperBound</a><span class="delimiter">(</span><a title="Option[KeyType]" id="64287">startKey</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#113425" title="RangeTable.this.RangeBound">RangeBound</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="113584">idx</a> = <a href="#45385" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#64287" title="Option[KeyType]">startKey</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="113585">lowerBound</a> = <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">if</span> <span class="delimiter">(</span><a href="#113584" title="Int">idx</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#46932" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#46932" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#113584" title="Int">idx</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="113586">upperBound</a> = <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">if</span> <span class="delimiter">(</span><a href="#113584" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span> <span title="(x: Int)Boolean">==</span> <a href="#46932" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#115763" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><span title="object None">None</span>, <span title="object Nil">Nil</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#46932" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#113584" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <a href="#113425" title="(left: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType], center: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType], right: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])RangeTable.this.RangeBound">RangeBound</a><span class="delimiter">(</span><a href="#113585" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">lowerBound</a>, <a href="#46932" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#113584" title="Int">idx</a><span class="delimiter">)</span>, <a href="#113586" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">upperBound</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(key: KeyType)Boolean" id="45390">isSplitKey</a><span class="delimiter">(</span><a title="KeyType" id="64282">key</a>: <a href="#10594" title="KeyType">KeyType</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="113618">bpos</a> = <a href="#45382" title="(key: KeyType)Int">binarySearch</a><span class="delimiter">(</span><a href="#64282" title="KeyType">key</a><span class="delimiter">)</span>
    <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#113618" title="Int">bpos</a> <span title="(x: Int)Boolean">==</span> <a href="#46932" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
      <span title="Boolean(false)" class="keyword">false</span>
    <span class="keyword">else</span> <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#113618" title="Int">bpos</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">else</span>
      <span title="Boolean(false)" class="keyword">false</span>
  <span class="delimiter">}</span>


  <span class="comment">/**
   * Returns all ranges from startKey to endKey
   */</span>
  <span class="keyword">def</span> <a title="(startKey: Option[KeyType], endKey: Option[KeyType])Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="45391">valuesForRange</a><span class="delimiter">(</span><a title="Option[KeyType]" id="65930">startKey</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span>, <a title="Option[KeyType]" id="65931">endKey</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Array</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="(_1: Option[KeyType], _2: Option[KeyType])(Option[KeyType], Option[KeyType])" class="delimiter">(</span><a href="#65930" title="Option[KeyType]">startKey</a>, <a href="#65931" title="Option[KeyType]">endKey</a><span class="delimiter">)</span> <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Nothing" class="delimiter">(</span><span title="object None">None</span>, <span title="object None">None</span><span class="delimiter">)</span> =&gt; <span title="Nothing" class="keyword">return</span> <a href="#46932" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>
      <span class="keyword">case</span> <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" class="delimiter">(</span><span title="object None">None</span>, <a title="Option[KeyType]" id="113643">e</a><span class="delimiter">)</span> =&gt; <a href="#46932" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="(from: Int, until: Int)Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">slice</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#45385" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#113643" title="Option[KeyType]">e</a><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" class="delimiter">(</span><a title="Option[KeyType]" id="113775">s</a>, <span title="object None">None</span><span class="delimiter">)</span> =&gt; <a href="#46932" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="(from: Int, until: Int)Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">slice</span><span class="delimiter">(</span><a href="#45385" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#113775" title="Option[KeyType]">s</a><span class="delimiter">)</span>, <a href="#46932" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" class="delimiter">(</span><a title="Option[KeyType]" id="114024">s</a>, <a title="Option[KeyType]" id="114025">e</a><span class="delimiter">)</span> =&gt; <a href="#46932" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="(from: Int, until: Int)Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">slice</span><span class="delimiter">(</span><a href="#45385" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#114024" title="Option[KeyType]">s</a><span class="delimiter">)</span>, <a href="#45385" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#114025" title="Option[KeyType]">e</a><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


  <span class="comment">/**
   * Splits the range at the key position. The left range includes the split key
   * The values are either left or right attached.
   * If the splitKey already exists, null is returned.
   *
   */</span>
  <span class="keyword">def</span> <a title="(key: KeyType, values: Seq[ValueType], leftAttached: Boolean)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="45392">split</a><span class="delimiter">(</span><a title="KeyType" id="64361">key</a>: <a href="#10594" title="KeyType">KeyType</a>, <a title="Seq[ValueType]" id="64362">values</a>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span>, <a title="Boolean" id="64365">leftAttached</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>: <a href="#10593" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="114153">idx</a> = <a href="#45382" title="(key: KeyType)Int">binarySearch</a><span class="delimiter">(</span><a href="#64361" title="KeyType">key</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#114153" title="Int">idx</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#114153" title="Int">idx</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#46932" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">else</span>
      <a href="#114153" title="Int">idx</a> = <a href="#45384" title="(idx: Int)Int">calcMidIdx</a><span class="delimiter">(</span><a href="#114153" title="Int">idx</a><span class="delimiter">)</span>
    <span title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">if</span> <span class="delimiter">(</span><a href="#64365" title="Boolean">leftAttached</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#45393" title="(key: KeyType, leftValues: Seq[ValueType], rightValues: Seq[ValueType])edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">split</a><span class="delimiter">(</span><a href="#64361" title="KeyType">key</a>, <a href="#64362" title="Seq[ValueType]">values</a>, <a href="#46932" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#114153" title="Int">idx</a><span class="delimiter">)</span>.<a href="#115757" title="=&gt; Seq[ValueType]">values</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#45393" title="(key: KeyType, leftValues: Seq[ValueType], rightValues: Seq[ValueType])edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">split</a><span class="delimiter">(</span><a href="#64361" title="KeyType">key</a>, <a href="#46932" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#114153" title="Int">idx</a><span class="delimiter">)</span>.<a href="#115757" title="=&gt; Seq[ValueType]">values</a>, <a href="#64362" title="Seq[ValueType]">values</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Splits the range at the key position. The left range includes the split key
   * The values are either left or right attached.
   *
   */</span>
  <span class="keyword">def</span> <a title="(key: KeyType, leftValues: Seq[ValueType], rightValues: Seq[ValueType])edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="45393">split</a><span class="delimiter">(</span><a title="KeyType" id="64354">key</a>: <a href="#10594" title="KeyType">KeyType</a>, <a title="Seq[ValueType]" id="64355">leftValues</a>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span>, <a title="Seq[ValueType]" id="64356">rightValues</a>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#10593" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="114303">idx</a> = <a href="#45382" title="(key: KeyType)Int">binarySearch</a><span class="delimiter">(</span><a href="#64354" title="KeyType">key</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#114303" title="Int">idx</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#114303" title="Int">idx</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#46932" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">else</span>
      <a href="#114303" title="Int">idx</a> = <a href="#45384" title="(idx: Int)Int">calcMidIdx</a><span class="delimiter">(</span><a href="#114303" title="Int">idx</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="114304">newRTable</a> = <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" class="keyword">new</span> <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Array</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="#46932" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span title="object java.lang.System">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#46932" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>, <span title="Int(0)" class="int">0</span>, <a href="#114304" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <span title="Int(0)" class="int">0</span>, <a href="#114303" title="Int">idx</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#114303" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(2)" class="int">2</span> <span title="(x: Int)Boolean">&lt;</span> <a href="#114304" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <span title="object java.lang.System">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#46932" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>, <a href="#114303" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>, <a href="#114304" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <a href="#114303" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(2)" class="int">2</span>, <a href="#46932" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <a href="#114303" title="Int">idx</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <a href="#114304" title="(i: Int, x: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])Unit">newRTable</a><span class="delimiter">(</span><a href="#114303" title="Int">idx</a><span class="delimiter">)</span> = <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#115763" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">(</span><a href="#46932" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#114303" title="Int">idx</a><span class="delimiter">)</span>.<a href="#115756" title="=&gt; Option[KeyType]">startKey</a>, <a href="#64355" title="Seq[ValueType]">leftValues</a><span class="delimiter">)</span>
    <a href="#114304" title="(i: Int, x: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])Unit">newRTable</a><span class="delimiter">(</span><a href="#114303" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> = <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#115763" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">(</span><span title="(x: KeyType)Option[KeyType]">Option</span><span class="delimiter">(</span><a href="#64354" title="KeyType">key</a><span class="delimiter">)</span>, <a href="#64356" title="Seq[ValueType]">rightValues</a><span class="delimiter">)</span>
    <span title="Nothing" class="keyword">return</span> <span title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">new</span> <a href="#10593" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><a href="#114304" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <a href="#46933" title="=&gt; java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">keyComparator</a>, <a href="#46934" title="=&gt; (Seq[ValueType], Seq[ValueType]) =&gt; Boolean">mergeCondition</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>


  <span class="comment">/**
   * Checks if the given range is an existing range
   */</span>
  <span class="keyword">def</span> <a title="(startKey: Option[KeyType], endKey: Option[KeyType])Boolean" id="45394">checkRange</a><span class="delimiter">(</span><a title="Option[KeyType]" id="114770">startKey</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span>, <a title="Option[KeyType]" id="114771">endKey</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="114773">idx</a> = <a href="#45383" title="(key: Option[KeyType])Int">binarySearch</a><span class="delimiter">(</span><a href="#114770" title="Option[KeyType]">startKey</a><span class="delimiter">)</span>
    <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#114773" title="Int">idx</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#46932" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <a href="#114773" title="Int">idx</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#114770" title="Option[KeyType]">startKey</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#46932" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#114773" title="Int">idx</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#114771" title="Option[KeyType]">endKey</a>.<span title="=&gt; Boolean">isEmpty</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#114770" title="Option[KeyType]">startKey</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#46932" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#114773" title="Int">idx</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#114771" title="Option[KeyType]">endKey</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#46932" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#114773" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


  <span class="comment">/**
   *  Merges the ranges left and right from the key. Per default the left values overwrite the right values.
   */</span>
  <span class="keyword">def</span> <a title="(key: KeyType, deleteLeft: Boolean)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="45395">merge</a><span class="delimiter">(</span><a title="KeyType" id="64529">key</a>: <a href="#10594" title="KeyType">KeyType</a>, <a title="Boolean" id="64532">deleteLeft</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>: <a href="#10593" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="114805">bpos</a> = <a href="#45382" title="(key: KeyType)Int">binarySearch</a><span class="delimiter">(</span><a href="#64529" title="KeyType">key</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#114805" title="Int">bpos</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">||</span> <a href="#114805" title="Int">bpos</a> <span title="(x: Int)Boolean">==</span> <a href="#46932" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <span title="Null(null)" class="keyword">null</span>
    <span title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">if</span> <span class="delimiter">(</span><a href="#64532" title="Boolean">deleteLeft</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Nothing" class="keyword">return</span> <a href="#45398" title="(key: KeyType, values: Seq[ValueType])edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">merge</a><span class="delimiter">(</span><a href="#64529" title="KeyType">key</a>, <a href="#46932" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#114805" title="Int">bpos</a><span class="delimiter">)</span>.<a href="#115757" title="=&gt; Seq[ValueType]">values</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span title="Nothing" class="keyword">return</span> <a href="#45398" title="(key: KeyType, values: Seq[ValueType])edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">merge</a><span class="delimiter">(</span><a href="#64529" title="KeyType">key</a>, <a href="#46932" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#114805" title="Int">bpos</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<a href="#115757" title="=&gt; Seq[ValueType]">values</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(key: KeyType)Boolean" id="45396">checkMergeCondition</a><span class="delimiter">(</span><a title="KeyType" id="64479">key</a>: <a href="#10594" title="KeyType">KeyType</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="114836">bpos</a> = <a href="#45382" title="(key: KeyType)Int">binarySearch</a><span class="delimiter">(</span><a href="#64479" title="KeyType">key</a><span class="delimiter">)</span>
    <a href="#45397" title="(bpos: Int)Boolean">checkMergeCondition</a><span class="delimiter">(</span><a href="#114836" title="Int">bpos</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(bpos: Int)Boolean" id="45397">checkMergeCondition</a><span class="delimiter">(</span><a title="Int" id="114847">bpos</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#114847" title="Int">bpos</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">||</span> <a href="#114847" title="Int">bpos</a> <span title="(x: Int)Boolean">==</span> <a href="#46932" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span><span class="delimiter">{</span>
      <a href="#45375" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;[%s] Merge Condition failed - key is not a split key&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#10593" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span><span class="keyword">else</span> <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#46934" title="(v1: Seq[ValueType], v2: Seq[ValueType])Boolean">mergeCondition</a><span class="delimiter">(</span><a href="#46932" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#114847" title="Int">bpos</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<a href="#115757" title="=&gt; Seq[ValueType]">values</a>, <a href="#46932" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#114847" title="Int">bpos</a><span class="delimiter">)</span>.<a href="#115757" title="=&gt; Seq[ValueType]">values</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">{</span>
      <a href="#45375" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;[%s] Merge Condition failed - sets are not equal. $s != $s&quot;)" class="string">&quot;[%s] Merge Condition failed - sets are not equal. $s != $s&quot;</span>, <a href="#10593" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">this</a>, <a href="#46932" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#114847" title="Int">bpos</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <a href="#46932" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#114847" title="Int">bpos</a><span class="delimiter">)</span> <span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span><span class="keyword">else</span>
      <span title="Nothing" class="keyword">return</span> <span title="Boolean(true)" class="keyword">true</span>
  <span class="delimiter">}</span>


  <span class="comment">/**
   * Merges the ranges left and right from the key. The new partition is assigned the given set of servers.
   */</span>
  <span class="keyword">def</span> <a title="(key: KeyType, values: Seq[ValueType])edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="45398">merge</a><span class="delimiter">(</span><a title="KeyType" id="64524">key</a>: <a href="#10594" title="KeyType">KeyType</a>, <a title="Seq[ValueType]" id="64525">values</a>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#10593" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="114878">bpos</a> = <a href="#45382" title="(key: KeyType)Int">binarySearch</a><span class="delimiter">(</span><a href="#64524" title="KeyType">key</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#45397" title="(bpos: Int)Boolean">checkMergeCondition</a><span class="delimiter">(</span><a href="#114878" title="Int">bpos</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">val</span> <a title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="114879">newRTable</a>: <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Array</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span> = <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" class="keyword">new</span> <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Array</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="#46932" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span title="object java.lang.System">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#46932" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>, <span title="Int(0)" class="int">0</span>, <a href="#114879" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <span title="Int(0)" class="int">0</span>, <a href="#114878" title="Int">bpos</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#114878" title="Int">bpos</a> <span title="(x: Int)Boolean">!=</span> <a href="#114879" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
      <span title="object java.lang.System">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#46932" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>, <a href="#114878" title="Int">bpos</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>, <a href="#114879" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <a href="#114878" title="Int">bpos</a>, <a href="#114879" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <a href="#114878" title="Int">bpos</a><span class="delimiter">)</span>
    <a href="#114879" title="(i: Int, x: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])Unit">newRTable</a><span class="delimiter">(</span><a href="#114878" title="Int">bpos</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> = <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#115763" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">(</span><a href="#114879" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">newRTable</a><span class="delimiter">(</span><a href="#114878" title="Int">bpos</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<a href="#115756" title="=&gt; Option[KeyType]">startKey</a>, <a href="#64525" title="Seq[ValueType]">values</a><span class="delimiter">)</span>
    <span title="Nothing" class="keyword">return</span> <span title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">new</span> <a href="#10593" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><a href="#114879" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <a href="#46933" title="=&gt; java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">keyComparator</a>, <a href="#46934" title="=&gt; (Seq[ValueType], Seq[ValueType]) =&gt; Boolean">mergeCondition</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Seq[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="45399">ranges</a>: <span title="Seq[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Seq</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="#46932" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Seq[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">toSeq</span>

  <span class="keyword">def</span> <a title="(key: KeyType, value: ValueType)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="45400">addValueToRange</a><span class="delimiter">(</span><a title="KeyType" id="64712">key</a>: <a href="#10594" title="KeyType">KeyType</a>, <a title="ValueType" id="64713">value</a>: <a href="#10595" title="ValueType">ValueType</a><span class="delimiter">)</span>: <a href="#10593" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <a href="#45401" title="(key: Option[KeyType], value: ValueType)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">addValueToRange</a><span class="delimiter">(</span><span title="(x: KeyType)Option[KeyType]">Option</span><span class="delimiter">(</span><a href="#64712" title="KeyType">key</a><span class="delimiter">)</span>, <a href="#64713" title="ValueType">value</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(key: Option[KeyType], value: ValueType)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="45401">addValueToRange</a><span class="delimiter">(</span><a title="Option[KeyType]" id="64707">key</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span>, <a title="ValueType" id="64708">value</a>: <a href="#10595" title="ValueType">ValueType</a><span class="delimiter">)</span>: <a href="#10593" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="115194">idx</a> = <a href="#45385" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#64707" title="Option[KeyType]">key</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="115195">range</a> = <a href="#46932" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#115194" title="Int">idx</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="115196">newRTable</a> = <a href="#46932" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="()Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">clone</span>
    <a href="#115196" title="(i: Int, x: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])Unit">newRTable</a><span class="delimiter">(</span><a href="#115194" title="Int">idx</a><span class="delimiter">)</span> = <a href="#115195" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">range</a>.<a href="#45852" title="(value: ValueType)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">add</a><span class="delimiter">(</span><a href="#64708" title="ValueType">value</a><span class="delimiter">)</span>
    <span title="Nothing" class="keyword">return</span> <span title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">new</span> <a href="#10593" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><a href="#115196" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <a href="#46933" title="=&gt; java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">keyComparator</a>, <a href="#46934" title="=&gt; (Seq[ValueType], Seq[ValueType]) =&gt; Boolean">mergeCondition</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(key: KeyType, value: ValueType)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="45402">removeValueFromRange</a><span class="delimiter">(</span><a title="KeyType" id="64640">key</a>: <a href="#10594" title="KeyType">KeyType</a>, <a title="ValueType" id="64641">value</a>: <a href="#10595" title="ValueType">ValueType</a><span class="delimiter">)</span>: <a href="#10593" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <a href="#45403" title="(key: Option[KeyType], value: ValueType)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">removeValueFromRange</a><span class="delimiter">(</span><span title="(x: KeyType)Option[KeyType]">Option</span><span class="delimiter">(</span><a href="#64640" title="KeyType">key</a><span class="delimiter">)</span>, <a href="#64641" title="ValueType">value</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(key: Option[KeyType], value: ValueType)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="45403">removeValueFromRange</a><span class="delimiter">(</span><a title="Option[KeyType]" id="64635">key</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span>, <a title="ValueType" id="64636">value</a>: <a href="#10595" title="ValueType">ValueType</a><span class="delimiter">)</span>: <a href="#10593" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="115215">idx</a> = <a href="#45385" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#64635" title="Option[KeyType]">key</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="115216">range</a> = <a href="#46932" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#115215" title="Int">idx</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="115217">newRTable</a> = <a href="#46932" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="()Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">clone</span>
    <a href="#115217" title="(i: Int, x: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])Unit">newRTable</a><span class="delimiter">(</span><a href="#115215" title="Int">idx</a><span class="delimiter">)</span> = <a href="#115216" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">range</a>.<a href="#45853" title="(value: ValueType)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">remove</a><span class="delimiter">(</span><a href="#64636" title="ValueType">value</a><span class="delimiter">)</span>
    <span title="Nothing" class="keyword">return</span> <span title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">new</span> <a href="#10593" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><a href="#115217" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <a href="#46933" title="=&gt; java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">keyComparator</a>, <a href="#46934" title="=&gt; (Seq[ValueType], Seq[ValueType]) =&gt; Boolean">mergeCondition</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(key: Option[KeyType], values: Seq[ValueType])edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="45404">replaceValues</a><span class="delimiter">(</span><a title="Option[KeyType]" id="115227">key</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span>, <a title="Seq[ValueType]" id="115228">values</a>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#10593" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="115230">idx</a> = <a href="#45385" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#115227" title="Option[KeyType]">key</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="115231">newRTable</a> = <a href="#46932" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="()Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">clone</span>
    <a href="#115231" title="(i: Int, x: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])Unit">newRTable</a><span class="delimiter">(</span><a href="#115230" title="Int">idx</a><span class="delimiter">)</span> = <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#115763" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">(</span><a href="#115231" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">newRTable</a><span class="delimiter">(</span><a href="#115230" title="Int">idx</a><span class="delimiter">)</span>.<a href="#115756" title="=&gt; Option[KeyType]">startKey</a>, <a href="#115228" title="Seq[ValueType]">values</a><span class="delimiter">)</span>
    <span title="Nothing" class="keyword">return</span> <span title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">new</span> <a href="#10593" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><a href="#115231" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <a href="#46933" title="=&gt; java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">keyComparator</a>, <a href="#46934" title="=&gt; (Seq[ValueType], Seq[ValueType]) =&gt; Boolean">mergeCondition</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.lang.String" id="45405">toString</a> = <span class="delimiter">{</span>
    <span title="java.lang.String(&quot;RTable(&quot;)" class="string">&quot;RTable(&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span> <a href="#115256" title="(z: java.lang.String)(op: (java.lang.String, edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]) =&gt; java.lang.String)java.lang.String">/:</a> <a href="#46932" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#115526" title="java.lang.String">_</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#115527" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">_</a><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;)&quot;)" class="string">&quot;)&quot;</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>


<span class="comment">/**
 * Represents a range inside RangeTable. StartKey is included in the range
 * TODO Should be an inner class of RangeTable, but it is impossible to create a RangeType without an existing parent object
 */</span>
case <span class="keyword">class</span> <a title="class RangeType[KeyType, ValueType] extends java.lang.Object with ScalaObject with Product with Serializable" id="115763">RangeType</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="46797">KeyType</a>, <a title="&gt;: Nothing &lt;: Any" id="46798">ValueType</a><span class="delimiter">]</span><a href="#115763" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="Option[KeyType]" id="115756">startKey</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="Seq[ValueType]" id="115757">values</a>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(value: ValueType)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="45852">add</a><span class="delimiter">(</span><a title="ValueType" id="115199">value</a>: <a href="#46798" title="ValueType">ValueType</a><span class="delimiter">)</span>: <a href="#115763" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#115757" title="=&gt; Seq[ValueType]">values</a>.<span title="(elem: ValueType)Int">indexOf</span><span class="delimiter">(</span><a href="#115199" title="ValueType">value</a><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.IllegalArgumentException" class="keyword">new</span> <span title="java.lang.IllegalArgumentException">IllegalArgumentException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Value already exists&quot;)" class="string">&quot;Value already exists&quot;</span><span class="delimiter">)</span>
    <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#115763" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">(</span><a href="#115756" title="=&gt; Option[KeyType]">startKey</a>, <a href="#115199" title="ValueType">value</a> <a href="#115565" title="(elem: ValueType)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[ValueType],ValueType,Seq[ValueType]])Seq[ValueType]">+:</a> <a href="#115757" title="=&gt; Seq[ValueType]">values</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Removes a value from the Range
   */</span>
  <span class="keyword">def</span> <a title="(value: ValueType)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="45853">remove</a><span class="delimiter">(</span><a title="ValueType" id="115220">value</a>: <a href="#46798" title="ValueType">ValueType</a><span class="delimiter">)</span>: <a href="#115763" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#115757" title="=&gt; Seq[ValueType]">values</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;It is not allowed to delete the last element in a range&quot;)" class="string">&quot;It is not allowed to delete the last element in a range&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#115763" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">(</span><a href="#115756" title="=&gt; Option[KeyType]">startKey</a>, <a href="#115757" title="=&gt; Seq[ValueType]">values</a>.<span title="(p: ValueType =&gt; Boolean)Seq[ValueType]">filterNot</span><span class="delimiter">(</span><a href="#115638" title="ValueType">_</a> <span title="(x$1: Any)Boolean">==</span> <a href="#115220" title="ValueType">value</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.lang.String" id="45854">toString</a> = <span class="delimiter">{</span>
    <span title="java.lang.String" class="keyword">if</span> <span class="delimiter">(</span><a href="#115757" title="=&gt; Seq[ValueType]">values</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>
      <span title="java.lang.String(&quot;[&quot;)" class="string">&quot;[&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#115756" title="=&gt; Option[KeyType]">startKey</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;:()]&quot;)" class="string">&quot;:()]&quot;</span>
    <span class="keyword">else</span>
      <span title="java.lang.String(&quot;[&quot;)" class="string">&quot;[&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#115756" title="=&gt; Option[KeyType]">startKey</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;:(&quot;)" class="string">&quot;:(&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span class="delimiter">(</span><a href="#115757" title="=&gt; Seq[ValueType]">values</a>.<span title="=&gt; ValueType">head</span>.<span title="()java.lang.String">toString</span> <a href="#115655" title="(z: java.lang.String)(op: (java.lang.String, ValueType) =&gt; java.lang.String)java.lang.String">/:</a> <a href="#115757" title="=&gt; Seq[ValueType]">values</a>.<span title="=&gt; Seq[ValueType]">tail</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#115672" title="java.lang.String">_</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#115673" title="ValueType">_</a><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;)]&quot;)" class="string">&quot;)]&quot;</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>