<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>util/RangeTable.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs.scads.util

<span class="keyword">import</span> java.util.<span class="delimiter">{</span>Comparator, Arrays<span class="delimiter">}</span>
<span class="keyword">import</span> net.lag.logging.Logger

<span class="comment">/**
 * Range Table data structure. Allows to split the range -inf to inf in arbitrary sub-ranges and assign values per sub-range.
 * The operations are thread-safe
 *
 * Constructor assigns values to the range -inf to inf. This range can than be split by split(key). Keys are compared with the given
 * comparator
 *
 * TODO RangeTable should be fully immutable (also for adding values). Makes programming the protocols easier
 */</span>
<span class="keyword">class</span> <a title="class RangeTable[KeyType, ValueType] extends java.lang.Object with ScalaObject" id="9986">RangeTable</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="9987">KeyType</a>, <a title="&gt;: Nothing &lt;: Any" id="9988">ValueType</a><span class="delimiter">]</span><a href="#9986" title="ScalaObject" class="delimiter">(</a>
        <span class="keyword">val</span> <a title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="40015">rTable</a>: <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Array</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span>,
        <span class="keyword">val</span> <a title="java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="40016">keyComparator</a>: <span title="java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Comparator</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span>,
        <span class="keyword">val</span> <a title="(Seq[ValueType], Seq[ValueType]) =&gt; Boolean" id="40017">mergeCondition</a>: <span class="delimiter">(</span>Seq<span class="delimiter">[</span>ValueType<span class="delimiter">]</span>, Seq<span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span> =&gt; Boolean<span class="delimiter">)</span> <span class="delimiter">{</span>
  <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#40015" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span> , <span title="java.lang.String(&quot;At least the startKey (None) has to exist at any time&quot;)" class="string">&quot;At least the startKey (None) has to exist at any time&quot;</span><span class="delimiter">)</span>
  <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#40015" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">head</span>.<a href="#96290" title="=&gt; Option[KeyType]">startKey</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="object None">None</span>, <span title="java.lang.String(&quot;First key has to be None, but was &quot;)" class="string">&quot;First key has to be None, but was &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#40015" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">head</span>.<a href="#96290" title="=&gt; Option[KeyType]">startKey</a> <span class="delimiter">)</span>

  <span class="keyword">protected</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="38459">logger</a> = <span title="()net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">/**
   *  Helper constructor for creating the Comparator
   */</span>
  <span class="keyword">def</span> <a title="(rTable: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]], keyComp: (KeyType, KeyType) =&gt; Int, mergeCondition: (Seq[ValueType], Seq[ValueType]) =&gt; Boolean)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="38460" class="keyword">this</a><span class="delimiter">(</span><a title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="40009">rTable</a>: <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Array</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span>,
           <a title="(KeyType, KeyType) =&gt; Int" id="40010">keyComp</a>: <span class="delimiter">(</span>KeyType, KeyType<span class="delimiter">)</span> =&gt; Int,
           <a title="(Seq[ValueType], Seq[ValueType]) =&gt; Boolean" id="40011">mergeCondition</a>: <span class="delimiter">(</span>Seq<span class="delimiter">[</span>ValueType<span class="delimiter">]</span>, Seq<span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span> =&gt; Boolean<span class="delimiter">)</span> = <span title="Unit" class="delimiter">{</span>
    <a href="#9986" title="RangeTable.this.type" class="keyword">this</a> <span class="delimiter">(</span><a href="#40009" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>,
      <a href="#93857" title="java.lang.Object with java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="93857">Comparator</a><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">def</span> <a title="(a: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType], b: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])Int" id="93859">compare</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="93860">a</a>: <a href="#96297" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span>, <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="93861">b</a>: <a href="#96297" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
          <span title="(_1: Option[KeyType], _2: Option[KeyType])(Option[KeyType], Option[KeyType])" class="delimiter">(</span><a href="#93860" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">a</a>.<a href="#96290" title="=&gt; Option[KeyType]">startKey</a>, <a href="#93861" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">b</a>.<a href="#96290" title="=&gt; Option[KeyType]">startKey</a><span class="delimiter">)</span> <span title="Int" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="Int(0)" class="delimiter">(</span><span title="object None">None</span>, <span title="object None">None</span><span class="delimiter">)</span> =&gt; <span title="Int(0)" class="int">0</span>
            <span class="keyword">case</span> <span title="Int(-1)" class="delimiter">(</span><span title="object None">None</span>, _<span class="delimiter">)</span> =&gt; -<span title="Int(-1)" class="int">1</span>
            <span class="keyword">case</span> <span title="Int(1)" class="delimiter">(</span>_, <span title="object None">None</span><span class="delimiter">)</span> =&gt; <span title="Int(1)" class="int">1</span>
            <span class="keyword">case</span> <span title="Int" class="delimiter">(</span>Some<span class="delimiter">(</span><a title="KeyType" id="93882">a</a><span class="delimiter">)</span>, Some<span class="delimiter">(</span><a title="KeyType" id="93884">b</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#40010" title="(v1: KeyType, v2: KeyType)Int">keyComp</a><span class="delimiter">(</span><a href="#93882" title="KeyType">a</a>, <a href="#93884" title="KeyType">b</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>,
      <a href="#40011" title="(Seq[ValueType], Seq[ValueType]) =&gt; Boolean">mergeCondition</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Creates a new RangeTable from a Simple Seq
   */</span>
  <span class="keyword">def</span> <a title="(initRanges: Seq[(Option[KeyType], Seq[ValueType])], keyComp: (KeyType, KeyType) =&gt; Int, mergeCondition: (Seq[ValueType], Seq[ValueType]) =&gt; Boolean)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="38461" class="keyword">this</a><span class="delimiter">(</span><a title="Seq[(Option[KeyType], Seq[ValueType])]" id="40003">initRanges</a>: <span title="Seq[(Option[KeyType], Seq[ValueType])]">Seq</span><span class="delimiter">[</span><span class="delimiter">(</span>Option<span class="delimiter">[</span>KeyType<span class="delimiter">]</span>, Seq<span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">]</span>,
           <a title="(KeyType, KeyType) =&gt; Int" id="40004">keyComp</a>: <span class="delimiter">(</span>KeyType, KeyType<span class="delimiter">)</span> =&gt; Int,
           <a title="(Seq[ValueType], Seq[ValueType]) =&gt; Boolean" id="40005">mergeCondition</a>: <span class="delimiter">(</span>Seq<span class="delimiter">[</span>ValueType<span class="delimiter">]</span>, Seq<span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span> =&gt; Boolean<span class="delimiter">)</span> =
    <a href="#38460" title="(rTable: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]], keyComp: (KeyType, KeyType) =&gt; Int, mergeCondition: (Seq[ValueType], Seq[ValueType]) =&gt; Boolean)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">this</a> <span class="delimiter">(</span><a href="#40003" title="Seq[(Option[KeyType], Seq[ValueType])]">initRanges</a>.<span title="(f: (Option[KeyType], Seq[ValueType]) =&gt; edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Option[KeyType], Seq[ValueType])],edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType],Seq[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]])Seq[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType],Seq[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]]" class="delimiter">(</span><a title="(Option[KeyType], Seq[ValueType])" id="93912">item</a> =&gt; <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#96297" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><a href="#93912" title="(Option[KeyType], Seq[ValueType])">item</a>.<span title="=&gt; Option[KeyType]">_1</span>, <a href="#93912" title="(Option[KeyType], Seq[ValueType])">item</a>.<span title="=&gt; Seq[ValueType]">_2</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(implicit evidence$1: ClassManifest[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">toArray</span>, <a href="#40004" title="(KeyType, KeyType) =&gt; Int">keyComp</a>, <a href="#40005" title="(Seq[ValueType], Seq[ValueType]) =&gt; Boolean">mergeCondition</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Helper case class to return all ranges (left, center, right) for a given key
   */</span>
  case <span class="keyword">class</span> <a title="class RangeBound extends java.lang.Object with ScalaObject with Product with Serializable" id="93995">RangeBound</a><a href="#93995" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="94178">left</a>: <a href="#96297" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="94179">center</a>: <a href="#96297" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="94180">right</a>: <a href="#96297" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">)</span>


  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(key: KeyType)Int" id="38465">binarySearch</a><span class="delimiter">(</span><a title="KeyType" id="94046">key</a>: <a href="#9987" title="KeyType">KeyType</a><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <a href="#38466" title="(key: Option[KeyType])Int">binarySearch</a><span class="delimiter">(</span><span title="(x: KeyType)Some[KeyType]">Some</span><span class="delimiter">(</span><a href="#94046" title="KeyType">key</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>


  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(key: Option[KeyType])Int" id="38466">binarySearch</a><span class="delimiter">(</span><a title="Option[KeyType]" id="94052">key</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="94059">pKey</a> = <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#96297" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><a href="#94052" title="Option[KeyType]">key</a>, <span title="object Nil">Nil</span><span class="delimiter">)</span>
    <span title="object java.util.Arrays">Arrays</span>.<span title="(x$1: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType] with java.lang.Object], x$2: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType], x$3: java.util.Comparator[_ &gt;: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])Int">binarySearch</span><span class="delimiter">(</span><a href="#40015" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>, <a href="#94059" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">pKey</a>, <a href="#40016" title="=&gt; java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">keyComparator</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * If the key is inside the range binarysearch returns a neg. value. This calc corrects it.
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(idx: Int)Int" id="38467">calcMidIdx</a><span class="delimiter">(</span><a title="Int" id="94105">idx</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">(</span><a href="#94105" title="Int">idx</a> <span title="(x: Int)Int">*</span> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <span title="(x: Int)Int">-</span> <span title="Int(2)" class="int">2</span>

  <span class="comment">/**
   * Returns the idx for the corresponding range
   */</span>
  <span class="keyword">def</span> <a title="(key: Option[KeyType])Int" id="38468">idxForKey</a><span class="delimiter">(</span><a title="Option[KeyType]" id="94115">key</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="94117">bpos</a> = <a href="#38466" title="(key: Option[KeyType])Int">binarySearch</a><span class="delimiter">(</span><a href="#94115" title="Option[KeyType]">key</a><span class="delimiter">)</span>

    <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#94117" title="Int">bpos</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="comment">//nb is in range. This is the most common case, should be placed first</span>
      <a href="#38467" title="(idx: Int)Int">calcMidIdx</a><span class="delimiter">(</span><a href="#94117" title="Int">bpos</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#94117" title="Int">bpos</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#40015" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
      <a href="#94117" title="Int">bpos</a>
    <span class="keyword">else</span>
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;A key always has to belong to a range. Probably the given comparison function is incorrect.&quot;)" class="string">&quot;A key always has to belong to a range. Probably the given comparison function is incorrect.&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Returns the list of values which are attached to the range for the given key
   */</span>
  <span class="keyword">def</span> <a title="(key: KeyType)Seq[ValueType]" id="38469">valuesForKey</a><span class="delimiter">(</span><a title="KeyType" id="57207">key</a>: <a href="#9987" title="KeyType">KeyType</a><span class="delimiter">)</span>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span> = <a href="#38470" title="(key: Option[KeyType])Seq[ValueType]">valuesForKey</a><span class="delimiter">(</span><span title="(x: KeyType)Option[KeyType]">Option</span><span class="delimiter">(</span><a href="#57207" title="KeyType">key</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Returns all values attached to the range for the given key
   */</span>
  <span class="keyword">def</span> <a title="(key: Option[KeyType])Seq[ValueType]" id="38470">valuesForKey</a><span class="delimiter">(</span><a title="Option[KeyType]" id="57204">key</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#40015" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#38468" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#57204" title="Option[KeyType]">key</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="#96291" title="=&gt; Seq[ValueType]">values</a>
  <span class="delimiter">}</span>


  <span class="comment">/**
   * Returns the surrounding ranges for a key
   * If the value is in the most left range starting with None, the left and center range will be the same
   * Warning: Right ranges can be just a placeholder for None with an empty set of servers
   *
   */</span>
  <span class="keyword">def</span> <a title="(key: KeyType)RangeTable.this.RangeBound" id="38471">lowerUpperBound</a><span class="delimiter">(</span><a title="KeyType" id="58290">key</a> : <a href="#9987" title="KeyType">KeyType</a><span class="delimiter">)</span> : <a href="#93995" title="RangeTable.this.RangeBound">RangeBound</a> = <a href="#38472" title="(startKey: Option[KeyType])RangeTable.this.RangeBound">lowerUpperBound</a><span class="delimiter">(</span><span title="(x: KeyType)Some[KeyType]">Some</span><span class="delimiter">(</span><a href="#58290" title="KeyType">key</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(startKey: Option[KeyType])RangeTable.this.RangeBound" id="38472">lowerUpperBound</a><span class="delimiter">(</span><a title="Option[KeyType]" id="58285">startKey</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#93995" title="RangeTable.this.RangeBound">RangeBound</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="94154">idx</a> = <a href="#38468" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#58285" title="Option[KeyType]">startKey</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="94155">lowerBound</a> = <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">if</span> <span class="delimiter">(</span><a href="#94154" title="Int">idx</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#40015" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#40015" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#94154" title="Int">idx</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="94156">upperBound</a> = <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">if</span> <span class="delimiter">(</span><a href="#94154" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span> <span title="(x: Int)Boolean">==</span> <a href="#40015" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#96297" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><span title="object None">None</span>, <span title="object Nil">Nil</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#40015" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#94154" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <a href="#93995" title="(left: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType], center: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType], right: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])RangeTable.this.RangeBound">RangeBound</a><span class="delimiter">(</span><a href="#94155" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">lowerBound</a>, <a href="#40015" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#94154" title="Int">idx</a><span class="delimiter">)</span>, <a href="#94156" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">upperBound</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(key: KeyType)Boolean" id="38473">isSplitKey</a><span class="delimiter">(</span><a title="KeyType" id="58280">key</a>: <a href="#9987" title="KeyType">KeyType</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="94188">bpos</a> = <a href="#38465" title="(key: KeyType)Int">binarySearch</a><span class="delimiter">(</span><a href="#58280" title="KeyType">key</a><span class="delimiter">)</span>
    <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#94188" title="Int">bpos</a> <span title="(x: Int)Boolean">==</span> <a href="#40015" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
      <span title="Boolean(false)" class="keyword">false</span>
    <span class="keyword">else</span> <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#94188" title="Int">bpos</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">else</span>
      <span title="Boolean(false)" class="keyword">false</span>
  <span class="delimiter">}</span>


  <span class="comment">/**
   * Returns all ranges from startKey to endKey
   */</span>
  <span class="keyword">def</span> <a title="(startKey: Option[KeyType], endKey: Option[KeyType])Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="38474">valuesForRange</a><span class="delimiter">(</span><a title="Option[KeyType]" id="60162">startKey</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span>, <a title="Option[KeyType]" id="60163">endKey</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Array</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="(_1: Option[KeyType], _2: Option[KeyType])(Option[KeyType], Option[KeyType])" class="delimiter">(</span><a href="#60162" title="Option[KeyType]">startKey</a>, <a href="#60163" title="Option[KeyType]">endKey</a><span class="delimiter">)</span> <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Nothing" class="delimiter">(</span><span title="object None">None</span>, <span title="object None">None</span><span class="delimiter">)</span> =&gt; <span title="Nothing" class="keyword">return</span> <a href="#40015" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>
      <span class="keyword">case</span> <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" class="delimiter">(</span><span title="object None">None</span>, <a title="Option[KeyType]" id="94213">e</a><span class="delimiter">)</span> =&gt; <a href="#40015" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="(from: Int, until: Int)Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">slice</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#38468" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#94213" title="Option[KeyType]">e</a><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" class="delimiter">(</span><a title="Option[KeyType]" id="94345">s</a>, <span title="object None">None</span><span class="delimiter">)</span> =&gt; <a href="#40015" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="(from: Int, until: Int)Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">slice</span><span class="delimiter">(</span><a href="#38468" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#94345" title="Option[KeyType]">s</a><span class="delimiter">)</span>, <a href="#40015" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" class="delimiter">(</span><a title="Option[KeyType]" id="94594">s</a>, <a title="Option[KeyType]" id="94595">e</a><span class="delimiter">)</span> =&gt; <a href="#40015" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="(from: Int, until: Int)Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">slice</span><span class="delimiter">(</span><a href="#38468" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#94594" title="Option[KeyType]">s</a><span class="delimiter">)</span>, <a href="#38468" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#94595" title="Option[KeyType]">e</a><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


  <span class="comment">/**
   * Splits the range at the key position. The left range includes the split key
   * The values are either left or right attached.
   * If the splitKey already exists, null is returned.
   *
   */</span>
  <span class="keyword">def</span> <a title="(key: KeyType, values: Seq[ValueType], leftAttached: Boolean)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="38475">split</a><span class="delimiter">(</span><a title="KeyType" id="58359">key</a>: <a href="#9987" title="KeyType">KeyType</a>, <a title="Seq[ValueType]" id="58360">values</a>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span>, <a title="Boolean" id="58363">leftAttached</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>: <a href="#9986" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="94723">idx</a> = <a href="#38465" title="(key: KeyType)Int">binarySearch</a><span class="delimiter">(</span><a href="#58359" title="KeyType">key</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#94723" title="Int">idx</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#94723" title="Int">idx</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#40015" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">else</span>
      <a href="#94723" title="Int">idx</a> = <a href="#38467" title="(idx: Int)Int">calcMidIdx</a><span class="delimiter">(</span><a href="#94723" title="Int">idx</a><span class="delimiter">)</span>
    <span title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">if</span> <span class="delimiter">(</span><a href="#58363" title="Boolean">leftAttached</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#38476" title="(key: KeyType, leftValues: Seq[ValueType], rightValues: Seq[ValueType])edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">split</a><span class="delimiter">(</span><a href="#58359" title="KeyType">key</a>, <a href="#58360" title="Seq[ValueType]">values</a>, <a href="#40015" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#94723" title="Int">idx</a><span class="delimiter">)</span>.<a href="#96291" title="=&gt; Seq[ValueType]">values</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#38476" title="(key: KeyType, leftValues: Seq[ValueType], rightValues: Seq[ValueType])edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">split</a><span class="delimiter">(</span><a href="#58359" title="KeyType">key</a>, <a href="#40015" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#94723" title="Int">idx</a><span class="delimiter">)</span>.<a href="#96291" title="=&gt; Seq[ValueType]">values</a>, <a href="#58360" title="Seq[ValueType]">values</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Splits the range at the key position. The left range includes the split key
   * The values are either left or right attached.
   *
   */</span>
  <span class="keyword">def</span> <a title="(key: KeyType, leftValues: Seq[ValueType], rightValues: Seq[ValueType])edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="38476">split</a><span class="delimiter">(</span><a title="KeyType" id="58352">key</a>: <a href="#9987" title="KeyType">KeyType</a>, <a title="Seq[ValueType]" id="58353">leftValues</a>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span>, <a title="Seq[ValueType]" id="58354">rightValues</a>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#9986" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="94873">idx</a> = <a href="#38465" title="(key: KeyType)Int">binarySearch</a><span class="delimiter">(</span><a href="#58352" title="KeyType">key</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#94873" title="Int">idx</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#94873" title="Int">idx</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#40015" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">else</span>
      <a href="#94873" title="Int">idx</a> = <a href="#38467" title="(idx: Int)Int">calcMidIdx</a><span class="delimiter">(</span><a href="#94873" title="Int">idx</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="94874">newRTable</a> = <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" class="keyword">new</span> <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Array</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="#40015" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span title="object java.lang.System">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#40015" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>, <span title="Int(0)" class="int">0</span>, <a href="#94874" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <span title="Int(0)" class="int">0</span>, <a href="#94873" title="Int">idx</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#94873" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(2)" class="int">2</span> <span title="(x: Int)Boolean">&lt;</span> <a href="#94874" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <span title="object java.lang.System">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#40015" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>, <a href="#94873" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>, <a href="#94874" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <a href="#94873" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(2)" class="int">2</span>, <a href="#40015" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <a href="#94873" title="Int">idx</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <a href="#94874" title="(i: Int, x: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])Unit">newRTable</a><span class="delimiter">(</span><a href="#94873" title="Int">idx</a><span class="delimiter">)</span> = <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#96297" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">(</span><a href="#40015" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#94873" title="Int">idx</a><span class="delimiter">)</span>.<a href="#96290" title="=&gt; Option[KeyType]">startKey</a>, <a href="#58353" title="Seq[ValueType]">leftValues</a><span class="delimiter">)</span>
    <a href="#94874" title="(i: Int, x: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])Unit">newRTable</a><span class="delimiter">(</span><a href="#94873" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> = <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#96297" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">(</span><span title="(x: KeyType)Option[KeyType]">Option</span><span class="delimiter">(</span><a href="#58352" title="KeyType">key</a><span class="delimiter">)</span>, <a href="#58354" title="Seq[ValueType]">rightValues</a><span class="delimiter">)</span>
    <span title="Nothing" class="keyword">return</span> <span title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">new</span> <a href="#9986" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><a href="#94874" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <a href="#40016" title="=&gt; java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">keyComparator</a>, <a href="#40017" title="=&gt; (Seq[ValueType], Seq[ValueType]) =&gt; Boolean">mergeCondition</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>


  <span class="comment">/**
   * Checks if the given range is an existing range
   */</span>
  <span class="keyword">def</span> <a title="(startKey: Option[KeyType], endKey: Option[KeyType])Boolean" id="38477">checkRange</a><span class="delimiter">(</span><a title="Option[KeyType]" id="95328">startKey</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span>, <a title="Option[KeyType]" id="95329">endKey</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="95331">idx</a> = <a href="#38466" title="(key: Option[KeyType])Int">binarySearch</a><span class="delimiter">(</span><a href="#95328" title="Option[KeyType]">startKey</a><span class="delimiter">)</span>
    <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#95331" title="Int">idx</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#40015" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <a href="#95331" title="Int">idx</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#95328" title="Option[KeyType]">startKey</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#40015" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#95331" title="Int">idx</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#95329" title="Option[KeyType]">endKey</a>.<span title="=&gt; Boolean">isEmpty</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#95328" title="Option[KeyType]">startKey</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#40015" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#95331" title="Int">idx</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#95329" title="Option[KeyType]">endKey</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#40015" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#95331" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


  <span class="comment">/**
   *  Merges the ranges left and right from the key. Per default the left values overwrite the right values.
   */</span>
  <span class="keyword">def</span> <a title="(key: KeyType, deleteLeft: Boolean)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="38478">merge</a><span class="delimiter">(</span><a title="KeyType" id="58527">key</a>: <a href="#9987" title="KeyType">KeyType</a>, <a title="Boolean" id="58530">deleteLeft</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>: <a href="#9986" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="95363">bpos</a> = <a href="#38465" title="(key: KeyType)Int">binarySearch</a><span class="delimiter">(</span><a href="#58527" title="KeyType">key</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#95363" title="Int">bpos</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">||</span> <a href="#95363" title="Int">bpos</a> <span title="(x: Int)Boolean">==</span> <a href="#40015" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <span title="Null(null)" class="keyword">null</span>
    <span title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">if</span> <span class="delimiter">(</span><a href="#58530" title="Boolean">deleteLeft</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Nothing" class="keyword">return</span> <a href="#38481" title="(key: KeyType, values: Seq[ValueType])edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">merge</a><span class="delimiter">(</span><a href="#58527" title="KeyType">key</a>, <a href="#40015" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#95363" title="Int">bpos</a><span class="delimiter">)</span>.<a href="#96291" title="=&gt; Seq[ValueType]">values</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span title="Nothing" class="keyword">return</span> <a href="#38481" title="(key: KeyType, values: Seq[ValueType])edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">merge</a><span class="delimiter">(</span><a href="#58527" title="KeyType">key</a>, <a href="#40015" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#95363" title="Int">bpos</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<a href="#96291" title="=&gt; Seq[ValueType]">values</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(key: KeyType)Boolean" id="38479">checkMergeCondition</a><span class="delimiter">(</span><a title="KeyType" id="58477">key</a>: <a href="#9987" title="KeyType">KeyType</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="95394">bpos</a> = <a href="#38465" title="(key: KeyType)Int">binarySearch</a><span class="delimiter">(</span><a href="#58477" title="KeyType">key</a><span class="delimiter">)</span>
    <a href="#38480" title="(bpos: Int)Boolean">checkMergeCondition</a><span class="delimiter">(</span><a href="#95394" title="Int">bpos</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(bpos: Int)Boolean" id="38480">checkMergeCondition</a><span class="delimiter">(</span><a title="Int" id="95405">bpos</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#95405" title="Int">bpos</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">||</span> <a href="#95405" title="Int">bpos</a> <span title="(x: Int)Boolean">==</span> <a href="#40015" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span><span class="delimiter">{</span>
      <a href="#38458" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;[%s] Merge Condition failed - key is not a split key&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#9986" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span><span class="keyword">else</span> <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#40017" title="(v1: Seq[ValueType], v2: Seq[ValueType])Boolean">mergeCondition</a><span class="delimiter">(</span><a href="#40015" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#95405" title="Int">bpos</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<a href="#96291" title="=&gt; Seq[ValueType]">values</a>, <a href="#40015" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#95405" title="Int">bpos</a><span class="delimiter">)</span>.<a href="#96291" title="=&gt; Seq[ValueType]">values</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">{</span>
      <a href="#38458" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;[%s] Merge Condition failed - sets are not equal. $s != $s&quot;)" class="string">&quot;[%s] Merge Condition failed - sets are not equal. $s != $s&quot;</span>, <a href="#9986" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">this</a>, <a href="#40015" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#95405" title="Int">bpos</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <a href="#40015" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#95405" title="Int">bpos</a><span class="delimiter">)</span> <span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span><span class="keyword">else</span>
      <span title="Nothing" class="keyword">return</span> <span title="Boolean(true)" class="keyword">true</span>
  <span class="delimiter">}</span>


  <span class="comment">/**
   * Merges the ranges left and right from the key. The new partition is assigned the given set of servers.
   */</span>
  <span class="keyword">def</span> <a title="(key: KeyType, values: Seq[ValueType])edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="38481">merge</a><span class="delimiter">(</span><a title="KeyType" id="58522">key</a>: <a href="#9987" title="KeyType">KeyType</a>, <a title="Seq[ValueType]" id="58523">values</a>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#9986" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="95436">bpos</a> = <a href="#38465" title="(key: KeyType)Int">binarySearch</a><span class="delimiter">(</span><a href="#58522" title="KeyType">key</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#38480" title="(bpos: Int)Boolean">checkMergeCondition</a><span class="delimiter">(</span><a href="#95436" title="Int">bpos</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">val</span> <a title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="95437">newRTable</a>: <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Array</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span> = <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" class="keyword">new</span> <span title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Array</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="#40015" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span title="object java.lang.System">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#40015" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>, <span title="Int(0)" class="int">0</span>, <a href="#95437" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <span title="Int(0)" class="int">0</span>, <a href="#95436" title="Int">bpos</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#95436" title="Int">bpos</a> <span title="(x: Int)Boolean">!=</span> <a href="#95437" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
      <span title="object java.lang.System">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#40015" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>, <a href="#95436" title="Int">bpos</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>, <a href="#95437" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <a href="#95436" title="Int">bpos</a>, <a href="#95437" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <a href="#95436" title="Int">bpos</a><span class="delimiter">)</span>
    <a href="#95437" title="(i: Int, x: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])Unit">newRTable</a><span class="delimiter">(</span><a href="#95436" title="Int">bpos</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> = <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#96297" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">(</span><a href="#95437" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">newRTable</a><span class="delimiter">(</span><a href="#95436" title="Int">bpos</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<a href="#96290" title="=&gt; Option[KeyType]">startKey</a>, <a href="#58523" title="Seq[ValueType]">values</a><span class="delimiter">)</span>
    <span title="Nothing" class="keyword">return</span> <span title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">new</span> <a href="#9986" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><a href="#95437" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <a href="#40016" title="=&gt; java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">keyComparator</a>, <a href="#40017" title="=&gt; (Seq[ValueType], Seq[ValueType]) =&gt; Boolean">mergeCondition</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Seq[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="38482">ranges</a>: <span title="Seq[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">Seq</span><span class="delimiter">[</span>RangeType<span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="#40015" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="=&gt; Seq[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">toSeq</span>

  <span class="keyword">def</span> <a title="(key: KeyType, value: ValueType)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="38483">addValueToRange</a><span class="delimiter">(</span><a title="KeyType" id="58710">key</a>: <a href="#9987" title="KeyType">KeyType</a>, <a title="ValueType" id="58711">value</a>: <a href="#9988" title="ValueType">ValueType</a><span class="delimiter">)</span>: <a href="#9986" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <a href="#38484" title="(key: Option[KeyType], value: ValueType)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">addValueToRange</a><span class="delimiter">(</span><span title="(x: KeyType)Option[KeyType]">Option</span><span class="delimiter">(</span><a href="#58710" title="KeyType">key</a><span class="delimiter">)</span>, <a href="#58711" title="ValueType">value</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(key: Option[KeyType], value: ValueType)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="38484">addValueToRange</a><span class="delimiter">(</span><a title="Option[KeyType]" id="58705">key</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span>, <a title="ValueType" id="58706">value</a>: <a href="#9988" title="ValueType">ValueType</a><span class="delimiter">)</span>: <a href="#9986" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="95748">idx</a> = <a href="#38468" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#58705" title="Option[KeyType]">key</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="95749">range</a> = <a href="#40015" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#95748" title="Int">idx</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="95750">newRTable</a> = <a href="#40015" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="()Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">clone</span>
    <a href="#95750" title="(i: Int, x: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])Unit">newRTable</a><span class="delimiter">(</span><a href="#95748" title="Int">idx</a><span class="delimiter">)</span> = <a href="#95749" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">range</a>.<a href="#38935" title="(value: ValueType)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">add</a><span class="delimiter">(</span><a href="#58706" title="ValueType">value</a><span class="delimiter">)</span>
    <span title="Nothing" class="keyword">return</span> <span title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">new</span> <a href="#9986" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><a href="#95750" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <a href="#40016" title="=&gt; java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">keyComparator</a>, <a href="#40017" title="=&gt; (Seq[ValueType], Seq[ValueType]) =&gt; Boolean">mergeCondition</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(key: KeyType, value: ValueType)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="38485">removeValueFromRange</a><span class="delimiter">(</span><a title="KeyType" id="58638">key</a>: <a href="#9987" title="KeyType">KeyType</a>, <a title="ValueType" id="58639">value</a>: <a href="#9988" title="ValueType">ValueType</a><span class="delimiter">)</span>: <a href="#9986" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <a href="#38486" title="(key: Option[KeyType], value: ValueType)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">removeValueFromRange</a><span class="delimiter">(</span><span title="(x: KeyType)Option[KeyType]">Option</span><span class="delimiter">(</span><a href="#58638" title="KeyType">key</a><span class="delimiter">)</span>, <a href="#58639" title="ValueType">value</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(key: Option[KeyType], value: ValueType)edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="38486">removeValueFromRange</a><span class="delimiter">(</span><a title="Option[KeyType]" id="58633">key</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span>, <a title="ValueType" id="58634">value</a>: <a href="#9988" title="ValueType">ValueType</a><span class="delimiter">)</span>: <a href="#9986" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="95769">idx</a> = <a href="#38468" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#58633" title="Option[KeyType]">key</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="95770">range</a> = <a href="#40015" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">rTable</a><span class="delimiter">(</span><a href="#95769" title="Int">idx</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="95771">newRTable</a> = <a href="#40015" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="()Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">clone</span>
    <a href="#95771" title="(i: Int, x: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])Unit">newRTable</a><span class="delimiter">(</span><a href="#95769" title="Int">idx</a><span class="delimiter">)</span> = <a href="#95770" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">range</a>.<a href="#38936" title="(value: ValueType)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">remove</a><span class="delimiter">(</span><a href="#58634" title="ValueType">value</a><span class="delimiter">)</span>
    <span title="Nothing" class="keyword">return</span> <span title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">new</span> <a href="#9986" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><a href="#95771" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <a href="#40016" title="=&gt; java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">keyComparator</a>, <a href="#40017" title="=&gt; (Seq[ValueType], Seq[ValueType]) =&gt; Boolean">mergeCondition</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(key: Option[KeyType], values: Seq[ValueType])edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" id="38487">replaceValues</a><span class="delimiter">(</span><a title="Option[KeyType]" id="95781">key</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span>, <a title="Seq[ValueType]" id="95782">values</a>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#9986" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="95784">idx</a> = <a href="#38468" title="(key: Option[KeyType])Int">idxForKey</a><span class="delimiter">(</span><a href="#95781" title="Option[KeyType]">key</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]" id="95785">newRTable</a> = <a href="#40015" title="=&gt; Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a>.<span title="()Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">clone</span>
    <a href="#95785" title="(i: Int, x: edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType])Unit">newRTable</a><span class="delimiter">(</span><a href="#95784" title="Int">idx</a><span class="delimiter">)</span> = <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#96297" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">(</span><a href="#95785" title="(i: Int)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">newRTable</a><span class="delimiter">(</span><a href="#95784" title="Int">idx</a><span class="delimiter">)</span>.<a href="#96290" title="=&gt; Option[KeyType]">startKey</a>, <a href="#95782" title="Seq[ValueType]">values</a><span class="delimiter">)</span>
    <span title="Nothing" class="keyword">return</span> <span title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]" class="keyword">new</span> <a href="#9986" title="edu.berkeley.cs.scads.util.RangeTable[KeyType,ValueType]">RangeTable</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span><span class="delimiter">(</span><a href="#95785" title="Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">newRTable</a>, <a href="#40016" title="=&gt; java.util.Comparator[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">keyComparator</a>, <a href="#40017" title="=&gt; (Seq[ValueType], Seq[ValueType]) =&gt; Boolean">mergeCondition</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.lang.String" id="38488">toString</a> = <span class="delimiter">{</span>
    <span title="java.lang.String(&quot;RTable(&quot;)" class="string">&quot;RTable(&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span> <a href="#95806" title="(z: java.lang.String)(op: (java.lang.String, edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]) =&gt; java.lang.String)java.lang.String">/:</a> <a href="#40015" title="(xs: Array[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]]">rTable</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#96076" title="java.lang.String">_</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#96077" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">_</a><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;)&quot;)" class="string">&quot;)&quot;</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>


<span class="comment">/**
 * Represents a range inside RangeTable. StartKey is included in the range
 * TODO Should be an inner class of RangeTable, but it is impossible to create a RangeType without an existing parent object
 */</span>
case <span class="keyword">class</span> <a title="class RangeType[KeyType, ValueType] extends java.lang.Object with ScalaObject with Product with Serializable" id="96297">RangeType</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="39880">KeyType</a>, <a title="&gt;: Nothing &lt;: Any" id="39881">ValueType</a><span class="delimiter">]</span><a href="#96297" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="Option[KeyType]" id="96290">startKey</a>: <span title="Option[KeyType]">Option</span><span class="delimiter">[</span>KeyType<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="Seq[ValueType]" id="96291">values</a>: <span title="Seq[ValueType]">Seq</span><span class="delimiter">[</span>ValueType<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(value: ValueType)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="38935">add</a><span class="delimiter">(</span><a title="ValueType" id="95753">value</a>: <a href="#39881" title="ValueType">ValueType</a><span class="delimiter">)</span>: <a href="#96297" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#96291" title="=&gt; Seq[ValueType]">values</a>.<span title="(elem: ValueType)Int">indexOf</span><span class="delimiter">(</span><a href="#95753" title="ValueType">value</a><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.IllegalArgumentException" class="keyword">new</span> <span title="java.lang.IllegalArgumentException">IllegalArgumentException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Value already exists&quot;)" class="string">&quot;Value already exists&quot;</span><span class="delimiter">)</span>
    <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#96297" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">(</span><a href="#96290" title="=&gt; Option[KeyType]">startKey</a>, <a href="#95753" title="ValueType">value</a> <a href="#96115" title="(elem: ValueType)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[ValueType],ValueType,Seq[ValueType]])Seq[ValueType]">+:</a> <a href="#96291" title="=&gt; Seq[ValueType]">values</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Removes a value from the Range
   */</span>
  <span class="keyword">def</span> <a title="(value: ValueType)edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" id="38936">remove</a><span class="delimiter">(</span><a title="ValueType" id="95774">value</a>: <a href="#39881" title="ValueType">ValueType</a><span class="delimiter">)</span>: <a href="#96297" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">[</span>KeyType, ValueType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#96291" title="=&gt; Seq[ValueType]">values</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;It is not allowed to delete the last element in a range&quot;)" class="string">&quot;It is not allowed to delete the last element in a range&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]" class="keyword">new</span> <a href="#96297" title="edu.berkeley.cs.scads.util.RangeType[KeyType,ValueType]">RangeType</a><span class="delimiter">(</span><a href="#96290" title="=&gt; Option[KeyType]">startKey</a>, <a href="#96291" title="=&gt; Seq[ValueType]">values</a>.<span title="(p: ValueType =&gt; Boolean)Seq[ValueType]">filterNot</span><span class="delimiter">(</span><a href="#96180" title="ValueType">_</a> <span title="(x$1: Any)Boolean">==</span> <a href="#95774" title="ValueType">value</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.lang.String" id="38937">toString</a> = <span class="delimiter">{</span>
    <span title="java.lang.String" class="keyword">if</span> <span class="delimiter">(</span><a href="#96291" title="=&gt; Seq[ValueType]">values</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>
      <span title="java.lang.String(&quot;[&quot;)" class="string">&quot;[&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#96290" title="=&gt; Option[KeyType]">startKey</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;:()]&quot;)" class="string">&quot;:()]&quot;</span>
    <span class="keyword">else</span>
      <span title="java.lang.String(&quot;[&quot;)" class="string">&quot;[&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#96290" title="=&gt; Option[KeyType]">startKey</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;:(&quot;)" class="string">&quot;:(&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span class="delimiter">(</span><a href="#96291" title="=&gt; Seq[ValueType]">values</a>.<span title="=&gt; ValueType">head</span>.<span title="()java.lang.String">toString</span> <a href="#96193" title="(z: java.lang.String)(op: (java.lang.String, ValueType) =&gt; java.lang.String)java.lang.String">/:</a> <a href="#96291" title="=&gt; Seq[ValueType]">values</a>.<span title="=&gt; Seq[ValueType]">tail</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#96210" title="java.lang.String">_</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#96211" title="ValueType">_</a><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;)]&quot;)" class="string">&quot;)]&quot;</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>