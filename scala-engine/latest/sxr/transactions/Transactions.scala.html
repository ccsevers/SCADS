<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>transactions/Transactions.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs.scads.storage.transactions
<span class="keyword">import</span> edu.berkeley.cs.scads.storage._


<span class="keyword">import</span> edu.berkeley.cs.avro.marker._

<span class="keyword">import</span> edu.berkeley.cs.scads.comm._
<span class="keyword">import</span> edu.berkeley.cs.scads.util._

<span class="keyword">import</span> collection.mutable.ArrayBuffer

<span class="keyword">import</span> mdcc.MDCCMetaDefault
<span class="keyword">import</span> org.apache.avro._
<span class="keyword">import</span> generic._
<span class="keyword">import</span> io._
<span class="keyword">import</span> specific._

<span class="keyword">import</span> java.util.Comparator

<span class="keyword">import</span> org.apache.zookeeper._

<span class="keyword">import</span> java.util.concurrent.TimeUnit
<span class="keyword">import</span> java.nio._

<span class="comment">// This works with SpecificNamespace</span>
<span class="keyword">trait</span> <a title="trait Transactions[K &lt;: org.apache.avro.specific.SpecificRecord, V &lt;: org.apache.avro.specific.SpecificRecord] extends java.lang.Object with edu.berkeley.cs.scads.storage.RangeKeyValueStore[K,V] with edu.berkeley.cs.scads.storage.KeyRoutable with edu.berkeley.cs.scads.storage.ZooKeeperGlobalMetadata with edu.berkeley.cs.scads.storage.transactions.TransactionRecordMetadata with edu.berkeley.cs.scads.storage.transactions.TransactionDefaultMetadata with ScalaObject" id="10229">Transactions</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: org.apache.avro.specific.SpecificRecord" id="10230">K</a> &lt;: SpecificRecord, <a title="&gt;: Nothing &lt;: org.apache.avro.specific.SpecificRecord" id="10231">V</a> &lt;: SpecificRecord<span class="delimiter">]</span>
<span title="ScalaObject" class="keyword">extends</span> <a href="../client/Stores.scala.html#10006" title="edu.berkeley.cs.scads.storage.RangeKeyValueStore[K,V]">RangeKeyValueStore</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>
<span class="keyword">with</span> <a href="../client/Interfaces.scala.html#9897" title="edu.berkeley.cs.scads.storage.KeyRoutable">KeyRoutable</a>
<span class="keyword">with</span> <a href="../client/ZooKeeperGlobalMetadata.scala.html#10018" title="edu.berkeley.cs.scads.storage.ZooKeeperGlobalMetadata">ZooKeeperGlobalMetadata</a>
<span class="keyword">with</span> <a href="#10235" title="edu.berkeley.cs.scads.storage.transactions.TransactionRecordMetadata">TransactionRecordMetadata</a>
<span class="keyword">with</span> <a href="#10234" title="edu.berkeley.cs.scads.storage.transactions.TransactionDefaultMetadata">TransactionDefaultMetadata</a> <span class="delimiter">{</span>

  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.transactions.mdcc.MDCCMetaDefault" id="92384">defaultMeta</a> = <a href="protocol/MDCCMetaDefault.scala.html#10396" title="object edu.berkeley.cs.scads.storage.transactions.mdcc.MDCCMetaDefault">MDCCMetaDefault</a>.<a href="protocol/MDCCMetaDefault.scala.html#93108" title="(nsRoot: edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode)edu.berkeley.cs.scads.storage.transactions.mdcc.MDCCMetaDefault">getDefault</a><span class="delimiter">(</span><a href="../client/ZooKeeperGlobalMetadata.scala.html#44871" title="=&gt; edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">nsRoot</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="()edu.berkeley.cs.scads.storage.MDCCMetadata" id="92385">getDefaultMeta</a> = <a href="#92383" title="=&gt; edu.berkeley.cs.scads.storage.transactions.mdcc.MDCCMetaDefault">defaultMeta</a>.<a href="protocol/MDCCMetaDefault.scala.html#93125" title="=&gt; edu.berkeley.cs.scads.storage.MDCCMetadata">defaultMetaData</a>

  <span class="keyword">implicit</span> <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; Manifest[V]" id="92386">valueManifest</a>: <span title="Manifest[V]">Manifest</span><span class="delimiter">[</span>V<span class="delimiter">]</span>

  <span class="comment">// TODO: Don't know why implicit manifest did not work.</span>
  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.transactions.TxProtocol" id="92387">protocolType</a>: <a href="Tx.scala.html#10257" title="edu.berkeley.cs.scads.storage.transactions.TxProtocol">TxProtocol</a> = <a href="Tx.scala.html#92411" title="()edu.berkeley.cs.scads.storage.transactions.TxProtocol2pc">TxProtocol2pc</a><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">// r is the new restriction, and l is the (optionally) existing restriction.</span>
  <span class="comment">// r is a lower restriction (GT or GE).</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(r: edu.berkeley.cs.scads.storage.FieldRestriction, l: Option[edu.berkeley.cs.scads.storage.FieldRestriction])Some[edu.berkeley.cs.scads.storage.FieldRestriction]" id="92389">getLowerRestriction</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.FieldRestriction" id="93133">r</a>: <a href="../Messages.scala.html#9691" title="edu.berkeley.cs.scads.storage.FieldRestriction">FieldRestriction</a>,
                                  <a title="Option[edu.berkeley.cs.scads.storage.FieldRestriction]" id="93134">l</a>: <span title="Option[edu.berkeley.cs.scads.storage.FieldRestriction]">Option</span><span class="delimiter">[</span>FieldRestriction<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.FieldRestriction" id="93137">newRestriction</a> = <span title="(_1: edu.berkeley.cs.scads.storage.FieldRestriction, _2: edu.berkeley.cs.scads.storage.FieldRestriction)(edu.berkeley.cs.scads.storage.FieldRestriction, edu.berkeley.cs.scads.storage.FieldRestriction)" class="delimiter">(</span><a href="#93133" title="edu.berkeley.cs.scads.storage.FieldRestriction">r</a>, <a href="#93134" title="Option[edu.berkeley.cs.scads.storage.FieldRestriction]">l</a>.<span title="(default: =&gt; edu.berkeley.cs.scads.storage.FieldRestriction)edu.berkeley.cs.scads.storage.FieldRestriction">getOrElse</span><span class="delimiter">(</span><a href="#93133" title="edu.berkeley.cs.scads.storage.FieldRestriction">r</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="edu.berkeley.cs.scads.storage.FieldRestriction" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.storage.FieldRestrictionGT" class="delimiter">(</span>FieldRestrictionGT<span class="delimiter">(</span><a title="Double" id="93151">x</a><span class="delimiter">)</span>, FieldRestrictionGT<span class="delimiter">(</span><a title="Double" id="93152">y</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <a href="../Messages.scala.html#27547" title="(value: Double)edu.berkeley.cs.scads.storage.FieldRestrictionGT">FieldRestrictionGT</a><span class="delimiter">(</span>math.<span title="(x: Double, y: Double)Double">max</span><span class="delimiter">(</span><a href="#93151" title="Double">x</a>, <a href="#93152" title="Double">y</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="&lt;none&gt; extends edu.berkeley.cs.avro.marker.AvroRecord with edu.berkeley.cs.scads.storage.FieldRestriction with Product with Serializable" class="delimiter">(</span>FieldRestrictionGT<span class="delimiter">(</span><a title="Double" id="93165">x</a><span class="delimiter">)</span>, FieldRestrictionGE<span class="delimiter">(</span><a title="Double" id="93166">y</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <span title="&lt;none&gt; extends edu.berkeley.cs.avro.marker.AvroRecord with edu.berkeley.cs.scads.storage.FieldRestriction with Product with Serializable" class="keyword">if</span> <span class="delimiter">(</span><a href="#93165" title="Double">x</a> <span title="(x: Double)Boolean">&gt;=</span> <a href="#93166" title="Double">y</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../Messages.scala.html#27547" title="(value: Double)edu.berkeley.cs.scads.storage.FieldRestrictionGT">FieldRestrictionGT</a><span class="delimiter">(</span><a href="#93165" title="Double">x</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="../Messages.scala.html#27601" title="(value: Double)edu.berkeley.cs.scads.storage.FieldRestrictionGE">FieldRestrictionGE</a><span class="delimiter">(</span><a href="#93166" title="Double">y</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="&lt;none&gt; extends edu.berkeley.cs.avro.marker.AvroRecord with edu.berkeley.cs.scads.storage.FieldRestriction with Product with Serializable" class="delimiter">(</span>FieldRestrictionGE<span class="delimiter">(</span><a title="Double" id="93193">x</a><span class="delimiter">)</span>, FieldRestrictionGT<span class="delimiter">(</span><a title="Double" id="93194">y</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <span title="&lt;none&gt; extends edu.berkeley.cs.avro.marker.AvroRecord with edu.berkeley.cs.scads.storage.FieldRestriction with Product with Serializable" class="keyword">if</span> <span class="delimiter">(</span><a href="#93194" title="Double">y</a> <span title="(x: Double)Boolean">&gt;=</span> <a href="#93193" title="Double">x</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../Messages.scala.html#27547" title="(value: Double)edu.berkeley.cs.scads.storage.FieldRestrictionGT">FieldRestrictionGT</a><span class="delimiter">(</span><a href="#93194" title="Double">y</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="../Messages.scala.html#27601" title="(value: Double)edu.berkeley.cs.scads.storage.FieldRestrictionGE">FieldRestrictionGE</a><span class="delimiter">(</span><a href="#93193" title="Double">x</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.storage.FieldRestrictionGE" class="delimiter">(</span>FieldRestrictionGE<span class="delimiter">(</span><a title="Double" id="93221">x</a><span class="delimiter">)</span>, FieldRestrictionGE<span class="delimiter">(</span><a title="Double" id="93222">y</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <a href="../Messages.scala.html#27601" title="(value: Double)edu.berkeley.cs.scads.storage.FieldRestrictionGE">FieldRestrictionGE</a><span class="delimiter">(</span>math.<span title="(x: Double, y: Double)Double">max</span><span class="delimiter">(</span><a href="#93221" title="Double">x</a>, <a href="#93222" title="Double">y</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.storage.FieldRestriction" class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.FieldRestriction" id="93235">x</a>, _<span class="delimiter">)</span> =&gt; <a href="#93235" title="edu.berkeley.cs.scads.storage.FieldRestriction">x</a>
    <span class="delimiter">}</span>
    <span title="(x: edu.berkeley.cs.scads.storage.FieldRestriction)Some[edu.berkeley.cs.scads.storage.FieldRestriction]">Some</span><span class="delimiter">(</span><a href="#93137" title="edu.berkeley.cs.scads.storage.FieldRestriction">newRestriction</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">// r is the new restriction, and u is the (optionally) existing restriction.</span>
  <span class="comment">// r is an upper restriction (LT or LE).</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(r: edu.berkeley.cs.scads.storage.FieldRestriction, u: Option[edu.berkeley.cs.scads.storage.FieldRestriction])Some[edu.berkeley.cs.scads.storage.FieldRestriction]" id="92390">getUpperRestriction</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.FieldRestriction" id="93239">r</a>: <a href="../Messages.scala.html#9691" title="edu.berkeley.cs.scads.storage.FieldRestriction">FieldRestriction</a>,
                                  <a title="Option[edu.berkeley.cs.scads.storage.FieldRestriction]" id="93240">u</a>: <span title="Option[edu.berkeley.cs.scads.storage.FieldRestriction]">Option</span><span class="delimiter">[</span>FieldRestriction<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.FieldRestriction" id="93243">newRestriction</a> = <span title="(_1: edu.berkeley.cs.scads.storage.FieldRestriction, _2: edu.berkeley.cs.scads.storage.FieldRestriction)(edu.berkeley.cs.scads.storage.FieldRestriction, edu.berkeley.cs.scads.storage.FieldRestriction)" class="delimiter">(</span><a href="#93239" title="edu.berkeley.cs.scads.storage.FieldRestriction">r</a>, <a href="#93240" title="Option[edu.berkeley.cs.scads.storage.FieldRestriction]">u</a>.<span title="(default: =&gt; edu.berkeley.cs.scads.storage.FieldRestriction)edu.berkeley.cs.scads.storage.FieldRestriction">getOrElse</span><span class="delimiter">(</span><a href="#93239" title="edu.berkeley.cs.scads.storage.FieldRestriction">r</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="edu.berkeley.cs.scads.storage.FieldRestriction" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.storage.FieldRestrictionLT" class="delimiter">(</span>FieldRestrictionLT<span class="delimiter">(</span><a title="Double" id="93257">x</a><span class="delimiter">)</span>, FieldRestrictionLT<span class="delimiter">(</span><a title="Double" id="93258">y</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <a href="../Messages.scala.html#27655" title="(value: Double)edu.berkeley.cs.scads.storage.FieldRestrictionLT">FieldRestrictionLT</a><span class="delimiter">(</span>math.<span title="(x: Double, y: Double)Double">min</span><span class="delimiter">(</span><a href="#93257" title="Double">x</a>, <a href="#93258" title="Double">y</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="&lt;none&gt; extends edu.berkeley.cs.avro.marker.AvroRecord with edu.berkeley.cs.scads.storage.FieldRestriction with Product with Serializable" class="delimiter">(</span>FieldRestrictionLT<span class="delimiter">(</span><a title="Double" id="93271">x</a><span class="delimiter">)</span>, FieldRestrictionLE<span class="delimiter">(</span><a title="Double" id="93272">y</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <span title="&lt;none&gt; extends edu.berkeley.cs.avro.marker.AvroRecord with edu.berkeley.cs.scads.storage.FieldRestriction with Product with Serializable" class="keyword">if</span> <span class="delimiter">(</span><a href="#93271" title="Double">x</a> <span title="(x: Double)Boolean">&lt;=</span> <a href="#93272" title="Double">y</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../Messages.scala.html#27655" title="(value: Double)edu.berkeley.cs.scads.storage.FieldRestrictionLT">FieldRestrictionLT</a><span class="delimiter">(</span><a href="#93271" title="Double">x</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="../Messages.scala.html#27709" title="(value: Double)edu.berkeley.cs.scads.storage.FieldRestrictionLE">FieldRestrictionLE</a><span class="delimiter">(</span><a href="#93272" title="Double">y</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="&lt;none&gt; extends edu.berkeley.cs.avro.marker.AvroRecord with edu.berkeley.cs.scads.storage.FieldRestriction with Product with Serializable" class="delimiter">(</span>FieldRestrictionLE<span class="delimiter">(</span><a title="Double" id="93299">x</a><span class="delimiter">)</span>, FieldRestrictionLT<span class="delimiter">(</span><a title="Double" id="93300">y</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <span title="&lt;none&gt; extends edu.berkeley.cs.avro.marker.AvroRecord with edu.berkeley.cs.scads.storage.FieldRestriction with Product with Serializable" class="keyword">if</span> <span class="delimiter">(</span><a href="#93300" title="Double">y</a> <span title="(x: Double)Boolean">&lt;=</span> <a href="#93299" title="Double">x</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../Messages.scala.html#27655" title="(value: Double)edu.berkeley.cs.scads.storage.FieldRestrictionLT">FieldRestrictionLT</a><span class="delimiter">(</span><a href="#93300" title="Double">y</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="../Messages.scala.html#27709" title="(value: Double)edu.berkeley.cs.scads.storage.FieldRestrictionLE">FieldRestrictionLE</a><span class="delimiter">(</span><a href="#93299" title="Double">x</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.storage.FieldRestrictionLE" class="delimiter">(</span>FieldRestrictionLE<span class="delimiter">(</span><a title="Double" id="93327">x</a><span class="delimiter">)</span>, FieldRestrictionLE<span class="delimiter">(</span><a title="Double" id="93328">y</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <a href="../Messages.scala.html#27709" title="(value: Double)edu.berkeley.cs.scads.storage.FieldRestrictionLE">FieldRestrictionLE</a><span class="delimiter">(</span>math.<span title="(x: Double, y: Double)Double">min</span><span class="delimiter">(</span><a href="#93327" title="Double">x</a>, <a href="#93328" title="Double">y</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.storage.FieldRestriction" class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.FieldRestriction" id="93341">x</a>, _<span class="delimiter">)</span> =&gt; <a href="#93341" title="edu.berkeley.cs.scads.storage.FieldRestriction">x</a>
    <span class="delimiter">}</span>
    <span title="(x: edu.berkeley.cs.scads.storage.FieldRestriction)Some[edu.berkeley.cs.scads.storage.FieldRestriction]">Some</span><span class="delimiter">(</span><a href="#93243" title="edu.berkeley.cs.scads.storage.FieldRestriction">newRestriction</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(t: (Option[edu.berkeley.cs.scads.storage.FieldRestriction], Option[edu.berkeley.cs.scads.storage.FieldRestriction]), r: edu.berkeley.cs.scads.storage.FieldRestriction)(Option[edu.berkeley.cs.scads.storage.FieldRestriction], Option[edu.berkeley.cs.scads.storage.FieldRestriction])" id="92391">foldRestrictions</a><span class="delimiter">(</span><a title="(Option[edu.berkeley.cs.scads.storage.FieldRestriction], Option[edu.berkeley.cs.scads.storage.FieldRestriction])" id="93345">t</a>: <span title="(Option[edu.berkeley.cs.scads.storage.FieldRestriction], Option[edu.berkeley.cs.scads.storage.FieldRestriction])" class="delimiter">(</span>Option<span class="delimiter">[</span>FieldRestriction<span class="delimiter">]</span>,
                                   Option<span class="delimiter">[</span>FieldRestriction<span class="delimiter">]</span><span class="delimiter">)</span>,
                               <a title="edu.berkeley.cs.scads.storage.FieldRestriction" id="93346">r</a>: <a href="../Messages.scala.html#9691" title="edu.berkeley.cs.scads.storage.FieldRestriction">FieldRestriction</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span title="(_1: (Option[edu.berkeley.cs.scads.storage.FieldRestriction], Option[edu.berkeley.cs.scads.storage.FieldRestriction]), _2: edu.berkeley.cs.scads.storage.FieldRestriction)((Option[edu.berkeley.cs.scads.storage.FieldRestriction], Option[edu.berkeley.cs.scads.storage.FieldRestriction]), edu.berkeley.cs.scads.storage.FieldRestriction)" class="delimiter">(</span><a href="#93345" title="(Option[edu.berkeley.cs.scads.storage.FieldRestriction], Option[edu.berkeley.cs.scads.storage.FieldRestriction])">t</a>, <a href="#93346" title="edu.berkeley.cs.scads.storage.FieldRestriction">r</a><span class="delimiter">)</span> <span title="(Option[edu.berkeley.cs.scads.storage.FieldRestriction], Option[edu.berkeley.cs.scads.storage.FieldRestriction])" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="(Some[edu.berkeley.cs.scads.storage.FieldRestriction], Option[edu.berkeley.cs.scads.storage.FieldRestriction])" class="delimiter">(</span><span class="delimiter">(</span><a title="Option[edu.berkeley.cs.scads.storage.FieldRestriction]" id="93359">l</a>, <a title="Option[edu.berkeley.cs.scads.storage.FieldRestriction]" id="93360">u</a><span class="delimiter">)</span>, <a title="edu.berkeley.cs.scads.storage.FieldRestrictionGT" id="93361">x</a>:<a href="../Messages.scala.html#9692" title="edu.berkeley.cs.scads.storage.FieldRestrictionGT">FieldRestrictionGT</a><span class="delimiter">)</span> =&gt; <span title="(_1: Some[edu.berkeley.cs.scads.storage.FieldRestriction], _2: Option[edu.berkeley.cs.scads.storage.FieldRestriction])(Some[edu.berkeley.cs.scads.storage.FieldRestriction], Option[edu.berkeley.cs.scads.storage.FieldRestriction])" class="delimiter">(</span><a href="#92389" title="(r: edu.berkeley.cs.scads.storage.FieldRestriction, l: Option[edu.berkeley.cs.scads.storage.FieldRestriction])Some[edu.berkeley.cs.scads.storage.FieldRestriction]">getLowerRestriction</a><span class="delimiter">(</span><a href="#93361" title="edu.berkeley.cs.scads.storage.FieldRestrictionGT">x</a>, <a href="#93359" title="Option[edu.berkeley.cs.scads.storage.FieldRestriction]">l</a><span class="delimiter">)</span>, <a href="#93360" title="Option[edu.berkeley.cs.scads.storage.FieldRestriction]">u</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="(Some[edu.berkeley.cs.scads.storage.FieldRestriction], Option[edu.berkeley.cs.scads.storage.FieldRestriction])" class="delimiter">(</span><span class="delimiter">(</span><a title="Option[edu.berkeley.cs.scads.storage.FieldRestriction]" id="93372">l</a>, <a title="Option[edu.berkeley.cs.scads.storage.FieldRestriction]" id="93373">u</a><span class="delimiter">)</span>, <a title="edu.berkeley.cs.scads.storage.FieldRestrictionGE" id="93374">x</a>:<a href="../Messages.scala.html#9695" title="edu.berkeley.cs.scads.storage.FieldRestrictionGE">FieldRestrictionGE</a><span class="delimiter">)</span> =&gt; <span title="(_1: Some[edu.berkeley.cs.scads.storage.FieldRestriction], _2: Option[edu.berkeley.cs.scads.storage.FieldRestriction])(Some[edu.berkeley.cs.scads.storage.FieldRestriction], Option[edu.berkeley.cs.scads.storage.FieldRestriction])" class="delimiter">(</span><a href="#92389" title="(r: edu.berkeley.cs.scads.storage.FieldRestriction, l: Option[edu.berkeley.cs.scads.storage.FieldRestriction])Some[edu.berkeley.cs.scads.storage.FieldRestriction]">getLowerRestriction</a><span class="delimiter">(</span><a href="#93374" title="edu.berkeley.cs.scads.storage.FieldRestrictionGE">x</a>, <a href="#93372" title="Option[edu.berkeley.cs.scads.storage.FieldRestriction]">l</a><span class="delimiter">)</span>, <a href="#93373" title="Option[edu.berkeley.cs.scads.storage.FieldRestriction]">u</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="(Option[edu.berkeley.cs.scads.storage.FieldRestriction], Some[edu.berkeley.cs.scads.storage.FieldRestriction])" class="delimiter">(</span><span class="delimiter">(</span><a title="Option[edu.berkeley.cs.scads.storage.FieldRestriction]" id="93385">l</a>, <a title="Option[edu.berkeley.cs.scads.storage.FieldRestriction]" id="93386">u</a><span class="delimiter">)</span>, <a title="edu.berkeley.cs.scads.storage.FieldRestrictionLT" id="93387">x</a>:<a href="../Messages.scala.html#9698" title="edu.berkeley.cs.scads.storage.FieldRestrictionLT">FieldRestrictionLT</a><span class="delimiter">)</span> =&gt; <span title="(_1: Option[edu.berkeley.cs.scads.storage.FieldRestriction], _2: Some[edu.berkeley.cs.scads.storage.FieldRestriction])(Option[edu.berkeley.cs.scads.storage.FieldRestriction], Some[edu.berkeley.cs.scads.storage.FieldRestriction])" class="delimiter">(</span><a href="#93385" title="Option[edu.berkeley.cs.scads.storage.FieldRestriction]">l</a>, <a href="#92390" title="(r: edu.berkeley.cs.scads.storage.FieldRestriction, u: Option[edu.berkeley.cs.scads.storage.FieldRestriction])Some[edu.berkeley.cs.scads.storage.FieldRestriction]">getUpperRestriction</a><span class="delimiter">(</span><a href="#93387" title="edu.berkeley.cs.scads.storage.FieldRestrictionLT">x</a>, <a href="#93386" title="Option[edu.berkeley.cs.scads.storage.FieldRestriction]">u</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="(Option[edu.berkeley.cs.scads.storage.FieldRestriction], Some[edu.berkeley.cs.scads.storage.FieldRestriction])" class="delimiter">(</span><span class="delimiter">(</span><a title="Option[edu.berkeley.cs.scads.storage.FieldRestriction]" id="93398">l</a>, <a title="Option[edu.berkeley.cs.scads.storage.FieldRestriction]" id="93399">u</a><span class="delimiter">)</span>, <a title="edu.berkeley.cs.scads.storage.FieldRestrictionLE" id="93400">x</a>:<a href="../Messages.scala.html#9701" title="edu.berkeley.cs.scads.storage.FieldRestrictionLE">FieldRestrictionLE</a><span class="delimiter">)</span> =&gt; <span title="(_1: Option[edu.berkeley.cs.scads.storage.FieldRestriction], _2: Some[edu.berkeley.cs.scads.storage.FieldRestriction])(Option[edu.berkeley.cs.scads.storage.FieldRestriction], Some[edu.berkeley.cs.scads.storage.FieldRestriction])" class="delimiter">(</span><a href="#93398" title="Option[edu.berkeley.cs.scads.storage.FieldRestriction]">l</a>, <a href="#92390" title="(r: edu.berkeley.cs.scads.storage.FieldRestriction, u: Option[edu.berkeley.cs.scads.storage.FieldRestriction])Some[edu.berkeley.cs.scads.storage.FieldRestriction]">getUpperRestriction</a><span class="delimiter">(</span><a href="#93400" title="edu.berkeley.cs.scads.storage.FieldRestrictionLE">x</a>, <a href="#93399" title="Option[edu.berkeley.cs.scads.storage.FieldRestriction]">u</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(node: edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode)Unit" id="92392">initRootAdditional</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode" id="93421">node</a>: ZooKeeperProxy#<span title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">ZooKeeperNode</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Array[java.lang.reflect.Field]" id="93427">fields</a> = <a href="#92386" title="=&gt; Manifest[V]">valueManifest</a>.<span title="=&gt; java.lang.Class[_]">erasure</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Class[V]" class="delimiter">[</span><span title="Class[V]">Class</span><span class="delimiter">[</span>V<span class="delimiter">]</span><span class="delimiter">]</span>.<span title="()Array[java.lang.reflect.Field]">getDeclaredFields</span>
    <span class="keyword">val</span> <a title="Array[edu.berkeley.cs.scads.storage.FieldIC]" id="93428">rlist</a> = <a href="#93427" title="(xs: Array[java.lang.reflect.Field])scala.collection.mutable.ArrayOps[java.lang.reflect.Field]">fields</a>.<span title="(f: java.lang.reflect.Field =&gt; edu.berkeley.cs.scads.storage.FieldIC)(implicit bf: scala.collection.generic.CanBuildFrom[Array[java.lang.reflect.Field],edu.berkeley.cs.scads.storage.FieldIC,Array[edu.berkeley.cs.scads.storage.FieldIC]])Array[edu.berkeley.cs.scads.storage.FieldIC]">map</span><span title="(xs: Array[edu.berkeley.cs.scads.storage.FieldIC])scala.collection.mutable.ArrayOps[edu.berkeley.cs.scads.storage.FieldIC]" class="delimiter">(</span><a title="java.lang.reflect.Field" id="94011">f</a> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Array[java.lang.annotation.Annotation]" id="94012">annotations</a> = <a href="#94011" title="java.lang.reflect.Field">f</a>.<span title="()Array[java.lang.annotation.Annotation]">getDeclaredAnnotations</span>

      <span title="edu.berkeley.cs.scads.storage.FieldIC" class="keyword">if</span> <span class="delimiter">(</span><a href="#94012" title="Array[java.lang.annotation.Annotation]">annotations</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Int" id="94017">fieldPos</a> = <a href="#91376" title="=&gt; org.apache.avro.Schema">valueSchema</a>.<span title="(x$1: java.lang.String)org.apache.avro.Schema.Field">getField</span><span class="delimiter">(</span><a href="#94011" title="java.lang.reflect.Field">f</a>.<span title="()java.lang.String">getName</span><span class="delimiter">)</span>.<span title="()Int">pos</span><span class="delimiter">(</span><span class="delimiter">)</span>

        <span class="keyword">val</span> <a title="(Option[edu.berkeley.cs.scads.storage.FieldRestriction], Option[edu.berkeley.cs.scads.storage.FieldRestriction])" id="94018">restrictions</a> = <a href="#94012" title="(xs: Array[java.lang.annotation.Annotation])scala.collection.mutable.ArrayOps[java.lang.annotation.Annotation]">annotations</a>.<span title="(f: java.lang.annotation.Annotation =&gt; edu.berkeley.cs.avro.marker.AvroRecord with edu.berkeley.cs.scads.storage.FieldRestriction with Product with Serializable)(implicit bf: scala.collection.generic.CanBuildFrom[Array[java.lang.annotation.Annotation],edu.berkeley.cs.avro.marker.AvroRecord with edu.berkeley.cs.scads.storage.FieldRestriction with Product with Serializable,Array[edu.berkeley.cs.avro.marker.AvroRecord with edu.berkeley.cs.scads.storage.FieldRestriction with Product with Serializable]])Array[edu.berkeley.cs.avro.marker.AvroRecord with edu.berkeley.cs.scads.storage.FieldRestriction with Product with Serializable]">map</span><span title="(xs: Array[edu.berkeley.cs.avro.marker.AvroRecord with edu.berkeley.cs.scads.storage.FieldRestriction with Product with Serializable])scala.collection.mutable.ArrayOps[edu.berkeley.cs.avro.marker.AvroRecord with edu.berkeley.cs.scads.storage.FieldRestriction with Product with Serializable]" class="delimiter">(</span><a title="java.lang.annotation.Annotation" id="94486">a</a> =&gt; <span class="delimiter">{</span>
          <a href="#94486" title="java.lang.annotation.Annotation">a</a> <span title="&lt;none&gt; extends edu.berkeley.cs.avro.marker.AvroRecord with edu.berkeley.cs.scads.storage.FieldRestriction with Product with Serializable" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a title="edu.berkeley.cs.scads.storage.FieldRestrictionGT" id="94487">x</a>: JavaFieldAnnotations.<a href="../JavaFieldAnnotations.java.html#90296" title="edu.berkeley.cs.scads.storage.transactions.JavaFieldAnnotations.JavaFieldGT">JavaFieldGT</a> =&gt; <a href="../Messages.scala.html#27547" title="(value: Double)edu.berkeley.cs.scads.storage.FieldRestrictionGT">FieldRestrictionGT</a><span class="delimiter">(</span><a href="#94487" title="edu.berkeley.cs.scads.storage.transactions.JavaFieldAnnotations.JavaFieldGT">x</a>.<a href="../JavaFieldAnnotations.java.html#92186" title="()Double">value</a><span class="delimiter">)</span>
            <span class="keyword">case</span> <a title="edu.berkeley.cs.scads.storage.FieldRestrictionGE" id="94490">x</a>: JavaFieldAnnotations.<a href="../JavaFieldAnnotations.java.html#90299" title="edu.berkeley.cs.scads.storage.transactions.JavaFieldAnnotations.JavaFieldGE">JavaFieldGE</a> =&gt; <a href="../Messages.scala.html#27601" title="(value: Double)edu.berkeley.cs.scads.storage.FieldRestrictionGE">FieldRestrictionGE</a><span class="delimiter">(</span><a href="#94490" title="edu.berkeley.cs.scads.storage.transactions.JavaFieldAnnotations.JavaFieldGE">x</a>.<a href="../JavaFieldAnnotations.java.html#92193" title="()Double">value</a><span class="delimiter">)</span>
            <span class="keyword">case</span> <a title="edu.berkeley.cs.scads.storage.FieldRestrictionLT" id="94493">x</a>: JavaFieldAnnotations.<a href="../JavaFieldAnnotations.java.html#90302" title="edu.berkeley.cs.scads.storage.transactions.JavaFieldAnnotations.JavaFieldLT">JavaFieldLT</a> =&gt; <a href="../Messages.scala.html#27655" title="(value: Double)edu.berkeley.cs.scads.storage.FieldRestrictionLT">FieldRestrictionLT</a><span class="delimiter">(</span><a href="#94493" title="edu.berkeley.cs.scads.storage.transactions.JavaFieldAnnotations.JavaFieldLT">x</a>.<a href="../JavaFieldAnnotations.java.html#92200" title="()Double">value</a><span class="delimiter">)</span>
            <span class="keyword">case</span> <a title="edu.berkeley.cs.scads.storage.FieldRestrictionLE" id="94496">x</a>: JavaFieldAnnotations.<a href="../JavaFieldAnnotations.java.html#90305" title="edu.berkeley.cs.scads.storage.transactions.JavaFieldAnnotations.JavaFieldLE">JavaFieldLE</a> =&gt; <a href="../Messages.scala.html#27709" title="(value: Double)edu.berkeley.cs.scads.storage.FieldRestrictionLE">FieldRestrictionLE</a><span class="delimiter">(</span><a href="#94496" title="edu.berkeley.cs.scads.storage.transactions.JavaFieldAnnotations.JavaFieldLE">x</a>.<a href="../JavaFieldAnnotations.java.html#92207" title="()Double">value</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>.<span title="[B](z: B)(op: (B, edu.berkeley.cs.avro.marker.AvroRecord with edu.berkeley.cs.scads.storage.FieldRestriction with Product with Serializable) =&gt; B)B">foldLeft</span><span title="(z: (Option[edu.berkeley.cs.scads.storage.FieldRestriction], Option[edu.berkeley.cs.scads.storage.FieldRestriction]))(op: ((Option[edu.berkeley.cs.scads.storage.FieldRestriction], Option[edu.berkeley.cs.scads.storage.FieldRestriction]), edu.berkeley.cs.avro.marker.AvroRecord with edu.berkeley.cs.scads.storage.FieldRestriction with Product with Serializable) =&gt; (Option[edu.berkeley.cs.scads.storage.FieldRestriction], Option[edu.berkeley.cs.scads.storage.FieldRestriction]))(Option[edu.berkeley.cs.scads.storage.FieldRestriction], Option[edu.berkeley.cs.scads.storage.FieldRestriction])" class="delimiter">[</span><span title="(Option[edu.berkeley.cs.scads.storage.FieldRestriction], Option[edu.berkeley.cs.scads.storage.FieldRestriction])" class="delimiter">(</span>Option<span class="delimiter">[</span>FieldRestriction<span class="delimiter">]</span>, Option<span class="delimiter">[</span>FieldRestriction<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="(_1: None.type, _2: None.type)(None.type, None.type)" class="delimiter">(</span><span title="object None">None</span>, <span title="object None">None</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#92391" title="(t: (Option[edu.berkeley.cs.scads.storage.FieldRestriction], Option[edu.berkeley.cs.scads.storage.FieldRestriction]), r: edu.berkeley.cs.scads.storage.FieldRestriction)(Option[edu.berkeley.cs.scads.storage.FieldRestriction], Option[edu.berkeley.cs.scads.storage.FieldRestriction])">foldRestrictions</a> _<span class="delimiter">)</span>

        <a href="../Messages.scala.html#27787" title="(fieldPos: Int, lower: Option[edu.berkeley.cs.scads.storage.FieldRestriction], upper: Option[edu.berkeley.cs.scads.storage.FieldRestriction])edu.berkeley.cs.scads.storage.FieldIC">FieldIC</a><span class="delimiter">(</span><a href="#94017" title="Int">fieldPos</a>, <a href="#94018" title="(Option[edu.berkeley.cs.scads.storage.FieldRestriction], Option[edu.berkeley.cs.scads.storage.FieldRestriction])">restrictions</a>.<span title="=&gt; Option[edu.berkeley.cs.scads.storage.FieldRestriction]">_1</span>, <a href="#94018" title="(Option[edu.berkeley.cs.scads.storage.FieldRestriction], Option[edu.berkeley.cs.scads.storage.FieldRestriction])">restrictions</a>.<span title="=&gt; Option[edu.berkeley.cs.scads.storage.FieldRestriction]">_2</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="comment">// No annotations on the field.</span>
        <span title="Null(null)" class="keyword">null</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>.<span title="(p: edu.berkeley.cs.scads.storage.FieldIC =&gt; Boolean)Array[edu.berkeley.cs.scads.storage.FieldIC]">filter</span><span class="delimiter">(</span><a href="#95171" title="edu.berkeley.cs.scads.storage.FieldIC">_</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>

    <span class="comment">// Write the integrity constraints to zookeeper.</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.AvroSpecificReaderWriter[edu.berkeley.cs.scads.storage.FieldICList]" id="93429">writer</a> = <span title="edu.berkeley.cs.scads.storage.AvroSpecificReaderWriter[edu.berkeley.cs.scads.storage.FieldICList]" class="keyword">new</span> <a href="../client/AvroSerializer.scala.html#9788" title="edu.berkeley.cs.scads.storage.AvroSpecificReaderWriter[edu.berkeley.cs.scads.storage.FieldICList]">AvroSpecificReaderWriter</a><span class="delimiter">[</span>FieldICList<span class="delimiter">]</span><span class="delimiter">(</span><span title="object None">None</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Array[Byte]" id="93430">icBytes</a> = <a href="#93429" title="edu.berkeley.cs.scads.storage.AvroSpecificReaderWriter[edu.berkeley.cs.scads.storage.FieldICList]">writer</a>.<a href="../client/AvroSerializer.scala.html#38790" title="(rec: edu.berkeley.cs.scads.storage.FieldICList)Array[Byte]">serialize</a><span class="delimiter">(</span><a href="../Messages.scala.html#27860" title="(ics: Seq[edu.berkeley.cs.scads.storage.FieldIC])edu.berkeley.cs.scads.storage.FieldICList">FieldICList</a><span class="delimiter">(</span><a href="#93428" title="(xs: Array[edu.berkeley.cs.scads.storage.FieldIC])scala.collection.mutable.WrappedArray[edu.berkeley.cs.scads.storage.FieldIC]">rlist</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="../client/ZooKeeperGlobalMetadata.scala.html#44869" title="=&gt; edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">root</a>.<span title="(rpath: java.lang.String, tries: Int)edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">getOrCreate</span><span class="delimiter">(</span><a href="../client/ZooKeeperGlobalMetadata.scala.html#44870" title="=&gt; String">name</a><span class="delimiter">)</span>.<span title="(name: java.lang.String, data: Array[Byte], mode: org.apache.zookeeper.CreateMode)edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">createChild</span><span title="Unit" class="delimiter">(</span><span title="java.lang.String(&quot;valueICs&quot;)" class="string">&quot;valueICs&quot;</span>, <a href="#93430" title="Array[Byte]">icBytes</a>,
                                       CreateMode.<span title="org.apache.zookeeper.CreateMode(value PERSISTENT)">PERSISTENT</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(key: K, value: V)Unit" id="92393">putLogical</a><span class="delimiter">(</span><a title="K" id="92995">key</a>: <a href="#10230" title="K">K</a>, <a title="V" id="92996">value</a>: <a href="#10231" title="V">V</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#92398" title="(key: Array[Byte], value: Array[Byte])Unit">putBytesLogical</a><span class="delimiter">(</span><a href="../client/Interfaces.scala.html#40390" title="(key: K)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="#92995" title="K">key</a><span class="delimiter">)</span>, <a href="../client/Interfaces.scala.html#40391" title="(value: V)Array[Byte]">valueToBytes</a><span class="delimiter">(</span><a href="#92996" title="V">value</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="ThreadLocalStorage.scala.html#10210" title="object edu.berkeley.cs.scads.storage.transactions.ThreadLocalStorage">ThreadLocalStorage</a>.<a href="ThreadLocalStorage.scala.html#93073" title="=&gt; scala.util.DynamicVariable[Option[edu.berkeley.cs.scads.storage.transactions.ProtocolMap]]">protocolMap</a>.<span title="=&gt; Option[edu.berkeley.cs.scads.storage.transactions.ProtocolMap]">value</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.transactions.ProtocolMap" id="95208">protocolMap</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#95208" title="edu.berkeley.cs.scads.storage.transactions.ProtocolMap">protocolMap</a>.<a href="ProtocolMap.scala.html#91754" title="(name: String, protocol: edu.berkeley.cs.scads.storage.transactions.TxProtocol)Option[edu.berkeley.cs.scads.storage.transactions.TxProtocol]">addNamespaceProtocol</a><span title="Unit" class="delimiter">(</span><a href="../client/ZooKeeperGlobalMetadata.scala.html#44870" title="=&gt; String">name</a>, <a href="#92387" title="=&gt; edu.berkeley.cs.scads.storage.transactions.TxProtocol">protocolType</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(key: K, value: Option[V])Unit" id="92394">put</a><span class="delimiter">(</span><a title="K" id="92465">key</a>: <a href="#10230" title="K">K</a>, <a title="Option[V]" id="92466">value</a>: <span title="Option[V]">Option</span><span class="delimiter">[</span>V<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#92397" title="(key: Array[Byte], value: Option[Array[Byte]])Unit">putBytes</a><span class="delimiter">(</span><a href="../client/Interfaces.scala.html#40390" title="(key: K)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="#92465" title="K">key</a><span class="delimiter">)</span>, <a href="#92466" title="Option[V]">value</a>.<span title="(f: V =&gt; Array[Byte])Option[Array[Byte]]">map</span><span class="delimiter">(</span><a title="V" id="95216">v</a> =&gt; <a href="../client/Interfaces.scala.html#40391" title="(value: V)Array[Byte]">valueToBytes</a><span class="delimiter">(</span><a href="#95216" title="V">v</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="ThreadLocalStorage.scala.html#10210" title="object edu.berkeley.cs.scads.storage.transactions.ThreadLocalStorage">ThreadLocalStorage</a>.<a href="ThreadLocalStorage.scala.html#93073" title="=&gt; scala.util.DynamicVariable[Option[edu.berkeley.cs.scads.storage.transactions.ProtocolMap]]">protocolMap</a>.<span title="=&gt; Option[edu.berkeley.cs.scads.storage.transactions.ProtocolMap]">value</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.transactions.ProtocolMap" id="95219">protocolMap</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#95219" title="edu.berkeley.cs.scads.storage.transactions.ProtocolMap">protocolMap</a>.<a href="ProtocolMap.scala.html#91754" title="(name: String, protocol: edu.berkeley.cs.scads.storage.transactions.TxProtocol)Option[edu.berkeley.cs.scads.storage.transactions.TxProtocol]">addNamespaceProtocol</a><span title="Unit" class="delimiter">(</span><a href="../client/ZooKeeperGlobalMetadata.scala.html#44870" title="=&gt; String">name</a>, <a href="#92387" title="=&gt; edu.berkeley.cs.scads.storage.transactions.TxProtocol">protocolType</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(key: K)Option[V]" id="92395">get</a><span class="delimiter">(</span><a title="K" id="92775">key</a>: <a href="#10230" title="K">K</a><span class="delimiter">)</span>: <span title="Option[V]">Option</span><span class="delimiter">[</span>V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#92399" title="(key: Array[Byte])Option[Array[Byte]]">getBytes</a><span class="delimiter">(</span><a href="../client/Interfaces.scala.html#40390" title="(key: K)Array[Byte]">keyToBytes</a><span class="delimiter">(</span><a href="#92775" title="K">key</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: Array[Byte] =&gt; V)Option[V]">map</span><span class="delimiter">(</span><a title="Array[Byte]" id="95226">b</a> =&gt;
      <span class="comment">// Don't return a record which was deleted</span>
      <span title="V" class="keyword">if</span> <span class="delimiter">(</span><a href="#95226" title="Array[Byte]">b</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span> <span title="object None">None</span>
      <span class="keyword">else</span>
        <span title="Nothing" class="keyword">return</span> <span title="(x: V)Some[V]">Some</span><span class="delimiter">(</span><a href="../client/Interfaces.scala.html#40388" title="(bytes: Array[Byte])V">bytesToValue</a><span class="delimiter">(</span><a href="#95226" title="Array[Byte]">b</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(start: Option[K], end: Option[K], limit: Option[Int], offset: Option[Int], ascending: Boolean)Seq[(K, V)]" id="92396">getRange</a><span class="delimiter">(</span><a title="Option[K]" id="92791">start</a>: <span title="Option[K]">Option</span><span class="delimiter">[</span>K<span class="delimiter">]</span>, 
                        <a title="Option[K]" id="92792">end</a>: <span title="Option[K]">Option</span><span class="delimiter">[</span>K<span class="delimiter">]</span>, 
                        <a title="Option[Int]" id="92828">limit</a>: <span title="Option[Int]">Option</span><span class="delimiter">[</span>Int<span class="delimiter">]</span> = <span title="object None">None</span>, 
                        <a title="Option[Int]" id="92829">offset</a>: <span title="Option[Int]">Option</span><span class="delimiter">[</span>Int<span class="delimiter">]</span> = <span title="object None">None</span>, 
                        <a title="Boolean" id="92830">ascending</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="comment">// Filter out records which were deleted</span>
    <a href="../client/Interfaces.scala.html#40855" title="(start: Option[Array[Byte]], end: Option[Array[Byte]], limit: Option[Int], offset: Option[Int], ascending: Boolean)Seq[(Array[Byte], Array[Byte])]">getKeys</a><span class="delimiter">(</span><a href="#92791" title="Option[K]">start</a>.<span title="(f: K =&gt; K)Option[K]">map</span><span class="delimiter">(</span><a title="K" id="92835">prefix</a> =&gt; <a href="../client/Stores.scala.html#40841" title="(keyPrefix: K, keyFactory: () =&gt; K)(fillFunc: (org.apache.avro.Schema.Type, org.apache.avro.Schema) =&gt; Any)K">fillOutKey</a><span class="delimiter">(</span><a href="#92835" title="K">prefix</a>, <a href="../client/Interfaces.scala.html#40394" title="=&gt; K">newKeyInstance</a> _<span class="delimiter">)</span><span class="delimiter">(</span><a href="../client/Stores.scala.html#40839" title="(fieldType: org.apache.avro.Schema.Type, fieldSchema: org.apache.avro.Schema)Any">minVal</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: K =&gt; Array[Byte])Option[Array[Byte]]">map</span><span class="delimiter">(</span><a href="../client/Interfaces.scala.html#40390" title="(key: K)Array[Byte]">keyToBytes</a><span class="delimiter">)</span>, <a href="#92792" title="Option[K]">end</a>.<span title="(f: K =&gt; K)Option[K]">map</span><span class="delimiter">(</span><a title="K" id="92857">prefix</a> =&gt; <a href="../client/Stores.scala.html#40841" title="(keyPrefix: K, keyFactory: () =&gt; K)(fillFunc: (org.apache.avro.Schema.Type, org.apache.avro.Schema) =&gt; Any)K">fillOutKey</a><span class="delimiter">(</span><a href="#92857" title="K">prefix</a>, <a href="../client/Interfaces.scala.html#40394" title="=&gt; K">newKeyInstance</a> _<span class="delimiter">)</span><span class="delimiter">(</span><a href="../client/Stores.scala.html#40840" title="(fieldType: org.apache.avro.Schema.Type, fieldSchema: org.apache.avro.Schema)Any">maxVal</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: K =&gt; Array[Byte])Option[Array[Byte]]">map</span><span class="delimiter">(</span><a href="../client/Interfaces.scala.html#40390" title="(key: K)Array[Byte]">keyToBytes</a><span class="delimiter">)</span>, <a href="#92828" title="Option[Int]">limit</a>, <a href="#92829" title="Option[Int]">offset</a>, <a href="#92830" title="Boolean">ascending</a><span class="delimiter">)</span>.<span title="(p: (Array[Byte], Array[Byte]) =&gt; Boolean)Seq[(Array[Byte], Array[Byte])]">filter</span> <a href="#92879" title="Boolean" class="delimiter">{</a>
      <span class="keyword">case</span><span title="Boolean" class="delimiter">(</span><a title="Array[Byte]" id="92882">k</a>,<a title="Array[Byte]" id="92883">v</a><span class="delimiter">)</span> =&gt; <a href="#92883" title="Array[Byte]">v</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span>
    <span class="delimiter">}</span> <span title="(f: (Array[Byte], Array[Byte]) =&gt; (K, V))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Array[Byte], Array[Byte])],(K, V),Seq[(K, V)]])Seq[(K, V)]">map</span> <a href="#92916" title="(K, V)" class="delimiter">{</a> 
      <span class="keyword">case</span> <span title="(K, V)" class="delimiter">(</span><a title="Array[Byte]" id="92919">k</a>,<a title="Array[Byte]" id="92920">v</a><span class="delimiter">)</span> =&gt; <a href="../client/Interfaces.scala.html#40389" title="(k: Array[Byte], v: Array[Byte])(K, V)">bytesToBulk</a><span class="delimiter">(</span><a href="#92919" title="Array[Byte]">k</a>, <a href="#92920" title="Array[Byte]">v</a><span class="delimiter">)</span> 
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(key: Array[Byte], value: Option[Array[Byte]])Unit" id="92397">putBytes</a><span class="delimiter">(</span><a title="Array[Byte]" id="95209">key</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span>, <a title="Option[Array[Byte]]" id="95210">value</a>: <span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.storage.PartitionService]" id="95236">servers</a> = <a href="../client/Interfaces.scala.html#31145" title="(key: Array[Byte])Seq[edu.berkeley.cs.scads.storage.PartitionService]">serversForKey</a><span class="delimiter">(</span><a href="#95209" title="Array[Byte]">key</a><span class="delimiter">)</span>
    <a href="ThreadLocalStorage.scala.html#10210" title="object edu.berkeley.cs.scads.storage.transactions.ThreadLocalStorage">ThreadLocalStorage</a>.<a href="ThreadLocalStorage.scala.html#93069" title="=&gt; scala.util.DynamicVariable[Option[edu.berkeley.cs.scads.storage.transactions.UpdateList]]">updateList</a>.<span title="=&gt; Option[edu.berkeley.cs.scads.storage.transactions.UpdateList]">value</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">None</span> =&gt; <span class="delimiter">{</span>
        <span class="comment">// TODO: what does it mean to do puts outside of a tx?</span>
        <span class="comment">//       for now, just writes to all servers</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.PutRequest" id="95237">putRequest</a> = <a href="../Messages.scala.html#23221" title="(key: Array[Byte], value: Option[Array[Byte]])edu.berkeley.cs.scads.storage.PutRequest">PutRequest</a><span class="delimiter">(</span><a href="#95209" title="Array[Byte]">key</a>,
                                    <span title="(x: Array[Byte])Some[Array[Byte]]">Some</span><span class="delimiter">(</span><a href="#10232" title="object edu.berkeley.cs.scads.storage.transactions.MDCCRecordUtil">MDCCRecordUtil</a>.<a href="#80720" title="(rec: Option[Array[Byte]], metadata: Option[edu.berkeley.cs.scads.storage.MDCCMetadata])Array[Byte]">toBytes</a><span class="delimiter">(</span><a href="#95210" title="Option[Array[Byte]]">value</a>, <span title="object None">None</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]" id="95238">responses</a> = <a href="#95236" title="Seq[edu.berkeley.cs.scads.storage.PartitionService]">servers</a>.<span title="(f: edu.berkeley.cs.scads.storage.PartitionService =&gt; edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.storage.PartitionService],edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage],Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]])Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage],Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]]" class="delimiter">(</span><a href="#95264" title="edu.berkeley.cs.scads.storage.PartitionService">_</a> <span title="(body: edu.berkeley.cs.scads.storage.StorageMessage)edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">!!</span> <a href="#95237" title="edu.berkeley.cs.scads.storage.PutRequest">putRequest</a><span class="delimiter">)</span>
        <a href="#95238" title="(futures: Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]])edu.berkeley.cs.scads.comm.FutureCollection[edu.berkeley.cs.scads.storage.StorageMessage]">responses</a>.<span title="(count: Int, timeout: Long, unit: java.util.concurrent.TimeUnit)Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]">blockFor</span><span title="Unit" class="delimiter">(</span><a href="#95236" title="Seq[edu.berkeley.cs.scads.storage.PartitionService]">servers</a>.<span title="=&gt; Int">length</span>, <span title="Long(500L)" class="int">500</span>, TimeUnit.<span title="java.util.concurrent.TimeUnit(value MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.transactions.UpdateList" id="95317">updateList</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#95317" title="edu.berkeley.cs.scads.storage.transactions.UpdateList">updateList</a>.<a href="UpdateList.scala.html#90711" title="(ns: edu.berkeley.cs.scads.storage.transactions.TransactionDefaultMetadata, servers: Seq[edu.berkeley.cs.scads.storage.PartitionService], key: Array[Byte], rec: Option[Array[Byte]])Unit">appendValueUpdateInfo</a><span class="delimiter">(</span><a href="#10229" title="edu.berkeley.cs.scads.storage.transactions.Transactions[K,V]" class="keyword">this</a>, <a href="#95236" title="Seq[edu.berkeley.cs.scads.storage.PartitionService]">servers</a>, <a href="#95209" title="Array[Byte]">key</a>, <a href="#95210" title="Option[Array[Byte]]">value</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(key: Array[Byte], value: Array[Byte])Unit" id="92398">putBytesLogical</a><span class="delimiter">(</span><a title="Array[Byte]" id="95203">key</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span>,
                      <a title="Array[Byte]" id="95204">value</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.storage.PartitionService]" id="95338">servers</a> = <a href="../client/Interfaces.scala.html#31145" title="(key: Array[Byte])Seq[edu.berkeley.cs.scads.storage.PartitionService]">serversForKey</a><span class="delimiter">(</span><a href="#95203" title="Array[Byte]">key</a><span class="delimiter">)</span>
    <a href="ThreadLocalStorage.scala.html#10210" title="object edu.berkeley.cs.scads.storage.transactions.ThreadLocalStorage">ThreadLocalStorage</a>.<a href="ThreadLocalStorage.scala.html#93069" title="=&gt; scala.util.DynamicVariable[Option[edu.berkeley.cs.scads.storage.transactions.UpdateList]]">updateList</a>.<span title="=&gt; Option[edu.berkeley.cs.scads.storage.transactions.UpdateList]">value</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Nothing">None</span> =&gt; <span class="delimiter">{</span>
        <span class="comment">// TODO: what does it mean to do puts outside of a tx?</span>
        <span class="comment">//       for now, do nothing...</span>
        <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.transactions.UpdateList" id="95344">updateList</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#95344" title="edu.berkeley.cs.scads.storage.transactions.UpdateList">updateList</a>.<a href="UpdateList.scala.html#90712" title="(ns: edu.berkeley.cs.scads.storage.transactions.TransactionDefaultMetadata, servers: Seq[edu.berkeley.cs.scads.storage.PartitionService], key: Array[Byte], rec: Option[Array[Byte]])Unit">appendLogicalUpdate</a><span class="delimiter">(</span><a href="#10229" title="edu.berkeley.cs.scads.storage.transactions.Transactions[K,V]" class="keyword">this</a>, <a href="#95338" title="Seq[edu.berkeley.cs.scads.storage.PartitionService]">servers</a>, <a href="#95203" title="Array[Byte]">key</a>, <span title="(x: Array[Byte])Some[Array[Byte]]">Some</span><span class="delimiter">(</span><a href="#95204" title="Array[Byte]">value</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">// TODO: will need the getBytes() to get metadata, similar to putBytes()</span>
  <span class="comment">//       re-implement a quorum protocol?</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(key: Array[Byte])Option[Array[Byte]]" id="92399">getBytes</a><span class="delimiter">(</span><a title="Array[Byte]" id="95220">key</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.storage.PartitionService]" id="95367">servers</a> = <a href="../client/Interfaces.scala.html#31145" title="(key: Array[Byte])Seq[edu.berkeley.cs.scads.storage.PartitionService]">serversForKey</a><span class="delimiter">(</span><a href="#95220" title="Array[Byte]">key</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.GetRequest" id="95368">getRequest</a> = <a href="../Messages.scala.html#23101" title="(key: Array[Byte])edu.berkeley.cs.scads.storage.GetRequest">GetRequest</a><span class="delimiter">(</span><a href="#95220" title="Array[Byte]">key</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]" id="95369">responses</a> = <a href="#95367" title="Seq[edu.berkeley.cs.scads.storage.PartitionService]">servers</a>.<span title="(f: edu.berkeley.cs.scads.storage.PartitionService =&gt; edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.storage.PartitionService],edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage],Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]])Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage],Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]]" class="delimiter">(</span><a href="#95390" title="edu.berkeley.cs.scads.storage.PartitionService">_</a> <span title="(body: edu.berkeley.cs.scads.storage.StorageMessage)edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">!!</span> <a href="#95368" title="edu.berkeley.cs.scads.storage.GetRequest">getRequest</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Transactions.this.GetHandlerTmp" id="95370">handler</a> = <a href="#95440" title="Transactions.this.GetHandlerTmp" class="keyword">new</a> <a href="#92401" title="Transactions.this.GetHandlerTmp">GetHandlerTmp</a><span class="delimiter">(</span><a href="#95220" title="Array[Byte]">key</a>, <a href="#95369" title="Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]">responses</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Option[Array[Byte]]" id="95371">record</a> = <a href="#95370" title="Transactions.this.GetHandlerTmp">handler</a>.<a href="#95434" title="(quorum: Int)Option[Array[Byte]]">vote</a><span class="delimiter">(</span><a href="#95367" title="Seq[edu.berkeley.cs.scads.storage.PartitionService]">servers</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
    <span title="Option[Array[Byte]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#95370" title="Transactions.this.GetHandlerTmp">handler</a>.<a href="#95432" title="=&gt; Boolean">failed</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="object None">None</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#95371" title="Option[Array[Byte]]">record</a> <span title="Option[Array[Byte]]" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="None.type">None</span> =&gt; <span title="object None">None</span>
        <span class="keyword">case</span> <span title="Option[Array[Byte]]">Some</span><span class="delimiter">(</span><a title="Array[Byte]" id="95446">bytes</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.MDCCRecord" id="95447">mdccRec</a> = <a href="#10232" title="object edu.berkeley.cs.scads.storage.transactions.MDCCRecordUtil">MDCCRecordUtil</a>.<a href="#80721" title="(bytes: Array[Byte])edu.berkeley.cs.scads.storage.MDCCRecord">fromBytes</a><span class="delimiter">(</span><a href="#95446" title="Array[Byte]">bytes</a><span class="delimiter">)</span>
          <a href="ThreadLocalStorage.scala.html#10210" title="object edu.berkeley.cs.scads.storage.transactions.ThreadLocalStorage">ThreadLocalStorage</a>.<a href="ThreadLocalStorage.scala.html#93071" title="=&gt; scala.util.DynamicVariable[Option[edu.berkeley.cs.scads.storage.transactions.ReadList]]">txReadList</a>.<span title="=&gt; Option[edu.berkeley.cs.scads.storage.transactions.ReadList]">value</span>.<span title="(f: edu.berkeley.cs.scads.storage.transactions.ReadList =&gt; Option[edu.berkeley.cs.scads.storage.MDCCRecord])Option[Option[edu.berkeley.cs.scads.storage.MDCCRecord]]">map</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.transactions.ReadList" id="95452">readList</a> =&gt;
            <a href="#95452" title="edu.berkeley.cs.scads.storage.transactions.ReadList">readList</a>.<a href="ReadList.scala.html#90718" title="(key: Array[Byte], record: edu.berkeley.cs.scads.storage.MDCCRecord)Option[edu.berkeley.cs.scads.storage.MDCCRecord]">addRecord</a><span class="delimiter">(</span><a href="#95220" title="Array[Byte]">key</a>, <a href="#95447" title="edu.berkeley.cs.scads.storage.MDCCRecord">mdccRec</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#95447" title="edu.berkeley.cs.scads.storage.MDCCRecord">mdccRec</a>.<a href="../Messages.scala.html#27189" title="=&gt; Option[Array[Byte]]">value</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">// TODO: does get range need to collect ALL metatdata as well?</span>
  <span class="comment">//       could potentially be a very large list, and complicates code.</span>


  <span class="comment">// This is just modified from the quorum protocol...</span>
  <span class="keyword">class</span> <a title="class GetHandlerTmp extends java.lang.Object with ScalaObject" id="92401">GetHandlerTmp</a><a href="#92401" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="Array[Byte]" id="95436">key</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]" id="95437">futures</a>: <span title="Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]">Seq</span><span class="delimiter">[</span>MessageFuture<span class="delimiter">[</span>StorageMessage<span class="delimiter">]</span><span class="delimiter">]</span>, <span class="keyword">val</span> <a title="Long" id="95440">timeout</a>: <span title="Long">Long</span> = <span title="Long(5000L)" class="int">5000</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.concurrent.LinkedBlockingQueue[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]" id="95421">responses</a> = <span title="java.util.concurrent.LinkedBlockingQueue[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]" class="keyword">new</span> java.util.concurrent.<span title="java.util.concurrent.LinkedBlockingQueue[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]">LinkedBlockingQueue</span><span class="delimiter">[</span>MessageFuture<span class="delimiter">[</span>StorageMessage<span class="delimiter">]</span><span class="delimiter">]</span>
    <a href="#95437" title="=&gt; Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]">futures</a>.<span title="(f: edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage] =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#95560" title="edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">_</a>.<span title="(dest: java.util.Queue[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]])Unit">forward</span><span class="delimiter">(</span><a href="#95421" title="=&gt; java.util.concurrent.LinkedBlockingQueue[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]">responses</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">var</span> <a title="Option[Array[Byte]]" id="95424">winnerValue</a>: <span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span> = <span title="object None">None</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="95427">ctr</a> = <span title="Int(0)" class="int">0</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.TimeoutCounter" id="95429">timeoutCounter</a> = <span title="edu.berkeley.cs.scads.storage.TimeoutCounter" class="keyword">new</span> <a href="../client/QuorumProtocol.scala.html#9931" title="edu.berkeley.cs.scads.storage.TimeoutCounter">TimeoutCounter</a><span class="delimiter">(</span><a href="#95440" title="=&gt; Long">timeout</a><span class="delimiter">)</span>
    <span class="keyword">var</span> <a title="Boolean" id="95432">failed</a> = <span title="Boolean(false)" class="keyword">false</span>

    <span class="keyword">def</span> <a title="(quorum: Int)Option[Array[Byte]]" id="95434">vote</a><span class="delimiter">(</span><a title="Int" id="95443">quorum</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">1</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#95443" title="Int">quorum</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="95695">_</a> =&gt; <a href="#95435" title="()Unit">compareNext</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <a href="#95424" title="=&gt; Option[Array[Byte]]">winnerValue</a>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="95435">compareNext</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
      <a href="#95427" title="(x$1: Int)Unit">ctr</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]" id="95698">future</a> = <a href="#95421" title="=&gt; java.util.concurrent.LinkedBlockingQueue[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]">responses</a>.<span title="(x$1: Long, x$2: java.util.concurrent.TimeUnit)edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">poll</span><span class="delimiter">(</span><a href="#95429" title="=&gt; edu.berkeley.cs.scads.storage.TimeoutCounter">timeoutCounter</a>.<a href="../client/QuorumProtocol.scala.html#36709" title="=&gt; Long">remaining</a>, TimeUnit.<span title="java.util.concurrent.TimeUnit(value MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#95698" title="edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">future</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#95432" title="(x$1: Boolean)Unit">failed</a> = <span title="Boolean(true)" class="keyword">true</span>
        <span title="Nothing" class="keyword">return</span>
      <span class="delimiter">}</span>
      <a href="#95698" title="()edu.berkeley.cs.scads.storage.StorageMessage">future</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Unit">GetResponse</span><span class="delimiter">(</span><a title="Option[Array[Byte]]" id="95712">v</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Int" id="95713">cmp</a> = <a href="#92403" title="(optLhs: Option[Array[Byte]], optRhs: Option[Array[Byte]])Int">optCompareMetadataTmp</a><span class="delimiter">(</span><a href="#95424" title="=&gt; Option[Array[Byte]]">winnerValue</a>, <a href="#95712" title="Option[Array[Byte]]">v</a><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#95713" title="Int">cmp</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#95713" title="Int">cmp</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#95424" title="(x$1: Option[Array[Byte]])Unit">winnerValue</a> = <a href="#95712" title="Option[Array[Byte]]">v</a>
          <span class="delimiter">}</span><span class="keyword">else</span> <span title="Unit" class="delimiter">{</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <a title="Nothing" id="95725">m</a> =&gt; <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Unknown message &quot;)" class="string">&quot;Unknown message &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#95725" title="edu.berkeley.cs.scads.storage.StorageMessage">m</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">// This is just modified from the quorum protocol...</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(optLhs: Option[Array[Byte]], optRhs: Option[Array[Byte]])Int" id="92403">optCompareMetadataTmp</a><span class="delimiter">(</span><a title="Option[Array[Byte]]" id="95714">optLhs</a>: <span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Option[Array[Byte]]" id="95715">optRhs</a>: <span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span title="(_1: Option[Array[Byte]], _2: Option[Array[Byte]])(Option[Array[Byte]], Option[Array[Byte]])" class="delimiter">(</span><a href="#95714" title="Option[Array[Byte]]">optLhs</a>, <a href="#95715" title="Option[Array[Byte]]">optRhs</a><span class="delimiter">)</span> <span title="Int" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="Int(0)" class="delimiter">(</span><span title="object None">None</span>, <span title="object None">None</span><span class="delimiter">)</span> =&gt; <span title="Int(0)" class="int">0</span>
    <span class="keyword">case</span> <span title="Int(-1)" class="delimiter">(</span><span title="object None">None</span>, Some<span class="delimiter">(</span>_<span class="delimiter">)</span><span class="delimiter">)</span> =&gt; -<span title="Int(-1)" class="int">1</span>
    <span class="keyword">case</span> <span title="Int(1)" class="delimiter">(</span>Some<span class="delimiter">(</span>_<span class="delimiter">)</span>, <span title="object None">None</span><span class="delimiter">)</span> =&gt; <span title="Int(1)" class="int">1</span>
    <span class="keyword">case</span> <span title="Int" class="delimiter">(</span>Some<span class="delimiter">(</span><a title="Array[Byte]" id="95747">lhs</a><span class="delimiter">)</span>, Some<span class="delimiter">(</span><a title="Array[Byte]" id="95749">rhs</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#92406" title="(lhs: Array[Byte], rhs: Array[Byte])Int">compareMetadata</a><span class="delimiter">(</span><a href="#95747" title="Array[Byte]">lhs</a>, <a href="#95749" title="Array[Byte]">rhs</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.storage.transactions.MDCCRecordUtil" id="10232">MDCCRecordUtil</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.AvroSpecificReaderWriter[edu.berkeley.cs.scads.storage.MDCCRecord]" id="80717">recordReaderWriter</a> = <span title="edu.berkeley.cs.scads.storage.AvroSpecificReaderWriter[edu.berkeley.cs.scads.storage.MDCCRecord]" class="keyword">new</span> <a href="../client/AvroSerializer.scala.html#9788" title="edu.berkeley.cs.scads.storage.AvroSpecificReaderWriter[edu.berkeley.cs.scads.storage.MDCCRecord]">AvroSpecificReaderWriter</a><span class="delimiter">[</span>MDCCRecord<span class="delimiter">]</span><span class="delimiter">(</span><span title="object None">None</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(rec: edu.berkeley.cs.scads.storage.MDCCRecord)Array[Byte]" id="80719">toBytes</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.MDCCRecord" id="80741">rec</a>: <a href="../Messages.scala.html#9677" title="edu.berkeley.cs.scads.storage.MDCCRecord">MDCCRecord</a><span class="delimiter">)</span>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#80717" title="=&gt; edu.berkeley.cs.scads.storage.AvroSpecificReaderWriter[edu.berkeley.cs.scads.storage.MDCCRecord]">recordReaderWriter</a>.<a href="../client/AvroSerializer.scala.html#38790" title="(rec: edu.berkeley.cs.scads.storage.MDCCRecord)Array[Byte]">serialize</a><span class="delimiter">(</span><a href="#80741" title="edu.berkeley.cs.scads.storage.MDCCRecord">rec</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(rec: Option[Array[Byte]], metadata: Option[edu.berkeley.cs.scads.storage.MDCCMetadata])Array[Byte]" id="80720">toBytes</a><span class="delimiter">(</span><a title="Option[Array[Byte]]" id="80738">rec</a>: <span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Option[edu.berkeley.cs.scads.storage.MDCCMetadata]" id="80739">metadata</a>: <span title="Option[edu.berkeley.cs.scads.storage.MDCCMetadata]">Option</span><span class="delimiter">[</span>MDCCMetadata<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#80717" title="=&gt; edu.berkeley.cs.scads.storage.AvroSpecificReaderWriter[edu.berkeley.cs.scads.storage.MDCCRecord]">recordReaderWriter</a>.<a href="../client/AvroSerializer.scala.html#38790" title="(rec: edu.berkeley.cs.scads.storage.MDCCRecord)Array[Byte]">serialize</a><span class="delimiter">(</span><a href="../Messages.scala.html#27221" title="(value: Option[Array[Byte]], metadata: edu.berkeley.cs.scads.storage.MDCCMetadata)edu.berkeley.cs.scads.storage.MDCCRecord">MDCCRecord</a><span class="delimiter">(</span><a href="#80738" title="Option[Array[Byte]]">rec</a>, <a href="#80739" title="Option[edu.berkeley.cs.scads.storage.MDCCMetadata]">metadata</a>.<span title="(default: =&gt; edu.berkeley.cs.scads.storage.MDCCMetadata)edu.berkeley.cs.scads.storage.MDCCMetadata">getOrElse</span><span class="delimiter">(</span><a href="../Messages.scala.html#26939" title="(currentRound: Long, ballots: Seq[edu.berkeley.cs.scads.storage.MDCCBallotRange])edu.berkeley.cs.scads.storage.MDCCMetadata">MDCCMetadata</a><span class="delimiter">(</span><span title="Long(0L)" class="int">0</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(bytes: Array[Byte])edu.berkeley.cs.scads.storage.MDCCRecord" id="80721">fromBytes</a><span class="delimiter">(</span><a title="Array[Byte]" id="80722">bytes</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../Messages.scala.html#9677" title="edu.berkeley.cs.scads.storage.MDCCRecord">MDCCRecord</a> = <span class="delimiter">{</span>
    <a href="#80717" title="=&gt; edu.berkeley.cs.scads.storage.AvroSpecificReaderWriter[edu.berkeley.cs.scads.storage.MDCCRecord]">recordReaderWriter</a>.<a href="../client/AvroSerializer.scala.html#38791" title="(bytes: Array[Byte])edu.berkeley.cs.scads.storage.MDCCRecord">deserialize</a><span class="delimiter">(</span><a href="#80722" title="Array[Byte]">bytes</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>  
<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait TransactionDefaultMetadata extends java.lang.Object" id="10234">TransactionDefaultMetadata</a> <span title="java.lang.Object" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="()edu.berkeley.cs.scads.storage.MDCCMetadata" id="91374">getDefaultMeta</a><span class="delimiter">(</span><span class="delimiter">)</span> : <a href="../Messages.scala.html#9668" title="edu.berkeley.cs.scads.storage.MDCCMetadata">MDCCMetadata</a>
  <span class="keyword">def</span> <a title="=&gt; org.apache.avro.Schema" id="91375">keySchema</a>: <span title="org.apache.avro.Schema">Schema</span>
  <span class="keyword">def</span> <a title="=&gt; org.apache.avro.Schema" id="91376">valueSchema</a>: <span title="org.apache.avro.Schema">Schema</span>
<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait TransactionRecordMetadata extends java.lang.Object with edu.berkeley.cs.scads.storage.SimpleRecordMetadata with ScalaObject" id="10235">TransactionRecordMetadata</a> <span title="ScalaObject" class="keyword">extends</span> <a href="../client/SimpleRecordMetadata.scala.html#9979" title="edu.berkeley.cs.scads.storage.SimpleRecordMetadata">SimpleRecordMetadata</a> <span class="delimiter">{</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(rec: Array[Byte])Array[Byte]" id="92405">createMetadata</a><span class="delimiter">(</span><a title="Array[Byte]" id="95793">rec</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#10232" title="object edu.berkeley.cs.scads.storage.transactions.MDCCRecordUtil">MDCCRecordUtil</a>.<a href="#80720" title="(rec: Option[Array[Byte]], metadata: Option[edu.berkeley.cs.scads.storage.MDCCMetadata])Array[Byte]">toBytes</a><span class="delimiter">(</span><span title="(x: Array[Byte])Some[Array[Byte]]">Some</span><span class="delimiter">(</span><a href="#95793" title="Array[Byte]">rec</a><span class="delimiter">)</span>, <span title="object None">None</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(lhs: Array[Byte], rhs: Array[Byte])Int" id="92406">compareMetadata</a><span class="delimiter">(</span><a title="Array[Byte]" id="95750">lhs</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span>, <a title="Array[Byte]" id="95751">rhs</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <a href="protocol/MDCCMetaHelper.scala.html#10403" title="object edu.berkeley.cs.scads.storage.transactions.MDCCMetaHelper">MDCCMetaHelper</a>.<a href="protocol/MDCCMetaHelper.scala.html#95821" title="(metaL: edu.berkeley.cs.scads.storage.MDCCMetadata, metaR: edu.berkeley.cs.scads.storage.MDCCMetadata)Int">compareMetadata</a><span class="delimiter">(</span><a href="#10232" title="object edu.berkeley.cs.scads.storage.transactions.MDCCRecordUtil">MDCCRecordUtil</a>.<a href="#80721" title="(bytes: Array[Byte])edu.berkeley.cs.scads.storage.MDCCRecord">fromBytes</a><span class="delimiter">(</span><a href="#95750" title="Array[Byte]">lhs</a><span class="delimiter">)</span>.<a href="../Messages.scala.html#27192" title="=&gt; edu.berkeley.cs.scads.storage.MDCCMetadata">metadata</a>,  <a href="#10232" title="object edu.berkeley.cs.scads.storage.transactions.MDCCRecordUtil">MDCCRecordUtil</a>.<a href="#80721" title="(bytes: Array[Byte])edu.berkeley.cs.scads.storage.MDCCRecord">fromBytes</a><span class="delimiter">(</span><a href="#95751" title="Array[Byte]">rhs</a><span class="delimiter">)</span>.<a href="../Messages.scala.html#27192" title="=&gt; edu.berkeley.cs.scads.storage.MDCCMetadata">metadata</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(value: Array[Byte])(Array[Byte], Array[Byte])" id="92407">extractMetadataAndRecordFromValue</a><span class="delimiter">(</span><a title="Array[Byte]" id="95827">value</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="(Array[Byte], Array[Byte])" class="delimiter">(</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>, Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="comment">// TODO: This doesn't really make sense and nothing uses this so far...</span>
    <span title="(_1: Array[Byte], _2: Array[Byte])(Array[Byte], Array[Byte])" class="delimiter">(</span><span title="Array[Byte]" class="keyword">new</span> <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <span title="Array[Byte]" class="keyword">new</span> <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(value: Array[Byte])Array[Byte]" id="92408">extractRecordFromValue</a><span class="delimiter">(</span><a title="Array[Byte]" id="95839">value</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.MDCCRecord" id="95841">txRec</a> = <a href="#10232" title="object edu.berkeley.cs.scads.storage.transactions.MDCCRecordUtil">MDCCRecordUtil</a>.<a href="#80721" title="(bytes: Array[Byte])edu.berkeley.cs.scads.storage.MDCCRecord">fromBytes</a><span class="delimiter">(</span><a href="#95839" title="Array[Byte]">value</a><span class="delimiter">)</span>
    <a href="#95841" title="edu.berkeley.cs.scads.storage.MDCCRecord">txRec</a>.<a href="../Messages.scala.html#27189" title="=&gt; Option[Array[Byte]]">value</a> <span title="Array[Byte]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="comment">// Deleted records have zero length byte arrays</span>
      <span class="keyword">case</span> <span title="Array[Byte]">None</span> =&gt; <span title="Array[Byte]" class="keyword">new</span> <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Array[Byte]">Some</span><span class="delimiter">(</span><a title="Array[Byte]" id="95845">v</a><span class="delimiter">)</span> =&gt; <a href="#95845" title="Array[Byte]">v</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>