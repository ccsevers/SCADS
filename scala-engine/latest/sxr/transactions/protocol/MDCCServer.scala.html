<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>transactions/protocol/MDCCServer.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs.scads
<span class="keyword">package</span> storage
<span class="keyword">package</span> transactions
<span class="keyword">package</span> mdcc

<span class="keyword">import</span> comm._
<span class="keyword">import</span> conflict._
<span class="keyword">import</span> org.apache.avro.Schema
<span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap
<span class="keyword">import</span> collection.mutable.HashMap


<span class="keyword">class</span> <a title="class MDCCServer extends edu.berkeley.cs.scads.storage.transactions.TrxManager with ScalaObject" id="10413">MDCCServer</a><a href="#10413" title="ScalaObject" class="delimiter">(</a><a title="String" id="101506">namespace</a> : <span title="String">String</span>,
                 <a title="edu.berkeley.cs.scads.storage.transactions.TxDB[Array[Byte],Array[Byte]]" id="101507">db</a>: <a href="../TxDB.scala.html#10286" title="edu.berkeley.cs.scads.storage.transactions.TxDB[Array[Byte],Array[Byte]]">TxDB</a><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>, Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>,
                 <a title="edu.berkeley.cs.scads.storage.PartitionService" id="101508">partition</a> : <a href="../../Messages.scala.html#9498" title="edu.berkeley.cs.scads.storage.PartitionService">PartitionService</a>,
                 <a title="edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdates" id="101509">pendingUpdates</a>: <a href="../conflict/PendingUpdates.scala.html#10369" title="edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdates">PendingUpdates</a>,
                 <a title="edu.berkeley.cs.scads.storage.transactions.mdcc.MDCCMetaDefault" id="101510">default</a> : <a href="MDCCMetaDefault.scala.html#10395" title="edu.berkeley.cs.scads.storage.transactions.mdcc.MDCCMetaDefault">MDCCMetaDefault</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../TrxServer.scala.html#10240" title="edu.berkeley.cs.scads.storage.transactions.TrxManager">TrxManager</a> <span class="delimiter">{</span>


  <span class="keyword">def</span> <a title="()edu.berkeley.cs.scads.storage.transactions.TransactionData" id="88784">startTrx</a><span class="delimiter">(</span><span class="delimiter">)</span> : <a href="../TxDB.scala.html#10289" title="edu.berkeley.cs.scads.storage.transactions.TransactionData">TransactionData</a>= <span class="delimiter">{</span>
    <a href="#101507" title="edu.berkeley.cs.scads.storage.transactions.TxDB[Array[Byte],Array[Byte]]">db</a>.<a href="../TxDB.scala.html#74836" title="()edu.berkeley.cs.scads.storage.transactions.TransactionData">txStart</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(txn: edu.berkeley.cs.scads.storage.transactions.TransactionData, failFunction: () =&gt; Unit)Unit" id="88785">commitTrx</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.transactions.TransactionData" id="101512">txn</a> : <a href="../TxDB.scala.html#10289" title="edu.berkeley.cs.scads.storage.transactions.TransactionData">TransactionData</a>, <a title="() =&gt; Unit" id="101513">failFunction</a> : <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Unit<span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">try</span><span class="delimiter">{</span>
      <a href="#101507" title="edu.berkeley.cs.scads.storage.transactions.TxDB[Array[Byte],Array[Byte]]">db</a>.<a href="../TxDB.scala.html#74837" title="(tx: edu.berkeley.cs.scads.storage.transactions.TransactionData)Unit">txCommit</a><span class="delimiter">(</span><a href="#101512" title="edu.berkeley.cs.scads.storage.transactions.TransactionData">txn</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Unit" id="101516">e</a>: <span title="Exception">Exception</span> =&gt; <span class="delimiter">{</span>
          <a href="#101507" title="edu.berkeley.cs.scads.storage.transactions.TxDB[Array[Byte],Array[Byte]]">db</a>.<a href="../TxDB.scala.html#74838" title="(tx: edu.berkeley.cs.scads.storage.transactions.TransactionData)Unit">txAbort</a><span class="delimiter">(</span><a href="#101512" title="edu.berkeley.cs.scads.storage.transactions.TransactionData">txn</a><span class="delimiter">)</span>
          <a href="#101513" title="()Unit">failFunction</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(txn: edu.berkeley.cs.scads.storage.transactions.TransactionData, key: Array[Byte])edu.berkeley.cs.scads.storage.MDCCMetadata" id="88786">getMeta</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.transactions.TransactionData" id="101517">txn</a> : <a href="../TxDB.scala.html#10289" title="edu.berkeley.cs.scads.storage.transactions.TransactionData">TransactionData</a>, <a title="Array[Byte]" id="101518">key</a> : <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span> : <a href="../../Messages.scala.html#9668" title="edu.berkeley.cs.scads.storage.MDCCMetadata">MDCCMetadata</a>  = <span class="delimiter">{</span>
     <span class="keyword">val</span> <a title="Option[edu.berkeley.cs.scads.storage.MDCCRecord]" id="101520">storedMDCCRec</a>: <span title="Option[edu.berkeley.cs.scads.storage.MDCCRecord]">Option</span><span class="delimiter">[</span>MDCCRecord<span class="delimiter">]</span> = <a href="#101507" title="edu.berkeley.cs.scads.storage.transactions.TxDB[Array[Byte],Array[Byte]]">db</a>.<a href="../TxDB.scala.html#74835" title="(tx: edu.berkeley.cs.scads.storage.transactions.TransactionData, key: Array[Byte])Option[Array[Byte]]">get</a><span class="delimiter">(</span><a href="#101517" title="edu.berkeley.cs.scads.storage.transactions.TransactionData">txn</a>, <a href="#101518" title="Array[Byte]">key</a><span class="delimiter">)</span>.<span title="(f: Array[Byte] =&gt; edu.berkeley.cs.scads.storage.MDCCRecord)Option[edu.berkeley.cs.scads.storage.MDCCRecord]">map</span><span class="delimiter">(</span><a href="../Transactions.scala.html#10232" title="object edu.berkeley.cs.scads.storage.transactions.MDCCRecordUtil">MDCCRecordUtil</a>.<a href="../Transactions.scala.html#80721" title="(bytes: Array[Byte])edu.berkeley.cs.scads.storage.MDCCRecord">fromBytes</a><span class="delimiter">(</span><a href="#101526" title="Array[Byte]">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
     <span title="edu.berkeley.cs.scads.storage.MDCCMetadata" class="keyword">if</span><span class="delimiter">(</span><a href="#101520" title="Option[edu.berkeley.cs.scads.storage.MDCCRecord]">storedMDCCRec</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <a href="#101510" title="edu.berkeley.cs.scads.storage.transactions.mdcc.MDCCMetaDefault">default</a>.<a href="MDCCMetaDefault.scala.html#93125" title="=&gt; edu.berkeley.cs.scads.storage.MDCCMetadata">defaultMetaData</a>
     <span class="keyword">else</span>
      <span title="Nothing" class="keyword">return</span> <a href="#101520" title="Option[edu.berkeley.cs.scads.storage.MDCCRecord]">storedMDCCRec</a>.<span title="=&gt; edu.berkeley.cs.scads.storage.MDCCRecord">get</span>.<a href="../../Messages.scala.html#27192" title="=&gt; edu.berkeley.cs.scads.storage.MDCCMetadata">metadata</a>
  <span class="delimiter">}</span>


  <span class="keyword">def</span> <a title="(src: Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]], xid: edu.berkeley.cs.scads.storage.ScadsXid, update: edu.berkeley.cs.scads.storage.RecordUpdate)(implicit sender: edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage])Unit" id="88787">processPropose</a><span class="delimiter">(</span><a title="Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]]" id="101528">src</a>: <span title="Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]]">Option</span><span class="delimiter">[</span>RemoteServiceProxy<span class="delimiter">[</span>StorageMessage<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="edu.berkeley.cs.scads.storage.ScadsXid" id="101529">xid</a>: <a href="../../Messages.scala.html#9710" title="edu.berkeley.cs.scads.storage.ScadsXid">ScadsXid</a>, <a title="edu.berkeley.cs.scads.storage.RecordUpdate" id="101530">update</a>: <a href="../../Messages.scala.html#9680" title="edu.berkeley.cs.scads.storage.RecordUpdate">RecordUpdate</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]" id="101531">sender</a>: <span title="edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]">RemoteServiceProxy</span><span class="delimiter">[</span>StorageMessage<span class="delimiter">]</span><span class="delimiter">)</span>  = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.transactions.TransactionData" id="101534">trx</a> = <a href="#88784" title="()edu.berkeley.cs.scads.storage.transactions.TransactionData">startTrx</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.MDCCMetadata" id="101535">meta</a> = <a href="#88786" title="(txn: edu.berkeley.cs.scads.storage.transactions.TransactionData, key: Array[Byte])edu.berkeley.cs.scads.storage.MDCCMetadata">getMeta</a><span class="delimiter">(</span><a href="#101534" title="edu.berkeley.cs.scads.storage.transactions.TransactionData">trx</a>, <a href="#101530" title="edu.berkeley.cs.scads.storage.RecordUpdate">update</a>.<a href="../../Messages.scala.html#27021" title="=&gt; Array[Byte]">key</a><span class="delimiter">)</span>
    <span class="comment">//val master = getMaster(meta)</span>
    <span class="keyword">val</span> <a title="Option[(Array[Byte], edu.berkeley.cs.scads.storage.CStruct)]" id="101536">result</a> = <a href="#101509" title="edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdates">pendingUpdates</a>.<a href="../conflict/PendingUpdates.scala.html#74785" title="(xid: edu.berkeley.cs.scads.storage.ScadsXid, update: edu.berkeley.cs.scads.storage.RecordUpdate)Option[(Array[Byte], edu.berkeley.cs.scads.storage.CStruct)]">accept</a><span class="delimiter">(</span><a href="#101529" title="edu.berkeley.cs.scads.storage.ScadsXid">xid</a>, <a href="#101530" title="edu.berkeley.cs.scads.storage.RecordUpdate">update</a><span class="delimiter">)</span>
    <a href="#88785" title="(txn: edu.berkeley.cs.scads.storage.transactions.TransactionData, failFunction: () =&gt; Unit)Unit">commitTrx</a><span class="delimiter">(</span><a href="#101534" title="edu.berkeley.cs.scads.storage.transactions.TransactionData">trx</a>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(src: Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]], key: Array[Byte], newMeta: edu.berkeley.cs.scads.storage.MDCCMetadata)Unit" id="88788">processPhase1a</a><span class="delimiter">(</span><a title="Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]]" id="101541">src</a>: <span title="Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]]">Option</span><span class="delimiter">[</span>RemoteServiceProxy<span class="delimiter">[</span>StorageMessage<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Array[Byte]" id="101542">key</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span>, <a title="edu.berkeley.cs.scads.storage.MDCCMetadata" id="101543">newMeta</a>: <a href="../../Messages.scala.html#9668" title="edu.berkeley.cs.scads.storage.MDCCMetadata">MDCCMetadata</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.transactions.TransactionData" id="101546">trx</a> = <a href="#88784" title="()edu.berkeley.cs.scads.storage.transactions.TransactionData">startTrx</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.MDCCMetadata" id="101547">oldMeta</a> = <a href="#88786" title="(txn: edu.berkeley.cs.scads.storage.transactions.TransactionData, key: Array[Byte])edu.berkeley.cs.scads.storage.MDCCMetadata">getMeta</a><span class="delimiter">(</span><a href="#101546" title="edu.berkeley.cs.scads.storage.transactions.TransactionData">trx</a>, <a href="#101542" title="Array[Byte]">key</a><span class="delimiter">)</span>
    <a href="#88785" title="(txn: edu.berkeley.cs.scads.storage.transactions.TransactionData, failFunction: () =&gt; Unit)Unit">commitTrx</a><span class="delimiter">(</span><a href="#101546" title="edu.berkeley.cs.scads.storage.transactions.TransactionData">trx</a>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
    <span class="comment">//pendingUpdates.setMeta(combine(oldMeta, newMeta))</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(src: Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]], key: Array[Byte], ballot: edu.berkeley.cs.scads.storage.MDCCBallot, value: edu.berkeley.cs.scads.storage.CStruct)Unit" id="88789">processPhase2a</a><span class="delimiter">(</span><a title="Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]]" id="101548">src</a>: <span title="Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]]">Option</span><span class="delimiter">[</span>RemoteServiceProxy<span class="delimiter">[</span>StorageMessage<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Array[Byte]" id="101549">key</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span>, <a title="edu.berkeley.cs.scads.storage.MDCCBallot" id="101550">ballot</a>: <a href="../../Messages.scala.html#9662" title="edu.berkeley.cs.scads.storage.MDCCBallot">MDCCBallot</a>, <a title="edu.berkeley.cs.scads.storage.CStruct" id="101551">value</a>: <a href="../../Messages.scala.html#9674" title="edu.berkeley.cs.scads.storage.CStruct">CStruct</a><span class="delimiter">)</span> = <span title="Unit" class="delimiter">{</span>

  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(src: Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]], xid: edu.berkeley.cs.scads.storage.ScadsXid)Unit" id="88790">processAccept</a><span class="delimiter">(</span><a title="Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]]" id="101554">src</a>: <span title="Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]]">Option</span><span class="delimiter">[</span>RemoteServiceProxy<span class="delimiter">[</span>StorageMessage<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="edu.berkeley.cs.scads.storage.ScadsXid" id="101555">xid</a>: <a href="../../Messages.scala.html#9710" title="edu.berkeley.cs.scads.storage.ScadsXid">ScadsXid</a><span class="delimiter">)</span> = <span title="Unit" class="delimiter">{</span>

  <span class="delimiter">}</span>


  <span class="keyword">def</span> <a title="(src: Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]], msg: edu.berkeley.cs.scads.storage.TrxMessage)(implicit sender: edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage])Unit" id="88791">process</a><span class="delimiter">(</span><a title="Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]]" id="101558">src</a>: <span title="Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]]">Option</span><span class="delimiter">[</span>RemoteServiceProxy<span class="delimiter">[</span>StorageMessage<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="edu.berkeley.cs.scads.storage.TrxMessage" id="101559">msg</a>: <a href="../../Messages.scala.html#9716" title="edu.berkeley.cs.scads.storage.TrxMessage">TrxMessage</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]" id="101560">sender</a>: <span title="edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]">RemoteServiceProxy</span><span class="delimiter">[</span>StorageMessage<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#101559" title="edu.berkeley.cs.scads.storage.TrxMessage">msg</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">Propose</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.ScadsXid" id="101563">xid</a>: <a href="../../Messages.scala.html#9710" title="edu.berkeley.cs.scads.storage.ScadsXid">ScadsXid</a>, <a title="edu.berkeley.cs.scads.storage.RecordUpdate" id="101564">update</a>: <a href="../../Messages.scala.html#9680" title="edu.berkeley.cs.scads.storage.RecordUpdate">RecordUpdate</a><span class="delimiter">)</span> =&gt; <a href="#88787" title="(src: Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]], xid: edu.berkeley.cs.scads.storage.ScadsXid, update: edu.berkeley.cs.scads.storage.RecordUpdate)(implicit sender: edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage])Unit">processPropose</a><a href="#101560" title="edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]" class="delimiter">(</a><a href="#101558" title="Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]]">src</a>, <a href="#101563" title="edu.berkeley.cs.scads.storage.ScadsXid">xid</a>, <a href="#101564" title="edu.berkeley.cs.scads.storage.RecordUpdate">update</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">Phase1a</span><span class="delimiter">(</span><a title="Array[Byte]" id="101566">key</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span>, <a title="&lt;none&gt; extends edu.berkeley.cs.scads.storage.MDCCMetadata with edu.berkeley.cs.scads.storage.MDCCBallotRange" id="101567">ballot</a>: <a href="../../Messages.scala.html#9665" title="edu.berkeley.cs.scads.storage.MDCCBallotRange">MDCCBallotRange</a><span class="delimiter">)</span> =&gt; <a href="#88788" title="(src: Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]], key: Array[Byte], newMeta: edu.berkeley.cs.scads.storage.MDCCMetadata)Unit">processPhase1a</a><span class="delimiter">(</span><a href="#101558" title="Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]]">src</a>, <a href="#101566" title="Array[Byte]">key</a>, <a href="#101567" title="&lt;none&gt; extends edu.berkeley.cs.scads.storage.MDCCMetadata with edu.berkeley.cs.scads.storage.MDCCBallotRange">ballot</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">Phase2a</span><span class="delimiter">(</span><a title="Array[Byte]" id="101569">key</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span>, <a title="edu.berkeley.cs.scads.storage.MDCCBallot" id="101570">ballot</a>: <a href="../../Messages.scala.html#9662" title="edu.berkeley.cs.scads.storage.MDCCBallot">MDCCBallot</a>, <a title="edu.berkeley.cs.scads.storage.CStruct" id="101571">value</a>: <a href="../../Messages.scala.html#9674" title="edu.berkeley.cs.scads.storage.CStruct">CStruct</a><span class="delimiter">)</span> =&gt; <a href="#88789" title="(src: Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]], key: Array[Byte], ballot: edu.berkeley.cs.scads.storage.MDCCBallot, value: edu.berkeley.cs.scads.storage.CStruct)Unit">processPhase2a</a><span class="delimiter">(</span><a href="#101558" title="Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]]">src</a>, <a href="#101569" title="Array[Byte]">key</a>, <a href="#101570" title="edu.berkeley.cs.scads.storage.MDCCBallot">ballot</a>, <a href="#101571" title="edu.berkeley.cs.scads.storage.CStruct">value</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">Accept</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.ScadsXid" id="101572">xid</a>: <a href="../../Messages.scala.html#9710" title="edu.berkeley.cs.scads.storage.ScadsXid">ScadsXid</a><span class="delimiter">)</span> =&gt;
      <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <a href="#101558" title="Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]]">src</a>.<span title="(f: edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage] =&gt; Unit)Option[Unit]">map</span><span title="Unit" class="delimiter">(</span><a href="#101577" title="edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]">_</a> <a href="#101560" title="(msg: edu.berkeley.cs.scads.storage.StorageMessage)(implicit sender: edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage])Unit">!</a> <a href="../../Messages.scala.html#22847" title="(cause: String, stacktrace: String)edu.berkeley.cs.scads.storage.ProcessingException">ProcessingException</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Trx Message Not Implemented&quot;)" class="string">&quot;Trx Message Not Implemented&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.storage.transactions.mdcc.ProtocolMDCCServer" id="10414">ProtocolMDCCServer</a> <span title="ScalaObject" class="delimiter">{</span>

  <span class="keyword">protected</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[String,edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdates]" id="88749">PUControllers</a> = <span title="()scala.collection.mutable.HashMap[String,edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdates]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[String,edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdates]">HashMap</span><span class="delimiter">[</span>String, PendingUpdates<span class="delimiter">]</span>


  <span class="keyword">def</span> <a title="(namespace: String, nsRoot: edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode, db: edu.berkeley.cs.scads.storage.transactions.TxDB[Array[Byte],Array[Byte]], factory: edu.berkeley.cs.scads.storage.transactions.TxDBFactory, partition: edu.berkeley.cs.scads.storage.PartitionService, keySchema: org.apache.avro.Schema, valueSchema: org.apache.avro.Schema)edu.berkeley.cs.scads.storage.transactions.mdcc.MDCCServer" id="88750">createMDCCProtocol</a><span class="delimiter">(</span><a title="String" id="88751">namespace</a> : <span title="String">String</span>,
                 <a title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode" id="88752">nsRoot</a> : ZooKeeperProxy#<span title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">ZooKeeperNode</span>,
                 <a title="edu.berkeley.cs.scads.storage.transactions.TxDB[Array[Byte],Array[Byte]]" id="88753">db</a>: <a href="../TxDB.scala.html#10286" title="edu.berkeley.cs.scads.storage.transactions.TxDB[Array[Byte],Array[Byte]]">TxDB</a><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>, Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>,
                 <a title="edu.berkeley.cs.scads.storage.transactions.TxDBFactory" id="88754">factory</a>: <a href="../TxDB.scala.html#10296" title="edu.berkeley.cs.scads.storage.transactions.TxDBFactory">TxDBFactory</a>,
                 <a title="edu.berkeley.cs.scads.storage.PartitionService" id="88755">partition</a> : <a href="../../Messages.scala.html#9498" title="edu.berkeley.cs.scads.storage.PartitionService">PartitionService</a>,
                 <a title="org.apache.avro.Schema" id="88756">keySchema</a>: <span title="org.apache.avro.Schema">Schema</span>,
                 <a title="org.apache.avro.Schema" id="88757">valueSchema</a>: <span title="org.apache.avro.Schema">Schema</span><span class="delimiter">)</span> : <a href="#10413" title="edu.berkeley.cs.scads.storage.transactions.mdcc.MDCCServer">MDCCServer</a> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdates" id="101587">puController</a> : <a href="../conflict/PendingUpdates.scala.html#10369" title="edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdates">PendingUpdates</a> = <span title="Null(null)" class="keyword">null</span>
    <a href="#88748" title="=&gt; scala.collection.mutable.HashMap[String,edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdates]">PUControllers</a>.<span title="(x$1: Any)Any">synchronized</span><span class="delimiter">{</span>
      <a href="#88748" title="=&gt; scala.collection.mutable.HashMap[String,edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdates]">PUControllers</a>.<span title="(key: String)Option[edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdates]">get</span><span class="delimiter">(</span><a href="#88751" title="String">namespace</a><span class="delimiter">)</span> <span title="Any" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Option[edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdates]">None</span> =&gt; <span class="delimiter">{</span>
          <a href="#101587" title="edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdates">puController</a> = <span title="edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdatesController" class="keyword">new</span> <a href="../conflict/PendingUpdates.scala.html#10379" title="edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdatesController">PendingUpdatesController</a><span class="delimiter">(</span><a href="#88753" title="edu.berkeley.cs.scads.storage.transactions.TxDB[Array[Byte],Array[Byte]]">db</a>, <a href="#88754" title="edu.berkeley.cs.scads.storage.transactions.TxDBFactory">factory</a>, <a href="#88756" title="org.apache.avro.Schema">keySchema</a>, <a href="#88757" title="org.apache.avro.Schema">valueSchema</a><span class="delimiter">)</span>
          <a href="#88748" title="=&gt; scala.collection.mutable.HashMap[String,edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdates]">PUControllers</a>.<span title="(key: String, value: edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdates)Option[edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdates]">put</span><span class="delimiter">(</span><a href="#88751" title="String">namespace</a>, <a href="#101587" title="edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdates">puController</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdates" id="101599">controller</a><span class="delimiter">)</span> =&gt; <a href="#101587" title="edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdates">puController</a> = <a href="#101599" title="edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdates">controller</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.transactions.mdcc.MDCCMetaDefault" id="101588">defaultMeta</a> = <a href="MDCCMetaDefault.scala.html#10396" title="object edu.berkeley.cs.scads.storage.transactions.mdcc.MDCCMetaDefault">MDCCMetaDefault</a>.<a href="MDCCMetaDefault.scala.html#93107" title="(nsRoot: edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode, defaultPartition: edu.berkeley.cs.scads.storage.SCADSService)edu.berkeley.cs.scads.storage.transactions.mdcc.MDCCMetaDefault">getOrCreateDefault</a><span class="delimiter">(</span><a href="#88752" title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">nsRoot</a>, <a href="#88755" title="edu.berkeley.cs.scads.storage.PartitionService">partition</a><span class="delimiter">)</span>
    <span title="edu.berkeley.cs.scads.storage.transactions.mdcc.MDCCServer" class="keyword">new</span> <a href="#10413" title="edu.berkeley.cs.scads.storage.transactions.mdcc.MDCCServer">MDCCServer</a><span class="delimiter">(</span><a href="#88751" title="String">namespace</a>, <a href="#88753" title="edu.berkeley.cs.scads.storage.transactions.TxDB[Array[Byte],Array[Byte]]">db</a>, <a href="#88755" title="edu.berkeley.cs.scads.storage.PartitionService">partition</a>, <a href="#101587" title="edu.berkeley.cs.scads.storage.transactions.conflict.PendingUpdates">puController</a>, <a href="#101588" title="edu.berkeley.cs.scads.storage.transactions.mdcc.MDCCMetaDefault">defaultMeta</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>
        </pre>
    </body>
</html>