<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>transactions/TestTx.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs.scads.storage.examples
<span class="keyword">import</span> edu.berkeley.cs.scads.storage.transactions._
<span class="keyword">import</span> edu.berkeley.cs.scads.storage._
<span class="keyword">import</span> edu.berkeley.cs.avro.marker.AvroRecord

<span class="keyword">import</span> scala.actors.<span title="object scala.actors.Actor">Actor</span>._

<span class="keyword">import</span> edu.berkeley.cs.scads.storage.transactions.<a href="FieldAnnotations.scala.html#10154" title="object edu.berkeley.cs.scads.storage.transactions.FieldAnnotations">FieldAnnotations</a>._

case <span class="keyword">class</span> <a href="#177596" title="class KeyRec extends org.apache.avro.specific.SpecificRecordBase with edu.berkeley.cs.avro.runtime.HasAvroConversions with edu.berkeley.cs.avro.marker.AvroRecord with ScalaObject with Product with Serializable" id="93064">KeyRec</a><a href="#93064" title="ScalaObject" class="delimiter">(</a><a href="#93064" title="()edu.berkeley.cs.scads.storage.examples.KeyRec" id="133531" class="keyword">var</a> <a title="Int" id="92480">x</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="edu.berkeley.cs.avro.marker.AvroRecord">AvroRecord</span>

case <span class="keyword">class</span> <a href="#177606" title="class ValueRec extends org.apache.avro.specific.SpecificRecordBase with edu.berkeley.cs.avro.runtime.HasAvroConversions with edu.berkeley.cs.avro.marker.AvroRecord with ScalaObject with Product with Serializable" id="93060">ValueRec</a><a href="#93060" title="ScalaObject" class="delimiter">(</a><a href="#93060" title="()edu.berkeley.cs.scads.storage.examples.ValueRec" id="133541" class="keyword">var</a> <a title="String" id="92484">s</a>: <span title="String">String</span>,
                    @FieldGT<span class="delimiter">(</span><span class="int">1</span><span class="delimiter">)</span>
                    @FieldGE<span class="delimiter">(</span><span class="int">2</span><span class="delimiter">)</span>
                    @FieldLT<span class="delimiter">(</span><span class="int">3</span><span class="delimiter">)</span>
                    @FieldLE<span class="delimiter">(</span><span class="int">4</span><span class="delimiter">)</span>
                    <span class="keyword">var</span> <a title="Int" id="92485">i</a>: <span title="Int">Int</span>,
                    @FieldGT<span class="delimiter">(</span><span class="int">1</span><span class="delimiter">)</span>
                    @FieldGE<span class="delimiter">(</span><span class="int">1</span><span class="delimiter">)</span>
                    @FieldLT<span class="delimiter">(</span><span class="int">4</span><span class="delimiter">)</span>
                    @FieldLE<span class="delimiter">(</span><span class="int">4</span><span class="delimiter">)</span>
                    <span class="keyword">var</span> <a title="Long" id="92486">a</a>: <span title="Long">Long</span>,
                    <span class="keyword">var</span> <a title="Float" id="92487">b</a>: <span title="Float">Float</span>,
                    <span class="keyword">var</span> <a title="Double" id="92488">c</a>: <span title="Double">Double</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="edu.berkeley.cs.avro.marker.AvroRecord">AvroRecord</span>

<span class="keyword">class</span> <a title="class TestTx extends java.lang.Object with ScalaObject" id="10202">TestTx</a> <a href="#10202" title="ScalaObject" class="delimiter">{</a>
  <span class="keyword">def</span> <a title="()Unit" id="92361">run</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.ManagedScadsCluster" id="92364">cluster</a> = <a href="../util/TestScalaEngine.scala.html#10639" title="object edu.berkeley.cs.scads.storage.TestScalaEngine">TestScalaEngine</a>.<a href="../util/TestScalaEngine.scala.html#92374" title="(numNodes: Int)edu.berkeley.cs.scads.storage.ManagedScadsCluster">newScadsCluster</a><span class="delimiter">(</span><span title="Int(4)" class="int">4</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="ns extends edu.berkeley.cs.scads.storage.SpecificNamespace[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec] with edu.berkeley.cs.scads.storage.transactions.Transactions[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec]" id="92365">ns</a> = <a href="#92378" title="edu.berkeley.cs.scads.storage.SpecificNamespace[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec] with edu.berkeley.cs.scads.storage.transactions.Transactions[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec]{}" class="keyword">new</a> <a title="anonymous class $anon extends edu.berkeley.cs.scads.storage.SpecificNamespace[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec] with edu.berkeley.cs.scads.storage.transactions.Transactions[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec]" id="92378">SpecificNamespace</a><span class="delimiter">[</span>KeyRec, ValueRec<span class="delimiter">]</span><span class="delimiter">(</span><span title="java.lang.String(&quot;testns&quot;)" class="string">&quot;testns&quot;</span>, <a href="#92364" title="edu.berkeley.cs.scads.storage.ManagedScadsCluster">cluster</a>, <a href="#92364" title="edu.berkeley.cs.scads.storage.ManagedScadsCluster">cluster</a>.<a href="../client/ScadsCluster.scala.html#44940" title="=&gt; edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">namespaces</a><span class="delimiter">)</span> <span class="keyword">with</span> <a href="Transactions.scala.html#10229" title="edu.berkeley.cs.scads.storage.transactions.Transactions[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec]">Transactions</a><span class="delimiter">[</span>KeyRec, ValueRec<span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">override</span> <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.transactions.TxProtocol2pc" id="92380">protocolType</a> = <a href="Tx.scala.html#92411" title="()edu.berkeley.cs.scads.storage.transactions.TxProtocol2pc">TxProtocol2pc</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#92365" title="ns extends edu.berkeley.cs.scads.storage.SpecificNamespace[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec] with edu.berkeley.cs.scads.storage.transactions.Transactions[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec]">ns</a>.<a href="../client/Namespace.scala.html#31140" title="()Unit">open</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#92365" title="ns extends edu.berkeley.cs.scads.storage.SpecificNamespace[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec] with edu.berkeley.cs.scads.storage.transactions.Transactions[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec]">ns</a>.<a href="../client/Routable.scala.html#44911" title="(scheme: Seq[(Option[Array[Byte]], Seq[edu.berkeley.cs.scads.storage.StorageService])])Unit">setPartitionScheme</a><span class="delimiter">(</span><span title="(xs: (None.type, List[edu.berkeley.cs.scads.storage.StorageService])*)List[(None.type, List[edu.berkeley.cs.scads.storage.StorageService])]">List</span><span class="delimiter">(</span><span title="(_1: None.type, _2: List[edu.berkeley.cs.scads.storage.StorageService])(None.type, List[edu.berkeley.cs.scads.storage.StorageService])" class="delimiter">(</span><span title="object None">None</span>, <a href="#92364" title="edu.berkeley.cs.scads.storage.ManagedScadsCluster">cluster</a>.<a href="../client/ScadsCluster.scala.html#44952" title="()List[edu.berkeley.cs.scads.storage.StorageService]">getAvailableServers</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span title="edu.berkeley.cs.scads.storage.transactions.Tx" class="keyword">new</span> <a href="Tx.scala.html#10267" title="edu.berkeley.cs.scads.storage.transactions.Tx">Tx</a><span class="delimiter">(</span><span title="Int(100)" class="int">100</span><span class="delimiter">)</span> <span class="delimiter">(</span><span class="delimiter">{</span>
      <a href="#92365" title="ns extends edu.berkeley.cs.scads.storage.SpecificNamespace[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec] with edu.berkeley.cs.scads.storage.transactions.Transactions[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec]">ns</a>.<a href="Transactions.scala.html#92394" title="(key: edu.berkeley.cs.scads.storage.examples.KeyRec, value: Option[edu.berkeley.cs.scads.storage.examples.ValueRec])Unit">put</a><span class="delimiter">(</span><a href="#93064" title="(x: Int)edu.berkeley.cs.scads.storage.examples.KeyRec">KeyRec</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <a href="#93060" title="(s: String, i: Int, a: Long, b: Float, c: Double)edu.berkeley.cs.scads.storage.examples.ValueRec">ValueRec</a><span title="(a: edu.berkeley.cs.scads.storage.examples.ValueRec)Option[edu.berkeley.cs.scads.storage.examples.ValueRec]" class="delimiter">(</span><span title="java.lang.String(&quot;A&quot;)" class="string">&quot;A&quot;</span>, <span title="Int(1)" class="int">1</span>, <span title="Long(1L)" class="int">1</span>, <span title="implicit scala.Predef.double2Double : (x: Double)java.lang.Double" class="double">1.0</span>.<span title="()Float">floatValue</span>, <span title="Double(1.0)" class="double">1.0</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#92365" title="ns extends edu.berkeley.cs.scads.storage.SpecificNamespace[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec] with edu.berkeley.cs.scads.storage.transactions.Transactions[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec]">ns</a>.<a href="Transactions.scala.html#92394" title="(key: edu.berkeley.cs.scads.storage.examples.KeyRec, value: Option[edu.berkeley.cs.scads.storage.examples.ValueRec])Unit">put</a><span class="delimiter">(</span><a href="#93064" title="(x: Int)edu.berkeley.cs.scads.storage.examples.KeyRec">KeyRec</a><span class="delimiter">(</span><span title="Int(2)" class="int">2</span><span class="delimiter">)</span>, <a href="#93060" title="(s: String, i: Int, a: Long, b: Float, c: Double)edu.berkeley.cs.scads.storage.examples.ValueRec">ValueRec</a><span title="(a: edu.berkeley.cs.scads.storage.examples.ValueRec)Option[edu.berkeley.cs.scads.storage.examples.ValueRec]" class="delimiter">(</span><span title="java.lang.String(&quot;B&quot;)" class="string">&quot;B&quot;</span>, <span title="Int(1)" class="int">1</span>, <span title="Long(1L)" class="int">1</span>, <span title="implicit scala.Predef.double2Double : (x: Double)java.lang.Double" class="double">1.0</span>.<span title="()Float">floatValue</span>, <span title="Double(1.0)" class="double">1.0</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#92365" title="ns extends edu.berkeley.cs.scads.storage.SpecificNamespace[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec] with edu.berkeley.cs.scads.storage.transactions.Transactions[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec]">ns</a>.<a href="Transactions.scala.html#92394" title="(key: edu.berkeley.cs.scads.storage.examples.KeyRec, value: Option[edu.berkeley.cs.scads.storage.examples.ValueRec])Unit">put</a><span class="delimiter">(</span><a href="#93064" title="(x: Int)edu.berkeley.cs.scads.storage.examples.KeyRec">KeyRec</a><span class="delimiter">(</span><span title="Int(3)" class="int">3</span><span class="delimiter">)</span>, <a href="#93060" title="(s: String, i: Int, a: Long, b: Float, c: Double)edu.berkeley.cs.scads.storage.examples.ValueRec">ValueRec</a><span title="(a: edu.berkeley.cs.scads.storage.examples.ValueRec)Option[edu.berkeley.cs.scads.storage.examples.ValueRec]" class="delimiter">(</span><span title="java.lang.String(&quot;C&quot;)" class="string">&quot;C&quot;</span>, <span title="Int(1)" class="int">1</span>, <span title="Long(1L)" class="int">1</span>, <span title="implicit scala.Predef.double2Double : (x: Double)java.lang.Double" class="double">1.0</span>.<span title="()Float">floatValue</span>, <span title="Double(1.0)" class="double">1.0</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#92365" title="ns extends edu.berkeley.cs.scads.storage.SpecificNamespace[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec] with edu.berkeley.cs.scads.storage.transactions.Transactions[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec]">ns</a>.<a href="Transactions.scala.html#92394" title="(key: edu.berkeley.cs.scads.storage.examples.KeyRec, value: Option[edu.berkeley.cs.scads.storage.examples.ValueRec])Unit">put</a><span class="delimiter">(</span><a href="#93064" title="(x: Int)edu.berkeley.cs.scads.storage.examples.KeyRec">KeyRec</a><span class="delimiter">(</span><span title="Int(4)" class="int">4</span><span class="delimiter">)</span>, <a href="#93060" title="(s: String, i: Int, a: Long, b: Float, c: Double)edu.berkeley.cs.scads.storage.examples.ValueRec">ValueRec</a><span title="(a: edu.berkeley.cs.scads.storage.examples.ValueRec)Option[edu.berkeley.cs.scads.storage.examples.ValueRec]" class="delimiter">(</span><span title="java.lang.String(&quot;D&quot;)" class="string">&quot;D&quot;</span>, <span title="Int(1)" class="int">1</span>, <span title="Long(1L)" class="int">1</span>, <span title="implicit scala.Predef.double2Double : (x: Double)java.lang.Double" class="double">1.0</span>.<span title="()Float">floatValue</span>, <span title="Double(1.0)" class="double">1.0</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>.<a href="Tx.scala.html#90419" title="()Unit">Execute</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.transactions.Tx" id="92366">tx1</a> = <span title="edu.berkeley.cs.scads.storage.transactions.Tx" class="keyword">new</span> <a href="Tx.scala.html#10267" title="edu.berkeley.cs.scads.storage.transactions.Tx">Tx</a><span class="delimiter">(</span><span title="Int(100)" class="int">100</span><span class="delimiter">)</span> <span class="delimiter">(</span><span class="delimiter">{</span>
      <span title="object List">List</span>.<span title="(start: Int, end: Int)(implicit evidence$1: Integral[Int])List[Int]">range</span><span title="object scala.math.Numeric.IntIsIntegral" class="delimiter">(</span><span title="Int(5)" class="int">5</span>, <span class="int">5</span> <span title="Int(9)">+</span> <span class="int">4</span><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="92611">x</a> =&gt; <a href="#92365" title="ns extends edu.berkeley.cs.scads.storage.SpecificNamespace[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec] with edu.berkeley.cs.scads.storage.transactions.Transactions[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec]">ns</a>.<a href="Transactions.scala.html#92394" title="(key: edu.berkeley.cs.scads.storage.examples.KeyRec, value: Option[edu.berkeley.cs.scads.storage.examples.ValueRec])Unit">put</a><span class="delimiter">(</span><a href="#93064" title="(x: Int)edu.berkeley.cs.scads.storage.examples.KeyRec">KeyRec</a><span class="delimiter">(</span><a href="#92611" title="Int">x</a><span class="delimiter">)</span>,
                                               <a href="#93060" title="(s: String, i: Int, a: Long, b: Float, c: Double)edu.berkeley.cs.scads.storage.examples.ValueRec">ValueRec</a><span title="(a: edu.berkeley.cs.scads.storage.examples.ValueRec)Option[edu.berkeley.cs.scads.storage.examples.ValueRec]" class="delimiter">(</span><span title="java.lang.String(&quot;G&quot;)" class="string">&quot;G&quot;</span>, <span title="Int(1)" class="int">1</span>, <span title="Long(1L)" class="int">1</span>, <span title="implicit scala.Predef.double2Double : (x: Double)java.lang.Double" class="double">1.0</span>.<span title="()Float">floatValue</span>, <span title="Double(1.0)" class="double">1.0</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>.<a href="Tx.scala.html#90417" title="(p: Double)(f: =&gt; Unit)edu.berkeley.cs.scads.storage.transactions.Tx">Accept</a><span class="delimiter">(</span><span title="Double(0.9)" class="double">0.90</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span>
    <span class="delimiter">}</span>.<a href="Tx.scala.html#90418" title="(f: edu.berkeley.cs.scads.storage.transactions.TxStatus =&gt; Unit)edu.berkeley.cs.scads.storage.transactions.Tx">Commit</a><span class="delimiter">(</span> <a title="edu.berkeley.cs.scads.storage.transactions.TxStatus" id="92642">success</a> =&gt; <span title="Unit" class="delimiter">{</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
    <a href="#92366" title="edu.berkeley.cs.scads.storage.transactions.Tx">tx1</a>.<a href="Tx.scala.html#90419" title="()Unit">Execute</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.transactions.Tx" id="92367">tx2</a> = <span title="edu.berkeley.cs.scads.storage.transactions.Tx" class="keyword">new</span> <a href="Tx.scala.html#10267" title="edu.berkeley.cs.scads.storage.transactions.Tx">Tx</a><span class="delimiter">(</span><span title="Int(100)" class="int">100</span><span class="delimiter">)</span> <span class="delimiter">(</span><span class="delimiter">{</span>
      <span title="object List">List</span>.<span title="(start: Int, end: Int)(implicit evidence$1: Integral[Int])List[Int]">range</span><span title="object scala.math.Numeric.IntIsIntegral" class="delimiter">(</span><span title="Int(9)" class="int">9</span>, <span class="int">9</span> <span title="Int(13)">+</span> <span class="int">4</span><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="92690">x</a> =&gt; <a href="#92365" title="ns extends edu.berkeley.cs.scads.storage.SpecificNamespace[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec] with edu.berkeley.cs.scads.storage.transactions.Transactions[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec]">ns</a>.<a href="Transactions.scala.html#92394" title="(key: edu.berkeley.cs.scads.storage.examples.KeyRec, value: Option[edu.berkeley.cs.scads.storage.examples.ValueRec])Unit">put</a><span class="delimiter">(</span><a href="#93064" title="(x: Int)edu.berkeley.cs.scads.storage.examples.KeyRec">KeyRec</a><span class="delimiter">(</span><a href="#92690" title="Int">x</a><span class="delimiter">)</span>,
                                               <a href="#93060" title="(s: String, i: Int, a: Long, b: Float, c: Double)edu.berkeley.cs.scads.storage.examples.ValueRec">ValueRec</a><span title="(a: edu.berkeley.cs.scads.storage.examples.ValueRec)Option[edu.berkeley.cs.scads.storage.examples.ValueRec]" class="delimiter">(</span><span title="java.lang.String(&quot;H&quot;)" class="string">&quot;H&quot;</span>, <span title="Int(1)" class="int">1</span>, <span title="Long(1L)" class="int">1</span>, <span title="implicit scala.Predef.double2Double : (x: Double)java.lang.Double" class="double">1.0</span>.<span title="()Float">floatValue</span>, <span title="Double(1.0)" class="double">1.0</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>.<a href="Tx.scala.html#90417" title="(p: Double)(f: =&gt; Unit)edu.berkeley.cs.scads.storage.transactions.Tx">Accept</a><span class="delimiter">(</span><span title="Double(0.9)" class="double">0.90</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span>
    <span class="delimiter">}</span>.<a href="Tx.scala.html#90418" title="(f: edu.berkeley.cs.scads.storage.transactions.TxStatus =&gt; Unit)edu.berkeley.cs.scads.storage.transactions.Tx">Commit</a><span class="delimiter">(</span> <a title="edu.berkeley.cs.scads.storage.transactions.TxStatus" id="92707">success</a> =&gt; <span title="Unit" class="delimiter">{</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
    <a href="#92367" title="edu.berkeley.cs.scads.storage.transactions.Tx">tx2</a>.<a href="Tx.scala.html#90419" title="()Unit">Execute</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.transactions.Tx" id="92368">tx3</a> = <span title="edu.berkeley.cs.scads.storage.transactions.Tx" class="keyword">new</span> <a href="Tx.scala.html#10267" title="edu.berkeley.cs.scads.storage.transactions.Tx">Tx</a><span class="delimiter">(</span><span title="Int(100)" class="int">100</span><span class="delimiter">)</span> <span class="delimiter">(</span><span class="delimiter">{</span>
      <span title="object List">List</span>.<span title="(start: Int, end: Int)(implicit evidence$1: Integral[Int])List[Int]">range</span><span title="object scala.math.Numeric.IntIsIntegral" class="delimiter">(</span><span title="Int(7)" class="int">7</span>, <span class="int">7</span> <span title="Int(11)">+</span> <span class="int">4</span><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="92755">x</a> =&gt; <a href="#92365" title="ns extends edu.berkeley.cs.scads.storage.SpecificNamespace[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec] with edu.berkeley.cs.scads.storage.transactions.Transactions[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec]">ns</a>.<a href="Transactions.scala.html#92394" title="(key: edu.berkeley.cs.scads.storage.examples.KeyRec, value: Option[edu.berkeley.cs.scads.storage.examples.ValueRec])Unit">put</a><span class="delimiter">(</span><a href="#93064" title="(x: Int)edu.berkeley.cs.scads.storage.examples.KeyRec">KeyRec</a><span class="delimiter">(</span><a href="#92755" title="Int">x</a><span class="delimiter">)</span>,
                                               <a href="#93060" title="(s: String, i: Int, a: Long, b: Float, c: Double)edu.berkeley.cs.scads.storage.examples.ValueRec">ValueRec</a><span title="(a: edu.berkeley.cs.scads.storage.examples.ValueRec)Option[edu.berkeley.cs.scads.storage.examples.ValueRec]" class="delimiter">(</span><span title="java.lang.String(&quot;I&quot;)" class="string">&quot;I&quot;</span>, <span title="Int(1)" class="int">1</span>, <span title="Long(1L)" class="int">1</span>, <span title="implicit scala.Predef.double2Double : (x: Double)java.lang.Double" class="double">1.0</span>.<span title="()Float">floatValue</span>, <span title="Double(1.0)" class="double">1.0</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>.<a href="Tx.scala.html#90417" title="(p: Double)(f: =&gt; Unit)edu.berkeley.cs.scads.storage.transactions.Tx">Accept</a><span class="delimiter">(</span><span title="Double(0.9)" class="double">0.90</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span>
    <span class="delimiter">}</span>.<a href="Tx.scala.html#90418" title="(f: edu.berkeley.cs.scads.storage.transactions.TxStatus =&gt; Unit)edu.berkeley.cs.scads.storage.transactions.Tx">Commit</a><span class="delimiter">(</span> <a title="edu.berkeley.cs.scads.storage.transactions.TxStatus" id="92772">success</a> =&gt; <span title="Unit" class="delimiter">{</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
    <a href="#92368" title="edu.berkeley.cs.scads.storage.transactions.Tx">tx3</a>.<a href="Tx.scala.html#90419" title="()Unit">Execute</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="comment">// Delete something</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;delete 1&quot;)" class="string">&quot;delete 1&quot;</span><span class="delimiter">)</span>

<span class="comment">//    ns.put(KeyRec(1), None)</span>

    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.transactions.Tx" id="92369">tx4</a> = <span title="edu.berkeley.cs.scads.storage.transactions.Tx" class="keyword">new</span> <a href="Tx.scala.html#10267" title="edu.berkeley.cs.scads.storage.transactions.Tx">Tx</a><span class="delimiter">(</span><span title="Int(100)" class="int">100</span><span class="delimiter">)</span> <span class="delimiter">(</span><span class="delimiter">{</span>
      <span class="comment">// need to read your writes...</span>
      <a href="#92365" title="ns extends edu.berkeley.cs.scads.storage.SpecificNamespace[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec] with edu.berkeley.cs.scads.storage.transactions.Transactions[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec]">ns</a>.<a href="Transactions.scala.html#92395" title="(key: edu.berkeley.cs.scads.storage.examples.KeyRec)Option[edu.berkeley.cs.scads.storage.examples.ValueRec]">get</a><span class="delimiter">(</span><a href="#93064" title="(x: Int)edu.berkeley.cs.scads.storage.examples.KeyRec">KeyRec</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#92365" title="ns extends edu.berkeley.cs.scads.storage.SpecificNamespace[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec] with edu.berkeley.cs.scads.storage.transactions.Transactions[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec]">ns</a>.<a href="Transactions.scala.html#92394" title="(key: edu.berkeley.cs.scads.storage.examples.KeyRec, value: Option[edu.berkeley.cs.scads.storage.examples.ValueRec])Unit">put</a><span class="delimiter">(</span><a href="#93064" title="(x: Int)edu.berkeley.cs.scads.storage.examples.KeyRec">KeyRec</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <span title="object None">None</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>.<a href="Tx.scala.html#90417" title="(p: Double)(f: =&gt; Unit)edu.berkeley.cs.scads.storage.transactions.Tx">Accept</a><span class="delimiter">(</span><span title="Double(0.9)" class="double">0.90</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span>
    <span class="delimiter">}</span>.<a href="Tx.scala.html#90418" title="(f: edu.berkeley.cs.scads.storage.transactions.TxStatus =&gt; Unit)edu.berkeley.cs.scads.storage.transactions.Tx">Commit</a><span class="delimiter">(</span> <a title="edu.berkeley.cs.scads.storage.transactions.TxStatus" id="92784">success</a> =&gt; <span title="Unit" class="delimiter">{</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
    <a href="#92369" title="edu.berkeley.cs.scads.storage.transactions.Tx">tx4</a>.<a href="Tx.scala.html#90419" title="()Unit">Execute</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;    get 1&quot;)" class="string">&quot;    get 1&quot;</span><span class="delimiter">)</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#92365" title="ns extends edu.berkeley.cs.scads.storage.SpecificNamespace[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec] with edu.berkeley.cs.scads.storage.transactions.Transactions[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec]">ns</a>.<a href="Transactions.scala.html#92395" title="(key: edu.berkeley.cs.scads.storage.examples.KeyRec)Option[edu.berkeley.cs.scads.storage.examples.ValueRec]">get</a><span class="delimiter">(</span><a href="#93064" title="(x: Int)edu.berkeley.cs.scads.storage.examples.KeyRec">KeyRec</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;    get range&quot;)" class="string">&quot;    get range&quot;</span><span class="delimiter">)</span>
    <a href="#92365" title="ns extends edu.berkeley.cs.scads.storage.SpecificNamespace[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec] with edu.berkeley.cs.scads.storage.transactions.Transactions[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec]">ns</a>.<a href="Transactions.scala.html#92396" title="(start: Option[edu.berkeley.cs.scads.storage.examples.KeyRec], end: Option[edu.berkeley.cs.scads.storage.examples.KeyRec], limit: Option[Int], offset: Option[Int], ascending: Boolean)Seq[(edu.berkeley.cs.scads.storage.examples.KeyRec, edu.berkeley.cs.scads.storage.examples.ValueRec)]">getRange</a><span class="delimiter">(</span><span title="object None">None</span>, <span title="object None">None</span><span class="delimiter">)</span>.<span title="(f: (edu.berkeley.cs.scads.storage.examples.KeyRec, edu.berkeley.cs.scads.storage.examples.ValueRec) =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="(edu.berkeley.cs.scads.storage.examples.KeyRec, edu.berkeley.cs.scads.storage.examples.ValueRec)" id="92989">x</a> =&gt; <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#92989" title="(edu.berkeley.cs.scads.storage.examples.KeyRec, edu.berkeley.cs.scads.storage.examples.ValueRec)">x</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="comment">// Logical updates</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;running some logical updates&quot;)" class="string">&quot;running some logical updates&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.transactions.Tx" id="92370">tx5</a> = <span title="edu.berkeley.cs.scads.storage.transactions.Tx" class="keyword">new</span> <a href="Tx.scala.html#10267" title="edu.berkeley.cs.scads.storage.transactions.Tx">Tx</a><span class="delimiter">(</span><span title="Int(100)" class="int">100</span><span class="delimiter">)</span> <span class="delimiter">(</span><span class="delimiter">{</span>
      <a href="#92365" title="ns extends edu.berkeley.cs.scads.storage.SpecificNamespace[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec] with edu.berkeley.cs.scads.storage.transactions.Transactions[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec]">ns</a>.<a href="Transactions.scala.html#92393" title="(key: edu.berkeley.cs.scads.storage.examples.KeyRec, value: edu.berkeley.cs.scads.storage.examples.ValueRec)Unit">putLogical</a><span class="delimiter">(</span><a href="#93064" title="(x: Int)edu.berkeley.cs.scads.storage.examples.KeyRec">KeyRec</a><span class="delimiter">(</span><span title="Int(12)" class="int">12</span><span class="delimiter">)</span>, <a href="#93060" title="(s: String, i: Int, a: Long, b: Float, c: Double)edu.berkeley.cs.scads.storage.examples.ValueRec">ValueRec</a><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="Int(2)" class="int">2</span>, <span title="Long(3L)" class="int">3</span>, <span title="implicit scala.Predef.double2Double : (x: Double)java.lang.Double" class="double">2.1</span>.<span title="()Float">floatValue</span>, <span title="Double(0.2)" class="double">0.2</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>.<a href="Tx.scala.html#90417" title="(p: Double)(f: =&gt; Unit)edu.berkeley.cs.scads.storage.transactions.Tx">Accept</a><span class="delimiter">(</span><span title="Double(0.9)" class="double">0.90</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span>
    <span class="delimiter">}</span>.<a href="Tx.scala.html#90418" title="(f: edu.berkeley.cs.scads.storage.transactions.TxStatus =&gt; Unit)edu.berkeley.cs.scads.storage.transactions.Tx">Commit</a><span class="delimiter">(</span> <a title="edu.berkeley.cs.scads.storage.transactions.TxStatus" id="93010">success</a> =&gt; <span title="Unit" class="delimiter">{</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
    <a href="#92370" title="edu.berkeley.cs.scads.storage.transactions.Tx">tx5</a>.<a href="Tx.scala.html#90419" title="()Unit">Execute</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#92370" title="edu.berkeley.cs.scads.storage.transactions.Tx">tx5</a>.<a href="Tx.scala.html#90419" title="()Unit">Execute</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#92370" title="edu.berkeley.cs.scads.storage.transactions.Tx">tx5</a>.<a href="Tx.scala.html#90419" title="()Unit">Execute</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#92370" title="edu.berkeley.cs.scads.storage.transactions.Tx">tx5</a>.<a href="Tx.scala.html#90419" title="()Unit">Execute</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#92370" title="edu.berkeley.cs.scads.storage.transactions.Tx">tx5</a>.<a href="Tx.scala.html#90419" title="()Unit">Execute</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#92365" title="ns extends edu.berkeley.cs.scads.storage.SpecificNamespace[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec] with edu.berkeley.cs.scads.storage.transactions.Transactions[edu.berkeley.cs.scads.storage.examples.KeyRec,edu.berkeley.cs.scads.storage.examples.ValueRec]">ns</a>.<a href="Transactions.scala.html#92396" title="(start: Option[edu.berkeley.cs.scads.storage.examples.KeyRec], end: Option[edu.berkeley.cs.scads.storage.examples.KeyRec], limit: Option[Int], offset: Option[Int], ascending: Boolean)Seq[(edu.berkeley.cs.scads.storage.examples.KeyRec, edu.berkeley.cs.scads.storage.examples.ValueRec)]">getRange</a><span class="delimiter">(</span><span title="object None">None</span>, <span title="object None">None</span><span class="delimiter">)</span>.<span title="(f: (edu.berkeley.cs.scads.storage.examples.KeyRec, edu.berkeley.cs.scads.storage.examples.ValueRec) =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="(edu.berkeley.cs.scads.storage.examples.KeyRec, edu.berkeley.cs.scads.storage.examples.ValueRec)" id="93029">x</a> =&gt; <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#93029" title="(edu.berkeley.cs.scads.storage.examples.KeyRec, edu.berkeley.cs.scads.storage.examples.ValueRec)">x</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.storage.examples.TestTx" id="10203">TestTx</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(args: Array[String])Unit" id="93034">main</a><span class="delimiter">(</span><a title="Array[String]" id="93036">args</a>: <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.examples.TestTx" id="93038">test</a> = <span title="edu.berkeley.cs.scads.storage.examples.TestTx" class="keyword">new</span> <a href="#10202" title="edu.berkeley.cs.scads.storage.examples.TestTx">TestTx</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#93038" title="edu.berkeley.cs.scads.storage.examples.TestTx">test</a>.<a href="#92361" title="()Unit">run</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Exiting...&quot;)" class="string">&quot;Exiting...&quot;</span><span class="delimiter">)</span>
    <span title="object java.lang.System">System</span>.<span title="(x$1: Int)Unit">exit</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>