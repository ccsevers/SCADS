<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>transactions/Protocol2pc.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs.scads.storage
<span class="keyword">package</span> transactions
<span class="keyword">package</span> prot2pc

<span class="keyword">import</span> net.lag.logging.Logger
<span class="keyword">import</span> java.util.Calendar

<span class="keyword">sealed</span> case <span class="keyword">class</span> <a title="class RecordUpdateInfo extends java.lang.Object with ScalaObject with Product with Serializable" id="91743">RecordUpdateInfo</a><a href="#91743" title="ScalaObject" class="delimiter">(</a><a title="Seq[edu.berkeley.cs.scads.storage.PartitionService]" id="91419">servers</a>: <span title="Seq[edu.berkeley.cs.scads.storage.PartitionService]">Seq</span><span class="delimiter">[</span>PartitionService<span class="delimiter">]</span>, <a title="edu.berkeley.cs.scads.storage.RecordUpdate" id="91420">update</a>: <a href="../Messages.scala.html#9680" title="edu.berkeley.cs.scads.storage.RecordUpdate">RecordUpdate</a><span class="delimiter">)</span>

<span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.storage.transactions.prot2pc.Protocol2pc" id="10166">Protocol2pc</a> <span title="ScalaObject" class="keyword">extends</span> <a href="ProtocolBase.scala.html#10172" title="edu.berkeley.cs.scads.storage.transactions.ProtocolBase">ProtocolBase</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(tx: edu.berkeley.cs.scads.storage.transactions.Tx)Unit" id="90385">RunProtocol</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.transactions.Tx" id="90390">tx</a>: <a href="Tx.scala.html#10267" title="edu.berkeley.cs.scads.storage.transactions.Tx">Tx</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;***** 2pc protocol *****&quot;)" class="string">&quot;***** 2pc protocol *****&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Long" id="90420">tid</a> = <span title="object java.util.Calendar">Calendar</span>.<span title="()java.util.Calendar">getInstance</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()Long">getTimeInMillis</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Boolean" id="90421">commitTest</a> = <a href="#90387" title="(tx: edu.berkeley.cs.scads.storage.transactions.Tx, tid: Long)Boolean">PrepareTest</a><span class="delimiter">(</span><a href="#90390" title="edu.berkeley.cs.scads.storage.transactions.Tx">tx</a>, <a href="#90420" title="Long">tid</a><span class="delimiter">)</span>
    <a href="#90388" title="(tx: edu.berkeley.cs.scads.storage.transactions.Tx, tid: Long, commitTest: Boolean)Unit">CommitTest</a><span class="delimiter">(</span><a href="#90390" title="edu.berkeley.cs.scads.storage.transactions.Tx">tx</a>, <a href="#90420" title="Long">tid</a>, <a href="#90421" title="Boolean">commitTest</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(updateList: edu.berkeley.cs.scads.storage.transactions.UpdateList, readList: edu.berkeley.cs.scads.storage.transactions.ReadList)Seq[edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo]" id="90386">transformUpdateList</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.transactions.UpdateList" id="90705">updateList</a>: <a href="UpdateList.scala.html#10330" title="edu.berkeley.cs.scads.storage.transactions.UpdateList">UpdateList</a>, <a title="edu.berkeley.cs.scads.storage.transactions.ReadList" id="90706">readList</a>: <a href="ReadList.scala.html#10185" title="edu.berkeley.cs.scads.storage.transactions.ReadList">ReadList</a><span class="delimiter">)</span>: <span title="Seq[edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo]">Seq</span><span class="delimiter">[</span>RecordUpdateInfo<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#90705" title="edu.berkeley.cs.scads.storage.transactions.UpdateList">updateList</a>.<a href="UpdateList.scala.html#90713" title="()List[edu.berkeley.cs.scads.storage.transactions.UpdateInfo]">getUpdateList</a>.<span title="(f: edu.berkeley.cs.scads.storage.transactions.UpdateInfo =&gt; edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo)(implicit bf: scala.collection.generic.CanBuildFrom[List[edu.berkeley.cs.scads.storage.transactions.UpdateInfo],edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo,Seq[edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo]])Seq[edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo,List[edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.transactions.UpdateInfo" id="91342">update</a> =&gt; <span class="delimiter">{</span>
      <a href="#91342" title="edu.berkeley.cs.scads.storage.transactions.UpdateInfo">update</a> <span title="edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo">ValueUpdateInfo</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.transactions.TransactionDefaultMetadata" id="91397">ns</a>, <a title="Seq[edu.berkeley.cs.scads.storage.PartitionService]" id="91398">servers</a>, <a title="Array[Byte]" id="91399">key</a>, <a title="Option[Array[Byte]]" id="91400">value</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Option[edu.berkeley.cs.scads.storage.MDCCMetadata]" id="91401">md</a> = <a href="#90706" title="edu.berkeley.cs.scads.storage.transactions.ReadList">readList</a>.<a href="ReadList.scala.html#90719" title="(key: Array[Byte])Option[edu.berkeley.cs.scads.storage.MDCCRecord]">getRecord</a><span class="delimiter">(</span><a href="#91399" title="Array[Byte]">key</a><span class="delimiter">)</span>.<span title="(f: edu.berkeley.cs.scads.storage.MDCCRecord =&gt; edu.berkeley.cs.scads.storage.MDCCMetadata)Option[edu.berkeley.cs.scads.storage.MDCCMetadata]">map</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.MDCCRecord" id="91409">r</a> =&gt;
            <a href="../Messages.scala.html#26939" title="(currentRound: Long, ballots: Seq[edu.berkeley.cs.scads.storage.MDCCBallotRange])edu.berkeley.cs.scads.storage.MDCCMetadata">MDCCMetadata</a><span class="delimiter">(</span><a href="#91409" title="edu.berkeley.cs.scads.storage.MDCCRecord">r</a>.<a href="../Messages.scala.html#27192" title="=&gt; edu.berkeley.cs.scads.storage.MDCCMetadata">metadata</a>.<a href="../Messages.scala.html#26907" title="=&gt; Long">currentRound</a>, <a href="#91409" title="edu.berkeley.cs.scads.storage.MDCCRecord">r</a>.<a href="../Messages.scala.html#27192" title="=&gt; edu.berkeley.cs.scads.storage.MDCCMetadata">metadata</a>.<a href="../Messages.scala.html#26910" title="=&gt; Seq[edu.berkeley.cs.scads.storage.MDCCBallotRange]">ballots</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Option[edu.berkeley.cs.scads.storage.MDCCMetadata]" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <span title="Some[edu.berkeley.cs.scads.storage.MDCCMetadata]">None</span> =&gt; <span title="(x: edu.berkeley.cs.scads.storage.MDCCMetadata)Some[edu.berkeley.cs.scads.storage.MDCCMetadata]">Some</span><span class="delimiter">(</span><a href="#91397" title="edu.berkeley.cs.scads.storage.transactions.TransactionDefaultMetadata">ns</a>.<a href="Transactions.scala.html#91374" title="()edu.berkeley.cs.scads.storage.MDCCMetadata">getDefaultMeta</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a title="Option[edu.berkeley.cs.scads.storage.MDCCMetadata]" id="91416">x</a> =&gt; <a href="#91416" title="Option[edu.berkeley.cs.scads.storage.MDCCMetadata]">x</a>
            <span class="delimiter">}</span>
          <span class="comment">//TODO: Do we really need the MDCCMetadata</span>
          <span class="keyword">val</span> <a title="Array[Byte]" id="91402">newBytes</a> = <a href="Transactions.scala.html#10232" title="object edu.berkeley.cs.scads.storage.transactions.MDCCRecordUtil">MDCCRecordUtil</a>.<a href="Transactions.scala.html#80720" title="(rec: Option[Array[Byte]], metadata: Option[edu.berkeley.cs.scads.storage.MDCCMetadata])Array[Byte]">toBytes</a><span class="delimiter">(</span><a href="#91400" title="Option[Array[Byte]]">value</a>, <a href="#91401" title="Option[edu.berkeley.cs.scads.storage.MDCCMetadata]">md</a><span class="delimiter">)</span>
          <a href="#91743" title="(servers: Seq[edu.berkeley.cs.scads.storage.PartitionService], update: edu.berkeley.cs.scads.storage.RecordUpdate)edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo">RecordUpdateInfo</a><span class="delimiter">(</span><a href="#91398" title="Seq[edu.berkeley.cs.scads.storage.PartitionService]">servers</a>, <a href="../Messages.scala.html#27473" title="(key: Array[Byte], oldValue: Option[Array[Byte]], newValue: Array[Byte])edu.berkeley.cs.scads.storage.ValueUpdate">ValueUpdate</a><span class="delimiter">(</span><a href="#91399" title="Array[Byte]">key</a>, <span title="object None">None</span>, <a href="#91402" title="Array[Byte]">newBytes</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo">LogicalUpdateInfo</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.transactions.TransactionDefaultMetadata" id="91480">ns</a>, <a title="Seq[edu.berkeley.cs.scads.storage.PartitionService]" id="91481">servers</a>, <a title="Array[Byte]" id="91482">key</a>, <a title="Option[Array[Byte]]" id="91483">value</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Option[edu.berkeley.cs.scads.storage.MDCCMetadata]" id="91484">md</a> = <a href="#90706" title="edu.berkeley.cs.scads.storage.transactions.ReadList">readList</a>.<a href="ReadList.scala.html#90719" title="(key: Array[Byte])Option[edu.berkeley.cs.scads.storage.MDCCRecord]">getRecord</a><span class="delimiter">(</span><a href="#91482" title="Array[Byte]">key</a><span class="delimiter">)</span>.<span title="(f: edu.berkeley.cs.scads.storage.MDCCRecord =&gt; edu.berkeley.cs.scads.storage.MDCCMetadata)Option[edu.berkeley.cs.scads.storage.MDCCMetadata]">map</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.MDCCRecord" id="91489">r</a> =&gt;
            <a href="../Messages.scala.html#26939" title="(currentRound: Long, ballots: Seq[edu.berkeley.cs.scads.storage.MDCCBallotRange])edu.berkeley.cs.scads.storage.MDCCMetadata">MDCCMetadata</a><span class="delimiter">(</span><a href="#91489" title="edu.berkeley.cs.scads.storage.MDCCRecord">r</a>.<a href="../Messages.scala.html#27192" title="=&gt; edu.berkeley.cs.scads.storage.MDCCMetadata">metadata</a>.<a href="../Messages.scala.html#26907" title="=&gt; Long">currentRound</a>, <a href="#91489" title="edu.berkeley.cs.scads.storage.MDCCRecord">r</a>.<a href="../Messages.scala.html#27192" title="=&gt; edu.berkeley.cs.scads.storage.MDCCMetadata">metadata</a>.<a href="../Messages.scala.html#26910" title="=&gt; Seq[edu.berkeley.cs.scads.storage.MDCCBallotRange]">ballots</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Option[edu.berkeley.cs.scads.storage.MDCCMetadata]" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <span title="Some[edu.berkeley.cs.scads.storage.MDCCMetadata]">None</span> =&gt; <span title="(x: edu.berkeley.cs.scads.storage.MDCCMetadata)Some[edu.berkeley.cs.scads.storage.MDCCMetadata]">Some</span><span class="delimiter">(</span><a href="#91480" title="edu.berkeley.cs.scads.storage.transactions.TransactionDefaultMetadata">ns</a>.<a href="Transactions.scala.html#91374" title="()edu.berkeley.cs.scads.storage.MDCCMetadata">getDefaultMeta</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a title="Option[edu.berkeley.cs.scads.storage.MDCCMetadata]" id="91496">x</a> =&gt; <a href="#91496" title="Option[edu.berkeley.cs.scads.storage.MDCCMetadata]">x</a>
            <span class="delimiter">}</span>
          <span class="keyword">val</span> <a title="Array[Byte]" id="91485">newBytes</a> = <a href="Transactions.scala.html#10232" title="object edu.berkeley.cs.scads.storage.transactions.MDCCRecordUtil">MDCCRecordUtil</a>.<a href="Transactions.scala.html#80720" title="(rec: Option[Array[Byte]], metadata: Option[edu.berkeley.cs.scads.storage.MDCCMetadata])Array[Byte]">toBytes</a><span class="delimiter">(</span><a href="#91483" title="Option[Array[Byte]]">value</a>, <a href="#91484" title="Option[edu.berkeley.cs.scads.storage.MDCCMetadata]">md</a><span class="delimiter">)</span>
          <a href="#91743" title="(servers: Seq[edu.berkeley.cs.scads.storage.PartitionService], update: edu.berkeley.cs.scads.storage.RecordUpdate)edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo">RecordUpdateInfo</a><span class="delimiter">(</span><a href="#91481" title="Seq[edu.berkeley.cs.scads.storage.PartitionService]">servers</a>, <a href="../Messages.scala.html#27300" title="(key: Array[Byte], delta: Array[Byte])edu.berkeley.cs.scads.storage.LogicalUpdate">LogicalUpdate</a><span class="delimiter">(</span><a href="#91482" title="Array[Byte]">key</a>, <a href="#91485" title="Array[Byte]">newBytes</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(tx: edu.berkeley.cs.scads.storage.transactions.Tx, tid: Long)Boolean" id="90387">PrepareTest</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.transactions.Tx" id="90697">tx</a>: <a href="Tx.scala.html#10267" title="edu.berkeley.cs.scads.storage.transactions.Tx">Tx</a>, <a title="Long" id="90698">tid</a>: <span title="Long">Long</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="90701">count</a> = <span title="Int(0)" class="int">0</span>

    <span class="keyword">val</span> <a title="Seq[(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int)]" id="90702">responses</a> = <a href="#90386" title="(updateList: edu.berkeley.cs.scads.storage.transactions.UpdateList, readList: edu.berkeley.cs.scads.storage.transactions.ReadList)Seq[edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo]">transformUpdateList</a><span class="delimiter">(</span><a href="#90697" title="edu.berkeley.cs.scads.storage.transactions.Tx">tx</a>.<a href="Tx.scala.html#90407" title="=&gt; edu.berkeley.cs.scads.storage.transactions.UpdateList">updateList</a>, <a href="#90697" title="edu.berkeley.cs.scads.storage.transactions.Tx">tx</a>.<a href="Tx.scala.html#90410" title="=&gt; edu.berkeley.cs.scads.storage.transactions.ReadList">readList</a><span class="delimiter">)</span>.<span title="(f: edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo =&gt; (Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo],(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int),Seq[(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int)]])Seq[(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int)]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int),Seq[(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int)]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo" id="90744">t</a> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.storage.PartitionService]" id="90745">servers</a> = <a href="#90744" title="edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo">t</a>.<a href="#91419" title="=&gt; Seq[edu.berkeley.cs.scads.storage.PartitionService]">servers</a>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.RecordUpdate" id="90746">recordUpdate</a> = <a href="#90744" title="edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo">t</a>.<a href="#91420" title="=&gt; edu.berkeley.cs.scads.storage.RecordUpdate">update</a>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.PrepareRequest" id="90747">putRequest</a> = <a href="../Messages.scala.html#29009" title="(xid: edu.berkeley.cs.scads.storage.ScadsXid, updates: Seq[edu.berkeley.cs.scads.storage.RecordUpdate])edu.berkeley.cs.scads.storage.PrepareRequest">PrepareRequest</a><span class="delimiter">(</span><a href="../Messages.scala.html#28103" title="(tid: Long, bid: Long)edu.berkeley.cs.scads.storage.ScadsXid">ScadsXid</a><span class="delimiter">(</span><a href="#90698" title="Long">tid</a>, <a href="#90701" title="=&gt; Long">count</a><span class="delimiter">)</span>,
                                      <span title="(xs: edu.berkeley.cs.scads.storage.RecordUpdate*)List[edu.berkeley.cs.scads.storage.RecordUpdate]">List</span><span class="delimiter">(</span><a href="#90746" title="edu.berkeley.cs.scads.storage.RecordUpdate">recordUpdate</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#90701" title="Int">count</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      <span title="(_1: Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], _2: Int)(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int)" class="delimiter">(</span><a href="#90745" title="Seq[edu.berkeley.cs.scads.storage.PartitionService]">servers</a>.<span title="(f: edu.berkeley.cs.scads.storage.PartitionService =&gt; edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.storage.PartitionService],edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage],Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]])Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage],Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]]" class="delimiter">(</span><a href="#90782" title="edu.berkeley.cs.scads.storage.PartitionService">_</a> <span title="(body: edu.berkeley.cs.scads.storage.StorageMessage)edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">!!</span> <a href="#90747" title="edu.berkeley.cs.scads.storage.PrepareRequest">putRequest</a><span class="delimiter">)</span>, <a href="#90745" title="Seq[edu.berkeley.cs.scads.storage.PartitionService]">servers</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Seq[Seq[Boolean]]" id="90703">results</a> = <a href="#90702" title="Seq[(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int)]">responses</a>.<span title="(f: (Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int) =&gt; Seq[Boolean])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int)],Seq[Boolean],Seq[Seq[Boolean]]])Seq[Seq[Boolean]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Seq[Boolean],Seq[Seq[Boolean]]]" class="delimiter">(</span><a title="(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int)" id="90840">x</a> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Seq[Boolean]" id="90841">res</a> = <a href="#90840" title="(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int)">x</a>.<span title="(futures: Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]])edu.berkeley.cs.scads.comm.FutureCollection[edu.berkeley.cs.scads.storage.StorageMessage]">_1</span>.<span title="(count: Int)Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]">blockFor</span><span class="delimiter">(</span><a href="#90840" title="(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int)">x</a>.<span title="=&gt; Int">_2</span><span class="delimiter">)</span>.<span title="(f: edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage] =&gt; Boolean)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]],Boolean,Seq[Boolean]])Seq[Boolean]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Boolean,Seq[Boolean]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]" id="90895">f</a> =&gt; <a href="#90895" title="()edu.berkeley.cs.scads.storage.StorageMessage">f</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Boolean">PrepareResponse</span><span class="delimiter">(</span><a title="Boolean" id="90899">success</a><span class="delimiter">)</span> =&gt; <a href="#90899" title="Boolean">success</a>
        <span class="keyword">case</span> <a title="Boolean(false)" id="90900">m</a> =&gt; <span title="Boolean(false)" class="keyword">false</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      <a href="#90841" title="Seq[Boolean]">res</a>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Boolean" id="90704">commitTest</a> = <span title="=&gt; Boolean">!</span><a href="#90703" title="Seq[Seq[Boolean]]">results</a>.<span title="(f: Seq[Boolean] =&gt; Boolean)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[Seq[Boolean]],Boolean,Seq[Boolean]])Seq[Boolean]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Boolean,Seq[Boolean]]" class="delimiter">(</span><a title="Seq[Boolean]" id="90955">x</a> =&gt; <span title="=&gt; Boolean">!</span><a href="#90955" title="Seq[Boolean]">x</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
    <a href="#90704" title="Boolean">commitTest</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(tx: edu.berkeley.cs.scads.storage.transactions.Tx, tid: Long, commitTest: Boolean)Unit" id="90388">CommitTest</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.transactions.Tx" id="90977">tx</a>: <a href="Tx.scala.html#10267" title="edu.berkeley.cs.scads.storage.transactions.Tx">Tx</a>, <a title="Long" id="90978">tid</a>: <span title="Long">Long</span>, <a title="Boolean" id="90979">commitTest</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="91590">count</a> = <span title="Int(0)" class="int">0</span>
    <span class="keyword">val</span> <a title="Seq[(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int)]" id="91591">commitResponses</a> = <a href="#90386" title="(updateList: edu.berkeley.cs.scads.storage.transactions.UpdateList, readList: edu.berkeley.cs.scads.storage.transactions.ReadList)Seq[edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo]">transformUpdateList</a><span class="delimiter">(</span><a href="#90977" title="edu.berkeley.cs.scads.storage.transactions.Tx">tx</a>.<a href="Tx.scala.html#90407" title="=&gt; edu.berkeley.cs.scads.storage.transactions.UpdateList">updateList</a>, <a href="#90977" title="edu.berkeley.cs.scads.storage.transactions.Tx">tx</a>.<a href="Tx.scala.html#90410" title="=&gt; edu.berkeley.cs.scads.storage.transactions.ReadList">readList</a><span class="delimiter">)</span>.<span title="(f: edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo =&gt; (Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo],(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int),Seq[(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int)]])Seq[(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int)]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int),Seq[(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int)]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo" id="91611">t</a> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.storage.PartitionService]" id="91612">servers</a> = <a href="#91611" title="edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo">t</a>.<a href="#91419" title="=&gt; Seq[edu.berkeley.cs.scads.storage.PartitionService]">servers</a>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.RecordUpdate" id="91613">recordUpdate</a> = <a href="#91611" title="edu.berkeley.cs.scads.storage.transactions.prot2pc.RecordUpdateInfo">t</a>.<a href="#91420" title="=&gt; edu.berkeley.cs.scads.storage.RecordUpdate">update</a>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.CommitRequest" id="91614">commitRequest</a> = <a href="../Messages.scala.html#29152" title="(xid: edu.berkeley.cs.scads.storage.ScadsXid, updates: Seq[edu.berkeley.cs.scads.storage.RecordUpdate], commit: Boolean)edu.berkeley.cs.scads.storage.CommitRequest">CommitRequest</a><span class="delimiter">(</span><a href="../Messages.scala.html#28103" title="(tid: Long, bid: Long)edu.berkeley.cs.scads.storage.ScadsXid">ScadsXid</a><span class="delimiter">(</span><a href="#90978" title="Long">tid</a>, <a href="#91590" title="=&gt; Long">count</a><span class="delimiter">)</span>,
                                        <span title="(xs: edu.berkeley.cs.scads.storage.RecordUpdate*)List[edu.berkeley.cs.scads.storage.RecordUpdate]">List</span><span class="delimiter">(</span><a href="#91613" title="edu.berkeley.cs.scads.storage.RecordUpdate">recordUpdate</a><span class="delimiter">)</span>,
                                        <a href="#90979" title="Boolean">commitTest</a><span class="delimiter">)</span>
      <a href="#91590" title="Int">count</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      <span title="(_1: Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], _2: Int)(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int)" class="delimiter">(</span><a href="#91612" title="Seq[edu.berkeley.cs.scads.storage.PartitionService]">servers</a>.<span title="(f: edu.berkeley.cs.scads.storage.PartitionService =&gt; edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.storage.PartitionService],edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage],Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]])Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage],Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]]" class="delimiter">(</span><a href="#91649" title="edu.berkeley.cs.scads.storage.PartitionService">_</a> <span title="(body: edu.berkeley.cs.scads.storage.StorageMessage)edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">!!</span> <a href="#91614" title="edu.berkeley.cs.scads.storage.CommitRequest">commitRequest</a><span class="delimiter">)</span>, <a href="#91612" title="Seq[edu.berkeley.cs.scads.storage.PartitionService]">servers</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
    <a href="#91591" title="Seq[(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int)]">commitResponses</a>.<span title="(f: (Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int) =&gt; Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]])Unit">foreach</span><span class="delimiter">(</span><a title="(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int)" id="91707">x</a> =&gt; <a href="#91707" title="(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int)">x</a>.<span title="(futures: Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]])edu.berkeley.cs.scads.comm.FutureCollection[edu.berkeley.cs.scads.storage.StorageMessage]">_1</span>.<span title="(count: Int)Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]]">blockFor</span><span class="delimiter">(</span><a href="#91707" title="(Seq[edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]], Int)">x</a>.<span title="=&gt; Int">_2</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>