<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>server/PartitionHandler.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs.scads.storage

<span class="keyword">import</span> edu.berkeley.cs.scads.comm._
<span class="keyword">import</span> net.lag.logging.Logger
<span class="keyword">import</span> scala.collection.mutable.ArrayBuffer
<span class="keyword">import</span> java.io.<span class="delimiter">{</span>BufferedReader,ObjectInputStream,InputStream,InputStreamReader,ByteArrayInputStream<span class="delimiter">}</span>
<span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger

<span class="comment">// keep track of number of gets and puts</span>
case <span class="keyword">class</span> <a title="class PartitionWorkloadStats extends java.lang.Object with ScalaObject with Product with Serializable" id="80883">PartitionWorkloadStats</a><a href="#80883" title="ScalaObject" class="delimiter">(</a><span class="keyword">var</span> <a title="Int" id="80306">gets</a>:<span title="Int">Int</span>, <span class="keyword">var</span> <a title="Int" id="80307">puts</a>:<span title="Int">Int</span><span class="delimiter">)</span>

<span class="comment">// Used for bulk puts of urls</span>
<span class="keyword">abstract</span> <span class="keyword">trait</span> <a title="trait RecParser extends java.lang.Object with Serializable with ScalaObject" id="10056">RecParser</a> <span title="ScalaObject" class="keyword">extends</span> <span title="Serializable">Serializable</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(location: String)Unit" id="53616">setLocation</a><span class="delimiter">(</span><a title="String" id="72900">location</a>:<span title="String">String</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> = <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="(in: java.io.InputStream)Unit" id="53617">setInput</a><span class="delimiter">(</span><a title="java.io.InputStream" id="73025">in</a>:<span title="java.io.InputStream">InputStream</span><span class="delimiter">)</span>:<span title="Unit">Unit</span>
  <span class="keyword">def</span> <a title="()(AnyRef, AnyRef)" id="53618">getNext</a><span class="delimiter">(</span><span class="delimiter">)</span>:<span title="(AnyRef, AnyRef)" class="delimiter">(</span>AnyRef,AnyRef<span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class RequestRejectedException extends java.lang.Exception with ScalaObject" id="10057">RequestRejectedException</a><a href="#10057" title="ScalaObject" class="delimiter">(</a><a title="String" id="76848">e</a>:<span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="java.lang.Exception">Exception</span><span class="delimiter">(</span><a href="#76848" title="String">e</a><span class="delimiter">)</span>

<span class="comment">/* Everything at this level is done in Array[Byte] packets as all these methods
 * get called as a result of receiving Avro messages and their responses
 * will also go out as Avro messages.  Converting these bytes to an internal
 * representation, or using them as is, is left to the StorageManager */</span>
<span class="keyword">abstract</span> <span class="keyword">trait</span> <a title="trait StorageManager extends java.lang.Object" id="10058">StorageManager</a> <span title="java.lang.Object" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(key: Array[Byte])Option[Array[Byte]]" id="68516">get</a><span class="delimiter">(</span><a title="Array[Byte]" id="72699">key</a>:<span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>:<span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>
  <span class="keyword">def</span> <a title="(key: Array[Byte], value: Option[Array[Byte]])Unit" id="68517">put</a><span class="delimiter">(</span><a title="Array[Byte]" id="72795">key</a>:<span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span>,<a title="Option[Array[Byte]]" id="72796">value</a>:<span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>:<span title="Unit">Unit</span>
  <span class="keyword">def</span> <a title="(key: Array[Byte], value: Option[Array[Byte]], expectedValue: Option[Array[Byte]])Boolean" id="68518">testAndSet</a><span class="delimiter">(</span><a title="Array[Byte]" id="72809">key</a>:<span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span>, <a title="Option[Array[Byte]]" id="72810">value</a>:<span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Option[Array[Byte]]" id="72811">expectedValue</a>:<span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>:<span title="Boolean">Boolean</span>
  <span class="comment">// bit odd to have PutRequest in here, but would probable be a performance hit to do it another way</span>
  <span class="keyword">def</span> <a title="(parser: edu.berkeley.cs.scads.storage.RecParser, locations: Seq[String])Unit" id="68519">bulkUrlPut</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.RecParser" id="72878">parser</a>:<a href="#10056" title="edu.berkeley.cs.scads.storage.RecParser">RecParser</a>, <a title="Seq[String]" id="72879">locations</a>:<span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(records: Seq[edu.berkeley.cs.scads.storage.PutRequest])Unit" id="68520">bulkPut</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.storage.PutRequest]" id="73045">records</a>:<span title="Seq[edu.berkeley.cs.scads.storage.PutRequest]">Seq</span><span class="delimiter">[</span>PutRequest<span class="delimiter">]</span><span class="delimiter">)</span> 
  <span class="comment">// cursorscanrequest?</span>
  <span class="keyword">def</span> <a title="(minKey: Option[Array[Byte]], maxKey: Option[Array[Byte]], limit: Option[Int], offset: Option[Int], ascending: Boolean)Seq[edu.berkeley.cs.scads.storage.Record]" id="68521">getRange</a><span class="delimiter">(</span><a title="Option[Array[Byte]]" id="73082">minKey</a>:<span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Option[Array[Byte]]" id="73083">maxKey</a>:<span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Option[Int]" id="73084">limit</a>:<span title="Option[Int]">Option</span><span class="delimiter">[</span>Int<span class="delimiter">]</span>, <a title="Option[Int]" id="73085">offset</a>:<span title="Option[Int]">Option</span><span class="delimiter">[</span>Int<span class="delimiter">]</span>, <a title="Boolean" id="73086">ascending</a>:<span title="Boolean">Boolean</span><span class="delimiter">)</span>:<span title="Seq[edu.berkeley.cs.scads.storage.Record]">Seq</span><span class="delimiter">[</span>Record<span class="delimiter">]</span>
  <span class="keyword">def</span> <a title="(ranges: Seq[edu.berkeley.cs.scads.storage.StorageMessage])scala.collection.mutable.ArrayBuffer[edu.berkeley.cs.scads.storage.GetRangeResponse]" id="68522">getBatch</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.storage.StorageMessage]" id="73166">ranges</a>:<span title="Seq[edu.berkeley.cs.scads.storage.StorageMessage]">Seq</span><span class="delimiter">[</span>StorageMessage<span class="delimiter">]</span><span class="delimiter">)</span>:<span title="scala.collection.mutable.ArrayBuffer[edu.berkeley.cs.scads.storage.GetRangeResponse]">ArrayBuffer</span><span class="delimiter">[</span>GetRangeResponse<span class="delimiter">]</span>
  <span class="keyword">def</span> <a title="(minKey: Option[Array[Byte]], maxKey: Option[Array[Byte]])Int" id="68523">countRange</a><span class="delimiter">(</span><a title="Option[Array[Byte]]" id="73259">minKey</a>:<span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Option[Array[Byte]]" id="73260">maxKey</a>:<span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>:<span title="Int">Int</span>
  <span class="keyword">def</span> <a title="(src: edu.berkeley.cs.scads.storage.PartitionService, overwrite: Boolean)Unit" id="68524">copyData</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.PartitionService" id="73279">src</a>:<a href="../Messages.scala.html#9559" title="edu.berkeley.cs.scads.storage.PartitionService">PartitionService</a>, <a title="Boolean" id="73280">overwrite</a>:<span title="Boolean">Boolean</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="()(Option[Array[Byte]], Option[Array[Byte]])" id="68525">getResponsibility</a><span class="delimiter">(</span><span class="delimiter">)</span>:<span title="(Option[Array[Byte]], Option[Array[Byte]])" class="delimiter">(</span>Option<span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>,Option<span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>
  <span class="comment">//def deleteRange(minKey: Option[Array[Byte]], maxKey: Option[Array[Byte]], txn: Option[Transaction])</span>
  <span class="keyword">def</span> <a title="(groups: Seq[String], keyType: String, valType: String, filters: Seq[edu.berkeley.cs.scads.storage.AggFilter], aggregates: Seq[edu.berkeley.cs.scads.storage.AggOp])Seq[edu.berkeley.cs.scads.storage.GroupedAgg]" id="68526">applyAggregate</a><span class="delimiter">(</span><a title="Seq[String]" id="73358">groups</a>:<span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span>,
                     <a title="String" id="73359">keyType</a>:<span title="String">String</span>,
                     <a title="String" id="73360">valType</a>:<span title="String">String</span>,
                     <a title="Seq[edu.berkeley.cs.scads.storage.AggFilter]" id="73361">filters</a>:<span title="Seq[edu.berkeley.cs.scads.storage.AggFilter]">Seq</span><span class="delimiter">[</span>AggFilter<span class="delimiter">]</span>,
                     <a title="Seq[edu.berkeley.cs.scads.storage.AggOp]" id="73362">aggregates</a>:<span title="Seq[edu.berkeley.cs.scads.storage.AggOp]">Seq</span><span class="delimiter">[</span>AggOp<span class="delimiter">]</span><span class="delimiter">)</span>:<span title="Seq[edu.berkeley.cs.scads.storage.GroupedAgg]">Seq</span><span class="delimiter">[</span>GroupedAgg<span class="delimiter">]</span>
  <span class="keyword">def</span> <a title="()Unit" id="68527">startup</a><span class="delimiter">(</span><span class="delimiter">)</span>:<span title="Unit">Unit</span>
  <span class="keyword">def</span> <a title="()Unit" id="68528">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>:<span title="Unit">Unit</span>
<span class="delimiter">}</span>


case <span class="keyword">class</span> <a title="class PartitionHandler extends java.lang.Object with edu.berkeley.cs.scads.comm.ServiceHandler[edu.berkeley.cs.scads.storage.StorageMessage] with ScalaObject with Product with Serializable" id="80879">PartitionHandler</a><a href="#80879" title="ScalaObject" class="delimiter">(</a><a title="edu.berkeley.cs.scads.storage.StorageManager" id="80876">manager</a>:<a href="#10058" title="edu.berkeley.cs.scads.storage.StorageManager">StorageManager</a><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="edu.berkeley.cs.scads.comm.ServiceHandler[edu.berkeley.cs.scads.storage.StorageMessage]">ServiceHandler</span><span class="delimiter">[</span>StorageMessage<span class="delimiter">]</span> <span class="delimiter">{</span>

  <span class="keyword">protected</span> <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="80261">logger</a> = <span title="(name: String)net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span title="java.lang.String(&quot;PartitionHandler&quot;)" class="string">&quot;PartitionHandler&quot;</span><span class="delimiter">)</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="()Unit" id="80263">startup</a><span class="delimiter">(</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> = <a href="#80876" title="=&gt; edu.berkeley.cs.scads.storage.StorageManager">manager</a>.<a href="#68527" title="()Unit">startup</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="()Unit" id="80264">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> = <a href="#80876" title="=&gt; edu.berkeley.cs.scads.storage.StorageManager">manager</a>.<a href="#68528" title="()Unit">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="=&gt; edu.berkeley.cs.scads.storage.package.StorageRegistry.type" id="80265">registry</a> = <a href="../package.scala.html#10137" title="object edu.berkeley.cs.scads.storage.package.StorageRegistry">StorageRegistry</a>

  <span class="comment">// workload stats code</span>
  <span class="keyword">protected</span> <span class="keyword">var</span> <a title="edu.berkeley.cs.scads.storage.PartitionWorkloadStats" id="80267">currentStats</a> = <a href="#80883" title="(gets: Int, puts: Int)edu.berkeley.cs.scads.storage.PartitionWorkloadStats">PartitionWorkloadStats</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>,<span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
  <span class="keyword">protected</span> <span class="keyword">var</span> <a title="edu.berkeley.cs.scads.storage.PartitionWorkloadStats" id="80270">completedStats</a> = <a href="#80883" title="(gets: Int, puts: Int)edu.berkeley.cs.scads.storage.PartitionWorkloadStats">PartitionWorkloadStats</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>,<span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Long" id="80273">statsClearedTime</a> = <span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span>
  <span class="keyword">protected</span> <span class="keyword">val</span> <a title="Int" id="80275">statWindowTime</a> = <span class="int">20</span><span title="Int(20000)">*</span><span class="int">1000</span> <span class="comment">// ms, how long a window to maintain stats for</span>
  <span class="keyword">protected</span> <span class="keyword">val</span> <a title="Int" id="80277">clearStatWindowsTime</a> = <span class="int">60</span><span title="Int(60000)">*</span><span class="int">1000</span> <span class="comment">// ms, keep long to keep stats around, in all windows</span>
  <span class="keyword">protected</span> <span class="keyword">var</span> <a title="List[(java.util.concurrent.atomic.AtomicInteger, java.util.concurrent.atomic.AtomicInteger)]" id="80280">statWindows</a> = <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(end: Int)scala.collection.immutable.Range">until</span> <a href="#80277" title="=&gt; Int">clearStatWindowsTime</a><span title="(x: Int)Int">/</span><a href="#80275" title="=&gt; Int">statWindowTime</a><span class="delimiter">)</span>
    .<span title="(f: Int =&gt; (java.util.concurrent.atomic.AtomicInteger, java.util.concurrent.atomic.AtomicInteger))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[Int],(java.util.concurrent.atomic.AtomicInteger, java.util.concurrent.atomic.AtomicInteger),scala.collection.immutable.IndexedSeq[(java.util.concurrent.atomic.AtomicInteger, java.util.concurrent.atomic.AtomicInteger)]])scala.collection.immutable.IndexedSeq[(java.util.concurrent.atomic.AtomicInteger, java.util.concurrent.atomic.AtomicInteger)]">map</span> <span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq.Coll,(java.util.concurrent.atomic.AtomicInteger, java.util.concurrent.atomic.AtomicInteger),scala.collection.immutable.IndexedSeq[(java.util.concurrent.atomic.AtomicInteger, java.util.concurrent.atomic.AtomicInteger)]]" class="delimiter">{</span><a title="Int" id="80461">_</a>=&gt;<span title="(_1: java.util.concurrent.atomic.AtomicInteger, _2: java.util.concurrent.atomic.AtomicInteger)(java.util.concurrent.atomic.AtomicInteger, java.util.concurrent.atomic.AtomicInteger)" class="delimiter">(</span><span title="()java.util.concurrent.atomic.AtomicInteger" class="keyword">new</span> <span title="java.util.concurrent.atomic.AtomicInteger">AtomicInteger</span>,<span title="()java.util.concurrent.atomic.AtomicInteger" class="keyword">new</span> <span title="java.util.concurrent.atomic.AtomicInteger">AtomicInteger</span><span class="delimiter">)</span><span class="delimiter">}</span>.<span title="=&gt; List[(java.util.concurrent.atomic.AtomicInteger, java.util.concurrent.atomic.AtomicInteger)]">toList</span> <span class="comment">// (get,put) for each window</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Double" id="80282">getSamplingRate</a> = <span title="Double(1.0)" class="double">1.0</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Double" id="80284">putSamplingRate</a> = <span title="Double(1.0)" class="double">1.0</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.Random" id="80286">samplerRandom</a> = <span title="java.util.Random" class="keyword">new</span> java.util.<span title="java.util.Random">Random</span>

  <span class="keyword">def</span> <a title="()(edu.berkeley.cs.scads.storage.PartitionWorkloadStats, Long)" id="80288">getWorkloadStats</a><span class="delimiter">(</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.storage.PartitionWorkloadStats, Long)" class="delimiter">(</span>PartitionWorkloadStats,Long<span class="delimiter">)</span> = <span title="(_1: edu.berkeley.cs.scads.storage.PartitionWorkloadStats, _2: Long)(edu.berkeley.cs.scads.storage.PartitionWorkloadStats, Long)" class="delimiter">(</span><a href="#80270" title="=&gt; edu.berkeley.cs.scads.storage.PartitionWorkloadStats">completedStats</a>,<a href="#80273" title="=&gt; Long">statsClearedTime</a><span class="delimiter">)</span>
  <span class="comment">/**
  * set the current stats as the last completed interval, used when stats are queried
  * zero out the current stats to start a new interval
  * return the old completed interval for archiving
  */</span>
  <span class="keyword">def</span> <a title="()edu.berkeley.cs.scads.storage.PartitionWorkloadStats" id="80289">resetWorkloadStats</a><span class="delimiter">(</span><span class="delimiter">)</span>:<a href="#80883" title="edu.berkeley.cs.scads.storage.PartitionWorkloadStats">PartitionWorkloadStats</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.PartitionWorkloadStats" id="80530">ret</a> = <a href="#80270" title="=&gt; edu.berkeley.cs.scads.storage.PartitionWorkloadStats">completedStats</a>
    <a href="#80270" title="(x$1: edu.berkeley.cs.scads.storage.PartitionWorkloadStats)Unit">completedStats</a> = <a href="#80267" title="=&gt; edu.berkeley.cs.scads.storage.PartitionWorkloadStats">currentStats</a>
    <a href="#80273" title="(x$1: Long)Unit">statsClearedTime</a> = <span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#80267" title="(x$1: edu.berkeley.cs.scads.storage.PartitionWorkloadStats)Unit">currentStats</a> = <a href="#80883" title="(gets: Int, puts: Int)edu.berkeley.cs.scads.storage.PartitionWorkloadStats">PartitionWorkloadStats</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>,<span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
    <a href="#80530" title="edu.berkeley.cs.scads.storage.PartitionWorkloadStats">ret</a>
  <span class="delimiter">}</span>
  @inline <span class="keyword">private</span> <span class="keyword">def</span> <a title="(num: Int)Unit" id="80290">incrementGetCount</a><span class="delimiter">(</span><a title="Int" id="80531">num</a>:<span title="Int">Int</span><span class="delimiter">)</span> = <a href="#80267" title="=&gt; edu.berkeley.cs.scads.storage.PartitionWorkloadStats">currentStats</a>.<a href="#80306" title="(x$1: Int)Unit">gets</a> <span title="(x: Int)Int">+=</span> <a href="#80531" title="Int">num</a>
  @inline <span class="keyword">private</span> <span class="keyword">def</span> <a title="(num: Int)Unit" id="80291">incrementPutCount</a><span class="delimiter">(</span><a title="Int" id="80539">num</a>:<span title="Int">Int</span><span class="delimiter">)</span> = <a href="#80267" title="=&gt; edu.berkeley.cs.scads.storage.PartitionWorkloadStats">currentStats</a>.<a href="#80307" title="(x$1: Int)Unit">puts</a> <span title="(x: Int)Int">+=</span> <a href="#80539" title="Int">num</a>
  <span class="comment">// end workload stats stuff</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(src: Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]], msg: edu.berkeley.cs.scads.storage.StorageMessage)Unit" id="80292">process</a><span class="delimiter">(</span><a title="Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]]" id="80547">src</a>: <span title="Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]]">Option</span><span class="delimiter">[</span>RemoteServiceProxy<span class="delimiter">[</span>StorageMessage<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="edu.berkeley.cs.scads.storage.StorageMessage" id="80548">msg</a>: <a href="../Messages.scala.html#9553" title="edu.berkeley.cs.scads.storage.StorageMessage">StorageMessage</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(msg: edu.berkeley.cs.scads.storage.StorageMessage)Unit" id="80552">reply</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.StorageMessage" id="80553">msg</a>: <a href="../Messages.scala.html#9553" title="edu.berkeley.cs.scads.storage.StorageMessage">StorageMessage</a><span class="delimiter">)</span> = <a href="#80547" title="Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]]">src</a>.<span title="(f: edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage] =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#80558" title="edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]">_</a> <a href="#80879" title="(msg: edu.berkeley.cs.scads.storage.StorageMessage)(implicit sender: edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage])Unit">!</a> <a href="#80553" title="edu.berkeley.cs.scads.storage.StorageMessage">msg</a><span class="delimiter">)</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#80548" title="edu.berkeley.cs.scads.storage.StorageMessage">msg</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Unit">GetRequest</span><span class="delimiter">(</span><a title="Array[Byte]" id="80563">key</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#80286" title="=&gt; java.util.Random">samplerRandom</a>.<span title="()Double">nextDouble</span> <span title="(x: Double)Boolean">&lt;=</span> <a href="#80282" title="=&gt; Double">getSamplingRate</a><span class="delimiter">)</span> <a href="#80290" title="(num: Int)Unit">incrementGetCount</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
          <a href="#80552" title="(msg: edu.berkeley.cs.scads.storage.StorageMessage)Unit">reply</a><span class="delimiter">(</span><a href="../Messages.scala.html#22648" title="(value: Option[Array[Byte]])edu.berkeley.cs.scads.storage.GetResponse">GetResponse</a><span class="delimiter">(</span><a href="#80876" title="=&gt; edu.berkeley.cs.scads.storage.StorageManager">manager</a>.<a href="#68516" title="(key: Array[Byte])Option[Array[Byte]]">get</a><span class="delimiter">(</span><a href="#80563" title="Array[Byte]">key</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <span title="Unit">PutRequest</span><span class="delimiter">(</span><a title="Array[Byte]" id="80569">key</a>,<a title="Option[Array[Byte]]" id="80570">value</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <a href="#80876" title="=&gt; edu.berkeley.cs.scads.storage.StorageManager">manager</a>.<a href="#68517" title="(key: Array[Byte], value: Option[Array[Byte]])Unit">put</a><span class="delimiter">(</span><a href="#80569" title="Array[Byte]">key</a>,<a href="#80570" title="Option[Array[Byte]]">value</a><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#80286" title="=&gt; java.util.Random">samplerRandom</a>.<span title="()Double">nextDouble</span> <span title="(x: Double)Boolean">&lt;=</span> <a href="#80284" title="=&gt; Double">putSamplingRate</a><span class="delimiter">)</span> <a href="#80291" title="(num: Int)Unit">incrementPutCount</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
          <a href="#80552" title="(msg: edu.berkeley.cs.scads.storage.StorageMessage)Unit">reply</a><span class="delimiter">(</span><a href="../Messages.scala.html#22767" title="()edu.berkeley.cs.scads.storage.PutResponse">PutResponse</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <span title="Unit">BulkUrlPutReqest</span><span class="delimiter">(</span><a title="Array[Byte]" id="80575">parserBytes</a>, <a title="Seq[String]" id="80576">locations</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="java.io.ObjectInputStream" id="80577">ois</a> = <span title="java.io.ObjectInputStream" class="keyword">new</span> <span title="java.io.ObjectInputStream">ObjectInputStream</span><span class="delimiter">(</span><span title="java.io.ByteArrayInputStream" class="keyword">new</span> <span title="java.io.ByteArrayInputStream">ByteArrayInputStream</span><span class="delimiter">(</span><a href="#80575" title="Array[Byte]">parserBytes</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.RecParser" id="80578">parser</a> = <a href="#80577" title="java.io.ObjectInputStream">ois</a>.<span title="()java.lang.Object">readObject</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.storage.RecParser" class="delimiter">[</span><a href="#10056" title="edu.berkeley.cs.scads.storage.RecParser">RecParser</a><span class="delimiter">]</span>
          <a href="#80876" title="=&gt; edu.berkeley.cs.scads.storage.StorageManager">manager</a>.<a href="#68519" title="(parser: edu.berkeley.cs.scads.storage.RecParser, locations: Seq[String])Unit">bulkUrlPut</a><span class="delimiter">(</span><a href="#80578" title="edu.berkeley.cs.scads.storage.RecParser">parser</a>,<a href="#80576" title="Seq[String]">locations</a><span class="delimiter">)</span>
          <a href="#80552" title="(msg: edu.berkeley.cs.scads.storage.StorageMessage)Unit">reply</a><span class="delimiter">(</span><a href="../Messages.scala.html#22950" title="()edu.berkeley.cs.scads.storage.BulkPutResponse">BulkPutResponse</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <span title="Unit">BulkPutRequest</span><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.storage.PutRequest]" id="80582">records</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <a href="#80876" title="=&gt; edu.berkeley.cs.scads.storage.StorageManager">manager</a>.<a href="#68520" title="(records: Seq[edu.berkeley.cs.scads.storage.PutRequest])Unit">bulkPut</a><span class="delimiter">(</span><a href="#80582" title="Seq[edu.berkeley.cs.scads.storage.PutRequest]">records</a><span class="delimiter">)</span>
          <span class="comment">/*if (samplerRandom.nextDouble &lt;= putSamplingRate) incrementPutCount(reccount)*/</span>
          <a href="#80552" title="(msg: edu.berkeley.cs.scads.storage.StorageMessage)Unit">reply</a><span class="delimiter">(</span><a href="../Messages.scala.html#22950" title="()edu.berkeley.cs.scads.storage.BulkPutResponse">BulkPutResponse</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <span title="Unit">GetRangeRequest</span><span class="delimiter">(</span><a title="Option[Array[Byte]]" id="80583">minKey</a>, <a title="Option[Array[Byte]]" id="80584">maxKey</a>, <a title="Option[Int]" id="80585">limit</a>, <a title="Option[Int]" id="80586">offset</a>, <a title="Boolean" id="80587">ascending</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#80286" title="=&gt; java.util.Random">samplerRandom</a>.<span title="()Double">nextDouble</span> <span title="(x: Double)Boolean">&lt;=</span> <a href="#80282" title="=&gt; Double">getSamplingRate</a><span class="delimiter">)</span> <a href="#80290" title="(num: Int)Unit">incrementGetCount</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="comment">/*reccount*/</span><span class="delimiter">)</span>
          <a href="#80552" title="(msg: edu.berkeley.cs.scads.storage.StorageMessage)Unit">reply</a><span class="delimiter">(</span><a href="../Messages.scala.html#23149" title="(records: Seq[edu.berkeley.cs.scads.storage.Record])edu.berkeley.cs.scads.storage.GetRangeResponse">GetRangeResponse</a><span class="delimiter">(</span><a href="#80876" title="=&gt; edu.berkeley.cs.scads.storage.StorageManager">manager</a>.<a href="#68521" title="(minKey: Option[Array[Byte]], maxKey: Option[Array[Byte]], limit: Option[Int], offset: Option[Int], ascending: Boolean)Seq[edu.berkeley.cs.scads.storage.Record]">getRange</a><span class="delimiter">(</span><a href="#80583" title="Option[Array[Byte]]">minKey</a>,<a href="#80584" title="Option[Array[Byte]]">maxKey</a>,<a href="#80585" title="Option[Int]">limit</a>,<a href="#80586" title="Option[Int]">offset</a>,<a href="#80587" title="Boolean">ascending</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <span title="Unit">BatchRequest</span><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.storage.StorageMessage]" id="80593">ranges</a><span class="delimiter">)</span> =&gt;
          <a href="#80552" title="(msg: edu.berkeley.cs.scads.storage.StorageMessage)Unit">reply</a><span class="delimiter">(</span><a href="../Messages.scala.html#23449" title="(ranges: Seq[edu.berkeley.cs.scads.storage.StorageMessage])edu.berkeley.cs.scads.storage.BatchResponse">BatchResponse</a><span class="delimiter">(</span><a href="#80876" title="=&gt; edu.berkeley.cs.scads.storage.StorageManager">manager</a>.<a href="#68522" title="(ranges: Seq[edu.berkeley.cs.scads.storage.StorageMessage])scala.collection.mutable.ArrayBuffer[edu.berkeley.cs.scads.storage.GetRangeResponse]">getBatch</a><span class="delimiter">(</span><a href="#80593" title="Seq[edu.berkeley.cs.scads.storage.StorageMessage]">ranges</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit">CountRangeRequest</span><span class="delimiter">(</span><a title="Option[Array[Byte]]" id="80595">minKey</a>,<a title="Option[Array[Byte]]" id="80596">maxKey</a><span class="delimiter">)</span> =&gt; <a href="#80552" title="(msg: edu.berkeley.cs.scads.storage.StorageMessage)Unit">reply</a><span class="delimiter">(</span><a href="../Messages.scala.html#23580" title="(count: Int)edu.berkeley.cs.scads.storage.CountRangeResponse">CountRangeResponse</a><span class="delimiter">(</span><a href="#80876" title="=&gt; edu.berkeley.cs.scads.storage.StorageManager">manager</a>.<a href="#68523" title="(minKey: Option[Array[Byte]], maxKey: Option[Array[Byte]])Int">countRange</a><span class="delimiter">(</span><a href="#80595" title="Option[Array[Byte]]">minKey</a>,<a href="#80596" title="Option[Array[Byte]]">maxKey</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit">TestSetRequest</span><span class="delimiter">(</span><a title="Array[Byte]" id="80598">key</a>, <a title="Option[Array[Byte]]" id="80599">value</a>, <a title="Option[Array[Byte]]" id="80600">expectedValue</a><span class="delimiter">)</span> =&gt; <a href="#80552" title="(msg: edu.berkeley.cs.scads.storage.StorageMessage)Unit">reply</a><span class="delimiter">(</span><a href="../Messages.scala.html#23749" title="(success: Boolean)edu.berkeley.cs.scads.storage.TestSetResponse">TestSetResponse</a><span class="delimiter">(</span><a href="#80876" title="=&gt; edu.berkeley.cs.scads.storage.StorageManager">manager</a>.<a href="#68518" title="(key: Array[Byte], value: Option[Array[Byte]], expectedValue: Option[Array[Byte]])Boolean">testAndSet</a><span class="delimiter">(</span><a href="#80598" title="Array[Byte]">key</a>,<a href="#80599" title="Option[Array[Byte]]">value</a>,<a href="#80600" title="Option[Array[Byte]]">expectedValue</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit">CursorScanRequest</span><span class="delimiter">(</span><a title="Option[Int]" id="80602">optCursorId</a>, <a title="Int" id="80603">recsPerMessage</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <a href="#80876" title="=&gt; edu.berkeley.cs.scads.storage.StorageManager">manager</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a title="Unit" id="80604">bsm</a>:<a href="BdbParitionHandler.scala.html#10007" title="edu.berkeley.cs.scads.storage.BdbStorageManager">BdbStorageManager</a> =&gt; <span class="delimiter">{</span>
              <span class="keyword">val</span> <a href="#80606" title="(Option[Int], IndexedSeq[edu.berkeley.cs.scads.storage.Record])" class="delimiter">(</a><a href="#80605" title="Option[Int]" id="80606">cid</a>,<a href="#80605" title="IndexedSeq[edu.berkeley.cs.scads.storage.Record]" id="80607">recs</a><span class="delimiter">)</span> = <a href="#80604" title="edu.berkeley.cs.scads.storage.BdbStorageManager">bsm</a>.<a href="BdbParitionHandler.scala.html#68593" title="(optCursorId: Option[Int], recsPerMessage: Int)(Option[Int], IndexedSeq[edu.berkeley.cs.scads.storage.Record])">cursorScan</a><span title="(Option[Int], IndexedSeq[edu.berkeley.cs.scads.storage.Record]) @unchecked" class="delimiter">(</span><a href="#80602" title="Option[Int]">optCursorId</a>, <a href="#80603" title="Int">recsPerMessage</a><span class="delimiter">)</span>
              <a href="#80552" title="(msg: edu.berkeley.cs.scads.storage.StorageMessage)Unit">reply</a><span class="delimiter">(</span><a href="../Messages.scala.html#23301" title="(cursorId: Option[Int], records: IndexedSeq[edu.berkeley.cs.scads.storage.Record])edu.berkeley.cs.scads.storage.CursorScanResponse">CursorScanResponse</a><span class="delimiter">(</span><a href="#80606" title="Option[Int]">cid</a>,<a href="#80607" title="IndexedSeq[edu.berkeley.cs.scads.storage.Record]">recs</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <a href="#80547" title="Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]]">src</a>.<span title="(f: edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage] =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#80623" title="edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]">_</a> <a href="#80879" title="(msg: edu.berkeley.cs.scads.storage.StorageMessage)(implicit sender: edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage])Unit">!</a> <a href="../Messages.scala.html#22340" title="(cause: String, stacktrace: String)edu.berkeley.cs.scads.storage.ProcessingException">ProcessingException</a><span class="delimiter">(</span><span title="java.lang.String(&quot;CursorScan only available for BdbStorageManagers&quot;)" class="string">&quot;CursorScan only available for BdbStorageManagers&quot;</span>,<span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> 
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <span title="Unit">CopyDataRequest</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.PartitionService" id="80629">src</a>, <a title="Boolean" id="80630">overwrite</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <a href="#80876" title="=&gt; edu.berkeley.cs.scads.storage.StorageManager">manager</a>.<a href="#68524" title="(src: edu.berkeley.cs.scads.storage.PartitionService, overwrite: Boolean)Unit">copyData</a><span class="delimiter">(</span><a href="#80629" title="edu.berkeley.cs.scads.storage.PartitionService">src</a>,<a href="#80630" title="Boolean">overwrite</a><span class="delimiter">)</span>
          <a href="#80552" title="(msg: edu.berkeley.cs.scads.storage.StorageMessage)Unit">reply</a><span class="delimiter">(</span><a href="../Messages.scala.html#25184" title="()edu.berkeley.cs.scads.storage.CopyDataResponse">CopyDataResponse</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <span title="Unit">GetResponsibilityRequest</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="(Option[Array[Byte]], Option[Array[Byte]])" id="80631">resp</a> = <a href="#80876" title="=&gt; edu.berkeley.cs.scads.storage.StorageManager">manager</a>.<a href="#68525" title="()(Option[Array[Byte]], Option[Array[Byte]])">getResponsibility</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#80552" title="(msg: edu.berkeley.cs.scads.storage.StorageMessage)Unit">reply</a><span class="delimiter">(</span><a href="../Messages.scala.html#25252" title="(startKey: Option[Array[Byte]], endKey: Option[Array[Byte]])edu.berkeley.cs.scads.storage.GetResponsibilityResponse">GetResponsibilityResponse</a><span class="delimiter">(</span><a href="#80631" title="(Option[Array[Byte]], Option[Array[Byte]])">resp</a>.<span title="=&gt; Option[Array[Byte]]">_1</span>,<a href="#80631" title="(Option[Array[Byte]], Option[Array[Byte]])">resp</a>.<span title="=&gt; Option[Array[Byte]]">_2</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
	<span class="keyword">case</span> <span title="Unit">GetWorkloadStats</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <span class="keyword">val</span> <a href="#80635" title="(edu.berkeley.cs.scads.storage.PartitionWorkloadStats, Long)" class="delimiter">(</a><a href="#80634" title="edu.berkeley.cs.scads.storage.PartitionWorkloadStats" id="80635">stats</a>,<a href="#80634" title="Long" id="80636">clearedTime</a><span class="delimiter">)</span> = <a href="#80288" title="()(edu.berkeley.cs.scads.storage.PartitionWorkloadStats, Long)">getWorkloadStats</a><span title="(edu.berkeley.cs.scads.storage.PartitionWorkloadStats, Long) @unchecked" class="delimiter">(</span><span class="delimiter">)</span>
	  <a href="#80552" title="(msg: edu.berkeley.cs.scads.storage.StorageMessage)Unit">reply</a><span class="delimiter">(</span><a href="../Messages.scala.html#23848" title="(getCount: Int, putCount: Int, statsSince: Long)edu.berkeley.cs.scads.storage.GetWorkloadStatsResponse">GetWorkloadStatsResponse</a><span class="delimiter">(</span><a href="#80635" title="edu.berkeley.cs.scads.storage.PartitionWorkloadStats">stats</a>.<a href="#80306" title="=&gt; Int">gets</a>, <a href="#80635" title="edu.berkeley.cs.scads.storage.PartitionWorkloadStats">stats</a>.<a href="#80307" title="=&gt; Int">puts</a>, <a href="#80636" title="Long">clearedTime</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <span title="Unit">AggRequest</span><span class="delimiter">(</span><a title="Seq[String]" id="80650">groups</a>,<a title="String" id="80651">keyType</a>,<a title="String" id="80652">valType</a>,<a title="Seq[edu.berkeley.cs.scads.storage.AggFilter]" id="80653">filters</a>,<a title="Seq[edu.berkeley.cs.scads.storage.AggOp]" id="80654">aggs</a><span class="delimiter">)</span> =&gt; 
          <a href="#80552" title="(msg: edu.berkeley.cs.scads.storage.StorageMessage)Unit">reply</a><span class="delimiter">(</span><a href="../Messages.scala.html#24444" title="(results: Seq[edu.berkeley.cs.scads.storage.GroupedAgg])edu.berkeley.cs.scads.storage.AggReply">AggReply</a><span class="delimiter">(</span><a href="#80876" title="=&gt; edu.berkeley.cs.scads.storage.StorageManager">manager</a>.<a href="#68526" title="(groups: Seq[String], keyType: String, valType: String, filters: Seq[edu.berkeley.cs.scads.storage.AggFilter], aggregates: Seq[edu.berkeley.cs.scads.storage.AggOp])Seq[edu.berkeley.cs.scads.storage.GroupedAgg]">applyAggregate</a><span class="delimiter">(</span><a href="#80650" title="Seq[String]">groups</a>,<a href="#80651" title="String">keyType</a>,<a href="#80652" title="String">valType</a>,<a href="#80653" title="Seq[edu.berkeley.cs.scads.storage.AggFilter]">filters</a>,<a href="#80654" title="Seq[edu.berkeley.cs.scads.storage.AggOp]">aggs</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <a href="#80547" title="Option[edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]]">src</a>.<span title="(f: edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage] =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#80659" title="edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage]">_</a> <a href="#80879" title="(msg: edu.berkeley.cs.scads.storage.StorageMessage)(implicit sender: edu.berkeley.cs.scads.comm.RemoteServiceProxy[edu.berkeley.cs.scads.storage.StorageMessage])Unit">!</a> <a href="../Messages.scala.html#22340" title="(cause: String, stacktrace: String)edu.berkeley.cs.scads.storage.ProcessingException">ProcessingException</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Not Implemented&quot;)" class="string">&quot;Not Implemented&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Unit" id="80665">r</a>:<a href="#10057" title="edu.berkeley.cs.scads.storage.RequestRejectedException">RequestRejectedException</a> =&gt; <a href="#80552" title="(msg: edu.berkeley.cs.scads.storage.StorageMessage)Unit">reply</a><span class="delimiter">(</span><a href="../Messages.scala.html#22417" title="(reason: String, req: edu.berkeley.cs.scads.storage.StorageMessage)edu.berkeley.cs.scads.storage.RequestRejected">RequestRejected</a><span class="delimiter">(</span><a href="#80665" title="edu.berkeley.cs.scads.storage.RequestRejectedException">r</a>.<span title="()java.lang.String">getMessage</span><span class="delimiter">(</span><span class="delimiter">)</span>,<a href="#80548" title="edu.berkeley.cs.scads.storage.StorageMessage">msg</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="Unit" id="80668">e</a>:<span title="Exception">Exception</span> =&gt; <span class="delimiter">{</span>
        <a href="#80261" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Exception processing request&quot;)" class="string">&quot;Exception processing request&quot;</span><span class="delimiter">)</span>
        <a href="#80668" title="Exception">e</a>.<span title="()Unit">printStackTrace</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#80552" title="(msg: edu.berkeley.cs.scads.storage.StorageMessage)Unit">reply</a><span class="delimiter">(</span><a href="../Messages.scala.html#22340" title="(cause: String, stacktrace: String)edu.berkeley.cs.scads.storage.ProcessingException">ProcessingException</a><span class="delimiter">(</span><a href="#80668" title="Exception">e</a>.<span title="()java.lang.String">getMessage</span>, <a href="#80668" title="Exception">e</a>.<span title="(xs: Array[java.lang.StackTraceElement])scala.collection.mutable.ArrayOps[java.lang.StackTraceElement]">getStackTrace</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  

<span class="delimiter">}</span>


        </pre>
    </body>
</html>