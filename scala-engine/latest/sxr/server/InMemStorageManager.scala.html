<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>server/InMemStorageManager.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs.scads.storage

<span class="keyword">import</span> edu.berkeley.cs.avro.runtime.ScalaSpecificRecord
<span class="keyword">import</span> java.nio.ByteBuffer
<span class="keyword">import</span> java.io.<span class="delimiter">{</span>ObjectOutputStream,ObjectInputStream,Serializable,ByteArrayOutputStream,ByteArrayInputStream<span class="delimiter">}</span>
<span class="keyword">import</span> java.util.<span class="delimiter">{</span>Comparator, TreeMap, Arrays =&gt; JArrays<span class="delimiter">}</span>
<span class="keyword">import</span> scala.collection.mutable.ArrayBuffer
<span class="keyword">import</span> scala.util.control.Breaks
<span class="keyword">import</span> edu.berkeley.cs.scads.comm._
<span class="keyword">import</span> edu.berkeley.cs.scads.util._
<span class="keyword">import</span> org.apache.avro.Schema
<span class="keyword">import</span> net.lag.logging.Logger

<span class="keyword">private</span> case <span class="keyword">class</span> <a title="class EQArray extends java.lang.Object with java.io.Serializable with ScalaObject with Product with Serializable" id="76916">EQArray</a><a href="#76916" title="ScalaObject" class="delimiter">(</a><a title="Array[Byte]" id="76859">bytes</a>:<span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="java.io.Serializable">Serializable</span> <span class="delimiter">{</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(other: Any)Boolean" id="74621">equals</a><span class="delimiter">(</span><a title="Any" id="74630">other</a>:<span title="Any">Any</span><span class="delimiter">)</span>:<span title="Boolean">Boolean</span> = <span title="object java.util.Arrays">JArrays</span>.<span title="(x$1: Array[Byte], x$2: Array[Byte])Boolean">equals</span><span class="delimiter">(</span><a href="#76859" title="=&gt; Array[Byte]">bytes</a>,<a href="#74630" title="Any">other</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.storage.EQArray" class="delimiter">[</span><a href="#76916" title="edu.berkeley.cs.scads.storage.EQArray">EQArray</a><span class="delimiter">]</span>.<a href="#76859" title="=&gt; Array[Byte]">bytes</a><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Int" id="74622">hashCode</a><span class="delimiter">(</span><span class="delimiter">)</span>:<span title="Int">Int</span> = <span title="object java.util.Arrays">JArrays</span>.<span title="(x$1: Array[Byte])Int">hashCode</span><span class="delimiter">(</span><a href="#76859" title="=&gt; Array[Byte]">bytes</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">private</span> case <span class="keyword">class</span> <a title="class EQCmp extends java.lang.Object with java.util.Comparator[edu.berkeley.cs.scads.storage.EQArray] with java.io.Serializable with ScalaObject with Product with Serializable" id="76852">EQCmp</a><a href="#76852" title="ScalaObject" class="delimiter">(</a><a title="org.apache.avro.Schema" id="76785">keySchema</a>:<span title="org.apache.avro.Schema">Schema</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="java.util.Comparator[edu.berkeley.cs.scads.storage.EQArray]">Comparator</span><span class="delimiter">[</span>EQArray<span class="delimiter">]</span> <span class="keyword">with</span> <span title="java.io.Serializable">Serializable</span> <span class="delimiter">{</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(o1: edu.berkeley.cs.scads.storage.EQArray, o2: edu.berkeley.cs.scads.storage.EQArray)Int" id="74674">compare</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.EQArray" id="74686">o1</a>:<a href="#76916" title="edu.berkeley.cs.scads.storage.EQArray">EQArray</a>, <a title="edu.berkeley.cs.scads.storage.EQArray" id="74687">o2</a>:<a href="#76916" title="edu.berkeley.cs.scads.storage.EQArray">EQArray</a><span class="delimiter">)</span>:<span title="Int">Int</span> = <span class="delimiter">{</span>
    org.apache.avro.io.<span title="object org.apache.avro.io.BinaryData">BinaryData</span>.<span title="(x$1: Array[Byte], x$2: Int, x$3: Array[Byte], x$4: Int, x$5: org.apache.avro.Schema)Int">compare</span><span class="delimiter">(</span><a href="#74686" title="edu.berkeley.cs.scads.storage.EQArray">o1</a>.<a href="#76859" title="=&gt; Array[Byte]">bytes</a>, <span title="Int(0)" class="int">0</span>, <a href="#74687" title="edu.berkeley.cs.scads.storage.EQArray">o2</a>.<a href="#76859" title="=&gt; Array[Byte]">bytes</a>, <span title="Int(0)" class="int">0</span>, <a href="#76785" title="=&gt; org.apache.avro.Schema">keySchema</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(other: Any)Boolean" id="74675">equals</a><span class="delimiter">(</span><a title="Any" id="74694">other</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#74694" title="Any">other</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a title="Boolean" id="74739">ac</a>:<a href="#76852" title="edu.berkeley.cs.scads.storage.EQCmp">EQCmp</a> =&gt; <a href="#76785" title="=&gt; org.apache.avro.Schema">keySchema</a> <span title="(x$1: Any)Boolean">equals</span> <a href="#74739" title="edu.berkeley.cs.scads.storage.EQCmp">ac</a>.<a href="#76785" title="=&gt; org.apache.avro.Schema">keySchema</a>
    <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
  <span class="delimiter">}</span>

  <span class="comment">/* TODO: In case we ever want to serialize the treemap, the comparator
   * needs to be serializable.  Schema is not.  So we should write it out
   * as a string.  For now, we do nothing. */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(out: java.io.ObjectOutputStream)Unit" id="74676">writeObject</a><span class="delimiter">(</span><a title="java.io.ObjectOutputStream" id="74740">out</a>:<span title="java.io.ObjectOutputStream">ObjectOutputStream</span><span class="delimiter">)</span> = <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(in: java.io.ObjectInputStream)Unit" id="74677">readObject</a><span class="delimiter">(</span><a title="java.io.ObjectInputStream" id="74743">in</a>:<span title="java.io.ObjectInputStream">ObjectInputStream</span><span class="delimiter">)</span> = <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="74678">readObjectNoData</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
<span class="delimiter">}</span>



<span class="keyword">class</span> <a title="class InMemStorageManager extends java.lang.Object with edu.berkeley.cs.scads.storage.StorageManager with edu.berkeley.cs.scads.storage.AvroComparator with edu.berkeley.cs.scads.storage.SimpleRecordMetadataExtractor with ScalaObject" id="9770">InMemStorageManager</a>
  <span class="delimiter">(</span><span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode" id="75224">partitionIdLock</a>: ZooKeeperProxy#<span title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">ZooKeeperNode</span>, 
   <span class="keyword">val</span> <a title="Option[Array[Byte]]" id="75225">startKey</a>:<span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>,
   <span class="keyword">val</span> <a title="Option[Array[Byte]]" id="75226">endKey</a>:<span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>,
   <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode" id="75227">root</a>: ZooKeeperProxy#<span title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">ZooKeeperNode</span>, 
   <span class="keyword">val</span> <a title="org.apache.avro.Schema" id="75228">keySchema</a>: <span title="org.apache.avro.Schema">Schema</span>, 
   <a title="org.apache.avro.Schema" id="75229">valueSchema</a>: <span title="org.apache.avro.Schema">Schema</span>,
   <a title="String" id="75230">valueType</a>:<span title="String">String</span><span class="delimiter">)</span>
  <span class="keyword">extends</span> <a href="PartitionHandler.scala.html#9812" title="edu.berkeley.cs.scads.storage.StorageManager">StorageManager</a> <span class="keyword">with</span> <a href="KeyComparison.scala.html#9797" title="edu.berkeley.cs.scads.storage.AvroComparator">AvroComparator</a> <span class="keyword">with</span> <a href="../client/SimpleRecordMetadata.scala.html#9690" title="edu.berkeley.cs.scads.storage.SimpleRecordMetadataExtractor">SimpleRecordMetadataExtractor</a>
<span class="delimiter">{</span>
  <span class="keyword">private</span> <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit edu.berkeley.cs.scads.storage.InMemStorageManager.bytes2eqarray : (bytes: Array[Byte])edu.berkeley.cs.scads.storage.EQArray" id="74794">bytes2eqarray</a><span class="delimiter">(</span><a title="Array[Byte]" id="75239">bytes</a>:<span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>:<a href="#76916" title="edu.berkeley.cs.scads.storage.EQArray">EQArray</a> = <span title="edu.berkeley.cs.scads.storage.EQArray" class="keyword">new</span> <a href="#76916" title="edu.berkeley.cs.scads.storage.EQArray">EQArray</a><span class="delimiter">(</span><a href="#75239" title="Array[Byte]">bytes</a><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.util.control.Breaks" id="74795">iterateValsBreakable</a> = <span title="scala.util.control.Breaks" class="keyword">new</span> <span title="scala.util.control.Breaks">Breaks</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.Class[_]" id="74797">valueClass</a> = <span title="object java.lang.Class">Class</span>.<span title="(x$1: java.lang.String)java.lang.Class[_]">forName</span><span class="delimiter">(</span><a href="#75230" title="String">valueType</a><span class="delimiter">)</span>
  
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.TreeMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]" id="74799">map</a> = <span title="(x$1: java.util.Comparator[_ &gt;: edu.berkeley.cs.scads.storage.EQArray])java.util.TreeMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]" class="keyword">new</span> <span title="java.util.TreeMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">TreeMap</span><span class="delimiter">[</span>EQArray,<span class="delimiter">(</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>,ScalaSpecificRecord<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="edu.berkeley.cs.scads.storage.EQCmp" class="keyword">new</span> <a href="#76852" title="edu.berkeley.cs.scads.storage.EQCmp">EQCmp</a><span class="delimiter">(</span><a href="#75228" title="=&gt; org.apache.avro.Schema">keySchema</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="java.util.Comparator[edu.berkeley.cs.scads.storage.EQArray]" class="delimiter">[</span><span title="java.util.Comparator[edu.berkeley.cs.scads.storage.EQArray]">Comparator</span><span class="delimiter">[</span>EQArray<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>

  <span class="comment">// this method puts a scala record and some metadata together into a byte array</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(vals: (Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord))Array[Byte]" id="74801">toBytes</a><span class="delimiter">(</span><a title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)" id="75257">vals</a>:<span title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)" class="delimiter">(</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>, ScalaSpecificRecord<span class="delimiter">)</span><span class="delimiter">)</span>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Array[Byte]" id="75259">bytes</a> = <a href="#75257" title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">vals</a>.<span title="=&gt; edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">_2</span>.<span title="=&gt; Array[Byte]">toBytes</span>
    <span class="keyword">val</span> <a title="Array[Byte]" id="75260">result</a> = java.util.<span title="object java.util.Arrays">Arrays</span>.<span title="(x$1: Array[Byte], x$2: Int)Array[Byte]">copyOf</span><span class="delimiter">(</span><a href="#75257" title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">vals</a>.<span title="=&gt; Array[Byte]">_1</span>, <a href="#75257" title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">vals</a>.<span title="=&gt; Array[Byte]">_1</span>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">+</span> <a href="#75259" title="Array[Byte]">bytes</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>;
    <span title="object java.lang.System">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#75259" title="Array[Byte]">bytes</a>, <span title="Int(0)" class="int">0</span>, <a href="#75260" title="Array[Byte]">result</a>, <a href="#75257" title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">vals</a>.<span title="=&gt; Array[Byte]">_1</span>.<span title="=&gt; Int">length</span>, <a href="#75259" title="Array[Byte]">bytes</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>;
    <a href="#75260" title="Array[Byte]">result</a>
  <span class="delimiter">}</span>
  

  <span class="keyword">def</span> <a title="(key: Array[Byte])Option[Array[Byte]]" id="74802">get</a><span class="delimiter">(</span><a title="Array[Byte]" id="75300">key</a>:<span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>:<span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="comment">// can't rely on implicit here because .get just takes an Object</span>
    <span class="keyword">val</span> <a title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)" id="75302">v</a> = <a href="#74799" title="=&gt; java.util.TreeMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">map</a>.<span title="(x$1: Any)(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">get</span><span class="delimiter">(</span><a href="#74794" title="implicit edu.berkeley.cs.scads.storage.InMemStorageManager.bytes2eqarray : (bytes: Array[Byte])edu.berkeley.cs.scads.storage.EQArray">bytes2eqarray</a><span class="delimiter">(</span><a href="#75300" title="Array[Byte]">key</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="Option[Array[Byte]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#75302" title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">v</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Nothing" class="keyword">return</span> <span title="(x: Array[Byte])Option[Array[Byte]]">Option</span><span class="delimiter">(</span><a href="#74801" title="(vals: (Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord))Array[Byte]">toBytes</a><span class="delimiter">(</span><a href="#75302" title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">v</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">else</span>
      <span title="Nothing" class="keyword">return</span> <span title="(x: Null)Option[Null]">Option</span><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(key: Array[Byte], value: Option[Array[Byte]])Unit" id="74803">put</a><span class="delimiter">(</span><a title="Array[Byte]" id="75313">key</a>:<span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span>,<a title="Option[Array[Byte]]" id="75314">value</a>:<span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#75314" title="Option[Array[Byte]]">value</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="Array[Byte]" id="75317">v</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord" id="75318">rec</a> = <a href="#74797" title="=&gt; java.lang.Class[_]">valueClass</a>.<span title="()Any">newInstance</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord" class="delimiter">[</span><span title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">ScalaSpecificRecord</span><span class="delimiter">]</span>
        <a href="#75318" title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">rec</a>.<span title="(inputStream: java.io.InputStream)rec.type">parse</span><span class="delimiter">(</span><a href="../client/SimpleRecordMetadata.scala.html#37952" title="(value: Array[Byte])java.io.ByteArrayInputStream">getRecordInputStreamFromValue</a><span class="delimiter">(</span><a href="#75317" title="Array[Byte]">v</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#74799" title="=&gt; java.util.TreeMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">map</a>.<span title="(x$1: edu.berkeley.cs.scads.storage.EQArray, x$2: (Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord))(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">put</span><span title="Unit" class="delimiter">(</span><a href="#74794" title="implicit edu.berkeley.cs.scads.storage.InMemStorageManager.bytes2eqarray : (bytes: Array[Byte])edu.berkeley.cs.scads.storage.EQArray">key</a>,<span title="(_1: Array[Byte], _2: edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)" class="delimiter">(</span><a href="../client/SimpleRecordMetadata.scala.html#37951" title="(value: Array[Byte])Array[Byte]">extractMetadataFromValue</a><span class="delimiter">(</span><a href="#75317" title="Array[Byte]">v</a><span class="delimiter">)</span>,<a href="#75318" title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">rec</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="Unit">None</span> =&gt; <a href="#74799" title="=&gt; java.util.TreeMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">map</a>.<span title="(x$1: Any)(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">remove</span><span title="Unit" class="delimiter">(</span><a href="#74794" title="implicit edu.berkeley.cs.scads.storage.InMemStorageManager.bytes2eqarray : (bytes: Array[Byte])edu.berkeley.cs.scads.storage.EQArray">bytes2eqarray</a><span class="delimiter">(</span><a href="#75313" title="Array[Byte]">key</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(key: Array[Byte], value: Option[Array[Byte]], expectedValue: Option[Array[Byte]])Boolean" id="74804">testAndSet</a><span class="delimiter">(</span><a title="Array[Byte]" id="75336">key</a>:<span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span>, <a title="Option[Array[Byte]]" id="75337">value</a>:<span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Option[Array[Byte]]" id="75338">expectedValue</a>:<span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>:<span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <a href="#9770" title="(x$1: Boolean)Boolean">synchronized</a> <span class="delimiter">{</span> 
      <span class="keyword">val</span> <a title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)" id="75342">existing</a> = <a href="#74799" title="=&gt; java.util.TreeMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">map</a>.<span title="(x$1: Any)(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">get</span><span class="delimiter">(</span><a href="#74794" title="implicit edu.berkeley.cs.scads.storage.InMemStorageManager.bytes2eqarray : (bytes: Array[Byte])edu.berkeley.cs.scads.storage.EQArray">bytes2eqarray</a><span class="delimiter">(</span><a href="#75336" title="Array[Byte]">key</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Array[Byte]" id="75343">exbytes</a> = 
        <span title="Array[Byte]" class="keyword">if</span> <span class="delimiter">(</span><a href="#75342" title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">existing</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
          <a href="#74801" title="(vals: (Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord))Array[Byte]">toBytes</a><span class="delimiter">(</span><a href="#75342" title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">existing</a><span class="delimiter">)</span>
        <span class="keyword">else</span>
          <span title="Null(null)" class="keyword">null</span>
      <span title="Boolean" class="keyword">if</span><span class="delimiter">(</span><span title="object java.util.Arrays">JArrays</span>.<span title="(x$1: Array[Byte], x$2: Array[Byte])Boolean">equals</span><span class="delimiter">(</span><a href="#75338" title="Option[Array[Byte]]">expectedValue</a>.<span title="(implicit ev: &lt;:&lt;[Null,Array[Byte]])Array[Byte]">orNull</span>, <a href="#75343" title="Array[Byte]">exbytes</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#75337" title="Option[Array[Byte]]">value</a> <span title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">Some</span><span class="delimiter">(</span><a title="Array[Byte]" id="75360">v</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord" id="75361">rec</a> = <a href="#74797" title="=&gt; java.lang.Class[_]">valueClass</a>.<span title="()Any">newInstance</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord" class="delimiter">[</span><span title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">ScalaSpecificRecord</span><span class="delimiter">]</span>
            <a href="#75361" title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">rec</a>.<span title="(inputStream: java.io.InputStream)rec.type">parse</span><span class="delimiter">(</span><a href="../client/SimpleRecordMetadata.scala.html#37952" title="(value: Array[Byte])java.io.ByteArrayInputStream">getRecordInputStreamFromValue</a><span class="delimiter">(</span><a href="#75360" title="Array[Byte]">v</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#74799" title="=&gt; java.util.TreeMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">map</a>.<span title="(x$1: edu.berkeley.cs.scads.storage.EQArray, x$2: (Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord))(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">put</span><span class="delimiter">(</span><a href="#74794" title="implicit edu.berkeley.cs.scads.storage.InMemStorageManager.bytes2eqarray : (bytes: Array[Byte])edu.berkeley.cs.scads.storage.EQArray">key</a>,<span title="(_1: Array[Byte], _2: edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)" class="delimiter">(</span><a href="../client/SimpleRecordMetadata.scala.html#37951" title="(value: Array[Byte])Array[Byte]">extractMetadataFromValue</a><span class="delimiter">(</span><a href="#75360" title="Array[Byte]">v</a><span class="delimiter">)</span>,<a href="#75361" title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">rec</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <span class="keyword">case</span> <span title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">None</span> =&gt; <a href="#74799" title="=&gt; java.util.TreeMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">map</a>.<span title="(x$1: Any)(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">remove</span><span class="delimiter">(</span><a href="#75336" title="Array[Byte]">key</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span title="Boolean(true)" class="keyword">true</span>
      <span class="delimiter">}</span> 
      <span class="keyword">else</span>
        <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(parser: edu.berkeley.cs.scads.storage.RecParser, locations: Seq[String])Unit" id="74805">bulkUrlPut</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.RecParser" id="75373">parser</a>:<a href="PartitionHandler.scala.html#9810" title="edu.berkeley.cs.scads.storage.RecParser">RecParser</a>, <a title="Seq[String]" id="75374">locations</a>:<span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#75374" title="Seq[String]">locations</a> <span title="(f: String =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="String" id="75393">location</a> =&gt; <span class="delimiter">{</span>
      <a href="#75373" title="edu.berkeley.cs.scads.storage.RecParser">parser</a>.<a href="PartitionHandler.scala.html#49884" title="(location: String)Unit">setLocation</a><span class="delimiter">(</span><a href="#75393" title="String">location</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.net.URL" id="75394">url</a> = <span title="(x$1: java.lang.String)java.net.URL" class="keyword">new</span> java.net.<span title="java.net.URL">URL</span><span class="delimiter">(</span><a href="#75393" title="String">location</a><span class="delimiter">)</span>
      <a href="#75373" title="edu.berkeley.cs.scads.storage.RecParser">parser</a>.<a href="PartitionHandler.scala.html#49885" title="(in: java.io.InputStream)Unit">setInput</a><span class="delimiter">(</span><a href="#75394" title="java.net.URL">url</a>.<span title="()java.io.InputStream">openStream</span><span class="delimiter">)</span>
      <span class="keyword">var</span> <a title="(AnyRef, AnyRef)" id="75395">kv</a> = <a href="#75373" title="edu.berkeley.cs.scads.storage.RecParser">parser</a>.<a href="PartitionHandler.scala.html#49886" title="()(AnyRef, AnyRef)">getNext</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#75395" title="(AnyRef, AnyRef)">kv</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#75398" title="()Unit" class="delimiter">{</a>
        <span class="keyword">val</span> <a title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)" id="75404">mv</a> = <a href="#75395" title="(AnyRef, AnyRef)">kv</a>.<span title="=&gt; AnyRef">_2</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)" class="delimiter">[</span><span title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)" class="delimiter">(</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>,ScalaSpecificRecord<span class="delimiter">)</span><span class="delimiter">]</span>
        <a href="#74799" title="=&gt; java.util.TreeMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">map</a>.<span title="(x$1: edu.berkeley.cs.scads.storage.EQArray, x$2: (Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord))(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">put</span><span class="delimiter">(</span><a href="#75395" title="(AnyRef, AnyRef)">kv</a>.<span title="=&gt; AnyRef">_1</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><a href="#74794" title="implicit edu.berkeley.cs.scads.storage.InMemStorageManager.bytes2eqarray : (bytes: Array[Byte])edu.berkeley.cs.scads.storage.EQArray" class="delimiter">[</a><span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>, <a href="#75404" title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">mv</a><span class="delimiter">)</span>
        <a href="#75395" title="(AnyRef, AnyRef)">kv</a> = <a href="#75373" title="edu.berkeley.cs.scads.storage.RecParser">parser</a>.<a href="PartitionHandler.scala.html#49886" title="()(AnyRef, AnyRef)">getNext</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(records: Seq[edu.berkeley.cs.scads.comm.PutRequest])Unit" id="74806">bulkPut</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.comm.PutRequest]" id="75409">records</a>:<span title="Seq[edu.berkeley.cs.scads.comm.PutRequest]">Seq</span><span class="delimiter">[</span>PutRequest<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#75409" title="Seq[edu.berkeley.cs.scads.comm.PutRequest]">records</a>.<span title="(f: edu.berkeley.cs.scads.comm.PutRequest =&gt; (Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord))Unit">foreach</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.PutRequest" id="75428">rec</a> =&gt; <span class="delimiter">{</span> 
      <span class="keyword">val</span> <a title="Array[Byte]" id="75429">recval</a> = <a href="#75428" title="edu.berkeley.cs.scads.comm.PutRequest">rec</a>.<span title="=&gt; Option[Array[Byte]]">value</span>.<span title="=&gt; Array[Byte]">get</span>
      <span title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)" class="keyword">if</span> <span class="delimiter">(</span><a href="#75429" title="Array[Byte]">recval</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord" id="75434">nrec</a> = <a href="#74797" title="=&gt; java.lang.Class[_]">valueClass</a>.<span title="()Any">newInstance</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord" class="delimiter">[</span><span title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">ScalaSpecificRecord</span><span class="delimiter">]</span>
        <a href="#75434" title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">nrec</a>.<span title="(inputStream: java.io.InputStream)nrec.type">parse</span><span class="delimiter">(</span><a href="../client/SimpleRecordMetadata.scala.html#37952" title="(value: Array[Byte])java.io.ByteArrayInputStream">getRecordInputStreamFromValue</a><span class="delimiter">(</span><a href="#75429" title="Array[Byte]">recval</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#74799" title="=&gt; java.util.TreeMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">map</a>.<span title="(x$1: edu.berkeley.cs.scads.storage.EQArray, x$2: (Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord))(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">put</span><span class="delimiter">(</span><a href="#75428" title="edu.berkeley.cs.scads.comm.PutRequest">rec</a>.<a href="#74794" title="implicit edu.berkeley.cs.scads.storage.InMemStorageManager.bytes2eqarray : (bytes: Array[Byte])edu.berkeley.cs.scads.storage.EQArray">key</a>,<span title="(_1: Array[Byte], _2: edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)" class="delimiter">(</span><a href="../client/SimpleRecordMetadata.scala.html#37951" title="(value: Array[Byte])Array[Byte]">extractMetadataFromValue</a><span class="delimiter">(</span><a href="#75429" title="Array[Byte]">recval</a><span class="delimiter">)</span>,<a href="#75434" title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">nrec</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span>
        <a href="#74799" title="=&gt; java.util.TreeMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">map</a>.<span title="(x$1: Any)(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">remove</span><span class="delimiter">(</span><a href="#75428" title="edu.berkeley.cs.scads.comm.PutRequest">rec</a>.<span title="=&gt; Array[Byte]">key</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(minKey: Option[Array[Byte]], maxKey: Option[Array[Byte]], limit: Option[Int], offset: Option[Int], ascending: Boolean)Seq[edu.berkeley.cs.scads.comm.Record]" id="74807">getRange</a><span class="delimiter">(</span><a title="Option[Array[Byte]]" id="75446">minKey</a>:<span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Option[Array[Byte]]" id="75447">maxKey</a>:<span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Option[Int]" id="75448">limit</a>:<span title="Option[Int]">Option</span><span class="delimiter">[</span>Int<span class="delimiter">]</span>, <a title="Option[Int]" id="75449">offset</a>:<span title="Option[Int]">Option</span><span class="delimiter">[</span>Int<span class="delimiter">]</span>, <a title="Boolean" id="75450">ascending</a>:<span title="Boolean">Boolean</span><span class="delimiter">)</span>:<span title="Seq[edu.berkeley.cs.scads.comm.Record]">Seq</span><span class="delimiter">[</span>Record<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[edu.berkeley.cs.scads.comm.Record]" id="75452">records</a> = <span title="()scala.collection.mutable.ArrayBuffer[edu.berkeley.cs.scads.comm.Record]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[edu.berkeley.cs.scads.comm.Record]">ArrayBuffer</span><span class="delimiter">[</span>Record<span class="delimiter">]</span>
    <a href="#75448" title="Option[Int]">limit</a>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#75452" title="scala.collection.mutable.ArrayBuffer[edu.berkeley.cs.scads.comm.Record]">records</a>.<span title="(len: Int)Unit">sizeHint</span><span class="delimiter">(</span><a href="#75459" title="Int">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#74813" title="(minKey: Option[edu.berkeley.cs.scads.storage.EQArray], maxKey: Option[edu.berkeley.cs.scads.storage.EQArray], limit: Option[Int], offset: Option[Int], ascending: Boolean)(func: (edu.berkeley.cs.scads.storage.EQArray, (Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)) =&gt; Unit)Unit">iterateVals</a><span class="delimiter">(</span><a href="#75446" title="Option[Array[Byte]]">minKey</a> <span title="(f: Array[Byte] =&gt; edu.berkeley.cs.scads.storage.EQArray)Option[edu.berkeley.cs.scads.storage.EQArray]">map</span> <a href="#74794" title="implicit edu.berkeley.cs.scads.storage.InMemStorageManager.bytes2eqarray : (bytes: Array[Byte])edu.berkeley.cs.scads.storage.EQArray">bytes2eqarray</a>, <a href="#75447" title="Option[Array[Byte]]">maxKey</a> <span title="(f: Array[Byte] =&gt; edu.berkeley.cs.scads.storage.EQArray)Option[edu.berkeley.cs.scads.storage.EQArray]">map</span> <a href="#74794" title="implicit edu.berkeley.cs.scads.storage.InMemStorageManager.bytes2eqarray : (bytes: Array[Byte])edu.berkeley.cs.scads.storage.EQArray">bytes2eqarray</a>, <a href="#75448" title="Option[Int]">limit</a>, <a href="#75449" title="Option[Int]">offset</a>, <a href="#75450" title="Boolean">ascending</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.EQArray" id="75492">key</a>, <a title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)" id="75493">value</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <a href="#75452" title="scala.collection.mutable.ArrayBuffer[edu.berkeley.cs.scads.comm.Record]">records</a> <span title="(elem: edu.berkeley.cs.scads.comm.Record)records.type">+=</span> <span title="(key: Array[Byte], value: Option[Array[Byte]])edu.berkeley.cs.scads.comm.Record">Record</span><span class="delimiter">(</span><a href="#75492" title="edu.berkeley.cs.scads.storage.EQArray">key</a>.<a href="#76859" title="=&gt; Array[Byte]">bytes</a>,<span title="(x: Array[Byte])Option[Array[Byte]]">Option</span><span class="delimiter">(</span><a href="#74801" title="(vals: (Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord))Array[Byte]">toBytes</a><span class="delimiter">(</span><a href="#75493" title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">value</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
    <a href="#75452" title="scala.collection.mutable.ArrayBuffer[edu.berkeley.cs.scads.comm.Record]">records</a>
  <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="(ranges: Seq[edu.berkeley.cs.scads.comm.MessageBody])scala.collection.mutable.ArrayBuffer[edu.berkeley.cs.scads.comm.GetRangeResponse]" id="74808">getBatch</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.comm.MessageBody]" id="75510">ranges</a>:<span title="Seq[edu.berkeley.cs.scads.comm.MessageBody]">Seq</span><span class="delimiter">[</span>MessageBody<span class="delimiter">]</span><span class="delimiter">)</span>:<span title="scala.collection.mutable.ArrayBuffer[edu.berkeley.cs.scads.comm.GetRangeResponse]">ArrayBuffer</span><span class="delimiter">[</span>GetRangeResponse<span class="delimiter">]</span>  = <span class="delimiter">{</span>
    <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;InMemStorageManager does not support ranges&quot;)" class="string">&quot;InMemStorageManager does not support ranges&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="(minKey: Option[Array[Byte]], maxKey: Option[Array[Byte]])Int" id="74809">countRange</a><span class="delimiter">(</span><a title="Option[Array[Byte]]" id="75516">minKey</a>:<span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Option[Array[Byte]]" id="75517">maxKey</a>:<span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>:<span title="Int">Int</span>  = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="75519">count</a> = <span title="Int(0)" class="int">0</span>
    <a href="#74813" title="(minKey: Option[edu.berkeley.cs.scads.storage.EQArray], maxKey: Option[edu.berkeley.cs.scads.storage.EQArray], limit: Option[Int], offset: Option[Int], ascending: Boolean)(func: (edu.berkeley.cs.scads.storage.EQArray, (Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)) =&gt; Unit)Unit">iterateVals</a><span class="delimiter">(</span><a href="#75516" title="Option[Array[Byte]]">minKey</a> <span title="(f: Array[Byte] =&gt; edu.berkeley.cs.scads.storage.EQArray)Option[edu.berkeley.cs.scads.storage.EQArray]">map</span> <a href="#74794" title="implicit edu.berkeley.cs.scads.storage.InMemStorageManager.bytes2eqarray : (bytes: Array[Byte])edu.berkeley.cs.scads.storage.EQArray">bytes2eqarray</a>,<a href="#75517" title="Option[Array[Byte]]">maxKey</a> <span title="(f: Array[Byte] =&gt; edu.berkeley.cs.scads.storage.EQArray)Option[edu.berkeley.cs.scads.storage.EQArray]">map</span> <a href="#74794" title="implicit edu.berkeley.cs.scads.storage.InMemStorageManager.bytes2eqarray : (bytes: Array[Byte])edu.berkeley.cs.scads.storage.EQArray">bytes2eqarray</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.EQArray" id="75539">k</a>,<a title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)" id="75540">v</a><span class="delimiter">)</span> =&gt; <a href="#75519" title="Int">count</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <a href="#75519" title="Int">count</a>
  <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="()(Option[Array[Byte]], Option[Array[Byte]])" id="74810">getResponsibility</a><span class="delimiter">(</span><span class="delimiter">)</span>:<span title="(Option[Array[Byte]], Option[Array[Byte]])" class="delimiter">(</span>Option<span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>,Option<span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span> = <span title="(_1: Option[Array[Byte]], _2: Option[Array[Byte]])(Option[Array[Byte]], Option[Array[Byte]])" class="delimiter">(</span><a href="#75225" title="=&gt; Option[Array[Byte]]">startKey</a>, <a href="#75226" title="=&gt; Option[Array[Byte]]">endKey</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(src: edu.berkeley.cs.scads.comm.PartitionService, overwrite: Boolean)Nothing" id="74811">copyData</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.PartitionService" id="75552">src</a>:<span title="edu.berkeley.cs.scads.comm.PartitionService">PartitionService</span>, <a title="Boolean" id="75553">overwrite</a>:<span title="Boolean">Boolean</span><span class="delimiter">)</span>  = <span class="delimiter">{</span>
    <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Not Implemented&quot;)" class="string">&quot;Not Implemented&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>


  <span class="keyword">def</span> <a title="(groups: Seq[String], keyType: String, valType: String, filters: Seq[edu.berkeley.cs.scads.comm.AggFilter], aggs: Seq[edu.berkeley.cs.scads.comm.AggOp])Seq[edu.berkeley.cs.scads.comm.GroupedAgg]" id="74812">applyAggregate</a><span class="delimiter">(</span><a title="Seq[String]" id="75560">groups</a>:<span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span>,
                     <a title="String" id="75561">keyType</a>:<span title="String">String</span>,
                     <a title="String" id="75562">valType</a>:<span title="String">String</span>,
                     <a title="Seq[edu.berkeley.cs.scads.comm.AggFilter]" id="75563">filters</a>:<span title="Seq[edu.berkeley.cs.scads.comm.AggFilter]">Seq</span><span class="delimiter">[</span>AggFilter<span class="delimiter">]</span>,
                     <a title="Seq[edu.berkeley.cs.scads.comm.AggOp]" id="75564">aggs</a>:<span title="Seq[edu.berkeley.cs.scads.comm.AggOp]">Seq</span><span class="delimiter">[</span>AggOp<span class="delimiter">]</span><span class="delimiter">)</span>:<span title="Seq[edu.berkeley.cs.scads.comm.GroupedAgg]">Seq</span><span class="delimiter">[</span>GroupedAgg<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.util.Filter[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]" id="75566">filterFunctions</a> = <a href="#75563" title="Seq[edu.berkeley.cs.scads.comm.AggFilter]">filters</a>.<span title="(f: edu.berkeley.cs.scads.comm.AggFilter =&gt; edu.berkeley.cs.scads.util.Filter[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.comm.AggFilter],edu.berkeley.cs.scads.util.Filter[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord],Seq[edu.berkeley.cs.scads.util.Filter[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]])Seq[edu.berkeley.cs.scads.util.Filter[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.util.Filter[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord],Seq[edu.berkeley.cs.scads.util.Filter[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.AggFilter" id="75595">f</a> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.io.ObjectInputStream" id="75596">ois</a> = <span title="java.io.ObjectInputStream" class="keyword">new</span> java.io.<span title="java.io.ObjectInputStream">ObjectInputStream</span><span class="delimiter">(</span><span title="java.io.ByteArrayInputStream" class="keyword">new</span> java.io.<span title="java.io.ByteArrayInputStream">ByteArrayInputStream</span><span class="delimiter">(</span><a href="#75595" title="edu.berkeley.cs.scads.comm.AggFilter">f</a>.<span title="=&gt; Array[Byte]">obj</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#75596" title="java.io.ObjectInputStream">ois</a>.<span title="()java.lang.Object">readObject</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.util.Filter[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]" class="delimiter">[</span><a href="../util/AnalyticsUtils.scala.html#9867" title="edu.berkeley.cs.scads.util.Filter[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]">Filter</a><span class="delimiter">[</span>ScalaSpecificRecord<span class="delimiter">]</span><span class="delimiter">]</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="keyword">var</span> <a title="Boolean" id="75567">filterPassed</a> = <span title="Boolean(true)" class="keyword">true</span>

    <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]" id="75568">aggregates</a> =
      <a href="#75564" title="Seq[edu.berkeley.cs.scads.comm.AggOp]">aggs</a>.<span title="(f: edu.berkeley.cs.scads.comm.AggOp =&gt; edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.comm.AggOp],edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord],Seq[edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]])Seq[edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord],Seq[edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.AggOp" id="75635">aggOp</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="java.io.ObjectInputStream" id="75636">ois</a> = <span title="java.io.ObjectInputStream" class="keyword">new</span> java.io.<span title="java.io.ObjectInputStream">ObjectInputStream</span><span class="delimiter">(</span><span title="java.io.ByteArrayInputStream" class="keyword">new</span> java.io.<span title="java.io.ByteArrayInputStream">ByteArrayInputStream</span><span class="delimiter">(</span><a href="#75635" title="edu.berkeley.cs.scads.comm.AggOp">aggOp</a>.<span title="=&gt; Array[Byte]">obj</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#75636" title="java.io.ObjectInputStream">ois</a>.<span title="()java.lang.Object">readObject</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]" class="delimiter">[</span><a href="../util/AnalyticsUtils.scala.html#9872" title="edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]">RemoteAggregate</a><span class="delimiter">[</span>ScalaSpecificRecord,ScalaSpecificRecord,ScalaSpecificRecord<span class="delimiter">]</span><span class="delimiter">]</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
            

    <span class="keyword">val</span> <a title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord" id="75569">remKey</a> = <span title="object java.lang.Class">Class</span>.<span title="(x$1: java.lang.String)java.lang.Class[_]">forName</span><span class="delimiter">(</span><a href="#75561" title="String">keyType</a><span class="delimiter">)</span>.<span title="()?0">newInstance</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord" class="delimiter">[</span><span title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">ScalaSpecificRecord</span><span class="delimiter">]</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord" id="75570">remVal</a> = <span title="object java.lang.Class">Class</span>.<span title="(x$1: java.lang.String)java.lang.Class[_]">forName</span><span class="delimiter">(</span><a href="#75562" title="String">valType</a><span class="delimiter">)</span>.<span title="()?0">newInstance</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord" class="delimiter">[</span><span title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">ScalaSpecificRecord</span><span class="delimiter">]</span>
    
    <span class="keyword">val</span> <a title="Seq[org.apache.avro.Schema]" id="75571">groupSchemas</a> = <a href="#75560" title="Seq[String]">groups</a>.<span title="(f: String =&gt; org.apache.avro.Schema)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],org.apache.avro.Schema,Seq[org.apache.avro.Schema]])Seq[org.apache.avro.Schema]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,org.apache.avro.Schema,Seq[org.apache.avro.Schema]]" class="delimiter">(</span><a href="#75229" title="org.apache.avro.Schema">valueSchema</a>.<span title="(x$1: java.lang.String)org.apache.avro.Schema.Field">getField</span><span class="delimiter">(</span><a href="#75681" title="String">_</a><span class="delimiter">)</span>.<span title="()org.apache.avro.Schema">schema</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Seq[Int]" id="75572">groupInts</a> = <a href="#75560" title="Seq[String]">groups</a>.<span title="(f: String =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],Int,Seq[Int]])Seq[Int]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Int,Seq[Int]]" class="delimiter">(</span><a href="#75229" title="org.apache.avro.Schema">valueSchema</a>.<span title="(x$1: java.lang.String)org.apache.avro.Schema.Field">getField</span><span class="delimiter">(</span><a href="#75711" title="String">_</a><span class="delimiter">)</span>.<span title="()Int">pos</span><span class="delimiter">)</span>
    
    <span class="keyword">var</span> <a title="scala.collection.mutable.HashMap[java.lang.CharSequence,scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]" id="75573">groupMap</a>:scala.collection.mutable.<span title="scala.collection.mutable.HashMap[java.lang.CharSequence,scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]">HashMap</span><span class="delimiter">[</span>CharSequence, scala.collection.mutable.ArraySeq<span class="delimiter">[</span>ScalaSpecificRecord<span class="delimiter">]</span><span class="delimiter">]</span> = <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">var</span> <a title="Map[java.lang.CharSequence,Array[Byte]]" id="75574">groupBytesMap</a>:<span title="Map[java.lang.CharSequence,Array[Byte]]">Map</span><span class="delimiter">[</span>CharSequence, Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span> = <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">var</span> <a title="java.lang.CharSequence" id="75575">groupKey</a>:<span title="java.lang.CharSequence">CharSequence</span> = <span title="Null(null)" class="keyword">null</span>
    
    <span class="keyword">var</span> <a title="Seq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]" id="75576">aggVals</a>:<span title="Seq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]">Seq</span><span class="delimiter">[</span>ScalaSpecificRecord<span class="delimiter">]</span> = <span title="Null(null)" class="keyword">null</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#75560" title="Seq[String]">groups</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="comment">// no groups, so let's init values now</span>
      <a href="#75576" title="Seq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]">aggVals</a> = <a href="#75568" title="Seq[edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]">aggregates</a>.<span title="(f: edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord] =&gt; edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]],edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,Seq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]])Seq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,Seq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]" class="delimiter">(</span><a href="#75752" title="edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]">_</a>.<a href="../util/AnalyticsUtils.scala.html#26762" title="()edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">init</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#75573" title="scala.collection.mutable.HashMap[java.lang.CharSequence,scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]">groupMap</a> = <span title="()scala.collection.mutable.HashMap[java.lang.CharSequence,scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]" class="keyword">new</span> scala.collection.mutable.<span title="scala.collection.mutable.HashMap[java.lang.CharSequence,scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]">HashMap</span><span class="delimiter">[</span>CharSequence,scala.collection.mutable.ArraySeq<span class="delimiter">[</span>ScalaSpecificRecord<span class="delimiter">]</span><span class="delimiter">]</span>
      <a href="#75574" title="Map[java.lang.CharSequence,Array[Byte]]">groupBytesMap</a> = <span title="scala.collection.immutable.HashMap[java.lang.CharSequence,Array[Byte]]" class="keyword">new</span> scala.collection.immutable.<span title="scala.collection.immutable.HashMap[java.lang.CharSequence,Array[Byte]]">HashMap</span><span class="delimiter">[</span>CharSequence, Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">var</span> <a title="scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]" id="75577">curAggVal</a> =
      <span title="scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]" class="keyword">if</span> <span class="delimiter">(</span><a href="#75560" title="Seq[String]">groups</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
        scala.collection.mutable.<span title="(elems: edu.berkeley.cs.avro.runtime.ScalaSpecificRecord*)scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]">ArraySeq</span><span class="delimiter">(</span><a href="#75576" title="Seq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]">aggVals</a>:_*<span class="delimiter">)</span>
      <span class="keyword">else</span>
        <span title="Null(null)" class="keyword">null</span>

    <span class="keyword">var</span> <a title="Boolean" id="75578">stop</a> = <span title="Boolean(false)" class="keyword">false</span>

    <a href="#74813" title="(minKey: Option[edu.berkeley.cs.scads.storage.EQArray], maxKey: Option[edu.berkeley.cs.scads.storage.EQArray], limit: Option[Int], offset: Option[Int], ascending: Boolean)(func: (edu.berkeley.cs.scads.storage.EQArray, (Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)) =&gt; Unit)Unit">iterateVals</a><span class="delimiter">(</span><span title="object None">None</span>,<span title="object None">None</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.EQArray" id="75782">remKey</a>,<a title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)" id="75783">mdplusval</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord" id="75784">remVal</a> = <a href="#75783" title="(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">mdplusval</a>.<span title="=&gt; edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">_2</span>
      <a href="#75567" title="Boolean">filterPassed</a> = <span title="Boolean(true)" class="keyword">true</span>
      <a href="#75566" title="Seq[edu.berkeley.cs.scads.util.Filter[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]">filterFunctions</a>.<span title="(f: edu.berkeley.cs.scads.util.Filter[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord] =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.util.Filter[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]" id="75801">ff</a> =&gt; <span class="delimiter">{</span> 
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#75567" title="Boolean">filterPassed</a><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="comment">// once one failed just ignore the rest</span>
          <a href="#75567" title="Boolean">filterPassed</a> = <a href="#75801" title="edu.berkeley.cs.scads.util.Filter[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]">ff</a>.<a href="../util/AnalyticsUtils.scala.html#24220" title="(r: edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)Boolean">applyFilter</a><span class="delimiter">(</span><a href="#75784" title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">remVal</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#75567" title="Boolean">filterPassed</a><span class="delimiter">)</span> <span class="delimiter">{</span>  <span class="comment">// record passes filters</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#75560" title="Seq[String]">groups</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#75575" title="java.lang.CharSequence">groupKey</a> = <a href="../util/AnalyticsUtils.scala.html#9876" title="object edu.berkeley.cs.scads.util.AnalyticsUtils">AnalyticsUtils</a>.<a href="../util/AnalyticsUtils.scala.html#26881" title="(groups: Seq[Int], rec: org.apache.avro.generic.IndexedRecord)java.lang.CharSequence">getGroupKey</a><span class="delimiter">(</span><a href="#75572" title="Seq[Int]">groupInts</a>,<a href="#75784" title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">remVal</a><span class="delimiter">)</span>
          <a href="#75577" title="scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]">curAggVal</a> = <a href="#75573" title="scala.collection.mutable.HashMap[java.lang.CharSequence,scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]">groupMap</a>.<span title="(key: java.lang.CharSequence)Option[scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]">get</span><span class="delimiter">(</span><a href="#75575" title="java.lang.CharSequence">groupKey</a><span class="delimiter">)</span> <span title="scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]">Some</span><span class="delimiter">(</span><a title="scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]" id="75825">thing</a><span class="delimiter">)</span> =&gt; <a href="#75825" title="scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]">thing</a>
            <span class="keyword">case</span> <span title="scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]">None</span> =&gt; <span class="delimiter">{</span> <span class="comment">// this is a new group, so init the starting values for the agg</span>
              <a href="#75574" title="Map[java.lang.CharSequence,Array[Byte]]">groupBytesMap</a> <span title="(kv: (java.lang.CharSequence, Array[Byte]))scala.collection.immutable.Map[java.lang.CharSequence,Array[Byte]]">+=</span> <span class="delimiter">(</span><span title="(_1: java.lang.CharSequence, _2: Array[Byte])(java.lang.CharSequence, Array[Byte])" class="delimiter">(</span><a href="#75575" title="java.lang.CharSequence">groupKey</a>,<a href="../util/AnalyticsUtils.scala.html#9876" title="object edu.berkeley.cs.scads.util.AnalyticsUtils">AnalyticsUtils</a>.<a href="../util/AnalyticsUtils.scala.html#26878" title="(groups: Seq[Int], groupSchemas: Seq[org.apache.avro.Schema], rec: org.apache.avro.generic.IndexedRecord)Array[Byte]">getGroupBytes</a><span class="delimiter">(</span><a href="#75572" title="Seq[Int]">groupInts</a>,<a href="#75571" title="Seq[org.apache.avro.Schema]">groupSchemas</a>,<a href="#75784" title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">remVal</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
              scala.collection.mutable.<span title="(elems: edu.berkeley.cs.avro.runtime.ScalaSpecificRecord*)scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]">ArraySeq</span><span class="delimiter">(</span><a href="#75568" title="Seq[edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]">aggregates</a>.<span title="(f: edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord] =&gt; edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]],edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,Seq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]])Seq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,Seq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]" class="delimiter">(</span><a href="#75910" title="edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]">_</a>.<a href="../util/AnalyticsUtils.scala.html#26762" title="()edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">init</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>:_*<span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <a href="#75578" title="Boolean">stop</a> = <span title="Boolean(true)" class="keyword">true</span>
        <a href="#75568" title="Seq[edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]">aggregates</a>.<span title="=&gt; java.lang.Object with scala.collection.SeqView[edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord],Seq[edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]]">view</span>.<span title="(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.SeqView[edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord],Seq[edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]],(edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord], Int),scala.collection.SeqView[(edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord], Int),Seq[_]]])scala.collection.SeqView[(edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord], Int),Seq[_]]">zipWithIndex</span> <span title="(f: (edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord], Int) =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="(edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord], Int)" id="76006">aggregate</a> =&gt; <span class="delimiter">{</span>
          <a href="#75577" title="(idx: Int, elem: edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)Unit">curAggVal</a><span class="delimiter">(</span><a href="#76006" title="(edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord], Int)">aggregate</a>.<span title="=&gt; Int">_2</span><span class="delimiter">)</span> = <a href="#76006" title="(edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord], Int)">aggregate</a>.<span title="=&gt; edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]">_1</span>.<a href="../util/AnalyticsUtils.scala.html#26763" title="(a: edu.berkeley.cs.avro.runtime.ScalaSpecificRecord, k: edu.berkeley.cs.avro.runtime.ScalaSpecificRecord, v: edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">applyAggregate</a><span class="delimiter">(</span><a href="#75577" title="(idx: Int)edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">curAggVal</a><span class="delimiter">(</span><a href="#76006" title="(edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord], Int)">aggregate</a>.<span title="=&gt; Int">_2</span><span class="delimiter">)</span>,<span title="Null(null)" class="keyword">null</span>,<a href="#75784" title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">remVal</a><span class="delimiter">)</span>
          <a href="#75578" title="Boolean">stop</a> <span title="(x: Boolean)Boolean">&amp;=</span> <a href="#76006" title="(edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord], Int)">aggregate</a>.<span title="=&gt; edu.berkeley.cs.scads.util.RemoteAggregate[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord,edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]">_1</span>.<a href="../util/AnalyticsUtils.scala.html#26758" title="=&gt; Boolean">stop</a>
        <span class="delimiter">}</span><span class="delimiter">)</span>
        <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#75560" title="Seq[String]">groups</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
          <a href="#75573" title="scala.collection.mutable.HashMap[java.lang.CharSequence,scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]">groupMap</a> <span title="(kv: (java.lang.CharSequence, scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]))scala.collection.mutable.HashMap[java.lang.CharSequence,scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]">+=</span> <span class="delimiter">(</span><span title="(_1: java.lang.CharSequence, _2: scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord])(java.lang.CharSequence, scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord])" class="delimiter">(</span><a href="#75575" title="java.lang.CharSequence">groupKey</a>,<a href="#75577" title="scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]">curAggVal</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#75578" title="Boolean">stop</a><span class="delimiter">)</span>
          <a href="#74795" title="=&gt; scala.util.control.Breaks">iterateValsBreakable</a>.<span title="()Unit">break</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    <span title="Seq[edu.berkeley.cs.scads.comm.GroupedAgg]" class="keyword">if</span> <span class="delimiter">(</span><a href="#75560" title="Seq[String]">groups</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="(xs: edu.berkeley.cs.scads.comm.GroupedAgg*)List[edu.berkeley.cs.scads.comm.GroupedAgg]">List</span><span class="delimiter">(</span><span title="(group: Option[Array[Byte]], groupVals: Seq[Array[Byte]])edu.berkeley.cs.scads.comm.GroupedAgg">GroupedAgg</span><span class="delimiter">(</span><span title="object None">None</span>,<a href="#75577" title="scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]">curAggVal</a>.<span title="(f: edu.berkeley.cs.avro.runtime.ScalaSpecificRecord =&gt; Array[Byte])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord],Array[Byte],Seq[Array[Byte]]])Seq[Array[Byte]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArraySeq.Coll,Array[Byte],scala.collection.mutable.ArraySeq[Array[Byte]]]" class="delimiter">(</span><a href="#76105" title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">_</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord" class="delimiter">[</span><span title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">ScalaSpecificRecord</span><span class="delimiter">]</span>.<span title="=&gt; Array[Byte]">toBytes</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#75573" title="scala.collection.mutable.HashMap[java.lang.CharSequence,scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]]">groupMap</a>.<span title="(f: (java.lang.CharSequence, scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]) =&gt; edu.berkeley.cs.scads.comm.GroupedAgg)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.HashMap[java.lang.CharSequence,scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]],edu.berkeley.cs.scads.comm.GroupedAgg,scala.collection.mutable.Iterable[edu.berkeley.cs.scads.comm.GroupedAgg]])scala.collection.mutable.Iterable[edu.berkeley.cs.scads.comm.GroupedAgg]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Iterable.Coll,edu.berkeley.cs.scads.comm.GroupedAgg,scala.collection.mutable.Iterable[edu.berkeley.cs.scads.comm.GroupedAgg]]" class="delimiter">(</span><a title="(java.lang.CharSequence, scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord])" id="76163">kv</a> =&gt; <span class="delimiter">{</span>
        <span title="(group: Option[Array[Byte]], groupVals: Seq[Array[Byte]])edu.berkeley.cs.scads.comm.GroupedAgg">GroupedAgg</span><span class="delimiter">(</span><span title="(x: Array[Byte])Option[Array[Byte]]">Option</span><span class="delimiter">(</span><a href="#75574" title="(key: java.lang.CharSequence)Array[Byte]">groupBytesMap</a><span class="delimiter">(</span><a href="#76163" title="(java.lang.CharSequence, scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord])">kv</a>.<span title="=&gt; java.lang.CharSequence">_1</span><span class="delimiter">)</span><span class="delimiter">)</span>,<a href="#76163" title="(java.lang.CharSequence, scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord])">kv</a>.<span title="=&gt; scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord]">_2</span>.<span title="(f: edu.berkeley.cs.avro.runtime.ScalaSpecificRecord =&gt; Array[Byte])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArraySeq[edu.berkeley.cs.avro.runtime.ScalaSpecificRecord],Array[Byte],Seq[Array[Byte]]])Seq[Array[Byte]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArraySeq.Coll,Array[Byte],scala.collection.mutable.ArraySeq[Array[Byte]]]" class="delimiter">(</span><a href="#76204" title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">_</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord" class="delimiter">[</span><span title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">ScalaSpecificRecord</span><span class="delimiter">]</span>.<span title="=&gt; Array[Byte]">toBytes</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>.<span title="=&gt; Seq[edu.berkeley.cs.scads.comm.GroupedAgg]">toSeq</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(minKey: Option[edu.berkeley.cs.scads.storage.EQArray], maxKey: Option[edu.berkeley.cs.scads.storage.EQArray], limit: Option[Int], offset: Option[Int], ascending: Boolean)(func: (edu.berkeley.cs.scads.storage.EQArray, (Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)) =&gt; Unit)Unit" id="74813">iterateVals</a><span class="delimiter">(</span><a title="Option[edu.berkeley.cs.scads.storage.EQArray]" id="75469">minKey</a>: <span title="Option[edu.berkeley.cs.scads.storage.EQArray]">Option</span><span class="delimiter">[</span>EQArray<span class="delimiter">]</span>,
                          <a title="Option[edu.berkeley.cs.scads.storage.EQArray]" id="75470">maxKey</a>: <span title="Option[edu.berkeley.cs.scads.storage.EQArray]">Option</span><span class="delimiter">[</span>EQArray<span class="delimiter">]</span>,
                          <a title="Option[Int]" id="75476">limit</a>: <span title="Option[Int]">Option</span><span class="delimiter">[</span>Int<span class="delimiter">]</span> = <span title="object None">None</span>,
                          <a title="Option[Int]" id="75477">offset</a>: <span title="Option[Int]">Option</span><span class="delimiter">[</span>Int<span class="delimiter">]</span> = <span title="object None">None</span>,
                          <a title="Boolean" id="75478">ascending</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
  <span class="delimiter">(</span><a title="(edu.berkeley.cs.scads.storage.EQArray, (Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)) =&gt; Unit" id="75474">func</a>:<span class="delimiter">(</span>EQArray,<span class="delimiter">(</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>,ScalaSpecificRecord<span class="delimiter">)</span><span class="delimiter">)</span>=&gt;Unit<span class="delimiter">)</span>:<span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.util.NavigableMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]" id="76665">eMap</a> = <span title="(_1: Option[edu.berkeley.cs.scads.storage.EQArray], _2: Option[edu.berkeley.cs.scads.storage.EQArray])(Option[edu.berkeley.cs.scads.storage.EQArray], Option[edu.berkeley.cs.scads.storage.EQArray])" class="delimiter">(</span><a href="#75469" title="Option[edu.berkeley.cs.scads.storage.EQArray]">minKey</a>,<a href="#75470" title="Option[edu.berkeley.cs.scads.storage.EQArray]">maxKey</a><span class="delimiter">)</span> <span title="java.util.NavigableMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="java.util.TreeMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]" class="delimiter">(</span><span title="object None">None</span>, <span title="object None">None</span><span class="delimiter">)</span> =&gt; <a href="#74799" title="=&gt; java.util.TreeMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">map</a>
      <span class="keyword">case</span> <span title="java.util.NavigableMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]" class="delimiter">(</span><span title="object None">None</span>, Some<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.EQArray" id="76680">endKey</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#74799" title="=&gt; java.util.TreeMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">map</a>.<span title="(x$1: edu.berkeley.cs.scads.storage.EQArray, x$2: Boolean)java.util.NavigableMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">headMap</span><span class="delimiter">(</span><a href="#76680" title="edu.berkeley.cs.scads.storage.EQArray">endKey</a>,<span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="java.util.NavigableMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]" class="delimiter">(</span>Some<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.EQArray" id="76697">startKey</a><span class="delimiter">)</span>, <span title="object None">None</span><span class="delimiter">)</span> =&gt; <a href="#74799" title="=&gt; java.util.TreeMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">map</a>.<span title="(x$1: edu.berkeley.cs.scads.storage.EQArray, x$2: Boolean)java.util.NavigableMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">tailMap</span><span class="delimiter">(</span><a href="#76697" title="edu.berkeley.cs.scads.storage.EQArray">startKey</a>,<span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="java.util.NavigableMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]" class="delimiter">(</span>Some<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.EQArray" id="76710">startKey</a><span class="delimiter">)</span>, Some<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.EQArray" id="76712">endKey</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#74799" title="=&gt; java.util.TreeMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">map</a>.<span title="(x$1: edu.berkeley.cs.scads.storage.EQArray, x$2: Boolean, x$3: edu.berkeley.cs.scads.storage.EQArray, x$4: Boolean)java.util.NavigableMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">subMap</span><span class="delimiter">(</span><a href="#76710" title="edu.berkeley.cs.scads.storage.EQArray">startKey</a>,<span title="Boolean(true)" class="keyword">true</span>,<a href="#76712" title="edu.berkeley.cs.scads.storage.EQArray">endKey</a>,<span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="java.util.Iterator[java.util.Map.Entry[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]]" id="76666">it</a> = 
      <span title="java.util.Iterator[java.util.Map.Entry[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#75478" title="Boolean">ascending</a><span class="delimiter">)</span>
        <a href="#76665" title="java.util.NavigableMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">eMap</a>.<span title="()java.util.Set[java.util.Map.Entry[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]]">entrySet</span>.<span title="()java.util.Iterator[java.util.Map.Entry[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]]">iterator</span>
      <span class="keyword">else</span>
        <a href="#76665" title="java.util.NavigableMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">eMap</a>.<span title="()java.util.NavigableMap[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">descendingMap</span>.<span title="()java.util.Set[java.util.Map.Entry[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]]">entrySet</span>.<span title="()java.util.Iterator[java.util.Map.Entry[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]]">iterator</span>
    <span class="keyword">var</span> <a title="Int" id="76667">toSkip</a> = <a href="#75477" title="Option[Int]">offset</a>.<span title="(default: =&gt; Int)Int">getOrElse</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
    <span class="keyword">var</span> <a title="Int" id="76668">lim</a> = <a href="#75476" title="Option[Int]">limit</a>.<span title="(default: =&gt; Int)Int">getOrElse</span><span class="delimiter">(</span>-<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span>
    <a href="#74795" title="=&gt; scala.util.control.Breaks">iterateValsBreakable</a>.<span title="(op: =&gt; Unit)Unit">breakable</span> <span class="delimiter">{</span> <span class="comment">// used to allow func to break out early</span>
      <span title="Unit" class="keyword">while</span><span class="delimiter">(</span><a href="#76666" title="java.util.Iterator[java.util.Map.Entry[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]]">it</a>.<span title="()Boolean">hasNext</span><span class="delimiter">)</span> <a href="#76752" title="()Unit" class="delimiter">{</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#76668" title="Int">lim</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="Nothing" class="keyword">return</span>
        <a href="#76668" title="Int">lim</a> <span title="(x: Int)Int">-=</span> <span title="Int(1)" class="int">1</span>
        <span class="keyword">val</span> <a title="java.util.Map.Entry[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]" id="76753">mapEntry</a> = <a href="#76666" title="java.util.Iterator[java.util.Map.Entry[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]]">it</a>.<span title="()java.util.Map.Entry[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">next</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#76667" title="Int">toSkip</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> 
          <a href="#76667" title="Int">toSkip</a> <span title="(x: Int)Int">-=</span><span title="Int(1)" class="int">1</span>
        <span class="keyword">else</span>
          <a href="#75474" title="(v1: edu.berkeley.cs.scads.storage.EQArray, v2: (Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord))Unit">func</a><span class="delimiter">(</span><a href="#76753" title="java.util.Map.Entry[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">mapEntry</a>.<span title="()edu.berkeley.cs.scads.storage.EQArray">getKey</span>,<a href="#76753" title="java.util.Map.Entry[edu.berkeley.cs.scads.storage.EQArray,(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)]">mapEntry</a>.<span title="()(Array[Byte], edu.berkeley.cs.avro.runtime.ScalaSpecificRecord)">getValue</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="74814">startup</a><span class="delimiter">(</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> = <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="()Unit" id="74815">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>:<span title="Unit">Unit</span> = <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>

<span class="delimiter">}</span>


        </pre>
    </body>
</html>