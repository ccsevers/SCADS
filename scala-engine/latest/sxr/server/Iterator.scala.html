<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>server/Iterator.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs.scads.storage

<span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue

<span class="keyword">import</span> scala.actors._
<span class="keyword">import</span> scala.actors.<span title="object scala.actors.Actor">Actor</span>._

<span class="keyword">import</span> net.lag.logging.Logger

<span class="keyword">import</span> edu.berkeley.cs.scads.comm._

<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class FutureBasedIterator extends java.lang.Object with Iterator[edu.berkeley.cs.scads.storage.Record] with ScalaObject" id="10037">FutureBasedIterator</a><a href="#10037" title="ScalaObject" class="delimiter">(</a><a title="edu.berkeley.cs.scads.storage.PartitionService" id="69893">partitionService</a>: <a href="../Messages.scala.html#9559" title="edu.berkeley.cs.scads.storage.PartitionService">PartitionService</a>, <a title="Option[Array[Byte]]" id="69894">minKey</a>: <span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Option[Array[Byte]]" id="69895">maxKey</a>: <span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Int" id="69897">recsPerMessage</a>: <span title="Int">Int</span> = <span title="Int(1024)" class="int">1024</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="Iterator[edu.berkeley.cs.scads.storage.Record]">Iterator</span><span class="delimiter">[</span>Record<span class="delimiter">]</span> <span class="delimiter">{</span>
  <span title="(requirement: Boolean)Unit">require</span><span class="delimiter">(</span><a href="#69897" title="Int">recsPerMessage</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Int" id="54384">recsPerMessageDiv2</a> = <a href="#69897" title="Int">recsPerMessage</a> <span title="(x: Int)Int">/</span> <span title="Int(2)" class="int">2</span>

  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Boolean" id="54387">isDone</a> = <span title="Boolean(false)" class="keyword">false</span>

  <span class="keyword">private</span> <span class="keyword">var</span> <a title="IndexedSeq[edu.berkeley.cs.scads.storage.Record]" id="54390">currentBuffer</a>: <span title="IndexedSeq[edu.berkeley.cs.scads.storage.Record]">IndexedSeq</span><span class="delimiter">[</span>Record<span class="delimiter">]</span> = <span title="=&gt; collection.immutable.Vector.type">Vector</span>.<span title="scala.collection.immutable.Vector[Nothing]">empty</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="54393">currentIdx</a> = <span title="Int(0)" class="int">0</span>

  <span class="keyword">private</span> <span class="keyword">var</span> <a title="edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]" id="54396">activeFuture</a>: <span title="edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">MessageFuture</span><span class="delimiter">[</span>StorageMessage<span class="delimiter">]</span> = _

  <span class="keyword">def</span> <a title="()edu.berkeley.cs.scads.storage.Record" id="54398">next</a>: <a href="../Messages.scala.html#9560" title="edu.berkeley.cs.scads.storage.Record">Record</a> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#54402" title="=&gt; Boolean">hasNext</a><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.UnsupportedOperationException" class="keyword">new</span> <span title="java.lang.UnsupportedOperationException">UnsupportedOperationException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;next on empty iterator&quot;)" class="string">&quot;next on empty iterator&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.Record" id="79996">res</a> = <a href="#54390" title="(idx: Int)edu.berkeley.cs.scads.storage.Record">currentBuffer</a><span class="delimiter">(</span><a href="#54393" title="=&gt; Int">currentIdx</a><span class="delimiter">)</span>
    <a href="#54393" title="(x$1: Int)Unit">currentIdx</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#54393" title="=&gt; Int">currentIdx</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="#54384" title="=&gt; Int">recsPerMessageDiv2</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">(</span><a href="#54396" title="=&gt; edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">activeFuture</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#54400" title="=&gt; Boolean">canRequestMore</a><span class="delimiter">)</span>
      <a href="#54396" title="(x$1: edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])Unit">activeFuture</a> = <a href="#54399" title="()edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">issueNextRequest</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#79996" title="edu.berkeley.cs.scads.storage.Record">res</a>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="()edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]" id="54399">issueNextRequest</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">MessageFuture</span><span class="delimiter">[</span>StorageMessage<span class="delimiter">]</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="54400">canRequestMore</a>: <span title="Boolean">Boolean</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(ftch: edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])IndexedSeq[edu.berkeley.cs.scads.storage.Record]" id="54401">getRecordsFromFuture</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]" id="70343">ftch</a>: <span title="edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">MessageFuture</span><span class="delimiter">[</span>StorageMessage<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="IndexedSeq[edu.berkeley.cs.scads.storage.Record]">IndexedSeq</span><span class="delimiter">[</span>Record<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="=&gt; Boolean" id="54402">hasNext</a>: <span title="Boolean">Boolean</span> =
    <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#54387" title="=&gt; Boolean">isDone</a><span class="delimiter">)</span> <span title="Boolean(false)" class="keyword">false</span> 
    <span class="keyword">else</span> <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#54393" title="=&gt; Int">currentIdx</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#54390" title="=&gt; IndexedSeq[edu.berkeley.cs.scads.storage.Record]">currentBuffer</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span> <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">else</span> <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#54396" title="=&gt; edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">activeFuture</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#54390" title="(x$1: IndexedSeq[edu.berkeley.cs.scads.storage.Record])Unit">currentBuffer</a> = <a href="#54401" title="(ftch: edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])IndexedSeq[edu.berkeley.cs.scads.storage.Record]">getRecordsFromFuture</a><span class="delimiter">(</span><a href="#54396" title="=&gt; edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">activeFuture</a><span class="delimiter">)</span>
      <a href="#54393" title="(x$1: Int)Unit">currentIdx</a> = <span title="Int(0)" class="int">0</span>
      <a href="#54396" title="(x$1: edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])Unit">activeFuture</a> = <span title="Null(null)" class="keyword">null</span>
      <a href="#54402" title="=&gt; Boolean">hasNext</a>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#54400" title="=&gt; Boolean">canRequestMore</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="#54396" title="=&gt; edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">activeFuture</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
      <a href="#54396" title="(x$1: edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])Unit">activeFuture</a> = <a href="#54399" title="()edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">issueNextRequest</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#54402" title="=&gt; Boolean">hasNext</a>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#54387" title="(x$1: Boolean)Unit">isDone</a> = <span title="Boolean(true)" class="keyword">true</span>
      <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class ActorlessPartitionIterator extends edu.berkeley.cs.scads.storage.FutureBasedIterator with ScalaObject" id="10040">ActorlessPartitionIterator</a><a href="#10040" title="ScalaObject" class="delimiter">(</a><a title="edu.berkeley.cs.scads.storage.PartitionService" id="54421">partitionService</a>: <a href="../Messages.scala.html#9559" title="edu.berkeley.cs.scads.storage.PartitionService">PartitionService</a>, <a title="Option[Array[Byte]]" id="54422">minKey</a>: <span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Option[Array[Byte]]" id="54423">maxKey</a>: <span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Int" id="54426">recsPerMessage</a>: <span title="Int">Int</span> = <span title="Int(1024)" class="int">1024</span><span class="delimiter">)</span> 
  <span class="keyword">extends</span> <a href="#10037" title="edu.berkeley.cs.scads.storage.FutureBasedIterator">FutureBasedIterator</a><span class="delimiter">(</span><a href="#54421" title="edu.berkeley.cs.scads.storage.PartitionService">partitionService</a>, <a href="#54422" title="Option[Array[Byte]]">minKey</a>, <a href="#54423" title="Option[Array[Byte]]">maxKey</a>, <a href="#54426" title="Int">recsPerMessage</a><span class="delimiter">)</span> <span class="delimiter">{</span>

  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Option[Array[Byte]]" id="54413">lastRecvKey</a>: <span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span> = <span title="object None">None</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="54416">lastSizeReturned</a> = <a href="#54426" title="Int">recsPerMessage</a>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="()edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]" id="54418">issueNextRequest</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">MessageFuture</span><span class="delimiter">[</span>StorageMessage<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="comment">// dispatch new request</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.GetRangeRequest" id="80072">req</a> = 
      <a href="#54413" title="=&gt; Option[Array[Byte]]">lastRecvKey</a>.<span title="(f: Array[Byte] =&gt; edu.berkeley.cs.scads.storage.GetRangeRequest)Option[edu.berkeley.cs.scads.storage.GetRangeRequest]">map</span><span class="delimiter">(</span><a title="Array[Byte]" id="80077">sk</a> =&gt; <a href="../Messages.scala.html#23010" title="(minKey: Option[Array[Byte]], maxKey: Option[Array[Byte]], limit: Option[Int], offset: Option[Int], ascending: Boolean)edu.berkeley.cs.scads.storage.GetRangeRequest">GetRangeRequest</a><span class="delimiter">(</span><span title="(x: Array[Byte])Some[Array[Byte]]">Some</span><span class="delimiter">(</span><a href="#80077" title="Array[Byte]">sk</a><span class="delimiter">)</span>, <a href="#54423" title="Option[Array[Byte]]">maxKey</a>, limit=<span title="(x: Int)Some[Int]">Some</span><span class="delimiter">(</span><a href="#54426" title="Int">recsPerMessage</a><span class="delimiter">)</span>, offset=<span title="(x: Int)Some[Int]">Some</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(default: =&gt; edu.berkeley.cs.scads.storage.GetRangeRequest)edu.berkeley.cs.scads.storage.GetRangeRequest">getOrElse</span><span class="delimiter">(</span><a href="../Messages.scala.html#23010" title="(minKey: Option[Array[Byte]], maxKey: Option[Array[Byte]], limit: Option[Int], offset: Option[Int], ascending: Boolean)edu.berkeley.cs.scads.storage.GetRangeRequest">GetRangeRequest</a><span class="delimiter">(</span><a href="#54422" title="Option[Array[Byte]]">minKey</a>, <a href="#54423" title="Option[Array[Byte]]">maxKey</a>, limit=<span title="(x: Int)Some[Int]">Some</span><span class="delimiter">(</span><a href="#54426" title="Int">recsPerMessage</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#54421" title="edu.berkeley.cs.scads.storage.PartitionService">partitionService</a> <span title="(body: edu.berkeley.cs.scads.storage.StorageMessage)edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">!!</span> <a href="#80072" title="edu.berkeley.cs.scads.storage.GetRangeRequest">req</a>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="54419">canRequestMore</a> = <a href="#54416" title="=&gt; Int">lastSizeReturned</a> <span title="(x: Int)Boolean">==</span> <a href="#54426" title="Int">recsPerMessage</a>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(ftch: edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])IndexedSeq[edu.berkeley.cs.scads.storage.Record]" id="54420">getRecordsFromFuture</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]" id="80105">ftch</a>: <span title="edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">MessageFuture</span><span class="delimiter">[</span>StorageMessage<span class="delimiter">]</span><span class="delimiter">)</span> =
    <a href="#80105" title="edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">ftch</a>.<span title="(timeout: Long)Option[edu.berkeley.cs.scads.storage.StorageMessage]">get</span><span class="delimiter">(</span><span class="int">10</span> * <span class="int">60</span> <span title="Long(600000L)">*</span> <span class="int">1000</span><span class="delimiter">)</span>.<span title="(default: =&gt; edu.berkeley.cs.scads.storage.StorageMessage)edu.berkeley.cs.scads.storage.StorageMessage">getOrElse</span><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;GetRangeRequest timedout&quot;)" class="string">&quot;GetRangeRequest timedout&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="IndexedSeq[edu.berkeley.cs.scads.storage.Record]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="scala.collection.immutable.IndexedSeq[edu.berkeley.cs.scads.storage.Record]">GetRangeResponse</span><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.storage.Record]" id="80131">recs</a><span class="delimiter">)</span> =&gt; 
        <a href="#54416" title="(x$1: Int)Unit">lastSizeReturned</a> = <a href="#80131" title="Seq[edu.berkeley.cs.scads.storage.Record]">recs</a>.<span title="=&gt; Int">size</span>
        <a href="#54413" title="(x$1: Option[Array[Byte]])Unit">lastRecvKey</a> = <a href="#80131" title="Seq[edu.berkeley.cs.scads.storage.Record]">recs</a>.<span title="=&gt; Option[edu.berkeley.cs.scads.storage.Record]">lastOption</span>.<span title="(f: edu.berkeley.cs.scads.storage.Record =&gt; Array[Byte])Option[Array[Byte]]">map</span><span class="delimiter">(</span><a href="#80136" title="edu.berkeley.cs.scads.storage.Record">_</a>.<a href="../Messages.scala.html#22202" title="=&gt; Array[Byte]">key</a><span class="delimiter">)</span> 
        <a href="#80131" title="Seq[edu.berkeley.cs.scads.storage.Record]">recs</a>.<span title="scala.collection.immutable.IndexedSeq[edu.berkeley.cs.scads.storage.Record]">toIndexedSeq</span>
      <span class="keyword">case</span> <a title="Nothing" id="80146">e</a> =&gt; <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Invalid response to a GetRangeRequest: &quot;)" class="string">&quot;Invalid response to a GetRangeRequest: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#80146" title="edu.berkeley.cs.scads.storage.StorageMessage">e</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class CursorBasedPartitionIterator extends edu.berkeley.cs.scads.storage.FutureBasedIterator with ScalaObject" id="10043">CursorBasedPartitionIterator</a><a href="#10043" title="ScalaObject" class="delimiter">(</a><a title="edu.berkeley.cs.scads.storage.PartitionService" id="69856">partitionService</a>: <a href="../Messages.scala.html#9559" title="edu.berkeley.cs.scads.storage.PartitionService">PartitionService</a>, <a title="Option[Array[Byte]]" id="69857">minKey</a>: <span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Option[Array[Byte]]" id="69858">maxKey</a>: <span title="Option[Array[Byte]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Int" id="69861">recsPerMessage</a>: <span title="Int">Int</span> = <span title="Int(8192)" class="int">8192</span><span class="delimiter">)</span> 
  <span class="keyword">extends</span> <a href="#10037" title="edu.berkeley.cs.scads.storage.FutureBasedIterator">FutureBasedIterator</a><span class="delimiter">(</span><a href="#69856" title="edu.berkeley.cs.scads.storage.PartitionService">partitionService</a>, <a href="#69857" title="Option[Array[Byte]]">minKey</a>, <a href="#69858" title="Option[Array[Byte]]">maxKey</a>, <a href="#69861" title="Int">recsPerMessage</a><span class="delimiter">)</span> <span class="delimiter">{</span>

  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Option[Int]" id="69848">cursorId</a>: <span title="Option[Int]">Option</span><span class="delimiter">[</span>Int<span class="delimiter">]</span> = <span title="object None">None</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Boolean" id="69851">isServerDone</a> = <span title="Boolean(false)" class="keyword">false</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="()edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]" id="69853">issueNextRequest</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">MessageFuture</span><span class="delimiter">[</span>StorageMessage<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.CursorScanRequest" id="80156">rec</a> = <a href="../Messages.scala.html#23224" title="(cursorId: Option[Int], recsPerRequest: Int)edu.berkeley.cs.scads.storage.CursorScanRequest">CursorScanRequest</a><span class="delimiter">(</span><a href="#69848" title="=&gt; Option[Int]">cursorId</a>, <a href="#69861" title="Int">recsPerMessage</a><span class="delimiter">)</span>
    <a href="#69856" title="edu.berkeley.cs.scads.storage.PartitionService">partitionService</a> <span title="(body: edu.berkeley.cs.scads.storage.StorageMessage)edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">!!</span> <a href="#80156" title="edu.berkeley.cs.scads.storage.CursorScanRequest">rec</a>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="69854">canRequestMore</a> = <span title="=&gt; Boolean">!</span><a href="#69851" title="=&gt; Boolean">isServerDone</a> 
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(ftch: edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage])IndexedSeq[edu.berkeley.cs.scads.storage.Record]" id="69855">getRecordsFromFuture</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]" id="70341">ftch</a>: <span title="edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">MessageFuture</span><span class="delimiter">[</span>StorageMessage<span class="delimiter">]</span><span class="delimiter">)</span> =
    <a href="#70341" title="edu.berkeley.cs.scads.comm.MessageFuture[edu.berkeley.cs.scads.storage.StorageMessage]">ftch</a>.<span title="(timeout: Long)Option[edu.berkeley.cs.scads.storage.StorageMessage]">get</span><span class="delimiter">(</span><span class="int">3</span> * <span class="int">60</span> <span title="Long(180000L)">*</span> <span class="int">1000</span><span class="delimiter">)</span>.<span title="(default: =&gt; edu.berkeley.cs.scads.storage.StorageMessage)edu.berkeley.cs.scads.storage.StorageMessage">getOrElse</span><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;CursorScanRequest timedout&quot;)" class="string">&quot;CursorScanRequest timedout&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="IndexedSeq[edu.berkeley.cs.scads.storage.Record]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="IndexedSeq[edu.berkeley.cs.scads.storage.Record]">CursorScanResponse</span><span class="delimiter">(</span><a title="Option[Int]" id="70373">id</a>, <a title="IndexedSeq[edu.berkeley.cs.scads.storage.Record]" id="70374">recs</a><span class="delimiter">)</span> =&gt;
        <a href="#69848" title="(x$1: Option[Int])Unit">cursorId</a> = <a href="#70373" title="Option[Int]">id</a>
        <a href="#69851" title="(x$1: Boolean)Unit">isServerDone</a> = <a href="#70373" title="Option[Int]">id</a>.<span title="=&gt; Boolean">isEmpty</span>
        <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="#69851" title="=&gt; Boolean">isServerDone</a> <span title="(x: Boolean)Boolean">||</span> <a href="#70374" title="IndexedSeq[edu.berkeley.cs.scads.storage.Record]">recs</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <a href="#69861" title="Int">recsPerMessage</a><span class="delimiter">)</span>
        <a href="#70374" title="IndexedSeq[edu.berkeley.cs.scads.storage.Record]">recs</a>
      <span class="keyword">case</span> <a title="Nothing" id="70384">e</a> =&gt; <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Invalid response to a CursorScanRequest: &quot;)" class="string">&quot;Invalid response to a CursorScanRequest: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#70384" title="edu.berkeley.cs.scads.storage.StorageMessage">e</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
<span class="delimiter">}</span>
        </pre>
    </body>
</html>