<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>TestOptimizer.scala</title>
        <script type="text/javascript" src="jquery-all.js"></script>
        <script type="text/javascript" src="linked.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs
<span class="keyword">package</span> scads
<span class="keyword">package</span> piql
<span class="keyword">package</span> test

<span class="keyword">import</span> exec._
<span class="keyword">import</span> debug._

<span class="keyword">import</span> avro.marker._
<span class="keyword">import</span> storage.TestScalaEngine

case <span class="keyword">class</span> <a title="class R1 extends org.apache.avro.specific.SpecificRecordBase with edu.berkeley.cs.avro.runtime.HasAvroConversions with edu.berkeley.cs.avro.marker.AvroPair with ScalaObject with Product with Serializable" id="52878">R1</a><a href="#52878" title="ScalaObject" class="delimiter">(</a><a href="#52878" title="()edu.berkeley.cs.scads.piql.test.R1" id="63185" class="keyword">var</a> <a title="Int" id="52265">f1</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="edu.berkeley.cs.avro.marker.AvroPair">AvroPair</span> <span class="delimiter">{</span>
  <span class="keyword">var</span> <a title="Int" id="51771">v</a> = <span title="Int(1)" class="int">1</span> <span class="comment">//HACK</span>
<span class="delimiter">}</span>
case <span class="keyword">class</span> <a title="class R2 extends org.apache.avro.specific.SpecificRecordBase with edu.berkeley.cs.avro.runtime.HasAvroConversions with edu.berkeley.cs.avro.marker.AvroPair with ScalaObject with Product with Serializable" id="52874">R2</a><a href="#52874" title="ScalaObject" class="delimiter">(</a><a href="#52874" title="()edu.berkeley.cs.scads.piql.test.R2" id="63195" class="keyword">var</a> <a title="Int" id="52636">f1</a>: <span title="Int">Int</span>, <span class="keyword">var</span> <a title="Int" id="52637">f2</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="edu.berkeley.cs.avro.marker.AvroPair">AvroPair</span>

<span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.test.Relations" id="9677">Relations</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.ManagedScadsCluster" id="51901">cluster</a> = <span title="object edu.berkeley.cs.scads.storage.TestScalaEngine">TestScalaEngine</span>.<span title="(numNodes: Int)edu.berkeley.cs.scads.storage.ManagedScadsCluster">newScadsCluster</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="comment">//TODO: Fix variance of namespace to remove cast</span>
  <span class="comment">//TODO: subout namespace so we don't need to invoke zookeeper etc.</span>
  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.test.R1]" id="51903">r1</a> = <a href="#51901" title="=&gt; edu.berkeley.cs.scads.storage.ManagedScadsCluster">cluster</a>.<span title="[PairType &lt;: edu.berkeley.cs.avro.marker.AvroPair](ns: String)(implicit evidence$7: Manifest[PairType])edu.berkeley.cs.scads.storage.PairNamespace[PairType]">getNamespace</span><span title="(ns: String)(implicit evidence$7: Manifest[edu.berkeley.cs.scads.piql.test.R1])edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.test.R1]" class="delimiter">[</span><a href="#52878" title="edu.berkeley.cs.scads.piql.test.R1">R1</a><span class="delimiter">]</span><span title="(clazz: Class[_])scala.reflect.Manifest[edu.berkeley.cs.scads.piql.test.R1]" class="delimiter">(</span><span title="java.lang.String(&quot;r1&quot;)" class="string">&quot;r1&quot;</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.test.R2]" id="51905">r2</a> = <a href="#51901" title="=&gt; edu.berkeley.cs.scads.storage.ManagedScadsCluster">cluster</a>.<span title="[PairType &lt;: edu.berkeley.cs.avro.marker.AvroPair](ns: String)(implicit evidence$7: Manifest[PairType])edu.berkeley.cs.scads.storage.PairNamespace[PairType]">getNamespace</span><span title="(ns: String)(implicit evidence$7: Manifest[edu.berkeley.cs.scads.piql.test.R2])edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.test.R2]" class="delimiter">[</span><a href="#52874" title="edu.berkeley.cs.scads.piql.test.R2">R2</a><span class="delimiter">]</span><span title="(clazz: Class[_])scala.reflect.Manifest[edu.berkeley.cs.scads.piql.test.R2]" class="delimiter">(</span><span title="java.lang.String(&quot;r2&quot;)" class="string">&quot;r2&quot;</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.test.R2]" id="51907">r2Prime</a> = <a href="#51901" title="=&gt; edu.berkeley.cs.scads.storage.ManagedScadsCluster">cluster</a>.<span title="[PairType &lt;: edu.berkeley.cs.avro.marker.AvroPair](ns: String)(implicit evidence$7: Manifest[PairType])edu.berkeley.cs.scads.storage.PairNamespace[PairType]">getNamespace</span><span title="(ns: String)(implicit evidence$7: Manifest[edu.berkeley.cs.scads.piql.test.R2])edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.test.R2]" class="delimiter">[</span><a href="#52874" title="edu.berkeley.cs.scads.piql.test.R2">R2</a><span class="delimiter">]</span><span title="(clazz: Class[_])scala.reflect.Manifest[edu.berkeley.cs.scads.piql.test.R2]" class="delimiter">(</span><span title="java.lang.String(&quot;r2Prime&quot;)" class="string">&quot;r2Prime&quot;</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.test.TestOptimizer" id="9679">TestOptimizer</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(args: Array[String])Unit" id="52069">main</a><span class="delimiter">(</span><a title="Array[String]" id="52071">args</a>: <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="executor extends edu.berkeley.cs.scads.piql.exec.SimpleExecutor with edu.berkeley.cs.scads.piql.debug.DebugExecutor" id="52073">executor</a> = <a href="#52080" title="edu.berkeley.cs.scads.piql.exec.SimpleExecutor with edu.berkeley.cs.scads.piql.debug.DebugExecutor" class="keyword">new</a> <a href="Iterators.scala.html#9533" title="anonymous class $anon extends edu.berkeley.cs.scads.piql.exec.SimpleExecutor with edu.berkeley.cs.scads.piql.debug.DebugExecutor" id="52080">SimpleExecutor</a> <span class="keyword">with</span> <a href="Debug.scala.html#9514" title="edu.berkeley.cs.scads.piql.debug.DebugExecutor">DebugExecutor</a>

    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.ManagedScadsCluster" id="52074">cluster</a> = <span title="object edu.berkeley.cs.scads.storage.TestScalaEngine">TestScalaEngine</span>.<span title="(numNodes: Int)edu.berkeley.cs.scads.storage.ManagedScadsCluster">newScadsCluster</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.test.R1]" id="52075">r1</a> = <a href="#52074" title="edu.berkeley.cs.scads.storage.ManagedScadsCluster">cluster</a>.<span title="[PairType &lt;: edu.berkeley.cs.avro.marker.AvroPair](ns: String)(implicit evidence$7: Manifest[PairType])edu.berkeley.cs.scads.storage.PairNamespace[PairType]">getNamespace</span><span title="(ns: String)(implicit evidence$7: Manifest[edu.berkeley.cs.scads.piql.test.R1])edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.test.R1]" class="delimiter">[</span><a href="#52878" title="edu.berkeley.cs.scads.piql.test.R1">R1</a><span class="delimiter">]</span><span title="(clazz: Class[_])scala.reflect.Manifest[edu.berkeley.cs.scads.piql.test.R1]" class="delimiter">(</span><span title="java.lang.String(&quot;r1&quot;)" class="string">&quot;r1&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.test.R2]" id="52076">r2</a> = <a href="#52074" title="edu.berkeley.cs.scads.storage.ManagedScadsCluster">cluster</a>.<span title="[PairType &lt;: edu.berkeley.cs.avro.marker.AvroPair](ns: String)(implicit evidence$7: Manifest[PairType])edu.berkeley.cs.scads.storage.PairNamespace[PairType]">getNamespace</span><span title="(ns: String)(implicit evidence$7: Manifest[edu.berkeley.cs.scads.piql.test.R2])edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.test.R2]" class="delimiter">[</span><a href="#52874" title="edu.berkeley.cs.scads.piql.test.R2">R2</a><span class="delimiter">]</span><span title="(clazz: Class[_])scala.reflect.Manifest[edu.berkeley.cs.scads.piql.test.R2]" class="delimiter">(</span><span title="java.lang.String(&quot;r2&quot;)" class="string">&quot;r2&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.test.R2]" id="52077">r2Prime</a> = <a href="#52074" title="edu.berkeley.cs.scads.storage.ManagedScadsCluster">cluster</a>.<span title="[PairType &lt;: edu.berkeley.cs.avro.marker.AvroPair](ns: String)(implicit evidence$7: Manifest[PairType])edu.berkeley.cs.scads.storage.PairNamespace[PairType]">getNamespace</span><span title="(ns: String)(implicit evidence$7: Manifest[edu.berkeley.cs.scads.piql.test.R2])edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.test.R2]" class="delimiter">[</span><a href="#52874" title="edu.berkeley.cs.scads.piql.test.R2">R2</a><span class="delimiter">]</span><span title="(clazz: Class[_])scala.reflect.Manifest[edu.berkeley.cs.scads.piql.test.R2]" class="delimiter">(</span><span title="java.lang.String(&quot;r2Prime&quot;)" class="string">&quot;r2Prime&quot;</span><span class="delimiter">)</span>

    <a href="#52075" title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.test.R1]">r1</a> <span title="(that: TraversableOnce[edu.berkeley.cs.scads.piql.test.R1])Unit">++=</span> <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">1</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <span title="Int(10)" class="int">10</span><span class="delimiter">)</span>.<span title="(f: Int =&gt; edu.berkeley.cs.scads.piql.test.R1)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[Int],edu.berkeley.cs.scads.piql.test.R1,TraversableOnce[edu.berkeley.cs.scads.piql.test.R1]])TraversableOnce[edu.berkeley.cs.scads.piql.test.R1]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq.Coll,edu.berkeley.cs.scads.piql.test.R1,scala.collection.immutable.IndexedSeq[edu.berkeley.cs.scads.piql.test.R1]]" class="delimiter">(</span><a title="Int" id="52264">i</a> =&gt; <a href="#52878" title="(f1: Int)edu.berkeley.cs.scads.piql.test.R1">R1</a><span class="delimiter">(</span><a href="#52264" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.opt.OptimizedQuery" id="52078">query</a> = <a href="package.scala.html#9714" title="(ns: edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.test.R1])edu.berkeley.cs.scads.piql.plans.Relation">r1</a>.<a href="Language.scala.html#23793" title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate)edu.berkeley.cs.scads.piql.plans.Selection">where</a><a href="package.scala.html#9723" title="toPiql extends java.lang.Object" id="52431" class="delimiter">(</a><a href="package.scala.html#9717" title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;f1&quot;</a>.<a href="package.scala.html#25077" title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</a> <a href="QueryPlan.scala.html#25004" title="(value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.plans.EqualityPredicate">===</a> <a href="package.scala.html#9719" title="implicit edu.berkeley.cs.scads.piql.package.toConstantValue : (a: Any)edu.berkeley.cs.scads.piql.plans.ConstantValue" class="int">1</a><span class="delimiter">)</span>.<a href="package.scala.html#52430" title="Option[String]" id="52432">toPiql</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="Optimizer.scala.html#24938" title="(args: Any*)edu.berkeley.cs.scads.piql.package.QueryResult">query</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">for</span><span class="delimiter">(</span><a title="Int" id="52534">i</a> &lt;- <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">1</span> <span title="(f: Int =&gt; Unit)Unit">to</span> <span title="Int(10)" class="int">10</span><span class="delimiter">)</span>; <a title="Int" id="52634">j</a> &lt;- <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">1</span> <span title="(f: Int =&gt; Unit)Unit">to</span> <span title="Int(10)" class="int">10</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.test.R2" id="52635">r</a> = <a href="#52874" title="(f1: Int, f2: Int)edu.berkeley.cs.scads.piql.test.R2">R2</a><span class="delimiter">(</span><a href="#52534" title="Int">i</a>,<a href="#52634" title="Int">j</a><span class="delimiter">)</span>
      <a href="#52076" title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.test.R2]">r2</a>.<span title="(key: org.apache.avro.generic.IndexedRecord, value: Option[org.apache.avro.generic.IndexedRecord])Unit">put</span><span class="delimiter">(</span><a href="#52635" title="edu.berkeley.cs.scads.piql.test.R2">r</a>.<span title="=&gt; org.apache.avro.generic.GenericRecord">key</span>, <a href="#52635" title="edu.berkeley.cs.scads.piql.test.R2">r</a>.<a href="package.scala.html#9720" title="(a: org.apache.avro.generic.GenericRecord)Option[org.apache.avro.generic.GenericRecord]">value</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#52076" title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.test.R2]">r2</a>.<span title="(start: Option[org.apache.avro.generic.IndexedRecord], end: Option[org.apache.avro.generic.IndexedRecord], limit: Option[Int], offset: Option[Int], ascending: Boolean)Seq[edu.berkeley.cs.scads.piql.test.R2]">getRange</span><span class="delimiter">(</span><span title="object None">None</span>,<span title="object None">None</span><span class="delimiter">)</span><span class="delimiter">)</span>
     <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.opt.OptimizedQuery" id="52079">query2</a> = <a href="package.scala.html#9714" title="(ns: edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.test.R2])edu.berkeley.cs.scads.piql.plans.Relation">r2</a>.<a href="Language.scala.html#23793" title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate)edu.berkeley.cs.scads.piql.plans.Selection">where</a><span class="delimiter">(</span><a href="package.scala.html#9717" title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;f1&quot;</a>.<a href="package.scala.html#25077" title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</a> <a href="QueryPlan.scala.html#25004" title="(value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.plans.EqualityPredicate">===</a> <a href="package.scala.html#9719" title="implicit edu.berkeley.cs.scads.piql.package.toConstantValue : (a: Any)edu.berkeley.cs.scads.piql.plans.ConstantValue" class="int">1</a><span class="delimiter">)</span>.<a href="Language.scala.html#23796" title="(parameter: edu.berkeley.cs.scads.piql.plans.ParameterValue, max: Int)edu.berkeley.cs.scads.piql.plans.StopAfter">limit</a><a href="package.scala.html#9723" title="toPiql extends java.lang.Object" id="52683" class="delimiter">(</a><a href="package.scala.html#9718" title="implicit edu.berkeley.cs.scads.piql.package.toParameter : (o: Double)java.lang.Object{def ?: edu.berkeley.cs.scads.piql.plans.ParameterValue}" class="double">0.</a><a href="package.scala.html#25045" title="=&gt; edu.berkeley.cs.scads.piql.plans.ParameterValue">?</a>, <span title="Int(10)" class="int">10</span><span class="delimiter">)</span>.<a href="package.scala.html#52430" title="Option[String]" id="52684">toPiql</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="Optimizer.scala.html#24938" title="(args: Any*)edu.berkeley.cs.scads.piql.package.QueryResult">query2</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="Optimizer.scala.html#24938" title="(args: Any*)edu.berkeley.cs.scads.piql.package.QueryResult">query2</a><span class="delimiter">(</span><span title="Int(2)" class="int">2</span><span class="delimiter">)</span><span class="delimiter">)</span>


    <span title="object java.lang.System">System</span>.<span title="(x$1: Int)Unit">exit</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>