<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>Optimizer.scala</title>
        <script type="text/javascript" src="jquery-all.js"></script>
        <script type="text/javascript" src="linked.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs
<span class="keyword">package</span> scads
<span class="keyword">package</span> piql

<span class="keyword">import</span> storage._

<span class="keyword">import</span> org.apache.avro.Schema
<span class="keyword">import</span> org.apache.avro.<span title="object org.apache.avro.Schema">Schema</span>.Field
<span class="keyword">import</span> org.apache.avro.util.Utf8
<span class="keyword">import</span> scala.collection.<span title="object scala.collection.JavaConversions">JavaConversions</span>._
<span class="keyword">import</span> net.lag.logging.Logger

case <span class="keyword">class</span> <a title="class ImplementationLimitation extends java.lang.Exception with ScalaObject with Product with Serializable" id="50416">ImplementationLimitation</a><a href="#50416" title="ScalaObject" class="delimiter">(</a><a title="String" id="50413">desc</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="java.lang.Exception">Exception</span>

<span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.OptimizedQuery" id="9565">OptimizedQuery</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentHashMap[Int,edu.berkeley.cs.scads.piql.QueryPlan]" id="45097">physicalPlans</a> = <span title="()java.util.concurrent.ConcurrentHashMap[Int,edu.berkeley.cs.scads.piql.QueryPlan]" class="keyword">new</span> java.util.concurrent.<span title="java.util.concurrent.ConcurrentHashMap[Int,edu.berkeley.cs.scads.piql.QueryPlan]">ConcurrentHashMap</span><span class="delimiter">[</span>Int, QueryPlan<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class OptimizedQuery extends java.lang.Object with ScalaObject" id="9567">OptimizedQuery</a><a href="#9567" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="Option[String]" id="23985">name</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.QueryPlan" id="23986">physicalPlan</a>: <a href="QueryPlan.scala.html#9610" title="edu.berkeley.cs.scads.piql.QueryPlan">QueryPlan</a>, <a title="edu.berkeley.cs.scads.piql.QueryExecutor" id="23987">executor</a>: <a href="Iterators.scala.html#9525" title="edu.berkeley.cs.scads.piql.QueryExecutor">QueryExecutor</a><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(args: Any*)edu.berkeley.cs.scads.piql.package.QueryResult" id="23983">apply</a><span class="delimiter">(</span><a title="Any*" id="45422">args</a>: <span title="Any*">Any</span>*<span class="delimiter">)</span>: <span title="edu.berkeley.cs.scads.piql.package.QueryResult">QueryResult</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Seq[Any]" id="45424">encodedArgs</a> = <a href="#45422" title="Any*">args</a>.<span title="(f: Any =&gt; Any)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[Any],Any,Seq[Any]])Seq[Any]">map</span> <a href="#45443" title="Any" class="delimiter">{</a>
      <span class="keyword">case</span> <a title="org.apache.avro.util.Utf8" id="45444">s</a>: <span title="String">String</span> =&gt; <span title="(x$1: java.lang.String)org.apache.avro.util.Utf8" class="keyword">new</span> <span title="org.apache.avro.util.Utf8">Utf8</span><span class="delimiter">(</span><a href="#45444" title="String">s</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="Any" id="45449">o</a> =&gt; <a href="#45449" title="Any">o</a>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.QueryIterator" id="45425">iterator</a> = <a href="Iterators.scala.html#28597" title="(plan: edu.berkeley.cs.scads.piql.QueryPlan, args: Any*)edu.berkeley.cs.scads.piql.QueryIterator">executor</a><span class="delimiter">(</span><a href="#23986" title="=&gt; edu.berkeley.cs.scads.piql.QueryPlan">physicalPlan</a>, <a href="#45424" title="Seq[Any]">encodedArgs</a>: _*<span class="delimiter">)</span>
    <a href="#45425" title="edu.berkeley.cs.scads.piql.QueryIterator">iterator</a>.<a href="Iterators.scala.html#28848" title="=&gt; Unit">open</a>
    <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Tuple]" id="45426">ret</a> = <a href="#45425" title="edu.berkeley.cs.scads.piql.QueryIterator">iterator</a>.<span title="=&gt; List[edu.berkeley.cs.scads.piql.package.Tuple]">toList</span>
    <a href="#45425" title="edu.berkeley.cs.scads.piql.QueryIterator">iterator</a>.<a href="Iterators.scala.html#28849" title="=&gt; Unit">close</a>
    <a href="#45426" title="List[edu.berkeley.cs.scads.piql.package.Tuple]">ret</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; scala.xml.NodeSeq" id="23984">toHtml</a>: xml.<span title="scala.xml.NodeSeq">NodeSeq</span> = <span class="delimiter">{</span>
    &lt;<a title="scala.xml.Elem" id="46272">b</a>&gt;<span class="delimiter">{</span><a href="#23986" title="=&gt; edu.berkeley.cs.scads.piql.QueryPlan">physicalPlan</a><span class="delimiter">}</span>&lt;/b&gt;
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.Optimizer" id="9568">Optimizer</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="23932">logger</a> = <span title="()net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="Int" id="23934">defaultFetchSize</a> = <span title="Int(10)" class="int">10</span>

  case <span class="keyword">class</span> <a title="class OptimizedSubPlan extends java.lang.Object with ScalaObject with Product with Serializable" id="50409">OptimizedSubPlan</a><a href="#50409" title="ScalaObject" class="delimiter">(</a><a title="edu.berkeley.cs.scads.piql.QueryPlan" id="46779">physicalPlan</a>: <a href="QueryPlan.scala.html#9610" title="edu.berkeley.cs.scads.piql.QueryPlan">QueryPlan</a>, <a title="edu.berkeley.cs.scads.piql.package.TupleSchema" id="46780">schema</a>: <span title="edu.berkeley.cs.scads.piql.package.TupleSchema">TupleSchema</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(logicalPlan: edu.berkeley.cs.scads.piql.Queryable)edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan" id="23939">apply</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Queryable" id="23959">logicalPlan</a>: <a href="LogicalPlan.scala.html#9532" title="edu.berkeley.cs.scads.piql.Queryable">Queryable</a><span class="delimiter">)</span>: <a href="#50409" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a> = <span class="delimiter">{</span>
    <a href="#23932" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Optimizing subplan: %s&quot;)" class="string">&quot;Optimizing subplan: %s&quot;</span>, <a href="#23959" title="edu.berkeley.cs.scads.piql.Queryable">logicalPlan</a><span class="delimiter">)</span>

    <a href="#23959" title="edu.berkeley.cs.scads.piql.Queryable">logicalPlan</a> <span title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#46689" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">IndexRange</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]" id="46693">equalityPreds</a>, <span title="object None">None</span>, <span title="object None">None</span>, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="46710">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#46693" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <a href="#46710" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="()java.util.List[org.apache.avro.Schema.Field]">getFields</span>.<span title="()Int">size</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
        <a href="#23941" title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean">isPrefix</a><span class="delimiter">(</span><a href="#46693" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#46740" title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">_</a>.<a href="#49931" title="=&gt; edu.berkeley.cs.scads.piql.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25033" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span>, <a href="#46710" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="46774">tupleSchema</a> = <a href="#46710" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#46775" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>
        <a href="#50409" title="(physicalPlan: edu.berkeley.cs.scads.piql.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span>
          <a href="QueryPlan.scala.html#32104" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, key: edu.berkeley.cs.scads.piql.package.KeyGenerator)edu.berkeley.cs.scads.piql.IndexLookup">IndexLookup</a><span class="delimiter">(</span><a href="#46710" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#23947" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#46710" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#46774" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#46693" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span><span class="delimiter">)</span>,
          <a href="#46774" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#46689" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">IndexRange</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]" id="46798">equalityPreds</a>, Some<span class="delimiter">(</span>TupleLimit<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Limit" id="46829">count</a>, <a title="Boolean" id="46830">dataStop</a><span class="delimiter">)</span><span class="delimiter">)</span>, <span title="object None">None</span>, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="46831">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan" class="keyword">if</span> <span class="delimiter">(</span><a href="#23941" title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean">isPrefix</a><span class="delimiter">(</span><a href="#46798" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#46848" title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">_</a>.<a href="#49931" title="=&gt; edu.berkeley.cs.scads.piql.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25033" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span>, <a href="#46831" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#23932" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Using primary index for predicates: %s&quot;)" class="string">&quot;Using primary index for predicates: %s&quot;</span>, <a href="#46798" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="46868">tupleSchema</a> = <a href="#46831" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#46875" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>
          <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.IndexScan" id="46869">idxScanPlan</a> = <a href="QueryPlan.scala.html#33212" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.Limit, ascending: Boolean)edu.berkeley.cs.scads.piql.IndexScan">IndexScan</a><span class="delimiter">(</span><a href="#46831" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#23947" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#46831" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#46868" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#46798" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>, <a href="#46829" title="edu.berkeley.cs.scads.piql.Limit">count</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="&lt;none&gt; extends Product with Serializable with edu.berkeley.cs.scads.piql.QueryPlan" id="46870">fullPlan</a> = <a href="#46830" title="Boolean">dataStop</a> <span title="&lt;none&gt; extends Product with Serializable with edu.berkeley.cs.scads.piql.QueryPlan" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.IndexScan" class="keyword">true</span> =&gt; <a href="#46869" title="edu.berkeley.cs.scads.piql.IndexScan">idxScanPlan</a>
            <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.LocalStopAfter" class="keyword">false</span> =&gt; <a href="QueryPlan.scala.html#37369" title="(count: edu.berkeley.cs.scads.piql.Limit, child: edu.berkeley.cs.scads.piql.QueryPlan)edu.berkeley.cs.scads.piql.LocalStopAfter">LocalStopAfter</a><span class="delimiter">(</span><a href="#46829" title="edu.berkeley.cs.scads.piql.Limit">count</a>, <a href="#46869" title="edu.berkeley.cs.scads.piql.IndexScan">idxScanPlan</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <a href="#50409" title="(physicalPlan: edu.berkeley.cs.scads.piql.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span><a href="#46870" title="&lt;none&gt; extends Product with Serializable with edu.berkeley.cs.scads.piql.QueryPlan">fullPlan</a>, <a href="#46868" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#23932" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Using secondary index for predicates: %s&quot;)" class="string">&quot;Using secondary index for predicates: %s&quot;</span>, <a href="#46798" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>

          <span class="comment">//TODO: Fix type hack</span>
          <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.IndexNamespace" id="46913">idx</a> = <a href="#46831" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.piql.package.IndexedNamespace" class="delimiter">[</span><a href="package.scala.html#46922" title="edu.berkeley.cs.scads.piql.package.IndexedNamespace">IndexedNamespace</a><span class="delimiter">]</span>.<span title="(fields: Seq[edu.berkeley.cs.scads.storage.IndexType])edu.berkeley.cs.scads.storage.IndexNamespace">getOrCreateIndex</span><span class="delimiter">(</span><a href="#46798" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality =&gt; edu.berkeley.cs.scads.storage.AttributeIndex)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality],edu.berkeley.cs.scads.storage.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.IndexType]])Seq[edu.berkeley.cs.scads.storage.IndexType]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.storage.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.AttributeIndex]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality" id="46937">p</a> =&gt; <span title="(fieldName: String)edu.berkeley.cs.scads.storage.AttributeIndex">AttributeIndex</span><span class="delimiter">(</span><a href="#46937" title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">p</a>.<a href="#49931" title="=&gt; edu.berkeley.cs.scads.piql.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25033" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="46914">tupleSchema</a> = <a href="#46913" title="edu.berkeley.cs.scads.storage.IndexNamespace">idx</a> <a href="#47034" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <a href="#46831" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#47035" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>
          <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.IndexScan" id="46915">idxScanPlan</a> = <a href="QueryPlan.scala.html#33212" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.Limit, ascending: Boolean)edu.berkeley.cs.scads.piql.IndexScan">IndexScan</a><span class="delimiter">(</span><a href="#46913" title="edu.berkeley.cs.scads.storage.IndexNamespace">idx</a>, <a href="#23947" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#46913" title="edu.berkeley.cs.scads.storage.IndexNamespace">idx</a>, <a href="#46914" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#46798" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>, <a href="#46829" title="edu.berkeley.cs.scads.piql.Limit">count</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.QueryPlan" id="46916">derefedPlan</a> = <a href="#23940" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, idxPlan: edu.berkeley.cs.scads.piql.RemotePlan)edu.berkeley.cs.scads.piql.QueryPlan">derefPlan</a><span class="delimiter">(</span><a href="#46831" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#46915" title="edu.berkeley.cs.scads.piql.IndexScan">idxScanPlan</a><span class="delimiter">)</span>

          <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.QueryPlan" id="46917">fullPlan</a> = <a href="#46830" title="Boolean">dataStop</a> <span title="edu.berkeley.cs.scads.piql.QueryPlan" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.QueryPlan" class="keyword">true</span> =&gt; <a href="#46916" title="edu.berkeley.cs.scads.piql.QueryPlan">derefedPlan</a>
            <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.LocalStopAfter" class="keyword">false</span> =&gt; <a href="QueryPlan.scala.html#37369" title="(count: edu.berkeley.cs.scads.piql.Limit, child: edu.berkeley.cs.scads.piql.QueryPlan)edu.berkeley.cs.scads.piql.LocalStopAfter">LocalStopAfter</a><span class="delimiter">(</span><a href="#46829" title="edu.berkeley.cs.scads.piql.Limit">count</a>, <a href="#46916" title="edu.berkeley.cs.scads.piql.QueryPlan">derefedPlan</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <a href="#50409" title="(physicalPlan: edu.berkeley.cs.scads.piql.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span><a href="#46917" title="edu.berkeley.cs.scads.piql.QueryPlan">fullPlan</a>, <a href="#46914" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#46689" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">IndexRange</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]" id="47052">equalityPreds</a>, <a title="Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit]" id="47053">bound</a>, Some<span class="delimiter">(</span>Ordering<span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue]" id="47088">attrs</a>, <a title="Boolean" id="47089">asc</a><span class="delimiter">)</span><span class="delimiter">)</span>, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="47090">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.Limit" id="47091">limitHint</a> = <a href="#47053" title="Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit]">bound</a>.<span title="(f: edu.berkeley.cs.scads.piql.Optimizer.TupleLimit =&gt; edu.berkeley.cs.scads.piql.Limit)Option[edu.berkeley.cs.scads.piql.Limit]">map</span><span class="delimiter">(</span><a href="#47102" title="edu.berkeley.cs.scads.piql.Optimizer.TupleLimit">_</a>.<a href="#49672" title="=&gt; edu.berkeley.cs.scads.piql.Limit">count</a><span class="delimiter">)</span>.<span title="(default: =&gt; edu.berkeley.cs.scads.piql.Limit)edu.berkeley.cs.scads.piql.Limit">getOrElse</span> <span class="delimiter">{</span>
            <a href="#23932" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;UnboundedPlan %s: %s&quot;)" class="string">&quot;UnboundedPlan %s: %s&quot;</span>, <a href="#47090" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#23959" title="edu.berkeley.cs.scads.piql.Queryable">logicalPlan</a><span class="delimiter">)</span>
            <a href="QueryPlan.scala.html#31664" title="(count: Int)edu.berkeley.cs.scads.piql.FixedLimit">FixedLimit</a><span class="delimiter">(</span><a href="#23934" title="=&gt; Int">defaultFetchSize</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">val</span> <a title="Boolean" id="47092">isDataStop</a> = <a href="#47053" title="Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit]">bound</a>.<span title="(f: edu.berkeley.cs.scads.piql.Optimizer.TupleLimit =&gt; Boolean)Option[Boolean]">map</span><span class="delimiter">(</span><a href="#47117" title="edu.berkeley.cs.scads.piql.Optimizer.TupleLimit">_</a>.<a href="#49673" title="=&gt; Boolean">isDataStop</a><span class="delimiter">)</span>.<span title="(default: =&gt; Boolean)Boolean">getOrElse</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Seq[String]" id="47093">prefixAttrs</a> = <a href="#47052" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#47140" title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">_</a>.<a href="#49931" title="=&gt; edu.berkeley.cs.scads.piql.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25033" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span> <span title="(that: scala.collection.GenTraversableOnce[String])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],String,Seq[String]])Seq[String]">++</span> <a href="#47088" title="Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue]">attrs</a>.<span title="(f: edu.berkeley.cs.scads.piql.UnboundAttributeValue =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#47203" title="edu.berkeley.cs.scads.piql.UnboundAttributeValue">_</a>.<a href="QueryPlan.scala.html#25033" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a href="#47095" title="(edu.berkeley.cs.scads.piql.QueryPlan, List[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</a><a href="#47094" title="edu.berkeley.cs.scads.piql.QueryPlan" id="47095">idxScanPlan</a>, <a href="#47094" title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="47096">tupleSchema</a><span class="delimiter">)</span> =
          <span title="(edu.berkeley.cs.scads.piql.QueryPlan, List[edu.berkeley.cs.scads.piql.package.Namespace])" class="keyword">if</span> <span class="delimiter">(</span><a href="#23941" title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean">isPrefix</a><span class="delimiter">(</span><a href="#47093" title="Seq[String]">prefixAttrs</a>, <a href="#47090" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="47242">tupleSchema</a> = <a href="#47090" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#47243" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>
            <span title="(_1: edu.berkeley.cs.scads.piql.IndexScan, _2: List[edu.berkeley.cs.scads.piql.package.Namespace])(edu.berkeley.cs.scads.piql.IndexScan, List[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</span><a href="QueryPlan.scala.html#33212" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.Limit, ascending: Boolean)edu.berkeley.cs.scads.piql.IndexScan">IndexScan</a><span class="delimiter">(</span><a href="#47090" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#23947" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#47090" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#47242" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#47052" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>, <a href="#47091" title="edu.berkeley.cs.scads.piql.Limit">limitHint</a>, <a href="#47089" title="Boolean">asc</a><span class="delimiter">)</span>, <a href="#47242" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <span class="keyword">else</span> <span class="delimiter">{</span>
	    <a href="#23932" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Creating index for attributes: %s&quot;)" class="string">&quot;Creating index for attributes: %s&quot;</span>, <a href="#47093" title="Seq[String]">prefixAttrs</a><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.IndexNamespace" id="47266">idx</a> = <a href="#47090" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.piql.package.IndexedNamespace" class="delimiter">[</span><a href="package.scala.html#46922" title="edu.berkeley.cs.scads.piql.package.IndexedNamespace">IndexedNamespace</a><span class="delimiter">]</span>.<span title="(fields: Seq[edu.berkeley.cs.scads.storage.IndexType])edu.berkeley.cs.scads.storage.IndexNamespace">getOrCreateIndex</span><span class="delimiter">(</span><a href="#47093" title="Seq[String]">prefixAttrs</a>.<span title="(f: String =&gt; edu.berkeley.cs.scads.storage.AttributeIndex)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],edu.berkeley.cs.scads.storage.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.IndexType]])Seq[edu.berkeley.cs.scads.storage.IndexType]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.storage.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.AttributeIndex]]" class="delimiter">(</span><a title="String" id="47288">p</a> =&gt; <span title="(fieldName: String)edu.berkeley.cs.scads.storage.AttributeIndex">AttributeIndex</span><span class="delimiter">(</span><a href="#47288" title="String">p</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="47267">tupleSchema</a> = <a href="#47266" title="edu.berkeley.cs.scads.storage.IndexNamespace">idx</a> <a href="#47310" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <a href="#47090" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#47311" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>
            <span title="(_1: edu.berkeley.cs.scads.piql.QueryPlan, _2: List[edu.berkeley.cs.scads.piql.package.Namespace])(edu.berkeley.cs.scads.piql.QueryPlan, List[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</span><a href="#23940" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, idxPlan: edu.berkeley.cs.scads.piql.RemotePlan)edu.berkeley.cs.scads.piql.QueryPlan">derefPlan</a><span class="delimiter">(</span><a href="#47090" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>,
              <a href="QueryPlan.scala.html#33212" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.Limit, ascending: Boolean)edu.berkeley.cs.scads.piql.IndexScan">IndexScan</a><span class="delimiter">(</span><a href="#47266" title="edu.berkeley.cs.scads.storage.IndexNamespace">idx</a>,
                <a href="#23947" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#47266" title="edu.berkeley.cs.scads.storage.IndexNamespace">idx</a>, <a href="#47267" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#47052" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>,
                <a href="#47091" title="edu.berkeley.cs.scads.piql.Limit">limitHint</a>,
                <a href="#47089" title="Boolean">asc</a><span class="delimiter">)</span><span class="delimiter">)</span>,
              <a href="#47267" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.QueryPlan" id="47097">fullPlan</a> = <a href="#47092" title="Boolean">isDataStop</a> <span title="edu.berkeley.cs.scads.piql.QueryPlan" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.QueryPlan" class="keyword">true</span> =&gt; <a href="#47095" title="edu.berkeley.cs.scads.piql.QueryPlan">idxScanPlan</a>
          <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.LocalStopAfter" class="keyword">false</span> =&gt; <a href="QueryPlan.scala.html#37369" title="(count: edu.berkeley.cs.scads.piql.Limit, child: edu.berkeley.cs.scads.piql.QueryPlan)edu.berkeley.cs.scads.piql.LocalStopAfter">LocalStopAfter</a><span class="delimiter">(</span><a href="#47091" title="edu.berkeley.cs.scads.piql.Limit">limitHint</a>, <a href="#47095" title="edu.berkeley.cs.scads.piql.QueryPlan">idxScanPlan</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#50409" title="(physicalPlan: edu.berkeley.cs.scads.piql.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span><a href="#47097" title="edu.berkeley.cs.scads.piql.QueryPlan">fullPlan</a>, <a href="#47096" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#46689" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">IndexRange</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]" id="47341">equalityPreds</a>, <span title="object None">None</span>, <span title="object None">None</span>, Join<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Queryable" id="47342">child</a>, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="47343">ns</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#47341" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <a href="#47343" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="()java.util.List[org.apache.avro.Schema.Field]">getFields</span>.<span title="()Int">size</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
        <a href="#23941" title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean">isPrefix</a><span class="delimiter">(</span><a href="#47341" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#47366" title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">_</a>.<a href="#49931" title="=&gt; edu.berkeley.cs.scads.piql.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25033" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span>, <a href="#47343" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan" id="47386">optChild</a> = <a href="#23939" title="(logicalPlan: edu.berkeley.cs.scads.piql.Queryable)edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">apply</a><span class="delimiter">(</span><a href="#47342" title="edu.berkeley.cs.scads.piql.Queryable">child</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]" id="47387">tupleSchema</a> = <a href="#47386" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#46780" title="=&gt; edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a> <span title="(elem: edu.berkeley.cs.scads.piql.package.Namespace)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.package.Namespace],edu.berkeley.cs.scads.piql.package.Namespace,Seq[edu.berkeley.cs.scads.piql.package.Namespace]])Seq[edu.berkeley.cs.scads.piql.package.Namespace]">:+</span> <a href="#47343" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>
        <a href="#50409" title="(physicalPlan: edu.berkeley.cs.scads.piql.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span>
          <a href="QueryPlan.scala.html#33746" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, key: edu.berkeley.cs.scads.piql.package.KeyGenerator, child: edu.berkeley.cs.scads.piql.QueryPlan)edu.berkeley.cs.scads.piql.IndexLookupJoin">IndexLookupJoin</a><span class="delimiter">(</span><a href="#47343" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#23947" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#47343" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#47387" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#47341" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>, <a href="#47386" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#46779" title="=&gt; edu.berkeley.cs.scads.piql.QueryPlan">physicalPlan</a><span class="delimiter">)</span>,
          <a href="#47387" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#46689" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">IndexRange</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]" id="47435">equalityPreds</a>, Some<span class="delimiter">(</span>TupleLimit<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Limit" id="47437">count</a>, <a title="Boolean" id="47438">dataStop</a><span class="delimiter">)</span><span class="delimiter">)</span>, Some<span class="delimiter">(</span>Ordering<span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue]" id="47440">attrs</a>, <a title="Boolean" id="47441">asc</a><span class="delimiter">)</span><span class="delimiter">)</span>, Join<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Queryable" id="47442">child</a>, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="47443">ns</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Seq[String]" id="47444">prefixAttrs</a> = <a href="#47435" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#47466" title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">_</a>.<a href="#49931" title="=&gt; edu.berkeley.cs.scads.piql.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25033" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span> <span title="(that: scala.collection.GenTraversableOnce[String])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],String,Seq[String]])Seq[String]">++</span> <a href="#47440" title="Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue]">attrs</a>.<span title="(f: edu.berkeley.cs.scads.piql.UnboundAttributeValue =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#47525" title="edu.berkeley.cs.scads.piql.UnboundAttributeValue">_</a>.<a href="QueryPlan.scala.html#25033" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan" id="47445">optChild</a> = <a href="#23939" title="(logicalPlan: edu.berkeley.cs.scads.piql.Queryable)edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">apply</a><span class="delimiter">(</span><a href="#47442" title="edu.berkeley.cs.scads.piql.Queryable">child</a><span class="delimiter">)</span>

        <span class="keyword">val</span> <a href="#47447" title="(edu.berkeley.cs.scads.piql.QueryPlan, Seq[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</a><a href="#47446" title="edu.berkeley.cs.scads.piql.QueryPlan" id="47447">joinPlan</a>, <a href="#47446" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]" id="47448">tupleSchema</a><span class="delimiter">)</span> =
          <span title="(edu.berkeley.cs.scads.piql.QueryPlan, Seq[edu.berkeley.cs.scads.piql.package.Namespace])" class="keyword">if</span> <span class="delimiter">(</span><a href="#23941" title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean">isPrefix</a><span class="delimiter">(</span><a href="#47444" title="Seq[String]">prefixAttrs</a>, <a href="#47443" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]" id="47564">tupleSchema</a> = <a href="#47445" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#46780" title="=&gt; edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a> <span title="(elem: edu.berkeley.cs.scads.piql.package.Namespace)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.package.Namespace],edu.berkeley.cs.scads.piql.package.Namespace,Seq[edu.berkeley.cs.scads.piql.package.Namespace]])Seq[edu.berkeley.cs.scads.piql.package.Namespace]">:+</span> <a href="#47443" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>
	    <a href="#23932" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Using index special orders for %s&quot;)" class="string">&quot;Using index special orders for %s&quot;</span>, <a href="#47440" title="Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue]">attrs</a><span class="delimiter">)</span>

            <span title="(_1: edu.berkeley.cs.scads.piql.IndexMergeJoin, _2: Seq[edu.berkeley.cs.scads.piql.package.Namespace])(edu.berkeley.cs.scads.piql.IndexMergeJoin, Seq[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</span><a href="QueryPlan.scala.html#34302" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, sortFields: Seq[edu.berkeley.cs.scads.piql.Value], limit: edu.berkeley.cs.scads.piql.Limit, ascending: Boolean, child: edu.berkeley.cs.scads.piql.QueryPlan)edu.berkeley.cs.scads.piql.IndexMergeJoin">IndexMergeJoin</a><span class="delimiter">(</span><a href="#47443" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>,
              <a href="#23947" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#47443" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#47564" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#47435" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>,
              <a href="#47440" title="Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue]">attrs</a>.<span title="(f: edu.berkeley.cs.scads.piql.UnboundAttributeValue =&gt; edu.berkeley.cs.scads.piql.Value)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue],edu.berkeley.cs.scads.piql.Value,Seq[edu.berkeley.cs.scads.piql.Value]])Seq[edu.berkeley.cs.scads.piql.Value]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.piql.Value,Seq[edu.berkeley.cs.scads.piql.Value]]" class="delimiter">(</span><a href="#23946" title="(value: edu.berkeley.cs.scads.piql.Value, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Value">bindValue</a><span class="delimiter">(</span><a href="#47638" title="edu.berkeley.cs.scads.piql.UnboundAttributeValue">_</a>, <a href="#47564" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span><span class="delimiter">)</span>,
              <a href="#47437" title="edu.berkeley.cs.scads.piql.Limit">count</a>,
              <a href="#47441" title="Boolean">asc</a>,
              <a href="#47445" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#46779" title="=&gt; edu.berkeley.cs.scads.piql.QueryPlan">physicalPlan</a><span class="delimiter">)</span>,
              <a href="#47564" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.IndexNamespace" id="47665">idx</a> = <a href="#47443" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.piql.package.IndexedNamespace" class="delimiter">[</span><a href="package.scala.html#46922" title="edu.berkeley.cs.scads.piql.package.IndexedNamespace">IndexedNamespace</a><span class="delimiter">]</span>.<span title="(fields: Seq[edu.berkeley.cs.scads.storage.IndexType])edu.berkeley.cs.scads.storage.IndexNamespace">getOrCreateIndex</span><span class="delimiter">(</span><a href="#47444" title="Seq[String]">prefixAttrs</a>.<span title="(f: String =&gt; edu.berkeley.cs.scads.storage.AttributeIndex)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],edu.berkeley.cs.scads.storage.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.IndexType]])Seq[edu.berkeley.cs.scads.storage.IndexType]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.storage.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.AttributeIndex]]" class="delimiter">(</span><a title="String" id="47684">p</a> =&gt; <span title="(fieldName: String)edu.berkeley.cs.scads.storage.AttributeIndex">AttributeIndex</span><span class="delimiter">(</span><a href="#47684" title="String">p</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="47666">tupleSchema</a> = <a href="#47665" title="edu.berkeley.cs.scads.storage.IndexNamespace">idx</a> <a href="#47706" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <a href="#47443" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#47707" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>

            <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.IndexScanJoin" id="47667">idxJoinPlan</a> = <a href="QueryPlan.scala.html#47727" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.Limit, ascending: Boolean, child: edu.berkeley.cs.scads.piql.QueryPlan)edu.berkeley.cs.scads.piql.IndexScanJoin">IndexScanJoin</a><span class="delimiter">(</span><a href="#47665" title="edu.berkeley.cs.scads.storage.IndexNamespace">idx</a>,
              <a href="#23947" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#47665" title="edu.berkeley.cs.scads.storage.IndexNamespace">idx</a>, <a href="#47666" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#47435" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>,
              <a href="#47437" title="edu.berkeley.cs.scads.piql.Limit">count</a>,
              <a href="#47441" title="Boolean">asc</a>,
              <a href="#47445" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#46779" title="=&gt; edu.berkeley.cs.scads.piql.QueryPlan">physicalPlan</a><span class="delimiter">)</span>
            <span title="(_1: edu.berkeley.cs.scads.piql.QueryPlan, _2: List[edu.berkeley.cs.scads.piql.package.Namespace])(edu.berkeley.cs.scads.piql.QueryPlan, List[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</span><a href="#23940" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, idxPlan: edu.berkeley.cs.scads.piql.RemotePlan)edu.berkeley.cs.scads.piql.QueryPlan">derefPlan</a><span class="delimiter">(</span><a href="#47443" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#47667" title="edu.berkeley.cs.scads.piql.IndexScanJoin">idxJoinPlan</a><span class="delimiter">)</span>, <a href="#47666" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.QueryPlan" id="47449">fullPlan</a> = <a href="#47438" title="Boolean">dataStop</a> <span title="edu.berkeley.cs.scads.piql.QueryPlan" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.QueryPlan" class="keyword">true</span> =&gt; <a href="#47447" title="edu.berkeley.cs.scads.piql.QueryPlan">joinPlan</a>
          <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.LocalStopAfter" class="keyword">false</span> =&gt; <a href="QueryPlan.scala.html#37369" title="(count: edu.berkeley.cs.scads.piql.Limit, child: edu.berkeley.cs.scads.piql.QueryPlan)edu.berkeley.cs.scads.piql.LocalStopAfter">LocalStopAfter</a><span class="delimiter">(</span><a href="#47437" title="edu.berkeley.cs.scads.piql.Limit">count</a>, <a href="#47447" title="edu.berkeley.cs.scads.piql.QueryPlan">joinPlan</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <a href="#50409" title="(physicalPlan: edu.berkeley.cs.scads.piql.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span><a href="#47449" title="edu.berkeley.cs.scads.piql.QueryPlan">fullPlan</a>, <a href="#47448" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">Selection</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Predicate" id="47813">pred</a>, <a title="edu.berkeley.cs.scads.piql.Queryable" id="47814">child</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan" id="47815">optChild</a> = <a href="#23939" title="(logicalPlan: edu.berkeley.cs.scads.piql.Queryable)edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">apply</a><span class="delimiter">(</span><a href="#47814" title="edu.berkeley.cs.scads.piql.Queryable">child</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.Predicate" id="47816">boundPred</a> = <a href="#23943" title="(predicate: edu.berkeley.cs.scads.piql.Predicate, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Predicate">bindPredicate</a><span class="delimiter">(</span><a href="#47813" title="edu.berkeley.cs.scads.piql.Predicate">pred</a>, <a href="#47815" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#46780" title="=&gt; edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span>
        <a href="#47815" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#50409" title="(physicalPlan: edu.berkeley.cs.scads.piql.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">copy</a><span class="delimiter">(</span>physicalPlan = <a href="QueryPlan.scala.html#37131" title="(predicate: edu.berkeley.cs.scads.piql.Predicate, child: edu.berkeley.cs.scads.piql.QueryPlan)edu.berkeley.cs.scads.piql.LocalSelection">LocalSelection</a><span class="delimiter">(</span><a href="#47816" title="edu.berkeley.cs.scads.piql.Predicate">boundPred</a>, <a href="#47815" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#46779" title="=&gt; edu.berkeley.cs.scads.piql.QueryPlan">physicalPlan</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, idxPlan: edu.berkeley.cs.scads.piql.RemotePlan)edu.berkeley.cs.scads.piql.QueryPlan" id="23940">derefPlan</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="47044">ns</a>: <a href="package.scala.html#25139" title="edu.berkeley.cs.scads.piql.package.Namespace">Namespace</a>, <a title="edu.berkeley.cs.scads.piql.RemotePlan" id="47045">idxPlan</a>: <a href="QueryPlan.scala.html#9611" title="edu.berkeley.cs.scads.piql.RemotePlan">RemotePlan</a><span class="delimiter">)</span>: <a href="QueryPlan.scala.html#9610" title="edu.berkeley.cs.scads.piql.QueryPlan">QueryPlan</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.util.List[org.apache.avro.Schema.Field]" id="47827">keyFields</a> = <a href="#47044" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="()java.util.List[org.apache.avro.Schema.Field]">getFields</span>
    <span class="keyword">val</span> <a title="Seq[org.apache.avro.Schema.Field]" id="47828">idxFields</a> = <a href="#23942" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace)Seq[org.apache.avro.Schema.Field]">getFields</a><span class="delimiter">(</span><a href="#47045" title="edu.berkeley.cs.scads.piql.RemotePlan">idxPlan</a>.<a href="QueryPlan.scala.html#33214" title="=&gt; edu.berkeley.cs.scads.piql.package.Namespace">namespace</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.AttributeValue]" id="47829">keyGenerator</a> = <a href="#47827" title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">keyFields</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; edu.berkeley.cs.scads.piql.AttributeValue)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[org.apache.avro.Schema.Field],edu.berkeley.cs.scads.piql.AttributeValue,scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.AttributeValue]])scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.AttributeValue]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,edu.berkeley.cs.scads.piql.AttributeValue,scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.AttributeValue]]" class="delimiter">(</span><a title="org.apache.avro.Schema.Field" id="48284">kf</a> =&gt; <a href="QueryPlan.scala.html#29433" title="(recordPosition: Int, fieldPosition: Int)edu.berkeley.cs.scads.piql.AttributeValue">AttributeValue</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#47828" title="Seq[org.apache.avro.Schema.Field]">idxFields</a>.<span title="(p: org.apache.avro.Schema.Field =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#48300" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span> <span title="(x$1: Any)Boolean">equals</span> <a href="#48284" title="org.apache.avro.Schema.Field">kf</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="QueryPlan.scala.html#33746" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, key: edu.berkeley.cs.scads.piql.package.KeyGenerator, child: edu.berkeley.cs.scads.piql.QueryPlan)edu.berkeley.cs.scads.piql.IndexLookupJoin">IndexLookupJoin</a><span class="delimiter">(</span><a href="#47044" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#47829" title="scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.AttributeValue]">keyGenerator</a>, <a href="#47045" title="edu.berkeley.cs.scads.piql.RemotePlan">idxPlan</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Returns true only if the given equality predicates can be satisfied by a prefix scan
   * over the given namespace
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean" id="23941">isPrefix</a><span class="delimiter">(</span><a title="Seq[String]" id="46717">attrNames</a>: <span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="edu.berkeley.cs.scads.piql.package.Namespace" id="46718">ns</a>: <a href="package.scala.html#25139" title="edu.berkeley.cs.scads.piql.package.Namespace">Namespace</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.Buffer[java.lang.String]" id="48562">primaryKeyAttrs</a> = <a href="#46718" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>.<span title="(n: Int)scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">take</span><span class="delimiter">(</span><a href="#46717" title="Seq[String]">attrNames</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[org.apache.avro.Schema.Field],java.lang.String,scala.collection.mutable.Buffer[java.lang.String]])scala.collection.mutable.Buffer[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,java.lang.String,scala.collection.mutable.Buffer[java.lang.String]]" class="delimiter">(</span><a href="#48737" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>
    <a href="#46717" title="Seq[String]">attrNames</a>.<span title="(f: String =&gt; Boolean)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],Boolean,Seq[Boolean]])Seq[Boolean]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Boolean,Seq[Boolean]]" class="delimiter">(</span><a href="#48562" title="scala.collection.mutable.Buffer[java.lang.String]">primaryKeyAttrs</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#48783" title="String">_</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(op: (Boolean, Boolean) =&gt; Boolean)Boolean">reduceLeft</span><span class="delimiter">(</span><a href="#48811" title="Boolean">_</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#48812" title="Boolean">_</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Returns the key/value schemas concatenated
   * TODO: push into storage client
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(ns: edu.berkeley.cs.scads.piql.package.Namespace)Seq[org.apache.avro.Schema.Field]" id="23942">getFields</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="47830">ns</a>: <a href="package.scala.html#25139" title="edu.berkeley.cs.scads.piql.package.Namespace">Namespace</a><span class="delimiter">)</span>: <span title="Seq[org.apache.avro.Schema.Field]">Seq</span><span class="delimiter">[</span>Field<span class="delimiter">]</span> =
    <a href="#47830" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>.<span title="=&gt; Seq[org.apache.avro.Schema.Field]">toSeq</span> <span title="(that: scala.collection.GenTraversableOnce[org.apache.avro.Schema.Field])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],org.apache.avro.Schema.Field,Seq[org.apache.avro.Schema.Field]])Seq[org.apache.avro.Schema.Field]">++</span> <a href="#47830" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">valueSchema</span>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>

  <span class="comment">/**
   * Given a list of predicates, replace all UnboundAttributeValues with Attribute values
   * with the correct record/field positions
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(predicate: edu.berkeley.cs.scads.piql.Predicate, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Predicate" id="23943">bindPredicate</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Predicate" id="47817">predicate</a>: <a href="QueryPlan.scala.html#9600" title="edu.berkeley.cs.scads.piql.Predicate">Predicate</a>, <a title="edu.berkeley.cs.scads.piql.package.TupleSchema" id="47818">schema</a>: <span title="edu.berkeley.cs.scads.piql.package.TupleSchema">TupleSchema</span><span class="delimiter">)</span>: <a href="QueryPlan.scala.html#9600" title="edu.berkeley.cs.scads.piql.Predicate">Predicate</a> = <a href="#47817" title="edu.berkeley.cs.scads.piql.Predicate">predicate</a> <span title="edu.berkeley.cs.scads.piql.Predicate" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.EqualityPredicate">EqualityPredicate</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Value" id="49088">l</a>, <a title="edu.berkeley.cs.scads.piql.Value" id="49089">r</a><span class="delimiter">)</span> =&gt; <a href="QueryPlan.scala.html#31743" title="(v1: edu.berkeley.cs.scads.piql.Value, v2: edu.berkeley.cs.scads.piql.Value)edu.berkeley.cs.scads.piql.EqualityPredicate">EqualityPredicate</a><span class="delimiter">(</span><a href="#23946" title="(value: edu.berkeley.cs.scads.piql.Value, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Value">bindValue</a><span class="delimiter">(</span><a href="#49088" title="edu.berkeley.cs.scads.piql.Value">l</a>, <a href="#47818" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span>, <a href="#23946" title="(value: edu.berkeley.cs.scads.piql.Value, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Value">bindValue</a><span class="delimiter">(</span><a href="#49089" title="edu.berkeley.cs.scads.piql.Value">r</a>, <a href="#47818" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="23944">qualifiedAttribute</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;([^\.]+)\.([^\.]+)&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>
<span title="Int(88)" class="int">88</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(value: edu.berkeley.cs.scads.piql.Value, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Value" id="23946">bindValue</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Value" id="47639">value</a>: <a href="QueryPlan.scala.html#9579" title="edu.berkeley.cs.scads.piql.Value">Value</a>, <a title="edu.berkeley.cs.scads.piql.package.TupleSchema" id="47640">schema</a>: <span title="edu.berkeley.cs.scads.piql.package.TupleSchema">TupleSchema</span><span class="delimiter">)</span>: <a href="QueryPlan.scala.html#9579" title="edu.berkeley.cs.scads.piql.Value">Value</a> = <a href="#47639" title="edu.berkeley.cs.scads.piql.Value">value</a> <span title="edu.berkeley.cs.scads.piql.Value" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.AttributeValue">UnboundAttributeValue</span><span class="delimiter">(</span><a href="#23944" title="(target: Any)Option[List[String]]">qualifiedAttribute</a><span class="delimiter">(</span><a title="String" id="49116">relationName</a>, <a title="String" id="49117">attrName</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <a href="#23932" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;attempting to bind qualified attribute: %s.%s in %s&quot;)" class="string">&quot;attempting to bind qualified attribute: %s.%s in %s&quot;</span>, <a href="#49116" title="String">relationName</a>, <a href="#49117" title="String">attrName</a>, <a href="#47640" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Seq[String]" id="49118">relationNames</a> = <a href="#47640" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a>.<span title="(f: edu.berkeley.cs.scads.piql.package.Namespace =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.package.Namespace],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#49142" title="edu.berkeley.cs.scads.piql.package.Namespace">_</a>.<span title="=&gt; String">namespace</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Int" id="49119">recordPosition</a> = <a href="#49118" title="Seq[String]">relationNames</a>.<span title="(p: String =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#49170" title="String">_</a> <span title="(x$1: Any)Boolean">equals</span> <a href="#49116" title="String">relationName</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Seq[org.apache.avro.Schema.Field]" id="49120">fields</a> = <a href="#23942" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace)Seq[org.apache.avro.Schema.Field]">getFields</a><span class="delimiter">(</span><a href="#47640" title="(idx: Int)edu.berkeley.cs.scads.piql.package.Namespace">schema</a><span class="delimiter">(</span><a href="#49119" title="Int">recordPosition</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Int" id="49121">fieldPosition</a> = <a href="#49120" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(p: org.apache.avro.Schema.Field =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#49188" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span> <span title="(x$1: Any)Boolean">equals</span> <a href="#49117" title="String">attrName</a><span class="delimiter">)</span>
      <a href="#23932" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;selecting position (%s):%d, (%s):%d &quot;)" class="string">&quot;selecting position (%s):%d, (%s):%d &quot;</span>, <a href="#49118" title="Seq[String]">relationNames</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span>, <a href="#49119" title="Int">recordPosition</a>, <a href="#49120" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span>, <a href="#49121" title="Int">fieldPosition</a><span class="delimiter">)</span>
      <a href="QueryPlan.scala.html#29433" title="(recordPosition: Int, fieldPosition: Int)edu.berkeley.cs.scads.piql.AttributeValue">AttributeValue</a><span class="delimiter">(</span><a href="#49119" title="Int">recordPosition</a>, <a href="#49121" title="Int">fieldPosition</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.AttributeValue">UnboundAttributeValue</span><span class="delimiter">(</span><a title="java.lang.String" id="49200">name</a>: <span title="String">String</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <span class="comment">//TODO: Throw execption when ambiguious</span>
      <a href="#23932" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;attempting to bind %s in %s&quot;)" class="string">&quot;attempting to bind %s in %s&quot;</span>, <a href="#49200" title="java.lang.String">name</a>, <a href="#47640" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Seq[Seq[org.apache.avro.Schema.Field]]" id="49201">recordSchemas</a> = <a href="#47640" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a>.<span title="(f: edu.berkeley.cs.scads.piql.package.Namespace =&gt; Seq[org.apache.avro.Schema.Field])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.package.Namespace],Seq[org.apache.avro.Schema.Field],Seq[Seq[org.apache.avro.Schema.Field]]])Seq[Seq[org.apache.avro.Schema.Field]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Seq[org.apache.avro.Schema.Field],Seq[Seq[org.apache.avro.Schema.Field]]]" class="delimiter">(</span><a href="#23942" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace)Seq[org.apache.avro.Schema.Field]">getFields</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Int" id="49202">recordPosition</a> = <a href="#49201" title="Seq[Seq[org.apache.avro.Schema.Field]]">recordSchemas</a>.<span title="(p: Seq[org.apache.avro.Schema.Field] =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#49246" title="Seq[org.apache.avro.Schema.Field]">_</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#49263" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span> <span title="(elem: Any)Boolean">contains</span> <a href="#49200" title="java.lang.String">name</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Int" id="49203">fieldPosition</a> = <a href="#49201" title="(idx: Int)Seq[org.apache.avro.Schema.Field]">recordSchemas</a><span class="delimiter">(</span><a href="#49202" title="Int">recordPosition</a><span class="delimiter">)</span>.<span title="(p: org.apache.avro.Schema.Field =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#49310" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span> <span title="(x$1: Any)Boolean">equals</span> <a href="#49200" title="java.lang.String">name</a><span class="delimiter">)</span>
      <a href="QueryPlan.scala.html#29433" title="(recordPosition: Int, fieldPosition: Int)edu.berkeley.cs.scads.piql.AttributeValue">AttributeValue</a><span class="delimiter">(</span><a href="#49202" title="Int">recordPosition</a>, <a href="#49203" title="Int">fieldPosition</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">case</span> <a title="edu.berkeley.cs.scads.piql.Value" id="49312">otherValue</a> =&gt; <a href="#49312" title="edu.berkeley.cs.scads.piql.Value">otherValue</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Given a namespace and a set of attribute equality predicates return
   * at the keyGenerator
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator" id="23947">makeKeyGenerator</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="46793">ns</a>: <a href="package.scala.html#25139" title="edu.berkeley.cs.scads.piql.package.Namespace">Namespace</a>, <a title="edu.berkeley.cs.scads.piql.package.TupleSchema" id="46794">schema</a>: <span title="edu.berkeley.cs.scads.piql.package.TupleSchema">TupleSchema</span>, <a title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]" id="46795">equalityPreds</a>: <span title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">Seq</span><span class="delimiter">[</span>AttributeEquality<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="edu.berkeley.cs.scads.piql.package.KeyGenerator">KeyGenerator</span> = <span class="delimiter">{</span>
    <a href="#46793" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>.<span title="(n: Int)scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">take</span><span class="delimiter">(</span><a href="#46795" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>.<span title="(f: org.apache.avro.Schema.Field =&gt; edu.berkeley.cs.scads.piql.Value)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[org.apache.avro.Schema.Field],edu.berkeley.cs.scads.piql.Value,edu.berkeley.cs.scads.piql.package.KeyGenerator])edu.berkeley.cs.scads.piql.package.KeyGenerator">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,edu.berkeley.cs.scads.piql.Value,scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.Value]]" class="delimiter">(</span><a title="org.apache.avro.Schema.Field" id="49469">f</a> =&gt; <span class="delimiter">{</span>
      <a href="#23932" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Looking for key generator value for field %s in %s&quot;)" class="string">&quot;Looking for key generator value for field %s in %s&quot;</span>, <a href="#49469" title="org.apache.avro.Schema.Field">f</a>.<span title="()java.lang.String">name</span>, <a href="#46795" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.Value" id="49470">value</a> = <a href="#46795" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(p: edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality =&gt; Boolean)Option[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">find</span><span class="delimiter">(</span><a href="#49480" title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">_</a>.<a href="#49931" title="=&gt; edu.berkeley.cs.scads.piql.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25033" title="=&gt; String">unqualifiedName</a> <span title="(x$1: Any)Boolean">equals</span> <a href="#49469" title="org.apache.avro.Schema.Field">f</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>.<span title="(default: =&gt; edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality)edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">getOrElse</span><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <span title="edu.berkeley.cs.scads.piql.ImplementationLimitation" class="keyword">new</span> <a href="#50416" title="edu.berkeley.cs.scads.piql.ImplementationLimitation">ImplementationLimitation</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Invalid prefix&quot;)" class="string">&quot;Invalid prefix&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="#49932" title="=&gt; edu.berkeley.cs.scads.piql.Value">value</a>
      <a href="#23946" title="(value: edu.berkeley.cs.scads.piql.Value, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Value">bindValue</a><span class="delimiter">(</span><a href="#49470" title="edu.berkeley.cs.scads.piql.Value">value</a>, <a href="#46794" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  case <span class="keyword">class</span> <a title="class AttributeEquality extends java.lang.Object with ScalaObject with Product with Serializable" id="50405">AttributeEquality</a><a href="#50405" title="ScalaObject" class="delimiter">(</a><a title="edu.berkeley.cs.scads.piql.UnboundAttributeValue" id="49931">attribute</a>: <a href="QueryPlan.scala.html#9590" title="edu.berkeley.cs.scads.piql.UnboundAttributeValue">UnboundAttributeValue</a>, <a title="edu.berkeley.cs.scads.piql.Value" id="49932">value</a>: <a href="QueryPlan.scala.html#9579" title="edu.berkeley.cs.scads.piql.Value">Value</a><span class="delimiter">)</span>

  case <span class="keyword">class</span> <a title="class Ordering extends java.lang.Object with ScalaObject with Product with Serializable" id="50401">Ordering</a><a href="#50401" title="ScalaObject" class="delimiter">(</a><a title="Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue]" id="49787">attributes</a>: <span title="Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue]">Seq</span><span class="delimiter">[</span>UnboundAttributeValue<span class="delimiter">]</span>, <a title="Boolean" id="49788">ascending</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>

  case <span class="keyword">class</span> <a title="class TupleLimit extends java.lang.Object with ScalaObject with Product with Serializable" id="50397">TupleLimit</a><a href="#50397" title="ScalaObject" class="delimiter">(</a><a title="edu.berkeley.cs.scads.piql.Limit" id="49672">count</a>: <a href="QueryPlan.scala.html#9593" title="edu.berkeley.cs.scads.piql.Limit">Limit</a>, <a title="Boolean" id="49673">isDataStop</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Groups sets of logical operations that can be executed as a
   * single get operations against the key value store
   */</span>
  <span class="keyword">protected</span> <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.Optimizer.IndexRange" id="23957">IndexRange</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(logicalPlan: edu.berkeley.cs.scads.piql.Queryable)Option[(Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable)]" id="46689">unapply</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Queryable" id="46690">logicalPlan</a>: <a href="LogicalPlan.scala.html#9532" title="edu.berkeley.cs.scads.piql.Queryable">Queryable</a><span class="delimiter">)</span>: <span title="Option[(Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable)]">Option</span><span class="delimiter">[</span><span class="delimiter">(</span>Seq<span class="delimiter">[</span>AttributeEquality<span class="delimiter">]</span>, Option<span class="delimiter">[</span>TupleLimit<span class="delimiter">]</span>, Option<span class="delimiter">[</span>Ordering<span class="delimiter">]</span>, Queryable<span class="delimiter">)</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a href="#49651" title="(Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.Queryable)" class="delimiter">(</a><a href="#49650" title="Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit]" id="49651">limit</a>, <a href="#49650" title="edu.berkeley.cs.scads.piql.Queryable" id="49652">planWithoutStop</a><span class="delimiter">)</span> = <a href="#46690" title="edu.berkeley.cs.scads.piql.Queryable">logicalPlan</a> <span title="(Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.Queryable)" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="(Some[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.Queryable)">StopAfter</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Limit" id="49664">count</a>, <a title="edu.berkeley.cs.scads.piql.Queryable" id="49665">child</a><span class="delimiter">)</span> =&gt; <span title="(_1: Some[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], _2: edu.berkeley.cs.scads.piql.Queryable)(Some[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.Queryable)" class="delimiter">(</span><span title="(x: edu.berkeley.cs.scads.piql.Optimizer.TupleLimit)Some[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit]">Some</span><span class="delimiter">(</span><a href="#50397" title="(count: edu.berkeley.cs.scads.piql.Limit, isDataStop: Boolean)edu.berkeley.cs.scads.piql.Optimizer.TupleLimit">TupleLimit</a><span class="delimiter">(</span><a href="#49664" title="edu.berkeley.cs.scads.piql.Limit">count</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#49665" title="edu.berkeley.cs.scads.piql.Queryable">child</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="(Some[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.Queryable)">DataStopAfter</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Limit" id="49682">count</a>, <a title="edu.berkeley.cs.scads.piql.Queryable" id="49683">child</a><span class="delimiter">)</span> =&gt; <span title="(_1: Some[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], _2: edu.berkeley.cs.scads.piql.Queryable)(Some[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.Queryable)" class="delimiter">(</span><span title="(x: edu.berkeley.cs.scads.piql.Optimizer.TupleLimit)Some[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit]">Some</span><span class="delimiter">(</span><a href="#50397" title="(count: edu.berkeley.cs.scads.piql.Limit, isDataStop: Boolean)edu.berkeley.cs.scads.piql.Optimizer.TupleLimit">TupleLimit</a><span class="delimiter">(</span><a href="#49682" title="edu.berkeley.cs.scads.piql.Limit">count</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#49683" title="edu.berkeley.cs.scads.piql.Queryable">child</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="(None.type, edu.berkeley.cs.scads.piql.Queryable)" id="49693">otherOp</a> =&gt; <span title="(_1: None.type, _2: edu.berkeley.cs.scads.piql.Queryable)(None.type, edu.berkeley.cs.scads.piql.Queryable)" class="delimiter">(</span><span title="object None">None</span>, <a href="#49693" title="edu.berkeley.cs.scads.piql.Queryable">otherOp</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="comment">//TODO: check to make sure these are fields in the base relation</span>
      <span class="keyword">val</span> <a href="#49654" title="(Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable)" class="delimiter">(</a><a href="#49653" title="Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering]" id="49654">ordering</a>, <a href="#49653" title="edu.berkeley.cs.scads.piql.Queryable" id="49655">planWithoutSort</a><span class="delimiter">)</span> = <a href="#49652" title="edu.berkeley.cs.scads.piql.Queryable">planWithoutStop</a> <span title="(Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable)" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="(Some[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable)">Sort</span><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.Value]" id="49735">attrs</a>, <a title="Boolean" id="49736">asc</a>, <a title="edu.berkeley.cs.scads.piql.Queryable" id="49737">child</a><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#49735" title="Seq[edu.berkeley.cs.scads.piql.Value]">attrs</a>.<span title="(f: edu.berkeley.cs.scads.piql.Value =&gt; Boolean)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.Value],Boolean,Seq[Boolean]])Seq[Boolean]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Boolean,Seq[Boolean]]" class="delimiter">(</span><a href="#49754" title="edu.berkeley.cs.scads.piql.Value">_</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="QueryPlan.scala.html#9590" title="edu.berkeley.cs.scads.piql.UnboundAttributeValue">UnboundAttributeValue</a><span class="delimiter">]</span><span class="delimiter">)</span>.<span title="(op: (Boolean, Boolean) =&gt; Boolean)Boolean">reduceLeft</span><span class="delimiter">(</span><a href="#49779" title="Boolean">_</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#49780" title="Boolean">_</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <span title="(_1: Some[edu.berkeley.cs.scads.piql.Optimizer.Ordering], _2: edu.berkeley.cs.scads.piql.Queryable)(Some[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable)" class="delimiter">(</span><span title="(x: edu.berkeley.cs.scads.piql.Optimizer.Ordering)Some[edu.berkeley.cs.scads.piql.Optimizer.Ordering]">Some</span><span class="delimiter">(</span><a href="#50401" title="(attributes: Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue], ascending: Boolean)edu.berkeley.cs.scads.piql.Optimizer.Ordering">Ordering</a><span class="delimiter">(</span><a href="#49735" title="Seq[edu.berkeley.cs.scads.piql.Value]">attrs</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue]" class="delimiter">[</span><span title="Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue]">Seq</span><span class="delimiter">[</span>UnboundAttributeValue<span class="delimiter">]</span><span class="delimiter">]</span>, <a href="#49736" title="Boolean">asc</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#49737" title="edu.berkeley.cs.scads.piql.Queryable">child</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <a title="(None.type, edu.berkeley.cs.scads.piql.Queryable)" id="49797">otherOp</a> =&gt; <span title="(_1: None.type, _2: edu.berkeley.cs.scads.piql.Queryable)(None.type, edu.berkeley.cs.scads.piql.Queryable)" class="delimiter">(</span><span title="object None">None</span>, <a href="#49797" title="edu.berkeley.cs.scads.piql.Queryable">otherOp</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a href="#49657" title="(Seq[edu.berkeley.cs.scads.piql.Predicate], Option[edu.berkeley.cs.scads.piql.Queryable])" class="delimiter">(</a><a href="#49656" title="Seq[edu.berkeley.cs.scads.piql.Predicate]" id="49657">predicates</a>, <a href="#49656" title="Option[edu.berkeley.cs.scads.piql.Queryable]" id="49658">planWithoutPredicates</a><span class="delimiter">)</span> = <a href="#49655" title="edu.berkeley.cs.scads.piql.Queryable">planWithoutSort</a>.<a href="LogicalPlan.scala.html#23928" title="(f: PartialFunction[edu.berkeley.cs.scads.piql.Queryable,edu.berkeley.cs.scads.piql.Predicate])(Seq[edu.berkeley.cs.scads.piql.Predicate], Option[edu.berkeley.cs.scads.piql.Queryable])">gatherUntil</a> <a href="#49842" title="edu.berkeley.cs.scads.piql.Predicate" class="delimiter">{</a>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.Predicate">Selection</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Predicate" id="49843">pred</a>, _<span class="delimiter">)</span> =&gt; <a href="#49843" title="edu.berkeley.cs.scads.piql.Predicate">pred</a>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.Queryable" id="49659">basePlan</a> = <a href="#49658" title="Option[edu.berkeley.cs.scads.piql.Queryable]">planWithoutPredicates</a>.<span title="(default: =&gt; edu.berkeley.cs.scads.piql.Queryable)edu.berkeley.cs.scads.piql.Queryable">getOrElse</span> <span class="delimiter">{</span>
        <a href="#23932" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;IndexRange match failed.  No base plan&quot;)" class="string">&quot;IndexRange match failed.  No base plan&quot;</span><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span> <span title="object None">None</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.package.Namespace" id="49660">ns</a> = <a href="#49659" title="edu.berkeley.cs.scads.piql.Queryable">basePlan</a> <span title="edu.berkeley.cs.scads.piql.package.Namespace" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.package.Namespace">Relation</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="49866">ns</a><span class="delimiter">)</span> =&gt; <a href="#49866" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.package.Namespace">Join</span><span class="delimiter">(</span>_, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="49867">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#49867" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>
        <span class="keyword">case</span> <a title="Nothing" id="49868">otherOp</a> =&gt; <span class="delimiter">{</span>
          <a href="#23932" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;IndexRange match failed.  Invalid base plan: %s&quot;)" class="string">&quot;IndexRange match failed.  Invalid base plan: %s&quot;</span>, <a href="#49868" title="edu.berkeley.cs.scads.piql.Queryable">otherOp</a><span class="delimiter">)</span>
          <span title="Nothing" class="keyword">return</span> <span title="object None">None</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="Seq[org.apache.avro.Schema.Field]" id="49661">fields</a> = <a href="#23942" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace)Seq[org.apache.avro.Schema.Field]">getFields</a><span class="delimiter">(</span><a href="#49660" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]" id="49662">idxEqPreds</a> = <a href="#49657" title="Seq[edu.berkeley.cs.scads.piql.Predicate]">predicates</a>.<span title="(f: edu.berkeley.cs.scads.piql.Predicate =&gt; edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.Predicate],edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality,Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]])Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">map</span> <a href="#49889" title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality" class="delimiter">{</a>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">EqualityPredicate</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Value" id="49890">v</a>: <a href="QueryPlan.scala.html#9579" title="edu.berkeley.cs.scads.piql.Value">Value</a>, <a title="edu.berkeley.cs.scads.piql.UnboundAttributeValue" id="49891">u</a> @ UnboundAttributeValue<span class="delimiter">(</span><a href="#23944" title="(target: Any)Option[List[String]]">qualifiedAttribute</a><span class="delimiter">(</span><a title="String" id="49893">relName</a>, <a title="String" id="49894">attrName</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#49893" title="String">relName</a>.<span title="(x$1: Any)Boolean">equals</span><span class="delimiter">(</span><a href="#49660" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; String">namespace</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#49661" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#49911" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#49894" title="String">attrName</a><span class="delimiter">)</span> =&gt;
          <a href="#50405" title="(attribute: edu.berkeley.cs.scads.piql.UnboundAttributeValue, value: edu.berkeley.cs.scads.piql.Value)edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">AttributeEquality</a><span class="delimiter">(</span><a href="#49891" title="edu.berkeley.cs.scads.piql.UnboundAttributeValue">u</a>, <a href="#49890" title="edu.berkeley.cs.scads.piql.Value">v</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">EqualityPredicate</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.UnboundAttributeValue" id="49938">u</a> @ UnboundAttributeValue<span class="delimiter">(</span><a href="#23944" title="(target: Any)Option[List[String]]">qualifiedAttribute</a><span class="delimiter">(</span><a title="String" id="49940">relName</a>, <a title="String" id="49941">attrName</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a title="edu.berkeley.cs.scads.piql.Value" id="49942">v</a>: <a href="QueryPlan.scala.html#9579" title="edu.berkeley.cs.scads.piql.Value">Value</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#49940" title="String">relName</a>.<span title="(x$1: Any)Boolean">equals</span><span class="delimiter">(</span><a href="#49660" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; String">namespace</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#49661" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#49953" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#49941" title="String">attrName</a><span class="delimiter">)</span> =&gt;
          <a href="#50405" title="(attribute: edu.berkeley.cs.scads.piql.UnboundAttributeValue, value: edu.berkeley.cs.scads.piql.Value)edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">AttributeEquality</a><span class="delimiter">(</span><a href="#49938" title="edu.berkeley.cs.scads.piql.UnboundAttributeValue">u</a>, <a href="#49942" title="edu.berkeley.cs.scads.piql.Value">v</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">EqualityPredicate</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Value" id="49973">v</a>: <a href="QueryPlan.scala.html#9579" title="edu.berkeley.cs.scads.piql.Value">Value</a>, <a title="edu.berkeley.cs.scads.piql.UnboundAttributeValue" id="49974">u</a> @ UnboundAttributeValue<span class="delimiter">(</span><a title="String" id="49975">attrName</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#49661" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#49986" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#49975" title="String">attrName</a><span class="delimiter">)</span> =&gt;
          <a href="#50405" title="(attribute: edu.berkeley.cs.scads.piql.UnboundAttributeValue, value: edu.berkeley.cs.scads.piql.Value)edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">AttributeEquality</a><span class="delimiter">(</span><a href="#49974" title="edu.berkeley.cs.scads.piql.UnboundAttributeValue">u</a>, <a href="#49973" title="edu.berkeley.cs.scads.piql.Value">v</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">EqualityPredicate</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.UnboundAttributeValue" id="50006">u</a> @ UnboundAttributeValue<span class="delimiter">(</span><a title="String" id="50007">attrName</a><span class="delimiter">)</span>, <a title="edu.berkeley.cs.scads.piql.Value" id="50008">v</a>: <a href="QueryPlan.scala.html#9579" title="edu.berkeley.cs.scads.piql.Value">Value</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#49661" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#50019" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#50007" title="String">attrName</a><span class="delimiter">)</span> =&gt;
          <a href="#50405" title="(attribute: edu.berkeley.cs.scads.piql.UnboundAttributeValue, value: edu.berkeley.cs.scads.piql.Value)edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">AttributeEquality</a><span class="delimiter">(</span><a href="#50006" title="edu.berkeley.cs.scads.piql.UnboundAttributeValue">u</a>, <a href="#50008" title="edu.berkeley.cs.scads.piql.Value">v</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="Nothing" id="50039">otherPred</a> =&gt; <span class="delimiter">{</span>
          <a href="#23932" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;IndexScan match failed.  Can\'t apply %s to index scan of %s.{%s}&quot;)" class="string">&quot;IndexScan match failed.  Can't apply %s to index scan of %s.{%s}&quot;</span>, <a href="#50039" title="edu.berkeley.cs.scads.piql.Predicate">otherPred</a>, <a href="#49660" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; String">namespace</span>, <a href="#49660" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[org.apache.avro.Schema.Field],java.lang.String,scala.collection.mutable.Buffer[java.lang.String]])scala.collection.mutable.Buffer[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,java.lang.String,scala.collection.mutable.Buffer[java.lang.String]]" class="delimiter">(</span><a href="#50324" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="Nothing" class="keyword">return</span> <span title="object None">None</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="(Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable)" id="49663">getOp</a> = <span title="(_1: Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality], _2: Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], _3: Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering], _4: edu.berkeley.cs.scads.piql.Queryable)(Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable)" class="delimiter">(</span><a href="#49662" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">idxEqPreds</a>, <a href="#49651" title="Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit]">limit</a>, <a href="#49654" title="Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering]">ordering</a>, <a href="#49659" title="edu.berkeley.cs.scads.piql.Queryable">basePlan</a><span class="delimiter">)</span>
      <a href="#23932" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Matched IndexRange%s&quot;)" class="string">&quot;Matched IndexRange%s&quot;</span>, <a href="#49663" title="(Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable)">getOp</a><span class="delimiter">)</span>
      <span title="(x: (Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable))Some[(Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable)]">Some</span><span class="delimiter">(</span><a href="#49663" title="(Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable)">getOp</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>