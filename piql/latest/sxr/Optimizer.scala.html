<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>Optimizer.scala</title>
        <script type="text/javascript" src="jquery-all.js"></script>
        <script type="text/javascript" src="linked.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs
<span class="keyword">package</span> scads
<span class="keyword">package</span> piql
<span class="keyword">package</span> opt

<span class="keyword">import</span> plans._
<span class="keyword">import</span> storage.client.index._

<span class="keyword">import</span> org.apache.avro.Schema
<span class="keyword">import</span> org.apache.avro.<span title="object org.apache.avro.Schema">Schema</span>.Field
<span class="keyword">import</span> org.apache.avro.util.Utf8
<span class="keyword">import</span> scala.collection.<span title="object scala.collection.JavaConversions">JavaConversions</span>._
<span class="keyword">import</span> net.lag.logging.Logger

case <span class="keyword">class</span> <a title="class ImplementationLimitation extends java.lang.Exception with ScalaObject with Product with Serializable" id="48905">ImplementationLimitation</a><a href="#48905" title="ScalaObject" class="delimiter">(</a><a title="String" id="48902">desc</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="java.lang.Exception">Exception</span>

<span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.opt.OptimizedQuery" id="9540">OptimizedQuery</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentHashMap[Int,edu.berkeley.cs.scads.piql.plans.QueryPlan]" id="43109">physicalPlans</a> = <span title="()java.util.concurrent.ConcurrentHashMap[Int,edu.berkeley.cs.scads.piql.plans.QueryPlan]" class="keyword">new</span> java.util.concurrent.<span title="java.util.concurrent.ConcurrentHashMap[Int,edu.berkeley.cs.scads.piql.plans.QueryPlan]">ConcurrentHashMap</span><span class="delimiter">[</span>Int, QueryPlan<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class OptimizedQuery extends java.lang.Object with ScalaObject" id="9542">OptimizedQuery</a><a href="#9542" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="Option[String]" id="26065">name</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.QueryPlan" id="26066">physicalPlan</a>: <a href="QueryPlan.scala.html#9628" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">QueryPlan</a>, <a title="edu.berkeley.cs.scads.piql.package.QueryExecutor" id="26067">executor</a>: <a href="Iterators.scala.html#9523" title="edu.berkeley.cs.scads.piql.package.QueryExecutor">QueryExecutor</a><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(args: Any*)edu.berkeley.cs.scads.piql.package.QueryResult" id="26063">apply</a><span class="delimiter">(</span><a title="Any*" id="43434">args</a>: <span title="Any*">Any</span>*<span class="delimiter">)</span>: <span title="edu.berkeley.cs.scads.piql.package.QueryResult">QueryResult</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Seq[Any]" id="43436">encodedArgs</a> = <a href="#43434" title="Any*">args</a>.<span title="(f: Any =&gt; Any)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[Any],Any,Seq[Any]])Seq[Any]">map</span> <a href="#43455" title="Any" class="delimiter">{</a>
      <span class="keyword">case</span> <a title="org.apache.avro.util.Utf8" id="43456">s</a>: <span title="String">String</span> =&gt; <span title="(x$1: java.lang.String)org.apache.avro.util.Utf8" class="keyword">new</span> <span title="org.apache.avro.util.Utf8">Utf8</span><span class="delimiter">(</span><a href="#43456" title="String">s</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="Any" id="43461">o</a> =&gt; <a href="#43461" title="Any">o</a>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.exec.QueryIterator" id="43437">iterator</a> = <a href="Iterators.scala.html#19133" title="(plan: edu.berkeley.cs.scads.piql.plans.QueryPlan, args: Any*)edu.berkeley.cs.scads.piql.exec.QueryIterator">executor</a><span class="delimiter">(</span><a href="#26066" title="=&gt; edu.berkeley.cs.scads.piql.plans.QueryPlan">physicalPlan</a>, <a href="#43436" title="Seq[Any]">encodedArgs</a>: _*<span class="delimiter">)</span>
    <a href="#43437" title="edu.berkeley.cs.scads.piql.exec.QueryIterator">iterator</a>.<a href="Iterators.scala.html#19116" title="=&gt; Unit">open</a>
    <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Tuple]" id="43438">ret</a> = <a href="#43437" title="edu.berkeley.cs.scads.piql.exec.QueryIterator">iterator</a>.<span title="=&gt; List[edu.berkeley.cs.scads.piql.package.Tuple]">toList</span>
    <a href="#43437" title="edu.berkeley.cs.scads.piql.exec.QueryIterator">iterator</a>.<a href="Iterators.scala.html#19117" title="=&gt; Unit">close</a>
    <a href="#43438" title="List[edu.berkeley.cs.scads.piql.package.Tuple]">ret</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; scala.xml.NodeSeq" id="26064">toHtml</a>: xml.<span title="scala.xml.NodeSeq">NodeSeq</span> = <span class="delimiter">{</span>
    &lt;<a title="scala.xml.Elem" id="44284">b</a>&gt;
      <span class="delimiter">{</span><a href="#26066" title="=&gt; edu.berkeley.cs.scads.piql.plans.QueryPlan">physicalPlan</a><span class="delimiter">}</span>
    &lt;/b&gt;
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.opt.Optimizer" id="9543">Optimizer</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="24933">logger</a> = <span title="()net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="Int" id="24935">defaultFetchSize</a> = <span title="Int(10)" class="int">10</span>

  case <span class="keyword">class</span> <a title="class OptimizedSubPlan extends java.lang.Object with ScalaObject with Product with Serializable" id="48898">OptimizedSubPlan</a><a href="#48898" title="ScalaObject" class="delimiter">(</a><a title="edu.berkeley.cs.scads.piql.plans.QueryPlan" id="45098">physicalPlan</a>: <a href="QueryPlan.scala.html#9628" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">QueryPlan</a>, <a title="edu.berkeley.cs.scads.piql.package.TupleSchema" id="45099">schema</a>: <span title="edu.berkeley.cs.scads.piql.package.TupleSchema">TupleSchema</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(logicalPlan: edu.berkeley.cs.scads.piql.plans.LogicalPlan)edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan" id="24940">apply</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.LogicalPlan" id="24960">logicalPlan</a>: <a href="LogicalPlan.scala.html#9547" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">LogicalPlan</a><span class="delimiter">)</span>: <a href="#48898" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a> = <span class="delimiter">{</span>
    <a href="#24933" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Optimizing subplan: %s&quot;)" class="string">&quot;Optimizing subplan: %s&quot;</span>, <a href="#24960" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">logicalPlan</a><span class="delimiter">)</span>

    <a href="#24960" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">logicalPlan</a> <span title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#44953" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">IndexRange</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]" id="44957">equalityPreds</a>, <span title="object None">None</span>, <span title="object None">None</span>, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="44974">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#44957" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <a href="#44974" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="()java.util.List[org.apache.avro.Schema.Field]">getFields</span>.<span title="()Int">size</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
        <a href="#24942" title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean">isPrefix</a><span class="delimiter">(</span><a href="#44957" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#45059" title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">_</a>.<a href="#48420" title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25240" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span>, <a href="#44974" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="45091">tupleSchema</a> = <a href="#44974" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#45092" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>
        <a href="#48898" title="(physicalPlan: edu.berkeley.cs.scads.piql.plans.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span>
          <a href="QueryPlan.scala.html#51899" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, key: edu.berkeley.cs.scads.piql.package.KeyGenerator)edu.berkeley.cs.scads.piql.plans.IndexLookup">IndexLookup</a><span class="delimiter">(</span><a href="#44974" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#24948" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#44974" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#45091" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#44957" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span><span class="delimiter">)</span>,
          <a href="#45091" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#44953" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">IndexRange</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]" id="45114">equalityPreds</a>, Some<span class="delimiter">(</span>TupleLimit<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.Limit" id="45145">count</a>, <a title="Boolean" id="45146">dataStop</a><span class="delimiter">)</span><span class="delimiter">)</span>, <span title="object None">None</span>, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="45147">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan" class="keyword">if</span> <span class="delimiter">(</span><a href="#24942" title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean">isPrefix</a><span class="delimiter">(</span><a href="#45114" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#45164" title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">_</a>.<a href="#48420" title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25240" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span>, <a href="#45147" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#24933" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Using primary index for predicates: %s&quot;)" class="string">&quot;Using primary index for predicates: %s&quot;</span>, <a href="#45114" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="45184">tupleSchema</a> = <a href="#45147" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#45191" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>
          <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.IndexScan" id="45185">idxScanPlan</a> = <a href="QueryPlan.scala.html#51895" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.plans.Limit, ascending: Boolean)edu.berkeley.cs.scads.piql.plans.IndexScan">IndexScan</a><span class="delimiter">(</span><a href="#45147" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#24948" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#45147" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#45184" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#45114" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>, <a href="#45145" title="edu.berkeley.cs.scads.piql.plans.Limit">count</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="&lt;none&gt; extends Product with Serializable with edu.berkeley.cs.scads.piql.plans.QueryPlan" id="45186">fullPlan</a> = <a href="#45146" title="Boolean">dataStop</a> <span title="&lt;none&gt; extends Product with Serializable with edu.berkeley.cs.scads.piql.plans.QueryPlan" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.IndexScan" class="keyword">true</span> =&gt; <a href="#45185" title="edu.berkeley.cs.scads.piql.plans.IndexScan">idxScanPlan</a>
            <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.LocalStopAfter" class="keyword">false</span> =&gt; <a href="QueryPlan.scala.html#51864" title="(count: edu.berkeley.cs.scads.piql.plans.Limit, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.LocalStopAfter">LocalStopAfter</a><span class="delimiter">(</span><a href="#45145" title="edu.berkeley.cs.scads.piql.plans.Limit">count</a>, <a href="#45185" title="edu.berkeley.cs.scads.piql.plans.IndexScan">idxScanPlan</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <a href="#48898" title="(physicalPlan: edu.berkeley.cs.scads.piql.plans.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span><a href="#45186" title="&lt;none&gt; extends Product with Serializable with edu.berkeley.cs.scads.piql.plans.QueryPlan">fullPlan</a>, <a href="#45184" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#24933" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Using secondary index for predicates: %s&quot;)" class="string">&quot;Using secondary index for predicates: %s&quot;</span>, <a href="#45114" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>

          <span class="comment">//TODO: Fix type hack</span>
          <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace" id="45221">idx</a> = <a href="#45147" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.piql.package.IndexedNamespace" class="delimiter">[</span><a href="package.scala.html#45230" title="edu.berkeley.cs.scads.piql.package.IndexedNamespace">IndexedNamespace</a><span class="delimiter">]</span>.<span title="(fields: Seq[edu.berkeley.cs.scads.storage.client.index.IndexType])edu.berkeley.cs.scads.storage.client.index.IndexNamespace">getOrCreateIndex</span><span class="delimiter">(</span><a href="#45114" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality =&gt; edu.berkeley.cs.scads.storage.client.index.AttributeIndex)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality],edu.berkeley.cs.scads.storage.client.index.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.client.index.IndexType]])Seq[edu.berkeley.cs.scads.storage.client.index.IndexType]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.storage.client.index.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.client.index.AttributeIndex]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality" id="45244">p</a> =&gt; <span title="(fieldName: String)edu.berkeley.cs.scads.storage.client.index.AttributeIndex">AttributeIndex</span><span class="delimiter">(</span><a href="#45244" title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">p</a>.<a href="#48420" title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25240" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="45222">tupleSchema</a> = <a href="#45221" title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace">idx</a> <a href="#45341" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <a href="#45147" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#45342" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>
          <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.IndexScan" id="45223">idxScanPlan</a> = <a href="QueryPlan.scala.html#51895" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.plans.Limit, ascending: Boolean)edu.berkeley.cs.scads.piql.plans.IndexScan">IndexScan</a><span class="delimiter">(</span><a href="#45221" title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace">idx</a>, <a href="#24948" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#45221" title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace">idx</a>, <a href="#45222" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#45114" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>, <a href="#45145" title="edu.berkeley.cs.scads.piql.plans.Limit">count</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.QueryPlan" id="45224">derefedPlan</a> = <a href="#24941" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, idxPlan: edu.berkeley.cs.scads.piql.plans.RemotePlan)edu.berkeley.cs.scads.piql.plans.QueryPlan">derefPlan</a><span class="delimiter">(</span><a href="#45147" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#45223" title="edu.berkeley.cs.scads.piql.plans.IndexScan">idxScanPlan</a><span class="delimiter">)</span>

          <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.QueryPlan" id="45225">fullPlan</a> = <a href="#45146" title="Boolean">dataStop</a> <span title="edu.berkeley.cs.scads.piql.plans.QueryPlan" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.QueryPlan" class="keyword">true</span> =&gt; <a href="#45224" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">derefedPlan</a>
            <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.LocalStopAfter" class="keyword">false</span> =&gt; <a href="QueryPlan.scala.html#51864" title="(count: edu.berkeley.cs.scads.piql.plans.Limit, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.LocalStopAfter">LocalStopAfter</a><span class="delimiter">(</span><a href="#45145" title="edu.berkeley.cs.scads.piql.plans.Limit">count</a>, <a href="#45224" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">derefedPlan</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <a href="#48898" title="(physicalPlan: edu.berkeley.cs.scads.piql.plans.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span><a href="#45225" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">fullPlan</a>, <a href="#45222" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#44953" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">IndexRange</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]" id="45369">equalityPreds</a>, <a title="Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit]" id="45370">bound</a>, Some<span class="delimiter">(</span>Ordering<span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue]" id="45404">attrs</a>, <a title="Boolean" id="45405">asc</a><span class="delimiter">)</span><span class="delimiter">)</span>, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="45406">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.Limit" id="45407">limitHint</a> = <a href="#45370" title="Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit]">bound</a>.<span title="(f: edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit =&gt; edu.berkeley.cs.scads.piql.plans.Limit)Option[edu.berkeley.cs.scads.piql.plans.Limit]">map</span><span class="delimiter">(</span><a href="#45418" title="edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit">_</a>.<a href="#48096" title="=&gt; edu.berkeley.cs.scads.piql.plans.Limit">count</a><span class="delimiter">)</span>.<span title="(default: =&gt; edu.berkeley.cs.scads.piql.plans.Limit)edu.berkeley.cs.scads.piql.plans.Limit">getOrElse</span> <span class="delimiter">{</span>
          <a href="#24933" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;UnboundedPlan %s: %s&quot;)" class="string">&quot;UnboundedPlan %s: %s&quot;</span>, <a href="#45406" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#24960" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">logicalPlan</a><span class="delimiter">)</span>
          <a href="QueryPlan.scala.html#51924" title="(count: Int)edu.berkeley.cs.scads.piql.plans.FixedLimit">FixedLimit</a><span class="delimiter">(</span><a href="#24935" title="=&gt; Int">defaultFetchSize</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">val</span> <a title="Boolean" id="45408">isDataStop</a> = <a href="#45370" title="Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit]">bound</a>.<span title="(f: edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit =&gt; Boolean)Option[Boolean]">map</span><span class="delimiter">(</span><a href="#45434" title="edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit">_</a>.<a href="#48097" title="=&gt; Boolean">isDataStop</a><span class="delimiter">)</span>.<span title="(default: =&gt; Boolean)Boolean">getOrElse</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Seq[String]" id="45409">prefixAttrs</a> = <a href="#45369" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#45457" title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">_</a>.<a href="#48420" title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25240" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span> <span title="(that: scala.collection.GenTraversableOnce[String])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],String,Seq[String]])Seq[String]">++</span> <a href="#45404" title="Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue]">attrs</a>.<span title="(f: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#45522" title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">_</a>.<a href="QueryPlan.scala.html#25240" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a href="#45411" title="(edu.berkeley.cs.scads.piql.plans.QueryPlan, List[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</a><a href="#45410" title="edu.berkeley.cs.scads.piql.plans.QueryPlan" id="45411">idxScanPlan</a>, <a href="#45410" title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="45412">tupleSchema</a><span class="delimiter">)</span> =
          <span title="(edu.berkeley.cs.scads.piql.plans.QueryPlan, List[edu.berkeley.cs.scads.piql.package.Namespace])" class="keyword">if</span> <span class="delimiter">(</span><a href="#24942" title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean">isPrefix</a><span class="delimiter">(</span><a href="#45409" title="Seq[String]">prefixAttrs</a>, <a href="#45406" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="45561">tupleSchema</a> = <a href="#45406" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#45562" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>
            <span title="(_1: edu.berkeley.cs.scads.piql.plans.IndexScan, _2: List[edu.berkeley.cs.scads.piql.package.Namespace])(edu.berkeley.cs.scads.piql.plans.IndexScan, List[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</span><a href="QueryPlan.scala.html#51895" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.plans.Limit, ascending: Boolean)edu.berkeley.cs.scads.piql.plans.IndexScan">IndexScan</a><span class="delimiter">(</span><a href="#45406" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#24948" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#45406" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#45561" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#45369" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>, <a href="#45407" title="edu.berkeley.cs.scads.piql.plans.Limit">limitHint</a>, <a href="#45405" title="Boolean">asc</a><span class="delimiter">)</span>, <a href="#45561" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <span class="keyword">else</span> <span class="delimiter">{</span>
            <a href="#24933" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Creating index for attributes: %s&quot;)" class="string">&quot;Creating index for attributes: %s&quot;</span>, <a href="#45409" title="Seq[String]">prefixAttrs</a><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace" id="45593">idx</a> = <a href="#45406" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.piql.package.IndexedNamespace" class="delimiter">[</span><a href="package.scala.html#45230" title="edu.berkeley.cs.scads.piql.package.IndexedNamespace">IndexedNamespace</a><span class="delimiter">]</span>.<span title="(fields: Seq[edu.berkeley.cs.scads.storage.client.index.IndexType])edu.berkeley.cs.scads.storage.client.index.IndexNamespace">getOrCreateIndex</span><span class="delimiter">(</span><a href="#45409" title="Seq[String]">prefixAttrs</a>.<span title="(f: String =&gt; edu.berkeley.cs.scads.storage.client.index.AttributeIndex)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],edu.berkeley.cs.scads.storage.client.index.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.client.index.IndexType]])Seq[edu.berkeley.cs.scads.storage.client.index.IndexType]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.storage.client.index.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.client.index.AttributeIndex]]" class="delimiter">(</span><a title="String" id="45615">p</a> =&gt; <span title="(fieldName: String)edu.berkeley.cs.scads.storage.client.index.AttributeIndex">AttributeIndex</span><span class="delimiter">(</span><a href="#45615" title="String">p</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="45594">tupleSchema</a> = <a href="#45593" title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace">idx</a> <a href="#45637" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <a href="#45406" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#45638" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>
            <span title="(_1: edu.berkeley.cs.scads.piql.plans.QueryPlan, _2: List[edu.berkeley.cs.scads.piql.package.Namespace])(edu.berkeley.cs.scads.piql.plans.QueryPlan, List[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</span><a href="#24941" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, idxPlan: edu.berkeley.cs.scads.piql.plans.RemotePlan)edu.berkeley.cs.scads.piql.plans.QueryPlan">derefPlan</a><span class="delimiter">(</span><a href="#45406" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>,
              <a href="QueryPlan.scala.html#51895" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.plans.Limit, ascending: Boolean)edu.berkeley.cs.scads.piql.plans.IndexScan">IndexScan</a><span class="delimiter">(</span><a href="#45593" title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace">idx</a>,
                <a href="#24948" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#45593" title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace">idx</a>, <a href="#45594" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#45369" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>,
                <a href="#45407" title="edu.berkeley.cs.scads.piql.plans.Limit">limitHint</a>,
                <a href="#45405" title="Boolean">asc</a><span class="delimiter">)</span><span class="delimiter">)</span>,
              <a href="#45594" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.QueryPlan" id="45413">fullPlan</a> = <a href="#45408" title="Boolean">isDataStop</a> <span title="edu.berkeley.cs.scads.piql.plans.QueryPlan" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.QueryPlan" class="keyword">true</span> =&gt; <a href="#45411" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">idxScanPlan</a>
          <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.LocalStopAfter" class="keyword">false</span> =&gt; <a href="QueryPlan.scala.html#51864" title="(count: edu.berkeley.cs.scads.piql.plans.Limit, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.LocalStopAfter">LocalStopAfter</a><span class="delimiter">(</span><a href="#45407" title="edu.berkeley.cs.scads.piql.plans.Limit">limitHint</a>, <a href="#45411" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">idxScanPlan</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#48898" title="(physicalPlan: edu.berkeley.cs.scads.piql.plans.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span><a href="#45413" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">fullPlan</a>, <a href="#45412" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#44953" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">IndexRange</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]" id="45678">equalityPreds</a>, <span title="object None">None</span>, <span title="object None">None</span>, Join<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.LogicalPlan" id="45709">child</a>, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="45710">ns</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#45678" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <a href="#45710" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="()java.util.List[org.apache.avro.Schema.Field]">getFields</span>.<span title="()Int">size</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
        <a href="#24942" title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean">isPrefix</a><span class="delimiter">(</span><a href="#45678" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#45733" title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">_</a>.<a href="#48420" title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25240" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span>, <a href="#45710" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan" id="45753">optChild</a> = <a href="#24940" title="(logicalPlan: edu.berkeley.cs.scads.piql.plans.LogicalPlan)edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">apply</a><span class="delimiter">(</span><a href="#45709" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">child</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]" id="45754">tupleSchema</a> = <a href="#45753" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#45099" title="=&gt; edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a> <span title="(elem: edu.berkeley.cs.scads.piql.package.Namespace)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.package.Namespace],edu.berkeley.cs.scads.piql.package.Namespace,Seq[edu.berkeley.cs.scads.piql.package.Namespace]])Seq[edu.berkeley.cs.scads.piql.package.Namespace]">:+</span> <a href="#45710" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>
        <a href="#48898" title="(physicalPlan: edu.berkeley.cs.scads.piql.plans.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span>
          <a href="QueryPlan.scala.html#51891" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, key: edu.berkeley.cs.scads.piql.package.KeyGenerator, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.IndexLookupJoin">IndexLookupJoin</a><span class="delimiter">(</span><a href="#45710" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#24948" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#45710" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#45754" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#45678" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>, <a href="#45753" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#45098" title="=&gt; edu.berkeley.cs.scads.piql.plans.QueryPlan">physicalPlan</a><span class="delimiter">)</span>,
          <a href="#45754" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#44953" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">IndexRange</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]" id="45798">equalityPreds</a>, Some<span class="delimiter">(</span>TupleLimit<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.Limit" id="45800">count</a>, <a title="Boolean" id="45801">dataStop</a><span class="delimiter">)</span><span class="delimiter">)</span>, Some<span class="delimiter">(</span>Ordering<span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue]" id="45803">attrs</a>, <a title="Boolean" id="45804">asc</a><span class="delimiter">)</span><span class="delimiter">)</span>, Join<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.LogicalPlan" id="45805">child</a>, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="45806">ns</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Seq[String]" id="45807">prefixAttrs</a> = <a href="#45798" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#45829" title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">_</a>.<a href="#48420" title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25240" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span> <span title="(that: scala.collection.GenTraversableOnce[String])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],String,Seq[String]])Seq[String]">++</span> <a href="#45803" title="Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue]">attrs</a>.<span title="(f: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#45888" title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">_</a>.<a href="QueryPlan.scala.html#25240" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan" id="45808">optChild</a> = <a href="#24940" title="(logicalPlan: edu.berkeley.cs.scads.piql.plans.LogicalPlan)edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">apply</a><span class="delimiter">(</span><a href="#45805" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">child</a><span class="delimiter">)</span>

        <span class="keyword">val</span> <a href="#45810" title="(edu.berkeley.cs.scads.piql.plans.QueryPlan, Seq[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</a><a href="#45809" title="edu.berkeley.cs.scads.piql.plans.QueryPlan" id="45810">joinPlan</a>, <a href="#45809" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]" id="45811">tupleSchema</a><span class="delimiter">)</span> =
          <span title="(edu.berkeley.cs.scads.piql.plans.QueryPlan, Seq[edu.berkeley.cs.scads.piql.package.Namespace])" class="keyword">if</span> <span class="delimiter">(</span><a href="#24942" title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean">isPrefix</a><span class="delimiter">(</span><a href="#45807" title="Seq[String]">prefixAttrs</a>, <a href="#45806" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]" id="45927">tupleSchema</a> = <a href="#45808" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#45099" title="=&gt; edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a> <span title="(elem: edu.berkeley.cs.scads.piql.package.Namespace)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.package.Namespace],edu.berkeley.cs.scads.piql.package.Namespace,Seq[edu.berkeley.cs.scads.piql.package.Namespace]])Seq[edu.berkeley.cs.scads.piql.package.Namespace]">:+</span> <a href="#45806" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>
            <a href="#24933" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Using index special orders for %s&quot;)" class="string">&quot;Using index special orders for %s&quot;</span>, <a href="#45803" title="Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue]">attrs</a><span class="delimiter">)</span>

            <span title="(_1: edu.berkeley.cs.scads.piql.plans.IndexMergeJoin, _2: Seq[edu.berkeley.cs.scads.piql.package.Namespace])(edu.berkeley.cs.scads.piql.plans.IndexMergeJoin, Seq[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</span><a href="QueryPlan.scala.html#51883" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, sortFields: Seq[edu.berkeley.cs.scads.piql.plans.Value], limit: edu.berkeley.cs.scads.piql.plans.Limit, ascending: Boolean, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.IndexMergeJoin">IndexMergeJoin</a><span class="delimiter">(</span><a href="#45806" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>,
              <a href="#24948" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#45806" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#45927" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#45798" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>,
              <a href="#45803" title="Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue]">attrs</a>.<span title="(f: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue =&gt; edu.berkeley.cs.scads.piql.plans.Value)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue],edu.berkeley.cs.scads.piql.plans.Value,Seq[edu.berkeley.cs.scads.piql.plans.Value]])Seq[edu.berkeley.cs.scads.piql.plans.Value]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.piql.plans.Value,Seq[edu.berkeley.cs.scads.piql.plans.Value]]" class="delimiter">(</span><a href="#24947" title="(value: edu.berkeley.cs.scads.piql.plans.Value, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.plans.Value">bindValue</a><span class="delimiter">(</span><a href="#45997" title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">_</a>, <a href="#45927" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span><span class="delimiter">)</span>,
              <a href="#45800" title="edu.berkeley.cs.scads.piql.plans.Limit">count</a>,
              <a href="#45804" title="Boolean">asc</a>,
              <a href="#45808" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#45098" title="=&gt; edu.berkeley.cs.scads.piql.plans.QueryPlan">physicalPlan</a><span class="delimiter">)</span>,
              <a href="#45927" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace" id="46024">idx</a> = <a href="#45806" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.piql.package.IndexedNamespace" class="delimiter">[</span><a href="package.scala.html#45230" title="edu.berkeley.cs.scads.piql.package.IndexedNamespace">IndexedNamespace</a><span class="delimiter">]</span>.<span title="(fields: Seq[edu.berkeley.cs.scads.storage.client.index.IndexType])edu.berkeley.cs.scads.storage.client.index.IndexNamespace">getOrCreateIndex</span><span class="delimiter">(</span><a href="#45807" title="Seq[String]">prefixAttrs</a>.<span title="(f: String =&gt; edu.berkeley.cs.scads.storage.client.index.AttributeIndex)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],edu.berkeley.cs.scads.storage.client.index.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.client.index.IndexType]])Seq[edu.berkeley.cs.scads.storage.client.index.IndexType]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.storage.client.index.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.client.index.AttributeIndex]]" class="delimiter">(</span><a title="String" id="46043">p</a> =&gt; <span title="(fieldName: String)edu.berkeley.cs.scads.storage.client.index.AttributeIndex">AttributeIndex</span><span class="delimiter">(</span><a href="#46043" title="String">p</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="46025">tupleSchema</a> = <a href="#46024" title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace">idx</a> <a href="#46065" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <a href="#45806" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#46066" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>

            <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.IndexScanJoin" id="46026">idxJoinPlan</a> = <a href="QueryPlan.scala.html#51887" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.plans.Limit, ascending: Boolean, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.IndexScanJoin">IndexScanJoin</a><span class="delimiter">(</span><a href="#46024" title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace">idx</a>,
              <a href="#24948" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#46024" title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace">idx</a>, <a href="#46025" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#45798" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>,
              <a href="#45800" title="edu.berkeley.cs.scads.piql.plans.Limit">count</a>,
              <a href="#45804" title="Boolean">asc</a>,
              <a href="#45808" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#45098" title="=&gt; edu.berkeley.cs.scads.piql.plans.QueryPlan">physicalPlan</a><span class="delimiter">)</span>
            <span title="(_1: edu.berkeley.cs.scads.piql.plans.QueryPlan, _2: List[edu.berkeley.cs.scads.piql.package.Namespace])(edu.berkeley.cs.scads.piql.plans.QueryPlan, List[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</span><a href="#24941" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, idxPlan: edu.berkeley.cs.scads.piql.plans.RemotePlan)edu.berkeley.cs.scads.piql.plans.QueryPlan">derefPlan</a><span class="delimiter">(</span><a href="#45806" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#46026" title="edu.berkeley.cs.scads.piql.plans.IndexScanJoin">idxJoinPlan</a><span class="delimiter">)</span>, <a href="#46025" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.QueryPlan" id="45812">fullPlan</a> = <a href="#45801" title="Boolean">dataStop</a> <span title="edu.berkeley.cs.scads.piql.plans.QueryPlan" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.QueryPlan" class="keyword">true</span> =&gt; <a href="#45810" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">joinPlan</a>
          <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.LocalStopAfter" class="keyword">false</span> =&gt; <a href="QueryPlan.scala.html#51864" title="(count: edu.berkeley.cs.scads.piql.plans.Limit, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.LocalStopAfter">LocalStopAfter</a><span class="delimiter">(</span><a href="#45800" title="edu.berkeley.cs.scads.piql.plans.Limit">count</a>, <a href="#45810" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">joinPlan</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <a href="#48898" title="(physicalPlan: edu.berkeley.cs.scads.piql.plans.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span><a href="#45812" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">fullPlan</a>, <a href="#45811" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">Selection</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.Predicate" id="46226">pred</a>, <a title="edu.berkeley.cs.scads.piql.plans.LogicalPlan" id="46227">child</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan" id="46228">optChild</a> = <a href="#24940" title="(logicalPlan: edu.berkeley.cs.scads.piql.plans.LogicalPlan)edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">apply</a><span class="delimiter">(</span><a href="#46227" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">child</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.Predicate" id="46229">boundPred</a> = <a href="#24944" title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.plans.Predicate">bindPredicate</a><span class="delimiter">(</span><a href="#46226" title="edu.berkeley.cs.scads.piql.plans.Predicate">pred</a>, <a href="#46228" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#45099" title="=&gt; edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span>
        <a href="#46228" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#48898" title="(physicalPlan: edu.berkeley.cs.scads.piql.plans.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">copy</a><span class="delimiter">(</span>physicalPlan = <a href="QueryPlan.scala.html#51879" title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.LocalSelection">LocalSelection</a><span class="delimiter">(</span><a href="#46229" title="edu.berkeley.cs.scads.piql.plans.Predicate">boundPred</a>, <a href="#46228" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#45098" title="=&gt; edu.berkeley.cs.scads.piql.plans.QueryPlan">physicalPlan</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, idxPlan: edu.berkeley.cs.scads.piql.plans.RemotePlan)edu.berkeley.cs.scads.piql.plans.QueryPlan" id="24941">derefPlan</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="45359">ns</a>: <a href="package.scala.html#20256" title="edu.berkeley.cs.scads.piql.package.Namespace">Namespace</a>, <a title="edu.berkeley.cs.scads.piql.plans.RemotePlan" id="45360">idxPlan</a>: <a href="QueryPlan.scala.html#9629" title="edu.berkeley.cs.scads.piql.plans.RemotePlan">RemotePlan</a><span class="delimiter">)</span>: <a href="QueryPlan.scala.html#9628" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">QueryPlan</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.util.List[org.apache.avro.Schema.Field]" id="46237">keyFields</a> = <a href="#45359" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="()java.util.List[org.apache.avro.Schema.Field]">getFields</span>
    <span class="keyword">val</span> <a title="Seq[org.apache.avro.Schema.Field]" id="46238">idxFields</a> = <a href="#24943" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace)Seq[org.apache.avro.Schema.Field]">getFields</a><span class="delimiter">(</span><a href="#45360" title="edu.berkeley.cs.scads.piql.plans.RemotePlan">idxPlan</a>.<a href="QueryPlan.scala.html#33397" title="=&gt; edu.berkeley.cs.scads.piql.package.Namespace">namespace</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.plans.AttributeValue]" id="46239">keyGenerator</a> = <a href="#46237" title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">keyFields</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; edu.berkeley.cs.scads.piql.plans.AttributeValue)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[org.apache.avro.Schema.Field],edu.berkeley.cs.scads.piql.plans.AttributeValue,scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.plans.AttributeValue]])scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.plans.AttributeValue]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,edu.berkeley.cs.scads.piql.plans.AttributeValue,scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.plans.AttributeValue]]" class="delimiter">(</span><a title="org.apache.avro.Schema.Field" id="46694">kf</a> =&gt; <a href="QueryPlan.scala.html#51932" title="(recordPosition: Int, fieldPosition: Int)edu.berkeley.cs.scads.piql.plans.AttributeValue">AttributeValue</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#46238" title="Seq[org.apache.avro.Schema.Field]">idxFields</a>.<span title="(p: org.apache.avro.Schema.Field =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#46707" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span> <span title="(x$1: Any)Boolean">equals</span> <a href="#46694" title="org.apache.avro.Schema.Field">kf</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="QueryPlan.scala.html#51891" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, key: edu.berkeley.cs.scads.piql.package.KeyGenerator, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.IndexLookupJoin">IndexLookupJoin</a><span class="delimiter">(</span><a href="#45359" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#46239" title="scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.plans.AttributeValue]">keyGenerator</a>, <a href="#45360" title="edu.berkeley.cs.scads.piql.plans.RemotePlan">idxPlan</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Returns true only if the given equality predicates can be satisfied by a prefix scan
   * over the given namespace
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean" id="24942">isPrefix</a><span class="delimiter">(</span><a title="Seq[String]" id="45037">attrNames</a>: <span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="edu.berkeley.cs.scads.piql.package.Namespace" id="45038">ns</a>: <a href="package.scala.html#20256" title="edu.berkeley.cs.scads.piql.package.Namespace">Namespace</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.Buffer[java.lang.String]" id="46971">primaryKeyAttrs</a> = <a href="#45038" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>.<span title="(n: Int)scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">take</span><span class="delimiter">(</span><a href="#45037" title="Seq[String]">attrNames</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[org.apache.avro.Schema.Field],java.lang.String,scala.collection.mutable.Buffer[java.lang.String]])scala.collection.mutable.Buffer[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,java.lang.String,scala.collection.mutable.Buffer[java.lang.String]]" class="delimiter">(</span><a href="#47146" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>
    <a href="#45037" title="Seq[String]">attrNames</a>.<span title="(f: String =&gt; Boolean)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],Boolean,Seq[Boolean]])Seq[Boolean]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Boolean,Seq[Boolean]]" class="delimiter">(</span><a href="#46971" title="scala.collection.mutable.Buffer[java.lang.String]">primaryKeyAttrs</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#47192" title="String">_</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(op: (Boolean, Boolean) =&gt; Boolean)Boolean">reduceLeft</span><span class="delimiter">(</span><a href="#47220" title="Boolean">_</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#47221" title="Boolean">_</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Returns the key/value schemas concatenated
   * TODO: push into storage client
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(ns: edu.berkeley.cs.scads.piql.package.Namespace)Seq[org.apache.avro.Schema.Field]" id="24943">getFields</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="46240">ns</a>: <a href="package.scala.html#20256" title="edu.berkeley.cs.scads.piql.package.Namespace">Namespace</a><span class="delimiter">)</span>: <span title="Seq[org.apache.avro.Schema.Field]">Seq</span><span class="delimiter">[</span>Field<span class="delimiter">]</span> =
    <a href="#46240" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>.<span title="=&gt; Seq[org.apache.avro.Schema.Field]">toSeq</span> <span title="(that: scala.collection.GenTraversableOnce[org.apache.avro.Schema.Field])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],org.apache.avro.Schema.Field,Seq[org.apache.avro.Schema.Field]])Seq[org.apache.avro.Schema.Field]">++</span> <a href="#46240" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">valueSchema</span>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>

  <span class="comment">/**
   * Given a list of predicates, replace all UnboundAttributeValues with Attribute values
   * with the correct record/field positions
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.plans.Predicate" id="24944">bindPredicate</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.Predicate" id="46230">predicate</a>: <a href="QueryPlan.scala.html#9618" title="edu.berkeley.cs.scads.piql.plans.Predicate">Predicate</a>, <a title="edu.berkeley.cs.scads.piql.package.TupleSchema" id="46231">schema</a>: <span title="edu.berkeley.cs.scads.piql.package.TupleSchema">TupleSchema</span><span class="delimiter">)</span>: <a href="QueryPlan.scala.html#9618" title="edu.berkeley.cs.scads.piql.plans.Predicate">Predicate</a> = <a href="#46230" title="edu.berkeley.cs.scads.piql.plans.Predicate">predicate</a> <span title="edu.berkeley.cs.scads.piql.plans.Predicate" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.EqualityPredicate">EqualityPredicate</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.Value" id="47496">l</a>, <a title="edu.berkeley.cs.scads.piql.plans.Value" id="47497">r</a><span class="delimiter">)</span> =&gt; <a href="QueryPlan.scala.html#51916" title="(v1: edu.berkeley.cs.scads.piql.plans.Value, v2: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.plans.EqualityPredicate">EqualityPredicate</a><span class="delimiter">(</span><a href="#24947" title="(value: edu.berkeley.cs.scads.piql.plans.Value, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.plans.Value">bindValue</a><span class="delimiter">(</span><a href="#47496" title="edu.berkeley.cs.scads.piql.plans.Value">l</a>, <a href="#46231" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span>, <a href="#24947" title="(value: edu.berkeley.cs.scads.piql.plans.Value, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.plans.Value">bindValue</a><span class="delimiter">(</span><a href="#47497" title="edu.berkeley.cs.scads.piql.plans.Value">r</a>, <a href="#46231" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="24945">qualifiedAttribute</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;([^\.]+)\.([^\.]+)&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>
<span title="Int(88)" class="int">88</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(value: edu.berkeley.cs.scads.piql.plans.Value, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.plans.Value" id="24947">bindValue</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.Value" id="45998">value</a>: <a href="QueryPlan.scala.html#9597" title="edu.berkeley.cs.scads.piql.plans.Value">Value</a>, <a title="edu.berkeley.cs.scads.piql.package.TupleSchema" id="45999">schema</a>: <span title="edu.berkeley.cs.scads.piql.package.TupleSchema">TupleSchema</span><span class="delimiter">)</span>: <a href="QueryPlan.scala.html#9597" title="edu.berkeley.cs.scads.piql.plans.Value">Value</a> = <a href="#45998" title="edu.berkeley.cs.scads.piql.plans.Value">value</a> <span title="edu.berkeley.cs.scads.piql.plans.Value" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.AttributeValue">UnboundAttributeValue</span><span class="delimiter">(</span><a href="#24945" title="(target: Any)Option[List[String]]">qualifiedAttribute</a><span class="delimiter">(</span><a title="String" id="47503">relationName</a>, <a title="String" id="47504">attrName</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <a href="#24933" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;attempting to bind qualified attribute: %s.%s in %s&quot;)" class="string">&quot;attempting to bind qualified attribute: %s.%s in %s&quot;</span>, <a href="#47503" title="String">relationName</a>, <a href="#47504" title="String">attrName</a>, <a href="#45999" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Seq[String]" id="47505">relationNames</a> = <a href="#45999" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a>.<span title="(f: edu.berkeley.cs.scads.piql.package.Namespace =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.package.Namespace],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#47529" title="edu.berkeley.cs.scads.piql.package.Namespace">_</a>.<span title="=&gt; String">namespace</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Int" id="47506">recordPosition</a> = <a href="#47505" title="Seq[String]">relationNames</a>.<span title="(p: String =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#47557" title="String">_</a> <span title="(x$1: Any)Boolean">equals</span> <a href="#47503" title="String">relationName</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Seq[org.apache.avro.Schema.Field]" id="47507">fields</a> = <a href="#24943" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace)Seq[org.apache.avro.Schema.Field]">getFields</a><span class="delimiter">(</span><a href="#45999" title="(idx: Int)edu.berkeley.cs.scads.piql.package.Namespace">schema</a><span class="delimiter">(</span><a href="#47506" title="Int">recordPosition</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Int" id="47508">fieldPosition</a> = <a href="#47507" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(p: org.apache.avro.Schema.Field =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#47575" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span> <span title="(x$1: Any)Boolean">equals</span> <a href="#47504" title="String">attrName</a><span class="delimiter">)</span>
      <a href="#24933" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;selecting position (%s):%d, (%s):%d &quot;)" class="string">&quot;selecting position (%s):%d, (%s):%d &quot;</span>, <a href="#47505" title="Seq[String]">relationNames</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span>, <a href="#47506" title="Int">recordPosition</a>, <a href="#47507" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span>, <a href="#47508" title="Int">fieldPosition</a><span class="delimiter">)</span>
      <a href="QueryPlan.scala.html#51932" title="(recordPosition: Int, fieldPosition: Int)edu.berkeley.cs.scads.piql.plans.AttributeValue">AttributeValue</a><span class="delimiter">(</span><a href="#47506" title="Int">recordPosition</a>, <a href="#47508" title="Int">fieldPosition</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.AttributeValue">UnboundAttributeValue</span><span class="delimiter">(</span><a title="java.lang.String" id="47589">name</a>: <span title="String">String</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <span class="comment">//TODO: Throw execption when ambiguious</span>
      <a href="#24933" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;attempting to bind %s in %s&quot;)" class="string">&quot;attempting to bind %s in %s&quot;</span>, <a href="#47589" title="java.lang.String">name</a>, <a href="#45999" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Seq[Seq[org.apache.avro.Schema.Field]]" id="47590">recordSchemas</a> = <a href="#45999" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a>.<span title="(f: edu.berkeley.cs.scads.piql.package.Namespace =&gt; Seq[org.apache.avro.Schema.Field])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.package.Namespace],Seq[org.apache.avro.Schema.Field],Seq[Seq[org.apache.avro.Schema.Field]]])Seq[Seq[org.apache.avro.Schema.Field]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Seq[org.apache.avro.Schema.Field],Seq[Seq[org.apache.avro.Schema.Field]]]" class="delimiter">(</span><a href="#24943" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace)Seq[org.apache.avro.Schema.Field]">getFields</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Int" id="47591">recordPosition</a> = <a href="#47590" title="Seq[Seq[org.apache.avro.Schema.Field]]">recordSchemas</a>.<span title="(p: Seq[org.apache.avro.Schema.Field] =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#47635" title="Seq[org.apache.avro.Schema.Field]">_</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#47652" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span> <span title="(elem: Any)Boolean">contains</span> <a href="#47589" title="java.lang.String">name</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Int" id="47592">fieldPosition</a> = <a href="#47590" title="(idx: Int)Seq[org.apache.avro.Schema.Field]">recordSchemas</a><span class="delimiter">(</span><a href="#47591" title="Int">recordPosition</a><span class="delimiter">)</span>.<span title="(p: org.apache.avro.Schema.Field =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#47699" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span> <span title="(x$1: Any)Boolean">equals</span> <a href="#47589" title="java.lang.String">name</a><span class="delimiter">)</span>
      <a href="QueryPlan.scala.html#51932" title="(recordPosition: Int, fieldPosition: Int)edu.berkeley.cs.scads.piql.plans.AttributeValue">AttributeValue</a><span class="delimiter">(</span><a href="#47591" title="Int">recordPosition</a>, <a href="#47592" title="Int">fieldPosition</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">case</span> <a title="edu.berkeley.cs.scads.piql.plans.Value" id="47705">otherValue</a> =&gt; <a href="#47705" title="edu.berkeley.cs.scads.piql.plans.Value">otherValue</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Given a namespace and a set of attribute equality predicates return
   * at the keyGenerator
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator" id="24948">makeKeyGenerator</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="45109">ns</a>: <a href="package.scala.html#20256" title="edu.berkeley.cs.scads.piql.package.Namespace">Namespace</a>, <a title="edu.berkeley.cs.scads.piql.package.TupleSchema" id="45110">schema</a>: <span title="edu.berkeley.cs.scads.piql.package.TupleSchema">TupleSchema</span>, <a title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]" id="45111">equalityPreds</a>: <span title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">Seq</span><span class="delimiter">[</span>AttributeEquality<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="edu.berkeley.cs.scads.piql.package.KeyGenerator">KeyGenerator</span> = <span class="delimiter">{</span>
    <a href="#45109" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>.<span title="(n: Int)scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">take</span><span class="delimiter">(</span><a href="#45111" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>.<span title="(f: org.apache.avro.Schema.Field =&gt; edu.berkeley.cs.scads.piql.plans.Value)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[org.apache.avro.Schema.Field],edu.berkeley.cs.scads.piql.plans.Value,edu.berkeley.cs.scads.piql.package.KeyGenerator])edu.berkeley.cs.scads.piql.package.KeyGenerator">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,edu.berkeley.cs.scads.piql.plans.Value,scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.plans.Value]]" class="delimiter">(</span><a title="org.apache.avro.Schema.Field" id="47862">f</a> =&gt; <span class="delimiter">{</span>
      <a href="#24933" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Looking for key generator value for field %s in %s&quot;)" class="string">&quot;Looking for key generator value for field %s in %s&quot;</span>, <a href="#47862" title="org.apache.avro.Schema.Field">f</a>.<span title="()java.lang.String">name</span>, <a href="#45111" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.Value" id="47863">value</a> = <a href="#45111" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(p: edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality =&gt; Boolean)Option[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">find</span><span class="delimiter">(</span><a href="#47873" title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">_</a>.<a href="#48420" title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25240" title="=&gt; String">unqualifiedName</a> <span title="(x$1: Any)Boolean">equals</span> <a href="#47862" title="org.apache.avro.Schema.Field">f</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>.<span title="(default: =&gt; edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality)edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">getOrElse</span><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <span title="edu.berkeley.cs.scads.piql.opt.ImplementationLimitation" class="keyword">new</span> <a href="#48905" title="edu.berkeley.cs.scads.piql.opt.ImplementationLimitation">ImplementationLimitation</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Invalid prefix&quot;)" class="string">&quot;Invalid prefix&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="#48421" title="=&gt; edu.berkeley.cs.scads.piql.plans.Value">value</a>
      <a href="#24947" title="(value: edu.berkeley.cs.scads.piql.plans.Value, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.plans.Value">bindValue</a><span class="delimiter">(</span><a href="#47863" title="edu.berkeley.cs.scads.piql.plans.Value">value</a>, <a href="#45110" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  case <span class="keyword">class</span> <a title="class AttributeEquality extends java.lang.Object with ScalaObject with Product with Serializable" id="48894">AttributeEquality</a><a href="#48894" title="ScalaObject" class="delimiter">(</a><a title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue" id="48420">attribute</a>: <a href="QueryPlan.scala.html#51928" title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">UnboundAttributeValue</a>, <a title="edu.berkeley.cs.scads.piql.plans.Value" id="48421">value</a>: <a href="QueryPlan.scala.html#9597" title="edu.berkeley.cs.scads.piql.plans.Value">Value</a><span class="delimiter">)</span>

  case <span class="keyword">class</span> <a title="class Ordering extends java.lang.Object with ScalaObject with Product with Serializable" id="48890">Ordering</a><a href="#48890" title="ScalaObject" class="delimiter">(</a><a title="Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue]" id="48277">attributes</a>: <span title="Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue]">Seq</span><span class="delimiter">[</span>UnboundAttributeValue<span class="delimiter">]</span>, <a title="Boolean" id="48278">ascending</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>

  case <span class="keyword">class</span> <a title="class TupleLimit extends java.lang.Object with ScalaObject with Product with Serializable" id="48886">TupleLimit</a><a href="#48886" title="ScalaObject" class="delimiter">(</a><a title="edu.berkeley.cs.scads.piql.plans.Limit" id="48096">count</a>: <a href="QueryPlan.scala.html#9611" title="edu.berkeley.cs.scads.piql.plans.Limit">Limit</a>, <a title="Boolean" id="48097">isDataStop</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Groups sets of logical operations that can be executed as a
   * single get operations against the key value store
   */</span>
  <span class="keyword">protected</span> <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.opt.Optimizer.IndexRange" id="24958">IndexRange</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(logicalPlan: edu.berkeley.cs.scads.piql.plans.LogicalPlan)Option[(Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan)]" id="44953">unapply</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.LogicalPlan" id="44954">logicalPlan</a>: <a href="LogicalPlan.scala.html#9547" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">LogicalPlan</a><span class="delimiter">)</span>: <span title="Option[(Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan)]">Option</span><span class="delimiter">[</span><span class="delimiter">(</span>Seq<span class="delimiter">[</span>AttributeEquality<span class="delimiter">]</span>, Option<span class="delimiter">[</span>TupleLimit<span class="delimiter">]</span>, Option<span class="delimiter">[</span>Ordering<span class="delimiter">]</span>, LogicalPlan<span class="delimiter">)</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a href="#48044" title="(Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.plans.LogicalPlan)" class="delimiter">(</a><a href="#48043" title="Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit]" id="48044">limit</a>, <a href="#48043" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan" id="48045">planWithoutStop</a><span class="delimiter">)</span> = <a href="#44954" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">logicalPlan</a> <span title="(Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.plans.LogicalPlan)" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="(Some[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.plans.LogicalPlan)">StopAfter</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.Limit" id="48088">count</a>, <a title="edu.berkeley.cs.scads.piql.plans.LogicalPlan" id="48089">child</a><span class="delimiter">)</span> =&gt; <span title="(_1: Some[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], _2: edu.berkeley.cs.scads.piql.plans.LogicalPlan)(Some[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.plans.LogicalPlan)" class="delimiter">(</span><span title="(x: edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit)Some[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit]">Some</span><span class="delimiter">(</span><a href="#48886" title="(count: edu.berkeley.cs.scads.piql.plans.Limit, isDataStop: Boolean)edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit">TupleLimit</a><span class="delimiter">(</span><a href="#48088" title="edu.berkeley.cs.scads.piql.plans.Limit">count</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#48089" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">child</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="(Some[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.plans.LogicalPlan)">DataStopAfter</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.Limit" id="48136">count</a>, <a title="edu.berkeley.cs.scads.piql.plans.LogicalPlan" id="48137">child</a><span class="delimiter">)</span> =&gt; <span title="(_1: Some[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], _2: edu.berkeley.cs.scads.piql.plans.LogicalPlan)(Some[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.plans.LogicalPlan)" class="delimiter">(</span><span title="(x: edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit)Some[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit]">Some</span><span class="delimiter">(</span><a href="#48886" title="(count: edu.berkeley.cs.scads.piql.plans.Limit, isDataStop: Boolean)edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit">TupleLimit</a><span class="delimiter">(</span><a href="#48136" title="edu.berkeley.cs.scads.piql.plans.Limit">count</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#48137" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">child</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="(None.type, edu.berkeley.cs.scads.piql.plans.LogicalPlan)" id="48147">otherOp</a> =&gt; <span title="(_1: None.type, _2: edu.berkeley.cs.scads.piql.plans.LogicalPlan)(None.type, edu.berkeley.cs.scads.piql.plans.LogicalPlan)" class="delimiter">(</span><span title="object None">None</span>, <a href="#48147" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">otherOp</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="comment">//TODO: check to make sure these are fields in the base relation</span>
      <span class="keyword">val</span> <a href="#48047" title="(Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan)" class="delimiter">(</a><a href="#48046" title="Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering]" id="48047">ordering</a>, <a href="#48046" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan" id="48048">planWithoutSort</a><span class="delimiter">)</span> = <a href="#48045" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">planWithoutStop</a> <span title="(Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan)" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="(Some[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan)">Sort</span><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.plans.Value]" id="48225">attrs</a>, <a title="Boolean" id="48226">asc</a>, <a title="edu.berkeley.cs.scads.piql.plans.LogicalPlan" id="48227">child</a><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#48225" title="Seq[edu.berkeley.cs.scads.piql.plans.Value]">attrs</a>.<span title="(f: edu.berkeley.cs.scads.piql.plans.Value =&gt; Boolean)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.plans.Value],Boolean,Seq[Boolean]])Seq[Boolean]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Boolean,Seq[Boolean]]" class="delimiter">(</span><a href="#48244" title="edu.berkeley.cs.scads.piql.plans.Value">_</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="QueryPlan.scala.html#51928" title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">UnboundAttributeValue</a><span class="delimiter">]</span><span class="delimiter">)</span>.<span title="(op: (Boolean, Boolean) =&gt; Boolean)Boolean">reduceLeft</span><span class="delimiter">(</span><a href="#48269" title="Boolean">_</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#48270" title="Boolean">_</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <span title="(_1: Some[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], _2: edu.berkeley.cs.scads.piql.plans.LogicalPlan)(Some[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan)" class="delimiter">(</span><span title="(x: edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering)Some[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering]">Some</span><span class="delimiter">(</span><a href="#48890" title="(attributes: Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue], ascending: Boolean)edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering">Ordering</a><span class="delimiter">(</span><a href="#48225" title="Seq[edu.berkeley.cs.scads.piql.plans.Value]">attrs</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue]" class="delimiter">[</span><span title="Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue]">Seq</span><span class="delimiter">[</span>UnboundAttributeValue<span class="delimiter">]</span><span class="delimiter">]</span>, <a href="#48226" title="Boolean">asc</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#48227" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">child</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <a title="(None.type, edu.berkeley.cs.scads.piql.plans.LogicalPlan)" id="48287">otherOp</a> =&gt; <span title="(_1: None.type, _2: edu.berkeley.cs.scads.piql.plans.LogicalPlan)(None.type, edu.berkeley.cs.scads.piql.plans.LogicalPlan)" class="delimiter">(</span><span title="object None">None</span>, <a href="#48287" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">otherOp</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a href="#48050" title="(Seq[edu.berkeley.cs.scads.piql.plans.Predicate], Option[edu.berkeley.cs.scads.piql.plans.LogicalPlan])" class="delimiter">(</a><a href="#48049" title="Seq[edu.berkeley.cs.scads.piql.plans.Predicate]" id="48050">predicates</a>, <a href="#48049" title="Option[edu.berkeley.cs.scads.piql.plans.LogicalPlan]" id="48051">planWithoutPredicates</a><span class="delimiter">)</span> = <a href="#48048" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">planWithoutSort</a>.<a href="LogicalPlan.scala.html#23981" title="(f: PartialFunction[edu.berkeley.cs.scads.piql.plans.LogicalPlan,edu.berkeley.cs.scads.piql.plans.Predicate])(Seq[edu.berkeley.cs.scads.piql.plans.Predicate], Option[edu.berkeley.cs.scads.piql.plans.LogicalPlan])">gatherUntil</a> <a href="#48332" title="edu.berkeley.cs.scads.piql.plans.Predicate" class="delimiter">{</a>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.Predicate">Selection</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.Predicate" id="48333">pred</a>, _<span class="delimiter">)</span> =&gt; <a href="#48333" title="edu.berkeley.cs.scads.piql.plans.Predicate">pred</a>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.LogicalPlan" id="48052">basePlan</a> = <a href="#48051" title="Option[edu.berkeley.cs.scads.piql.plans.LogicalPlan]">planWithoutPredicates</a>.<span title="(default: =&gt; edu.berkeley.cs.scads.piql.plans.LogicalPlan)edu.berkeley.cs.scads.piql.plans.LogicalPlan">getOrElse</span> <span class="delimiter">{</span>
        <a href="#24933" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;IndexRange match failed.  No base plan&quot;)" class="string">&quot;IndexRange match failed.  No base plan&quot;</span><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span> <span title="object None">None</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.package.Namespace" id="48053">ns</a> = <a href="#48052" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">basePlan</a> <span title="edu.berkeley.cs.scads.piql.package.Namespace" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.package.Namespace">Relation</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="48355">ns</a><span class="delimiter">)</span> =&gt; <a href="#48355" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.package.Namespace">Join</span><span class="delimiter">(</span>_, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="48356">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#48356" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>
        <span class="keyword">case</span> <a title="Nothing" id="48357">otherOp</a> =&gt; <span class="delimiter">{</span>
          <a href="#24933" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;IndexRange match failed.  Invalid base plan: %s&quot;)" class="string">&quot;IndexRange match failed.  Invalid base plan: %s&quot;</span>, <a href="#48357" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">otherOp</a><span class="delimiter">)</span>
          <span title="Nothing" class="keyword">return</span> <span title="object None">None</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="Seq[org.apache.avro.Schema.Field]" id="48054">fields</a> = <a href="#24943" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace)Seq[org.apache.avro.Schema.Field]">getFields</a><span class="delimiter">(</span><a href="#48053" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]" id="48055">idxEqPreds</a> = <a href="#48050" title="Seq[edu.berkeley.cs.scads.piql.plans.Predicate]">predicates</a>.<span title="(f: edu.berkeley.cs.scads.piql.plans.Predicate =&gt; edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.plans.Predicate],edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality,Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]])Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">map</span> <a href="#48378" title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality" class="delimiter">{</a>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">EqualityPredicate</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.Value" id="48379">v</a>: <a href="QueryPlan.scala.html#9597" title="edu.berkeley.cs.scads.piql.plans.Value">Value</a>, <a title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue" id="48380">u</a>@UnboundAttributeValue<span class="delimiter">(</span><a href="#24945" title="(target: Any)Option[List[String]]">qualifiedAttribute</a><span class="delimiter">(</span><a title="String" id="48382">relName</a>, <a title="String" id="48383">attrName</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#48382" title="String">relName</a>.<span title="(x$1: Any)Boolean">equals</span><span class="delimiter">(</span><a href="#48053" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; String">namespace</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#48054" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#48400" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#48383" title="String">attrName</a><span class="delimiter">)</span> =&gt;
          <a href="#48894" title="(attribute: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue, value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">AttributeEquality</a><span class="delimiter">(</span><a href="#48380" title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">u</a>, <a href="#48379" title="edu.berkeley.cs.scads.piql.plans.Value">v</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">EqualityPredicate</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue" id="48427">u</a>@UnboundAttributeValue<span class="delimiter">(</span><a href="#24945" title="(target: Any)Option[List[String]]">qualifiedAttribute</a><span class="delimiter">(</span><a title="String" id="48429">relName</a>, <a title="String" id="48430">attrName</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a title="edu.berkeley.cs.scads.piql.plans.Value" id="48431">v</a>: <a href="QueryPlan.scala.html#9597" title="edu.berkeley.cs.scads.piql.plans.Value">Value</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#48429" title="String">relName</a>.<span title="(x$1: Any)Boolean">equals</span><span class="delimiter">(</span><a href="#48053" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; String">namespace</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#48054" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#48442" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#48430" title="String">attrName</a><span class="delimiter">)</span> =&gt;
          <a href="#48894" title="(attribute: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue, value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">AttributeEquality</a><span class="delimiter">(</span><a href="#48427" title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">u</a>, <a href="#48431" title="edu.berkeley.cs.scads.piql.plans.Value">v</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">EqualityPredicate</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.Value" id="48462">v</a>: <a href="QueryPlan.scala.html#9597" title="edu.berkeley.cs.scads.piql.plans.Value">Value</a>, <a title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue" id="48463">u</a>@UnboundAttributeValue<span class="delimiter">(</span><a title="String" id="48464">attrName</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#48054" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#48475" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#48464" title="String">attrName</a><span class="delimiter">)</span> =&gt;
          <a href="#48894" title="(attribute: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue, value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">AttributeEquality</a><span class="delimiter">(</span><a href="#48463" title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">u</a>, <a href="#48462" title="edu.berkeley.cs.scads.piql.plans.Value">v</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">EqualityPredicate</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue" id="48495">u</a>@UnboundAttributeValue<span class="delimiter">(</span><a title="String" id="48496">attrName</a><span class="delimiter">)</span>, <a title="edu.berkeley.cs.scads.piql.plans.Value" id="48497">v</a>: <a href="QueryPlan.scala.html#9597" title="edu.berkeley.cs.scads.piql.plans.Value">Value</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#48054" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#48508" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#48496" title="String">attrName</a><span class="delimiter">)</span> =&gt;
          <a href="#48894" title="(attribute: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue, value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">AttributeEquality</a><span class="delimiter">(</span><a href="#48495" title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">u</a>, <a href="#48497" title="edu.berkeley.cs.scads.piql.plans.Value">v</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="Nothing" id="48528">otherPred</a> =&gt; <span class="delimiter">{</span>
          <a href="#24933" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;IndexScan match failed.  Can\'t apply %s to index scan of %s.{%s}&quot;)" class="string">&quot;IndexScan match failed.  Can't apply %s to index scan of %s.{%s}&quot;</span>, <a href="#48528" title="edu.berkeley.cs.scads.piql.plans.Predicate">otherPred</a>, <a href="#48053" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; String">namespace</span>, <a href="#48053" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[org.apache.avro.Schema.Field],java.lang.String,scala.collection.mutable.Buffer[java.lang.String]])scala.collection.mutable.Buffer[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,java.lang.String,scala.collection.mutable.Buffer[java.lang.String]]" class="delimiter">(</span><a href="#48813" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="Nothing" class="keyword">return</span> <span title="object None">None</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="(Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan)" id="48056">getOp</a> = <span title="(_1: Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality], _2: Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], _3: Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], _4: edu.berkeley.cs.scads.piql.plans.LogicalPlan)(Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan)" class="delimiter">(</span><a href="#48055" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">idxEqPreds</a>, <a href="#48044" title="Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit]">limit</a>, <a href="#48047" title="Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering]">ordering</a>, <a href="#48052" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">basePlan</a><span class="delimiter">)</span>
      <a href="#24933" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Matched IndexRange%s&quot;)" class="string">&quot;Matched IndexRange%s&quot;</span>, <a href="#48056" title="(Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan)">getOp</a><span class="delimiter">)</span>
      <span title="(x: (Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan))Some[(Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan)]">Some</span><span class="delimiter">(</span><a href="#48056" title="(Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan)">getOp</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>