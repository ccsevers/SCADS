<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>Optimizer.scala</title>
        <script type="text/javascript" src="jquery-all.js"></script>
        <script type="text/javascript" src="linked.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs
<span class="keyword">package</span> scads
<span class="keyword">package</span> piql
<span class="keyword">package</span> opt

<span class="keyword">import</span> plans._
<span class="keyword">import</span> storage.client.index._

<span class="keyword">import</span> org.apache.avro.Schema
<span class="keyword">import</span> org.apache.avro.<span title="object org.apache.avro.Schema">Schema</span>.Field
<span class="keyword">import</span> org.apache.avro.util.Utf8
<span class="keyword">import</span> scala.collection.<span title="object scala.collection.JavaConversions">JavaConversions</span>._
<span class="keyword">import</span> net.lag.logging.Logger

case <span class="keyword">class</span> <a title="class ImplementationLimitation extends java.lang.Exception with ScalaObject with Product with Serializable" id="50656">ImplementationLimitation</a><a href="#50656" title="ScalaObject" class="delimiter">(</a><a title="String" id="50653">desc</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="java.lang.Exception">Exception</span>

<span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.opt.OptimizedQuery" id="9585">OptimizedQuery</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentHashMap[Int,edu.berkeley.cs.scads.piql.plans.QueryPlan]" id="45124">physicalPlans</a> = <span title="()java.util.concurrent.ConcurrentHashMap[Int,edu.berkeley.cs.scads.piql.plans.QueryPlan]" class="keyword">new</span> java.util.concurrent.<span title="java.util.concurrent.ConcurrentHashMap[Int,edu.berkeley.cs.scads.piql.plans.QueryPlan]">ConcurrentHashMap</span><span class="delimiter">[</span>Int, QueryPlan<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class OptimizedQuery extends java.lang.Object with ScalaObject" id="9587">OptimizedQuery</a><a href="#9587" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="Option[String]" id="24940">name</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.QueryPlan" id="24941">physicalPlan</a>: <a href="QueryPlan.scala.html#9630" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">QueryPlan</a>, <a title="edu.berkeley.cs.scads.piql.package.QueryExecutor" id="24942">executor</a>: <a href="Iterators.scala.html#9532" title="edu.berkeley.cs.scads.piql.package.QueryExecutor">QueryExecutor</a><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(args: Any*)edu.berkeley.cs.scads.piql.package.QueryResult" id="24938">apply</a><span class="delimiter">(</span><a title="Any*" id="45449">args</a>: <span title="Any*">Any</span>*<span class="delimiter">)</span>: <span title="edu.berkeley.cs.scads.piql.package.QueryResult">QueryResult</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Seq[Any]" id="45451">encodedArgs</a> = <a href="#45449" title="Any*">args</a>.<span title="(f: Any =&gt; Any)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[Any],Any,Seq[Any]])Seq[Any]">map</span> <a href="#45470" title="Any" class="delimiter">{</a>
      <span class="keyword">case</span> <a title="org.apache.avro.util.Utf8" id="45471">s</a>: <span title="String">String</span> =&gt; <span title="(x$1: java.lang.String)org.apache.avro.util.Utf8" class="keyword">new</span> <span title="org.apache.avro.util.Utf8">Utf8</span><span class="delimiter">(</span><a href="#45471" title="String">s</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="Any" id="45476">o</a> =&gt; <a href="#45476" title="Any">o</a>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.exec.QueryIterator" id="45452">iterator</a> = <a href="Iterators.scala.html#24946" title="(plan: edu.berkeley.cs.scads.piql.plans.QueryPlan, args: Any*)edu.berkeley.cs.scads.piql.exec.QueryIterator">executor</a><span class="delimiter">(</span><a href="#24941" title="=&gt; edu.berkeley.cs.scads.piql.plans.QueryPlan">physicalPlan</a>, <a href="#45451" title="Seq[Any]">encodedArgs</a>: _*<span class="delimiter">)</span>
    <a href="#45452" title="edu.berkeley.cs.scads.piql.exec.QueryIterator">iterator</a>.<a href="Iterators.scala.html#28851" title="=&gt; Unit">open</a>
    <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Tuple]" id="45453">ret</a> = <a href="#45452" title="edu.berkeley.cs.scads.piql.exec.QueryIterator">iterator</a>.<span title="=&gt; List[edu.berkeley.cs.scads.piql.package.Tuple]">toList</span>
    <a href="#45452" title="edu.berkeley.cs.scads.piql.exec.QueryIterator">iterator</a>.<a href="Iterators.scala.html#28852" title="=&gt; Unit">close</a>
    <a href="#45453" title="List[edu.berkeley.cs.scads.piql.package.Tuple]">ret</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; scala.xml.NodeSeq" id="24939">toHtml</a>: xml.<span title="scala.xml.NodeSeq">NodeSeq</span> = <span class="delimiter">{</span>
    &lt;<a title="scala.xml.Elem" id="46299">b</a>&gt;
      <span class="delimiter">{</span><a href="#24941" title="=&gt; edu.berkeley.cs.scads.piql.plans.QueryPlan">physicalPlan</a><span class="delimiter">}</span>
    &lt;/b&gt;
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.opt.Optimizer" id="9588">Optimizer</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="23807">logger</a> = <span title="()net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="Int" id="23809">defaultFetchSize</a> = <span title="Int(10)" class="int">10</span>

  case <span class="keyword">class</span> <a title="class OptimizedSubPlan extends java.lang.Object with ScalaObject with Product with Serializable" id="50649">OptimizedSubPlan</a><a href="#50649" title="ScalaObject" class="delimiter">(</a><a title="edu.berkeley.cs.scads.piql.plans.QueryPlan" id="46948">physicalPlan</a>: <a href="QueryPlan.scala.html#9630" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">QueryPlan</a>, <a title="edu.berkeley.cs.scads.piql.package.TupleSchema" id="46949">schema</a>: <span title="edu.berkeley.cs.scads.piql.package.TupleSchema">TupleSchema</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(logicalPlan: edu.berkeley.cs.scads.piql.plans.LogicalPlan)edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan" id="23814">apply</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.LogicalPlan" id="23834">logicalPlan</a>: <a href="LogicalPlan.scala.html#9549" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">LogicalPlan</a><span class="delimiter">)</span>: <a href="#50649" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a> = <span class="delimiter">{</span>
    <a href="#23807" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Optimizing subplan: %s&quot;)" class="string">&quot;Optimizing subplan: %s&quot;</span>, <a href="#23834" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">logicalPlan</a><span class="delimiter">)</span>

    <a href="#23834" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">logicalPlan</a> <span title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#46858" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">IndexRange</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]" id="46862">equalityPreds</a>, <span title="object None">None</span>, <span title="object None">None</span>, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="46879">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#46862" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <a href="#46879" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="()java.util.List[org.apache.avro.Schema.Field]">getFields</span>.<span title="()Int">size</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
        <a href="#23816" title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean">isPrefix</a><span class="delimiter">(</span><a href="#46862" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#46909" title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">_</a>.<a href="#50171" title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25062" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span>, <a href="#46879" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="46943">tupleSchema</a> = <a href="#46879" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#46944" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>
        <a href="#50649" title="(physicalPlan: edu.berkeley.cs.scads.piql.plans.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span>
          <a href="QueryPlan.scala.html#32107" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, key: edu.berkeley.cs.scads.piql.package.KeyGenerator)edu.berkeley.cs.scads.piql.plans.IndexLookup">IndexLookup</a><span class="delimiter">(</span><a href="#46879" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#23822" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#46879" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#46943" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#46862" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span><span class="delimiter">)</span>,
          <a href="#46943" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#46858" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">IndexRange</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]" id="46969">equalityPreds</a>, Some<span class="delimiter">(</span>TupleLimit<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.Limit" id="47000">count</a>, <a title="Boolean" id="47001">dataStop</a><span class="delimiter">)</span><span class="delimiter">)</span>, <span title="object None">None</span>, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="47002">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan" class="keyword">if</span> <span class="delimiter">(</span><a href="#23816" title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean">isPrefix</a><span class="delimiter">(</span><a href="#46969" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#47019" title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">_</a>.<a href="#50171" title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25062" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span>, <a href="#47002" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#23807" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Using primary index for predicates: %s&quot;)" class="string">&quot;Using primary index for predicates: %s&quot;</span>, <a href="#46969" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="47039">tupleSchema</a> = <a href="#47002" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#47046" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>
          <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.IndexScan" id="47040">idxScanPlan</a> = <a href="QueryPlan.scala.html#33215" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.plans.Limit, ascending: Boolean)edu.berkeley.cs.scads.piql.plans.IndexScan">IndexScan</a><span class="delimiter">(</span><a href="#47002" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#23822" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#47002" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#47039" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#46969" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>, <a href="#47000" title="edu.berkeley.cs.scads.piql.plans.Limit">count</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="&lt;none&gt; extends Product with Serializable with edu.berkeley.cs.scads.piql.plans.QueryPlan" id="47041">fullPlan</a> = <a href="#47001" title="Boolean">dataStop</a> <span title="&lt;none&gt; extends Product with Serializable with edu.berkeley.cs.scads.piql.plans.QueryPlan" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.IndexScan" class="keyword">true</span> =&gt; <a href="#47040" title="edu.berkeley.cs.scads.piql.plans.IndexScan">idxScanPlan</a>
            <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.LocalStopAfter" class="keyword">false</span> =&gt; <a href="QueryPlan.scala.html#37372" title="(count: edu.berkeley.cs.scads.piql.plans.Limit, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.LocalStopAfter">LocalStopAfter</a><span class="delimiter">(</span><a href="#47000" title="edu.berkeley.cs.scads.piql.plans.Limit">count</a>, <a href="#47040" title="edu.berkeley.cs.scads.piql.plans.IndexScan">idxScanPlan</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <a href="#50649" title="(physicalPlan: edu.berkeley.cs.scads.piql.plans.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span><a href="#47041" title="&lt;none&gt; extends Product with Serializable with edu.berkeley.cs.scads.piql.plans.QueryPlan">fullPlan</a>, <a href="#47039" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#23807" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Using secondary index for predicates: %s&quot;)" class="string">&quot;Using secondary index for predicates: %s&quot;</span>, <a href="#46969" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>

          <span class="comment">//TODO: Fix type hack</span>
          <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace" id="47090">idx</a> = <a href="#47002" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.piql.package.IndexedNamespace" class="delimiter">[</span><a href="package.scala.html#47099" title="edu.berkeley.cs.scads.piql.package.IndexedNamespace">IndexedNamespace</a><span class="delimiter">]</span>.<span title="(fields: Seq[edu.berkeley.cs.scads.storage.client.index.IndexType])edu.berkeley.cs.scads.storage.client.index.IndexNamespace">getOrCreateIndex</span><span class="delimiter">(</span><a href="#46969" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality =&gt; edu.berkeley.cs.scads.storage.client.index.AttributeIndex)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality],edu.berkeley.cs.scads.storage.client.index.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.client.index.IndexType]])Seq[edu.berkeley.cs.scads.storage.client.index.IndexType]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.storage.client.index.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.client.index.AttributeIndex]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality" id="47114">p</a> =&gt; <span title="(fieldName: String)edu.berkeley.cs.scads.storage.client.index.AttributeIndex">AttributeIndex</span><span class="delimiter">(</span><a href="#47114" title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">p</a>.<a href="#50171" title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25062" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="47091">tupleSchema</a> = <a href="#47090" title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace">idx</a> <a href="#47211" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <a href="#47002" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#47212" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>
          <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.IndexScan" id="47092">idxScanPlan</a> = <a href="QueryPlan.scala.html#33215" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.plans.Limit, ascending: Boolean)edu.berkeley.cs.scads.piql.plans.IndexScan">IndexScan</a><span class="delimiter">(</span><a href="#47090" title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace">idx</a>, <a href="#23822" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#47090" title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace">idx</a>, <a href="#47091" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#46969" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>, <a href="#47000" title="edu.berkeley.cs.scads.piql.plans.Limit">count</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.QueryPlan" id="47093">derefedPlan</a> = <a href="#23815" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, idxPlan: edu.berkeley.cs.scads.piql.plans.RemotePlan)edu.berkeley.cs.scads.piql.plans.QueryPlan">derefPlan</a><span class="delimiter">(</span><a href="#47002" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#47092" title="edu.berkeley.cs.scads.piql.plans.IndexScan">idxScanPlan</a><span class="delimiter">)</span>

          <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.QueryPlan" id="47094">fullPlan</a> = <a href="#47001" title="Boolean">dataStop</a> <span title="edu.berkeley.cs.scads.piql.plans.QueryPlan" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.QueryPlan" class="keyword">true</span> =&gt; <a href="#47093" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">derefedPlan</a>
            <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.LocalStopAfter" class="keyword">false</span> =&gt; <a href="QueryPlan.scala.html#37372" title="(count: edu.berkeley.cs.scads.piql.plans.Limit, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.LocalStopAfter">LocalStopAfter</a><span class="delimiter">(</span><a href="#47000" title="edu.berkeley.cs.scads.piql.plans.Limit">count</a>, <a href="#47093" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">derefedPlan</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <a href="#50649" title="(physicalPlan: edu.berkeley.cs.scads.piql.plans.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span><a href="#47094" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">fullPlan</a>, <a href="#47091" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#46858" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">IndexRange</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]" id="47239">equalityPreds</a>, <a title="Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit]" id="47240">bound</a>, Some<span class="delimiter">(</span>Ordering<span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue]" id="47275">attrs</a>, <a title="Boolean" id="47276">asc</a><span class="delimiter">)</span><span class="delimiter">)</span>, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="47277">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.Limit" id="47278">limitHint</a> = <a href="#47240" title="Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit]">bound</a>.<span title="(f: edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit =&gt; edu.berkeley.cs.scads.piql.plans.Limit)Option[edu.berkeley.cs.scads.piql.plans.Limit]">map</span><span class="delimiter">(</span><a href="#47289" title="edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit">_</a>.<a href="#49912" title="=&gt; edu.berkeley.cs.scads.piql.plans.Limit">count</a><span class="delimiter">)</span>.<span title="(default: =&gt; edu.berkeley.cs.scads.piql.plans.Limit)edu.berkeley.cs.scads.piql.plans.Limit">getOrElse</span> <span class="delimiter">{</span>
          <a href="#23807" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;UnboundedPlan %s: %s&quot;)" class="string">&quot;UnboundedPlan %s: %s&quot;</span>, <a href="#47277" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#23834" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">logicalPlan</a><span class="delimiter">)</span>
          <a href="QueryPlan.scala.html#31667" title="(count: Int)edu.berkeley.cs.scads.piql.plans.FixedLimit">FixedLimit</a><span class="delimiter">(</span><a href="#23809" title="=&gt; Int">defaultFetchSize</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">val</span> <a title="Boolean" id="47279">isDataStop</a> = <a href="#47240" title="Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit]">bound</a>.<span title="(f: edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit =&gt; Boolean)Option[Boolean]">map</span><span class="delimiter">(</span><a href="#47305" title="edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit">_</a>.<a href="#49913" title="=&gt; Boolean">isDataStop</a><span class="delimiter">)</span>.<span title="(default: =&gt; Boolean)Boolean">getOrElse</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Seq[String]" id="47280">prefixAttrs</a> = <a href="#47239" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#47328" title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">_</a>.<a href="#50171" title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25062" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span> <span title="(that: scala.collection.GenTraversableOnce[String])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],String,Seq[String]])Seq[String]">++</span> <a href="#47275" title="Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue]">attrs</a>.<span title="(f: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#47391" title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">_</a>.<a href="QueryPlan.scala.html#25062" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a href="#47282" title="(edu.berkeley.cs.scads.piql.plans.QueryPlan, List[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</a><a href="#47281" title="edu.berkeley.cs.scads.piql.plans.QueryPlan" id="47282">idxScanPlan</a>, <a href="#47281" title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="47283">tupleSchema</a><span class="delimiter">)</span> =
          <span title="(edu.berkeley.cs.scads.piql.plans.QueryPlan, List[edu.berkeley.cs.scads.piql.package.Namespace])" class="keyword">if</span> <span class="delimiter">(</span><a href="#23816" title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean">isPrefix</a><span class="delimiter">(</span><a href="#47280" title="Seq[String]">prefixAttrs</a>, <a href="#47277" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="47430">tupleSchema</a> = <a href="#47277" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#47431" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>
            <span title="(_1: edu.berkeley.cs.scads.piql.plans.IndexScan, _2: List[edu.berkeley.cs.scads.piql.package.Namespace])(edu.berkeley.cs.scads.piql.plans.IndexScan, List[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</span><a href="QueryPlan.scala.html#33215" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.plans.Limit, ascending: Boolean)edu.berkeley.cs.scads.piql.plans.IndexScan">IndexScan</a><span class="delimiter">(</span><a href="#47277" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#23822" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#47277" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#47430" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#47239" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>, <a href="#47278" title="edu.berkeley.cs.scads.piql.plans.Limit">limitHint</a>, <a href="#47276" title="Boolean">asc</a><span class="delimiter">)</span>, <a href="#47430" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <span class="keyword">else</span> <span class="delimiter">{</span>
            <a href="#23807" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Creating index for attributes: %s&quot;)" class="string">&quot;Creating index for attributes: %s&quot;</span>, <a href="#47280" title="Seq[String]">prefixAttrs</a><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace" id="47462">idx</a> = <a href="#47277" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.piql.package.IndexedNamespace" class="delimiter">[</span><a href="package.scala.html#47099" title="edu.berkeley.cs.scads.piql.package.IndexedNamespace">IndexedNamespace</a><span class="delimiter">]</span>.<span title="(fields: Seq[edu.berkeley.cs.scads.storage.client.index.IndexType])edu.berkeley.cs.scads.storage.client.index.IndexNamespace">getOrCreateIndex</span><span class="delimiter">(</span><a href="#47280" title="Seq[String]">prefixAttrs</a>.<span title="(f: String =&gt; edu.berkeley.cs.scads.storage.client.index.AttributeIndex)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],edu.berkeley.cs.scads.storage.client.index.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.client.index.IndexType]])Seq[edu.berkeley.cs.scads.storage.client.index.IndexType]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.storage.client.index.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.client.index.AttributeIndex]]" class="delimiter">(</span><a title="String" id="47484">p</a> =&gt; <span title="(fieldName: String)edu.berkeley.cs.scads.storage.client.index.AttributeIndex">AttributeIndex</span><span class="delimiter">(</span><a href="#47484" title="String">p</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="47463">tupleSchema</a> = <a href="#47462" title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace">idx</a> <a href="#47506" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <a href="#47277" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#47507" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>
            <span title="(_1: edu.berkeley.cs.scads.piql.plans.QueryPlan, _2: List[edu.berkeley.cs.scads.piql.package.Namespace])(edu.berkeley.cs.scads.piql.plans.QueryPlan, List[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</span><a href="#23815" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, idxPlan: edu.berkeley.cs.scads.piql.plans.RemotePlan)edu.berkeley.cs.scads.piql.plans.QueryPlan">derefPlan</a><span class="delimiter">(</span><a href="#47277" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>,
              <a href="QueryPlan.scala.html#33215" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.plans.Limit, ascending: Boolean)edu.berkeley.cs.scads.piql.plans.IndexScan">IndexScan</a><span class="delimiter">(</span><a href="#47462" title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace">idx</a>,
                <a href="#23822" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#47462" title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace">idx</a>, <a href="#47463" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#47239" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>,
                <a href="#47278" title="edu.berkeley.cs.scads.piql.plans.Limit">limitHint</a>,
                <a href="#47276" title="Boolean">asc</a><span class="delimiter">)</span><span class="delimiter">)</span>,
              <a href="#47463" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.QueryPlan" id="47284">fullPlan</a> = <a href="#47279" title="Boolean">isDataStop</a> <span title="edu.berkeley.cs.scads.piql.plans.QueryPlan" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.QueryPlan" class="keyword">true</span> =&gt; <a href="#47282" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">idxScanPlan</a>
          <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.LocalStopAfter" class="keyword">false</span> =&gt; <a href="QueryPlan.scala.html#37372" title="(count: edu.berkeley.cs.scads.piql.plans.Limit, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.LocalStopAfter">LocalStopAfter</a><span class="delimiter">(</span><a href="#47278" title="edu.berkeley.cs.scads.piql.plans.Limit">limitHint</a>, <a href="#47282" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">idxScanPlan</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#50649" title="(physicalPlan: edu.berkeley.cs.scads.piql.plans.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span><a href="#47284" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">fullPlan</a>, <a href="#47283" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#46858" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">IndexRange</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]" id="47547">equalityPreds</a>, <span title="object None">None</span>, <span title="object None">None</span>, Join<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.LogicalPlan" id="47548">child</a>, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="47549">ns</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#47547" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <a href="#47549" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="()java.util.List[org.apache.avro.Schema.Field]">getFields</span>.<span title="()Int">size</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
        <a href="#23816" title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean">isPrefix</a><span class="delimiter">(</span><a href="#47547" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#47572" title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">_</a>.<a href="#50171" title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25062" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span>, <a href="#47549" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan" id="47592">optChild</a> = <a href="#23814" title="(logicalPlan: edu.berkeley.cs.scads.piql.plans.LogicalPlan)edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">apply</a><span class="delimiter">(</span><a href="#47548" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">child</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]" id="47593">tupleSchema</a> = <a href="#47592" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#46949" title="=&gt; edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a> <span title="(elem: edu.berkeley.cs.scads.piql.package.Namespace)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.package.Namespace],edu.berkeley.cs.scads.piql.package.Namespace,Seq[edu.berkeley.cs.scads.piql.package.Namespace]])Seq[edu.berkeley.cs.scads.piql.package.Namespace]">:+</span> <a href="#47549" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>
        <a href="#50649" title="(physicalPlan: edu.berkeley.cs.scads.piql.plans.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span>
          <a href="QueryPlan.scala.html#33749" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, key: edu.berkeley.cs.scads.piql.package.KeyGenerator, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.IndexLookupJoin">IndexLookupJoin</a><span class="delimiter">(</span><a href="#47549" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#23822" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#47549" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#47593" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#47547" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>, <a href="#47592" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#46948" title="=&gt; edu.berkeley.cs.scads.piql.plans.QueryPlan">physicalPlan</a><span class="delimiter">)</span>,
          <a href="#47593" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#46858" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">IndexRange</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]" id="47644">equalityPreds</a>, Some<span class="delimiter">(</span>TupleLimit<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.Limit" id="47646">count</a>, <a title="Boolean" id="47647">dataStop</a><span class="delimiter">)</span><span class="delimiter">)</span>, Some<span class="delimiter">(</span>Ordering<span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue]" id="47649">attrs</a>, <a title="Boolean" id="47650">asc</a><span class="delimiter">)</span><span class="delimiter">)</span>, Join<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.LogicalPlan" id="47651">child</a>, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="47652">ns</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Seq[String]" id="47653">prefixAttrs</a> = <a href="#47644" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#47675" title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">_</a>.<a href="#50171" title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25062" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span> <span title="(that: scala.collection.GenTraversableOnce[String])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],String,Seq[String]])Seq[String]">++</span> <a href="#47649" title="Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue]">attrs</a>.<span title="(f: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#47734" title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">_</a>.<a href="QueryPlan.scala.html#25062" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan" id="47654">optChild</a> = <a href="#23814" title="(logicalPlan: edu.berkeley.cs.scads.piql.plans.LogicalPlan)edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">apply</a><span class="delimiter">(</span><a href="#47651" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">child</a><span class="delimiter">)</span>

        <span class="keyword">val</span> <a href="#47656" title="(edu.berkeley.cs.scads.piql.plans.QueryPlan, Seq[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</a><a href="#47655" title="edu.berkeley.cs.scads.piql.plans.QueryPlan" id="47656">joinPlan</a>, <a href="#47655" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]" id="47657">tupleSchema</a><span class="delimiter">)</span> =
          <span title="(edu.berkeley.cs.scads.piql.plans.QueryPlan, Seq[edu.berkeley.cs.scads.piql.package.Namespace])" class="keyword">if</span> <span class="delimiter">(</span><a href="#23816" title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean">isPrefix</a><span class="delimiter">(</span><a href="#47653" title="Seq[String]">prefixAttrs</a>, <a href="#47652" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]" id="47773">tupleSchema</a> = <a href="#47654" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#46949" title="=&gt; edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a> <span title="(elem: edu.berkeley.cs.scads.piql.package.Namespace)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.package.Namespace],edu.berkeley.cs.scads.piql.package.Namespace,Seq[edu.berkeley.cs.scads.piql.package.Namespace]])Seq[edu.berkeley.cs.scads.piql.package.Namespace]">:+</span> <a href="#47652" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>
            <a href="#23807" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Using index special orders for %s&quot;)" class="string">&quot;Using index special orders for %s&quot;</span>, <a href="#47649" title="Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue]">attrs</a><span class="delimiter">)</span>

            <span title="(_1: edu.berkeley.cs.scads.piql.plans.IndexMergeJoin, _2: Seq[edu.berkeley.cs.scads.piql.package.Namespace])(edu.berkeley.cs.scads.piql.plans.IndexMergeJoin, Seq[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</span><a href="QueryPlan.scala.html#34305" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, sortFields: Seq[edu.berkeley.cs.scads.piql.plans.Value], limit: edu.berkeley.cs.scads.piql.plans.Limit, ascending: Boolean, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.IndexMergeJoin">IndexMergeJoin</a><span class="delimiter">(</span><a href="#47652" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>,
              <a href="#23822" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#47652" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#47773" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#47644" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>,
              <a href="#47649" title="Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue]">attrs</a>.<span title="(f: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue =&gt; edu.berkeley.cs.scads.piql.plans.Value)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue],edu.berkeley.cs.scads.piql.plans.Value,Seq[edu.berkeley.cs.scads.piql.plans.Value]])Seq[edu.berkeley.cs.scads.piql.plans.Value]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.piql.plans.Value,Seq[edu.berkeley.cs.scads.piql.plans.Value]]" class="delimiter">(</span><a href="#23821" title="(value: edu.berkeley.cs.scads.piql.plans.Value, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.plans.Value">bindValue</a><span class="delimiter">(</span><a href="#47853" title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">_</a>, <a href="#47773" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span><span class="delimiter">)</span>,
              <a href="#47646" title="edu.berkeley.cs.scads.piql.plans.Limit">count</a>,
              <a href="#47650" title="Boolean">asc</a>,
              <a href="#47654" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#46948" title="=&gt; edu.berkeley.cs.scads.piql.plans.QueryPlan">physicalPlan</a><span class="delimiter">)</span>,
              <a href="#47773" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace" id="47880">idx</a> = <a href="#47652" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.piql.package.IndexedNamespace" class="delimiter">[</span><a href="package.scala.html#47099" title="edu.berkeley.cs.scads.piql.package.IndexedNamespace">IndexedNamespace</a><span class="delimiter">]</span>.<span title="(fields: Seq[edu.berkeley.cs.scads.storage.client.index.IndexType])edu.berkeley.cs.scads.storage.client.index.IndexNamespace">getOrCreateIndex</span><span class="delimiter">(</span><a href="#47653" title="Seq[String]">prefixAttrs</a>.<span title="(f: String =&gt; edu.berkeley.cs.scads.storage.client.index.AttributeIndex)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],edu.berkeley.cs.scads.storage.client.index.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.client.index.IndexType]])Seq[edu.berkeley.cs.scads.storage.client.index.IndexType]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.storage.client.index.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.client.index.AttributeIndex]]" class="delimiter">(</span><a title="String" id="47899">p</a> =&gt; <span title="(fieldName: String)edu.berkeley.cs.scads.storage.client.index.AttributeIndex">AttributeIndex</span><span class="delimiter">(</span><a href="#47899" title="String">p</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="47881">tupleSchema</a> = <a href="#47880" title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace">idx</a> <a href="#47921" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <a href="#47652" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#47922" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>

            <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.IndexScanJoin" id="47882">idxJoinPlan</a> = <a href="QueryPlan.scala.html#47942" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.plans.Limit, ascending: Boolean, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.IndexScanJoin">IndexScanJoin</a><span class="delimiter">(</span><a href="#47880" title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace">idx</a>,
              <a href="#23822" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#47880" title="edu.berkeley.cs.scads.storage.client.index.IndexNamespace">idx</a>, <a href="#47881" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#47644" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>,
              <a href="#47646" title="edu.berkeley.cs.scads.piql.plans.Limit">count</a>,
              <a href="#47650" title="Boolean">asc</a>,
              <a href="#47654" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#46948" title="=&gt; edu.berkeley.cs.scads.piql.plans.QueryPlan">physicalPlan</a><span class="delimiter">)</span>
            <span title="(_1: edu.berkeley.cs.scads.piql.plans.QueryPlan, _2: List[edu.berkeley.cs.scads.piql.package.Namespace])(edu.berkeley.cs.scads.piql.plans.QueryPlan, List[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</span><a href="#23815" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, idxPlan: edu.berkeley.cs.scads.piql.plans.RemotePlan)edu.berkeley.cs.scads.piql.plans.QueryPlan">derefPlan</a><span class="delimiter">(</span><a href="#47652" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#47882" title="edu.berkeley.cs.scads.piql.plans.IndexScanJoin">idxJoinPlan</a><span class="delimiter">)</span>, <a href="#47881" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.QueryPlan" id="47658">fullPlan</a> = <a href="#47647" title="Boolean">dataStop</a> <span title="edu.berkeley.cs.scads.piql.plans.QueryPlan" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.QueryPlan" class="keyword">true</span> =&gt; <a href="#47656" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">joinPlan</a>
          <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.LocalStopAfter" class="keyword">false</span> =&gt; <a href="QueryPlan.scala.html#37372" title="(count: edu.berkeley.cs.scads.piql.plans.Limit, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.LocalStopAfter">LocalStopAfter</a><span class="delimiter">(</span><a href="#47646" title="edu.berkeley.cs.scads.piql.plans.Limit">count</a>, <a href="#47656" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">joinPlan</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <a href="#50649" title="(physicalPlan: edu.berkeley.cs.scads.piql.plans.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span><a href="#47658" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">fullPlan</a>, <a href="#47657" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">Selection</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.Predicate" id="48035">pred</a>, <a title="edu.berkeley.cs.scads.piql.plans.LogicalPlan" id="48036">child</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan" id="48037">optChild</a> = <a href="#23814" title="(logicalPlan: edu.berkeley.cs.scads.piql.plans.LogicalPlan)edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">apply</a><span class="delimiter">(</span><a href="#48036" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">child</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.Predicate" id="48038">boundPred</a> = <a href="#23818" title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.plans.Predicate">bindPredicate</a><span class="delimiter">(</span><a href="#48035" title="edu.berkeley.cs.scads.piql.plans.Predicate">pred</a>, <a href="#48037" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#46949" title="=&gt; edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span>
        <a href="#48037" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#50649" title="(physicalPlan: edu.berkeley.cs.scads.piql.plans.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">copy</a><span class="delimiter">(</span>physicalPlan = <a href="QueryPlan.scala.html#37134" title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.LocalSelection">LocalSelection</a><span class="delimiter">(</span><a href="#48038" title="edu.berkeley.cs.scads.piql.plans.Predicate">boundPred</a>, <a href="#48037" title="edu.berkeley.cs.scads.piql.opt.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#46948" title="=&gt; edu.berkeley.cs.scads.piql.plans.QueryPlan">physicalPlan</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, idxPlan: edu.berkeley.cs.scads.piql.plans.RemotePlan)edu.berkeley.cs.scads.piql.plans.QueryPlan" id="23815">derefPlan</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="47229">ns</a>: <a href="package.scala.html#25169" title="edu.berkeley.cs.scads.piql.package.Namespace">Namespace</a>, <a title="edu.berkeley.cs.scads.piql.plans.RemotePlan" id="47230">idxPlan</a>: <a href="QueryPlan.scala.html#9631" title="edu.berkeley.cs.scads.piql.plans.RemotePlan">RemotePlan</a><span class="delimiter">)</span>: <a href="QueryPlan.scala.html#9630" title="edu.berkeley.cs.scads.piql.plans.QueryPlan">QueryPlan</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.util.List[org.apache.avro.Schema.Field]" id="48051">keyFields</a> = <a href="#47229" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="()java.util.List[org.apache.avro.Schema.Field]">getFields</span>
    <span class="keyword">val</span> <a title="Seq[org.apache.avro.Schema.Field]" id="48052">idxFields</a> = <a href="#23817" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace)Seq[org.apache.avro.Schema.Field]">getFields</a><span class="delimiter">(</span><a href="#47230" title="edu.berkeley.cs.scads.piql.plans.RemotePlan">idxPlan</a>.<a href="QueryPlan.scala.html#33217" title="=&gt; edu.berkeley.cs.scads.piql.package.Namespace">namespace</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.plans.AttributeValue]" id="48053">keyGenerator</a> = <a href="#48051" title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">keyFields</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; edu.berkeley.cs.scads.piql.plans.AttributeValue)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[org.apache.avro.Schema.Field],edu.berkeley.cs.scads.piql.plans.AttributeValue,scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.plans.AttributeValue]])scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.plans.AttributeValue]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,edu.berkeley.cs.scads.piql.plans.AttributeValue,scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.plans.AttributeValue]]" class="delimiter">(</span><a title="org.apache.avro.Schema.Field" id="48508">kf</a> =&gt; <a href="QueryPlan.scala.html#29436" title="(recordPosition: Int, fieldPosition: Int)edu.berkeley.cs.scads.piql.plans.AttributeValue">AttributeValue</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#48052" title="Seq[org.apache.avro.Schema.Field]">idxFields</a>.<span title="(p: org.apache.avro.Schema.Field =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#48526" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span> <span title="(x$1: Any)Boolean">equals</span> <a href="#48508" title="org.apache.avro.Schema.Field">kf</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="QueryPlan.scala.html#33749" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, key: edu.berkeley.cs.scads.piql.package.KeyGenerator, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.IndexLookupJoin">IndexLookupJoin</a><span class="delimiter">(</span><a href="#47229" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#48053" title="scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.plans.AttributeValue]">keyGenerator</a>, <a href="#47230" title="edu.berkeley.cs.scads.piql.plans.RemotePlan">idxPlan</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Returns true only if the given equality predicates can be satisfied by a prefix scan
   * over the given namespace
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean" id="23816">isPrefix</a><span class="delimiter">(</span><a title="Seq[String]" id="46886">attrNames</a>: <span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="edu.berkeley.cs.scads.piql.package.Namespace" id="46887">ns</a>: <a href="package.scala.html#25169" title="edu.berkeley.cs.scads.piql.package.Namespace">Namespace</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.Buffer[java.lang.String]" id="48794">primaryKeyAttrs</a> = <a href="#46887" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>.<span title="(n: Int)scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">take</span><span class="delimiter">(</span><a href="#46886" title="Seq[String]">attrNames</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[org.apache.avro.Schema.Field],java.lang.String,scala.collection.mutable.Buffer[java.lang.String]])scala.collection.mutable.Buffer[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,java.lang.String,scala.collection.mutable.Buffer[java.lang.String]]" class="delimiter">(</span><a href="#48969" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>
    <a href="#46886" title="Seq[String]">attrNames</a>.<span title="(f: String =&gt; Boolean)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],Boolean,Seq[Boolean]])Seq[Boolean]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Boolean,Seq[Boolean]]" class="delimiter">(</span><a href="#48794" title="scala.collection.mutable.Buffer[java.lang.String]">primaryKeyAttrs</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#49015" title="String">_</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(op: (Boolean, Boolean) =&gt; Boolean)Boolean">reduceLeft</span><span class="delimiter">(</span><a href="#49043" title="Boolean">_</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#49044" title="Boolean">_</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Returns the key/value schemas concatenated
   * TODO: push into storage client
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(ns: edu.berkeley.cs.scads.piql.package.Namespace)Seq[org.apache.avro.Schema.Field]" id="23817">getFields</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="48054">ns</a>: <a href="package.scala.html#25169" title="edu.berkeley.cs.scads.piql.package.Namespace">Namespace</a><span class="delimiter">)</span>: <span title="Seq[org.apache.avro.Schema.Field]">Seq</span><span class="delimiter">[</span>Field<span class="delimiter">]</span> =
    <a href="#48054" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>.<span title="=&gt; Seq[org.apache.avro.Schema.Field]">toSeq</span> <span title="(that: scala.collection.GenTraversableOnce[org.apache.avro.Schema.Field])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],org.apache.avro.Schema.Field,Seq[org.apache.avro.Schema.Field]])Seq[org.apache.avro.Schema.Field]">++</span> <a href="#48054" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">valueSchema</span>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>

  <span class="comment">/**
   * Given a list of predicates, replace all UnboundAttributeValues with Attribute values
   * with the correct record/field positions
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.plans.Predicate" id="23818">bindPredicate</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.Predicate" id="48039">predicate</a>: <a href="QueryPlan.scala.html#9620" title="edu.berkeley.cs.scads.piql.plans.Predicate">Predicate</a>, <a title="edu.berkeley.cs.scads.piql.package.TupleSchema" id="48040">schema</a>: <span title="edu.berkeley.cs.scads.piql.package.TupleSchema">TupleSchema</span><span class="delimiter">)</span>: <a href="QueryPlan.scala.html#9620" title="edu.berkeley.cs.scads.piql.plans.Predicate">Predicate</a> = <a href="#48039" title="edu.berkeley.cs.scads.piql.plans.Predicate">predicate</a> <span title="edu.berkeley.cs.scads.piql.plans.Predicate" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.EqualityPredicate">EqualityPredicate</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.Value" id="49320">l</a>, <a title="edu.berkeley.cs.scads.piql.plans.Value" id="49321">r</a><span class="delimiter">)</span> =&gt; <a href="QueryPlan.scala.html#31746" title="(v1: edu.berkeley.cs.scads.piql.plans.Value, v2: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.plans.EqualityPredicate">EqualityPredicate</a><span class="delimiter">(</span><a href="#23821" title="(value: edu.berkeley.cs.scads.piql.plans.Value, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.plans.Value">bindValue</a><span class="delimiter">(</span><a href="#49320" title="edu.berkeley.cs.scads.piql.plans.Value">l</a>, <a href="#48040" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span>, <a href="#23821" title="(value: edu.berkeley.cs.scads.piql.plans.Value, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.plans.Value">bindValue</a><span class="delimiter">(</span><a href="#49321" title="edu.berkeley.cs.scads.piql.plans.Value">r</a>, <a href="#48040" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="23819">qualifiedAttribute</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;([^\.]+)\.([^\.]+)&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>
<span title="Int(88)" class="int">88</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(value: edu.berkeley.cs.scads.piql.plans.Value, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.plans.Value" id="23821">bindValue</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.Value" id="47854">value</a>: <a href="QueryPlan.scala.html#9599" title="edu.berkeley.cs.scads.piql.plans.Value">Value</a>, <a title="edu.berkeley.cs.scads.piql.package.TupleSchema" id="47855">schema</a>: <span title="edu.berkeley.cs.scads.piql.package.TupleSchema">TupleSchema</span><span class="delimiter">)</span>: <a href="QueryPlan.scala.html#9599" title="edu.berkeley.cs.scads.piql.plans.Value">Value</a> = <a href="#47854" title="edu.berkeley.cs.scads.piql.plans.Value">value</a> <span title="edu.berkeley.cs.scads.piql.plans.Value" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.AttributeValue">UnboundAttributeValue</span><span class="delimiter">(</span><a href="#23819" title="(target: Any)Option[List[String]]">qualifiedAttribute</a><span class="delimiter">(</span><a title="String" id="49350">relationName</a>, <a title="String" id="49351">attrName</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <a href="#23807" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;attempting to bind qualified attribute: %s.%s in %s&quot;)" class="string">&quot;attempting to bind qualified attribute: %s.%s in %s&quot;</span>, <a href="#49350" title="String">relationName</a>, <a href="#49351" title="String">attrName</a>, <a href="#47855" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Seq[String]" id="49352">relationNames</a> = <a href="#47855" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a>.<span title="(f: edu.berkeley.cs.scads.piql.package.Namespace =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.package.Namespace],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#49376" title="edu.berkeley.cs.scads.piql.package.Namespace">_</a>.<span title="=&gt; String">namespace</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Int" id="49353">recordPosition</a> = <a href="#49352" title="Seq[String]">relationNames</a>.<span title="(p: String =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#49404" title="String">_</a> <span title="(x$1: Any)Boolean">equals</span> <a href="#49350" title="String">relationName</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Seq[org.apache.avro.Schema.Field]" id="49354">fields</a> = <a href="#23817" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace)Seq[org.apache.avro.Schema.Field]">getFields</a><span class="delimiter">(</span><a href="#47855" title="(idx: Int)edu.berkeley.cs.scads.piql.package.Namespace">schema</a><span class="delimiter">(</span><a href="#49353" title="Int">recordPosition</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Int" id="49355">fieldPosition</a> = <a href="#49354" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(p: org.apache.avro.Schema.Field =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#49422" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span> <span title="(x$1: Any)Boolean">equals</span> <a href="#49351" title="String">attrName</a><span class="delimiter">)</span>
      <a href="#23807" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;selecting position (%s):%d, (%s):%d &quot;)" class="string">&quot;selecting position (%s):%d, (%s):%d &quot;</span>, <a href="#49352" title="Seq[String]">relationNames</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span>, <a href="#49353" title="Int">recordPosition</a>, <a href="#49354" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span>, <a href="#49355" title="Int">fieldPosition</a><span class="delimiter">)</span>
      <a href="QueryPlan.scala.html#29436" title="(recordPosition: Int, fieldPosition: Int)edu.berkeley.cs.scads.piql.plans.AttributeValue">AttributeValue</a><span class="delimiter">(</span><a href="#49353" title="Int">recordPosition</a>, <a href="#49355" title="Int">fieldPosition</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.AttributeValue">UnboundAttributeValue</span><span class="delimiter">(</span><a title="java.lang.String" id="49436">name</a>: <span title="String">String</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <span class="comment">//TODO: Throw execption when ambiguious</span>
      <a href="#23807" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;attempting to bind %s in %s&quot;)" class="string">&quot;attempting to bind %s in %s&quot;</span>, <a href="#49436" title="java.lang.String">name</a>, <a href="#47855" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Seq[Seq[org.apache.avro.Schema.Field]]" id="49437">recordSchemas</a> = <a href="#47855" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a>.<span title="(f: edu.berkeley.cs.scads.piql.package.Namespace =&gt; Seq[org.apache.avro.Schema.Field])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.package.Namespace],Seq[org.apache.avro.Schema.Field],Seq[Seq[org.apache.avro.Schema.Field]]])Seq[Seq[org.apache.avro.Schema.Field]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Seq[org.apache.avro.Schema.Field],Seq[Seq[org.apache.avro.Schema.Field]]]" class="delimiter">(</span><a href="#23817" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace)Seq[org.apache.avro.Schema.Field]">getFields</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Int" id="49438">recordPosition</a> = <a href="#49437" title="Seq[Seq[org.apache.avro.Schema.Field]]">recordSchemas</a>.<span title="(p: Seq[org.apache.avro.Schema.Field] =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#49482" title="Seq[org.apache.avro.Schema.Field]">_</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#49499" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span> <span title="(elem: Any)Boolean">contains</span> <a href="#49436" title="java.lang.String">name</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Int" id="49439">fieldPosition</a> = <a href="#49437" title="(idx: Int)Seq[org.apache.avro.Schema.Field]">recordSchemas</a><span class="delimiter">(</span><a href="#49438" title="Int">recordPosition</a><span class="delimiter">)</span>.<span title="(p: org.apache.avro.Schema.Field =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#49546" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span> <span title="(x$1: Any)Boolean">equals</span> <a href="#49436" title="java.lang.String">name</a><span class="delimiter">)</span>
      <a href="QueryPlan.scala.html#29436" title="(recordPosition: Int, fieldPosition: Int)edu.berkeley.cs.scads.piql.plans.AttributeValue">AttributeValue</a><span class="delimiter">(</span><a href="#49438" title="Int">recordPosition</a>, <a href="#49439" title="Int">fieldPosition</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">case</span> <a title="edu.berkeley.cs.scads.piql.plans.Value" id="49552">otherValue</a> =&gt; <a href="#49552" title="edu.berkeley.cs.scads.piql.plans.Value">otherValue</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Given a namespace and a set of attribute equality predicates return
   * at the keyGenerator
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator" id="23822">makeKeyGenerator</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="46964">ns</a>: <a href="package.scala.html#25169" title="edu.berkeley.cs.scads.piql.package.Namespace">Namespace</a>, <a title="edu.berkeley.cs.scads.piql.package.TupleSchema" id="46965">schema</a>: <span title="edu.berkeley.cs.scads.piql.package.TupleSchema">TupleSchema</span>, <a title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]" id="46966">equalityPreds</a>: <span title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">Seq</span><span class="delimiter">[</span>AttributeEquality<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="edu.berkeley.cs.scads.piql.package.KeyGenerator">KeyGenerator</span> = <span class="delimiter">{</span>
    <a href="#46964" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>.<span title="(n: Int)scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">take</span><span class="delimiter">(</span><a href="#46966" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>.<span title="(f: org.apache.avro.Schema.Field =&gt; edu.berkeley.cs.scads.piql.plans.Value)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[org.apache.avro.Schema.Field],edu.berkeley.cs.scads.piql.plans.Value,edu.berkeley.cs.scads.piql.package.KeyGenerator])edu.berkeley.cs.scads.piql.package.KeyGenerator">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,edu.berkeley.cs.scads.piql.plans.Value,scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.plans.Value]]" class="delimiter">(</span><a title="org.apache.avro.Schema.Field" id="49709">f</a> =&gt; <span class="delimiter">{</span>
      <a href="#23807" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Looking for key generator value for field %s in %s&quot;)" class="string">&quot;Looking for key generator value for field %s in %s&quot;</span>, <a href="#49709" title="org.apache.avro.Schema.Field">f</a>.<span title="()java.lang.String">name</span>, <a href="#46966" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.Value" id="49710">value</a> = <a href="#46966" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(p: edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality =&gt; Boolean)Option[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">find</span><span class="delimiter">(</span><a href="#49720" title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">_</a>.<a href="#50171" title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25062" title="=&gt; String">unqualifiedName</a> <span title="(x$1: Any)Boolean">equals</span> <a href="#49709" title="org.apache.avro.Schema.Field">f</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>.<span title="(default: =&gt; edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality)edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">getOrElse</span><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <span title="edu.berkeley.cs.scads.piql.opt.ImplementationLimitation" class="keyword">new</span> <a href="#50656" title="edu.berkeley.cs.scads.piql.opt.ImplementationLimitation">ImplementationLimitation</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Invalid prefix&quot;)" class="string">&quot;Invalid prefix&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="#50172" title="=&gt; edu.berkeley.cs.scads.piql.plans.Value">value</a>
      <a href="#23821" title="(value: edu.berkeley.cs.scads.piql.plans.Value, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.plans.Value">bindValue</a><span class="delimiter">(</span><a href="#49710" title="edu.berkeley.cs.scads.piql.plans.Value">value</a>, <a href="#46965" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  case <span class="keyword">class</span> <a title="class AttributeEquality extends java.lang.Object with ScalaObject with Product with Serializable" id="50645">AttributeEquality</a><a href="#50645" title="ScalaObject" class="delimiter">(</a><a title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue" id="50171">attribute</a>: <a href="QueryPlan.scala.html#9610" title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">UnboundAttributeValue</a>, <a title="edu.berkeley.cs.scads.piql.plans.Value" id="50172">value</a>: <a href="QueryPlan.scala.html#9599" title="edu.berkeley.cs.scads.piql.plans.Value">Value</a><span class="delimiter">)</span>

  case <span class="keyword">class</span> <a title="class Ordering extends java.lang.Object with ScalaObject with Product with Serializable" id="50641">Ordering</a><a href="#50641" title="ScalaObject" class="delimiter">(</a><a title="Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue]" id="50027">attributes</a>: <span title="Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue]">Seq</span><span class="delimiter">[</span>UnboundAttributeValue<span class="delimiter">]</span>, <a title="Boolean" id="50028">ascending</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>

  case <span class="keyword">class</span> <a title="class TupleLimit extends java.lang.Object with ScalaObject with Product with Serializable" id="50637">TupleLimit</a><a href="#50637" title="ScalaObject" class="delimiter">(</a><a title="edu.berkeley.cs.scads.piql.plans.Limit" id="49912">count</a>: <a href="QueryPlan.scala.html#9613" title="edu.berkeley.cs.scads.piql.plans.Limit">Limit</a>, <a title="Boolean" id="49913">isDataStop</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Groups sets of logical operations that can be executed as a
   * single get operations against the key value store
   */</span>
  <span class="keyword">protected</span> <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.opt.Optimizer.IndexRange" id="23832">IndexRange</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(logicalPlan: edu.berkeley.cs.scads.piql.plans.LogicalPlan)Option[(Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan)]" id="46858">unapply</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.LogicalPlan" id="46859">logicalPlan</a>: <a href="LogicalPlan.scala.html#9549" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">LogicalPlan</a><span class="delimiter">)</span>: <span title="Option[(Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan)]">Option</span><span class="delimiter">[</span><span class="delimiter">(</span>Seq<span class="delimiter">[</span>AttributeEquality<span class="delimiter">]</span>, Option<span class="delimiter">[</span>TupleLimit<span class="delimiter">]</span>, Option<span class="delimiter">[</span>Ordering<span class="delimiter">]</span>, LogicalPlan<span class="delimiter">)</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a href="#49891" title="(Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.plans.LogicalPlan)" class="delimiter">(</a><a href="#49890" title="Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit]" id="49891">limit</a>, <a href="#49890" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan" id="49892">planWithoutStop</a><span class="delimiter">)</span> = <a href="#46859" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">logicalPlan</a> <span title="(Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.plans.LogicalPlan)" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="(Some[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.plans.LogicalPlan)">StopAfter</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.Limit" id="49904">count</a>, <a title="edu.berkeley.cs.scads.piql.plans.LogicalPlan" id="49905">child</a><span class="delimiter">)</span> =&gt; <span title="(_1: Some[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], _2: edu.berkeley.cs.scads.piql.plans.LogicalPlan)(Some[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.plans.LogicalPlan)" class="delimiter">(</span><span title="(x: edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit)Some[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit]">Some</span><span class="delimiter">(</span><a href="#50637" title="(count: edu.berkeley.cs.scads.piql.plans.Limit, isDataStop: Boolean)edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit">TupleLimit</a><span class="delimiter">(</span><a href="#49904" title="edu.berkeley.cs.scads.piql.plans.Limit">count</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#49905" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">child</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="(Some[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.plans.LogicalPlan)">DataStopAfter</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.Limit" id="49922">count</a>, <a title="edu.berkeley.cs.scads.piql.plans.LogicalPlan" id="49923">child</a><span class="delimiter">)</span> =&gt; <span title="(_1: Some[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], _2: edu.berkeley.cs.scads.piql.plans.LogicalPlan)(Some[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.plans.LogicalPlan)" class="delimiter">(</span><span title="(x: edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit)Some[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit]">Some</span><span class="delimiter">(</span><a href="#50637" title="(count: edu.berkeley.cs.scads.piql.plans.Limit, isDataStop: Boolean)edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit">TupleLimit</a><span class="delimiter">(</span><a href="#49922" title="edu.berkeley.cs.scads.piql.plans.Limit">count</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#49923" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">child</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="(None.type, edu.berkeley.cs.scads.piql.plans.LogicalPlan)" id="49933">otherOp</a> =&gt; <span title="(_1: None.type, _2: edu.berkeley.cs.scads.piql.plans.LogicalPlan)(None.type, edu.berkeley.cs.scads.piql.plans.LogicalPlan)" class="delimiter">(</span><span title="object None">None</span>, <a href="#49933" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">otherOp</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="comment">//TODO: check to make sure these are fields in the base relation</span>
      <span class="keyword">val</span> <a href="#49894" title="(Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan)" class="delimiter">(</a><a href="#49893" title="Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering]" id="49894">ordering</a>, <a href="#49893" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan" id="49895">planWithoutSort</a><span class="delimiter">)</span> = <a href="#49892" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">planWithoutStop</a> <span title="(Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan)" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="(Some[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan)">Sort</span><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.plans.Value]" id="49975">attrs</a>, <a title="Boolean" id="49976">asc</a>, <a title="edu.berkeley.cs.scads.piql.plans.LogicalPlan" id="49977">child</a><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#49975" title="Seq[edu.berkeley.cs.scads.piql.plans.Value]">attrs</a>.<span title="(f: edu.berkeley.cs.scads.piql.plans.Value =&gt; Boolean)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.plans.Value],Boolean,Seq[Boolean]])Seq[Boolean]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Boolean,Seq[Boolean]]" class="delimiter">(</span><a href="#49994" title="edu.berkeley.cs.scads.piql.plans.Value">_</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="QueryPlan.scala.html#9610" title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">UnboundAttributeValue</a><span class="delimiter">]</span><span class="delimiter">)</span>.<span title="(op: (Boolean, Boolean) =&gt; Boolean)Boolean">reduceLeft</span><span class="delimiter">(</span><a href="#50019" title="Boolean">_</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#50020" title="Boolean">_</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <span title="(_1: Some[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], _2: edu.berkeley.cs.scads.piql.plans.LogicalPlan)(Some[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan)" class="delimiter">(</span><span title="(x: edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering)Some[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering]">Some</span><span class="delimiter">(</span><a href="#50641" title="(attributes: Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue], ascending: Boolean)edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering">Ordering</a><span class="delimiter">(</span><a href="#49975" title="Seq[edu.berkeley.cs.scads.piql.plans.Value]">attrs</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue]" class="delimiter">[</span><span title="Seq[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue]">Seq</span><span class="delimiter">[</span>UnboundAttributeValue<span class="delimiter">]</span><span class="delimiter">]</span>, <a href="#49976" title="Boolean">asc</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#49977" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">child</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <a title="(None.type, edu.berkeley.cs.scads.piql.plans.LogicalPlan)" id="50037">otherOp</a> =&gt; <span title="(_1: None.type, _2: edu.berkeley.cs.scads.piql.plans.LogicalPlan)(None.type, edu.berkeley.cs.scads.piql.plans.LogicalPlan)" class="delimiter">(</span><span title="object None">None</span>, <a href="#50037" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">otherOp</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a href="#49897" title="(Seq[edu.berkeley.cs.scads.piql.plans.Predicate], Option[edu.berkeley.cs.scads.piql.plans.LogicalPlan])" class="delimiter">(</a><a href="#49896" title="Seq[edu.berkeley.cs.scads.piql.plans.Predicate]" id="49897">predicates</a>, <a href="#49896" title="Option[edu.berkeley.cs.scads.piql.plans.LogicalPlan]" id="49898">planWithoutPredicates</a><span class="delimiter">)</span> = <a href="#49895" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">planWithoutSort</a>.<a href="LogicalPlan.scala.html#23803" title="(f: PartialFunction[edu.berkeley.cs.scads.piql.plans.LogicalPlan,edu.berkeley.cs.scads.piql.plans.Predicate])(Seq[edu.berkeley.cs.scads.piql.plans.Predicate], Option[edu.berkeley.cs.scads.piql.plans.LogicalPlan])">gatherUntil</a> <a href="#50082" title="edu.berkeley.cs.scads.piql.plans.Predicate" class="delimiter">{</a>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.plans.Predicate">Selection</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.Predicate" id="50083">pred</a>, _<span class="delimiter">)</span> =&gt; <a href="#50083" title="edu.berkeley.cs.scads.piql.plans.Predicate">pred</a>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.plans.LogicalPlan" id="49899">basePlan</a> = <a href="#49898" title="Option[edu.berkeley.cs.scads.piql.plans.LogicalPlan]">planWithoutPredicates</a>.<span title="(default: =&gt; edu.berkeley.cs.scads.piql.plans.LogicalPlan)edu.berkeley.cs.scads.piql.plans.LogicalPlan">getOrElse</span> <span class="delimiter">{</span>
        <a href="#23807" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;IndexRange match failed.  No base plan&quot;)" class="string">&quot;IndexRange match failed.  No base plan&quot;</span><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span> <span title="object None">None</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.package.Namespace" id="49900">ns</a> = <a href="#49899" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">basePlan</a> <span title="edu.berkeley.cs.scads.piql.package.Namespace" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.package.Namespace">Relation</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="50106">ns</a><span class="delimiter">)</span> =&gt; <a href="#50106" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.package.Namespace">Join</span><span class="delimiter">(</span>_, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="50107">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#50107" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>
        <span class="keyword">case</span> <a title="Nothing" id="50108">otherOp</a> =&gt; <span class="delimiter">{</span>
          <a href="#23807" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;IndexRange match failed.  Invalid base plan: %s&quot;)" class="string">&quot;IndexRange match failed.  Invalid base plan: %s&quot;</span>, <a href="#50108" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">otherOp</a><span class="delimiter">)</span>
          <span title="Nothing" class="keyword">return</span> <span title="object None">None</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="Seq[org.apache.avro.Schema.Field]" id="49901">fields</a> = <a href="#23817" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace)Seq[org.apache.avro.Schema.Field]">getFields</a><span class="delimiter">(</span><a href="#49900" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]" id="49902">idxEqPreds</a> = <a href="#49897" title="Seq[edu.berkeley.cs.scads.piql.plans.Predicate]">predicates</a>.<span title="(f: edu.berkeley.cs.scads.piql.plans.Predicate =&gt; edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.plans.Predicate],edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality,Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]])Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">map</span> <a href="#50129" title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality" class="delimiter">{</a>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">EqualityPredicate</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.Value" id="50130">v</a>: <a href="QueryPlan.scala.html#9599" title="edu.berkeley.cs.scads.piql.plans.Value">Value</a>, <a title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue" id="50131">u</a>@UnboundAttributeValue<span class="delimiter">(</span><a href="#23819" title="(target: Any)Option[List[String]]">qualifiedAttribute</a><span class="delimiter">(</span><a title="String" id="50133">relName</a>, <a title="String" id="50134">attrName</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#50133" title="String">relName</a>.<span title="(x$1: Any)Boolean">equals</span><span class="delimiter">(</span><a href="#49900" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; String">namespace</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#49901" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#50151" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#50134" title="String">attrName</a><span class="delimiter">)</span> =&gt;
          <a href="#50645" title="(attribute: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue, value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">AttributeEquality</a><span class="delimiter">(</span><a href="#50131" title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">u</a>, <a href="#50130" title="edu.berkeley.cs.scads.piql.plans.Value">v</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">EqualityPredicate</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue" id="50178">u</a>@UnboundAttributeValue<span class="delimiter">(</span><a href="#23819" title="(target: Any)Option[List[String]]">qualifiedAttribute</a><span class="delimiter">(</span><a title="String" id="50180">relName</a>, <a title="String" id="50181">attrName</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a title="edu.berkeley.cs.scads.piql.plans.Value" id="50182">v</a>: <a href="QueryPlan.scala.html#9599" title="edu.berkeley.cs.scads.piql.plans.Value">Value</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#50180" title="String">relName</a>.<span title="(x$1: Any)Boolean">equals</span><span class="delimiter">(</span><a href="#49900" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; String">namespace</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#49901" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#50193" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#50181" title="String">attrName</a><span class="delimiter">)</span> =&gt;
          <a href="#50645" title="(attribute: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue, value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">AttributeEquality</a><span class="delimiter">(</span><a href="#50178" title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">u</a>, <a href="#50182" title="edu.berkeley.cs.scads.piql.plans.Value">v</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">EqualityPredicate</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.Value" id="50213">v</a>: <a href="QueryPlan.scala.html#9599" title="edu.berkeley.cs.scads.piql.plans.Value">Value</a>, <a title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue" id="50214">u</a>@UnboundAttributeValue<span class="delimiter">(</span><a title="String" id="50215">attrName</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#49901" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#50226" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#50215" title="String">attrName</a><span class="delimiter">)</span> =&gt;
          <a href="#50645" title="(attribute: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue, value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">AttributeEquality</a><span class="delimiter">(</span><a href="#50214" title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">u</a>, <a href="#50213" title="edu.berkeley.cs.scads.piql.plans.Value">v</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">EqualityPredicate</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue" id="50246">u</a>@UnboundAttributeValue<span class="delimiter">(</span><a title="String" id="50247">attrName</a><span class="delimiter">)</span>, <a title="edu.berkeley.cs.scads.piql.plans.Value" id="50248">v</a>: <a href="QueryPlan.scala.html#9599" title="edu.berkeley.cs.scads.piql.plans.Value">Value</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#49901" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#50259" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#50247" title="String">attrName</a><span class="delimiter">)</span> =&gt;
          <a href="#50645" title="(attribute: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue, value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality">AttributeEquality</a><span class="delimiter">(</span><a href="#50246" title="edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">u</a>, <a href="#50248" title="edu.berkeley.cs.scads.piql.plans.Value">v</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="Nothing" id="50279">otherPred</a> =&gt; <span class="delimiter">{</span>
          <a href="#23807" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;IndexScan match failed.  Can\'t apply %s to index scan of %s.{%s}&quot;)" class="string">&quot;IndexScan match failed.  Can't apply %s to index scan of %s.{%s}&quot;</span>, <a href="#50279" title="edu.berkeley.cs.scads.piql.plans.Predicate">otherPred</a>, <a href="#49900" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; String">namespace</span>, <a href="#49900" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[org.apache.avro.Schema.Field],java.lang.String,scala.collection.mutable.Buffer[java.lang.String]])scala.collection.mutable.Buffer[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,java.lang.String,scala.collection.mutable.Buffer[java.lang.String]]" class="delimiter">(</span><a href="#50564" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="Nothing" class="keyword">return</span> <span title="object None">None</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="(Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan)" id="49903">getOp</a> = <span title="(_1: Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality], _2: Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], _3: Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], _4: edu.berkeley.cs.scads.piql.plans.LogicalPlan)(Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan)" class="delimiter">(</span><a href="#49902" title="Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality]">idxEqPreds</a>, <a href="#49891" title="Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit]">limit</a>, <a href="#49894" title="Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering]">ordering</a>, <a href="#49899" title="edu.berkeley.cs.scads.piql.plans.LogicalPlan">basePlan</a><span class="delimiter">)</span>
      <a href="#23807" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Matched IndexRange%s&quot;)" class="string">&quot;Matched IndexRange%s&quot;</span>, <a href="#49903" title="(Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan)">getOp</a><span class="delimiter">)</span>
      <span title="(x: (Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan))Some[(Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan)]">Some</span><span class="delimiter">(</span><a href="#49903" title="(Seq[edu.berkeley.cs.scads.piql.opt.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.opt.Optimizer.Ordering], edu.berkeley.cs.scads.piql.plans.LogicalPlan)">getOp</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>