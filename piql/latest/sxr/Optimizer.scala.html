<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>Optimizer.scala</title>
        <script type="text/javascript" src="jquery-all.js"></script>
        <script type="text/javascript" src="linked.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs
<span class="keyword">package</span> scads
<span class="keyword">package</span> piql

<span class="keyword">import</span> storage._

<span class="keyword">import</span> org.apache.avro.Schema
<span class="keyword">import</span> org.apache.avro.<span title="object org.apache.avro.Schema">Schema</span>.Field
<span class="keyword">import</span> org.apache.avro.util.Utf8
<span class="keyword">import</span> scala.collection.<span title="object scala.collection.JavaConversions">JavaConversions</span>._
<span class="keyword">import</span> net.lag.logging.Logger

case <span class="keyword">class</span> <a title="class ImplementationLimitation extends java.lang.Exception with ScalaObject with Product with Serializable" id="50412">ImplementationLimitation</a><a href="#50412" title="ScalaObject" class="delimiter">(</a><a title="String" id="50409">desc</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="java.lang.Exception">Exception</span>

<span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.OptimizedQuery" id="9563">OptimizedQuery</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentHashMap[Int,edu.berkeley.cs.scads.piql.QueryPlan]" id="45093">physicalPlans</a> = <span title="()java.util.concurrent.ConcurrentHashMap[Int,edu.berkeley.cs.scads.piql.QueryPlan]" class="keyword">new</span> java.util.concurrent.<span title="java.util.concurrent.ConcurrentHashMap[Int,edu.berkeley.cs.scads.piql.QueryPlan]">ConcurrentHashMap</span><span class="delimiter">[</span>Int, QueryPlan<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class OptimizedQuery extends java.lang.Object with ScalaObject" id="9565">OptimizedQuery</a><a href="#9565" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="Option[String]" id="23981">name</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.QueryPlan" id="23982">physicalPlan</a>: <a href="QueryPlan.scala.html#9608" title="edu.berkeley.cs.scads.piql.QueryPlan">QueryPlan</a>, <a title="edu.berkeley.cs.scads.piql.QueryExecutor" id="23983">executor</a>: <a href="Iterators.scala.html#9523" title="edu.berkeley.cs.scads.piql.QueryExecutor">QueryExecutor</a><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(args: Any*)edu.berkeley.cs.scads.piql.package.QueryResult" id="23979">apply</a><span class="delimiter">(</span><a title="Any*" id="45418">args</a>: <span title="Any*">Any</span>*<span class="delimiter">)</span>: <span title="edu.berkeley.cs.scads.piql.package.QueryResult">QueryResult</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Seq[Any]" id="45420">encodedArgs</a> = <a href="#45418" title="Any*">args</a>.<span title="(f: Any =&gt; Any)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[Any],Any,Seq[Any]])Seq[Any]">map</span> <a href="#45439" title="Any" class="delimiter">{</a>
      <span class="keyword">case</span> <a title="org.apache.avro.util.Utf8" id="45440">s</a>: <span title="String">String</span> =&gt; <span title="(x$1: java.lang.String)org.apache.avro.util.Utf8" class="keyword">new</span> <span title="org.apache.avro.util.Utf8">Utf8</span><span class="delimiter">(</span><a href="#45440" title="String">s</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="Any" id="45445">o</a> =&gt; <a href="#45445" title="Any">o</a>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.QueryIterator" id="45421">iterator</a> = <a href="Iterators.scala.html#28593" title="(plan: edu.berkeley.cs.scads.piql.QueryPlan, args: Any*)edu.berkeley.cs.scads.piql.QueryIterator">executor</a><span class="delimiter">(</span><a href="#23982" title="=&gt; edu.berkeley.cs.scads.piql.QueryPlan">physicalPlan</a>, <a href="#45420" title="Seq[Any]">encodedArgs</a>: _*<span class="delimiter">)</span>
    <a href="#45421" title="edu.berkeley.cs.scads.piql.QueryIterator">iterator</a>.<a href="Iterators.scala.html#28844" title="=&gt; Unit">open</a>
    <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Tuple]" id="45422">ret</a> = <a href="#45421" title="edu.berkeley.cs.scads.piql.QueryIterator">iterator</a>.<span title="=&gt; List[edu.berkeley.cs.scads.piql.package.Tuple]">toList</span>
    <a href="#45421" title="edu.berkeley.cs.scads.piql.QueryIterator">iterator</a>.<a href="Iterators.scala.html#28845" title="=&gt; Unit">close</a>
    <a href="#45422" title="List[edu.berkeley.cs.scads.piql.package.Tuple]">ret</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; scala.xml.NodeSeq" id="23980">toHtml</a>: xml.<span title="scala.xml.NodeSeq">NodeSeq</span> = <span class="delimiter">{</span>
    &lt;<a title="scala.xml.Elem" id="46268">b</a>&gt;<span class="delimiter">{</span><a href="#23982" title="=&gt; edu.berkeley.cs.scads.piql.QueryPlan">physicalPlan</a><span class="delimiter">}</span>&lt;/b&gt;
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.Optimizer" id="9566">Optimizer</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="23928">logger</a> = <span title="()net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="Int" id="23930">defaultFetchSize</a> = <span title="Int(10)" class="int">10</span>

  case <span class="keyword">class</span> <a title="class OptimizedSubPlan extends java.lang.Object with ScalaObject with Product with Serializable" id="50405">OptimizedSubPlan</a><a href="#50405" title="ScalaObject" class="delimiter">(</a><a title="edu.berkeley.cs.scads.piql.QueryPlan" id="46775">physicalPlan</a>: <a href="QueryPlan.scala.html#9608" title="edu.berkeley.cs.scads.piql.QueryPlan">QueryPlan</a>, <a title="edu.berkeley.cs.scads.piql.package.TupleSchema" id="46776">schema</a>: <span title="edu.berkeley.cs.scads.piql.package.TupleSchema">TupleSchema</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(logicalPlan: edu.berkeley.cs.scads.piql.Queryable)edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan" id="23935">apply</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Queryable" id="23955">logicalPlan</a>: <a href="LogicalPlan.scala.html#9530" title="edu.berkeley.cs.scads.piql.Queryable">Queryable</a><span class="delimiter">)</span>: <a href="#50405" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a> = <span class="delimiter">{</span>
    <a href="#23928" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Optimizing subplan: %s&quot;)" class="string">&quot;Optimizing subplan: %s&quot;</span>, <a href="#23955" title="edu.berkeley.cs.scads.piql.Queryable">logicalPlan</a><span class="delimiter">)</span>

    <a href="#23955" title="edu.berkeley.cs.scads.piql.Queryable">logicalPlan</a> <span title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#46685" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">IndexRange</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]" id="46689">equalityPreds</a>, <span title="object None">None</span>, <span title="object None">None</span>, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="46706">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#46689" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <a href="#46706" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="()java.util.List[org.apache.avro.Schema.Field]">getFields</span>.<span title="()Int">size</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
        <a href="#23937" title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean">isPrefix</a><span class="delimiter">(</span><a href="#46689" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#46736" title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">_</a>.<a href="#49927" title="=&gt; edu.berkeley.cs.scads.piql.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25029" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span>, <a href="#46706" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="46770">tupleSchema</a> = <a href="#46706" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#46771" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>
        <a href="#50405" title="(physicalPlan: edu.berkeley.cs.scads.piql.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span>
          <a href="QueryPlan.scala.html#32100" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, key: edu.berkeley.cs.scads.piql.package.KeyGenerator)edu.berkeley.cs.scads.piql.IndexLookup">IndexLookup</a><span class="delimiter">(</span><a href="#46706" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#23943" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#46706" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#46770" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#46689" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span><span class="delimiter">)</span>,
          <a href="#46770" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#46685" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">IndexRange</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]" id="46794">equalityPreds</a>, Some<span class="delimiter">(</span>TupleLimit<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Limit" id="46825">count</a>, <a title="Boolean" id="46826">dataStop</a><span class="delimiter">)</span><span class="delimiter">)</span>, <span title="object None">None</span>, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="46827">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan" class="keyword">if</span> <span class="delimiter">(</span><a href="#23937" title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean">isPrefix</a><span class="delimiter">(</span><a href="#46794" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#46844" title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">_</a>.<a href="#49927" title="=&gt; edu.berkeley.cs.scads.piql.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25029" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span>, <a href="#46827" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#23928" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Using primary index for predicates: %s&quot;)" class="string">&quot;Using primary index for predicates: %s&quot;</span>, <a href="#46794" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="46864">tupleSchema</a> = <a href="#46827" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#46871" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>
          <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.IndexScan" id="46865">idxScanPlan</a> = <a href="QueryPlan.scala.html#33208" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.Limit, ascending: Boolean)edu.berkeley.cs.scads.piql.IndexScan">IndexScan</a><span class="delimiter">(</span><a href="#46827" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#23943" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#46827" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#46864" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#46794" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>, <a href="#46825" title="edu.berkeley.cs.scads.piql.Limit">count</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="&lt;none&gt; extends Product with Serializable with edu.berkeley.cs.scads.piql.QueryPlan" id="46866">fullPlan</a> = <a href="#46826" title="Boolean">dataStop</a> <span title="&lt;none&gt; extends Product with Serializable with edu.berkeley.cs.scads.piql.QueryPlan" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.IndexScan" class="keyword">true</span> =&gt; <a href="#46865" title="edu.berkeley.cs.scads.piql.IndexScan">idxScanPlan</a>
            <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.LocalStopAfter" class="keyword">false</span> =&gt; <a href="QueryPlan.scala.html#37365" title="(count: edu.berkeley.cs.scads.piql.Limit, child: edu.berkeley.cs.scads.piql.QueryPlan)edu.berkeley.cs.scads.piql.LocalStopAfter">LocalStopAfter</a><span class="delimiter">(</span><a href="#46825" title="edu.berkeley.cs.scads.piql.Limit">count</a>, <a href="#46865" title="edu.berkeley.cs.scads.piql.IndexScan">idxScanPlan</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <a href="#50405" title="(physicalPlan: edu.berkeley.cs.scads.piql.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span><a href="#46866" title="&lt;none&gt; extends Product with Serializable with edu.berkeley.cs.scads.piql.QueryPlan">fullPlan</a>, <a href="#46864" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#23928" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Using secondary index for predicates: %s&quot;)" class="string">&quot;Using secondary index for predicates: %s&quot;</span>, <a href="#46794" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>

          <span class="comment">//TODO: Fix type hack</span>
          <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.IndexNamespace" id="46909">idx</a> = <a href="#46827" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.piql.package.IndexedNamespace" class="delimiter">[</span><a href="package.scala.html#46918" title="edu.berkeley.cs.scads.piql.package.IndexedNamespace">IndexedNamespace</a><span class="delimiter">]</span>.<span title="(fields: Seq[edu.berkeley.cs.scads.storage.IndexType])edu.berkeley.cs.scads.storage.IndexNamespace">getOrCreateIndex</span><span class="delimiter">(</span><a href="#46794" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality =&gt; edu.berkeley.cs.scads.storage.AttributeIndex)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality],edu.berkeley.cs.scads.storage.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.IndexType]])Seq[edu.berkeley.cs.scads.storage.IndexType]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.storage.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.AttributeIndex]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality" id="46933">p</a> =&gt; <span title="(fieldName: String)edu.berkeley.cs.scads.storage.AttributeIndex">AttributeIndex</span><span class="delimiter">(</span><a href="#46933" title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">p</a>.<a href="#49927" title="=&gt; edu.berkeley.cs.scads.piql.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25029" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="46910">tupleSchema</a> = <a href="#46909" title="edu.berkeley.cs.scads.storage.IndexNamespace">idx</a> <a href="#47030" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <a href="#46827" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#47031" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>
          <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.IndexScan" id="46911">idxScanPlan</a> = <a href="QueryPlan.scala.html#33208" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.Limit, ascending: Boolean)edu.berkeley.cs.scads.piql.IndexScan">IndexScan</a><span class="delimiter">(</span><a href="#46909" title="edu.berkeley.cs.scads.storage.IndexNamespace">idx</a>, <a href="#23943" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#46909" title="edu.berkeley.cs.scads.storage.IndexNamespace">idx</a>, <a href="#46910" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#46794" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>, <a href="#46825" title="edu.berkeley.cs.scads.piql.Limit">count</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.QueryPlan" id="46912">derefedPlan</a> = <a href="#23936" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, idxPlan: edu.berkeley.cs.scads.piql.RemotePlan)edu.berkeley.cs.scads.piql.QueryPlan">derefPlan</a><span class="delimiter">(</span><a href="#46827" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#46911" title="edu.berkeley.cs.scads.piql.IndexScan">idxScanPlan</a><span class="delimiter">)</span>

          <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.QueryPlan" id="46913">fullPlan</a> = <a href="#46826" title="Boolean">dataStop</a> <span title="edu.berkeley.cs.scads.piql.QueryPlan" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.QueryPlan" class="keyword">true</span> =&gt; <a href="#46912" title="edu.berkeley.cs.scads.piql.QueryPlan">derefedPlan</a>
            <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.LocalStopAfter" class="keyword">false</span> =&gt; <a href="QueryPlan.scala.html#37365" title="(count: edu.berkeley.cs.scads.piql.Limit, child: edu.berkeley.cs.scads.piql.QueryPlan)edu.berkeley.cs.scads.piql.LocalStopAfter">LocalStopAfter</a><span class="delimiter">(</span><a href="#46825" title="edu.berkeley.cs.scads.piql.Limit">count</a>, <a href="#46912" title="edu.berkeley.cs.scads.piql.QueryPlan">derefedPlan</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <a href="#50405" title="(physicalPlan: edu.berkeley.cs.scads.piql.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span><a href="#46913" title="edu.berkeley.cs.scads.piql.QueryPlan">fullPlan</a>, <a href="#46910" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#46685" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">IndexRange</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]" id="47048">equalityPreds</a>, <a title="Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit]" id="47049">bound</a>, Some<span class="delimiter">(</span>Ordering<span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue]" id="47084">attrs</a>, <a title="Boolean" id="47085">asc</a><span class="delimiter">)</span><span class="delimiter">)</span>, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="47086">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.Limit" id="47087">limitHint</a> = <a href="#47049" title="Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit]">bound</a>.<span title="(f: edu.berkeley.cs.scads.piql.Optimizer.TupleLimit =&gt; edu.berkeley.cs.scads.piql.Limit)Option[edu.berkeley.cs.scads.piql.Limit]">map</span><span class="delimiter">(</span><a href="#47098" title="edu.berkeley.cs.scads.piql.Optimizer.TupleLimit">_</a>.<a href="#49668" title="=&gt; edu.berkeley.cs.scads.piql.Limit">count</a><span class="delimiter">)</span>.<span title="(default: =&gt; edu.berkeley.cs.scads.piql.Limit)edu.berkeley.cs.scads.piql.Limit">getOrElse</span> <span class="delimiter">{</span>
            <a href="#23928" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;UnboundedPlan %s: %s&quot;)" class="string">&quot;UnboundedPlan %s: %s&quot;</span>, <a href="#47086" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#23955" title="edu.berkeley.cs.scads.piql.Queryable">logicalPlan</a><span class="delimiter">)</span>
            <a href="QueryPlan.scala.html#31660" title="(count: Int)edu.berkeley.cs.scads.piql.FixedLimit">FixedLimit</a><span class="delimiter">(</span><a href="#23930" title="=&gt; Int">defaultFetchSize</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">val</span> <a title="Boolean" id="47088">isDataStop</a> = <a href="#47049" title="Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit]">bound</a>.<span title="(f: edu.berkeley.cs.scads.piql.Optimizer.TupleLimit =&gt; Boolean)Option[Boolean]">map</span><span class="delimiter">(</span><a href="#47113" title="edu.berkeley.cs.scads.piql.Optimizer.TupleLimit">_</a>.<a href="#49669" title="=&gt; Boolean">isDataStop</a><span class="delimiter">)</span>.<span title="(default: =&gt; Boolean)Boolean">getOrElse</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Seq[String]" id="47089">prefixAttrs</a> = <a href="#47048" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#47136" title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">_</a>.<a href="#49927" title="=&gt; edu.berkeley.cs.scads.piql.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25029" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span> <span title="(that: scala.collection.GenTraversableOnce[String])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],String,Seq[String]])Seq[String]">++</span> <a href="#47084" title="Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue]">attrs</a>.<span title="(f: edu.berkeley.cs.scads.piql.UnboundAttributeValue =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#47199" title="edu.berkeley.cs.scads.piql.UnboundAttributeValue">_</a>.<a href="QueryPlan.scala.html#25029" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a href="#47091" title="(edu.berkeley.cs.scads.piql.QueryPlan, List[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</a><a href="#47090" title="edu.berkeley.cs.scads.piql.QueryPlan" id="47091">idxScanPlan</a>, <a href="#47090" title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="47092">tupleSchema</a><span class="delimiter">)</span> =
          <span title="(edu.berkeley.cs.scads.piql.QueryPlan, List[edu.berkeley.cs.scads.piql.package.Namespace])" class="keyword">if</span> <span class="delimiter">(</span><a href="#23937" title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean">isPrefix</a><span class="delimiter">(</span><a href="#47089" title="Seq[String]">prefixAttrs</a>, <a href="#47086" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="47238">tupleSchema</a> = <a href="#47086" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#47239" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>
            <span title="(_1: edu.berkeley.cs.scads.piql.IndexScan, _2: List[edu.berkeley.cs.scads.piql.package.Namespace])(edu.berkeley.cs.scads.piql.IndexScan, List[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</span><a href="QueryPlan.scala.html#33208" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.Limit, ascending: Boolean)edu.berkeley.cs.scads.piql.IndexScan">IndexScan</a><span class="delimiter">(</span><a href="#47086" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#23943" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#47086" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#47238" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#47048" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>, <a href="#47087" title="edu.berkeley.cs.scads.piql.Limit">limitHint</a>, <a href="#47085" title="Boolean">asc</a><span class="delimiter">)</span>, <a href="#47238" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <span class="keyword">else</span> <span class="delimiter">{</span>
	    <a href="#23928" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Creating index for attributes: %s&quot;)" class="string">&quot;Creating index for attributes: %s&quot;</span>, <a href="#47089" title="Seq[String]">prefixAttrs</a><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.IndexNamespace" id="47262">idx</a> = <a href="#47086" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.piql.package.IndexedNamespace" class="delimiter">[</span><a href="package.scala.html#46918" title="edu.berkeley.cs.scads.piql.package.IndexedNamespace">IndexedNamespace</a><span class="delimiter">]</span>.<span title="(fields: Seq[edu.berkeley.cs.scads.storage.IndexType])edu.berkeley.cs.scads.storage.IndexNamespace">getOrCreateIndex</span><span class="delimiter">(</span><a href="#47089" title="Seq[String]">prefixAttrs</a>.<span title="(f: String =&gt; edu.berkeley.cs.scads.storage.AttributeIndex)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],edu.berkeley.cs.scads.storage.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.IndexType]])Seq[edu.berkeley.cs.scads.storage.IndexType]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.storage.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.AttributeIndex]]" class="delimiter">(</span><a title="String" id="47284">p</a> =&gt; <span title="(fieldName: String)edu.berkeley.cs.scads.storage.AttributeIndex">AttributeIndex</span><span class="delimiter">(</span><a href="#47284" title="String">p</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="47263">tupleSchema</a> = <a href="#47262" title="edu.berkeley.cs.scads.storage.IndexNamespace">idx</a> <a href="#47306" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <a href="#47086" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#47307" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>
            <span title="(_1: edu.berkeley.cs.scads.piql.QueryPlan, _2: List[edu.berkeley.cs.scads.piql.package.Namespace])(edu.berkeley.cs.scads.piql.QueryPlan, List[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</span><a href="#23936" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, idxPlan: edu.berkeley.cs.scads.piql.RemotePlan)edu.berkeley.cs.scads.piql.QueryPlan">derefPlan</a><span class="delimiter">(</span><a href="#47086" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>,
              <a href="QueryPlan.scala.html#33208" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.Limit, ascending: Boolean)edu.berkeley.cs.scads.piql.IndexScan">IndexScan</a><span class="delimiter">(</span><a href="#47262" title="edu.berkeley.cs.scads.storage.IndexNamespace">idx</a>,
                <a href="#23943" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#47262" title="edu.berkeley.cs.scads.storage.IndexNamespace">idx</a>, <a href="#47263" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#47048" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>,
                <a href="#47087" title="edu.berkeley.cs.scads.piql.Limit">limitHint</a>,
                <a href="#47085" title="Boolean">asc</a><span class="delimiter">)</span><span class="delimiter">)</span>,
              <a href="#47263" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.QueryPlan" id="47093">fullPlan</a> = <a href="#47088" title="Boolean">isDataStop</a> <span title="edu.berkeley.cs.scads.piql.QueryPlan" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.QueryPlan" class="keyword">true</span> =&gt; <a href="#47091" title="edu.berkeley.cs.scads.piql.QueryPlan">idxScanPlan</a>
          <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.LocalStopAfter" class="keyword">false</span> =&gt; <a href="QueryPlan.scala.html#37365" title="(count: edu.berkeley.cs.scads.piql.Limit, child: edu.berkeley.cs.scads.piql.QueryPlan)edu.berkeley.cs.scads.piql.LocalStopAfter">LocalStopAfter</a><span class="delimiter">(</span><a href="#47087" title="edu.berkeley.cs.scads.piql.Limit">limitHint</a>, <a href="#47091" title="edu.berkeley.cs.scads.piql.QueryPlan">idxScanPlan</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#50405" title="(physicalPlan: edu.berkeley.cs.scads.piql.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span><a href="#47093" title="edu.berkeley.cs.scads.piql.QueryPlan">fullPlan</a>, <a href="#47092" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#46685" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">IndexRange</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]" id="47337">equalityPreds</a>, <span title="object None">None</span>, <span title="object None">None</span>, Join<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Queryable" id="47338">child</a>, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="47339">ns</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#47337" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <a href="#47339" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="()java.util.List[org.apache.avro.Schema.Field]">getFields</span>.<span title="()Int">size</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
        <a href="#23937" title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean">isPrefix</a><span class="delimiter">(</span><a href="#47337" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#47362" title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">_</a>.<a href="#49927" title="=&gt; edu.berkeley.cs.scads.piql.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25029" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span>, <a href="#47339" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan" id="47382">optChild</a> = <a href="#23935" title="(logicalPlan: edu.berkeley.cs.scads.piql.Queryable)edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">apply</a><span class="delimiter">(</span><a href="#47338" title="edu.berkeley.cs.scads.piql.Queryable">child</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]" id="47383">tupleSchema</a> = <a href="#47382" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#46776" title="=&gt; edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a> <span title="(elem: edu.berkeley.cs.scads.piql.package.Namespace)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.package.Namespace],edu.berkeley.cs.scads.piql.package.Namespace,Seq[edu.berkeley.cs.scads.piql.package.Namespace]])Seq[edu.berkeley.cs.scads.piql.package.Namespace]">:+</span> <a href="#47339" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>
        <a href="#50405" title="(physicalPlan: edu.berkeley.cs.scads.piql.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span>
          <a href="QueryPlan.scala.html#33742" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, key: edu.berkeley.cs.scads.piql.package.KeyGenerator, child: edu.berkeley.cs.scads.piql.QueryPlan)edu.berkeley.cs.scads.piql.IndexLookupJoin">IndexLookupJoin</a><span class="delimiter">(</span><a href="#47339" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#23943" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#47339" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#47383" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#47337" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>, <a href="#47382" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#46775" title="=&gt; edu.berkeley.cs.scads.piql.QueryPlan">physicalPlan</a><span class="delimiter">)</span>,
          <a href="#47383" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#46685" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">IndexRange</a><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]" id="47431">equalityPreds</a>, Some<span class="delimiter">(</span>TupleLimit<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Limit" id="47433">count</a>, <a title="Boolean" id="47434">dataStop</a><span class="delimiter">)</span><span class="delimiter">)</span>, Some<span class="delimiter">(</span>Ordering<span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue]" id="47436">attrs</a>, <a title="Boolean" id="47437">asc</a><span class="delimiter">)</span><span class="delimiter">)</span>, Join<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Queryable" id="47438">child</a>, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="47439">ns</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Seq[String]" id="47440">prefixAttrs</a> = <a href="#47431" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(f: edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#47462" title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">_</a>.<a href="#49927" title="=&gt; edu.berkeley.cs.scads.piql.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25029" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span> <span title="(that: scala.collection.GenTraversableOnce[String])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],String,Seq[String]])Seq[String]">++</span> <a href="#47436" title="Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue]">attrs</a>.<span title="(f: edu.berkeley.cs.scads.piql.UnboundAttributeValue =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#47521" title="edu.berkeley.cs.scads.piql.UnboundAttributeValue">_</a>.<a href="QueryPlan.scala.html#25029" title="=&gt; String">unqualifiedName</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan" id="47441">optChild</a> = <a href="#23935" title="(logicalPlan: edu.berkeley.cs.scads.piql.Queryable)edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">apply</a><span class="delimiter">(</span><a href="#47438" title="edu.berkeley.cs.scads.piql.Queryable">child</a><span class="delimiter">)</span>

        <span class="keyword">val</span> <a href="#47443" title="(edu.berkeley.cs.scads.piql.QueryPlan, Seq[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</a><a href="#47442" title="edu.berkeley.cs.scads.piql.QueryPlan" id="47443">joinPlan</a>, <a href="#47442" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]" id="47444">tupleSchema</a><span class="delimiter">)</span> =
          <span title="(edu.berkeley.cs.scads.piql.QueryPlan, Seq[edu.berkeley.cs.scads.piql.package.Namespace])" class="keyword">if</span> <span class="delimiter">(</span><a href="#23937" title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean">isPrefix</a><span class="delimiter">(</span><a href="#47440" title="Seq[String]">prefixAttrs</a>, <a href="#47439" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]" id="47560">tupleSchema</a> = <a href="#47441" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#46776" title="=&gt; edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a> <span title="(elem: edu.berkeley.cs.scads.piql.package.Namespace)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.package.Namespace],edu.berkeley.cs.scads.piql.package.Namespace,Seq[edu.berkeley.cs.scads.piql.package.Namespace]])Seq[edu.berkeley.cs.scads.piql.package.Namespace]">:+</span> <a href="#47439" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>
	    <a href="#23928" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Using index special orders for %s&quot;)" class="string">&quot;Using index special orders for %s&quot;</span>, <a href="#47436" title="Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue]">attrs</a><span class="delimiter">)</span>

            <span title="(_1: edu.berkeley.cs.scads.piql.IndexMergeJoin, _2: Seq[edu.berkeley.cs.scads.piql.package.Namespace])(edu.berkeley.cs.scads.piql.IndexMergeJoin, Seq[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</span><a href="QueryPlan.scala.html#34298" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, sortFields: Seq[edu.berkeley.cs.scads.piql.Value], limit: edu.berkeley.cs.scads.piql.Limit, ascending: Boolean, child: edu.berkeley.cs.scads.piql.QueryPlan)edu.berkeley.cs.scads.piql.IndexMergeJoin">IndexMergeJoin</a><span class="delimiter">(</span><a href="#47439" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>,
              <a href="#23943" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#47439" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#47560" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#47431" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>,
              <a href="#47436" title="Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue]">attrs</a>.<span title="(f: edu.berkeley.cs.scads.piql.UnboundAttributeValue =&gt; edu.berkeley.cs.scads.piql.Value)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue],edu.berkeley.cs.scads.piql.Value,Seq[edu.berkeley.cs.scads.piql.Value]])Seq[edu.berkeley.cs.scads.piql.Value]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.piql.Value,Seq[edu.berkeley.cs.scads.piql.Value]]" class="delimiter">(</span><a href="#23942" title="(value: edu.berkeley.cs.scads.piql.Value, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Value">bindValue</a><span class="delimiter">(</span><a href="#47634" title="edu.berkeley.cs.scads.piql.UnboundAttributeValue">_</a>, <a href="#47560" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span><span class="delimiter">)</span>,
              <a href="#47433" title="edu.berkeley.cs.scads.piql.Limit">count</a>,
              <a href="#47437" title="Boolean">asc</a>,
              <a href="#47441" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#46775" title="=&gt; edu.berkeley.cs.scads.piql.QueryPlan">physicalPlan</a><span class="delimiter">)</span>,
              <a href="#47560" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.IndexNamespace" id="47661">idx</a> = <a href="#47439" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.piql.package.IndexedNamespace" class="delimiter">[</span><a href="package.scala.html#46918" title="edu.berkeley.cs.scads.piql.package.IndexedNamespace">IndexedNamespace</a><span class="delimiter">]</span>.<span title="(fields: Seq[edu.berkeley.cs.scads.storage.IndexType])edu.berkeley.cs.scads.storage.IndexNamespace">getOrCreateIndex</span><span class="delimiter">(</span><a href="#47440" title="Seq[String]">prefixAttrs</a>.<span title="(f: String =&gt; edu.berkeley.cs.scads.storage.AttributeIndex)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],edu.berkeley.cs.scads.storage.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.IndexType]])Seq[edu.berkeley.cs.scads.storage.IndexType]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.storage.AttributeIndex,Seq[edu.berkeley.cs.scads.storage.AttributeIndex]]" class="delimiter">(</span><a title="String" id="47680">p</a> =&gt; <span title="(fieldName: String)edu.berkeley.cs.scads.storage.AttributeIndex">AttributeIndex</span><span class="delimiter">(</span><a href="#47680" title="String">p</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.piql.package.Namespace]" id="47662">tupleSchema</a> = <a href="#47661" title="edu.berkeley.cs.scads.storage.IndexNamespace">idx</a> <a href="#47702" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <a href="#47439" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a> <a href="#47703" title="(x: edu.berkeley.cs.scads.piql.package.Namespace)List[edu.berkeley.cs.scads.piql.package.Namespace]">::</a> <span title="object Nil">Nil</span>

            <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.IndexScanJoin" id="47663">idxJoinPlan</a> = <a href="QueryPlan.scala.html#47723" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.Limit, ascending: Boolean, child: edu.berkeley.cs.scads.piql.QueryPlan)edu.berkeley.cs.scads.piql.IndexScanJoin">IndexScanJoin</a><span class="delimiter">(</span><a href="#47661" title="edu.berkeley.cs.scads.storage.IndexNamespace">idx</a>,
              <a href="#23943" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator">makeKeyGenerator</a><span class="delimiter">(</span><a href="#47661" title="edu.berkeley.cs.scads.storage.IndexNamespace">idx</a>, <a href="#47662" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a>, <a href="#47431" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>,
              <a href="#47433" title="edu.berkeley.cs.scads.piql.Limit">count</a>,
              <a href="#47437" title="Boolean">asc</a>,
              <a href="#47441" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#46775" title="=&gt; edu.berkeley.cs.scads.piql.QueryPlan">physicalPlan</a><span class="delimiter">)</span>
            <span title="(_1: edu.berkeley.cs.scads.piql.QueryPlan, _2: List[edu.berkeley.cs.scads.piql.package.Namespace])(edu.berkeley.cs.scads.piql.QueryPlan, List[edu.berkeley.cs.scads.piql.package.Namespace])" class="delimiter">(</span><a href="#23936" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, idxPlan: edu.berkeley.cs.scads.piql.RemotePlan)edu.berkeley.cs.scads.piql.QueryPlan">derefPlan</a><span class="delimiter">(</span><a href="#47439" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#47663" title="edu.berkeley.cs.scads.piql.IndexScanJoin">idxJoinPlan</a><span class="delimiter">)</span>, <a href="#47662" title="List[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.QueryPlan" id="47445">fullPlan</a> = <a href="#47434" title="Boolean">dataStop</a> <span title="edu.berkeley.cs.scads.piql.QueryPlan" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.QueryPlan" class="keyword">true</span> =&gt; <a href="#47443" title="edu.berkeley.cs.scads.piql.QueryPlan">joinPlan</a>
          <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.LocalStopAfter" class="keyword">false</span> =&gt; <a href="QueryPlan.scala.html#37365" title="(count: edu.berkeley.cs.scads.piql.Limit, child: edu.berkeley.cs.scads.piql.QueryPlan)edu.berkeley.cs.scads.piql.LocalStopAfter">LocalStopAfter</a><span class="delimiter">(</span><a href="#47433" title="edu.berkeley.cs.scads.piql.Limit">count</a>, <a href="#47443" title="edu.berkeley.cs.scads.piql.QueryPlan">joinPlan</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <a href="#50405" title="(physicalPlan: edu.berkeley.cs.scads.piql.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">OptimizedSubPlan</a><span class="delimiter">(</span><a href="#47445" title="edu.berkeley.cs.scads.piql.QueryPlan">fullPlan</a>, <a href="#47444" title="Seq[edu.berkeley.cs.scads.piql.package.Namespace]">tupleSchema</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">Selection</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Predicate" id="47809">pred</a>, <a title="edu.berkeley.cs.scads.piql.Queryable" id="47810">child</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan" id="47811">optChild</a> = <a href="#23935" title="(logicalPlan: edu.berkeley.cs.scads.piql.Queryable)edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">apply</a><span class="delimiter">(</span><a href="#47810" title="edu.berkeley.cs.scads.piql.Queryable">child</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.Predicate" id="47812">boundPred</a> = <a href="#23939" title="(predicate: edu.berkeley.cs.scads.piql.Predicate, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Predicate">bindPredicate</a><span class="delimiter">(</span><a href="#47809" title="edu.berkeley.cs.scads.piql.Predicate">pred</a>, <a href="#47811" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#46776" title="=&gt; edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span>
        <a href="#47811" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#50405" title="(physicalPlan: edu.berkeley.cs.scads.piql.QueryPlan, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">copy</a><span class="delimiter">(</span>physicalPlan = <a href="QueryPlan.scala.html#37127" title="(predicate: edu.berkeley.cs.scads.piql.Predicate, child: edu.berkeley.cs.scads.piql.QueryPlan)edu.berkeley.cs.scads.piql.LocalSelection">LocalSelection</a><span class="delimiter">(</span><a href="#47812" title="edu.berkeley.cs.scads.piql.Predicate">boundPred</a>, <a href="#47811" title="edu.berkeley.cs.scads.piql.Optimizer.OptimizedSubPlan">optChild</a>.<a href="#46775" title="=&gt; edu.berkeley.cs.scads.piql.QueryPlan">physicalPlan</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, idxPlan: edu.berkeley.cs.scads.piql.RemotePlan)edu.berkeley.cs.scads.piql.QueryPlan" id="23936">derefPlan</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="47040">ns</a>: <a href="package.scala.html#25135" title="edu.berkeley.cs.scads.piql.package.Namespace">Namespace</a>, <a title="edu.berkeley.cs.scads.piql.RemotePlan" id="47041">idxPlan</a>: <a href="QueryPlan.scala.html#9609" title="edu.berkeley.cs.scads.piql.RemotePlan">RemotePlan</a><span class="delimiter">)</span>: <a href="QueryPlan.scala.html#9608" title="edu.berkeley.cs.scads.piql.QueryPlan">QueryPlan</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.util.List[org.apache.avro.Schema.Field]" id="47823">keyFields</a> = <a href="#47040" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="()java.util.List[org.apache.avro.Schema.Field]">getFields</span>
    <span class="keyword">val</span> <a title="Seq[org.apache.avro.Schema.Field]" id="47824">idxFields</a> = <a href="#23938" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace)Seq[org.apache.avro.Schema.Field]">getFields</a><span class="delimiter">(</span><a href="#47041" title="edu.berkeley.cs.scads.piql.RemotePlan">idxPlan</a>.<a href="QueryPlan.scala.html#33210" title="=&gt; edu.berkeley.cs.scads.piql.package.Namespace">namespace</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.AttributeValue]" id="47825">keyGenerator</a> = <a href="#47823" title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">keyFields</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; edu.berkeley.cs.scads.piql.AttributeValue)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[org.apache.avro.Schema.Field],edu.berkeley.cs.scads.piql.AttributeValue,scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.AttributeValue]])scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.AttributeValue]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,edu.berkeley.cs.scads.piql.AttributeValue,scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.AttributeValue]]" class="delimiter">(</span><a title="org.apache.avro.Schema.Field" id="48280">kf</a> =&gt; <a href="QueryPlan.scala.html#29429" title="(recordPosition: Int, fieldPosition: Int)edu.berkeley.cs.scads.piql.AttributeValue">AttributeValue</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#47824" title="Seq[org.apache.avro.Schema.Field]">idxFields</a>.<span title="(p: org.apache.avro.Schema.Field =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#48296" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span> <span title="(x$1: Any)Boolean">equals</span> <a href="#48280" title="org.apache.avro.Schema.Field">kf</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="QueryPlan.scala.html#33742" title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, key: edu.berkeley.cs.scads.piql.package.KeyGenerator, child: edu.berkeley.cs.scads.piql.QueryPlan)edu.berkeley.cs.scads.piql.IndexLookupJoin">IndexLookupJoin</a><span class="delimiter">(</span><a href="#47040" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>, <a href="#47825" title="scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.AttributeValue]">keyGenerator</a>, <a href="#47041" title="edu.berkeley.cs.scads.piql.RemotePlan">idxPlan</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Returns true only if the given equality predicates can be satisfied by a prefix scan
   * over the given namespace
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(attrNames: Seq[String], ns: edu.berkeley.cs.scads.piql.package.Namespace)Boolean" id="23937">isPrefix</a><span class="delimiter">(</span><a title="Seq[String]" id="46713">attrNames</a>: <span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="edu.berkeley.cs.scads.piql.package.Namespace" id="46714">ns</a>: <a href="package.scala.html#25135" title="edu.berkeley.cs.scads.piql.package.Namespace">Namespace</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.Buffer[java.lang.String]" id="48558">primaryKeyAttrs</a> = <a href="#46714" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>.<span title="(n: Int)scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">take</span><span class="delimiter">(</span><a href="#46713" title="Seq[String]">attrNames</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[org.apache.avro.Schema.Field],java.lang.String,scala.collection.mutable.Buffer[java.lang.String]])scala.collection.mutable.Buffer[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,java.lang.String,scala.collection.mutable.Buffer[java.lang.String]]" class="delimiter">(</span><a href="#48733" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>
    <a href="#46713" title="Seq[String]">attrNames</a>.<span title="(f: String =&gt; Boolean)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],Boolean,Seq[Boolean]])Seq[Boolean]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Boolean,Seq[Boolean]]" class="delimiter">(</span><a href="#48558" title="scala.collection.mutable.Buffer[java.lang.String]">primaryKeyAttrs</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#48779" title="String">_</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(op: (Boolean, Boolean) =&gt; Boolean)Boolean">reduceLeft</span><span class="delimiter">(</span><a href="#48807" title="Boolean">_</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#48808" title="Boolean">_</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Returns the key/value schemas concatenated
   * TODO: push into storage client
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(ns: edu.berkeley.cs.scads.piql.package.Namespace)Seq[org.apache.avro.Schema.Field]" id="23938">getFields</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="47826">ns</a>: <a href="package.scala.html#25135" title="edu.berkeley.cs.scads.piql.package.Namespace">Namespace</a><span class="delimiter">)</span>: <span title="Seq[org.apache.avro.Schema.Field]">Seq</span><span class="delimiter">[</span>Field<span class="delimiter">]</span> =
    <a href="#47826" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>.<span title="=&gt; Seq[org.apache.avro.Schema.Field]">toSeq</span> <span title="(that: scala.collection.GenTraversableOnce[org.apache.avro.Schema.Field])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],org.apache.avro.Schema.Field,Seq[org.apache.avro.Schema.Field]])Seq[org.apache.avro.Schema.Field]">++</span> <a href="#47826" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">valueSchema</span>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>

  <span class="comment">/**
   * Given a list of predicates, replace all UnboundAttributeValues with Attribute values
   * with the correct record/field positions
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(predicate: edu.berkeley.cs.scads.piql.Predicate, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Predicate" id="23939">bindPredicate</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Predicate" id="47813">predicate</a>: <a href="QueryPlan.scala.html#9598" title="edu.berkeley.cs.scads.piql.Predicate">Predicate</a>, <a title="edu.berkeley.cs.scads.piql.package.TupleSchema" id="47814">schema</a>: <span title="edu.berkeley.cs.scads.piql.package.TupleSchema">TupleSchema</span><span class="delimiter">)</span>: <a href="QueryPlan.scala.html#9598" title="edu.berkeley.cs.scads.piql.Predicate">Predicate</a> = <a href="#47813" title="edu.berkeley.cs.scads.piql.Predicate">predicate</a> <span title="edu.berkeley.cs.scads.piql.Predicate" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.EqualityPredicate">EqualityPredicate</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Value" id="49084">l</a>, <a title="edu.berkeley.cs.scads.piql.Value" id="49085">r</a><span class="delimiter">)</span> =&gt; <a href="QueryPlan.scala.html#31739" title="(v1: edu.berkeley.cs.scads.piql.Value, v2: edu.berkeley.cs.scads.piql.Value)edu.berkeley.cs.scads.piql.EqualityPredicate">EqualityPredicate</a><span class="delimiter">(</span><a href="#23942" title="(value: edu.berkeley.cs.scads.piql.Value, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Value">bindValue</a><span class="delimiter">(</span><a href="#49084" title="edu.berkeley.cs.scads.piql.Value">l</a>, <a href="#47814" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span>, <a href="#23942" title="(value: edu.berkeley.cs.scads.piql.Value, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Value">bindValue</a><span class="delimiter">(</span><a href="#49085" title="edu.berkeley.cs.scads.piql.Value">r</a>, <a href="#47814" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="23940">qualifiedAttribute</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;([^\.]+)\.([^\.]+)&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>
<span title="Int(88)" class="int">88</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(value: edu.berkeley.cs.scads.piql.Value, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Value" id="23942">bindValue</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Value" id="47635">value</a>: <a href="QueryPlan.scala.html#9577" title="edu.berkeley.cs.scads.piql.Value">Value</a>, <a title="edu.berkeley.cs.scads.piql.package.TupleSchema" id="47636">schema</a>: <span title="edu.berkeley.cs.scads.piql.package.TupleSchema">TupleSchema</span><span class="delimiter">)</span>: <a href="QueryPlan.scala.html#9577" title="edu.berkeley.cs.scads.piql.Value">Value</a> = <a href="#47635" title="edu.berkeley.cs.scads.piql.Value">value</a> <span title="edu.berkeley.cs.scads.piql.Value" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.AttributeValue">UnboundAttributeValue</span><span class="delimiter">(</span><a href="#23940" title="(target: Any)Option[List[String]]">qualifiedAttribute</a><span class="delimiter">(</span><a title="String" id="49112">relationName</a>, <a title="String" id="49113">attrName</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <a href="#23928" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;attempting to bind qualified attribute: %s.%s in %s&quot;)" class="string">&quot;attempting to bind qualified attribute: %s.%s in %s&quot;</span>, <a href="#49112" title="String">relationName</a>, <a href="#49113" title="String">attrName</a>, <a href="#47636" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Seq[String]" id="49114">relationNames</a> = <a href="#47636" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a>.<span title="(f: edu.berkeley.cs.scads.piql.package.Namespace =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.package.Namespace],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#49138" title="edu.berkeley.cs.scads.piql.package.Namespace">_</a>.<span title="=&gt; String">namespace</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Int" id="49115">recordPosition</a> = <a href="#49114" title="Seq[String]">relationNames</a>.<span title="(p: String =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#49166" title="String">_</a> <span title="(x$1: Any)Boolean">equals</span> <a href="#49112" title="String">relationName</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Seq[org.apache.avro.Schema.Field]" id="49116">fields</a> = <a href="#23938" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace)Seq[org.apache.avro.Schema.Field]">getFields</a><span class="delimiter">(</span><a href="#47636" title="(idx: Int)edu.berkeley.cs.scads.piql.package.Namespace">schema</a><span class="delimiter">(</span><a href="#49115" title="Int">recordPosition</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Int" id="49117">fieldPosition</a> = <a href="#49116" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(p: org.apache.avro.Schema.Field =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#49184" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span> <span title="(x$1: Any)Boolean">equals</span> <a href="#49113" title="String">attrName</a><span class="delimiter">)</span>
      <a href="#23928" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;selecting position (%s):%d, (%s):%d &quot;)" class="string">&quot;selecting position (%s):%d, (%s):%d &quot;</span>, <a href="#49114" title="Seq[String]">relationNames</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span>, <a href="#49115" title="Int">recordPosition</a>, <a href="#49116" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span>, <a href="#49117" title="Int">fieldPosition</a><span class="delimiter">)</span>
      <a href="QueryPlan.scala.html#29429" title="(recordPosition: Int, fieldPosition: Int)edu.berkeley.cs.scads.piql.AttributeValue">AttributeValue</a><span class="delimiter">(</span><a href="#49115" title="Int">recordPosition</a>, <a href="#49117" title="Int">fieldPosition</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.AttributeValue">UnboundAttributeValue</span><span class="delimiter">(</span><a title="java.lang.String" id="49196">name</a>: <span title="String">String</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <span class="comment">//TODO: Throw execption when ambiguious</span>
      <a href="#23928" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;attempting to bind %s in %s&quot;)" class="string">&quot;attempting to bind %s in %s&quot;</span>, <a href="#49196" title="java.lang.String">name</a>, <a href="#47636" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Seq[Seq[org.apache.avro.Schema.Field]]" id="49197">recordSchemas</a> = <a href="#47636" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a>.<span title="(f: edu.berkeley.cs.scads.piql.package.Namespace =&gt; Seq[org.apache.avro.Schema.Field])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.package.Namespace],Seq[org.apache.avro.Schema.Field],Seq[Seq[org.apache.avro.Schema.Field]]])Seq[Seq[org.apache.avro.Schema.Field]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Seq[org.apache.avro.Schema.Field],Seq[Seq[org.apache.avro.Schema.Field]]]" class="delimiter">(</span><a href="#23938" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace)Seq[org.apache.avro.Schema.Field]">getFields</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Int" id="49198">recordPosition</a> = <a href="#49197" title="Seq[Seq[org.apache.avro.Schema.Field]]">recordSchemas</a>.<span title="(p: Seq[org.apache.avro.Schema.Field] =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#49242" title="Seq[org.apache.avro.Schema.Field]">_</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#49259" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span> <span title="(elem: Any)Boolean">contains</span> <a href="#49196" title="java.lang.String">name</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Int" id="49199">fieldPosition</a> = <a href="#49197" title="(idx: Int)Seq[org.apache.avro.Schema.Field]">recordSchemas</a><span class="delimiter">(</span><a href="#49198" title="Int">recordPosition</a><span class="delimiter">)</span>.<span title="(p: org.apache.avro.Schema.Field =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#49306" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span> <span title="(x$1: Any)Boolean">equals</span> <a href="#49196" title="java.lang.String">name</a><span class="delimiter">)</span>
      <a href="QueryPlan.scala.html#29429" title="(recordPosition: Int, fieldPosition: Int)edu.berkeley.cs.scads.piql.AttributeValue">AttributeValue</a><span class="delimiter">(</span><a href="#49198" title="Int">recordPosition</a>, <a href="#49199" title="Int">fieldPosition</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">case</span> <a title="edu.berkeley.cs.scads.piql.Value" id="49308">otherValue</a> =&gt; <a href="#49308" title="edu.berkeley.cs.scads.piql.Value">otherValue</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Given a namespace and a set of attribute equality predicates return
   * at the keyGenerator
   */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(ns: edu.berkeley.cs.scads.piql.package.Namespace, schema: edu.berkeley.cs.scads.piql.package.TupleSchema, equalityPreds: Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality])edu.berkeley.cs.scads.piql.package.KeyGenerator" id="23943">makeKeyGenerator</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="46789">ns</a>: <a href="package.scala.html#25135" title="edu.berkeley.cs.scads.piql.package.Namespace">Namespace</a>, <a title="edu.berkeley.cs.scads.piql.package.TupleSchema" id="46790">schema</a>: <span title="edu.berkeley.cs.scads.piql.package.TupleSchema">TupleSchema</span>, <a title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]" id="46791">equalityPreds</a>: <span title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">Seq</span><span class="delimiter">[</span>AttributeEquality<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="edu.berkeley.cs.scads.piql.package.KeyGenerator">KeyGenerator</span> = <span class="delimiter">{</span>
    <a href="#46789" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>.<span title="(n: Int)scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">take</span><span class="delimiter">(</span><a href="#46791" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>.<span title="(f: org.apache.avro.Schema.Field =&gt; edu.berkeley.cs.scads.piql.Value)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[org.apache.avro.Schema.Field],edu.berkeley.cs.scads.piql.Value,edu.berkeley.cs.scads.piql.package.KeyGenerator])edu.berkeley.cs.scads.piql.package.KeyGenerator">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,edu.berkeley.cs.scads.piql.Value,scala.collection.mutable.Buffer[edu.berkeley.cs.scads.piql.Value]]" class="delimiter">(</span><a title="org.apache.avro.Schema.Field" id="49465">f</a> =&gt; <span class="delimiter">{</span>
      <a href="#23928" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Looking for key generator value for field %s in %s&quot;)" class="string">&quot;Looking for key generator value for field %s in %s&quot;</span>, <a href="#49465" title="org.apache.avro.Schema.Field">f</a>.<span title="()java.lang.String">name</span>, <a href="#46791" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.Value" id="49466">value</a> = <a href="#46791" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">equalityPreds</a>.<span title="(p: edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality =&gt; Boolean)Option[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">find</span><span class="delimiter">(</span><a href="#49476" title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">_</a>.<a href="#49927" title="=&gt; edu.berkeley.cs.scads.piql.UnboundAttributeValue">attribute</a>.<a href="QueryPlan.scala.html#25029" title="=&gt; String">unqualifiedName</a> <span title="(x$1: Any)Boolean">equals</span> <a href="#49465" title="org.apache.avro.Schema.Field">f</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>.<span title="(default: =&gt; edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality)edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">getOrElse</span><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <span title="edu.berkeley.cs.scads.piql.ImplementationLimitation" class="keyword">new</span> <a href="#50412" title="edu.berkeley.cs.scads.piql.ImplementationLimitation">ImplementationLimitation</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Invalid prefix&quot;)" class="string">&quot;Invalid prefix&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="#49928" title="=&gt; edu.berkeley.cs.scads.piql.Value">value</a>
      <a href="#23942" title="(value: edu.berkeley.cs.scads.piql.Value, schema: edu.berkeley.cs.scads.piql.package.TupleSchema)edu.berkeley.cs.scads.piql.Value">bindValue</a><span class="delimiter">(</span><a href="#49466" title="edu.berkeley.cs.scads.piql.Value">value</a>, <a href="#46790" title="edu.berkeley.cs.scads.piql.package.TupleSchema">schema</a><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  case <span class="keyword">class</span> <a title="class AttributeEquality extends java.lang.Object with ScalaObject with Product with Serializable" id="50401">AttributeEquality</a><a href="#50401" title="ScalaObject" class="delimiter">(</a><a title="edu.berkeley.cs.scads.piql.UnboundAttributeValue" id="49927">attribute</a>: <a href="QueryPlan.scala.html#9588" title="edu.berkeley.cs.scads.piql.UnboundAttributeValue">UnboundAttributeValue</a>, <a title="edu.berkeley.cs.scads.piql.Value" id="49928">value</a>: <a href="QueryPlan.scala.html#9577" title="edu.berkeley.cs.scads.piql.Value">Value</a><span class="delimiter">)</span>

  case <span class="keyword">class</span> <a title="class Ordering extends java.lang.Object with ScalaObject with Product with Serializable" id="50397">Ordering</a><a href="#50397" title="ScalaObject" class="delimiter">(</a><a title="Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue]" id="49783">attributes</a>: <span title="Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue]">Seq</span><span class="delimiter">[</span>UnboundAttributeValue<span class="delimiter">]</span>, <a title="Boolean" id="49784">ascending</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>

  case <span class="keyword">class</span> <a title="class TupleLimit extends java.lang.Object with ScalaObject with Product with Serializable" id="50393">TupleLimit</a><a href="#50393" title="ScalaObject" class="delimiter">(</a><a title="edu.berkeley.cs.scads.piql.Limit" id="49668">count</a>: <a href="QueryPlan.scala.html#9591" title="edu.berkeley.cs.scads.piql.Limit">Limit</a>, <a title="Boolean" id="49669">isDataStop</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Groups sets of logical operations that can be executed as a
   * single get operations against the key value store
   */</span>
  <span class="keyword">protected</span> <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.Optimizer.IndexRange" id="23953">IndexRange</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(logicalPlan: edu.berkeley.cs.scads.piql.Queryable)Option[(Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable)]" id="46685">unapply</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Queryable" id="46686">logicalPlan</a>: <a href="LogicalPlan.scala.html#9530" title="edu.berkeley.cs.scads.piql.Queryable">Queryable</a><span class="delimiter">)</span>: <span title="Option[(Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable)]">Option</span><span class="delimiter">[</span><span class="delimiter">(</span>Seq<span class="delimiter">[</span>AttributeEquality<span class="delimiter">]</span>, Option<span class="delimiter">[</span>TupleLimit<span class="delimiter">]</span>, Option<span class="delimiter">[</span>Ordering<span class="delimiter">]</span>, Queryable<span class="delimiter">)</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a href="#49647" title="(Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.Queryable)" class="delimiter">(</a><a href="#49646" title="Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit]" id="49647">limit</a>, <a href="#49646" title="edu.berkeley.cs.scads.piql.Queryable" id="49648">planWithoutStop</a><span class="delimiter">)</span> = <a href="#46686" title="edu.berkeley.cs.scads.piql.Queryable">logicalPlan</a> <span title="(Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.Queryable)" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="(Some[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.Queryable)">StopAfter</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Limit" id="49660">count</a>, <a title="edu.berkeley.cs.scads.piql.Queryable" id="49661">child</a><span class="delimiter">)</span> =&gt; <span title="(_1: Some[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], _2: edu.berkeley.cs.scads.piql.Queryable)(Some[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.Queryable)" class="delimiter">(</span><span title="(x: edu.berkeley.cs.scads.piql.Optimizer.TupleLimit)Some[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit]">Some</span><span class="delimiter">(</span><a href="#50393" title="(count: edu.berkeley.cs.scads.piql.Limit, isDataStop: Boolean)edu.berkeley.cs.scads.piql.Optimizer.TupleLimit">TupleLimit</a><span class="delimiter">(</span><a href="#49660" title="edu.berkeley.cs.scads.piql.Limit">count</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#49661" title="edu.berkeley.cs.scads.piql.Queryable">child</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="(Some[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.Queryable)">DataStopAfter</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Limit" id="49678">count</a>, <a title="edu.berkeley.cs.scads.piql.Queryable" id="49679">child</a><span class="delimiter">)</span> =&gt; <span title="(_1: Some[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], _2: edu.berkeley.cs.scads.piql.Queryable)(Some[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], edu.berkeley.cs.scads.piql.Queryable)" class="delimiter">(</span><span title="(x: edu.berkeley.cs.scads.piql.Optimizer.TupleLimit)Some[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit]">Some</span><span class="delimiter">(</span><a href="#50393" title="(count: edu.berkeley.cs.scads.piql.Limit, isDataStop: Boolean)edu.berkeley.cs.scads.piql.Optimizer.TupleLimit">TupleLimit</a><span class="delimiter">(</span><a href="#49678" title="edu.berkeley.cs.scads.piql.Limit">count</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#49679" title="edu.berkeley.cs.scads.piql.Queryable">child</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="(None.type, edu.berkeley.cs.scads.piql.Queryable)" id="49689">otherOp</a> =&gt; <span title="(_1: None.type, _2: edu.berkeley.cs.scads.piql.Queryable)(None.type, edu.berkeley.cs.scads.piql.Queryable)" class="delimiter">(</span><span title="object None">None</span>, <a href="#49689" title="edu.berkeley.cs.scads.piql.Queryable">otherOp</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="comment">//TODO: check to make sure these are fields in the base relation</span>
      <span class="keyword">val</span> <a href="#49650" title="(Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable)" class="delimiter">(</a><a href="#49649" title="Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering]" id="49650">ordering</a>, <a href="#49649" title="edu.berkeley.cs.scads.piql.Queryable" id="49651">planWithoutSort</a><span class="delimiter">)</span> = <a href="#49648" title="edu.berkeley.cs.scads.piql.Queryable">planWithoutStop</a> <span title="(Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable)" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="(Some[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable)">Sort</span><span class="delimiter">(</span><a title="Seq[edu.berkeley.cs.scads.piql.Value]" id="49731">attrs</a>, <a title="Boolean" id="49732">asc</a>, <a title="edu.berkeley.cs.scads.piql.Queryable" id="49733">child</a><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#49731" title="Seq[edu.berkeley.cs.scads.piql.Value]">attrs</a>.<span title="(f: edu.berkeley.cs.scads.piql.Value =&gt; Boolean)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.Value],Boolean,Seq[Boolean]])Seq[Boolean]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Boolean,Seq[Boolean]]" class="delimiter">(</span><a href="#49750" title="edu.berkeley.cs.scads.piql.Value">_</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="QueryPlan.scala.html#9588" title="edu.berkeley.cs.scads.piql.UnboundAttributeValue">UnboundAttributeValue</a><span class="delimiter">]</span><span class="delimiter">)</span>.<span title="(op: (Boolean, Boolean) =&gt; Boolean)Boolean">reduceLeft</span><span class="delimiter">(</span><a href="#49775" title="Boolean">_</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#49776" title="Boolean">_</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <span title="(_1: Some[edu.berkeley.cs.scads.piql.Optimizer.Ordering], _2: edu.berkeley.cs.scads.piql.Queryable)(Some[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable)" class="delimiter">(</span><span title="(x: edu.berkeley.cs.scads.piql.Optimizer.Ordering)Some[edu.berkeley.cs.scads.piql.Optimizer.Ordering]">Some</span><span class="delimiter">(</span><a href="#50397" title="(attributes: Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue], ascending: Boolean)edu.berkeley.cs.scads.piql.Optimizer.Ordering">Ordering</a><span class="delimiter">(</span><a href="#49731" title="Seq[edu.berkeley.cs.scads.piql.Value]">attrs</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue]" class="delimiter">[</span><span title="Seq[edu.berkeley.cs.scads.piql.UnboundAttributeValue]">Seq</span><span class="delimiter">[</span>UnboundAttributeValue<span class="delimiter">]</span><span class="delimiter">]</span>, <a href="#49732" title="Boolean">asc</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#49733" title="edu.berkeley.cs.scads.piql.Queryable">child</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <a title="(None.type, edu.berkeley.cs.scads.piql.Queryable)" id="49793">otherOp</a> =&gt; <span title="(_1: None.type, _2: edu.berkeley.cs.scads.piql.Queryable)(None.type, edu.berkeley.cs.scads.piql.Queryable)" class="delimiter">(</span><span title="object None">None</span>, <a href="#49793" title="edu.berkeley.cs.scads.piql.Queryable">otherOp</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a href="#49653" title="(Seq[edu.berkeley.cs.scads.piql.Predicate], Option[edu.berkeley.cs.scads.piql.Queryable])" class="delimiter">(</a><a href="#49652" title="Seq[edu.berkeley.cs.scads.piql.Predicate]" id="49653">predicates</a>, <a href="#49652" title="Option[edu.berkeley.cs.scads.piql.Queryable]" id="49654">planWithoutPredicates</a><span class="delimiter">)</span> = <a href="#49651" title="edu.berkeley.cs.scads.piql.Queryable">planWithoutSort</a>.<a href="LogicalPlan.scala.html#23924" title="(f: PartialFunction[edu.berkeley.cs.scads.piql.Queryable,edu.berkeley.cs.scads.piql.Predicate])(Seq[edu.berkeley.cs.scads.piql.Predicate], Option[edu.berkeley.cs.scads.piql.Queryable])">gatherUntil</a> <a href="#49838" title="edu.berkeley.cs.scads.piql.Predicate" class="delimiter">{</a>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.Predicate">Selection</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Predicate" id="49839">pred</a>, _<span class="delimiter">)</span> =&gt; <a href="#49839" title="edu.berkeley.cs.scads.piql.Predicate">pred</a>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.Queryable" id="49655">basePlan</a> = <a href="#49654" title="Option[edu.berkeley.cs.scads.piql.Queryable]">planWithoutPredicates</a>.<span title="(default: =&gt; edu.berkeley.cs.scads.piql.Queryable)edu.berkeley.cs.scads.piql.Queryable">getOrElse</span> <span class="delimiter">{</span>
        <a href="#23928" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;IndexRange match failed.  No base plan&quot;)" class="string">&quot;IndexRange match failed.  No base plan&quot;</span><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span> <span title="object None">None</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.package.Namespace" id="49656">ns</a> = <a href="#49655" title="edu.berkeley.cs.scads.piql.Queryable">basePlan</a> <span title="edu.berkeley.cs.scads.piql.package.Namespace" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.package.Namespace">Relation</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="49862">ns</a><span class="delimiter">)</span> =&gt; <a href="#49862" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.package.Namespace">Join</span><span class="delimiter">(</span>_, Relation<span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Namespace" id="49863">ns</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#49863" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>
        <span class="keyword">case</span> <a title="Nothing" id="49864">otherOp</a> =&gt; <span class="delimiter">{</span>
          <a href="#23928" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;IndexRange match failed.  Invalid base plan: %s&quot;)" class="string">&quot;IndexRange match failed.  Invalid base plan: %s&quot;</span>, <a href="#49864" title="edu.berkeley.cs.scads.piql.Queryable">otherOp</a><span class="delimiter">)</span>
          <span title="Nothing" class="keyword">return</span> <span title="object None">None</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="Seq[org.apache.avro.Schema.Field]" id="49657">fields</a> = <a href="#23938" title="(ns: edu.berkeley.cs.scads.piql.package.Namespace)Seq[org.apache.avro.Schema.Field]">getFields</a><span class="delimiter">(</span><a href="#49656" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]" id="49658">idxEqPreds</a> = <a href="#49653" title="Seq[edu.berkeley.cs.scads.piql.Predicate]">predicates</a>.<span title="(f: edu.berkeley.cs.scads.piql.Predicate =&gt; edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.Predicate],edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality,Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]])Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">map</span> <a href="#49885" title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality" class="delimiter">{</a>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">EqualityPredicate</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Value" id="49886">v</a>: <a href="QueryPlan.scala.html#9577" title="edu.berkeley.cs.scads.piql.Value">Value</a>, <a title="edu.berkeley.cs.scads.piql.UnboundAttributeValue" id="49887">u</a> @ UnboundAttributeValue<span class="delimiter">(</span><a href="#23940" title="(target: Any)Option[List[String]]">qualifiedAttribute</a><span class="delimiter">(</span><a title="String" id="49889">relName</a>, <a title="String" id="49890">attrName</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#49889" title="String">relName</a>.<span title="(x$1: Any)Boolean">equals</span><span class="delimiter">(</span><a href="#49656" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; String">namespace</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#49657" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#49907" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#49890" title="String">attrName</a><span class="delimiter">)</span> =&gt;
          <a href="#50401" title="(attribute: edu.berkeley.cs.scads.piql.UnboundAttributeValue, value: edu.berkeley.cs.scads.piql.Value)edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">AttributeEquality</a><span class="delimiter">(</span><a href="#49887" title="edu.berkeley.cs.scads.piql.UnboundAttributeValue">u</a>, <a href="#49886" title="edu.berkeley.cs.scads.piql.Value">v</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">EqualityPredicate</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.UnboundAttributeValue" id="49934">u</a> @ UnboundAttributeValue<span class="delimiter">(</span><a href="#23940" title="(target: Any)Option[List[String]]">qualifiedAttribute</a><span class="delimiter">(</span><a title="String" id="49936">relName</a>, <a title="String" id="49937">attrName</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a title="edu.berkeley.cs.scads.piql.Value" id="49938">v</a>: <a href="QueryPlan.scala.html#9577" title="edu.berkeley.cs.scads.piql.Value">Value</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#49936" title="String">relName</a>.<span title="(x$1: Any)Boolean">equals</span><span class="delimiter">(</span><a href="#49656" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; String">namespace</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#49657" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#49949" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#49937" title="String">attrName</a><span class="delimiter">)</span> =&gt;
          <a href="#50401" title="(attribute: edu.berkeley.cs.scads.piql.UnboundAttributeValue, value: edu.berkeley.cs.scads.piql.Value)edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">AttributeEquality</a><span class="delimiter">(</span><a href="#49934" title="edu.berkeley.cs.scads.piql.UnboundAttributeValue">u</a>, <a href="#49938" title="edu.berkeley.cs.scads.piql.Value">v</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">EqualityPredicate</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.Value" id="49969">v</a>: <a href="QueryPlan.scala.html#9577" title="edu.berkeley.cs.scads.piql.Value">Value</a>, <a title="edu.berkeley.cs.scads.piql.UnboundAttributeValue" id="49970">u</a> @ UnboundAttributeValue<span class="delimiter">(</span><a title="String" id="49971">attrName</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#49657" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#49982" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#49971" title="String">attrName</a><span class="delimiter">)</span> =&gt;
          <a href="#50401" title="(attribute: edu.berkeley.cs.scads.piql.UnboundAttributeValue, value: edu.berkeley.cs.scads.piql.Value)edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">AttributeEquality</a><span class="delimiter">(</span><a href="#49970" title="edu.berkeley.cs.scads.piql.UnboundAttributeValue">u</a>, <a href="#49969" title="edu.berkeley.cs.scads.piql.Value">v</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">EqualityPredicate</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.UnboundAttributeValue" id="50002">u</a> @ UnboundAttributeValue<span class="delimiter">(</span><a title="String" id="50003">attrName</a><span class="delimiter">)</span>, <a title="edu.berkeley.cs.scads.piql.Value" id="50004">v</a>: <a href="QueryPlan.scala.html#9577" title="edu.berkeley.cs.scads.piql.Value">Value</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#49657" title="Seq[org.apache.avro.Schema.Field]">fields</a>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[org.apache.avro.Schema.Field],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#50015" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#50003" title="String">attrName</a><span class="delimiter">)</span> =&gt;
          <a href="#50401" title="(attribute: edu.berkeley.cs.scads.piql.UnboundAttributeValue, value: edu.berkeley.cs.scads.piql.Value)edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality">AttributeEquality</a><span class="delimiter">(</span><a href="#50002" title="edu.berkeley.cs.scads.piql.UnboundAttributeValue">u</a>, <a href="#50004" title="edu.berkeley.cs.scads.piql.Value">v</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="Nothing" id="50035">otherPred</a> =&gt; <span class="delimiter">{</span>
          <a href="#23928" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;IndexScan match failed.  Can\'t apply %s to index scan of %s.{%s}&quot;)" class="string">&quot;IndexScan match failed.  Can't apply %s to index scan of %s.{%s}&quot;</span>, <a href="#50035" title="edu.berkeley.cs.scads.piql.Predicate">otherPred</a>, <a href="#49656" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; String">namespace</span>, <a href="#49656" title="edu.berkeley.cs.scads.piql.package.Namespace">ns</a>.<span title="=&gt; org.apache.avro.Schema">keySchema</span>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[org.apache.avro.Schema.Field],java.lang.String,scala.collection.mutable.Buffer[java.lang.String]])scala.collection.mutable.Buffer[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,java.lang.String,scala.collection.mutable.Buffer[java.lang.String]]" class="delimiter">(</span><a href="#50320" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="Nothing" class="keyword">return</span> <span title="object None">None</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="(Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable)" id="49659">getOp</a> = <span title="(_1: Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality], _2: Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], _3: Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering], _4: edu.berkeley.cs.scads.piql.Queryable)(Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable)" class="delimiter">(</span><a href="#49658" title="Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality]">idxEqPreds</a>, <a href="#49647" title="Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit]">limit</a>, <a href="#49650" title="Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering]">ordering</a>, <a href="#49655" title="edu.berkeley.cs.scads.piql.Queryable">basePlan</a><span class="delimiter">)</span>
      <a href="#23928" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Matched IndexRange%s&quot;)" class="string">&quot;Matched IndexRange%s&quot;</span>, <a href="#49659" title="(Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable)">getOp</a><span class="delimiter">)</span>
      <span title="(x: (Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable))Some[(Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable)]">Some</span><span class="delimiter">(</span><a href="#49659" title="(Seq[edu.berkeley.cs.scads.piql.Optimizer.AttributeEquality], Option[edu.berkeley.cs.scads.piql.Optimizer.TupleLimit], Option[edu.berkeley.cs.scads.piql.Optimizer.Ordering], edu.berkeley.cs.scads.piql.Queryable)">getOp</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>