<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>MessageHandler.scala</title>
        <script type="text/javascript" src="jquery-all.js"></script>
        <script type="text/javascript" src="linked.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs.scads.comm

<span class="keyword">import</span> java.util.concurrent.<span class="delimiter">{</span> ConcurrentHashMap, CopyOnWriteArrayList, Executors, TimeUnit <span class="delimiter">}</span>
<span class="keyword">import</span> scala.actors._

<span class="keyword">import</span> net.lag.logging.Logger

<span class="keyword">import</span> edu.berkeley.cs.scads.config._

<span class="keyword">import</span> org.apache.commons.httpclient._
<span class="keyword">import</span> org.apache.commons.httpclient.methods._
<span class="keyword">import</span> org.apache.commons.httpclient.params._
<span class="keyword">import</span> java.util.concurrent.atomic.AtomicLong

<span class="comment">/**
 * The message handler for all scads communication.  It maintains a list of all active services
 * in a given JVM and multiplexes the underlying network connections.  Services should be
 * careful to unregister themselves to avoid memory leaks.
 */</span>
<span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.comm.MessageHandler" id="9563">MessageHandler</a> <span title="ScalaObject" class="keyword">extends</span> <a href="AvroChannelManager.scala.html#9509" title="edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">AvroChannelManager</a><span class="delimiter">[</span>Message, Message<span class="delimiter">]</span> <span class="delimiter">{</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="net.lag.configgy.Config" id="14310">config</a> = <span title="object edu.berkeley.cs.scads.config.Config">Config</span>.<span title="=&gt; net.lag.configgy.Config">config</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="14312">logger</a> = <span title="()net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.concurrent.atomic.AtomicLong" id="14314">curActorId</a>      = <span title="()java.util.concurrent.atomic.AtomicLong" class="keyword">new</span> <span title="java.util.concurrent.atomic.AtomicLong">AtomicLong</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentHashMap[edu.berkeley.cs.scads.comm.ActorId,edu.berkeley.cs.scads.comm.MessageReceiver]" id="14316">serviceRegistry</a> = <span title="()java.util.concurrent.ConcurrentHashMap[edu.berkeley.cs.scads.comm.ActorId,edu.berkeley.cs.scads.comm.MessageReceiver]" class="keyword">new</span> <span title="java.util.concurrent.ConcurrentHashMap[edu.berkeley.cs.scads.comm.ActorId,edu.berkeley.cs.scads.comm.MessageReceiver]">ConcurrentHashMap</span><span class="delimiter">[</span>ActorId, MessageReceiver<span class="delimiter">]</span>
  <span class="keyword">def</span> <a title="=&gt; Int" id="14318">registrySize</a> = <a href="#14316" title="=&gt; java.util.concurrent.ConcurrentHashMap[edu.berkeley.cs.scads.comm.ActorId,edu.berkeley.cs.scads.comm.MessageReceiver]">serviceRegistry</a>.<span title="()Int">size</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="=&gt; Long" id="14319">futureCount</a> = <a href="#14314" title="=&gt; java.util.concurrent.atomic.AtomicLong">curActorId</a>.<span title="()Long">get</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.String" id="14320">hostname</a> = 
    <span title="java.lang.String" class="keyword">if</span><span class="delimiter">(</span><span title="object java.lang.System">System</span>.<span title="(x$1: java.lang.String)java.lang.String">getProperty</span><span class="delimiter">(</span><span title="java.lang.String(&quot;scads.comm.externalip&quot;)" class="string">&quot;scads.comm.externalip&quot;</span><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
      java.net.<span title="object java.net.InetAddress">InetAddress</span>.<span title="()java.net.InetAddress">getLocalHost</span>.<span title="()java.lang.String">getCanonicalHostName</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="org.apache.commons.httpclient.HttpClient" id="32834">httpClient</a> = <span title="org.apache.commons.httpclient.HttpClient" class="keyword">new</span> <span title="org.apache.commons.httpclient.HttpClient">HttpClient</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="org.apache.commons.httpclient.methods.GetMethod" id="32835">getMethod</a> = <span title="(x$1: java.lang.String)org.apache.commons.httpclient.methods.GetMethod" class="keyword">new</span> <span title="org.apache.commons.httpclient.methods.GetMethod">GetMethod</span><span class="delimiter">(</span><span title="java.lang.String(&quot;http://instance-data.ec2.internal/latest/meta-data/public-hostname&quot;)" class="string">&quot;http://instance-data.ec2.internal/latest/meta-data/public-hostname&quot;</span><span class="delimiter">)</span>
      <a href="#32834" title="org.apache.commons.httpclient.HttpClient">httpClient</a>.<span title="(x$1: org.apache.commons.httpclient.HttpMethod)Int">executeMethod</span><span class="delimiter">(</span><a href="#32835" title="org.apache.commons.httpclient.methods.GetMethod">getMethod</a><span class="delimiter">)</span>
      <a href="#32835" title="org.apache.commons.httpclient.methods.GetMethod">getMethod</a>.<span title="()java.lang.String">getResponseBodyAsString</span>
    <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.concurrent.CopyOnWriteArrayList[edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]]" id="14322">listeners</a> = <span title="java.util.concurrent.CopyOnWriteArrayList[edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]]" class="keyword">new</span> <span title="java.util.concurrent.CopyOnWriteArrayList[edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]]">CopyOnWriteArrayList</span><span class="delimiter">[</span>MessageHandlerListener<span class="delimiter">[</span>Message, Message<span class="delimiter">]</span><span class="delimiter">]</span>

  <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.util.concurrent.ScheduledExecutorService" id="14325">delayExecutor</a> = <span title="object java.util.concurrent.Executors">Executors</span>.<span title="(x$1: Int)java.util.concurrent.ScheduledExecutorService">newScheduledThreadPool</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="comment">/* Don't keep any core threads alive */</span>

  <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]" id="14327">impl</a> = 
    <span class="keyword">try</span> <a href="#14328" title="=&gt; edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">getImpl</a>
    <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="edu.berkeley.cs.scads.comm.DefaultNioChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]" id="36560">e</a>: <span title="Exception">Exception</span> =&gt;
        <a href="#14312" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">error</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Could not initialize handler implementation, using default impl&quot;)" class="string">&quot;Could not initialize handler implementation, using default impl&quot;</span>, <a href="#36560" title="Exception">e</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="(edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message], edu.berkeley.cs.scads.comm.RemoteNode, edu.berkeley.cs.scads.comm.Message) =&gt; Unit" id="36561">recvMsgCallback</a> = <span class="delimiter">(</span>_: <a href="AvroChannelManager.scala.html#9509" title="edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">AvroChannelManager</a><span class="delimiter">[</span>Message, Message<span class="delimiter">]</span>, src: <a href="AvroChannelManager.scala.html#9506" title="edu.berkeley.cs.scads.comm.RemoteNode">RemoteNode</a>, msg: <a href="Messages.scala.html#9609" title="edu.berkeley.cs.scads.comm.Message">Message</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <a href="#14336" title="(src: edu.berkeley.cs.scads.comm.RemoteNode, msg: edu.berkeley.cs.scads.comm.Message)Unit">doReceiveMessage</a><span class="delimiter">(</span><a href="#36568" title="edu.berkeley.cs.scads.comm.RemoteNode">src</a>, <a href="#36569" title="edu.berkeley.cs.scads.comm.Message">msg</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span title="edu.berkeley.cs.scads.comm.DefaultNioChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]" class="keyword">new</span> <a href="nio/avro.scala.html#9940" title="edu.berkeley.cs.scads.comm.DefaultNioChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">DefaultNioChannelManager</a><span class="delimiter">[</span>Message, Message<span class="delimiter">]</span><span class="delimiter">(</span><a href="#36561" title="(edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message], edu.berkeley.cs.scads.comm.RemoteNode, edu.berkeley.cs.scads.comm.Message) =&gt; Unit">recvMsgCallback</a>, classOf<span title="java.lang.Class[edu.berkeley.cs.scads.comm.Message](classOf[edu.berkeley.cs.scads.comm.Message])" class="delimiter">[</span>Message<span class="delimiter">]</span>, classOf<span title="java.lang.Class[edu.berkeley.cs.scads.comm.Message](classOf[edu.berkeley.cs.scads.comm.Message])" class="delimiter">[</span>Message<span class="delimiter">]</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]" id="14328">getImpl</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="String" id="34086">clzName</a> = 
      <a href="#14310" title="=&gt; net.lag.configgy.Config">config</a>.<span title="(key: String, defaultValue: String)String">getString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;scads.comm.handlerClass&quot;)" class="string">&quot;scads.comm.handlerClass&quot;</span>, classOf<span title="java.lang.Class[edu.berkeley.cs.scads.comm.netty.DefaultNettyChannelManager[_, _]](classOf[edu.berkeley.cs.scads.comm.netty.DefaultNettyChannelManager])" class="delimiter">[</span>netty.DefaultNettyChannelManager<span class="delimiter">[</span>_,_<span class="delimiter">]</span><span class="delimiter">]</span>.<span title="()java.lang.String">getName</span><span class="delimiter">)</span>
    <a href="#14312" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Using handler impl class: %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#34086" title="String">clzName</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="(edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message], edu.berkeley.cs.scads.comm.RemoteNode, edu.berkeley.cs.scads.comm.Message) =&gt; Unit" id="34087">recvMsgCallback</a> = <span class="delimiter">(</span>_: <a href="AvroChannelManager.scala.html#9509" title="edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">AvroChannelManager</a><span class="delimiter">[</span>Message, Message<span class="delimiter">]</span>, src: <a href="AvroChannelManager.scala.html#9506" title="edu.berkeley.cs.scads.comm.RemoteNode">RemoteNode</a>, msg: <a href="Messages.scala.html#9609" title="edu.berkeley.cs.scads.comm.Message">Message</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <a href="#14336" title="(src: edu.berkeley.cs.scads.comm.RemoteNode, msg: edu.berkeley.cs.scads.comm.Message)Unit">doReceiveMessage</a><span class="delimiter">(</span><a href="#35681" title="edu.berkeley.cs.scads.comm.RemoteNode">src</a>, <a href="#35682" title="edu.berkeley.cs.scads.comm.Message">msg</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">// TODO: custom class loader</span>
    <span class="keyword">val</span> <a title="Class[edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]]" id="34088">clz</a>  = <span title="object java.lang.Class">Class</span>.<span title="(x$1: java.lang.String)java.lang.Class[_]">forName</span><span class="delimiter">(</span><a href="#34086" title="String">clzName</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Class[edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]]" class="delimiter">[</span><span title="Class[edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]]">Class</span><span class="delimiter">[</span>AvroChannelManager<span class="delimiter">[</span>Message, Message<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span>
    <span class="keyword">val</span> <a title="java.lang.reflect.Constructor[edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]]" id="34089">ctor</a> = <a href="#34088" title="Class[edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]]">clz</a>.<span title="(x$1: &lt;repeated...&gt;[java.lang.Class[_]])java.lang.reflect.Constructor[edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]]">getConstructor</span><span class="delimiter">(</span>classOf<span title="java.lang.Class[Function3[_, _, _, _]](classOf[scala.Function3])" class="delimiter">[</span>Function3<span class="delimiter">[</span>_, _, _, _<span class="delimiter">]</span><span class="delimiter">]</span>, classOf<span title="java.lang.Class[Class[_]](classOf[java.lang.Class])" class="delimiter">[</span>Class<span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">]</span>, classOf<span title="java.lang.Class[Class[_]](classOf[java.lang.Class])" class="delimiter">[</span>Class<span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>
    <a href="#34089" title="java.lang.reflect.Constructor[edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]]">ctor</a>.<span title="(x$1: &lt;repeated...&gt;[java.lang.Object])edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">newInstance</span><span class="delimiter">(</span><a href="#34087" title="(edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message], edu.berkeley.cs.scads.comm.RemoteNode, edu.berkeley.cs.scads.comm.Message) =&gt; Unit">recvMsgCallback</a>, classOf<span title="java.lang.Class[edu.berkeley.cs.scads.comm.Message](classOf[edu.berkeley.cs.scads.comm.Message])" class="delimiter">[</span>Message<span class="delimiter">]</span>, classOf<span title="java.lang.Class[edu.berkeley.cs.scads.comm.Message](classOf[edu.berkeley.cs.scads.comm.Message])" class="delimiter">[</span>Message<span class="delimiter">]</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Implemented in Java style for efficiency concerns
   */</span>
  @inline <span class="keyword">private</span> <span class="keyword">def</span> <a title="(evt: edu.berkeley.cs.scads.comm.MessageHandlerEvent[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message])edu.berkeley.cs.scads.comm.MessageHandlerResponse" id="14329">foldLeftListeners</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.MessageHandlerEvent[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]" id="36630">evt</a>: <a href="#9565" title="edu.berkeley.cs.scads.comm.MessageHandlerEvent[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">MessageHandlerEvent</a><span class="delimiter">[</span>Message, Message<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#9573" title="edu.berkeley.cs.scads.comm.MessageHandlerResponse">MessageHandlerResponse</a> = <span class="delimiter">{</span>
    <span title="edu.berkeley.cs.scads.comm.MessageHandlerResponse" class="keyword">if</span> <span class="delimiter">(</span><a href="#14322" title="=&gt; java.util.concurrent.CopyOnWriteArrayList[edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]]">listeners</a>.<span title="()Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#37182" title="object edu.berkeley.cs.scads.comm.RelayMessage">RelayMessage</a>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.util.Iterator[edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]]" id="36635">iter</a>     = <a href="#14322" title="=&gt; java.util.concurrent.CopyOnWriteArrayList[edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]]">listeners</a>.<span title="()java.util.Iterator[edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]]">iterator</span>
      <span class="keyword">var</span> <a title="Boolean" id="36636">continue</a> = <a href="#36635" title="java.util.Iterator[edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]]">iter</a>.<span title="()Boolean">hasNext</span>
      <span class="keyword">var</span> <a title="edu.berkeley.cs.scads.comm.MessageHandlerResponse" id="36637">result</a>: <a href="#9573" title="edu.berkeley.cs.scads.comm.MessageHandlerResponse">MessageHandlerResponse</a> = <a href="#37182" title="object edu.berkeley.cs.scads.comm.RelayMessage">RelayMessage</a>
      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#36636" title="Boolean">continue</a><span class="delimiter">)</span> <a href="#36638" title="()Unit" class="delimiter">{</a>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]" id="36643">listener</a> = <a href="#36635" title="java.util.Iterator[edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]]">iter</a>.<span title="()edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">next</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#36637" title="edu.berkeley.cs.scads.comm.MessageHandlerResponse">result</a> = 
          <span class="keyword">try</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.MessageHandlerResponse" id="36644">res</a> = <a href="#36643" title="edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">listener</a>.<a href="#33813" title="(evt: edu.berkeley.cs.scads.comm.MessageHandlerEvent[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message])edu.berkeley.cs.scads.comm.MessageHandlerResponse">handleEvent</a><span class="delimiter">(</span><a href="#36630" title="edu.berkeley.cs.scads.comm.MessageHandlerEvent[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">evt</a><span class="delimiter">)</span>
            <span title="edu.berkeley.cs.scads.comm.MessageHandlerResponse" class="keyword">if</span> <span class="delimiter">(</span><a href="#36644" title="edu.berkeley.cs.scads.comm.MessageHandlerResponse">res</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#14312" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">error</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;MessageHandlerListener %s returned null, ignoring&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#36643" title="edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">listener</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <a href="#37182" title="object edu.berkeley.cs.scads.comm.RelayMessage">RelayMessage</a>
            <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#36644" title="edu.berkeley.cs.scads.comm.MessageHandlerResponse">res</a>
          <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a title="edu.berkeley.cs.scads.comm.RelayMessage.type" id="36653">e</a>: <span title="Exception">Exception</span> =&gt;
              <a href="#14312" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">error</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Caught exception while executing MessageHandlerListener %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#36643" title="edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">listener</a><span class="delimiter">)</span>, <a href="#36653" title="Exception">e</a><span class="delimiter">)</span>
              <a href="#37182" title="object edu.berkeley.cs.scads.comm.RelayMessage">RelayMessage</a>
          <span class="delimiter">}</span>
        <a href="#36637" title="edu.berkeley.cs.scads.comm.MessageHandlerResponse">result</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a href="#37182" title="Unit">RelayMessage</a> =&gt; <span class="comment">/* Progress down the chain */</span>
            <a href="#36636" title="Boolean">continue</a> = <a href="#36635" title="java.util.Iterator[edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]]">iter</a>.<span title="()Boolean">hasNext</span>
          <span class="keyword">case</span> <a href="#37134" title="Unit">DropMessage</a> | DelayMessage<span class="delimiter">(</span>_, _<span class="delimiter">)</span> =&gt; <span class="comment">/* Stop the chain */</span>
            <a href="#36636" title="Boolean">continue</a> = <span title="Boolean(false)" class="keyword">false</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <a href="#36637" title="edu.berkeley.cs.scads.comm.MessageHandlerResponse">result</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  @inline <span class="keyword">private</span> <span class="keyword">def</span> <a title="(f: =&gt; Unit)java.lang.Object with java.lang.Runnable" id="14330">toRunnable</a><span class="delimiter">(</span><a title="=&gt; Unit" id="36699">f</a>: =&gt; Unit<span class="delimiter">)</span> = <a href="#36702" title="java.lang.Object with java.lang.Runnable" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with java.lang.Runnable" id="36702">Runnable</a> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="()Unit" id="36704">run</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#36699" title="=&gt; Unit">f</a> <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">// Delegation overrides</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(dest: edu.berkeley.cs.scads.comm.RemoteNode, msg: edu.berkeley.cs.scads.comm.Message)Unit" id="14331">sendMessage</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.RemoteNode" id="24084">dest</a>: <a href="AvroChannelManager.scala.html#9506" title="edu.berkeley.cs.scads.comm.RemoteNode">RemoteNode</a>, <a title="edu.berkeley.cs.scads.comm.Message" id="24085">msg</a>: <a href="Messages.scala.html#9609" title="edu.berkeley.cs.scads.comm.Message">Message</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#14312" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">trace</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Sending %s to %s&quot;)" class="string">&quot;Sending %s to %s&quot;</span>, <a href="#24085" title="edu.berkeley.cs.scads.comm.Message">msg</a>, <a href="#24084" title="edu.berkeley.cs.scads.comm.RemoteNode">dest</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.MessagePending[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]" id="36714">evt</a> = <a href="#37198" title="[SendType, RecvType](remote: edu.berkeley.cs.scads.comm.RemoteNode, msg: Either[SendType,RecvType])edu.berkeley.cs.scads.comm.MessagePending[SendType,RecvType]">MessagePending</a><span title="(remote: edu.berkeley.cs.scads.comm.RemoteNode, msg: Either[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message])edu.berkeley.cs.scads.comm.MessagePending[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]" class="delimiter">[</span><a href="Messages.scala.html#9609" title="edu.berkeley.cs.scads.comm.Message">Message</a>, <a href="Messages.scala.html#9609" title="edu.berkeley.cs.scads.comm.Message">Message</a><span class="delimiter">]</span><span class="delimiter">(</span><a href="#24084" title="edu.berkeley.cs.scads.comm.RemoteNode">dest</a>, <span title="(a: edu.berkeley.cs.scads.comm.Message)Left[edu.berkeley.cs.scads.comm.Message,Nothing]">Left</span><span class="delimiter">(</span><a href="#24085" title="edu.berkeley.cs.scads.comm.Message">msg</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#14329" title="(evt: edu.berkeley.cs.scads.comm.MessageHandlerEvent[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message])edu.berkeley.cs.scads.comm.MessageHandlerResponse">foldLeftListeners</a><span class="delimiter">(</span><a href="#36714" title="edu.berkeley.cs.scads.comm.MessagePending[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">evt</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#37182" title="Unit">RelayMessage</a> =&gt; <a href="#14326" title="=&gt; edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">impl</a>.<a href="AvroChannelManager.scala.html#14304" title="(dest: edu.berkeley.cs.scads.comm.RemoteNode, msg: edu.berkeley.cs.scads.comm.Message)Unit">sendMessage</a><span class="delimiter">(</span><a href="#24084" title="edu.berkeley.cs.scads.comm.RemoteNode">dest</a>, <a href="#24085" title="edu.berkeley.cs.scads.comm.Message">msg</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="#37134" title="Unit">DropMessage</a>  =&gt; <span class="comment">/* Drop the message */</span>
      <span class="keyword">case</span> <span title="Unit">DelayMessage</span><span class="delimiter">(</span><a title="Long" id="36756">delay</a>, <a title="java.util.concurrent.TimeUnit" id="36757">units</a><span class="delimiter">)</span> =&gt;
        <a href="#14324" title="=&gt; java.util.concurrent.ScheduledExecutorService">delayExecutor</a>.<span title="(x$1: java.lang.Runnable, x$2: Long, x$3: java.util.concurrent.TimeUnit)java.util.concurrent.ScheduledFuture[_]">schedule</span><span title="Unit" class="delimiter">(</span><a href="#14330" title="(f: =&gt; Unit)java.lang.Object with java.lang.Runnable">toRunnable</a><span class="delimiter">(</span><a href="#14326" title="=&gt; edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">impl</a>.<a href="AvroChannelManager.scala.html#14304" title="(dest: edu.berkeley.cs.scads.comm.RemoteNode, msg: edu.berkeley.cs.scads.comm.Message)Unit">sendMessage</a><span class="delimiter">(</span><a href="#24084" title="edu.berkeley.cs.scads.comm.RemoteNode">dest</a>, <a href="#24085" title="edu.berkeley.cs.scads.comm.Message">msg</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#36756" title="Long">delay</a>, <a href="#36757" title="java.util.concurrent.TimeUnit">units</a><span class="delimiter">)</span>        
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(dest: edu.berkeley.cs.scads.comm.RemoteNode, msg: edu.berkeley.cs.scads.comm.Message)Unit" id="14332">sendMessageBulk</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.RemoteNode" id="36845">dest</a>: <a href="AvroChannelManager.scala.html#9506" title="edu.berkeley.cs.scads.comm.RemoteNode">RemoteNode</a>, <a title="edu.berkeley.cs.scads.comm.Message" id="36846">msg</a>: <a href="Messages.scala.html#9609" title="edu.berkeley.cs.scads.comm.Message">Message</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.MessagePending[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]" id="36850">evt</a> = <a href="#37198" title="[SendType, RecvType](remote: edu.berkeley.cs.scads.comm.RemoteNode, msg: Either[SendType,RecvType])edu.berkeley.cs.scads.comm.MessagePending[SendType,RecvType]">MessagePending</a><span title="(remote: edu.berkeley.cs.scads.comm.RemoteNode, msg: Either[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message])edu.berkeley.cs.scads.comm.MessagePending[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]" class="delimiter">[</span><a href="Messages.scala.html#9609" title="edu.berkeley.cs.scads.comm.Message">Message</a>, <a href="Messages.scala.html#9609" title="edu.berkeley.cs.scads.comm.Message">Message</a><span class="delimiter">]</span><span class="delimiter">(</span><a href="#36845" title="edu.berkeley.cs.scads.comm.RemoteNode">dest</a>, <span title="(a: edu.berkeley.cs.scads.comm.Message)Left[edu.berkeley.cs.scads.comm.Message,Nothing]">Left</span><span class="delimiter">(</span><a href="#36846" title="edu.berkeley.cs.scads.comm.Message">msg</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#14329" title="(evt: edu.berkeley.cs.scads.comm.MessageHandlerEvent[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message])edu.berkeley.cs.scads.comm.MessageHandlerResponse">foldLeftListeners</a><span class="delimiter">(</span><a href="#36850" title="edu.berkeley.cs.scads.comm.MessagePending[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">evt</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#37182" title="Unit">RelayMessage</a> =&gt; <a href="#14326" title="=&gt; edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">impl</a>.<a href="AvroChannelManager.scala.html#14305" title="(dest: edu.berkeley.cs.scads.comm.RemoteNode, msg: edu.berkeley.cs.scads.comm.Message)Unit">sendMessageBulk</a><span class="delimiter">(</span><a href="#36845" title="edu.berkeley.cs.scads.comm.RemoteNode">dest</a>, <a href="#36846" title="edu.berkeley.cs.scads.comm.Message">msg</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="#37134" title="Unit">DropMessage</a>  =&gt; <span class="comment">/* Drop the message */</span>
      <span class="keyword">case</span> <span title="Unit">DelayMessage</span><span class="delimiter">(</span><a title="Long" id="36859">delay</a>, <a title="java.util.concurrent.TimeUnit" id="36860">units</a><span class="delimiter">)</span> =&gt;
        <a href="#14324" title="=&gt; java.util.concurrent.ScheduledExecutorService">delayExecutor</a>.<span title="(x$1: java.lang.Runnable, x$2: Long, x$3: java.util.concurrent.TimeUnit)java.util.concurrent.ScheduledFuture[_]">schedule</span><span title="Unit" class="delimiter">(</span><a href="#14330" title="(f: =&gt; Unit)java.lang.Object with java.lang.Runnable">toRunnable</a><span class="delimiter">(</span><a href="#14326" title="=&gt; edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">impl</a>.<a href="AvroChannelManager.scala.html#14305" title="(dest: edu.berkeley.cs.scads.comm.RemoteNode, msg: edu.berkeley.cs.scads.comm.Message)Unit">sendMessageBulk</a><span class="delimiter">(</span><a href="#36845" title="edu.berkeley.cs.scads.comm.RemoteNode">dest</a>, <a href="#36846" title="edu.berkeley.cs.scads.comm.Message">msg</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#36859" title="Long">delay</a>, <a href="#36860" title="java.util.concurrent.TimeUnit">units</a><span class="delimiter">)</span>        
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Unit" id="14333">flush</a> <span class="delimiter">{</span> <a href="#14326" title="=&gt; edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">impl</a>.<a href="AvroChannelManager.scala.html#14306" title="=&gt; Unit">flush</a> <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(port: Int)Unit" id="14334">startListener</a><span class="delimiter">(</span><a title="Int" id="36598">port</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#14326" title="=&gt; edu.berkeley.cs.scads.comm.AvroChannelManager[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">impl</a>.<a href="AvroChannelManager.scala.html#14307" title="(port: Int)Unit">startListener</a><span class="delimiter">(</span><a href="#36598" title="Int">port</a><span class="delimiter">)</span> <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(src: edu.berkeley.cs.scads.comm.RemoteNode, msg: edu.berkeley.cs.scads.comm.Message)Unit" id="14335">receiveMessage</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.RemoteNode" id="36876">src</a>: <a href="AvroChannelManager.scala.html#9506" title="edu.berkeley.cs.scads.comm.RemoteNode">RemoteNode</a>, <a title="edu.berkeley.cs.scads.comm.Message" id="36877">msg</a>: <a href="Messages.scala.html#9609" title="edu.berkeley.cs.scads.comm.Message">Message</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span title="Nothing" class="keyword">throw</span> <span title="(x$1: Any)java.lang.AssertionError" class="keyword">new</span> <span title="java.lang.AssertionError">AssertionError</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Should not be called- doReceiveMessage should be called instead&quot;)" class="string">&quot;Should not be called- doReceiveMessage should be called instead&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(src: edu.berkeley.cs.scads.comm.RemoteNode, msg: edu.berkeley.cs.scads.comm.Message)Unit" id="14336">doReceiveMessage</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.RemoteNode" id="35683">src</a>: <a href="AvroChannelManager.scala.html#9506" title="edu.berkeley.cs.scads.comm.RemoteNode">RemoteNode</a>, <a title="edu.berkeley.cs.scads.comm.Message" id="35684">msg</a>: <a href="Messages.scala.html#9609" title="edu.berkeley.cs.scads.comm.Message">Message</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#14312" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">trace</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Received message %s from %s&quot;)" class="string">&quot;Received message %s from %s&quot;</span>, <a href="#35684" title="edu.berkeley.cs.scads.comm.Message">msg</a>, <a href="#35683" title="edu.berkeley.cs.scads.comm.RemoteNode">src</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.MessagePending[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]" id="36909">evt</a> = <a href="#37198" title="[SendType, RecvType](remote: edu.berkeley.cs.scads.comm.RemoteNode, msg: Either[SendType,RecvType])edu.berkeley.cs.scads.comm.MessagePending[SendType,RecvType]">MessagePending</a><span title="(remote: edu.berkeley.cs.scads.comm.RemoteNode, msg: Either[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message])edu.berkeley.cs.scads.comm.MessagePending[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]" class="delimiter">[</span><a href="Messages.scala.html#9609" title="edu.berkeley.cs.scads.comm.Message">Message</a>, <a href="Messages.scala.html#9609" title="edu.berkeley.cs.scads.comm.Message">Message</a><span class="delimiter">]</span><span class="delimiter">(</span><a href="#35683" title="edu.berkeley.cs.scads.comm.RemoteNode">src</a>, <span title="(b: edu.berkeley.cs.scads.comm.Message)Right[Nothing,edu.berkeley.cs.scads.comm.Message]">Right</span><span class="delimiter">(</span><a href="#35684" title="edu.berkeley.cs.scads.comm.Message">msg</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#14329" title="(evt: edu.berkeley.cs.scads.comm.MessageHandlerEvent[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message])edu.berkeley.cs.scads.comm.MessageHandlerResponse">foldLeftListeners</a><span class="delimiter">(</span><a href="#36909" title="edu.berkeley.cs.scads.comm.MessagePending[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">evt</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#37182" title="Unit">RelayMessage</a> =&gt; <a href="#14339" title="(src: edu.berkeley.cs.scads.comm.RemoteNode, msg: edu.berkeley.cs.scads.comm.Message)Unit">doReceiveMessage0</a><span class="delimiter">(</span><a href="#35683" title="edu.berkeley.cs.scads.comm.RemoteNode">src</a>, <a href="#35684" title="edu.berkeley.cs.scads.comm.Message">msg</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="#37134" title="Unit">DropMessage</a>  =&gt; <span class="comment">/* Drop the message */</span>
      <span class="keyword">case</span> <span title="Unit">DelayMessage</span><span class="delimiter">(</span><a title="Long" id="36923">delay</a>, <a title="java.util.concurrent.TimeUnit" id="36924">units</a><span class="delimiter">)</span> =&gt;
        <a href="#14324" title="=&gt; java.util.concurrent.ScheduledExecutorService">delayExecutor</a>.<span title="(x$1: java.lang.Runnable, x$2: Long, x$3: java.util.concurrent.TimeUnit)java.util.concurrent.ScheduledFuture[_]">schedule</span><span title="Unit" class="delimiter">(</span><a href="#14330" title="(f: =&gt; Unit)java.lang.Object with java.lang.Runnable">toRunnable</a><span class="delimiter">(</span><a href="#14339" title="(src: edu.berkeley.cs.scads.comm.RemoteNode, msg: edu.berkeley.cs.scads.comm.Message)Unit">doReceiveMessage0</a><span class="delimiter">(</span><a href="#35683" title="edu.berkeley.cs.scads.comm.RemoteNode">src</a>, <a href="#35684" title="edu.berkeley.cs.scads.comm.Message">msg</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#36923" title="Long">delay</a>, <a href="#36924" title="java.util.concurrent.TimeUnit">units</a><span class="delimiter">)</span>        
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">val</span> <a title="java.util.concurrent.atomic.AtomicLong" id="14337">invalidMessageCount</a> = <span title="()java.util.concurrent.atomic.AtomicLong" class="keyword">new</span> java.util.concurrent.atomic.<span title="java.util.concurrent.atomic.AtomicLong">AtomicLong</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(src: edu.berkeley.cs.scads.comm.RemoteNode, msg: edu.berkeley.cs.scads.comm.Message)Unit" id="14339">doReceiveMessage0</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.RemoteNode" id="36920">src</a>: <a href="AvroChannelManager.scala.html#9506" title="edu.berkeley.cs.scads.comm.RemoteNode">RemoteNode</a>, <a title="edu.berkeley.cs.scads.comm.Message" id="36921">msg</a>: <a href="Messages.scala.html#9609" title="edu.berkeley.cs.scads.comm.Message">Message</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.MessageReceiver" id="36938">service</a> = <a href="#14316" title="=&gt; java.util.concurrent.ConcurrentHashMap[edu.berkeley.cs.scads.comm.ActorId,edu.berkeley.cs.scads.comm.MessageReceiver]">serviceRegistry</a>.<span title="(x$1: Any)edu.berkeley.cs.scads.comm.MessageReceiver">get</span><span class="delimiter">(</span><a href="#36921" title="edu.berkeley.cs.scads.comm.Message">msg</a>.<a href="Messages.scala.html#24109" title="=&gt; edu.berkeley.cs.scads.comm.ActorId">dest</a><span class="delimiter">)</span>

    <a href="#14312" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">trace</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Received Message: %s from %s&quot;)" class="string">&quot;Received Message: %s from %s&quot;</span>, <a href="#36921" title="edu.berkeley.cs.scads.comm.Message">msg</a>, <a href="#36920" title="edu.berkeley.cs.scads.comm.RemoteNode">src</a><span class="delimiter">)</span>

    <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#36938" title="edu.berkeley.cs.scads.comm.MessageReceiver">service</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#36938" title="edu.berkeley.cs.scads.comm.MessageReceiver">service</a>.<a href="MessageReceiver.scala.html#24586" title="(src: Option[edu.berkeley.cs.scads.comm.RemoteActorProxy], msg: edu.berkeley.cs.scads.comm.MessageBody)Unit">receiveMessage</a><span class="delimiter">(</span><a href="#36921" title="edu.berkeley.cs.scads.comm.Message">msg</a>.<a href="Messages.scala.html#24106" title="=&gt; Option[edu.berkeley.cs.scads.comm.ActorId]">src</a>.<span title="(f: edu.berkeley.cs.scads.comm.ActorId =&gt; edu.berkeley.cs.scads.comm.RemoteActor)Option[edu.berkeley.cs.scads.comm.RemoteActor]">map</span><span class="delimiter">(</span><a href="Actors.scala.html#15866" title="(host: String, port: Int, id: edu.berkeley.cs.scads.comm.ActorId)edu.berkeley.cs.scads.comm.RemoteActor">RemoteActor</a><span class="delimiter">(</span><a href="#36920" title="edu.berkeley.cs.scads.comm.RemoteNode">src</a>.<a href="AvroChannelManager.scala.html#24027" title="=&gt; String">hostname</a>, <a href="#36920" title="edu.berkeley.cs.scads.comm.RemoteNode">src</a>.<a href="AvroChannelManager.scala.html#24029" title="=&gt; Int">port</a>, <a href="#36951" title="edu.berkeley.cs.scads.comm.ActorId">_</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#36921" title="edu.berkeley.cs.scads.comm.Message">msg</a>.<a href="Messages.scala.html#24115" title="=&gt; edu.berkeley.cs.scads.comm.MessageBody">body</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#14312" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Got message from %s for an unknown service: %s&quot;)" class="string">&quot;Got message from %s for an unknown service: %s&quot;</span>, <a href="#36920" title="edu.berkeley.cs.scads.comm.RemoteNode">src</a>, <a href="#36921" title="edu.berkeley.cs.scads.comm.Message">msg</a>.<a href="Messages.scala.html#24109" title="=&gt; edu.berkeley.cs.scads.comm.ActorId">dest</a><span class="delimiter">)</span>
      <a href="#14337" title="=&gt; java.util.concurrent.atomic.AtomicLong">invalidMessageCount</a>.<span title="()Long">incrementAndGet</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Immediately start listener on instantiation */</span> 
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Int" id="14340">localPort</a> = <a href="#14342" title="()Int">initListener</a><span class="delimiter">(</span><span class="delimiter">)</span> 

  <span class="comment">/** Naively increments port until a valid one is found */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Int" id="14342">initListener</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="36588">port</a> = <a href="#14310" title="=&gt; net.lag.configgy.Config">config</a>.<span title="(key: String, defaultValue: Int)Int">getInt</span><span class="delimiter">(</span><span title="java.lang.String(&quot;scads.comm.listen&quot;)" class="string">&quot;scads.comm.listen&quot;</span>, <span title="Int(9000)" class="int">9000</span><span class="delimiter">)</span>
    <span class="keyword">var</span> <a title="Int" id="36589">numTries</a> = <span title="Int(0)" class="int">0</span>
    <span class="keyword">var</span> <a title="Boolean" id="36590">found</a>    = <span title="Boolean(false)" class="keyword">false</span>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#36590" title="Boolean">found</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#36589" title="Int">numTries</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(500)" class="int">500</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#36591" title="()Unit" class="keyword">try</a> <span class="delimiter">{</span>
        <a href="#14334" title="(port: Int)Unit">startListener</a><span class="delimiter">(</span><a href="#36588" title="Int">port</a><span class="delimiter">)</span>
        <a href="#36590" title="Boolean">found</a> = <span title="Boolean(true)" class="keyword">true</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Unit" id="36600">ex</a>: <span title="Exception">Exception</span> =&gt; 
          <a href="#14312" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Could not listen on port %d, trying %d&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#36588" title="Int">port</a>, <a href="#36588" title="Int">port</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#36588" title="Int">port</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span> <a href="#36589" title="Int">numTries</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span> <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#36590" title="Boolean">found</a><span class="delimiter">)</span>
      <a href="#36588" title="Int">port</a>
    <span class="keyword">else</span> <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Could not initialize listening port in 50 tries&quot;)" class="string">&quot;Could not initialize listening port in 50 tries&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">// Methods for registering/unregistering proxies</span>

  <span class="keyword">def</span> <a title="(a: scala.actors.Actor)edu.berkeley.cs.scads.comm.RemoteActorProxy" id="14343">registerActor</a><span class="delimiter">(</span><a title="scala.actors.Actor" id="14350">a</a>: <span title="scala.actors.Actor">Actor</span><span class="delimiter">)</span>: <a href="Actors.scala.html#9497" title="edu.berkeley.cs.scads.comm.RemoteActorProxy">RemoteActorProxy</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Long" id="36960">id</a> = <a href="#14314" title="=&gt; java.util.concurrent.atomic.AtomicLong">curActorId</a>.<span title="()Long">getAndIncrement</span>
    <a href="#14316" title="=&gt; java.util.concurrent.ConcurrentHashMap[edu.berkeley.cs.scads.comm.ActorId,edu.berkeley.cs.scads.comm.MessageReceiver]">serviceRegistry</a>.<span title="(x$1: edu.berkeley.cs.scads.comm.ActorId, x$2: edu.berkeley.cs.scads.comm.MessageReceiver)edu.berkeley.cs.scads.comm.MessageReceiver">put</span><span class="delimiter">(</span><a href="Messages.scala.html#36969" title="(num: Long)edu.berkeley.cs.scads.comm.ActorNumber">ActorNumber</a><span class="delimiter">(</span><a href="#36960" title="Long">id</a><span class="delimiter">)</span>, <a href="MessageReceiver.scala.html#36983" title="(a: scala.actors.Actor)edu.berkeley.cs.scads.comm.ActorService">ActorService</a><span class="delimiter">(</span><a href="#14350" title="scala.actors.Actor">a</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="Actors.scala.html#15866" title="(host: String, port: Int, id: edu.berkeley.cs.scads.comm.ActorId)edu.berkeley.cs.scads.comm.RemoteActor">RemoteActor</a><span class="delimiter">(</span><a href="#14320" title="=&gt; java.lang.String">hostname</a>, <a href="#14340" title="=&gt; Int">localPort</a>, <a href="Messages.scala.html#36969" title="(num: Long)edu.berkeley.cs.scads.comm.ActorNumber">ActorNumber</a><span class="delimiter">(</span><a href="#36960" title="Long">id</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(ra: edu.berkeley.cs.scads.comm.RemoteActorProxy)Unit" id="14344">unregisterActor</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.RemoteActorProxy" id="14739">ra</a>: <a href="Actors.scala.html#9497" title="edu.berkeley.cs.scads.comm.RemoteActorProxy">RemoteActorProxy</a><span class="delimiter">)</span> <span class="delimiter">{</span> 
    <a href="#14316" title="=&gt; java.util.concurrent.ConcurrentHashMap[edu.berkeley.cs.scads.comm.ActorId,edu.berkeley.cs.scads.comm.MessageReceiver]">serviceRegistry</a>.<span title="(x$1: Any)edu.berkeley.cs.scads.comm.MessageReceiver">remove</span><span title="Unit" class="delimiter">(</span><a href="#14739" title="edu.berkeley.cs.scads.comm.RemoteActorProxy">ra</a>.<a href="Actors.scala.html#14722" title="=&gt; edu.berkeley.cs.scads.comm.ActorId">id</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(service: edu.berkeley.cs.scads.comm.MessageReceiver)edu.berkeley.cs.scads.comm.RemoteActor" id="14345">registerService</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.MessageReceiver" id="24593">service</a>: <a href="MessageReceiver.scala.html#9591" title="edu.berkeley.cs.scads.comm.MessageReceiver">MessageReceiver</a><span class="delimiter">)</span>: <a href="Actors.scala.html#9483" title="edu.berkeley.cs.scads.comm.RemoteActor">RemoteActor</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.ActorNumber" id="36998">id</a> = <a href="Messages.scala.html#36969" title="(num: Long)edu.berkeley.cs.scads.comm.ActorNumber">ActorNumber</a><span class="delimiter">(</span><a href="#14314" title="=&gt; java.util.concurrent.atomic.AtomicLong">curActorId</a>.<span title="()Long">getAndIncrement</span><span class="delimiter">)</span>
    <a href="#14316" title="=&gt; java.util.concurrent.ConcurrentHashMap[edu.berkeley.cs.scads.comm.ActorId,edu.berkeley.cs.scads.comm.MessageReceiver]">serviceRegistry</a>.<span title="(x$1: edu.berkeley.cs.scads.comm.ActorId, x$2: edu.berkeley.cs.scads.comm.MessageReceiver)edu.berkeley.cs.scads.comm.MessageReceiver">put</span><span class="delimiter">(</span><a href="#36998" title="edu.berkeley.cs.scads.comm.ActorNumber">id</a>, <a href="#24593" title="edu.berkeley.cs.scads.comm.MessageReceiver">service</a><span class="delimiter">)</span>
    <a href="Actors.scala.html#15866" title="(host: String, port: Int, id: edu.berkeley.cs.scads.comm.ActorId)edu.berkeley.cs.scads.comm.RemoteActor">RemoteActor</a><span class="delimiter">(</span><a href="#14320" title="=&gt; java.lang.String">hostname</a>, <a href="#14340" title="=&gt; Int">localPort</a>, <a href="#36998" title="edu.berkeley.cs.scads.comm.ActorNumber">id</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(id: String, service: edu.berkeley.cs.scads.comm.MessageReceiver)edu.berkeley.cs.scads.comm.RemoteActorProxy" id="14346">registerService</a><span class="delimiter">(</span><a title="String" id="24590">id</a>: <span title="String">String</span>, <a title="edu.berkeley.cs.scads.comm.MessageReceiver" id="24591">service</a>: <a href="MessageReceiver.scala.html#9591" title="edu.berkeley.cs.scads.comm.MessageReceiver">MessageReceiver</a><span class="delimiter">)</span>: <a href="Actors.scala.html#9497" title="edu.berkeley.cs.scads.comm.RemoteActorProxy">RemoteActorProxy</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.ActorName" id="36999">key</a> = <a href="Messages.scala.html#37003" title="(name: String)edu.berkeley.cs.scads.comm.ActorName">ActorName</a><span class="delimiter">(</span><a href="#24590" title="String">id</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.MessageReceiver" id="37000">value0</a> = <a href="#14316" title="=&gt; java.util.concurrent.ConcurrentHashMap[edu.berkeley.cs.scads.comm.ActorId,edu.berkeley.cs.scads.comm.MessageReceiver]">serviceRegistry</a>.<span title="(x$1: edu.berkeley.cs.scads.comm.ActorId, x$2: edu.berkeley.cs.scads.comm.MessageReceiver)edu.berkeley.cs.scads.comm.MessageReceiver">putIfAbsent</span><span class="delimiter">(</span><a href="#36999" title="edu.berkeley.cs.scads.comm.ActorName">key</a>, <a href="#24591" title="edu.berkeley.cs.scads.comm.MessageReceiver">service</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#37000" title="edu.berkeley.cs.scads.comm.MessageReceiver">value0</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.IllegalArgumentException" class="keyword">new</span> <span title="java.lang.IllegalArgumentException">IllegalArgumentException</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Service with %s already registered: %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#24590" title="String">id</a>, <a href="#24591" title="edu.berkeley.cs.scads.comm.MessageReceiver">service</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="Actors.scala.html#15866" title="(host: String, port: Int, id: edu.berkeley.cs.scads.comm.ActorId)edu.berkeley.cs.scads.comm.RemoteActor">RemoteActor</a><span class="delimiter">(</span><a href="#14320" title="=&gt; java.lang.String">hostname</a>, <a href="#14340" title="=&gt; Int">localPort</a>, <a href="#36999" title="edu.berkeley.cs.scads.comm.ActorName">key</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(id: String)edu.berkeley.cs.scads.comm.MessageReceiver" id="14347">getService</a><span class="delimiter">(</span><a title="String" id="37034">id</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="MessageReceiver.scala.html#9591" title="edu.berkeley.cs.scads.comm.MessageReceiver">MessageReceiver</a> = 
    <a href="#14316" title="=&gt; java.util.concurrent.ConcurrentHashMap[edu.berkeley.cs.scads.comm.ActorId,edu.berkeley.cs.scads.comm.MessageReceiver]">serviceRegistry</a>.<span title="(x$1: Any)edu.berkeley.cs.scads.comm.MessageReceiver">get</span><span class="delimiter">(</span><a href="#37034" title="String">id</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Register a MessageHandlerListener. Listeners are registered in FIFO
   * order. Note that priority is given to the beginning listeners, meaning if
   * listener A comes before B, and A drops/delays a message, B will never receive
   * notification of that message. Only if A relays the message will B get a
   * chance to act on the message
   *
   * Note: This implementation does check if listener is already registered.
   * If so, this is a no-op (priority is also not changed). Also, registering
   * (and unregistering) is a fairly expensive operation, since the backing
   * list is implemented as a COW list, so it is recommended that listeners
   * are added as part of an initialization sequence, and not touched then.
   */</span> 
  <span class="keyword">def</span> <a title="(listener: edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message])Unit" id="14348">registerListener</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]" id="37036">listener</a>: <a href="#9581" title="edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">MessageHandlerListener</a><span class="delimiter">[</span>Message, Message<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#14322" title="=&gt; java.util.concurrent.CopyOnWriteArrayList[edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]]">listeners</a>.<span title="(x$1: edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message])Boolean">addIfAbsent</span><span title="Unit" class="delimiter">(</span><a href="#37036" title="edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">listener</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Unregisters a MessageHandlerListener.
   *
   * Note: Is a no-op if listener is not already registered
   */</span>
  <span class="keyword">def</span> <a title="(listener: edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message])Unit" id="14349">unregisterListener</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]" id="37039">listener</a>: <a href="#9581" title="edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">MessageHandlerListener</a><span class="delimiter">[</span>Message, Message<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#14322" title="=&gt; java.util.concurrent.CopyOnWriteArrayList[edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]]">listeners</a>.<span title="(x$1: Any)Boolean">remove</span><span title="Unit" class="delimiter">(</span><a href="#37039" title="edu.berkeley.cs.scads.comm.MessageHandlerListener[edu.berkeley.cs.scads.comm.Message,edu.berkeley.cs.scads.comm.Message]">listener</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="keyword">sealed</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class MessageHandlerEvent[SendType, RecvType] extends java.lang.Object with ScalaObject" id="9565">MessageHandlerEvent</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="9566">SendType</a>, <a title="&gt;: Nothing &lt;: Any" id="9567">RecvType</a><span class="delimiter">]</span>

<span class="comment">/**
 * Indicates that either a message is about to be sent, or a message is about
 * to be received. A LeftProjection of message indicates the former, a
 * RightProjection indicates the latter
 */</span>
case <span class="keyword">class</span> <a title="class MessagePending[SendType, RecvType] extends edu.berkeley.cs.scads.comm.MessageHandlerEvent[SendType,RecvType] with ScalaObject with Product with Serializable" id="37198">MessagePending</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="36724">SendType</a>, <a title="&gt;: Nothing &lt;: Any" id="36725">RecvType</a><span class="delimiter">]</span><a href="#37198" title="ScalaObject" class="delimiter">(</a><a title="edu.berkeley.cs.scads.comm.RemoteNode" id="36743">remote</a>: <a href="AvroChannelManager.scala.html#9506" title="edu.berkeley.cs.scads.comm.RemoteNode">RemoteNode</a>, <a title="Either[SendType,RecvType]" id="36744">msg</a>: <span title="Either[SendType,RecvType]">Either</span><span class="delimiter">[</span>SendType, RecvType<span class="delimiter">]</span><span class="delimiter">)</span>
  <span class="keyword">extends</span> <a href="#9565" title="edu.berkeley.cs.scads.comm.MessageHandlerEvent[SendType,RecvType]">MessageHandlerEvent</a><span class="delimiter">[</span>SendType, RecvType<span class="delimiter">]</span>

<span class="keyword">sealed</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class MessageHandlerResponse extends java.lang.Object with ScalaObject" id="9573">MessageHandlerResponse</a>

<span class="comment">/**
 * Drop the message corresponding to the MessageHandlerEvent entirely
 */</span>
case <span class="keyword">object</span> <a href="#37129" title="object edu.berkeley.cs.scads.comm.DropMessage" id="37134">DropMessage</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#9573" title="edu.berkeley.cs.scads.comm.MessageHandlerResponse">MessageHandlerResponse</a>

<span class="comment">/**
 * Delay the message corresponding to the MessageHandlerEvent by delay. If the
 * message is about to be sent, this means don't send it until delay has
 * elasped. If the message is about to be received, this means don't receive
 * the message until the delay has elasped.
 */</span>
case <span class="keyword">class</span> <a title="class DelayMessage extends edu.berkeley.cs.scads.comm.MessageHandlerResponse with ScalaObject with Product with Serializable" id="37192">DelayMessage</a><a href="#37192" title="ScalaObject" class="delimiter">(</a><a title="Long" id="37187">delay</a>: <span title="Long">Long</span>, <a title="java.util.concurrent.TimeUnit" id="37188">units</a>: <span title="java.util.concurrent.TimeUnit">TimeUnit</span><span class="delimiter">)</span>
  <span class="keyword">extends</span> <a href="#9573" title="edu.berkeley.cs.scads.comm.MessageHandlerResponse">MessageHandlerResponse</a>

<span class="comment">/**
 * Resume the regular course of action for the message
 */</span>
case <span class="keyword">object</span> <a href="#37177" title="object edu.berkeley.cs.scads.comm.RelayMessage" id="37182">RelayMessage</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#9573" title="edu.berkeley.cs.scads.comm.MessageHandlerResponse">MessageHandlerResponse</a>

<span class="comment">/**
 * Base trait for a MessageHandler event listener
 */</span>
<span class="keyword">trait</span> <a title="trait MessageHandlerListener[SendType, RecvType] extends java.lang.Object" id="9581">MessageHandlerListener</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="9582">SendType</a>, <a title="&gt;: Nothing &lt;: Any" id="9583">RecvType</a><span class="delimiter">]</span> <span title="java.lang.Object" class="delimiter">{</span>

  <span class="comment">/**
   * Main method for listeners to supply.
   */</span>
  <span class="keyword">def</span> <a title="(evt: edu.berkeley.cs.scads.comm.MessageHandlerEvent[SendType,RecvType])edu.berkeley.cs.scads.comm.MessageHandlerResponse" id="33813">handleEvent</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.MessageHandlerEvent[SendType,RecvType]" id="36645">evt</a>: <a href="#9565" title="edu.berkeley.cs.scads.comm.MessageHandlerEvent[SendType,RecvType]">MessageHandlerEvent</a><span class="delimiter">[</span>SendType, RecvType<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#9573" title="edu.berkeley.cs.scads.comm.MessageHandlerResponse">MessageHandlerResponse</a>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>