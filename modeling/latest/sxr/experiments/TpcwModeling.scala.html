<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>experiments/TpcwModeling.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs
<span class="keyword">package</span> scads
<span class="keyword">package</span> piql
<span class="keyword">package</span> modeling

<span class="keyword">import</span> comm._
<span class="keyword">import</span> storage._
<span class="keyword">import</span> perf._
<span class="keyword">import</span> deploylib.ec2._
<span class="keyword">import</span> deploylib.mesos._
<span class="keyword">import</span> piql.scadr._
<span class="keyword">import</span> perf.scadr._
<span class="keyword">import</span> avro.marker._
<span class="keyword">import</span> avro.runtime._
<span class="keyword">import</span> <a href="ExperimentUtil.scala.html#9689" title="object edu.berkeley.cs.scads.piql.modeling.ExperimentUtil">ExperimentUtil</a>._
<span class="keyword">import</span> scala.collection.mutable.ArrayBuffer

<span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling" id="9760">TpcwModeling</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util" id="69507">Util</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(summary: (edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram))Unit" id="69532">printPerIterationPredictionSummary</a><span class="delimiter">(</span><a title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="71107">summary</a>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="71110">actualHist</a> = <a href="#71107" title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)">summary</a>.<span title="=&gt; edu.berkeley.cs.scads.perf.Histogram">_1</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="71111">predictedHist</a> = <a href="#71107" title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)">summary</a>.<span title="=&gt; edu.berkeley.cs.scads.perf.Histogram">_2</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Any*)List[Any]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Actual:&quot;)" class="string">&quot;Actual:&quot;</span>, <span title="java.lang.String(&quot;average=&quot;)" class="string">&quot;average=&quot;</span>, <a href="#71110" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="=&gt; Double">average</span>, <span title="java.lang.String(&quot;median=&quot;)" class="string">&quot;median=&quot;</span>, <a href="#71110" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="=&gt; Int">median</span>, <span title="java.lang.String(&quot;stddev=&quot;)" class="string">&quot;stddev=&quot;</span>, <a href="#71110" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="=&gt; Double">stddev</span>, <span title="java.lang.String(&quot;max=&quot;)" class="string">&quot;max=&quot;</span>, <a href="#71110" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Any*)List[Any]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Predicted:&quot;)" class="string">&quot;Predicted:&quot;</span>, <span title="java.lang.String(&quot;average=&quot;)" class="string">&quot;average=&quot;</span>, <a href="#71111" title="edu.berkeley.cs.scads.perf.Histogram">predictedHist</a>.<span title="=&gt; Double">average</span>, <span title="java.lang.String(&quot;median=&quot;)" class="string">&quot;median=&quot;</span>, <a href="#71111" title="edu.berkeley.cs.scads.perf.Histogram">predictedHist</a>.<span title="=&gt; Int">median</span>, <span title="java.lang.String(&quot;stddev=&quot;)" class="string">&quot;stddev=&quot;</span>, <a href="#71111" title="edu.berkeley.cs.scads.perf.Histogram">predictedHist</a>.<span title="=&gt; Double">stddev</span>, <span title="java.lang.String(&quot;max=&quot;)" class="string">&quot;max=&quot;</span>, <a href="#71111" title="edu.berkeley.cs.scads.perf.Histogram">predictedHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  	<span class="keyword">def</span> <a title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]" id="69533">convolve</a><span class="delimiter">(</span><a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="70170">hist1</a>: <span title="scala.collection.mutable.ArrayBuffer[BigInt]">ArrayBuffer</span><span class="delimiter">[</span>BigInt<span class="delimiter">]</span>, <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="70171">hist2</a>: <span title="scala.collection.mutable.ArrayBuffer[BigInt]">ArrayBuffer</span><span class="delimiter">[</span>BigInt<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scala.collection.mutable.ArrayBuffer[BigInt]">ArrayBuffer</span><span class="delimiter">[</span>BigInt<span class="delimiter">]</span> = <span class="delimiter">{</span>
  	  <span class="keyword">var</span> <a title="Int" id="71145">defaultBucketCount</a> = <span title="Int(1000)" class="int">1000</span>

  	  <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71146">result</a> = <span title="object scala.collection.mutable.ArrayBuffer">ArrayBuffer</span>.<span title="(n: Int)(elem: =&gt; scala.math.BigInt)scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">fill</span><span class="delimiter">(</span><a href="#71145" title="Int">defaultBucketCount</a><span class="delimiter">)</span><span class="delimiter">(</span><span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>

  	  <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71145" title="Int">defaultBucketCount</a><span title="(x: Int)Int">-</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="71328">i</a> =&gt; <span class="delimiter">{</span>
  	    <span class="keyword">var</span> <a title="scala.math.BigInt" id="71329">integralOfOverlap</a> = <span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>

        <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71328" title="Int">i</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="71450">j</a> =&gt; <span class="delimiter">{</span>
          <a href="#71329" title="scala.math.BigInt">integralOfOverlap</a> <span title="(that: scala.math.BigInt)scala.math.BigInt">+=</span> <a href="#70170" title="(idx: Int)BigInt">hist1</a><span class="delimiter">(</span><a href="#71328" title="Int">i</a><span title="(x: Int)Int">-</span><a href="#71450" title="Int">j</a><span class="delimiter">)</span> <span title="(that: scala.math.BigInt)scala.math.BigInt">*</span> <a href="#70171" title="(idx: Int)BigInt">hist2</a><span class="delimiter">(</span><a href="#71450" title="Int">j</a><span class="delimiter">)</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>

        <a href="#71146" title="(idx: Int, elem: scala.math.BigInt)Unit">result</a><span class="delimiter">(</span><a href="#71328" title="Int">i</a><span class="delimiter">)</span> = <a href="#71329" title="scala.math.BigInt">integralOfOverlap</a>
  	  <span class="delimiter">}</span><span class="delimiter">)</span>

  	  <a href="#71146" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">result</a>
  	<span class="delimiter">}</span>
  	
  	<span class="comment">// default bucket size is 1</span>
  	<span class="keyword">val</span> <a title="Int" id="69534">bucketSize</a> = <span title="Int(1)" class="int">1</span>
  	<span class="keyword">def</span> <a title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int" id="69536">quantile</a><span class="delimiter">(</span><a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="70163">hist</a>: <span title="scala.collection.mutable.ArrayBuffer[BigInt]">ArrayBuffer</span><span class="delimiter">[</span>BigInt<span class="delimiter">]</span>, <a title="Double" id="70164">quantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
  	  <span class="keyword">val</span> <a title="Int" id="71530">quantileAsInt</a> = <span class="delimiter">(</span><a href="#70164" title="Double">quantile</a> <span title="(x: Int)Double">*</span> <span title="Int(100)" class="int">100</span><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span>  <span class="comment">// convert to percentage; still receive input as percentage to maintain consistency with Histogram's version</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71531">cumulativeSum</a> = <a href="#70163" title="scala.collection.mutable.ArrayBuffer[BigInt]">hist</a>.<span title="(z: scala.math.BigInt)(op: (scala.math.BigInt, BigInt) =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[BigInt],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">scanLeft</span><span class="delimiter">(</span><span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><a href="#71565" title="scala.math.BigInt">_</a> <span title="(that: scala.math.BigInt)scala.math.BigInt">+</span> <a href="#71566" title="BigInt">_</a><span class="delimiter">)</span>.<span title="(n: Int)scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">drop</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span title="Int" class="keyword">if</span><span class="delimiter">(</span><a href="#70163" title="scala.collection.mutable.ArrayBuffer[BigInt]">hist</a>.<span title="(implicit num: Numeric[BigInt])BigInt">sum</span> <span title="(that: scala.math.BigInt)Boolean">&gt;</span> <span title="implicit scala.math.BigInt.int2bigInt : (i: Int)scala.math.BigInt" class="int">0</span><span class="delimiter">)</span>
        <a href="#71531" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">cumulativeSum</a>.<span title="(p: scala.math.BigInt =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#71645" title="scala.math.BigInt">_</a> <span title="(that: scala.math.BigInt)Boolean">&gt;=</span> <a href="#70163" title="scala.collection.mutable.ArrayBuffer[BigInt]">hist</a>.<span title="(implicit num: Numeric[BigInt])BigInt">sum</span> <span title="(that: scala.math.BigInt)scala.math.BigInt">*</span> <span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71530" title="Int">quantileAsInt</a><span class="delimiter">)</span><span title="(that: scala.math.BigInt)scala.math.BigInt">/</span><span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><span title="Int(100)" class="int">100</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x: Int)Int">*</span> <a href="#69534" title="=&gt; Int">bucketSize</a>
      <span class="keyword">else</span>
        <span title="Int(0)" class="int">0</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(actual: Double, predicted: Double)Unit" id="69537">printActualAndPredicted</a><span class="delimiter">(</span><a title="Double" id="71671">actual</a>:<span title="Double">Double</span>, <a title="Double" id="71672">predicted</a>:<span title="Double">Double</span><span class="delimiter">)</span> = <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Any*)List[Any]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;actual=&quot;)" class="string">&quot;actual=&quot;</span>, <a href="#71671" title="Double">actual</a>, <span title="java.lang.String(&quot;predicted=&quot;)" class="string">&quot;predicted=&quot;</span>, <a href="#71672" title="Double">predicted</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  
    <span class="comment">/*
    def average(hist: ArrayBuffer[BigInt]) = {
      val n = hist.sum
      hist.zipWithIndex.foldLeft(BigInt(0)) { case (acc, (num, idx)) =&gt; acc + num * idx * bucketSize / n }
    }

    /**
     * Sample standard deviation based off of sqrt(1/(N-1)*sum((Xi-mean(X))^2))
     */
    def stddev(hist: ArrayBuffer[BigInt]) = {
      val n = hist.sum
      val xbar = average(hist)
      import scala.math._
      val a = hist.zipWithIndex.foldLeft(BigInt(0)) { case (acc, (num, idx)) =&gt; acc + num * (BigInt(idx) * bucketSize - xbar) * (BigInt(idx) * bucketSize - xbar) }
      sqrt(BigInt(1) / (n - BigInt(1)) * a.toDouble)  // causes compile error
    }
    */</span>
  
  <span class="delimiter">}</span>

  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData" id="69509">TpcwData</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="comment">//val clusterAddress = &quot;zk://zoo.knowsql.org/home/kcurtis/scads/experimentCluster0000000008&quot;</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-75-101-230-218.compute-1.amazonaws.com:2181,ec2-50-19-23-28.compute-1.amazonaws.com:2181,ec2-67-202-16-139.compute-1.amazonaws.com:2181/scads/experimentCluster0000000000&quot;</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-50-16-25-212.compute-1.amazonaws.com:2181,ec2-67-202-10-38.compute-1.amazonaws.com:2181,ec2-174-129-128-67.compute-1.amazonaws.com:2181/scads/experimentCluster0000000000&quot;</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-50-19-140-43.compute-1.amazonaws.com:2181,ec2-72-44-35-240.compute-1.amazonaws.com:2181,ec2-50-17-68-210.compute-1.amazonaws.com:2181/scads/experimentCluster0000000000&quot;</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-174-129-157-147.compute-1.amazonaws.com:2181,ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181/scads/experimentCluster0000000000&quot; // 5.26.11, afternoon</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-174-129-157-147.compute-1.amazonaws.com:2181,ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181/scads/experimentCluster0000000007&quot; // 5.27.11, 3p (blocking)</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-174-129-157-147.compute-1.amazonaws.com:2181,ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181/scads/experimentCluster0000000027&quot;</span>
    <span class="keyword">val</span> <a title="java.lang.String" id="71697">clusterAddress</a> = <span title="java.lang.String(&quot;zk://ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181,ec2-174-129-157-147.compute-1.amazonaws.com:2181/scads/experimentCluster0000000065&quot;)" class="string">&quot;zk://ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181,ec2-174-129-157-147.compute-1.amazonaws.com:2181/scads/experimentCluster0000000065&quot;</span>

    <span class="keyword">def</span> <a title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]" id="71699">experimentResults</a> = <a href="ExperimentUtil.scala.html#50437" title="=&gt; org.apache.avro.file.DataFileReader[edu.berkeley.cs.scads.piql.modeling.Result] with Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">allResults</a>.<span title="(p: edu.berkeley.cs.scads.piql.modeling.Result =&gt; Boolean)Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">filter</span><span class="delimiter">(</span><a href="#71716" title="edu.berkeley.cs.scads.piql.modeling.Result">_</a>.<a href="../collection/QueryRunnerTask.scala.html#38295" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryRunnerTask">clientConfig</a>.<a href="../collection/QueryRunnerTask.scala.html#38380" title="=&gt; String">clusterAddress</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#71697" title="=&gt; java.lang.String">clusterAddress</a><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="Int" id="71700">numIntervals</a> = <span title="Int(35)" class="int">35</span>
    <span class="keyword">def</span> <a title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]" id="71702">goodExperimentResults</a> = <a href="#71699" title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">experimentResults</a>.<span title="(p: edu.berkeley.cs.scads.piql.modeling.Result =&gt; Boolean)Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">filter</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.modeling.Result" id="71725">res</a> =&gt; <a href="#71725" title="edu.berkeley.cs.scads.piql.modeling.Result">res</a>.<a href="../collection/QueryRunnerTask.scala.html#38292" title="=&gt; Int">iteration</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(1)" class="int">1</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#71725" title="edu.berkeley.cs.scads.piql.modeling.Result">res</a>.<a href="../collection/QueryRunnerTask.scala.html#38292" title="=&gt; Int">iteration</a> <span title="(x: Int)Boolean">&lt;=</span> <a href="#71700" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>
        
    <span class="keyword">val</span> <a title="scala.collection.immutable.Map[edu.berkeley.cs.scads.piql.modeling.QueryDescription,edu.berkeley.cs.scads.perf.Histogram]" id="71703">histogramsTpcw</a> = <a href="ExperimentUtil.scala.html#50450" title="(results: Seq[edu.berkeley.cs.scads.piql.modeling.Result])scala.collection.immutable.Map[edu.berkeley.cs.scads.piql.modeling.QueryDescription,edu.berkeley.cs.scads.perf.Histogram]">queryTypeHistogram</a><span class="delimiter">(</span><a href="#71702" title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">goodExperimentResults</a>.<span title="=&gt; Seq[edu.berkeley.cs.scads.piql.modeling.Result]">toSeq</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="scala.collection.immutable.Map[(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int),edu.berkeley.cs.scads.perf.Histogram]" id="71705">perIterationHistograms</a> = <a href="ExperimentUtil.scala.html#50453" title="(results: Seq[edu.berkeley.cs.scads.piql.modeling.Result])scala.collection.immutable.Map[(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int),edu.berkeley.cs.scads.perf.Histogram]">queryTypePerIterationHistograms</a><span class="delimiter">(</span><a href="#71702" title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">goodExperimentResults</a>.<span title="=&gt; Seq[edu.berkeley.cs.scads.piql.modeling.Result]">toSeq</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelBuyRequestExistingCustomerWI" id="69511">ModelBuyRequestExistingCustomerWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#69509" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#69507" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71739">buyRequestExistingCustomerWI</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;buyRequestExistingCustomerWI&quot;)" class="string">&quot;buyRequestExistingCustomerWI&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="71741">buyRequestExistingCustomerWIHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71739" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">buyRequestExistingCustomerWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.buyRequestExistingCustomerWI.physicalPlan</span>
    <span class="comment">//res4: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: countries&gt;,ArrayBuffer(AttributeValue(1,6)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: addresses&gt;,ArrayBuffer(AttributeValue(0,4)),</span>
    <span class="comment">//                                             IndexLookup(&lt;Namespace: customers&gt;,ArrayBuffer(ParameterValue(0)))))</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71743">indexLookupCustomers</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupCustomers&quot;)" class="string">&quot;indexLookupCustomers&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71745">indexLookupCustomersHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71743" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71826" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71747">indexLookupJoinAddresses</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAddresses&quot;)" class="string">&quot;indexLookupJoinAddresses&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71749">indexLookupJoinAddressesHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71747" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAddresses</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71915" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71751">indexLookupJoinCountries</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinCountries&quot;)" class="string">&quot;indexLookupJoinCountries&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71753">indexLookupJoinCountriesHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71751" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinCountries</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72000" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="71755">predictHist</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="72047">res1</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#71745" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupCustomersHist</a>, <a href="#71749" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="72048">res2</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#72047" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#71753" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <a href="#72048" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="71756">actual99th</a> = <a href="#71741" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">buyRequestExistingCustomerWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="71758">predicted99th</a> = <a href="#69536" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#71755" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="71760">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="72049">i</a>: <span title="Int">Int</span>, <a title="Double" id="72050">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72052">indexLookupCustomersHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71743" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a>, <a href="#72049" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72097" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72053">indexLookupJoinAddressesHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71747" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAddresses</a>, <a href="#72049" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72181" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72054">indexLookupJoinCountriesHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71751" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinCountries</a>, <a href="#72049" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72265" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="72055">res1</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#72052" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupCustomersHist</a>, <a href="#72053" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="72056">res2</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#72055" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#72054" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <a href="#72056" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>

      <a href="#69536" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#72056" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#72050" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="71761">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="72311">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>
      
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72312">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72313">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>
      
      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71700" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="72444">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72445">actualHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71739" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">buyRequestExistingCustomerWI</a>, <a href="#72444" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="72446">actualQuantile</a> = <a href="#72445" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#72311" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#72312" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#72446" title="=&gt; Long">actualQuantile</a>
        
        <span class="keyword">val</span> <a title="Int" id="72447">predictedQuantile</a> = <a href="#71760" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#72444" title="Int">i</a>, <a href="#72311" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#72313" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#72447" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#72444" title="Int">i</a>, <a href="#72446" title="Int">actualQuantile</a>, <a href="#72447" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      
      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#72312" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#72313" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelHomeWI" id="69513">ModelHomeWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#69509" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#69507" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72493">homeWI</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;homeWI&quot;)" class="string">&quot;homeWI&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72495">homeWIHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72493" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">homeWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.homeWI.physicalPlan</span>
    <span class="comment">//res3: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookup(&lt;Namespace: customers&gt;,ArrayBuffer(ParameterValue(0)))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72497">indexLookupCustomers</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupCustomers&quot;)" class="string">&quot;indexLookupCustomers&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72499">indexLookupCustomersHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72497" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72571" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="Int" id="72501">actual99th</a> = <a href="#72495" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">homeWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="72503">predicted99th</a> = <a href="#69536" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#72499" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupCustomersHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="72505">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="72615">i</a>: <span title="Int">Int</span>, <a title="Double" id="72616">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72618">indexLookupCustomersHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72497" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a>, <a href="#72615" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72659" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <a href="#69536" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#72618" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupCustomersHist</a>, <a href="#72616" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="72506">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="72705">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>
      
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72706">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72707">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>
      
      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71700" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="72838">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72839">actualHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72493" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">homeWI</a>, <a href="#72838" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="72840">actualQuantile</a> = <a href="#72839" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#72705" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#72706" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#72840" title="=&gt; Long">actualQuantile</a>
        
        <span class="keyword">val</span> <a title="Int" id="72841">predictedQuantile</a> = <a href="#72505" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#72838" title="Int">i</a>, <a href="#72705" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#72707" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#72841" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#72838" title="Int">i</a>, <a href="#72840" title="Int">actualQuantile</a>, <a href="#72841" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      
      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#72706" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#72707" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
  
  <span class="comment">// yikes, doesn't work...</span>
  <span class="comment">// maybe not enough samples?</span>
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelNewProductWI" id="69515">ModelNewProductWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#69509" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#69507" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72887">newProductWI</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;newProductWI&quot;)" class="string">&quot;newProductWI&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(50)" class="int">50</span><span class="delimiter">)</span>, <span title="Int(50)" class="int">50</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72889">newProductWIHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72887" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">newProductWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.newProductWI.physicalPlan</span>
    <span class="comment">//res6: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: authors&gt;,List(AttributeValue(1,2)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: items&gt;,List(AttributeValue(0,2)),LocalStopAfter(ParameterLimit(1,50),</span>
    <span class="comment">//                                             IndexScan(&lt;Namespace: items_({&quot;fieldNames&quot;: [&quot;I_SUBJECT&quot;]},{&quot;fieldName&quot;: &quot;I_PUB_DATE&quot;})&gt;,List(ParameterValue(0)),ParameterLimit(1,50),false))))</span>
    
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72891">indexScanItemsIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanItemsIdx&quot;)" class="string">&quot;indexScanItemsIdx&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(50)" class="int">50</span><span class="delimiter">)</span>, <span title="Int(50)" class="int">50</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72893">indexScanItemsIdxHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72891" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanItemsIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72974" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72895">indexLookupJoinItems</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinItems&quot;)" class="string">&quot;indexLookupJoinItems&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(50)" class="int">50</span><span class="delimiter">)</span>, <span title="Int(50)" class="int">50</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72897">indexLookupJoinItemsHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72895" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinItems</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73059" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72899">indexLookupJoinAuthors</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAuthors&quot;)" class="string">&quot;indexLookupJoinAuthors&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(50)" class="int">50</span><span class="delimiter">)</span>, <span title="Int(50)" class="int">50</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72901">indexLookupJoinAuthorsHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72899" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73144" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="72903">predictHist</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73191">res1</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#72893" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanItemsIdxHist</a>, <a href="#72897" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinItemsHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73192">res2</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73191" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#72901" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
      <a href="#73192" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="72904">actual99th</a> = <a href="#72889" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">newProductWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="72906">predicted99th</a> = <a href="#69536" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#72903" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="72908">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="73193">i</a>: <span title="Int">Int</span>, <a title="Double" id="73194">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73196">indexScanItemsIdxHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72891" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanItemsIdx</a>, <a href="#73193" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73241" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73197">indexLookupJoinItemsHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72895" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinItems</a>, <a href="#73193" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73325" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73198">indexLookupJoinAuthorsHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72899" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a>, <a href="#73193" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73409" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73199">res1</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73196" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanItemsIdxHist</a>, <a href="#73197" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinItemsHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73200">res2</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73199" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#73198" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
      <a href="#73200" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>

      <a href="#69536" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#73200" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#73194" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="72909">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="73455">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>
      
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73456">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73457">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>
      
      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71700" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="73588">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73589">actualHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72887" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">newProductWI</a>, <a href="#73588" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="73590">actualQuantile</a> = <a href="#73589" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#73455" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#73456" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#73590" title="=&gt; Long">actualQuantile</a>
        
        <span class="keyword">val</span> <a title="Int" id="73591">predictedQuantile</a> = <a href="#72908" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#73588" title="Int">i</a>, <a href="#73455" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#73457" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#73591" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#73588" title="Int">i</a>, <a href="#73590" title="Int">actualQuantile</a>, <a href="#73591" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      
      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#73456" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#73457" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelOrderDisplayGetCustomer" id="69517">ModelOrderDisplayGetCustomer</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#69509" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#69507" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73637">orderDisplayGetCustomer</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;orderDisplayGetCustomer&quot;)" class="string">&quot;orderDisplayGetCustomer&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73639">orderDisplayGetCustomerHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73637" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetCustomer</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.orderDisplayGetCustomer.physicalPlan</span>
    <span class="comment">//res11: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookup(&lt;Namespace: customers&gt;,ArrayBuffer(ParameterValue(0)))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73641">indexLookupCustomers</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupCustomers&quot;)" class="string">&quot;indexLookupCustomers&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73643">indexLookupCustomersHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73641" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="Int" id="73645">actual99th</a> = <a href="#73639" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">orderDisplayGetCustomerHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="73647">predicted99th</a> = <a href="#73643" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">indexLookupCustomersHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="73649">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="73696">i</a>: <span title="Int">Int</span>, <a title="Double" id="73697">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73699">indexLookupCustomersHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73641" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a>, <a href="#73696" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="#73699" title="edu.berkeley.cs.scads.perf.Histogram">indexLookupCustomersHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#73697" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
        
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="73650">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="73723">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73724">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73725">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71700" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="73856">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73857">actualHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73637" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetCustomer</a>, <a href="#73856" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="73858">actualQuantile</a> = <a href="#73857" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#73723" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#73724" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#73858" title="=&gt; Long">actualQuantile</a>

        <span class="keyword">val</span> <a title="Int" id="73859">predictedQuantile</a> = <a href="#73649" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#73856" title="Int">i</a>, <a href="#73723" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#73725" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#73859" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#73856" title="Int">i</a>, <a href="#73858" title="Int">actualQuantile</a>, <a href="#73859" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#73724" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#73725" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelOrderDisplayGetLastOrder" id="69519">ModelOrderDisplayGetLastOrder</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#69509" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73904">orderDisplayGetLastOrder</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;orderDisplayGetLastOrder&quot;)" class="string">&quot;orderDisplayGetLastOrder&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>  <span class="comment">// queryName, params, resultCardinality</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73906">orderDisplayGetLastOrderHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73904" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetLastOrder</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; res3.orderDisplayGetLastOrder.physicalPlan</span>
    <span class="comment">//res4: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: countries&gt;,ArrayBuffer(AttributeValue(2,6)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: addresses&gt;,ArrayBuffer(AttributeValue(1,9)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: countries&gt;,ArrayBuffer(AttributeValue(2,6)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: addresses&gt;,ArrayBuffer(AttributeValue(1,8)),LocalStopAfter(FixedLimit(1),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: orders&gt;,ArrayBuffer(AttributeValue(0,2)),</span>
    <span class="comment">//                                             IndexScan(&lt;Namespace: orders_({&quot;fieldName&quot;: &quot;O_C_UNAME&quot;},{&quot;fieldName&quot;: &quot;O_DATE_Time&quot;})&gt;,ArrayBuffer(ParameterValue(0)),FixedLimit(1),false)))))))</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73908">indexScanOrdersIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanOrdersIdx&quot;)" class="string">&quot;indexScanOrdersIdx&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73910">indexScanOrdersIdxHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73908" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanOrdersIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73996" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73912">indexLookupJoinOrders</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinOrders&quot;)" class="string">&quot;indexLookupJoinOrders&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73914">indexLookupJoinOrdersHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73912" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinOrders</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74081" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73916">indexLookupJoinAddresses</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAddresses&quot;)" class="string">&quot;indexLookupJoinAddresses&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73918">indexLookupJoinAddressesHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73916" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAddresses</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74166" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73920">indexLookupJoinCountries</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinCountries&quot;)" class="string">&quot;indexLookupJoinCountries&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73922">indexLookupJoinCountriesHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73920" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinCountries</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74251" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="comment">//val predictedHist = indexLookupJoinCountriesHist convolveWith indexLookupJoinAddressesHist convolveWith indexLookupJoinCountriesHist convolveWith indexLookupJoinAddressesHist convolveWith indexLookupJoinOrdersHist convolveWith indexScanOrdersIdxHist</span>
    <span class="comment">// results in overflow.  instead, try per-interval prediction</span>
            
    <span class="keyword">import</span> <a href="#69507" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._

    <span class="comment">/*
    def predictHistBySampling = {
      val numSamples = orderDisplayGetLastOrderHist.totalRequests
      
      val predictedHist = Histogram(1,1000)
      
      (1 to numSamples).foreach(i =&gt; {
        val latencySample = 0
        latencySample += 
      })
    }
    */</span>

    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="73925">predictHist</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="74298">res1</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73910" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanOrdersIdxHist</a>, <a href="#73914" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinOrdersHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="74299">res2</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74298" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#73918" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="74300">res3</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74299" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#73922" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="74301">res4</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74300" title="scala.collection.mutable.ArrayBuffer[BigInt]">res3</a>, <a href="#73918" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="74302">res5</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74301" title="scala.collection.mutable.ArrayBuffer[BigInt]">res4</a>, <a href="#73922" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <a href="#74302" title="scala.collection.mutable.ArrayBuffer[BigInt]">res5</a>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="73926">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="74303">i</a>: <span title="Int">Int</span>, <a title="Double" id="74304">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74306">indexScanOrdersIdxHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73908" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanOrdersIdx</a>, <a href="#74303" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74355" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74307">indexLookupJoinOrdersHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73912" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinOrders</a>, <a href="#74303" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74439" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74308">indexLookupJoinAddressesHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73916" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAddresses</a>, <a href="#74303" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74523" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74309">indexLookupJoinCountriesHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73920" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinCountries</a>, <a href="#74303" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74607" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="74310">res1</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74306" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanOrdersIdxHist</a>, <a href="#74307" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinOrdersHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="74311">res2</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74310" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#74308" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="74312">res3</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74311" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#74309" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="74313">res4</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74312" title="scala.collection.mutable.ArrayBuffer[BigInt]">res3</a>, <a href="#74308" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="74314">predictedHist</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74313" title="scala.collection.mutable.ArrayBuffer[BigInt]">res4</a>, <a href="#74309" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>

      <a href="#69536" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#74314" title="scala.collection.mutable.ArrayBuffer[BigInt]">predictedHist</a>, <a href="#74304" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
        
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="73927">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="74653">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 50</span>

      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74654">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74655">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71700" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="74786">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74787">actualHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73904" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetLastOrder</a>, <a href="#74786" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="74788">actualQuantile</a> = <a href="#74787" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#74653" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#74654" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#74788" title="=&gt; Long">actualQuantile</a>

        <span class="keyword">val</span> <a title="Int" id="74789">predictedQuantile</a> = <a href="#73926" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#74786" title="Int">i</a>, <a href="#74653" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#74655" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#74789" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#74786" title="Int">i</a>, <a href="#74788" title="Int">actualQuantile</a>, <a href="#74789" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#74654" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#74655" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="73928">actual99th</a> = <a href="#73906" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">orderDisplayGetLastOrderHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="73930">predicted99th</a> = <a href="#69536" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#73925" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelOrderDisplayGetOrderLines" id="69521">ModelOrderDisplayGetOrderLines</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#69509" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#69507" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74835">orderDisplayGetOrderLines</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;orderDisplayGetOrderLines&quot;)" class="string">&quot;orderDisplayGetOrderLines&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(3)" class="int">3</span><span class="delimiter">)</span>  <span class="comment">// might want to fix this later so requested cardinality = result cardinality</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74837">orderDisplayGetOrderLinesHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74835" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetOrderLines</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.orderDisplayGetOrderLines.physicalPlan</span>
    <span class="comment">//res13: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: items&gt;,ArrayBuffer(AttributeValue(0,2)),LocalStopAfter(ParameterLimit(1,100),</span>
    <span class="comment">//                                              IndexScan(&lt;Namespace: orderLines&gt;,ArrayBuffer(ParameterValue(0)),ParameterLimit(1,100),true)))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74839">indexScanOrderLines</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanOrderLines&quot;)" class="string">&quot;indexScanOrderLines&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(3)" class="int">3</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74841">indexScanOrderLinesHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74839" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanOrderLines</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74918" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74843">indexLookupJoinItems</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinItems&quot;)" class="string">&quot;indexLookupJoinItems&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(3)" class="int">3</span><span class="delimiter">)</span>, <span title="Int(3)" class="int">3</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74845">indexLookupJoinItemsHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74843" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinItems</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75003" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="74847">predictHist</a> = <span class="delimiter">{</span>
      <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74841" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanOrderLinesHist</a>, <a href="#74845" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinItemsHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="74848">actual99th</a> = <a href="#74837" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">orderDisplayGetOrderLinesHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="74850">predicted99th</a> = <a href="#69536" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#74847" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="74852">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="75050">i</a>: <span title="Int">Int</span>, <a title="Double" id="75051">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75053">indexScanOrderLinesHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74839" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanOrderLines</a>, <a href="#75050" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75096" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75054">indexLookupJoinItemsHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74843" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinItems</a>, <a href="#75050" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75180" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="75055">predictedHist</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#75053" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanOrderLinesHist</a>, <a href="#75054" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinItemsHist</a><span class="delimiter">)</span>
      
      <a href="#69536" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#75055" title="scala.collection.mutable.ArrayBuffer[BigInt]">predictedHist</a>, <a href="#75051" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="74853">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="75226">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>
      
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75227">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75228">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>
      
      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71700" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="75359">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75360">actualHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74835" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetOrderLines</a>, <a href="#75359" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="75361">actualQuantile</a> = <a href="#75360" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#75226" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#75227" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#75361" title="=&gt; Long">actualQuantile</a>
        
        <span class="keyword">val</span> <a title="Int" id="75362">predictedQuantile</a> = <a href="#74852" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#75359" title="Int">i</a>, <a href="#75226" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#75228" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#75362" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#75359" title="Int">i</a>, <a href="#75361" title="Int">actualQuantile</a>, <a href="#75362" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      
      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#75227" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#75228" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelProductDetailWI" id="69523">ModelProductDetailWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#69509" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#69507" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75408">productDetailWI</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;productDetailWI&quot;)" class="string">&quot;productDetailWI&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75410">productDetailWIHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75408" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">productDetailWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.productDetailWI.physicalPlan</span>
    <span class="comment">//res17: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: authors&gt;,ArrayBuffer(AttributeValue(0,2)),</span>
    <span class="comment">//                                              IndexLookup(&lt;Namespace: items&gt;,ArrayBuffer(ParameterValue(0))))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75412">indexLookupItems</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupItems&quot;)" class="string">&quot;indexLookupItems&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75414">indexLookupItemsHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75412" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupItems</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75491" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75416">indexLookupJoinAuthors</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAuthors&quot;)" class="string">&quot;indexLookupJoinAuthors&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75418">indexLookupJoinAuthorsHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75416" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75576" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="75420">predictHist</a> = <span class="delimiter">{</span>
      <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#75414" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupItemsHist</a>, <a href="#75418" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="75421">actual99th</a> = <a href="#75410" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">productDetailWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="75423">predicted99th</a> = <a href="#69536" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#75420" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="75425">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="75623">i</a>: <span title="Int">Int</span>, <a title="Double" id="75624">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75626">indexLookupItemsHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#75412" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupItems</a>, <a href="#75623" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75668" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75627">indexLookupJoinAuthorsHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#75416" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a>, <a href="#75623" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75752" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="#69536" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#75626" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupItemsHist</a>, <a href="#75627" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>, <a href="#75624" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
        
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="75426">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="75798">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>

      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75799">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75800">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71700" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="75931">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75932">actualHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#75408" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">productDetailWI</a>, <a href="#75931" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="75933">actualQuantile</a> = <a href="#75932" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#75798" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#75799" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#75933" title="=&gt; Long">actualQuantile</a>

        <span class="keyword">val</span> <a title="Int" id="75934">predictedQuantile</a> = <a href="#75425" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#75931" title="Int">i</a>, <a href="#75798" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#75800" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#75934" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#75931" title="Int">i</a>, <a href="#75933" title="Int">actualQuantile</a>, <a href="#75934" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#75799" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#75800" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>

  <span class="comment">// for some reason, I don't have data on this</span>
  <span class="comment">// will have to figure this out later</span>
  <span class="comment">// probably b/c in TpcwClient, there was no query name passed to toPiql</span>
  <span class="comment">// right now, only have a query description where shopping cart is empty b/c shopping cart is never getting populated</span>
  <span class="comment">// for now, postpone this</span>
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelRetrieveShoppingCart" id="69525">ModelRetrieveShoppingCart</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#69509" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#69507" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75980">retrieveShoppingCart</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;unnamed&quot;)" class="string">&quot;unnamed&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="comment">// &quot;unnamed&quot; b/c of bug in TpcwClient; 0 b/c not getting populated</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75982">retrieveShoppingCartHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75980" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">retrieveShoppingCart</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.retrieveShoppingCart.physicalPlan</span>
    <span class="comment">//res33: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: items&gt;,ArrayBuffer(AttributeValue(0,1)),</span>
    <span class="comment">//                                              LocalStopAfter(FixedLimit(1000),</span>
    <span class="comment">//                                              IndexScan(&lt;Namespace: shoppingCartItems&gt;,ArrayBuffer(ParameterValue(0)),FixedLimit(1000),true)))</span>
    
    
  <span class="delimiter">}</span>

  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelSearchByAuthorWI" id="69527">ModelSearchByAuthorWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#69509" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#69507" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="76010">searchByAuthorWI</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;searchByAuthorWI&quot;)" class="string">&quot;searchByAuthorWI&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(10)" class="int">10</span><span class="delimiter">)</span> <span class="comment">// only one where requested cardinality = result cardinality</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76012">searchByAuthorWIHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#76010" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">searchByAuthorWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.searchByAuthorWI.physicalPlan</span>
    <span class="comment">//res22: edu.berkeley.cs.scads.piql.QueryPlan = LocalStopAfter(ParameterLimit(1,50),</span>
    <span class="comment">//                                              IndexMergeJoin(&lt;Namespace: items_({&quot;fieldName&quot;: &quot;I_A_ID&quot;},{&quot;fieldName&quot;: &quot;I_TITLE&quot;})&gt;,List(AttributeValue(0,1)),List(AttributeValue(2,1)),ParameterLimit(1,50),true,</span>
    <span class="comment">//                                              IndexLookupJoin(&lt;Namespace: authors&gt;,List(AttributeValue(0,1)),LocalStopAfter(FixedLimit(50),</span>
    <span class="comment">//                                              IndexScan(&lt;Namespace: authors_({&quot;fieldNames&quot;: [&quot;A_FNAME&quot;, &quot;A_LNAME&quot;]})&gt;,List(ParameterValue(0)),FixedLimit(50),true)))))</span>
    
    <span class="comment">// I don't think we have the right benchmarks collected here.</span>
    <span class="comment">// I think we need the following:</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="76014">indexScanAuthorsIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanAuthorsIdx&quot;)" class="string">&quot;indexScanAuthorsIdx&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>  <span class="comment">// i have this benchmark already</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76016">indexScanAuthorsIdxHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#76014" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanAuthorsIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76097" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="76018">indexLookupJoinAuthors</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAuthors&quot;)" class="string">&quot;indexLookupJoinAuthors&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="comment">// i NEED this</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76020">indexLookupJoinAuthorsHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#76018" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76182" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="76022">indexMergeJoinItemsIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexMergeJoinItemsIdx&quot;)" class="string">&quot;indexMergeJoinItemsIdx&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>, <span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(10)" class="int">10</span><span class="delimiter">)</span> <span class="comment">// i NEED this</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76024">indexMergeJoinItemsIdxHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#76022" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexMergeJoinItemsIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76267" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="76026">predictHist</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="76314">res1</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#76016" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanAuthorsIdxHist</a>, <a href="#76020" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="76315">res2</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#76314" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#76024" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexMergeJoinItemsIdxHist</a><span class="delimiter">)</span>
      <a href="#76315" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="76027">actual99th</a> = <a href="#76012" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">searchByAuthorWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="76029">predicted99th</a> = <a href="#69536" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#76026" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="76031">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="76316">i</a>: <span title="Int">Int</span>, <a title="Double" id="76317">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76319">indexScanAuthorsIdxHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#76014" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanAuthorsIdx</a>, <a href="#76316" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76364" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76320">indexLookupJoinAuthorsHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#76018" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a>, <a href="#76316" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76448" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76321">indexMergeJoinItemsIdxHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#76022" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexMergeJoinItemsIdx</a>, <a href="#76316" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76532" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="76322">res1</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#76319" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanAuthorsIdxHist</a>, <a href="#76320" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="76323">res2</a> = <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#76322" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#76321" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexMergeJoinItemsIdxHist</a><span class="delimiter">)</span>
      <a href="#76323" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>

      <a href="#69536" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#76323" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#76317" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

     <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="76032">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="76613">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
       <span class="comment">//val numIntervals = 30</span>

       <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76614">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
       <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76615">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

       <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

       <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71700" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="76746">i</a> =&gt; <span class="delimiter">{</span>
         <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76747">actualHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#76010" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">searchByAuthorWI</a>, <a href="#76746" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
         <span class="keyword">val</span> <a title="Int" id="76748">actualQuantile</a> = <a href="#76747" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#76613" title="Double">quantile</a><span class="delimiter">)</span>
         <a href="#76614" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#76748" title="=&gt; Long">actualQuantile</a>

         <span class="keyword">val</span> <a title="Int" id="76749">predictedQuantile</a> = <a href="#76031" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#76746" title="Int">i</a>, <a href="#76613" title="Double">quantile</a><span class="delimiter">)</span>
         <a href="#76615" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#76749" title="=&gt; Long">predictedQuantile</a>

         <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#76746" title="Int">i</a>, <a href="#76748" title="Int">actualQuantile</a>, <a href="#76749" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
       <span class="delimiter">}</span><span class="delimiter">)</span>

       <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#76614" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#76615" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
     <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelSearchByTitleWI" id="69529">ModelSearchByTitleWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#69509" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#69507" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="76795">searchByTitleWI</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;searchByTitleWI&quot;)" class="string">&quot;searchByTitleWI&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(7)" class="int">7</span><span class="comment">/*9*/</span><span class="delimiter">)</span>  <span class="comment">// want to make requested, result cardinalities match</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76797">searchByTitleWIHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#76795" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">searchByTitleWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.searchByTitleWI.physicalPlan</span>
    <span class="comment">//res26: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: authors&gt;,List(AttributeValue(0,2)),LocalStopAfter(ParameterLimit(1,50),</span>
    <span class="comment">//                                              IndexScan(&lt;Namespace: items_({&quot;fieldNames&quot;: [&quot;I_TITLE&quot;]},{&quot;fieldName&quot;: &quot;I_TITLE&quot;},{&quot;fieldName&quot;: &quot;I_A_ID&quot;})&gt;,List(ParameterValue(0)),ParameterLimit(1,50),true)))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="76799">indexScanItemsIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanItemsIdx&quot;)" class="string">&quot;indexScanItemsIdx&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(9)" class="int">9</span><span class="delimiter">)</span>, <span title="Int(9)" class="int">9</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76801">indexScanItemsIdxHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#76799" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanItemsIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76878" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="76803">indexLookupJoinAuthors</a> = <a href="../collection/QueryRunnerTask.scala.html#38219" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAuthors&quot;)" class="string">&quot;indexLookupJoinAuthors&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(9)" class="int">9</span><span class="delimiter">)</span>, <span title="Int(9)" class="int">9</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76805">indexLookupJoinAuthorsHist</a> = <a href="#71703" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#76803" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76959" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="76807">predictHist</a> = <span class="delimiter">{</span>
      <a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#76801" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanItemsIdxHist</a>, <a href="#76805" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="76808">actual99th</a> = <a href="#76797" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">searchByTitleWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="76810">predicted99th</a> = <a href="#69536" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#76807" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="76812">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="77002">i</a>: <span title="Int">Int</span>, <a title="Double" id="77003">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="77005">indexScanItemsIdxHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#76799" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanItemsIdx</a>, <a href="#77002" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#77047" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="77006">indexLookupJoinAuthorsHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#76803" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a>, <a href="#77002" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#77127" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

       <a href="#69536" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#69533" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#77005" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanItemsIdxHist</a>, <a href="#77006" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>, <a href="#77003" title="Double">desiredQuantile</a><span class="delimiter">)</span>
     <span class="delimiter">}</span>

     <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="76813">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="77169">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
       <span class="comment">//val numIntervals = 30</span>

       <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="77170">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
       <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="77171">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

       <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

       <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71700" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="77302">i</a> =&gt; <span class="delimiter">{</span>
         <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="77303">actualHist</a> = <a href="#71705" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#76795" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">searchByTitleWI</a>, <a href="#77302" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
         <span class="keyword">val</span> <a title="Int" id="77304">actualQuantile</a> = <a href="#77303" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#77169" title="Double">quantile</a><span class="delimiter">)</span>
         <a href="#77170" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#77304" title="=&gt; Long">actualQuantile</a>

         <span class="keyword">val</span> <a title="Int" id="77305">predictedQuantile</a> = <a href="#76812" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#77302" title="Int">i</a>, <a href="#77169" title="Double">quantile</a><span class="delimiter">)</span>
         <a href="#77171" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#77305" title="=&gt; Long">predictedQuantile</a>

         <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#77302" title="Int">i</a>, <a href="#77304" title="Int">actualQuantile</a>, <a href="#77305" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
       <span class="delimiter">}</span><span class="delimiter">)</span>

       <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#77170" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#77171" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
     <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
<span class="delimiter">}</span>
        </pre>
    </body>
</html>