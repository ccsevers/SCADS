<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>experiments/TpcwModeling.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs
<span class="keyword">package</span> scads
<span class="keyword">package</span> piql
<span class="keyword">package</span> modeling

<span class="keyword">import</span> comm._
<span class="keyword">import</span> storage._
<span class="keyword">import</span> perf._
<span class="keyword">import</span> deploylib.ec2._
<span class="keyword">import</span> deploylib.mesos._
<span class="keyword">import</span> piql.scadr._
<span class="keyword">import</span> perf.scadr._
<span class="keyword">import</span> avro.marker._
<span class="keyword">import</span> avro.runtime._
<span class="keyword">import</span> <a href="ExperimentUtil.scala.html#9691" title="object edu.berkeley.cs.scads.piql.modeling.ExperimentUtil">ExperimentUtil</a>._
<span class="keyword">import</span> scala.collection.mutable.ArrayBuffer

<span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling" id="9762">TpcwModeling</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util" id="69206">Util</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(summary: (edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram))Unit" id="69231">printPerIterationPredictionSummary</a><span class="delimiter">(</span><a title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="70806">summary</a>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="70809">actualHist</a> = <a href="#70806" title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)">summary</a>.<span title="=&gt; edu.berkeley.cs.scads.perf.Histogram">_1</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="70810">predictedHist</a> = <a href="#70806" title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)">summary</a>.<span title="=&gt; edu.berkeley.cs.scads.perf.Histogram">_2</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Any*)List[Any]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Actual:&quot;)" class="string">&quot;Actual:&quot;</span>, <span title="java.lang.String(&quot;average=&quot;)" class="string">&quot;average=&quot;</span>, <a href="#70809" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="=&gt; Double">average</span>, <span title="java.lang.String(&quot;median=&quot;)" class="string">&quot;median=&quot;</span>, <a href="#70809" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="=&gt; Int">median</span>, <span title="java.lang.String(&quot;stddev=&quot;)" class="string">&quot;stddev=&quot;</span>, <a href="#70809" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="=&gt; Double">stddev</span>, <span title="java.lang.String(&quot;max=&quot;)" class="string">&quot;max=&quot;</span>, <a href="#70809" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Any*)List[Any]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Predicted:&quot;)" class="string">&quot;Predicted:&quot;</span>, <span title="java.lang.String(&quot;average=&quot;)" class="string">&quot;average=&quot;</span>, <a href="#70810" title="edu.berkeley.cs.scads.perf.Histogram">predictedHist</a>.<span title="=&gt; Double">average</span>, <span title="java.lang.String(&quot;median=&quot;)" class="string">&quot;median=&quot;</span>, <a href="#70810" title="edu.berkeley.cs.scads.perf.Histogram">predictedHist</a>.<span title="=&gt; Int">median</span>, <span title="java.lang.String(&quot;stddev=&quot;)" class="string">&quot;stddev=&quot;</span>, <a href="#70810" title="edu.berkeley.cs.scads.perf.Histogram">predictedHist</a>.<span title="=&gt; Double">stddev</span>, <span title="java.lang.String(&quot;max=&quot;)" class="string">&quot;max=&quot;</span>, <a href="#70810" title="edu.berkeley.cs.scads.perf.Histogram">predictedHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  	<span class="keyword">def</span> <a title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]" id="69232">convolve</a><span class="delimiter">(</span><a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="69869">hist1</a>: <span title="scala.collection.mutable.ArrayBuffer[BigInt]">ArrayBuffer</span><span class="delimiter">[</span>BigInt<span class="delimiter">]</span>, <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="69870">hist2</a>: <span title="scala.collection.mutable.ArrayBuffer[BigInt]">ArrayBuffer</span><span class="delimiter">[</span>BigInt<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scala.collection.mutable.ArrayBuffer[BigInt]">ArrayBuffer</span><span class="delimiter">[</span>BigInt<span class="delimiter">]</span> = <span class="delimiter">{</span>
  	  <span class="keyword">var</span> <a title="Int" id="70844">defaultBucketCount</a> = <span title="Int(1000)" class="int">1000</span>

  	  <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="70845">result</a> = <span title="object scala.collection.mutable.ArrayBuffer">ArrayBuffer</span>.<span title="(n: Int)(elem: =&gt; scala.math.BigInt)scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">fill</span><span class="delimiter">(</span><a href="#70844" title="Int">defaultBucketCount</a><span class="delimiter">)</span><span class="delimiter">(</span><span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>

  	  <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#70844" title="Int">defaultBucketCount</a><span title="(x: Int)Int">-</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="71026">i</a> =&gt; <span class="delimiter">{</span>
  	    <span class="keyword">var</span> <a title="scala.math.BigInt" id="71027">integralOfOverlap</a> = <span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>

        <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71026" title="Int">i</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="71148">j</a> =&gt; <span class="delimiter">{</span>
          <a href="#71027" title="scala.math.BigInt">integralOfOverlap</a> <span title="(that: scala.math.BigInt)scala.math.BigInt">+=</span> <a href="#69869" title="(idx: Int)BigInt">hist1</a><span class="delimiter">(</span><a href="#71026" title="Int">i</a><span title="(x: Int)Int">-</span><a href="#71148" title="Int">j</a><span class="delimiter">)</span> <span title="(that: scala.math.BigInt)scala.math.BigInt">*</span> <a href="#69870" title="(idx: Int)BigInt">hist2</a><span class="delimiter">(</span><a href="#71148" title="Int">j</a><span class="delimiter">)</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>

        <a href="#70845" title="(idx: Int, elem: scala.math.BigInt)Unit">result</a><span class="delimiter">(</span><a href="#71026" title="Int">i</a><span class="delimiter">)</span> = <a href="#71027" title="scala.math.BigInt">integralOfOverlap</a>
  	  <span class="delimiter">}</span><span class="delimiter">)</span>

  	  <a href="#70845" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">result</a>
  	<span class="delimiter">}</span>
  	
  	<span class="comment">// default bucket size is 1</span>
  	<span class="keyword">val</span> <a title="Int" id="69233">bucketSize</a> = <span title="Int(1)" class="int">1</span>
  	<span class="keyword">def</span> <a title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int" id="69235">quantile</a><span class="delimiter">(</span><a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="69862">hist</a>: <span title="scala.collection.mutable.ArrayBuffer[BigInt]">ArrayBuffer</span><span class="delimiter">[</span>BigInt<span class="delimiter">]</span>, <a title="Double" id="69863">quantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
  	  <span class="keyword">val</span> <a title="Int" id="71228">quantileAsInt</a> = <span class="delimiter">(</span><a href="#69863" title="Double">quantile</a> <span title="(x: Int)Double">*</span> <span title="Int(100)" class="int">100</span><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span>  <span class="comment">// convert to percentage; still receive input as percentage to maintain consistency with Histogram's version</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71229">cumulativeSum</a> = <a href="#69862" title="scala.collection.mutable.ArrayBuffer[BigInt]">hist</a>.<span title="(z: scala.math.BigInt)(op: (scala.math.BigInt, BigInt) =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[BigInt],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">scanLeft</span><span class="delimiter">(</span><span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><a href="#71263" title="scala.math.BigInt">_</a> <span title="(that: scala.math.BigInt)scala.math.BigInt">+</span> <a href="#71264" title="BigInt">_</a><span class="delimiter">)</span>.<span title="(n: Int)scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">drop</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span title="Int" class="keyword">if</span><span class="delimiter">(</span><a href="#69862" title="scala.collection.mutable.ArrayBuffer[BigInt]">hist</a>.<span title="(implicit num: Numeric[BigInt])BigInt">sum</span> <span title="(that: scala.math.BigInt)Boolean">&gt;</span> <span title="implicit scala.math.BigInt.int2bigInt : (i: Int)scala.math.BigInt" class="int">0</span><span class="delimiter">)</span>
        <a href="#71229" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">cumulativeSum</a>.<span title="(p: scala.math.BigInt =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#71343" title="scala.math.BigInt">_</a> <span title="(that: scala.math.BigInt)Boolean">&gt;=</span> <a href="#69862" title="scala.collection.mutable.ArrayBuffer[BigInt]">hist</a>.<span title="(implicit num: Numeric[BigInt])BigInt">sum</span> <span title="(that: scala.math.BigInt)scala.math.BigInt">*</span> <span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71228" title="Int">quantileAsInt</a><span class="delimiter">)</span><span title="(that: scala.math.BigInt)scala.math.BigInt">/</span><span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><span title="Int(100)" class="int">100</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x: Int)Int">*</span> <a href="#69233" title="=&gt; Int">bucketSize</a>
      <span class="keyword">else</span>
        <span title="Int(0)" class="int">0</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(actual: Double, predicted: Double)Unit" id="69236">printActualAndPredicted</a><span class="delimiter">(</span><a title="Double" id="71369">actual</a>:<span title="Double">Double</span>, <a title="Double" id="71370">predicted</a>:<span title="Double">Double</span><span class="delimiter">)</span> = <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Any*)List[Any]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;actual=&quot;)" class="string">&quot;actual=&quot;</span>, <a href="#71369" title="Double">actual</a>, <span title="java.lang.String(&quot;predicted=&quot;)" class="string">&quot;predicted=&quot;</span>, <a href="#71370" title="Double">predicted</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  
    <span class="comment">/*
    def average(hist: ArrayBuffer[BigInt]) = {
      val n = hist.sum
      hist.zipWithIndex.foldLeft(BigInt(0)) { case (acc, (num, idx)) =&gt; acc + num * idx * bucketSize / n }
    }

    /**
     * Sample standard deviation based off of sqrt(1/(N-1)*sum((Xi-mean(X))^2))
     */
    def stddev(hist: ArrayBuffer[BigInt]) = {
      val n = hist.sum
      val xbar = average(hist)
      import scala.math._
      val a = hist.zipWithIndex.foldLeft(BigInt(0)) { case (acc, (num, idx)) =&gt; acc + num * (BigInt(idx) * bucketSize - xbar) * (BigInt(idx) * bucketSize - xbar) }
      sqrt(BigInt(1) / (n - BigInt(1)) * a.toDouble)  // causes compile error
    }
    */</span>
  
  <span class="delimiter">}</span>

  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData" id="69208">TpcwData</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="comment">//val clusterAddress = &quot;zk://zoo.knowsql.org/home/kcurtis/scads/experimentCluster0000000008&quot;</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-75-101-230-218.compute-1.amazonaws.com:2181,ec2-50-19-23-28.compute-1.amazonaws.com:2181,ec2-67-202-16-139.compute-1.amazonaws.com:2181/scads/experimentCluster0000000000&quot;</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-50-16-25-212.compute-1.amazonaws.com:2181,ec2-67-202-10-38.compute-1.amazonaws.com:2181,ec2-174-129-128-67.compute-1.amazonaws.com:2181/scads/experimentCluster0000000000&quot;</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-50-19-140-43.compute-1.amazonaws.com:2181,ec2-72-44-35-240.compute-1.amazonaws.com:2181,ec2-50-17-68-210.compute-1.amazonaws.com:2181/scads/experimentCluster0000000000&quot;</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-174-129-157-147.compute-1.amazonaws.com:2181,ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181/scads/experimentCluster0000000000&quot; // 5.26.11, afternoon</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-174-129-157-147.compute-1.amazonaws.com:2181,ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181/scads/experimentCluster0000000007&quot; // 5.27.11, 3p (blocking)</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-174-129-157-147.compute-1.amazonaws.com:2181,ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181/scads/experimentCluster0000000027&quot;</span>
    <span class="keyword">val</span> <a title="java.lang.String" id="71395">clusterAddress</a> = <span title="java.lang.String(&quot;zk://ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181,ec2-174-129-157-147.compute-1.amazonaws.com:2181/scads/experimentCluster0000000065&quot;)" class="string">&quot;zk://ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181,ec2-174-129-157-147.compute-1.amazonaws.com:2181/scads/experimentCluster0000000065&quot;</span>

    <span class="keyword">def</span> <a title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]" id="71397">experimentResults</a> = <a href="ExperimentUtil.scala.html#50204" title="=&gt; org.apache.avro.file.DataFileReader[edu.berkeley.cs.scads.piql.modeling.Result] with Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">allResults</a>.<span title="(p: edu.berkeley.cs.scads.piql.modeling.Result =&gt; Boolean)Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">filter</span><span class="delimiter">(</span><a href="#71414" title="edu.berkeley.cs.scads.piql.modeling.Result">_</a>.<a href="../collection/QueryRunnerTask.scala.html#37925" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryRunnerTask">clientConfig</a>.<a href="../collection/QueryRunnerTask.scala.html#38010" title="=&gt; String">clusterAddress</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#71395" title="=&gt; java.lang.String">clusterAddress</a><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="Int" id="71398">numIntervals</a> = <span title="Int(35)" class="int">35</span>
    <span class="keyword">def</span> <a title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]" id="71400">goodExperimentResults</a> = <a href="#71397" title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">experimentResults</a>.<span title="(p: edu.berkeley.cs.scads.piql.modeling.Result =&gt; Boolean)Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">filter</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.modeling.Result" id="71423">res</a> =&gt; <a href="#71423" title="edu.berkeley.cs.scads.piql.modeling.Result">res</a>.<a href="../collection/QueryRunnerTask.scala.html#37922" title="=&gt; Int">iteration</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(1)" class="int">1</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#71423" title="edu.berkeley.cs.scads.piql.modeling.Result">res</a>.<a href="../collection/QueryRunnerTask.scala.html#37922" title="=&gt; Int">iteration</a> <span title="(x: Int)Boolean">&lt;=</span> <a href="#71398" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>
        
    <span class="keyword">val</span> <a title="scala.collection.immutable.Map[edu.berkeley.cs.scads.piql.modeling.QueryDescription,edu.berkeley.cs.scads.perf.Histogram]" id="71401">histogramsTpcw</a> = <a href="ExperimentUtil.scala.html#50217" title="(results: Seq[edu.berkeley.cs.scads.piql.modeling.Result])scala.collection.immutable.Map[edu.berkeley.cs.scads.piql.modeling.QueryDescription,edu.berkeley.cs.scads.perf.Histogram]">queryTypeHistogram</a><span class="delimiter">(</span><a href="#71400" title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">goodExperimentResults</a>.<span title="=&gt; Seq[edu.berkeley.cs.scads.piql.modeling.Result]">toSeq</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="scala.collection.immutable.Map[(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int),edu.berkeley.cs.scads.perf.Histogram]" id="71403">perIterationHistograms</a> = <a href="ExperimentUtil.scala.html#50220" title="(results: Seq[edu.berkeley.cs.scads.piql.modeling.Result])scala.collection.immutable.Map[(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int),edu.berkeley.cs.scads.perf.Histogram]">queryTypePerIterationHistograms</a><span class="delimiter">(</span><a href="#71400" title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">goodExperimentResults</a>.<span title="=&gt; Seq[edu.berkeley.cs.scads.piql.modeling.Result]">toSeq</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelBuyRequestExistingCustomerWI" id="69210">ModelBuyRequestExistingCustomerWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#69208" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#69206" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71437">buyRequestExistingCustomerWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;buyRequestExistingCustomerWI&quot;)" class="string">&quot;buyRequestExistingCustomerWI&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="71439">buyRequestExistingCustomerWIHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71437" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">buyRequestExistingCustomerWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.buyRequestExistingCustomerWI.physicalPlan</span>
    <span class="comment">//res4: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: countries&gt;,ArrayBuffer(AttributeValue(1,6)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: addresses&gt;,ArrayBuffer(AttributeValue(0,4)),</span>
    <span class="comment">//                                             IndexLookup(&lt;Namespace: customers&gt;,ArrayBuffer(ParameterValue(0)))))</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71441">indexLookupCustomers</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupCustomers&quot;)" class="string">&quot;indexLookupCustomers&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71443">indexLookupCustomersHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71441" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71524" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71445">indexLookupJoinAddresses</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAddresses&quot;)" class="string">&quot;indexLookupJoinAddresses&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71447">indexLookupJoinAddressesHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71445" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAddresses</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71612" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71449">indexLookupJoinCountries</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinCountries&quot;)" class="string">&quot;indexLookupJoinCountries&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71451">indexLookupJoinCountriesHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71449" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinCountries</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71697" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="71453">predictHist</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="71744">res1</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#71443" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupCustomersHist</a>, <a href="#71447" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="71745">res2</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#71744" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#71451" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <a href="#71745" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="71454">actual99th</a> = <a href="#71439" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">buyRequestExistingCustomerWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="71456">predicted99th</a> = <a href="#69235" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#71453" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="71458">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="71746">i</a>: <span title="Int">Int</span>, <a title="Double" id="71747">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71749">indexLookupCustomersHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71441" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a>, <a href="#71746" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71794" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71750">indexLookupJoinAddressesHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71445" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAddresses</a>, <a href="#71746" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71878" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71751">indexLookupJoinCountriesHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71449" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinCountries</a>, <a href="#71746" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71962" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="71752">res1</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#71749" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupCustomersHist</a>, <a href="#71750" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="71753">res2</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#71752" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#71751" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <a href="#71753" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>

      <a href="#69235" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#71753" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#71747" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="71459">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="72008">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>
      
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72009">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72010">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>
      
      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71398" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="72141">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72142">actualHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71437" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">buyRequestExistingCustomerWI</a>, <a href="#72141" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="72143">actualQuantile</a> = <a href="#72142" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#72008" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#72009" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#72143" title="=&gt; Long">actualQuantile</a>
        
        <span class="keyword">val</span> <a title="Int" id="72144">predictedQuantile</a> = <a href="#71458" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#72141" title="Int">i</a>, <a href="#72008" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#72010" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#72144" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#72141" title="Int">i</a>, <a href="#72143" title="Int">actualQuantile</a>, <a href="#72144" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      
      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#72009" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#72010" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelHomeWI" id="69212">ModelHomeWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#69208" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#69206" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72190">homeWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;homeWI&quot;)" class="string">&quot;homeWI&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72192">homeWIHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72190" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">homeWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.homeWI.physicalPlan</span>
    <span class="comment">//res3: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookup(&lt;Namespace: customers&gt;,ArrayBuffer(ParameterValue(0)))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72194">indexLookupCustomers</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupCustomers&quot;)" class="string">&quot;indexLookupCustomers&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72196">indexLookupCustomersHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72194" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72268" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="Int" id="72198">actual99th</a> = <a href="#72192" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">homeWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="72200">predicted99th</a> = <a href="#69235" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#72196" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupCustomersHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="72202">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="72312">i</a>: <span title="Int">Int</span>, <a title="Double" id="72313">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72315">indexLookupCustomersHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72194" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a>, <a href="#72312" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72356" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <a href="#69235" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#72315" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupCustomersHist</a>, <a href="#72313" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="72203">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="72402">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>
      
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72403">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72404">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>
      
      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71398" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="72535">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72536">actualHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72190" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">homeWI</a>, <a href="#72535" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="72537">actualQuantile</a> = <a href="#72536" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#72402" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#72403" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#72537" title="=&gt; Long">actualQuantile</a>
        
        <span class="keyword">val</span> <a title="Int" id="72538">predictedQuantile</a> = <a href="#72202" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#72535" title="Int">i</a>, <a href="#72402" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#72404" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#72538" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#72535" title="Int">i</a>, <a href="#72537" title="Int">actualQuantile</a>, <a href="#72538" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      
      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#72403" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#72404" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
  
  <span class="comment">// yikes, doesn't work...</span>
  <span class="comment">// maybe not enough samples?</span>
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelNewProductWI" id="69214">ModelNewProductWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#69208" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#69206" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72584">newProductWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;newProductWI&quot;)" class="string">&quot;newProductWI&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(50)" class="int">50</span><span class="delimiter">)</span>, <span title="Int(50)" class="int">50</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72586">newProductWIHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72584" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">newProductWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.newProductWI.physicalPlan</span>
    <span class="comment">//res6: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: authors&gt;,List(AttributeValue(1,2)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: items&gt;,List(AttributeValue(0,2)),LocalStopAfter(ParameterLimit(1,50),</span>
    <span class="comment">//                                             IndexScan(&lt;Namespace: items_({&quot;fieldNames&quot;: [&quot;I_SUBJECT&quot;]},{&quot;fieldName&quot;: &quot;I_PUB_DATE&quot;})&gt;,List(ParameterValue(0)),ParameterLimit(1,50),false))))</span>
    
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72588">indexScanItemsIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanItemsIdx&quot;)" class="string">&quot;indexScanItemsIdx&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(50)" class="int">50</span><span class="delimiter">)</span>, <span title="Int(50)" class="int">50</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72590">indexScanItemsIdxHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72588" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanItemsIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72671" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72592">indexLookupJoinItems</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinItems&quot;)" class="string">&quot;indexLookupJoinItems&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(50)" class="int">50</span><span class="delimiter">)</span>, <span title="Int(50)" class="int">50</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72594">indexLookupJoinItemsHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72592" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinItems</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72756" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72596">indexLookupJoinAuthors</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAuthors&quot;)" class="string">&quot;indexLookupJoinAuthors&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(50)" class="int">50</span><span class="delimiter">)</span>, <span title="Int(50)" class="int">50</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72598">indexLookupJoinAuthorsHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72596" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72841" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="72600">predictHist</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="72888">res1</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#72590" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanItemsIdxHist</a>, <a href="#72594" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinItemsHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="72889">res2</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#72888" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#72598" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
      <a href="#72889" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="72601">actual99th</a> = <a href="#72586" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">newProductWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="72603">predicted99th</a> = <a href="#69235" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#72600" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="72605">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="72890">i</a>: <span title="Int">Int</span>, <a title="Double" id="72891">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72893">indexScanItemsIdxHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72588" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanItemsIdx</a>, <a href="#72890" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72938" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72894">indexLookupJoinItemsHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72592" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinItems</a>, <a href="#72890" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73022" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72895">indexLookupJoinAuthorsHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72596" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a>, <a href="#72890" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73106" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="72896">res1</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#72893" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanItemsIdxHist</a>, <a href="#72894" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinItemsHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="72897">res2</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#72896" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#72895" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
      <a href="#72897" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>

      <a href="#69235" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#72897" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#72891" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="72606">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="73152">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>
      
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73153">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73154">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>
      
      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71398" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="73285">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73286">actualHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72584" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">newProductWI</a>, <a href="#73285" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="73287">actualQuantile</a> = <a href="#73286" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#73152" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#73153" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#73287" title="=&gt; Long">actualQuantile</a>
        
        <span class="keyword">val</span> <a title="Int" id="73288">predictedQuantile</a> = <a href="#72605" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#73285" title="Int">i</a>, <a href="#73152" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#73154" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#73288" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#73285" title="Int">i</a>, <a href="#73287" title="Int">actualQuantile</a>, <a href="#73288" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      
      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#73153" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#73154" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelOrderDisplayGetCustomer" id="69216">ModelOrderDisplayGetCustomer</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#69208" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#69206" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73334">orderDisplayGetCustomer</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;orderDisplayGetCustomer&quot;)" class="string">&quot;orderDisplayGetCustomer&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73336">orderDisplayGetCustomerHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73334" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetCustomer</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.orderDisplayGetCustomer.physicalPlan</span>
    <span class="comment">//res11: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookup(&lt;Namespace: customers&gt;,ArrayBuffer(ParameterValue(0)))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73338">indexLookupCustomers</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupCustomers&quot;)" class="string">&quot;indexLookupCustomers&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73340">indexLookupCustomersHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73338" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="Int" id="73342">actual99th</a> = <a href="#73336" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">orderDisplayGetCustomerHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="73344">predicted99th</a> = <a href="#73340" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">indexLookupCustomersHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="73346">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="73393">i</a>: <span title="Int">Int</span>, <a title="Double" id="73394">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73396">indexLookupCustomersHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73338" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a>, <a href="#73393" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="#73396" title="edu.berkeley.cs.scads.perf.Histogram">indexLookupCustomersHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#73394" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
        
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="73347">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="73420">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73421">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73422">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71398" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="73553">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73554">actualHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73334" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetCustomer</a>, <a href="#73553" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="73555">actualQuantile</a> = <a href="#73554" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#73420" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#73421" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#73555" title="=&gt; Long">actualQuantile</a>

        <span class="keyword">val</span> <a title="Int" id="73556">predictedQuantile</a> = <a href="#73346" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#73553" title="Int">i</a>, <a href="#73420" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#73422" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#73556" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#73553" title="Int">i</a>, <a href="#73555" title="Int">actualQuantile</a>, <a href="#73556" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#73421" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#73422" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelOrderDisplayGetLastOrder" id="69218">ModelOrderDisplayGetLastOrder</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#69208" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73601">orderDisplayGetLastOrder</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;orderDisplayGetLastOrder&quot;)" class="string">&quot;orderDisplayGetLastOrder&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>  <span class="comment">// queryName, params, resultCardinality</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73603">orderDisplayGetLastOrderHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73601" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetLastOrder</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; res3.orderDisplayGetLastOrder.physicalPlan</span>
    <span class="comment">//res4: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: countries&gt;,ArrayBuffer(AttributeValue(2,6)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: addresses&gt;,ArrayBuffer(AttributeValue(1,9)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: countries&gt;,ArrayBuffer(AttributeValue(2,6)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: addresses&gt;,ArrayBuffer(AttributeValue(1,8)),LocalStopAfter(FixedLimit(1),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: orders&gt;,ArrayBuffer(AttributeValue(0,2)),</span>
    <span class="comment">//                                             IndexScan(&lt;Namespace: orders_({&quot;fieldName&quot;: &quot;O_C_UNAME&quot;},{&quot;fieldName&quot;: &quot;O_DATE_Time&quot;})&gt;,ArrayBuffer(ParameterValue(0)),FixedLimit(1),false)))))))</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73605">indexScanOrdersIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanOrdersIdx&quot;)" class="string">&quot;indexScanOrdersIdx&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73607">indexScanOrdersIdxHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73605" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanOrdersIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73693" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73609">indexLookupJoinOrders</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinOrders&quot;)" class="string">&quot;indexLookupJoinOrders&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73611">indexLookupJoinOrdersHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73609" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinOrders</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73778" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73613">indexLookupJoinAddresses</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAddresses&quot;)" class="string">&quot;indexLookupJoinAddresses&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73615">indexLookupJoinAddressesHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73613" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAddresses</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73863" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73617">indexLookupJoinCountries</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinCountries&quot;)" class="string">&quot;indexLookupJoinCountries&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73619">indexLookupJoinCountriesHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73617" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinCountries</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73948" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="comment">//val predictedHist = indexLookupJoinCountriesHist convolveWith indexLookupJoinAddressesHist convolveWith indexLookupJoinCountriesHist convolveWith indexLookupJoinAddressesHist convolveWith indexLookupJoinOrdersHist convolveWith indexScanOrdersIdxHist</span>
    <span class="comment">// results in overflow.  instead, try per-interval prediction</span>
            
    <span class="keyword">import</span> <a href="#69206" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._

    <span class="comment">/*
    def predictHistBySampling = {
      val numSamples = orderDisplayGetLastOrderHist.totalRequests
      
      val predictedHist = Histogram(1,1000)
      
      (1 to numSamples).foreach(i =&gt; {
        val latencySample = 0
        latencySample += 
      })
    }
    */</span>

    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="73622">predictHist</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73995">res1</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73607" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanOrdersIdxHist</a>, <a href="#73611" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinOrdersHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73996">res2</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73995" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#73615" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73997">res3</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73996" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#73619" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73998">res4</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73997" title="scala.collection.mutable.ArrayBuffer[BigInt]">res3</a>, <a href="#73615" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73999">res5</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73998" title="scala.collection.mutable.ArrayBuffer[BigInt]">res4</a>, <a href="#73619" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <a href="#73999" title="scala.collection.mutable.ArrayBuffer[BigInt]">res5</a>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="73623">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="74000">i</a>: <span title="Int">Int</span>, <a title="Double" id="74001">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74003">indexScanOrdersIdxHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73605" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanOrdersIdx</a>, <a href="#74000" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74052" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74004">indexLookupJoinOrdersHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73609" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinOrders</a>, <a href="#74000" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74136" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74005">indexLookupJoinAddressesHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73613" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAddresses</a>, <a href="#74000" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74220" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74006">indexLookupJoinCountriesHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73617" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinCountries</a>, <a href="#74000" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74304" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="74007">res1</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74003" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanOrdersIdxHist</a>, <a href="#74004" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinOrdersHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="74008">res2</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74007" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#74005" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="74009">res3</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74008" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#74006" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="74010">res4</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74009" title="scala.collection.mutable.ArrayBuffer[BigInt]">res3</a>, <a href="#74005" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="74011">predictedHist</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74010" title="scala.collection.mutable.ArrayBuffer[BigInt]">res4</a>, <a href="#74006" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>

      <a href="#69235" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#74011" title="scala.collection.mutable.ArrayBuffer[BigInt]">predictedHist</a>, <a href="#74001" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
        
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="73624">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="74350">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 50</span>

      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74351">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74352">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71398" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="74483">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74484">actualHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73601" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetLastOrder</a>, <a href="#74483" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="74485">actualQuantile</a> = <a href="#74484" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#74350" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#74351" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#74485" title="=&gt; Long">actualQuantile</a>

        <span class="keyword">val</span> <a title="Int" id="74486">predictedQuantile</a> = <a href="#73623" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#74483" title="Int">i</a>, <a href="#74350" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#74352" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#74486" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#74483" title="Int">i</a>, <a href="#74485" title="Int">actualQuantile</a>, <a href="#74486" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#74351" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#74352" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="73625">actual99th</a> = <a href="#73603" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">orderDisplayGetLastOrderHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="73627">predicted99th</a> = <a href="#69235" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#73622" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelOrderDisplayGetOrderLines" id="69220">ModelOrderDisplayGetOrderLines</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#69208" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#69206" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74532">orderDisplayGetOrderLines</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;orderDisplayGetOrderLines&quot;)" class="string">&quot;orderDisplayGetOrderLines&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(3)" class="int">3</span><span class="delimiter">)</span>  <span class="comment">// might want to fix this later so requested cardinality = result cardinality</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74534">orderDisplayGetOrderLinesHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74532" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetOrderLines</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.orderDisplayGetOrderLines.physicalPlan</span>
    <span class="comment">//res13: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: items&gt;,ArrayBuffer(AttributeValue(0,2)),LocalStopAfter(ParameterLimit(1,100),</span>
    <span class="comment">//                                              IndexScan(&lt;Namespace: orderLines&gt;,ArrayBuffer(ParameterValue(0)),ParameterLimit(1,100),true)))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74536">indexScanOrderLines</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanOrderLines&quot;)" class="string">&quot;indexScanOrderLines&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(3)" class="int">3</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74538">indexScanOrderLinesHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74536" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanOrderLines</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74615" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74540">indexLookupJoinItems</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinItems&quot;)" class="string">&quot;indexLookupJoinItems&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(3)" class="int">3</span><span class="delimiter">)</span>, <span title="Int(3)" class="int">3</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74542">indexLookupJoinItemsHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74540" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinItems</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74700" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="74544">predictHist</a> = <span class="delimiter">{</span>
      <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74538" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanOrderLinesHist</a>, <a href="#74542" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinItemsHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="74545">actual99th</a> = <a href="#74534" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">orderDisplayGetOrderLinesHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="74547">predicted99th</a> = <a href="#69235" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#74544" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="74549">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="74747">i</a>: <span title="Int">Int</span>, <a title="Double" id="74748">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74750">indexScanOrderLinesHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74536" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanOrderLines</a>, <a href="#74747" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74793" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74751">indexLookupJoinItemsHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74540" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinItems</a>, <a href="#74747" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74877" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="74752">predictedHist</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74750" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanOrderLinesHist</a>, <a href="#74751" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinItemsHist</a><span class="delimiter">)</span>
      
      <a href="#69235" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#74752" title="scala.collection.mutable.ArrayBuffer[BigInt]">predictedHist</a>, <a href="#74748" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="74550">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="74923">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>
      
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74924">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74925">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>
      
      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71398" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="75056">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75057">actualHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74532" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetOrderLines</a>, <a href="#75056" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="75058">actualQuantile</a> = <a href="#75057" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#74923" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#74924" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#75058" title="=&gt; Long">actualQuantile</a>
        
        <span class="keyword">val</span> <a title="Int" id="75059">predictedQuantile</a> = <a href="#74549" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#75056" title="Int">i</a>, <a href="#74923" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#74925" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#75059" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#75056" title="Int">i</a>, <a href="#75058" title="Int">actualQuantile</a>, <a href="#75059" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      
      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#74924" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#74925" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelProductDetailWI" id="69222">ModelProductDetailWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#69208" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#69206" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75105">productDetailWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;productDetailWI&quot;)" class="string">&quot;productDetailWI&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75107">productDetailWIHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75105" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">productDetailWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.productDetailWI.physicalPlan</span>
    <span class="comment">//res17: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: authors&gt;,ArrayBuffer(AttributeValue(0,2)),</span>
    <span class="comment">//                                              IndexLookup(&lt;Namespace: items&gt;,ArrayBuffer(ParameterValue(0))))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75109">indexLookupItems</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupItems&quot;)" class="string">&quot;indexLookupItems&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75111">indexLookupItemsHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75109" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupItems</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75188" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75113">indexLookupJoinAuthors</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAuthors&quot;)" class="string">&quot;indexLookupJoinAuthors&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75115">indexLookupJoinAuthorsHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75113" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75273" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="75117">predictHist</a> = <span class="delimiter">{</span>
      <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#75111" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupItemsHist</a>, <a href="#75115" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="75118">actual99th</a> = <a href="#75107" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">productDetailWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="75120">predicted99th</a> = <a href="#69235" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#75117" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="75122">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="75320">i</a>: <span title="Int">Int</span>, <a title="Double" id="75321">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75323">indexLookupItemsHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#75109" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupItems</a>, <a href="#75320" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75365" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75324">indexLookupJoinAuthorsHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#75113" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a>, <a href="#75320" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75449" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="#69235" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#75323" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupItemsHist</a>, <a href="#75324" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>, <a href="#75321" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
        
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="75123">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="75495">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>

      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75496">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75497">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71398" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="75628">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75629">actualHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#75105" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">productDetailWI</a>, <a href="#75628" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="75630">actualQuantile</a> = <a href="#75629" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#75495" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#75496" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#75630" title="=&gt; Long">actualQuantile</a>

        <span class="keyword">val</span> <a title="Int" id="75631">predictedQuantile</a> = <a href="#75122" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#75628" title="Int">i</a>, <a href="#75495" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#75497" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#75631" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#75628" title="Int">i</a>, <a href="#75630" title="Int">actualQuantile</a>, <a href="#75631" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#75496" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#75497" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>

  <span class="comment">// for some reason, I don't have data on this</span>
  <span class="comment">// will have to figure this out later</span>
  <span class="comment">// probably b/c in TpcwClient, there was no query name passed to toPiql</span>
  <span class="comment">// right now, only have a query description where shopping cart is empty b/c shopping cart is never getting populated</span>
  <span class="comment">// for now, postpone this</span>
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelRetrieveShoppingCart" id="69224">ModelRetrieveShoppingCart</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#69208" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#69206" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75677">retrieveShoppingCart</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;unnamed&quot;)" class="string">&quot;unnamed&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="comment">// &quot;unnamed&quot; b/c of bug in TpcwClient; 0 b/c not getting populated</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75679">retrieveShoppingCartHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75677" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">retrieveShoppingCart</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.retrieveShoppingCart.physicalPlan</span>
    <span class="comment">//res33: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: items&gt;,ArrayBuffer(AttributeValue(0,1)),</span>
    <span class="comment">//                                              LocalStopAfter(FixedLimit(1000),</span>
    <span class="comment">//                                              IndexScan(&lt;Namespace: shoppingCartItems&gt;,ArrayBuffer(ParameterValue(0)),FixedLimit(1000),true)))</span>
    
    
  <span class="delimiter">}</span>

  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelSearchByAuthorWI" id="69226">ModelSearchByAuthorWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#69208" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#69206" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75707">searchByAuthorWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;searchByAuthorWI&quot;)" class="string">&quot;searchByAuthorWI&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(10)" class="int">10</span><span class="delimiter">)</span> <span class="comment">// only one where requested cardinality = result cardinality</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75709">searchByAuthorWIHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75707" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">searchByAuthorWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.searchByAuthorWI.physicalPlan</span>
    <span class="comment">//res22: edu.berkeley.cs.scads.piql.QueryPlan = LocalStopAfter(ParameterLimit(1,50),</span>
    <span class="comment">//                                              IndexMergeJoin(&lt;Namespace: items_({&quot;fieldName&quot;: &quot;I_A_ID&quot;},{&quot;fieldName&quot;: &quot;I_TITLE&quot;})&gt;,List(AttributeValue(0,1)),List(AttributeValue(2,1)),ParameterLimit(1,50),true,</span>
    <span class="comment">//                                              IndexLookupJoin(&lt;Namespace: authors&gt;,List(AttributeValue(0,1)),LocalStopAfter(FixedLimit(50),</span>
    <span class="comment">//                                              IndexScan(&lt;Namespace: authors_({&quot;fieldNames&quot;: [&quot;A_FNAME&quot;, &quot;A_LNAME&quot;]})&gt;,List(ParameterValue(0)),FixedLimit(50),true)))))</span>
    
    <span class="comment">// I don't think we have the right benchmarks collected here.</span>
    <span class="comment">// I think we need the following:</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75711">indexScanAuthorsIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanAuthorsIdx&quot;)" class="string">&quot;indexScanAuthorsIdx&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>  <span class="comment">// i have this benchmark already</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75713">indexScanAuthorsIdxHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75711" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanAuthorsIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75794" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75715">indexLookupJoinAuthors</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAuthors&quot;)" class="string">&quot;indexLookupJoinAuthors&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="comment">// i NEED this</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75717">indexLookupJoinAuthorsHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75715" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75879" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75719">indexMergeJoinItemsIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexMergeJoinItemsIdx&quot;)" class="string">&quot;indexMergeJoinItemsIdx&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>, <span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(10)" class="int">10</span><span class="delimiter">)</span> <span class="comment">// i NEED this</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75721">indexMergeJoinItemsIdxHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75719" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexMergeJoinItemsIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75964" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="75723">predictHist</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="76011">res1</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#75713" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanAuthorsIdxHist</a>, <a href="#75717" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="76012">res2</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#76011" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#75721" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexMergeJoinItemsIdxHist</a><span class="delimiter">)</span>
      <a href="#76012" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="75724">actual99th</a> = <a href="#75709" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">searchByAuthorWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="75726">predicted99th</a> = <a href="#69235" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#75723" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="75728">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="76013">i</a>: <span title="Int">Int</span>, <a title="Double" id="76014">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76016">indexScanAuthorsIdxHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#75711" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanAuthorsIdx</a>, <a href="#76013" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76061" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76017">indexLookupJoinAuthorsHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#75715" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a>, <a href="#76013" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76145" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76018">indexMergeJoinItemsIdxHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#75719" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexMergeJoinItemsIdx</a>, <a href="#76013" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76229" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="76019">res1</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#76016" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanAuthorsIdxHist</a>, <a href="#76017" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="76020">res2</a> = <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#76019" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#76018" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexMergeJoinItemsIdxHist</a><span class="delimiter">)</span>
      <a href="#76020" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>

      <a href="#69235" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#76020" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#76014" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

     <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="75729">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="76310">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
       <span class="comment">//val numIntervals = 30</span>

       <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76311">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
       <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76312">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

       <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

       <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71398" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="76443">i</a> =&gt; <span class="delimiter">{</span>
         <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76444">actualHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#75707" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">searchByAuthorWI</a>, <a href="#76443" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
         <span class="keyword">val</span> <a title="Int" id="76445">actualQuantile</a> = <a href="#76444" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#76310" title="Double">quantile</a><span class="delimiter">)</span>
         <a href="#76311" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#76445" title="=&gt; Long">actualQuantile</a>

         <span class="keyword">val</span> <a title="Int" id="76446">predictedQuantile</a> = <a href="#75728" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#76443" title="Int">i</a>, <a href="#76310" title="Double">quantile</a><span class="delimiter">)</span>
         <a href="#76312" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#76446" title="=&gt; Long">predictedQuantile</a>

         <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#76443" title="Int">i</a>, <a href="#76445" title="Int">actualQuantile</a>, <a href="#76446" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
       <span class="delimiter">}</span><span class="delimiter">)</span>

       <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#76311" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#76312" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
     <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelSearchByTitleWI" id="69228">ModelSearchByTitleWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#69208" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#69206" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="76492">searchByTitleWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;searchByTitleWI&quot;)" class="string">&quot;searchByTitleWI&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(7)" class="int">7</span><span class="comment">/*9*/</span><span class="delimiter">)</span>  <span class="comment">// want to make requested, result cardinalities match</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76494">searchByTitleWIHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#76492" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">searchByTitleWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.searchByTitleWI.physicalPlan</span>
    <span class="comment">//res26: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: authors&gt;,List(AttributeValue(0,2)),LocalStopAfter(ParameterLimit(1,50),</span>
    <span class="comment">//                                              IndexScan(&lt;Namespace: items_({&quot;fieldNames&quot;: [&quot;I_TITLE&quot;]},{&quot;fieldName&quot;: &quot;I_TITLE&quot;},{&quot;fieldName&quot;: &quot;I_A_ID&quot;})&gt;,List(ParameterValue(0)),ParameterLimit(1,50),true)))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="76496">indexScanItemsIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanItemsIdx&quot;)" class="string">&quot;indexScanItemsIdx&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(9)" class="int">9</span><span class="delimiter">)</span>, <span title="Int(9)" class="int">9</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76498">indexScanItemsIdxHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#76496" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanItemsIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76575" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="76500">indexLookupJoinAuthors</a> = <a href="../collection/QueryRunnerTask.scala.html#37849" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAuthors&quot;)" class="string">&quot;indexLookupJoinAuthors&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(9)" class="int">9</span><span class="delimiter">)</span>, <span title="Int(9)" class="int">9</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76502">indexLookupJoinAuthorsHist</a> = <a href="#71401" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#76500" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76656" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="76504">predictHist</a> = <span class="delimiter">{</span>
      <a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#76498" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanItemsIdxHist</a>, <a href="#76502" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="76505">actual99th</a> = <a href="#76494" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">searchByTitleWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="76507">predicted99th</a> = <a href="#69235" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#76504" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="76509">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="76699">i</a>: <span title="Int">Int</span>, <a title="Double" id="76700">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76702">indexScanItemsIdxHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#76496" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanItemsIdx</a>, <a href="#76699" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76744" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76703">indexLookupJoinAuthorsHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#76500" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a>, <a href="#76699" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76824" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

       <a href="#69235" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#69232" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#76702" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanItemsIdxHist</a>, <a href="#76703" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>, <a href="#76700" title="Double">desiredQuantile</a><span class="delimiter">)</span>
     <span class="delimiter">}</span>

     <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="76510">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="76866">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
       <span class="comment">//val numIntervals = 30</span>

       <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76867">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
       <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76868">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

       <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

       <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71398" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="76999">i</a> =&gt; <span class="delimiter">{</span>
         <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="77000">actualHist</a> = <a href="#71403" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#76492" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">searchByTitleWI</a>, <a href="#76999" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
         <span class="keyword">val</span> <a title="Int" id="77001">actualQuantile</a> = <a href="#77000" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#76866" title="Double">quantile</a><span class="delimiter">)</span>
         <a href="#76867" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#77001" title="=&gt; Long">actualQuantile</a>

         <span class="keyword">val</span> <a title="Int" id="77002">predictedQuantile</a> = <a href="#76509" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#76999" title="Int">i</a>, <a href="#76866" title="Double">quantile</a><span class="delimiter">)</span>
         <a href="#76868" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#77002" title="=&gt; Long">predictedQuantile</a>

         <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#76999" title="Int">i</a>, <a href="#77001" title="Int">actualQuantile</a>, <a href="#77002" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
       <span class="delimiter">}</span><span class="delimiter">)</span>

       <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#76867" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#76868" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
     <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
<span class="delimiter">}</span>
        </pre>
    </body>
</html>