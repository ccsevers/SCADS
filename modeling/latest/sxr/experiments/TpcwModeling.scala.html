<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>experiments/TpcwModeling.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs
<span class="keyword">package</span> scads
<span class="keyword">package</span> piql
<span class="keyword">package</span> modeling

<span class="keyword">import</span> comm._
<span class="keyword">import</span> storage._
<span class="keyword">import</span> perf._
<span class="keyword">import</span> deploylib.ec2._
<span class="keyword">import</span> deploylib.mesos._
<span class="keyword">import</span> piql.scadr._
<span class="keyword">import</span> perf.scadr._
<span class="keyword">import</span> avro.marker._
<span class="keyword">import</span> avro.runtime._
<span class="keyword">import</span> <a href="ExperimentUtil.scala.html#10183" title="object edu.berkeley.cs.scads.piql.modeling.ExperimentUtil">ExperimentUtil</a>._
<span class="keyword">import</span> scala.collection.mutable.ArrayBuffer

<span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling" id="10252">TpcwModeling</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util" id="68987">Util</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(summary: (edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram))Unit" id="69012">printPerIterationPredictionSummary</a><span class="delimiter">(</span><a title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="70587">summary</a>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="70590">actualHist</a> = <a href="#70587" title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)">summary</a>.<span title="=&gt; edu.berkeley.cs.scads.perf.Histogram">_1</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="70591">predictedHist</a> = <a href="#70587" title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)">summary</a>.<span title="=&gt; edu.berkeley.cs.scads.perf.Histogram">_2</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Any*)List[Any]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Actual:&quot;)" class="string">&quot;Actual:&quot;</span>, <span title="java.lang.String(&quot;average=&quot;)" class="string">&quot;average=&quot;</span>, <a href="#70590" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="=&gt; Double">average</span>, <span title="java.lang.String(&quot;median=&quot;)" class="string">&quot;median=&quot;</span>, <a href="#70590" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="=&gt; Int">median</span>, <span title="java.lang.String(&quot;stddev=&quot;)" class="string">&quot;stddev=&quot;</span>, <a href="#70590" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="=&gt; Double">stddev</span>, <span title="java.lang.String(&quot;max=&quot;)" class="string">&quot;max=&quot;</span>, <a href="#70590" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Any*)List[Any]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Predicted:&quot;)" class="string">&quot;Predicted:&quot;</span>, <span title="java.lang.String(&quot;average=&quot;)" class="string">&quot;average=&quot;</span>, <a href="#70591" title="edu.berkeley.cs.scads.perf.Histogram">predictedHist</a>.<span title="=&gt; Double">average</span>, <span title="java.lang.String(&quot;median=&quot;)" class="string">&quot;median=&quot;</span>, <a href="#70591" title="edu.berkeley.cs.scads.perf.Histogram">predictedHist</a>.<span title="=&gt; Int">median</span>, <span title="java.lang.String(&quot;stddev=&quot;)" class="string">&quot;stddev=&quot;</span>, <a href="#70591" title="edu.berkeley.cs.scads.perf.Histogram">predictedHist</a>.<span title="=&gt; Double">stddev</span>, <span title="java.lang.String(&quot;max=&quot;)" class="string">&quot;max=&quot;</span>, <a href="#70591" title="edu.berkeley.cs.scads.perf.Histogram">predictedHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  	<span class="keyword">def</span> <a title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]" id="69013">convolve</a><span class="delimiter">(</span><a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="69650">hist1</a>: <span title="scala.collection.mutable.ArrayBuffer[BigInt]">ArrayBuffer</span><span class="delimiter">[</span>BigInt<span class="delimiter">]</span>, <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="69651">hist2</a>: <span title="scala.collection.mutable.ArrayBuffer[BigInt]">ArrayBuffer</span><span class="delimiter">[</span>BigInt<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scala.collection.mutable.ArrayBuffer[BigInt]">ArrayBuffer</span><span class="delimiter">[</span>BigInt<span class="delimiter">]</span> = <span class="delimiter">{</span>
  	  <span class="keyword">var</span> <a title="Int" id="70625">defaultBucketCount</a> = <span title="Int(1000)" class="int">1000</span>

  	  <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="70626">result</a> = <span title="object scala.collection.mutable.ArrayBuffer">ArrayBuffer</span>.<span title="(n: Int)(elem: =&gt; scala.math.BigInt)scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">fill</span><span class="delimiter">(</span><a href="#70625" title="Int">defaultBucketCount</a><span class="delimiter">)</span><span class="delimiter">(</span><span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>

  	  <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#70625" title="Int">defaultBucketCount</a><span title="(x: Int)Int">-</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="70807">i</a> =&gt; <span class="delimiter">{</span>
  	    <span class="keyword">var</span> <a title="scala.math.BigInt" id="70808">integralOfOverlap</a> = <span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>

        <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#70807" title="Int">i</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="70929">j</a> =&gt; <span class="delimiter">{</span>
          <a href="#70808" title="scala.math.BigInt">integralOfOverlap</a> <span title="(that: scala.math.BigInt)scala.math.BigInt">+=</span> <a href="#69650" title="(idx: Int)BigInt">hist1</a><span class="delimiter">(</span><a href="#70807" title="Int">i</a><span title="(x: Int)Int">-</span><a href="#70929" title="Int">j</a><span class="delimiter">)</span> <span title="(that: scala.math.BigInt)scala.math.BigInt">*</span> <a href="#69651" title="(idx: Int)BigInt">hist2</a><span class="delimiter">(</span><a href="#70929" title="Int">j</a><span class="delimiter">)</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>

        <a href="#70626" title="(idx: Int, elem: scala.math.BigInt)Unit">result</a><span class="delimiter">(</span><a href="#70807" title="Int">i</a><span class="delimiter">)</span> = <a href="#70808" title="scala.math.BigInt">integralOfOverlap</a>
  	  <span class="delimiter">}</span><span class="delimiter">)</span>

  	  <a href="#70626" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">result</a>
  	<span class="delimiter">}</span>
  	
  	<span class="comment">// default bucket size is 1</span>
  	<span class="keyword">val</span> <a title="Int" id="69014">bucketSize</a> = <span title="Int(1)" class="int">1</span>
  	<span class="keyword">def</span> <a title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int" id="69016">quantile</a><span class="delimiter">(</span><a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="69643">hist</a>: <span title="scala.collection.mutable.ArrayBuffer[BigInt]">ArrayBuffer</span><span class="delimiter">[</span>BigInt<span class="delimiter">]</span>, <a title="Double" id="69644">quantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
  	  <span class="keyword">val</span> <a title="Int" id="71009">quantileAsInt</a> = <span class="delimiter">(</span><a href="#69644" title="Double">quantile</a> <span title="(x: Int)Double">*</span> <span title="Int(100)" class="int">100</span><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span>  <span class="comment">// convert to percentage; still receive input as percentage to maintain consistency with Histogram's version</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71010">cumulativeSum</a> = <a href="#69643" title="scala.collection.mutable.ArrayBuffer[BigInt]">hist</a>.<span title="(z: scala.math.BigInt)(op: (scala.math.BigInt, BigInt) =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[BigInt],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">scanLeft</span><span class="delimiter">(</span><span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><a href="#71044" title="scala.math.BigInt">_</a> <span title="(that: scala.math.BigInt)scala.math.BigInt">+</span> <a href="#71045" title="BigInt">_</a><span class="delimiter">)</span>.<span title="(n: Int)scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">drop</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span title="Int" class="keyword">if</span><span class="delimiter">(</span><a href="#69643" title="scala.collection.mutable.ArrayBuffer[BigInt]">hist</a>.<span title="(implicit num: Numeric[BigInt])BigInt">sum</span> <span title="(that: scala.math.BigInt)Boolean">&gt;</span> <span title="implicit scala.math.BigInt.int2bigInt : (i: Int)scala.math.BigInt" class="int">0</span><span class="delimiter">)</span>
        <a href="#71010" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">cumulativeSum</a>.<span title="(p: scala.math.BigInt =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#71124" title="scala.math.BigInt">_</a> <span title="(that: scala.math.BigInt)Boolean">&gt;=</span> <a href="#69643" title="scala.collection.mutable.ArrayBuffer[BigInt]">hist</a>.<span title="(implicit num: Numeric[BigInt])BigInt">sum</span> <span title="(that: scala.math.BigInt)scala.math.BigInt">*</span> <span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71009" title="Int">quantileAsInt</a><span class="delimiter">)</span><span title="(that: scala.math.BigInt)scala.math.BigInt">/</span><span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><span title="Int(100)" class="int">100</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x: Int)Int">*</span> <a href="#69014" title="=&gt; Int">bucketSize</a>
      <span class="keyword">else</span>
        <span title="Int(0)" class="int">0</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(actual: Double, predicted: Double)Unit" id="69017">printActualAndPredicted</a><span class="delimiter">(</span><a title="Double" id="71150">actual</a>:<span title="Double">Double</span>, <a title="Double" id="71151">predicted</a>:<span title="Double">Double</span><span class="delimiter">)</span> = <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Any*)List[Any]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;actual=&quot;)" class="string">&quot;actual=&quot;</span>, <a href="#71150" title="Double">actual</a>, <span title="java.lang.String(&quot;predicted=&quot;)" class="string">&quot;predicted=&quot;</span>, <a href="#71151" title="Double">predicted</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  
    <span class="comment">/*
    def average(hist: ArrayBuffer[BigInt]) = {
      val n = hist.sum
      hist.zipWithIndex.foldLeft(BigInt(0)) { case (acc, (num, idx)) =&gt; acc + num * idx * bucketSize / n }
    }

    /**
     * Sample standard deviation based off of sqrt(1/(N-1)*sum((Xi-mean(X))^2))
     */
    def stddev(hist: ArrayBuffer[BigInt]) = {
      val n = hist.sum
      val xbar = average(hist)
      import scala.math._
      val a = hist.zipWithIndex.foldLeft(BigInt(0)) { case (acc, (num, idx)) =&gt; acc + num * (BigInt(idx) * bucketSize - xbar) * (BigInt(idx) * bucketSize - xbar) }
      sqrt(BigInt(1) / (n - BigInt(1)) * a.toDouble)  // causes compile error
    }
    */</span>
  
  <span class="delimiter">}</span>

  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData" id="68989">TpcwData</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="comment">//val clusterAddress = &quot;zk://zoo.knowsql.org/home/kcurtis/scads/experimentCluster0000000008&quot;</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-75-101-230-218.compute-1.amazonaws.com:2181,ec2-50-19-23-28.compute-1.amazonaws.com:2181,ec2-67-202-16-139.compute-1.amazonaws.com:2181/scads/experimentCluster0000000000&quot;</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-50-16-25-212.compute-1.amazonaws.com:2181,ec2-67-202-10-38.compute-1.amazonaws.com:2181,ec2-174-129-128-67.compute-1.amazonaws.com:2181/scads/experimentCluster0000000000&quot;</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-50-19-140-43.compute-1.amazonaws.com:2181,ec2-72-44-35-240.compute-1.amazonaws.com:2181,ec2-50-17-68-210.compute-1.amazonaws.com:2181/scads/experimentCluster0000000000&quot;</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-174-129-157-147.compute-1.amazonaws.com:2181,ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181/scads/experimentCluster0000000000&quot; // 5.26.11, afternoon</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-174-129-157-147.compute-1.amazonaws.com:2181,ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181/scads/experimentCluster0000000007&quot; // 5.27.11, 3p (blocking)</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-174-129-157-147.compute-1.amazonaws.com:2181,ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181/scads/experimentCluster0000000027&quot;</span>
    <span class="keyword">val</span> <a title="java.lang.String" id="71176">clusterAddress</a> = <span title="java.lang.String(&quot;zk://ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181,ec2-174-129-157-147.compute-1.amazonaws.com:2181/scads/experimentCluster0000000065&quot;)" class="string">&quot;zk://ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181,ec2-174-129-157-147.compute-1.amazonaws.com:2181/scads/experimentCluster0000000065&quot;</span>

    <span class="keyword">def</span> <a title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]" id="71178">experimentResults</a> = <a href="ExperimentUtil.scala.html#49981" title="=&gt; org.apache.avro.file.DataFileReader[edu.berkeley.cs.scads.piql.modeling.Result] with Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">allResults</a>.<span title="(p: edu.berkeley.cs.scads.piql.modeling.Result =&gt; Boolean)Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">filter</span><span class="delimiter">(</span><a href="#71195" title="edu.berkeley.cs.scads.piql.modeling.Result">_</a>.<a href="../collection/QueryRunnerTask.scala.html#37914" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryRunnerTask">clientConfig</a>.<a href="../collection/QueryRunnerTask.scala.html#37999" title="=&gt; String">clusterAddress</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#71176" title="=&gt; java.lang.String">clusterAddress</a><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="Int" id="71179">numIntervals</a> = <span title="Int(35)" class="int">35</span>
    <span class="keyword">def</span> <a title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]" id="71181">goodExperimentResults</a> = <a href="#71178" title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">experimentResults</a>.<span title="(p: edu.berkeley.cs.scads.piql.modeling.Result =&gt; Boolean)Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">filter</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.modeling.Result" id="71204">res</a> =&gt; <a href="#71204" title="edu.berkeley.cs.scads.piql.modeling.Result">res</a>.<a href="../collection/QueryRunnerTask.scala.html#37911" title="=&gt; Int">iteration</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(1)" class="int">1</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#71204" title="edu.berkeley.cs.scads.piql.modeling.Result">res</a>.<a href="../collection/QueryRunnerTask.scala.html#37911" title="=&gt; Int">iteration</a> <span title="(x: Int)Boolean">&lt;=</span> <a href="#71179" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>
        
    <span class="keyword">val</span> <a title="scala.collection.immutable.Map[edu.berkeley.cs.scads.piql.modeling.QueryDescription,edu.berkeley.cs.scads.perf.Histogram]" id="71182">histogramsTpcw</a> = <a href="ExperimentUtil.scala.html#49994" title="(results: Seq[edu.berkeley.cs.scads.piql.modeling.Result])scala.collection.immutable.Map[edu.berkeley.cs.scads.piql.modeling.QueryDescription,edu.berkeley.cs.scads.perf.Histogram]">queryTypeHistogram</a><span class="delimiter">(</span><a href="#71181" title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">goodExperimentResults</a>.<span title="=&gt; Seq[edu.berkeley.cs.scads.piql.modeling.Result]">toSeq</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="scala.collection.immutable.Map[(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int),edu.berkeley.cs.scads.perf.Histogram]" id="71184">perIterationHistograms</a> = <a href="ExperimentUtil.scala.html#49997" title="(results: Seq[edu.berkeley.cs.scads.piql.modeling.Result])scala.collection.immutable.Map[(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int),edu.berkeley.cs.scads.perf.Histogram]">queryTypePerIterationHistograms</a><span class="delimiter">(</span><a href="#71181" title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">goodExperimentResults</a>.<span title="=&gt; Seq[edu.berkeley.cs.scads.piql.modeling.Result]">toSeq</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelBuyRequestExistingCustomerWI" id="68991">ModelBuyRequestExistingCustomerWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68989" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68987" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71218">buyRequestExistingCustomerWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;buyRequestExistingCustomerWI&quot;)" class="string">&quot;buyRequestExistingCustomerWI&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="71220">buyRequestExistingCustomerWIHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71218" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">buyRequestExistingCustomerWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.buyRequestExistingCustomerWI.physicalPlan</span>
    <span class="comment">//res4: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: countries&gt;,ArrayBuffer(AttributeValue(1,6)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: addresses&gt;,ArrayBuffer(AttributeValue(0,4)),</span>
    <span class="comment">//                                             IndexLookup(&lt;Namespace: customers&gt;,ArrayBuffer(ParameterValue(0)))))</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71222">indexLookupCustomers</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupCustomers&quot;)" class="string">&quot;indexLookupCustomers&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71224">indexLookupCustomersHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71222" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71305" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71226">indexLookupJoinAddresses</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAddresses&quot;)" class="string">&quot;indexLookupJoinAddresses&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71228">indexLookupJoinAddressesHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71226" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAddresses</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71393" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71230">indexLookupJoinCountries</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinCountries&quot;)" class="string">&quot;indexLookupJoinCountries&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71232">indexLookupJoinCountriesHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71230" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinCountries</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71478" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="71234">predictHist</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="71525">res1</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#71224" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupCustomersHist</a>, <a href="#71228" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="71526">res2</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#71525" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#71232" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <a href="#71526" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="71235">actual99th</a> = <a href="#71220" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">buyRequestExistingCustomerWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="71237">predicted99th</a> = <a href="#69016" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#71234" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="71239">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="71527">i</a>: <span title="Int">Int</span>, <a title="Double" id="71528">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71530">indexLookupCustomersHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71222" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a>, <a href="#71527" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71575" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71531">indexLookupJoinAddressesHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71226" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAddresses</a>, <a href="#71527" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71659" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71532">indexLookupJoinCountriesHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71230" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinCountries</a>, <a href="#71527" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71743" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="71533">res1</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#71530" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupCustomersHist</a>, <a href="#71531" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="71534">res2</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#71533" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#71532" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <a href="#71534" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>

      <a href="#69016" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#71534" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#71528" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="71240">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="71789">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>
      
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="71790">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="71791">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>
      
      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71179" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="71922">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="71923">actualHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71218" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">buyRequestExistingCustomerWI</a>, <a href="#71922" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="71924">actualQuantile</a> = <a href="#71923" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#71789" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#71790" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#71924" title="=&gt; Long">actualQuantile</a>
        
        <span class="keyword">val</span> <a title="Int" id="71925">predictedQuantile</a> = <a href="#71239" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#71922" title="Int">i</a>, <a href="#71789" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#71791" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#71925" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#71922" title="Int">i</a>, <a href="#71924" title="Int">actualQuantile</a>, <a href="#71925" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      
      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#71790" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#71791" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelHomeWI" id="68993">ModelHomeWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68989" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68987" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71971">homeWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;homeWI&quot;)" class="string">&quot;homeWI&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="71973">homeWIHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71971" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">homeWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.homeWI.physicalPlan</span>
    <span class="comment">//res3: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookup(&lt;Namespace: customers&gt;,ArrayBuffer(ParameterValue(0)))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71975">indexLookupCustomers</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupCustomers&quot;)" class="string">&quot;indexLookupCustomers&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71977">indexLookupCustomersHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71975" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72049" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="Int" id="71979">actual99th</a> = <a href="#71973" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">homeWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="71981">predicted99th</a> = <a href="#69016" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#71977" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupCustomersHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="71983">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="72093">i</a>: <span title="Int">Int</span>, <a title="Double" id="72094">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72096">indexLookupCustomersHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71975" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a>, <a href="#72093" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72137" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <a href="#69016" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#72096" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupCustomersHist</a>, <a href="#72094" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="71984">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="72183">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>
      
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72184">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72185">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>
      
      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71179" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="72316">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72317">actualHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71971" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">homeWI</a>, <a href="#72316" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="72318">actualQuantile</a> = <a href="#72317" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#72183" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#72184" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#72318" title="=&gt; Long">actualQuantile</a>
        
        <span class="keyword">val</span> <a title="Int" id="72319">predictedQuantile</a> = <a href="#71983" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#72316" title="Int">i</a>, <a href="#72183" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#72185" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#72319" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#72316" title="Int">i</a>, <a href="#72318" title="Int">actualQuantile</a>, <a href="#72319" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      
      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#72184" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#72185" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
  
  <span class="comment">// yikes, doesn't work...</span>
  <span class="comment">// maybe not enough samples?</span>
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelNewProductWI" id="68995">ModelNewProductWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68989" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68987" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72365">newProductWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;newProductWI&quot;)" class="string">&quot;newProductWI&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(50)" class="int">50</span><span class="delimiter">)</span>, <span title="Int(50)" class="int">50</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72367">newProductWIHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72365" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">newProductWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.newProductWI.physicalPlan</span>
    <span class="comment">//res6: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: authors&gt;,List(AttributeValue(1,2)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: items&gt;,List(AttributeValue(0,2)),LocalStopAfter(ParameterLimit(1,50),</span>
    <span class="comment">//                                             IndexScan(&lt;Namespace: items_({&quot;fieldNames&quot;: [&quot;I_SUBJECT&quot;]},{&quot;fieldName&quot;: &quot;I_PUB_DATE&quot;})&gt;,List(ParameterValue(0)),ParameterLimit(1,50),false))))</span>
    
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72369">indexScanItemsIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanItemsIdx&quot;)" class="string">&quot;indexScanItemsIdx&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(50)" class="int">50</span><span class="delimiter">)</span>, <span title="Int(50)" class="int">50</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72371">indexScanItemsIdxHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72369" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanItemsIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72452" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72373">indexLookupJoinItems</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinItems&quot;)" class="string">&quot;indexLookupJoinItems&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(50)" class="int">50</span><span class="delimiter">)</span>, <span title="Int(50)" class="int">50</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72375">indexLookupJoinItemsHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72373" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinItems</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72537" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72377">indexLookupJoinAuthors</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAuthors&quot;)" class="string">&quot;indexLookupJoinAuthors&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(50)" class="int">50</span><span class="delimiter">)</span>, <span title="Int(50)" class="int">50</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72379">indexLookupJoinAuthorsHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72377" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72622" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="72381">predictHist</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="72669">res1</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#72371" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanItemsIdxHist</a>, <a href="#72375" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinItemsHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="72670">res2</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#72669" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#72379" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
      <a href="#72670" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="72382">actual99th</a> = <a href="#72367" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">newProductWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="72384">predicted99th</a> = <a href="#69016" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#72381" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="72386">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="72671">i</a>: <span title="Int">Int</span>, <a title="Double" id="72672">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72674">indexScanItemsIdxHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72369" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanItemsIdx</a>, <a href="#72671" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72719" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72675">indexLookupJoinItemsHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72373" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinItems</a>, <a href="#72671" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72803" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72676">indexLookupJoinAuthorsHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72377" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a>, <a href="#72671" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72887" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="72677">res1</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#72674" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanItemsIdxHist</a>, <a href="#72675" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinItemsHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="72678">res2</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#72677" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#72676" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
      <a href="#72678" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>

      <a href="#69016" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#72678" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#72672" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="72387">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="72933">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>
      
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72934">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72935">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>
      
      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71179" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="73066">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73067">actualHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72365" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">newProductWI</a>, <a href="#73066" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="73068">actualQuantile</a> = <a href="#73067" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#72933" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#72934" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#73068" title="=&gt; Long">actualQuantile</a>
        
        <span class="keyword">val</span> <a title="Int" id="73069">predictedQuantile</a> = <a href="#72386" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#73066" title="Int">i</a>, <a href="#72933" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#72935" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#73069" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#73066" title="Int">i</a>, <a href="#73068" title="Int">actualQuantile</a>, <a href="#73069" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      
      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#72934" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#72935" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelOrderDisplayGetCustomer" id="68997">ModelOrderDisplayGetCustomer</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68989" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68987" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73115">orderDisplayGetCustomer</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;orderDisplayGetCustomer&quot;)" class="string">&quot;orderDisplayGetCustomer&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73117">orderDisplayGetCustomerHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73115" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetCustomer</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.orderDisplayGetCustomer.physicalPlan</span>
    <span class="comment">//res11: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookup(&lt;Namespace: customers&gt;,ArrayBuffer(ParameterValue(0)))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73119">indexLookupCustomers</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupCustomers&quot;)" class="string">&quot;indexLookupCustomers&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73121">indexLookupCustomersHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73119" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="Int" id="73123">actual99th</a> = <a href="#73117" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">orderDisplayGetCustomerHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="73125">predicted99th</a> = <a href="#73121" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">indexLookupCustomersHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="73127">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="73174">i</a>: <span title="Int">Int</span>, <a title="Double" id="73175">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73177">indexLookupCustomersHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73119" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a>, <a href="#73174" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="#73177" title="edu.berkeley.cs.scads.perf.Histogram">indexLookupCustomersHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#73175" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
        
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="73128">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="73201">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73202">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73203">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71179" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="73334">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73335">actualHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73115" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetCustomer</a>, <a href="#73334" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="73336">actualQuantile</a> = <a href="#73335" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#73201" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#73202" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#73336" title="=&gt; Long">actualQuantile</a>

        <span class="keyword">val</span> <a title="Int" id="73337">predictedQuantile</a> = <a href="#73127" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#73334" title="Int">i</a>, <a href="#73201" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#73203" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#73337" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#73334" title="Int">i</a>, <a href="#73336" title="Int">actualQuantile</a>, <a href="#73337" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#73202" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#73203" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelOrderDisplayGetLastOrder" id="68999">ModelOrderDisplayGetLastOrder</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68989" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73382">orderDisplayGetLastOrder</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;orderDisplayGetLastOrder&quot;)" class="string">&quot;orderDisplayGetLastOrder&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>  <span class="comment">// queryName, params, resultCardinality</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73384">orderDisplayGetLastOrderHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73382" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetLastOrder</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; res3.orderDisplayGetLastOrder.physicalPlan</span>
    <span class="comment">//res4: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: countries&gt;,ArrayBuffer(AttributeValue(2,6)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: addresses&gt;,ArrayBuffer(AttributeValue(1,9)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: countries&gt;,ArrayBuffer(AttributeValue(2,6)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: addresses&gt;,ArrayBuffer(AttributeValue(1,8)),LocalStopAfter(FixedLimit(1),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: orders&gt;,ArrayBuffer(AttributeValue(0,2)),</span>
    <span class="comment">//                                             IndexScan(&lt;Namespace: orders_({&quot;fieldName&quot;: &quot;O_C_UNAME&quot;},{&quot;fieldName&quot;: &quot;O_DATE_Time&quot;})&gt;,ArrayBuffer(ParameterValue(0)),FixedLimit(1),false)))))))</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73386">indexScanOrdersIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanOrdersIdx&quot;)" class="string">&quot;indexScanOrdersIdx&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73388">indexScanOrdersIdxHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73386" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanOrdersIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73474" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73390">indexLookupJoinOrders</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinOrders&quot;)" class="string">&quot;indexLookupJoinOrders&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73392">indexLookupJoinOrdersHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73390" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinOrders</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73559" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73394">indexLookupJoinAddresses</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAddresses&quot;)" class="string">&quot;indexLookupJoinAddresses&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73396">indexLookupJoinAddressesHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73394" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAddresses</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73644" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73398">indexLookupJoinCountries</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinCountries&quot;)" class="string">&quot;indexLookupJoinCountries&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73400">indexLookupJoinCountriesHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73398" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinCountries</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73729" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="comment">//val predictedHist = indexLookupJoinCountriesHist convolveWith indexLookupJoinAddressesHist convolveWith indexLookupJoinCountriesHist convolveWith indexLookupJoinAddressesHist convolveWith indexLookupJoinOrdersHist convolveWith indexScanOrdersIdxHist</span>
    <span class="comment">// results in overflow.  instead, try per-interval prediction</span>
            
    <span class="keyword">import</span> <a href="#68987" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._

    <span class="comment">/*
    def predictHistBySampling = {
      val numSamples = orderDisplayGetLastOrderHist.totalRequests
      
      val predictedHist = Histogram(1,1000)
      
      (1 to numSamples).foreach(i =&gt; {
        val latencySample = 0
        latencySample += 
      })
    }
    */</span>

    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="73403">predictHist</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73776">res1</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73388" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanOrdersIdxHist</a>, <a href="#73392" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinOrdersHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73777">res2</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73776" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#73396" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73778">res3</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73777" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#73400" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73779">res4</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73778" title="scala.collection.mutable.ArrayBuffer[BigInt]">res3</a>, <a href="#73396" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73780">res5</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73779" title="scala.collection.mutable.ArrayBuffer[BigInt]">res4</a>, <a href="#73400" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <a href="#73780" title="scala.collection.mutable.ArrayBuffer[BigInt]">res5</a>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="73404">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="73781">i</a>: <span title="Int">Int</span>, <a title="Double" id="73782">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73784">indexScanOrdersIdxHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73386" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanOrdersIdx</a>, <a href="#73781" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73833" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73785">indexLookupJoinOrdersHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73390" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinOrders</a>, <a href="#73781" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73917" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73786">indexLookupJoinAddressesHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73394" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAddresses</a>, <a href="#73781" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74001" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73787">indexLookupJoinCountriesHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73398" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinCountries</a>, <a href="#73781" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74085" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73788">res1</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73784" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanOrdersIdxHist</a>, <a href="#73785" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinOrdersHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73789">res2</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73788" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#73786" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73790">res3</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73789" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#73787" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73791">res4</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73790" title="scala.collection.mutable.ArrayBuffer[BigInt]">res3</a>, <a href="#73786" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73792">predictedHist</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73791" title="scala.collection.mutable.ArrayBuffer[BigInt]">res4</a>, <a href="#73787" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>

      <a href="#69016" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#73792" title="scala.collection.mutable.ArrayBuffer[BigInt]">predictedHist</a>, <a href="#73782" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
        
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="73405">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="74131">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 50</span>

      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74132">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74133">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71179" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="74264">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74265">actualHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73382" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetLastOrder</a>, <a href="#74264" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="74266">actualQuantile</a> = <a href="#74265" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#74131" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#74132" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#74266" title="=&gt; Long">actualQuantile</a>

        <span class="keyword">val</span> <a title="Int" id="74267">predictedQuantile</a> = <a href="#73404" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#74264" title="Int">i</a>, <a href="#74131" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#74133" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#74267" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#74264" title="Int">i</a>, <a href="#74266" title="Int">actualQuantile</a>, <a href="#74267" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#74132" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#74133" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="73406">actual99th</a> = <a href="#73384" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">orderDisplayGetLastOrderHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="73408">predicted99th</a> = <a href="#69016" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#73403" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelOrderDisplayGetOrderLines" id="69001">ModelOrderDisplayGetOrderLines</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68989" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68987" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74313">orderDisplayGetOrderLines</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;orderDisplayGetOrderLines&quot;)" class="string">&quot;orderDisplayGetOrderLines&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(3)" class="int">3</span><span class="delimiter">)</span>  <span class="comment">// might want to fix this later so requested cardinality = result cardinality</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74315">orderDisplayGetOrderLinesHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74313" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetOrderLines</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.orderDisplayGetOrderLines.physicalPlan</span>
    <span class="comment">//res13: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: items&gt;,ArrayBuffer(AttributeValue(0,2)),LocalStopAfter(ParameterLimit(1,100),</span>
    <span class="comment">//                                              IndexScan(&lt;Namespace: orderLines&gt;,ArrayBuffer(ParameterValue(0)),ParameterLimit(1,100),true)))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74317">indexScanOrderLines</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanOrderLines&quot;)" class="string">&quot;indexScanOrderLines&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(3)" class="int">3</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74319">indexScanOrderLinesHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74317" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanOrderLines</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74396" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74321">indexLookupJoinItems</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinItems&quot;)" class="string">&quot;indexLookupJoinItems&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(3)" class="int">3</span><span class="delimiter">)</span>, <span title="Int(3)" class="int">3</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74323">indexLookupJoinItemsHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74321" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinItems</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74481" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="74325">predictHist</a> = <span class="delimiter">{</span>
      <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74319" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanOrderLinesHist</a>, <a href="#74323" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinItemsHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="74326">actual99th</a> = <a href="#74315" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">orderDisplayGetOrderLinesHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="74328">predicted99th</a> = <a href="#69016" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#74325" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="74330">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="74528">i</a>: <span title="Int">Int</span>, <a title="Double" id="74529">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74531">indexScanOrderLinesHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74317" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanOrderLines</a>, <a href="#74528" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74574" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74532">indexLookupJoinItemsHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74321" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinItems</a>, <a href="#74528" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74658" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="74533">predictedHist</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74531" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanOrderLinesHist</a>, <a href="#74532" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinItemsHist</a><span class="delimiter">)</span>
      
      <a href="#69016" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#74533" title="scala.collection.mutable.ArrayBuffer[BigInt]">predictedHist</a>, <a href="#74529" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="74331">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="74704">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>
      
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74705">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74706">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>
      
      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71179" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="74837">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74838">actualHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74313" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetOrderLines</a>, <a href="#74837" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="74839">actualQuantile</a> = <a href="#74838" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#74704" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#74705" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#74839" title="=&gt; Long">actualQuantile</a>
        
        <span class="keyword">val</span> <a title="Int" id="74840">predictedQuantile</a> = <a href="#74330" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#74837" title="Int">i</a>, <a href="#74704" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#74706" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#74840" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#74837" title="Int">i</a>, <a href="#74839" title="Int">actualQuantile</a>, <a href="#74840" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      
      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#74705" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#74706" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelProductDetailWI" id="69003">ModelProductDetailWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68989" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68987" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74886">productDetailWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;productDetailWI&quot;)" class="string">&quot;productDetailWI&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74888">productDetailWIHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74886" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">productDetailWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.productDetailWI.physicalPlan</span>
    <span class="comment">//res17: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: authors&gt;,ArrayBuffer(AttributeValue(0,2)),</span>
    <span class="comment">//                                              IndexLookup(&lt;Namespace: items&gt;,ArrayBuffer(ParameterValue(0))))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74890">indexLookupItems</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupItems&quot;)" class="string">&quot;indexLookupItems&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74892">indexLookupItemsHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74890" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupItems</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74969" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74894">indexLookupJoinAuthors</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAuthors&quot;)" class="string">&quot;indexLookupJoinAuthors&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74896">indexLookupJoinAuthorsHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74894" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75054" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="74898">predictHist</a> = <span class="delimiter">{</span>
      <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74892" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupItemsHist</a>, <a href="#74896" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="74899">actual99th</a> = <a href="#74888" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">productDetailWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="74901">predicted99th</a> = <a href="#69016" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#74898" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="74903">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="75101">i</a>: <span title="Int">Int</span>, <a title="Double" id="75102">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75104">indexLookupItemsHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74890" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupItems</a>, <a href="#75101" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75146" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75105">indexLookupJoinAuthorsHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74894" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a>, <a href="#75101" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75230" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="#69016" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#75104" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupItemsHist</a>, <a href="#75105" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>, <a href="#75102" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
        
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="74904">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="75276">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>

      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75277">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75278">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71179" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="75409">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75410">actualHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74886" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">productDetailWI</a>, <a href="#75409" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="75411">actualQuantile</a> = <a href="#75410" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#75276" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#75277" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#75411" title="=&gt; Long">actualQuantile</a>

        <span class="keyword">val</span> <a title="Int" id="75412">predictedQuantile</a> = <a href="#74903" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#75409" title="Int">i</a>, <a href="#75276" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#75278" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#75412" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#75409" title="Int">i</a>, <a href="#75411" title="Int">actualQuantile</a>, <a href="#75412" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#75277" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#75278" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>

  <span class="comment">// for some reason, I don't have data on this</span>
  <span class="comment">// will have to figure this out later</span>
  <span class="comment">// probably b/c in TpcwClient, there was no query name passed to toPiql</span>
  <span class="comment">// right now, only have a query description where shopping cart is empty b/c shopping cart is never getting populated</span>
  <span class="comment">// for now, postpone this</span>
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelRetrieveShoppingCart" id="69005">ModelRetrieveShoppingCart</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68989" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68987" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75458">retrieveShoppingCart</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;unnamed&quot;)" class="string">&quot;unnamed&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="comment">// &quot;unnamed&quot; b/c of bug in TpcwClient; 0 b/c not getting populated</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75460">retrieveShoppingCartHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75458" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">retrieveShoppingCart</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.retrieveShoppingCart.physicalPlan</span>
    <span class="comment">//res33: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: items&gt;,ArrayBuffer(AttributeValue(0,1)),</span>
    <span class="comment">//                                              LocalStopAfter(FixedLimit(1000),</span>
    <span class="comment">//                                              IndexScan(&lt;Namespace: shoppingCartItems&gt;,ArrayBuffer(ParameterValue(0)),FixedLimit(1000),true)))</span>
    
    
  <span class="delimiter">}</span>

  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelSearchByAuthorWI" id="69007">ModelSearchByAuthorWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68989" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68987" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75488">searchByAuthorWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;searchByAuthorWI&quot;)" class="string">&quot;searchByAuthorWI&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(10)" class="int">10</span><span class="delimiter">)</span> <span class="comment">// only one where requested cardinality = result cardinality</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75490">searchByAuthorWIHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75488" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">searchByAuthorWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.searchByAuthorWI.physicalPlan</span>
    <span class="comment">//res22: edu.berkeley.cs.scads.piql.QueryPlan = LocalStopAfter(ParameterLimit(1,50),</span>
    <span class="comment">//                                              IndexMergeJoin(&lt;Namespace: items_({&quot;fieldName&quot;: &quot;I_A_ID&quot;},{&quot;fieldName&quot;: &quot;I_TITLE&quot;})&gt;,List(AttributeValue(0,1)),List(AttributeValue(2,1)),ParameterLimit(1,50),true,</span>
    <span class="comment">//                                              IndexLookupJoin(&lt;Namespace: authors&gt;,List(AttributeValue(0,1)),LocalStopAfter(FixedLimit(50),</span>
    <span class="comment">//                                              IndexScan(&lt;Namespace: authors_({&quot;fieldNames&quot;: [&quot;A_FNAME&quot;, &quot;A_LNAME&quot;]})&gt;,List(ParameterValue(0)),FixedLimit(50),true)))))</span>
    
    <span class="comment">// I don't think we have the right benchmarks collected here.</span>
    <span class="comment">// I think we need the following:</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75492">indexScanAuthorsIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanAuthorsIdx&quot;)" class="string">&quot;indexScanAuthorsIdx&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>  <span class="comment">// i have this benchmark already</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75494">indexScanAuthorsIdxHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75492" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanAuthorsIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75575" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75496">indexLookupJoinAuthors</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAuthors&quot;)" class="string">&quot;indexLookupJoinAuthors&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="comment">// i NEED this</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75498">indexLookupJoinAuthorsHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75496" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75660" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75500">indexMergeJoinItemsIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexMergeJoinItemsIdx&quot;)" class="string">&quot;indexMergeJoinItemsIdx&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>, <span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(10)" class="int">10</span><span class="delimiter">)</span> <span class="comment">// i NEED this</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75502">indexMergeJoinItemsIdxHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75500" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexMergeJoinItemsIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75745" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="75504">predictHist</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="75792">res1</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#75494" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanAuthorsIdxHist</a>, <a href="#75498" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="75793">res2</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#75792" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#75502" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexMergeJoinItemsIdxHist</a><span class="delimiter">)</span>
      <a href="#75793" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="75505">actual99th</a> = <a href="#75490" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">searchByAuthorWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="75507">predicted99th</a> = <a href="#69016" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#75504" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="75509">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="75794">i</a>: <span title="Int">Int</span>, <a title="Double" id="75795">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75797">indexScanAuthorsIdxHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#75492" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanAuthorsIdx</a>, <a href="#75794" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75842" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75798">indexLookupJoinAuthorsHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#75496" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a>, <a href="#75794" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75926" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75799">indexMergeJoinItemsIdxHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#75500" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexMergeJoinItemsIdx</a>, <a href="#75794" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76010" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="75800">res1</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#75797" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanAuthorsIdxHist</a>, <a href="#75798" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="75801">res2</a> = <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#75800" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#75799" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexMergeJoinItemsIdxHist</a><span class="delimiter">)</span>
      <a href="#75801" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>

      <a href="#69016" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#75801" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#75795" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

     <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="75510">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="76091">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
       <span class="comment">//val numIntervals = 30</span>

       <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76092">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
       <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76093">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

       <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

       <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71179" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="76224">i</a> =&gt; <span class="delimiter">{</span>
         <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76225">actualHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#75488" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">searchByAuthorWI</a>, <a href="#76224" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
         <span class="keyword">val</span> <a title="Int" id="76226">actualQuantile</a> = <a href="#76225" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#76091" title="Double">quantile</a><span class="delimiter">)</span>
         <a href="#76092" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#76226" title="=&gt; Long">actualQuantile</a>

         <span class="keyword">val</span> <a title="Int" id="76227">predictedQuantile</a> = <a href="#75509" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#76224" title="Int">i</a>, <a href="#76091" title="Double">quantile</a><span class="delimiter">)</span>
         <a href="#76093" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#76227" title="=&gt; Long">predictedQuantile</a>

         <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#76224" title="Int">i</a>, <a href="#76226" title="Int">actualQuantile</a>, <a href="#76227" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
       <span class="delimiter">}</span><span class="delimiter">)</span>

       <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#76092" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#76093" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
     <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelSearchByTitleWI" id="69009">ModelSearchByTitleWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68989" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68987" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="76273">searchByTitleWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;searchByTitleWI&quot;)" class="string">&quot;searchByTitleWI&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(7)" class="int">7</span><span class="comment">/*9*/</span><span class="delimiter">)</span>  <span class="comment">// want to make requested, result cardinalities match</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76275">searchByTitleWIHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#76273" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">searchByTitleWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.searchByTitleWI.physicalPlan</span>
    <span class="comment">//res26: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: authors&gt;,List(AttributeValue(0,2)),LocalStopAfter(ParameterLimit(1,50),</span>
    <span class="comment">//                                              IndexScan(&lt;Namespace: items_({&quot;fieldNames&quot;: [&quot;I_TITLE&quot;]},{&quot;fieldName&quot;: &quot;I_TITLE&quot;},{&quot;fieldName&quot;: &quot;I_A_ID&quot;})&gt;,List(ParameterValue(0)),ParameterLimit(1,50),true)))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="76277">indexScanItemsIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanItemsIdx&quot;)" class="string">&quot;indexScanItemsIdx&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(9)" class="int">9</span><span class="delimiter">)</span>, <span title="Int(9)" class="int">9</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76279">indexScanItemsIdxHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#76277" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanItemsIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76356" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="76281">indexLookupJoinAuthors</a> = <a href="../collection/QueryRunnerTask.scala.html#37838" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAuthors&quot;)" class="string">&quot;indexLookupJoinAuthors&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(9)" class="int">9</span><span class="delimiter">)</span>, <span title="Int(9)" class="int">9</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76283">indexLookupJoinAuthorsHist</a> = <a href="#71182" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#76281" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76437" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="76285">predictHist</a> = <span class="delimiter">{</span>
      <a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#76279" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanItemsIdxHist</a>, <a href="#76283" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="76286">actual99th</a> = <a href="#76275" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">searchByTitleWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="76288">predicted99th</a> = <a href="#69016" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#76285" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="76290">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="76480">i</a>: <span title="Int">Int</span>, <a title="Double" id="76481">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76483">indexScanItemsIdxHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#76277" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanItemsIdx</a>, <a href="#76480" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76525" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76484">indexLookupJoinAuthorsHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#76281" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a>, <a href="#76480" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76605" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

       <a href="#69016" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#69013" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#76483" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanItemsIdxHist</a>, <a href="#76484" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>, <a href="#76481" title="Double">desiredQuantile</a><span class="delimiter">)</span>
     <span class="delimiter">}</span>

     <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="76291">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="76647">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
       <span class="comment">//val numIntervals = 30</span>

       <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76648">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
       <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76649">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

       <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

       <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71179" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="76780">i</a> =&gt; <span class="delimiter">{</span>
         <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76781">actualHist</a> = <a href="#71184" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#76273" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">searchByTitleWI</a>, <a href="#76780" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
         <span class="keyword">val</span> <a title="Int" id="76782">actualQuantile</a> = <a href="#76781" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#76647" title="Double">quantile</a><span class="delimiter">)</span>
         <a href="#76648" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#76782" title="=&gt; Long">actualQuantile</a>

         <span class="keyword">val</span> <a title="Int" id="76783">predictedQuantile</a> = <a href="#76290" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#76780" title="Int">i</a>, <a href="#76647" title="Double">quantile</a><span class="delimiter">)</span>
         <a href="#76649" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#76783" title="=&gt; Long">predictedQuantile</a>

         <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#76780" title="Int">i</a>, <a href="#76782" title="Int">actualQuantile</a>, <a href="#76783" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
       <span class="delimiter">}</span><span class="delimiter">)</span>

       <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#76648" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#76649" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
     <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
<span class="delimiter">}</span>
        </pre>
    </body>
</html>