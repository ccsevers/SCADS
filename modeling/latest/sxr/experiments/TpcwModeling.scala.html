<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>experiments/TpcwModeling.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs
<span class="keyword">package</span> scads
<span class="keyword">package</span> piql
<span class="keyword">package</span> modeling

<span class="keyword">import</span> comm._
<span class="keyword">import</span> storage._
<span class="keyword">import</span> perf._
<span class="keyword">import</span> deploylib.ec2._
<span class="keyword">import</span> deploylib.mesos._
<span class="keyword">import</span> piql.scadr._
<span class="keyword">import</span> perf.scadr._
<span class="keyword">import</span> avro.marker._
<span class="keyword">import</span> avro.runtime._
<span class="keyword">import</span> <a href="ExperimentUtil.scala.html#10185" title="object edu.berkeley.cs.scads.piql.modeling.ExperimentUtil">ExperimentUtil</a>._
<span class="keyword">import</span> scala.collection.mutable.ArrayBuffer

<span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling" id="10254">TpcwModeling</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util" id="68956">Util</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(summary: (edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram))Unit" id="68981">printPerIterationPredictionSummary</a><span class="delimiter">(</span><a title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="70556">summary</a>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="70559">actualHist</a> = <a href="#70556" title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)">summary</a>.<span title="=&gt; edu.berkeley.cs.scads.perf.Histogram">_1</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="70560">predictedHist</a> = <a href="#70556" title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)">summary</a>.<span title="=&gt; edu.berkeley.cs.scads.perf.Histogram">_2</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Any*)List[Any]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Actual:&quot;)" class="string">&quot;Actual:&quot;</span>, <span title="java.lang.String(&quot;average=&quot;)" class="string">&quot;average=&quot;</span>, <a href="#70559" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="=&gt; Double">average</span>, <span title="java.lang.String(&quot;median=&quot;)" class="string">&quot;median=&quot;</span>, <a href="#70559" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="=&gt; Int">median</span>, <span title="java.lang.String(&quot;stddev=&quot;)" class="string">&quot;stddev=&quot;</span>, <a href="#70559" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="=&gt; Double">stddev</span>, <span title="java.lang.String(&quot;max=&quot;)" class="string">&quot;max=&quot;</span>, <a href="#70559" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Any*)List[Any]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Predicted:&quot;)" class="string">&quot;Predicted:&quot;</span>, <span title="java.lang.String(&quot;average=&quot;)" class="string">&quot;average=&quot;</span>, <a href="#70560" title="edu.berkeley.cs.scads.perf.Histogram">predictedHist</a>.<span title="=&gt; Double">average</span>, <span title="java.lang.String(&quot;median=&quot;)" class="string">&quot;median=&quot;</span>, <a href="#70560" title="edu.berkeley.cs.scads.perf.Histogram">predictedHist</a>.<span title="=&gt; Int">median</span>, <span title="java.lang.String(&quot;stddev=&quot;)" class="string">&quot;stddev=&quot;</span>, <a href="#70560" title="edu.berkeley.cs.scads.perf.Histogram">predictedHist</a>.<span title="=&gt; Double">stddev</span>, <span title="java.lang.String(&quot;max=&quot;)" class="string">&quot;max=&quot;</span>, <a href="#70560" title="edu.berkeley.cs.scads.perf.Histogram">predictedHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  	<span class="keyword">def</span> <a title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]" id="68982">convolve</a><span class="delimiter">(</span><a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="69619">hist1</a>: <span title="scala.collection.mutable.ArrayBuffer[BigInt]">ArrayBuffer</span><span class="delimiter">[</span>BigInt<span class="delimiter">]</span>, <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="69620">hist2</a>: <span title="scala.collection.mutable.ArrayBuffer[BigInt]">ArrayBuffer</span><span class="delimiter">[</span>BigInt<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scala.collection.mutable.ArrayBuffer[BigInt]">ArrayBuffer</span><span class="delimiter">[</span>BigInt<span class="delimiter">]</span> = <span class="delimiter">{</span>
  	  <span class="keyword">var</span> <a title="Int" id="70594">defaultBucketCount</a> = <span title="Int(1000)" class="int">1000</span>

  	  <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="70595">result</a> = <span title="object scala.collection.mutable.ArrayBuffer">ArrayBuffer</span>.<span title="(n: Int)(elem: =&gt; scala.math.BigInt)scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">fill</span><span class="delimiter">(</span><a href="#70594" title="Int">defaultBucketCount</a><span class="delimiter">)</span><span class="delimiter">(</span><span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>

  	  <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#70594" title="Int">defaultBucketCount</a><span title="(x: Int)Int">-</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="70776">i</a> =&gt; <span class="delimiter">{</span>
  	    <span class="keyword">var</span> <a title="scala.math.BigInt" id="70777">integralOfOverlap</a> = <span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>

        <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#70776" title="Int">i</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="70898">j</a> =&gt; <span class="delimiter">{</span>
          <a href="#70777" title="scala.math.BigInt">integralOfOverlap</a> <span title="(that: scala.math.BigInt)scala.math.BigInt">+=</span> <a href="#69619" title="(idx: Int)BigInt">hist1</a><span class="delimiter">(</span><a href="#70776" title="Int">i</a><span title="(x: Int)Int">-</span><a href="#70898" title="Int">j</a><span class="delimiter">)</span> <span title="(that: scala.math.BigInt)scala.math.BigInt">*</span> <a href="#69620" title="(idx: Int)BigInt">hist2</a><span class="delimiter">(</span><a href="#70898" title="Int">j</a><span class="delimiter">)</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>

        <a href="#70595" title="(idx: Int, elem: scala.math.BigInt)Unit">result</a><span class="delimiter">(</span><a href="#70776" title="Int">i</a><span class="delimiter">)</span> = <a href="#70777" title="scala.math.BigInt">integralOfOverlap</a>
  	  <span class="delimiter">}</span><span class="delimiter">)</span>

  	  <a href="#70595" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">result</a>
  	<span class="delimiter">}</span>
  	
  	<span class="comment">// default bucket size is 1</span>
  	<span class="keyword">val</span> <a title="Int" id="68983">bucketSize</a> = <span title="Int(1)" class="int">1</span>
  	<span class="keyword">def</span> <a title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int" id="68985">quantile</a><span class="delimiter">(</span><a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="69612">hist</a>: <span title="scala.collection.mutable.ArrayBuffer[BigInt]">ArrayBuffer</span><span class="delimiter">[</span>BigInt<span class="delimiter">]</span>, <a title="Double" id="69613">quantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
  	  <span class="keyword">val</span> <a title="Int" id="70978">quantileAsInt</a> = <span class="delimiter">(</span><a href="#69613" title="Double">quantile</a> <span title="(x: Int)Double">*</span> <span title="Int(100)" class="int">100</span><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span>  <span class="comment">// convert to percentage; still receive input as percentage to maintain consistency with Histogram's version</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="70979">cumulativeSum</a> = <a href="#69612" title="scala.collection.mutable.ArrayBuffer[BigInt]">hist</a>.<span title="(z: scala.math.BigInt)(op: (scala.math.BigInt, BigInt) =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[BigInt],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">scanLeft</span><span class="delimiter">(</span><span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><a href="#71013" title="scala.math.BigInt">_</a> <span title="(that: scala.math.BigInt)scala.math.BigInt">+</span> <a href="#71014" title="BigInt">_</a><span class="delimiter">)</span>.<span title="(n: Int)scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">drop</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span title="Int" class="keyword">if</span><span class="delimiter">(</span><a href="#69612" title="scala.collection.mutable.ArrayBuffer[BigInt]">hist</a>.<span title="(implicit num: Numeric[BigInt])BigInt">sum</span> <span title="(that: scala.math.BigInt)Boolean">&gt;</span> <span title="implicit scala.math.BigInt.int2bigInt : (i: Int)scala.math.BigInt" class="int">0</span><span class="delimiter">)</span>
        <a href="#70979" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">cumulativeSum</a>.<span title="(p: scala.math.BigInt =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#71093" title="scala.math.BigInt">_</a> <span title="(that: scala.math.BigInt)Boolean">&gt;=</span> <a href="#69612" title="scala.collection.mutable.ArrayBuffer[BigInt]">hist</a>.<span title="(implicit num: Numeric[BigInt])BigInt">sum</span> <span title="(that: scala.math.BigInt)scala.math.BigInt">*</span> <span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#70978" title="Int">quantileAsInt</a><span class="delimiter">)</span><span title="(that: scala.math.BigInt)scala.math.BigInt">/</span><span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><span title="Int(100)" class="int">100</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x: Int)Int">*</span> <a href="#68983" title="=&gt; Int">bucketSize</a>
      <span class="keyword">else</span>
        <span title="Int(0)" class="int">0</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(actual: Double, predicted: Double)Unit" id="68986">printActualAndPredicted</a><span class="delimiter">(</span><a title="Double" id="71119">actual</a>:<span title="Double">Double</span>, <a title="Double" id="71120">predicted</a>:<span title="Double">Double</span><span class="delimiter">)</span> = <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Any*)List[Any]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;actual=&quot;)" class="string">&quot;actual=&quot;</span>, <a href="#71119" title="Double">actual</a>, <span title="java.lang.String(&quot;predicted=&quot;)" class="string">&quot;predicted=&quot;</span>, <a href="#71120" title="Double">predicted</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  
    <span class="comment">/*
    def average(hist: ArrayBuffer[BigInt]) = {
      val n = hist.sum
      hist.zipWithIndex.foldLeft(BigInt(0)) { case (acc, (num, idx)) =&gt; acc + num * idx * bucketSize / n }
    }

    /**
     * Sample standard deviation based off of sqrt(1/(N-1)*sum((Xi-mean(X))^2))
     */
    def stddev(hist: ArrayBuffer[BigInt]) = {
      val n = hist.sum
      val xbar = average(hist)
      import scala.math._
      val a = hist.zipWithIndex.foldLeft(BigInt(0)) { case (acc, (num, idx)) =&gt; acc + num * (BigInt(idx) * bucketSize - xbar) * (BigInt(idx) * bucketSize - xbar) }
      sqrt(BigInt(1) / (n - BigInt(1)) * a.toDouble)  // causes compile error
    }
    */</span>
  
  <span class="delimiter">}</span>

  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData" id="68958">TpcwData</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="comment">//val clusterAddress = &quot;zk://zoo.knowsql.org/home/kcurtis/scads/experimentCluster0000000008&quot;</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-75-101-230-218.compute-1.amazonaws.com:2181,ec2-50-19-23-28.compute-1.amazonaws.com:2181,ec2-67-202-16-139.compute-1.amazonaws.com:2181/scads/experimentCluster0000000000&quot;</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-50-16-25-212.compute-1.amazonaws.com:2181,ec2-67-202-10-38.compute-1.amazonaws.com:2181,ec2-174-129-128-67.compute-1.amazonaws.com:2181/scads/experimentCluster0000000000&quot;</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-50-19-140-43.compute-1.amazonaws.com:2181,ec2-72-44-35-240.compute-1.amazonaws.com:2181,ec2-50-17-68-210.compute-1.amazonaws.com:2181/scads/experimentCluster0000000000&quot;</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-174-129-157-147.compute-1.amazonaws.com:2181,ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181/scads/experimentCluster0000000000&quot; // 5.26.11, afternoon</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-174-129-157-147.compute-1.amazonaws.com:2181,ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181/scads/experimentCluster0000000007&quot; // 5.27.11, 3p (blocking)</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-174-129-157-147.compute-1.amazonaws.com:2181,ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181/scads/experimentCluster0000000027&quot;</span>
    <span class="keyword">val</span> <a title="java.lang.String" id="71145">clusterAddress</a> = <span title="java.lang.String(&quot;zk://ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181,ec2-174-129-157-147.compute-1.amazonaws.com:2181/scads/experimentCluster0000000065&quot;)" class="string">&quot;zk://ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181,ec2-174-129-157-147.compute-1.amazonaws.com:2181/scads/experimentCluster0000000065&quot;</span>

    <span class="keyword">def</span> <a title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]" id="71147">experimentResults</a> = <a href="ExperimentUtil.scala.html#49985" title="=&gt; org.apache.avro.file.DataFileReader[edu.berkeley.cs.scads.piql.modeling.Result] with Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">allResults</a>.<span title="(p: edu.berkeley.cs.scads.piql.modeling.Result =&gt; Boolean)Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">filter</span><span class="delimiter">(</span><a href="#71164" title="edu.berkeley.cs.scads.piql.modeling.Result">_</a>.<a href="../collection/QueryRunnerTask.scala.html#37918" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryRunnerTask">clientConfig</a>.<a href="../collection/QueryRunnerTask.scala.html#38003" title="=&gt; String">clusterAddress</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#71145" title="=&gt; java.lang.String">clusterAddress</a><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="Int" id="71148">numIntervals</a> = <span title="Int(35)" class="int">35</span>
    <span class="keyword">def</span> <a title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]" id="71150">goodExperimentResults</a> = <a href="#71147" title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">experimentResults</a>.<span title="(p: edu.berkeley.cs.scads.piql.modeling.Result =&gt; Boolean)Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">filter</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.modeling.Result" id="71173">res</a> =&gt; <a href="#71173" title="edu.berkeley.cs.scads.piql.modeling.Result">res</a>.<a href="../collection/QueryRunnerTask.scala.html#37915" title="=&gt; Int">iteration</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(1)" class="int">1</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#71173" title="edu.berkeley.cs.scads.piql.modeling.Result">res</a>.<a href="../collection/QueryRunnerTask.scala.html#37915" title="=&gt; Int">iteration</a> <span title="(x: Int)Boolean">&lt;=</span> <a href="#71148" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>
        
    <span class="keyword">val</span> <a title="scala.collection.immutable.Map[edu.berkeley.cs.scads.piql.modeling.QueryDescription,edu.berkeley.cs.scads.perf.Histogram]" id="71151">histogramsTpcw</a> = <a href="ExperimentUtil.scala.html#49998" title="(results: Seq[edu.berkeley.cs.scads.piql.modeling.Result])scala.collection.immutable.Map[edu.berkeley.cs.scads.piql.modeling.QueryDescription,edu.berkeley.cs.scads.perf.Histogram]">queryTypeHistogram</a><span class="delimiter">(</span><a href="#71150" title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">goodExperimentResults</a>.<span title="=&gt; Seq[edu.berkeley.cs.scads.piql.modeling.Result]">toSeq</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="scala.collection.immutable.Map[(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int),edu.berkeley.cs.scads.perf.Histogram]" id="71153">perIterationHistograms</a> = <a href="ExperimentUtil.scala.html#50001" title="(results: Seq[edu.berkeley.cs.scads.piql.modeling.Result])scala.collection.immutable.Map[(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int),edu.berkeley.cs.scads.perf.Histogram]">queryTypePerIterationHistograms</a><span class="delimiter">(</span><a href="#71150" title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">goodExperimentResults</a>.<span title="=&gt; Seq[edu.berkeley.cs.scads.piql.modeling.Result]">toSeq</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelBuyRequestExistingCustomerWI" id="68960">ModelBuyRequestExistingCustomerWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68958" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68956" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71187">buyRequestExistingCustomerWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;buyRequestExistingCustomerWI&quot;)" class="string">&quot;buyRequestExistingCustomerWI&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="71189">buyRequestExistingCustomerWIHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71187" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">buyRequestExistingCustomerWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.buyRequestExistingCustomerWI.physicalPlan</span>
    <span class="comment">//res4: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: countries&gt;,ArrayBuffer(AttributeValue(1,6)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: addresses&gt;,ArrayBuffer(AttributeValue(0,4)),</span>
    <span class="comment">//                                             IndexLookup(&lt;Namespace: customers&gt;,ArrayBuffer(ParameterValue(0)))))</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71191">indexLookupCustomers</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupCustomers&quot;)" class="string">&quot;indexLookupCustomers&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71193">indexLookupCustomersHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71191" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71274" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71195">indexLookupJoinAddresses</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAddresses&quot;)" class="string">&quot;indexLookupJoinAddresses&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71197">indexLookupJoinAddressesHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71195" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAddresses</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71362" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71199">indexLookupJoinCountries</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinCountries&quot;)" class="string">&quot;indexLookupJoinCountries&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71201">indexLookupJoinCountriesHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71199" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinCountries</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71447" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="71203">predictHist</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="71494">res1</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#71193" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupCustomersHist</a>, <a href="#71197" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="71495">res2</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#71494" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#71201" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <a href="#71495" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="71204">actual99th</a> = <a href="#71189" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">buyRequestExistingCustomerWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="71206">predicted99th</a> = <a href="#68985" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#71203" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="71208">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="71496">i</a>: <span title="Int">Int</span>, <a title="Double" id="71497">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71499">indexLookupCustomersHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71191" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a>, <a href="#71496" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71544" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71500">indexLookupJoinAddressesHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71195" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAddresses</a>, <a href="#71496" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71628" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71501">indexLookupJoinCountriesHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71199" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinCountries</a>, <a href="#71496" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71712" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="71502">res1</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#71499" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupCustomersHist</a>, <a href="#71500" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="71503">res2</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#71502" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#71501" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <a href="#71503" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>

      <a href="#68985" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#71503" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#71497" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="71209">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="71758">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>
      
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="71759">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="71760">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>
      
      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71148" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="71891">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="71892">actualHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71187" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">buyRequestExistingCustomerWI</a>, <a href="#71891" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="71893">actualQuantile</a> = <a href="#71892" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#71758" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#71759" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#71893" title="=&gt; Long">actualQuantile</a>
        
        <span class="keyword">val</span> <a title="Int" id="71894">predictedQuantile</a> = <a href="#71208" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#71891" title="Int">i</a>, <a href="#71758" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#71760" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#71894" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#71891" title="Int">i</a>, <a href="#71893" title="Int">actualQuantile</a>, <a href="#71894" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      
      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#71759" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#71760" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelHomeWI" id="68962">ModelHomeWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68958" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68956" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71940">homeWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;homeWI&quot;)" class="string">&quot;homeWI&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="71942">homeWIHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71940" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">homeWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.homeWI.physicalPlan</span>
    <span class="comment">//res3: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookup(&lt;Namespace: customers&gt;,ArrayBuffer(ParameterValue(0)))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71944">indexLookupCustomers</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupCustomers&quot;)" class="string">&quot;indexLookupCustomers&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71946">indexLookupCustomersHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71944" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72018" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="Int" id="71948">actual99th</a> = <a href="#71942" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">homeWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="71950">predicted99th</a> = <a href="#68985" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#71946" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupCustomersHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="71952">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="72062">i</a>: <span title="Int">Int</span>, <a title="Double" id="72063">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72065">indexLookupCustomersHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71944" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a>, <a href="#72062" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72106" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <a href="#68985" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#72065" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupCustomersHist</a>, <a href="#72063" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="71953">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="72152">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>
      
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72153">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72154">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>
      
      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71148" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="72285">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72286">actualHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71940" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">homeWI</a>, <a href="#72285" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="72287">actualQuantile</a> = <a href="#72286" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#72152" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#72153" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#72287" title="=&gt; Long">actualQuantile</a>
        
        <span class="keyword">val</span> <a title="Int" id="72288">predictedQuantile</a> = <a href="#71952" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#72285" title="Int">i</a>, <a href="#72152" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#72154" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#72288" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#72285" title="Int">i</a>, <a href="#72287" title="Int">actualQuantile</a>, <a href="#72288" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      
      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#72153" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#72154" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
  
  <span class="comment">// yikes, doesn't work...</span>
  <span class="comment">// maybe not enough samples?</span>
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelNewProductWI" id="68964">ModelNewProductWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68958" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68956" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72334">newProductWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;newProductWI&quot;)" class="string">&quot;newProductWI&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(50)" class="int">50</span><span class="delimiter">)</span>, <span title="Int(50)" class="int">50</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72336">newProductWIHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72334" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">newProductWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.newProductWI.physicalPlan</span>
    <span class="comment">//res6: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: authors&gt;,List(AttributeValue(1,2)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: items&gt;,List(AttributeValue(0,2)),LocalStopAfter(ParameterLimit(1,50),</span>
    <span class="comment">//                                             IndexScan(&lt;Namespace: items_({&quot;fieldNames&quot;: [&quot;I_SUBJECT&quot;]},{&quot;fieldName&quot;: &quot;I_PUB_DATE&quot;})&gt;,List(ParameterValue(0)),ParameterLimit(1,50),false))))</span>
    
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72338">indexScanItemsIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanItemsIdx&quot;)" class="string">&quot;indexScanItemsIdx&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(50)" class="int">50</span><span class="delimiter">)</span>, <span title="Int(50)" class="int">50</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72340">indexScanItemsIdxHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72338" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanItemsIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72421" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72342">indexLookupJoinItems</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinItems&quot;)" class="string">&quot;indexLookupJoinItems&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(50)" class="int">50</span><span class="delimiter">)</span>, <span title="Int(50)" class="int">50</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72344">indexLookupJoinItemsHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72342" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinItems</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72506" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72346">indexLookupJoinAuthors</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAuthors&quot;)" class="string">&quot;indexLookupJoinAuthors&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(50)" class="int">50</span><span class="delimiter">)</span>, <span title="Int(50)" class="int">50</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72348">indexLookupJoinAuthorsHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72346" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72591" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="72350">predictHist</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="72638">res1</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#72340" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanItemsIdxHist</a>, <a href="#72344" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinItemsHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="72639">res2</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#72638" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#72348" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
      <a href="#72639" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="72351">actual99th</a> = <a href="#72336" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">newProductWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="72353">predicted99th</a> = <a href="#68985" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#72350" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="72355">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="72640">i</a>: <span title="Int">Int</span>, <a title="Double" id="72641">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72643">indexScanItemsIdxHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72338" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanItemsIdx</a>, <a href="#72640" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72688" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72644">indexLookupJoinItemsHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72342" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinItems</a>, <a href="#72640" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72772" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72645">indexLookupJoinAuthorsHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72346" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a>, <a href="#72640" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72856" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="72646">res1</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#72643" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanItemsIdxHist</a>, <a href="#72644" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinItemsHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="72647">res2</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#72646" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#72645" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
      <a href="#72647" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>

      <a href="#68985" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#72647" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#72641" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="72356">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="72902">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>
      
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72903">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72904">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>
      
      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71148" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="73035">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73036">actualHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72334" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">newProductWI</a>, <a href="#73035" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="73037">actualQuantile</a> = <a href="#73036" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#72902" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#72903" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#73037" title="=&gt; Long">actualQuantile</a>
        
        <span class="keyword">val</span> <a title="Int" id="73038">predictedQuantile</a> = <a href="#72355" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#73035" title="Int">i</a>, <a href="#72902" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#72904" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#73038" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#73035" title="Int">i</a>, <a href="#73037" title="Int">actualQuantile</a>, <a href="#73038" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      
      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#72903" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#72904" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelOrderDisplayGetCustomer" id="68966">ModelOrderDisplayGetCustomer</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68958" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68956" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73084">orderDisplayGetCustomer</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;orderDisplayGetCustomer&quot;)" class="string">&quot;orderDisplayGetCustomer&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73086">orderDisplayGetCustomerHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73084" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetCustomer</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.orderDisplayGetCustomer.physicalPlan</span>
    <span class="comment">//res11: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookup(&lt;Namespace: customers&gt;,ArrayBuffer(ParameterValue(0)))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73088">indexLookupCustomers</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupCustomers&quot;)" class="string">&quot;indexLookupCustomers&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73090">indexLookupCustomersHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73088" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="Int" id="73092">actual99th</a> = <a href="#73086" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">orderDisplayGetCustomerHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="73094">predicted99th</a> = <a href="#73090" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">indexLookupCustomersHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="73096">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="73143">i</a>: <span title="Int">Int</span>, <a title="Double" id="73144">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73146">indexLookupCustomersHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73088" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a>, <a href="#73143" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="#73146" title="edu.berkeley.cs.scads.perf.Histogram">indexLookupCustomersHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#73144" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
        
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="73097">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="73170">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73171">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73172">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71148" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="73303">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73304">actualHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73084" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetCustomer</a>, <a href="#73303" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="73305">actualQuantile</a> = <a href="#73304" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#73170" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#73171" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#73305" title="=&gt; Long">actualQuantile</a>

        <span class="keyword">val</span> <a title="Int" id="73306">predictedQuantile</a> = <a href="#73096" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#73303" title="Int">i</a>, <a href="#73170" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#73172" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#73306" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#73303" title="Int">i</a>, <a href="#73305" title="Int">actualQuantile</a>, <a href="#73306" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#73171" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#73172" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelOrderDisplayGetLastOrder" id="68968">ModelOrderDisplayGetLastOrder</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68958" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73351">orderDisplayGetLastOrder</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;orderDisplayGetLastOrder&quot;)" class="string">&quot;orderDisplayGetLastOrder&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>  <span class="comment">// queryName, params, resultCardinality</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73353">orderDisplayGetLastOrderHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73351" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetLastOrder</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; res3.orderDisplayGetLastOrder.physicalPlan</span>
    <span class="comment">//res4: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: countries&gt;,ArrayBuffer(AttributeValue(2,6)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: addresses&gt;,ArrayBuffer(AttributeValue(1,9)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: countries&gt;,ArrayBuffer(AttributeValue(2,6)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: addresses&gt;,ArrayBuffer(AttributeValue(1,8)),LocalStopAfter(FixedLimit(1),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: orders&gt;,ArrayBuffer(AttributeValue(0,2)),</span>
    <span class="comment">//                                             IndexScan(&lt;Namespace: orders_({&quot;fieldName&quot;: &quot;O_C_UNAME&quot;},{&quot;fieldName&quot;: &quot;O_DATE_Time&quot;})&gt;,ArrayBuffer(ParameterValue(0)),FixedLimit(1),false)))))))</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73355">indexScanOrdersIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanOrdersIdx&quot;)" class="string">&quot;indexScanOrdersIdx&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73357">indexScanOrdersIdxHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73355" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanOrdersIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73443" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73359">indexLookupJoinOrders</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinOrders&quot;)" class="string">&quot;indexLookupJoinOrders&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73361">indexLookupJoinOrdersHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73359" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinOrders</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73528" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73363">indexLookupJoinAddresses</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAddresses&quot;)" class="string">&quot;indexLookupJoinAddresses&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73365">indexLookupJoinAddressesHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73363" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAddresses</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73613" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73367">indexLookupJoinCountries</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinCountries&quot;)" class="string">&quot;indexLookupJoinCountries&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73369">indexLookupJoinCountriesHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73367" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinCountries</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73698" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="comment">//val predictedHist = indexLookupJoinCountriesHist convolveWith indexLookupJoinAddressesHist convolveWith indexLookupJoinCountriesHist convolveWith indexLookupJoinAddressesHist convolveWith indexLookupJoinOrdersHist convolveWith indexScanOrdersIdxHist</span>
    <span class="comment">// results in overflow.  instead, try per-interval prediction</span>
            
    <span class="keyword">import</span> <a href="#68956" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._

    <span class="comment">/*
    def predictHistBySampling = {
      val numSamples = orderDisplayGetLastOrderHist.totalRequests
      
      val predictedHist = Histogram(1,1000)
      
      (1 to numSamples).foreach(i =&gt; {
        val latencySample = 0
        latencySample += 
      })
    }
    */</span>

    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="73372">predictHist</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73745">res1</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73357" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanOrdersIdxHist</a>, <a href="#73361" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinOrdersHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73746">res2</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73745" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#73365" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73747">res3</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73746" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#73369" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73748">res4</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73747" title="scala.collection.mutable.ArrayBuffer[BigInt]">res3</a>, <a href="#73365" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73749">res5</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73748" title="scala.collection.mutable.ArrayBuffer[BigInt]">res4</a>, <a href="#73369" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <a href="#73749" title="scala.collection.mutable.ArrayBuffer[BigInt]">res5</a>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="73373">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="73750">i</a>: <span title="Int">Int</span>, <a title="Double" id="73751">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73753">indexScanOrdersIdxHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73355" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanOrdersIdx</a>, <a href="#73750" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73802" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73754">indexLookupJoinOrdersHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73359" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinOrders</a>, <a href="#73750" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73886" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73755">indexLookupJoinAddressesHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73363" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAddresses</a>, <a href="#73750" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73970" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73756">indexLookupJoinCountriesHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73367" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinCountries</a>, <a href="#73750" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74054" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73757">res1</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73753" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanOrdersIdxHist</a>, <a href="#73754" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinOrdersHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73758">res2</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73757" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#73755" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73759">res3</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73758" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#73756" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73760">res4</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73759" title="scala.collection.mutable.ArrayBuffer[BigInt]">res3</a>, <a href="#73755" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73761">predictedHist</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73760" title="scala.collection.mutable.ArrayBuffer[BigInt]">res4</a>, <a href="#73756" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>

      <a href="#68985" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#73761" title="scala.collection.mutable.ArrayBuffer[BigInt]">predictedHist</a>, <a href="#73751" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
        
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="73374">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="74100">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 50</span>

      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74101">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74102">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71148" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="74233">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74234">actualHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73351" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetLastOrder</a>, <a href="#74233" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="74235">actualQuantile</a> = <a href="#74234" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#74100" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#74101" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#74235" title="=&gt; Long">actualQuantile</a>

        <span class="keyword">val</span> <a title="Int" id="74236">predictedQuantile</a> = <a href="#73373" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#74233" title="Int">i</a>, <a href="#74100" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#74102" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#74236" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#74233" title="Int">i</a>, <a href="#74235" title="Int">actualQuantile</a>, <a href="#74236" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#74101" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#74102" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="73375">actual99th</a> = <a href="#73353" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">orderDisplayGetLastOrderHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="73377">predicted99th</a> = <a href="#68985" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#73372" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelOrderDisplayGetOrderLines" id="68970">ModelOrderDisplayGetOrderLines</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68958" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68956" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74282">orderDisplayGetOrderLines</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;orderDisplayGetOrderLines&quot;)" class="string">&quot;orderDisplayGetOrderLines&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(3)" class="int">3</span><span class="delimiter">)</span>  <span class="comment">// might want to fix this later so requested cardinality = result cardinality</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74284">orderDisplayGetOrderLinesHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74282" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetOrderLines</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.orderDisplayGetOrderLines.physicalPlan</span>
    <span class="comment">//res13: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: items&gt;,ArrayBuffer(AttributeValue(0,2)),LocalStopAfter(ParameterLimit(1,100),</span>
    <span class="comment">//                                              IndexScan(&lt;Namespace: orderLines&gt;,ArrayBuffer(ParameterValue(0)),ParameterLimit(1,100),true)))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74286">indexScanOrderLines</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanOrderLines&quot;)" class="string">&quot;indexScanOrderLines&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(3)" class="int">3</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74288">indexScanOrderLinesHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74286" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanOrderLines</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74365" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74290">indexLookupJoinItems</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinItems&quot;)" class="string">&quot;indexLookupJoinItems&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(3)" class="int">3</span><span class="delimiter">)</span>, <span title="Int(3)" class="int">3</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74292">indexLookupJoinItemsHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74290" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinItems</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74450" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="74294">predictHist</a> = <span class="delimiter">{</span>
      <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74288" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanOrderLinesHist</a>, <a href="#74292" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinItemsHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="74295">actual99th</a> = <a href="#74284" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">orderDisplayGetOrderLinesHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="74297">predicted99th</a> = <a href="#68985" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#74294" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="74299">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="74497">i</a>: <span title="Int">Int</span>, <a title="Double" id="74498">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74500">indexScanOrderLinesHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74286" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanOrderLines</a>, <a href="#74497" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74543" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74501">indexLookupJoinItemsHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74290" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinItems</a>, <a href="#74497" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74627" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="74502">predictedHist</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74500" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanOrderLinesHist</a>, <a href="#74501" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinItemsHist</a><span class="delimiter">)</span>
      
      <a href="#68985" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#74502" title="scala.collection.mutable.ArrayBuffer[BigInt]">predictedHist</a>, <a href="#74498" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="74300">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="74673">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>
      
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74674">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74675">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>
      
      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71148" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="74806">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74807">actualHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74282" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetOrderLines</a>, <a href="#74806" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="74808">actualQuantile</a> = <a href="#74807" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#74673" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#74674" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#74808" title="=&gt; Long">actualQuantile</a>
        
        <span class="keyword">val</span> <a title="Int" id="74809">predictedQuantile</a> = <a href="#74299" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#74806" title="Int">i</a>, <a href="#74673" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#74675" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#74809" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#74806" title="Int">i</a>, <a href="#74808" title="Int">actualQuantile</a>, <a href="#74809" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      
      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#74674" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#74675" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelProductDetailWI" id="68972">ModelProductDetailWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68958" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68956" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74855">productDetailWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;productDetailWI&quot;)" class="string">&quot;productDetailWI&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74857">productDetailWIHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74855" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">productDetailWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.productDetailWI.physicalPlan</span>
    <span class="comment">//res17: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: authors&gt;,ArrayBuffer(AttributeValue(0,2)),</span>
    <span class="comment">//                                              IndexLookup(&lt;Namespace: items&gt;,ArrayBuffer(ParameterValue(0))))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74859">indexLookupItems</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupItems&quot;)" class="string">&quot;indexLookupItems&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74861">indexLookupItemsHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74859" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupItems</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74938" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74863">indexLookupJoinAuthors</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAuthors&quot;)" class="string">&quot;indexLookupJoinAuthors&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74865">indexLookupJoinAuthorsHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74863" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75023" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="74867">predictHist</a> = <span class="delimiter">{</span>
      <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74861" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupItemsHist</a>, <a href="#74865" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="74868">actual99th</a> = <a href="#74857" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">productDetailWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="74870">predicted99th</a> = <a href="#68985" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#74867" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="74872">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="75070">i</a>: <span title="Int">Int</span>, <a title="Double" id="75071">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75073">indexLookupItemsHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74859" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupItems</a>, <a href="#75070" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75115" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75074">indexLookupJoinAuthorsHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74863" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a>, <a href="#75070" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75199" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="#68985" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#75073" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupItemsHist</a>, <a href="#75074" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>, <a href="#75071" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
        
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="74873">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="75245">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>

      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75246">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75247">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71148" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="75378">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75379">actualHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74855" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">productDetailWI</a>, <a href="#75378" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="75380">actualQuantile</a> = <a href="#75379" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#75245" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#75246" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#75380" title="=&gt; Long">actualQuantile</a>

        <span class="keyword">val</span> <a title="Int" id="75381">predictedQuantile</a> = <a href="#74872" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#75378" title="Int">i</a>, <a href="#75245" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#75247" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#75381" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#75378" title="Int">i</a>, <a href="#75380" title="Int">actualQuantile</a>, <a href="#75381" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#75246" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#75247" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>

  <span class="comment">// for some reason, I don't have data on this</span>
  <span class="comment">// will have to figure this out later</span>
  <span class="comment">// probably b/c in TpcwClient, there was no query name passed to toPiql</span>
  <span class="comment">// right now, only have a query description where shopping cart is empty b/c shopping cart is never getting populated</span>
  <span class="comment">// for now, postpone this</span>
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelRetrieveShoppingCart" id="68974">ModelRetrieveShoppingCart</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68958" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68956" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75427">retrieveShoppingCart</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;unnamed&quot;)" class="string">&quot;unnamed&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="comment">// &quot;unnamed&quot; b/c of bug in TpcwClient; 0 b/c not getting populated</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75429">retrieveShoppingCartHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75427" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">retrieveShoppingCart</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.retrieveShoppingCart.physicalPlan</span>
    <span class="comment">//res33: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: items&gt;,ArrayBuffer(AttributeValue(0,1)),</span>
    <span class="comment">//                                              LocalStopAfter(FixedLimit(1000),</span>
    <span class="comment">//                                              IndexScan(&lt;Namespace: shoppingCartItems&gt;,ArrayBuffer(ParameterValue(0)),FixedLimit(1000),true)))</span>
    
    
  <span class="delimiter">}</span>

  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelSearchByAuthorWI" id="68976">ModelSearchByAuthorWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68958" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68956" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75457">searchByAuthorWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;searchByAuthorWI&quot;)" class="string">&quot;searchByAuthorWI&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(10)" class="int">10</span><span class="delimiter">)</span> <span class="comment">// only one where requested cardinality = result cardinality</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75459">searchByAuthorWIHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75457" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">searchByAuthorWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.searchByAuthorWI.physicalPlan</span>
    <span class="comment">//res22: edu.berkeley.cs.scads.piql.QueryPlan = LocalStopAfter(ParameterLimit(1,50),</span>
    <span class="comment">//                                              IndexMergeJoin(&lt;Namespace: items_({&quot;fieldName&quot;: &quot;I_A_ID&quot;},{&quot;fieldName&quot;: &quot;I_TITLE&quot;})&gt;,List(AttributeValue(0,1)),List(AttributeValue(2,1)),ParameterLimit(1,50),true,</span>
    <span class="comment">//                                              IndexLookupJoin(&lt;Namespace: authors&gt;,List(AttributeValue(0,1)),LocalStopAfter(FixedLimit(50),</span>
    <span class="comment">//                                              IndexScan(&lt;Namespace: authors_({&quot;fieldNames&quot;: [&quot;A_FNAME&quot;, &quot;A_LNAME&quot;]})&gt;,List(ParameterValue(0)),FixedLimit(50),true)))))</span>
    
    <span class="comment">// I don't think we have the right benchmarks collected here.</span>
    <span class="comment">// I think we need the following:</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75461">indexScanAuthorsIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanAuthorsIdx&quot;)" class="string">&quot;indexScanAuthorsIdx&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>  <span class="comment">// i have this benchmark already</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75463">indexScanAuthorsIdxHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75461" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanAuthorsIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75544" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75465">indexLookupJoinAuthors</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAuthors&quot;)" class="string">&quot;indexLookupJoinAuthors&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="comment">// i NEED this</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75467">indexLookupJoinAuthorsHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75465" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75629" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75469">indexMergeJoinItemsIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexMergeJoinItemsIdx&quot;)" class="string">&quot;indexMergeJoinItemsIdx&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>, <span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(10)" class="int">10</span><span class="delimiter">)</span> <span class="comment">// i NEED this</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75471">indexMergeJoinItemsIdxHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75469" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexMergeJoinItemsIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75714" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="75473">predictHist</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="75761">res1</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#75463" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanAuthorsIdxHist</a>, <a href="#75467" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="75762">res2</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#75761" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#75471" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexMergeJoinItemsIdxHist</a><span class="delimiter">)</span>
      <a href="#75762" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="75474">actual99th</a> = <a href="#75459" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">searchByAuthorWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="75476">predicted99th</a> = <a href="#68985" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#75473" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="75478">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="75763">i</a>: <span title="Int">Int</span>, <a title="Double" id="75764">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75766">indexScanAuthorsIdxHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#75461" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanAuthorsIdx</a>, <a href="#75763" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75811" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75767">indexLookupJoinAuthorsHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#75465" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a>, <a href="#75763" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75895" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75768">indexMergeJoinItemsIdxHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#75469" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexMergeJoinItemsIdx</a>, <a href="#75763" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75979" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="75769">res1</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#75766" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanAuthorsIdxHist</a>, <a href="#75767" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="75770">res2</a> = <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#75769" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#75768" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexMergeJoinItemsIdxHist</a><span class="delimiter">)</span>
      <a href="#75770" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>

      <a href="#68985" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#75770" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#75764" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

     <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="75479">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="76060">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
       <span class="comment">//val numIntervals = 30</span>

       <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76061">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
       <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76062">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

       <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

       <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71148" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="76193">i</a> =&gt; <span class="delimiter">{</span>
         <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76194">actualHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#75457" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">searchByAuthorWI</a>, <a href="#76193" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
         <span class="keyword">val</span> <a title="Int" id="76195">actualQuantile</a> = <a href="#76194" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#76060" title="Double">quantile</a><span class="delimiter">)</span>
         <a href="#76061" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#76195" title="=&gt; Long">actualQuantile</a>

         <span class="keyword">val</span> <a title="Int" id="76196">predictedQuantile</a> = <a href="#75478" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#76193" title="Int">i</a>, <a href="#76060" title="Double">quantile</a><span class="delimiter">)</span>
         <a href="#76062" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#76196" title="=&gt; Long">predictedQuantile</a>

         <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#76193" title="Int">i</a>, <a href="#76195" title="Int">actualQuantile</a>, <a href="#76196" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
       <span class="delimiter">}</span><span class="delimiter">)</span>

       <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#76061" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#76062" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
     <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelSearchByTitleWI" id="68978">ModelSearchByTitleWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68958" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68956" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="76242">searchByTitleWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;searchByTitleWI&quot;)" class="string">&quot;searchByTitleWI&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(7)" class="int">7</span><span class="comment">/*9*/</span><span class="delimiter">)</span>  <span class="comment">// want to make requested, result cardinalities match</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76244">searchByTitleWIHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#76242" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">searchByTitleWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.searchByTitleWI.physicalPlan</span>
    <span class="comment">//res26: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: authors&gt;,List(AttributeValue(0,2)),LocalStopAfter(ParameterLimit(1,50),</span>
    <span class="comment">//                                              IndexScan(&lt;Namespace: items_({&quot;fieldNames&quot;: [&quot;I_TITLE&quot;]},{&quot;fieldName&quot;: &quot;I_TITLE&quot;},{&quot;fieldName&quot;: &quot;I_A_ID&quot;})&gt;,List(ParameterValue(0)),ParameterLimit(1,50),true)))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="76246">indexScanItemsIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanItemsIdx&quot;)" class="string">&quot;indexScanItemsIdx&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(9)" class="int">9</span><span class="delimiter">)</span>, <span title="Int(9)" class="int">9</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76248">indexScanItemsIdxHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#76246" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanItemsIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76325" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="76250">indexLookupJoinAuthors</a> = <a href="../collection/QueryRunnerTask.scala.html#37842" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAuthors&quot;)" class="string">&quot;indexLookupJoinAuthors&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(9)" class="int">9</span><span class="delimiter">)</span>, <span title="Int(9)" class="int">9</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76252">indexLookupJoinAuthorsHist</a> = <a href="#71151" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#76250" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76406" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="76254">predictHist</a> = <span class="delimiter">{</span>
      <a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#76248" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanItemsIdxHist</a>, <a href="#76252" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="76255">actual99th</a> = <a href="#76244" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">searchByTitleWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="76257">predicted99th</a> = <a href="#68985" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#76254" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="76259">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="76449">i</a>: <span title="Int">Int</span>, <a title="Double" id="76450">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76452">indexScanItemsIdxHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#76246" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanItemsIdx</a>, <a href="#76449" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76494" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76453">indexLookupJoinAuthorsHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#76250" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a>, <a href="#76449" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76574" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

       <a href="#68985" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#68982" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#76452" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanItemsIdxHist</a>, <a href="#76453" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>, <a href="#76450" title="Double">desiredQuantile</a><span class="delimiter">)</span>
     <span class="delimiter">}</span>

     <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="76260">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="76616">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
       <span class="comment">//val numIntervals = 30</span>

       <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76617">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
       <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76618">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

       <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

       <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71148" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="76749">i</a> =&gt; <span class="delimiter">{</span>
         <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76750">actualHist</a> = <a href="#71153" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#76242" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">searchByTitleWI</a>, <a href="#76749" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
         <span class="keyword">val</span> <a title="Int" id="76751">actualQuantile</a> = <a href="#76750" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#76616" title="Double">quantile</a><span class="delimiter">)</span>
         <a href="#76617" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#76751" title="=&gt; Long">actualQuantile</a>

         <span class="keyword">val</span> <a title="Int" id="76752">predictedQuantile</a> = <a href="#76259" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#76749" title="Int">i</a>, <a href="#76616" title="Double">quantile</a><span class="delimiter">)</span>
         <a href="#76618" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#76752" title="=&gt; Long">predictedQuantile</a>

         <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#76749" title="Int">i</a>, <a href="#76751" title="Int">actualQuantile</a>, <a href="#76752" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
       <span class="delimiter">}</span><span class="delimiter">)</span>

       <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#76617" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#76618" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
     <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
<span class="delimiter">}</span>
        </pre>
    </body>
</html>