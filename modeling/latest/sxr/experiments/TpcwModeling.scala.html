<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>experiments/TpcwModeling.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs
<span class="keyword">package</span> scads
<span class="keyword">package</span> piql
<span class="keyword">package</span> modeling

<span class="keyword">import</span> comm._
<span class="keyword">import</span> storage._
<span class="keyword">import</span> perf._
<span class="keyword">import</span> deploylib.ec2._
<span class="keyword">import</span> deploylib.mesos._
<span class="keyword">import</span> piql.scadr._
<span class="keyword">import</span> perf.scadr._
<span class="keyword">import</span> avro.marker._
<span class="keyword">import</span> avro.runtime._
<span class="keyword">import</span> <a href="ExperimentUtil.scala.html#10195" title="object edu.berkeley.cs.scads.piql.modeling.ExperimentUtil">ExperimentUtil</a>._
<span class="keyword">import</span> scala.collection.mutable.ArrayBuffer

<span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling" id="10264">TpcwModeling</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util" id="68971">Util</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(summary: (edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram))Unit" id="68996">printPerIterationPredictionSummary</a><span class="delimiter">(</span><a title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="70571">summary</a>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="70574">actualHist</a> = <a href="#70571" title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)">summary</a>.<span title="=&gt; edu.berkeley.cs.scads.perf.Histogram">_1</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="70575">predictedHist</a> = <a href="#70571" title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)">summary</a>.<span title="=&gt; edu.berkeley.cs.scads.perf.Histogram">_2</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Any*)List[Any]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Actual:&quot;)" class="string">&quot;Actual:&quot;</span>, <span title="java.lang.String(&quot;average=&quot;)" class="string">&quot;average=&quot;</span>, <a href="#70574" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="=&gt; Double">average</span>, <span title="java.lang.String(&quot;median=&quot;)" class="string">&quot;median=&quot;</span>, <a href="#70574" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="=&gt; Int">median</span>, <span title="java.lang.String(&quot;stddev=&quot;)" class="string">&quot;stddev=&quot;</span>, <a href="#70574" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="=&gt; Double">stddev</span>, <span title="java.lang.String(&quot;max=&quot;)" class="string">&quot;max=&quot;</span>, <a href="#70574" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Any*)List[Any]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Predicted:&quot;)" class="string">&quot;Predicted:&quot;</span>, <span title="java.lang.String(&quot;average=&quot;)" class="string">&quot;average=&quot;</span>, <a href="#70575" title="edu.berkeley.cs.scads.perf.Histogram">predictedHist</a>.<span title="=&gt; Double">average</span>, <span title="java.lang.String(&quot;median=&quot;)" class="string">&quot;median=&quot;</span>, <a href="#70575" title="edu.berkeley.cs.scads.perf.Histogram">predictedHist</a>.<span title="=&gt; Int">median</span>, <span title="java.lang.String(&quot;stddev=&quot;)" class="string">&quot;stddev=&quot;</span>, <a href="#70575" title="edu.berkeley.cs.scads.perf.Histogram">predictedHist</a>.<span title="=&gt; Double">stddev</span>, <span title="java.lang.String(&quot;max=&quot;)" class="string">&quot;max=&quot;</span>, <a href="#70575" title="edu.berkeley.cs.scads.perf.Histogram">predictedHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  	<span class="keyword">def</span> <a title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]" id="68997">convolve</a><span class="delimiter">(</span><a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="69634">hist1</a>: <span title="scala.collection.mutable.ArrayBuffer[BigInt]">ArrayBuffer</span><span class="delimiter">[</span>BigInt<span class="delimiter">]</span>, <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="69635">hist2</a>: <span title="scala.collection.mutable.ArrayBuffer[BigInt]">ArrayBuffer</span><span class="delimiter">[</span>BigInt<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scala.collection.mutable.ArrayBuffer[BigInt]">ArrayBuffer</span><span class="delimiter">[</span>BigInt<span class="delimiter">]</span> = <span class="delimiter">{</span>
  	  <span class="keyword">var</span> <a title="Int" id="70609">defaultBucketCount</a> = <span title="Int(1000)" class="int">1000</span>

  	  <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="70610">result</a> = <span title="object scala.collection.mutable.ArrayBuffer">ArrayBuffer</span>.<span title="(n: Int)(elem: =&gt; scala.math.BigInt)scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">fill</span><span class="delimiter">(</span><a href="#70609" title="Int">defaultBucketCount</a><span class="delimiter">)</span><span class="delimiter">(</span><span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>

  	  <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#70609" title="Int">defaultBucketCount</a><span title="(x: Int)Int">-</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="70791">i</a> =&gt; <span class="delimiter">{</span>
  	    <span class="keyword">var</span> <a title="scala.math.BigInt" id="70792">integralOfOverlap</a> = <span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>

        <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#70791" title="Int">i</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="70913">j</a> =&gt; <span class="delimiter">{</span>
          <a href="#70792" title="scala.math.BigInt">integralOfOverlap</a> <span title="(that: scala.math.BigInt)scala.math.BigInt">+=</span> <a href="#69634" title="(idx: Int)BigInt">hist1</a><span class="delimiter">(</span><a href="#70791" title="Int">i</a><span title="(x: Int)Int">-</span><a href="#70913" title="Int">j</a><span class="delimiter">)</span> <span title="(that: scala.math.BigInt)scala.math.BigInt">*</span> <a href="#69635" title="(idx: Int)BigInt">hist2</a><span class="delimiter">(</span><a href="#70913" title="Int">j</a><span class="delimiter">)</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>

        <a href="#70610" title="(idx: Int, elem: scala.math.BigInt)Unit">result</a><span class="delimiter">(</span><a href="#70791" title="Int">i</a><span class="delimiter">)</span> = <a href="#70792" title="scala.math.BigInt">integralOfOverlap</a>
  	  <span class="delimiter">}</span><span class="delimiter">)</span>

  	  <a href="#70610" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">result</a>
  	<span class="delimiter">}</span>
  	
  	<span class="comment">// default bucket size is 1</span>
  	<span class="keyword">val</span> <a title="Int" id="68998">bucketSize</a> = <span title="Int(1)" class="int">1</span>
  	<span class="keyword">def</span> <a title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int" id="69000">quantile</a><span class="delimiter">(</span><a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="69627">hist</a>: <span title="scala.collection.mutable.ArrayBuffer[BigInt]">ArrayBuffer</span><span class="delimiter">[</span>BigInt<span class="delimiter">]</span>, <a title="Double" id="69628">quantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
  	  <span class="keyword">val</span> <a title="Int" id="70993">quantileAsInt</a> = <span class="delimiter">(</span><a href="#69628" title="Double">quantile</a> <span title="(x: Int)Double">*</span> <span title="Int(100)" class="int">100</span><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span>  <span class="comment">// convert to percentage; still receive input as percentage to maintain consistency with Histogram's version</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="70994">cumulativeSum</a> = <a href="#69627" title="scala.collection.mutable.ArrayBuffer[BigInt]">hist</a>.<span title="(z: scala.math.BigInt)(op: (scala.math.BigInt, BigInt) =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[BigInt],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">scanLeft</span><span class="delimiter">(</span><span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><a href="#71028" title="scala.math.BigInt">_</a> <span title="(that: scala.math.BigInt)scala.math.BigInt">+</span> <a href="#71029" title="BigInt">_</a><span class="delimiter">)</span>.<span title="(n: Int)scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">drop</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span title="Int" class="keyword">if</span><span class="delimiter">(</span><a href="#69627" title="scala.collection.mutable.ArrayBuffer[BigInt]">hist</a>.<span title="(implicit num: Numeric[BigInt])BigInt">sum</span> <span title="(that: scala.math.BigInt)Boolean">&gt;</span> <span title="implicit scala.math.BigInt.int2bigInt : (i: Int)scala.math.BigInt" class="int">0</span><span class="delimiter">)</span>
        <a href="#70994" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">cumulativeSum</a>.<span title="(p: scala.math.BigInt =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#71108" title="scala.math.BigInt">_</a> <span title="(that: scala.math.BigInt)Boolean">&gt;=</span> <a href="#69627" title="scala.collection.mutable.ArrayBuffer[BigInt]">hist</a>.<span title="(implicit num: Numeric[BigInt])BigInt">sum</span> <span title="(that: scala.math.BigInt)scala.math.BigInt">*</span> <span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#70993" title="Int">quantileAsInt</a><span class="delimiter">)</span><span title="(that: scala.math.BigInt)scala.math.BigInt">/</span><span title="(i: Int)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><span title="Int(100)" class="int">100</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x: Int)Int">*</span> <a href="#68998" title="=&gt; Int">bucketSize</a>
      <span class="keyword">else</span>
        <span title="Int(0)" class="int">0</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(actual: Double, predicted: Double)Unit" id="69001">printActualAndPredicted</a><span class="delimiter">(</span><a title="Double" id="71134">actual</a>:<span title="Double">Double</span>, <a title="Double" id="71135">predicted</a>:<span title="Double">Double</span><span class="delimiter">)</span> = <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Any*)List[Any]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;actual=&quot;)" class="string">&quot;actual=&quot;</span>, <a href="#71134" title="Double">actual</a>, <span title="java.lang.String(&quot;predicted=&quot;)" class="string">&quot;predicted=&quot;</span>, <a href="#71135" title="Double">predicted</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  
    <span class="comment">/*
    def average(hist: ArrayBuffer[BigInt]) = {
      val n = hist.sum
      hist.zipWithIndex.foldLeft(BigInt(0)) { case (acc, (num, idx)) =&gt; acc + num * idx * bucketSize / n }
    }

    /**
     * Sample standard deviation based off of sqrt(1/(N-1)*sum((Xi-mean(X))^2))
     */
    def stddev(hist: ArrayBuffer[BigInt]) = {
      val n = hist.sum
      val xbar = average(hist)
      import scala.math._
      val a = hist.zipWithIndex.foldLeft(BigInt(0)) { case (acc, (num, idx)) =&gt; acc + num * (BigInt(idx) * bucketSize - xbar) * (BigInt(idx) * bucketSize - xbar) }
      sqrt(BigInt(1) / (n - BigInt(1)) * a.toDouble)  // causes compile error
    }
    */</span>
  
  <span class="delimiter">}</span>

  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData" id="68973">TpcwData</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="comment">//val clusterAddress = &quot;zk://zoo.knowsql.org/home/kcurtis/scads/experimentCluster0000000008&quot;</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-75-101-230-218.compute-1.amazonaws.com:2181,ec2-50-19-23-28.compute-1.amazonaws.com:2181,ec2-67-202-16-139.compute-1.amazonaws.com:2181/scads/experimentCluster0000000000&quot;</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-50-16-25-212.compute-1.amazonaws.com:2181,ec2-67-202-10-38.compute-1.amazonaws.com:2181,ec2-174-129-128-67.compute-1.amazonaws.com:2181/scads/experimentCluster0000000000&quot;</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-50-19-140-43.compute-1.amazonaws.com:2181,ec2-72-44-35-240.compute-1.amazonaws.com:2181,ec2-50-17-68-210.compute-1.amazonaws.com:2181/scads/experimentCluster0000000000&quot;</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-174-129-157-147.compute-1.amazonaws.com:2181,ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181/scads/experimentCluster0000000000&quot; // 5.26.11, afternoon</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-174-129-157-147.compute-1.amazonaws.com:2181,ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181/scads/experimentCluster0000000007&quot; // 5.27.11, 3p (blocking)</span>
    <span class="comment">//val clusterAddress = &quot;zk://ec2-174-129-157-147.compute-1.amazonaws.com:2181,ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181/scads/experimentCluster0000000027&quot;</span>
    <span class="keyword">val</span> <a title="java.lang.String" id="71160">clusterAddress</a> = <span title="java.lang.String(&quot;zk://ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181,ec2-174-129-157-147.compute-1.amazonaws.com:2181/scads/experimentCluster0000000065&quot;)" class="string">&quot;zk://ec2-50-17-12-53.compute-1.amazonaws.com:2181,ec2-184-72-171-124.compute-1.amazonaws.com:2181,ec2-174-129-157-147.compute-1.amazonaws.com:2181/scads/experimentCluster0000000065&quot;</span>

    <span class="keyword">def</span> <a title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]" id="71162">experimentResults</a> = <a href="ExperimentUtil.scala.html#50000" title="=&gt; org.apache.avro.file.DataFileReader[edu.berkeley.cs.scads.piql.modeling.Result] with Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">allResults</a>.<span title="(p: edu.berkeley.cs.scads.piql.modeling.Result =&gt; Boolean)Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">filter</span><span class="delimiter">(</span><a href="#71179" title="edu.berkeley.cs.scads.piql.modeling.Result">_</a>.<a href="../collection/QueryRunnerTask.scala.html#37930" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryRunnerTask">clientConfig</a>.<a href="../collection/QueryRunnerTask.scala.html#38015" title="=&gt; String">clusterAddress</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#71160" title="=&gt; java.lang.String">clusterAddress</a><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="Int" id="71163">numIntervals</a> = <span title="Int(35)" class="int">35</span>
    <span class="keyword">def</span> <a title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]" id="71165">goodExperimentResults</a> = <a href="#71162" title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">experimentResults</a>.<span title="(p: edu.berkeley.cs.scads.piql.modeling.Result =&gt; Boolean)Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">filter</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.modeling.Result" id="71188">res</a> =&gt; <a href="#71188" title="edu.berkeley.cs.scads.piql.modeling.Result">res</a>.<a href="../collection/QueryRunnerTask.scala.html#37927" title="=&gt; Int">iteration</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(1)" class="int">1</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#71188" title="edu.berkeley.cs.scads.piql.modeling.Result">res</a>.<a href="../collection/QueryRunnerTask.scala.html#37927" title="=&gt; Int">iteration</a> <span title="(x: Int)Boolean">&lt;=</span> <a href="#71163" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>
        
    <span class="keyword">val</span> <a title="scala.collection.immutable.Map[edu.berkeley.cs.scads.piql.modeling.QueryDescription,edu.berkeley.cs.scads.perf.Histogram]" id="71166">histogramsTpcw</a> = <a href="ExperimentUtil.scala.html#50013" title="(results: Seq[edu.berkeley.cs.scads.piql.modeling.Result])scala.collection.immutable.Map[edu.berkeley.cs.scads.piql.modeling.QueryDescription,edu.berkeley.cs.scads.perf.Histogram]">queryTypeHistogram</a><span class="delimiter">(</span><a href="#71165" title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">goodExperimentResults</a>.<span title="=&gt; Seq[edu.berkeley.cs.scads.piql.modeling.Result]">toSeq</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="scala.collection.immutable.Map[(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int),edu.berkeley.cs.scads.perf.Histogram]" id="71168">perIterationHistograms</a> = <a href="ExperimentUtil.scala.html#50016" title="(results: Seq[edu.berkeley.cs.scads.piql.modeling.Result])scala.collection.immutable.Map[(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int),edu.berkeley.cs.scads.perf.Histogram]">queryTypePerIterationHistograms</a><span class="delimiter">(</span><a href="#71165" title="=&gt; Iterator[edu.berkeley.cs.scads.piql.modeling.Result]">goodExperimentResults</a>.<span title="=&gt; Seq[edu.berkeley.cs.scads.piql.modeling.Result]">toSeq</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelBuyRequestExistingCustomerWI" id="68975">ModelBuyRequestExistingCustomerWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68973" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68971" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71202">buyRequestExistingCustomerWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;buyRequestExistingCustomerWI&quot;)" class="string">&quot;buyRequestExistingCustomerWI&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="71204">buyRequestExistingCustomerWIHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71202" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">buyRequestExistingCustomerWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.buyRequestExistingCustomerWI.physicalPlan</span>
    <span class="comment">//res4: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: countries&gt;,ArrayBuffer(AttributeValue(1,6)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: addresses&gt;,ArrayBuffer(AttributeValue(0,4)),</span>
    <span class="comment">//                                             IndexLookup(&lt;Namespace: customers&gt;,ArrayBuffer(ParameterValue(0)))))</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71206">indexLookupCustomers</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupCustomers&quot;)" class="string">&quot;indexLookupCustomers&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71208">indexLookupCustomersHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71206" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71289" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71210">indexLookupJoinAddresses</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAddresses&quot;)" class="string">&quot;indexLookupJoinAddresses&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71212">indexLookupJoinAddressesHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71210" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAddresses</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71377" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71214">indexLookupJoinCountries</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinCountries&quot;)" class="string">&quot;indexLookupJoinCountries&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71216">indexLookupJoinCountriesHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71214" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinCountries</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71462" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="71218">predictHist</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="71509">res1</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#71208" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupCustomersHist</a>, <a href="#71212" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="71510">res2</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#71509" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#71216" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <a href="#71510" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="71219">actual99th</a> = <a href="#71204" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">buyRequestExistingCustomerWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="71221">predicted99th</a> = <a href="#69000" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#71218" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="71223">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="71511">i</a>: <span title="Int">Int</span>, <a title="Double" id="71512">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71514">indexLookupCustomersHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71206" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a>, <a href="#71511" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71559" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71515">indexLookupJoinAddressesHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71210" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAddresses</a>, <a href="#71511" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71643" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71516">indexLookupJoinCountriesHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71214" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinCountries</a>, <a href="#71511" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#71727" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="71517">res1</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#71514" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupCustomersHist</a>, <a href="#71515" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="71518">res2</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#71517" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#71516" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <a href="#71518" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>

      <a href="#69000" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#71518" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#71512" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="71224">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="71773">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>
      
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="71774">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="71775">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>
      
      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71163" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="71906">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="71907">actualHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71202" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">buyRequestExistingCustomerWI</a>, <a href="#71906" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="71908">actualQuantile</a> = <a href="#71907" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#71773" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#71774" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#71908" title="=&gt; Long">actualQuantile</a>
        
        <span class="keyword">val</span> <a title="Int" id="71909">predictedQuantile</a> = <a href="#71223" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#71906" title="Int">i</a>, <a href="#71773" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#71775" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#71909" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#71906" title="Int">i</a>, <a href="#71908" title="Int">actualQuantile</a>, <a href="#71909" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      
      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#71774" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#71775" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelHomeWI" id="68977">ModelHomeWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68973" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68971" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71955">homeWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;homeWI&quot;)" class="string">&quot;homeWI&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="71957">homeWIHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71955" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">homeWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.homeWI.physicalPlan</span>
    <span class="comment">//res3: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookup(&lt;Namespace: customers&gt;,ArrayBuffer(ParameterValue(0)))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="71959">indexLookupCustomers</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupCustomers&quot;)" class="string">&quot;indexLookupCustomers&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="71961">indexLookupCustomersHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#71959" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72033" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="Int" id="71963">actual99th</a> = <a href="#71957" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">homeWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="71965">predicted99th</a> = <a href="#69000" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#71961" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupCustomersHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="71967">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="72077">i</a>: <span title="Int">Int</span>, <a title="Double" id="72078">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72080">indexLookupCustomersHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71959" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a>, <a href="#72077" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72121" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <a href="#69000" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#72080" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupCustomersHist</a>, <a href="#72078" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="71968">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="72167">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>
      
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72168">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72169">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>
      
      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71163" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="72300">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72301">actualHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#71955" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">homeWI</a>, <a href="#72300" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="72302">actualQuantile</a> = <a href="#72301" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#72167" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#72168" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#72302" title="=&gt; Long">actualQuantile</a>
        
        <span class="keyword">val</span> <a title="Int" id="72303">predictedQuantile</a> = <a href="#71967" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#72300" title="Int">i</a>, <a href="#72167" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#72169" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#72303" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#72300" title="Int">i</a>, <a href="#72302" title="Int">actualQuantile</a>, <a href="#72303" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      
      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#72168" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#72169" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
  
  <span class="comment">// yikes, doesn't work...</span>
  <span class="comment">// maybe not enough samples?</span>
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelNewProductWI" id="68979">ModelNewProductWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68973" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68971" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72349">newProductWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;newProductWI&quot;)" class="string">&quot;newProductWI&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(50)" class="int">50</span><span class="delimiter">)</span>, <span title="Int(50)" class="int">50</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72351">newProductWIHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72349" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">newProductWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.newProductWI.physicalPlan</span>
    <span class="comment">//res6: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: authors&gt;,List(AttributeValue(1,2)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: items&gt;,List(AttributeValue(0,2)),LocalStopAfter(ParameterLimit(1,50),</span>
    <span class="comment">//                                             IndexScan(&lt;Namespace: items_({&quot;fieldNames&quot;: [&quot;I_SUBJECT&quot;]},{&quot;fieldName&quot;: &quot;I_PUB_DATE&quot;})&gt;,List(ParameterValue(0)),ParameterLimit(1,50),false))))</span>
    
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72353">indexScanItemsIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanItemsIdx&quot;)" class="string">&quot;indexScanItemsIdx&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(50)" class="int">50</span><span class="delimiter">)</span>, <span title="Int(50)" class="int">50</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72355">indexScanItemsIdxHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72353" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanItemsIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72436" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72357">indexLookupJoinItems</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinItems&quot;)" class="string">&quot;indexLookupJoinItems&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(50)" class="int">50</span><span class="delimiter">)</span>, <span title="Int(50)" class="int">50</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72359">indexLookupJoinItemsHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72357" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinItems</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72521" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="72361">indexLookupJoinAuthors</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAuthors&quot;)" class="string">&quot;indexLookupJoinAuthors&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(50)" class="int">50</span><span class="delimiter">)</span>, <span title="Int(50)" class="int">50</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72363">indexLookupJoinAuthorsHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#72361" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72606" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="72365">predictHist</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="72653">res1</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#72355" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanItemsIdxHist</a>, <a href="#72359" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinItemsHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="72654">res2</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#72653" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#72363" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
      <a href="#72654" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="72366">actual99th</a> = <a href="#72351" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">newProductWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="72368">predicted99th</a> = <a href="#69000" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#72365" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="72370">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="72655">i</a>: <span title="Int">Int</span>, <a title="Double" id="72656">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72658">indexScanItemsIdxHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72353" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanItemsIdx</a>, <a href="#72655" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72703" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72659">indexLookupJoinItemsHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72357" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinItems</a>, <a href="#72655" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72787" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="72660">indexLookupJoinAuthorsHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72361" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a>, <a href="#72655" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#72871" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="72661">res1</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#72658" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanItemsIdxHist</a>, <a href="#72659" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinItemsHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="72662">res2</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#72661" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#72660" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
      <a href="#72662" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>

      <a href="#69000" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#72662" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#72656" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="72371">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="72917">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>
      
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72918">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="72919">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>
      
      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71163" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="73050">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73051">actualHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#72349" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">newProductWI</a>, <a href="#73050" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="73052">actualQuantile</a> = <a href="#73051" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#72917" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#72918" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#73052" title="=&gt; Long">actualQuantile</a>
        
        <span class="keyword">val</span> <a title="Int" id="73053">predictedQuantile</a> = <a href="#72370" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#73050" title="Int">i</a>, <a href="#72917" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#72919" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#73053" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#73050" title="Int">i</a>, <a href="#73052" title="Int">actualQuantile</a>, <a href="#73053" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      
      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#72918" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#72919" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelOrderDisplayGetCustomer" id="68981">ModelOrderDisplayGetCustomer</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68973" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68971" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73099">orderDisplayGetCustomer</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;orderDisplayGetCustomer&quot;)" class="string">&quot;orderDisplayGetCustomer&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73101">orderDisplayGetCustomerHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73099" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetCustomer</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.orderDisplayGetCustomer.physicalPlan</span>
    <span class="comment">//res11: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookup(&lt;Namespace: customers&gt;,ArrayBuffer(ParameterValue(0)))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73103">indexLookupCustomers</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupCustomers&quot;)" class="string">&quot;indexLookupCustomers&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73105">indexLookupCustomersHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73103" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="Int" id="73107">actual99th</a> = <a href="#73101" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">orderDisplayGetCustomerHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="73109">predicted99th</a> = <a href="#73105" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">indexLookupCustomersHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="73111">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="73158">i</a>: <span title="Int">Int</span>, <a title="Double" id="73159">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73161">indexLookupCustomersHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73103" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupCustomers</a>, <a href="#73158" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="#73161" title="edu.berkeley.cs.scads.perf.Histogram">indexLookupCustomersHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#73159" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
        
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="73112">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="73185">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73186">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73187">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71163" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="73318">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73319">actualHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73099" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetCustomer</a>, <a href="#73318" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="73320">actualQuantile</a> = <a href="#73319" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#73185" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#73186" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#73320" title="=&gt; Long">actualQuantile</a>

        <span class="keyword">val</span> <a title="Int" id="73321">predictedQuantile</a> = <a href="#73111" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#73318" title="Int">i</a>, <a href="#73185" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#73187" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#73321" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#73318" title="Int">i</a>, <a href="#73320" title="Int">actualQuantile</a>, <a href="#73321" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#73186" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#73187" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelOrderDisplayGetLastOrder" id="68983">ModelOrderDisplayGetLastOrder</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68973" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73366">orderDisplayGetLastOrder</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;orderDisplayGetLastOrder&quot;)" class="string">&quot;orderDisplayGetLastOrder&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>  <span class="comment">// queryName, params, resultCardinality</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="73368">orderDisplayGetLastOrderHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73366" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetLastOrder</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; res3.orderDisplayGetLastOrder.physicalPlan</span>
    <span class="comment">//res4: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: countries&gt;,ArrayBuffer(AttributeValue(2,6)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: addresses&gt;,ArrayBuffer(AttributeValue(1,9)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: countries&gt;,ArrayBuffer(AttributeValue(2,6)),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: addresses&gt;,ArrayBuffer(AttributeValue(1,8)),LocalStopAfter(FixedLimit(1),</span>
    <span class="comment">//                                             IndexLookupJoin(&lt;Namespace: orders&gt;,ArrayBuffer(AttributeValue(0,2)),</span>
    <span class="comment">//                                             IndexScan(&lt;Namespace: orders_({&quot;fieldName&quot;: &quot;O_C_UNAME&quot;},{&quot;fieldName&quot;: &quot;O_DATE_Time&quot;})&gt;,ArrayBuffer(ParameterValue(0)),FixedLimit(1),false)))))))</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73370">indexScanOrdersIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanOrdersIdx&quot;)" class="string">&quot;indexScanOrdersIdx&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73372">indexScanOrdersIdxHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73370" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanOrdersIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73458" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73374">indexLookupJoinOrders</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinOrders&quot;)" class="string">&quot;indexLookupJoinOrders&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73376">indexLookupJoinOrdersHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73374" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinOrders</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73543" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73378">indexLookupJoinAddresses</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAddresses&quot;)" class="string">&quot;indexLookupJoinAddresses&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73380">indexLookupJoinAddressesHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73378" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAddresses</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73628" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="73382">indexLookupJoinCountries</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinCountries&quot;)" class="string">&quot;indexLookupJoinCountries&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73384">indexLookupJoinCountriesHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#73382" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinCountries</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73713" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="comment">//val predictedHist = indexLookupJoinCountriesHist convolveWith indexLookupJoinAddressesHist convolveWith indexLookupJoinCountriesHist convolveWith indexLookupJoinAddressesHist convolveWith indexLookupJoinOrdersHist convolveWith indexScanOrdersIdxHist</span>
    <span class="comment">// results in overflow.  instead, try per-interval prediction</span>
            
    <span class="keyword">import</span> <a href="#68971" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._

    <span class="comment">/*
    def predictHistBySampling = {
      val numSamples = orderDisplayGetLastOrderHist.totalRequests
      
      val predictedHist = Histogram(1,1000)
      
      (1 to numSamples).foreach(i =&gt; {
        val latencySample = 0
        latencySample += 
      })
    }
    */</span>

    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="73387">predictHist</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73760">res1</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73372" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanOrdersIdxHist</a>, <a href="#73376" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinOrdersHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73761">res2</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73760" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#73380" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73762">res3</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73761" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#73384" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73763">res4</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73762" title="scala.collection.mutable.ArrayBuffer[BigInt]">res3</a>, <a href="#73380" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73764">res5</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73763" title="scala.collection.mutable.ArrayBuffer[BigInt]">res4</a>, <a href="#73384" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <a href="#73764" title="scala.collection.mutable.ArrayBuffer[BigInt]">res5</a>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="73388">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="73765">i</a>: <span title="Int">Int</span>, <a title="Double" id="73766">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73768">indexScanOrdersIdxHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73370" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanOrdersIdx</a>, <a href="#73765" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73817" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73769">indexLookupJoinOrdersHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73374" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinOrders</a>, <a href="#73765" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73901" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73770">indexLookupJoinAddressesHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73378" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAddresses</a>, <a href="#73765" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#73985" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="73771">indexLookupJoinCountriesHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73382" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinCountries</a>, <a href="#73765" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74069" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73772">res1</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73768" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanOrdersIdxHist</a>, <a href="#73769" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinOrdersHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73773">res2</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73772" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#73770" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73774">res3</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73773" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#73771" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73775">res4</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73774" title="scala.collection.mutable.ArrayBuffer[BigInt]">res3</a>, <a href="#73770" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAddressesHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="73776">predictedHist</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#73775" title="scala.collection.mutable.ArrayBuffer[BigInt]">res4</a>, <a href="#73771" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinCountriesHist</a><span class="delimiter">)</span>

      <a href="#69000" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#73776" title="scala.collection.mutable.ArrayBuffer[BigInt]">predictedHist</a>, <a href="#73766" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
        
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="73389">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="74115">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 50</span>

      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74116">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74117">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71163" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="74248">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74249">actualHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#73366" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetLastOrder</a>, <a href="#74248" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="74250">actualQuantile</a> = <a href="#74249" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#74115" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#74116" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#74250" title="=&gt; Long">actualQuantile</a>

        <span class="keyword">val</span> <a title="Int" id="74251">predictedQuantile</a> = <a href="#73388" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#74248" title="Int">i</a>, <a href="#74115" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#74117" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#74251" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#74248" title="Int">i</a>, <a href="#74250" title="Int">actualQuantile</a>, <a href="#74251" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#74116" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#74117" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="73390">actual99th</a> = <a href="#73368" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">orderDisplayGetLastOrderHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="73392">predicted99th</a> = <a href="#69000" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#73387" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelOrderDisplayGetOrderLines" id="68985">ModelOrderDisplayGetOrderLines</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68973" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68971" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74297">orderDisplayGetOrderLines</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;orderDisplayGetOrderLines&quot;)" class="string">&quot;orderDisplayGetOrderLines&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(3)" class="int">3</span><span class="delimiter">)</span>  <span class="comment">// might want to fix this later so requested cardinality = result cardinality</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74299">orderDisplayGetOrderLinesHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74297" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetOrderLines</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.orderDisplayGetOrderLines.physicalPlan</span>
    <span class="comment">//res13: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: items&gt;,ArrayBuffer(AttributeValue(0,2)),LocalStopAfter(ParameterLimit(1,100),</span>
    <span class="comment">//                                              IndexScan(&lt;Namespace: orderLines&gt;,ArrayBuffer(ParameterValue(0)),ParameterLimit(1,100),true)))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74301">indexScanOrderLines</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanOrderLines&quot;)" class="string">&quot;indexScanOrderLines&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(3)" class="int">3</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74303">indexScanOrderLinesHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74301" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanOrderLines</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74380" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74305">indexLookupJoinItems</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinItems&quot;)" class="string">&quot;indexLookupJoinItems&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(3)" class="int">3</span><span class="delimiter">)</span>, <span title="Int(3)" class="int">3</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74307">indexLookupJoinItemsHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74305" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinItems</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74465" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="74309">predictHist</a> = <span class="delimiter">{</span>
      <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74303" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanOrderLinesHist</a>, <a href="#74307" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinItemsHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="74310">actual99th</a> = <a href="#74299" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">orderDisplayGetOrderLinesHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="74312">predicted99th</a> = <a href="#69000" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#74309" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="74314">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="74512">i</a>: <span title="Int">Int</span>, <a title="Double" id="74513">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74515">indexScanOrderLinesHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74301" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanOrderLines</a>, <a href="#74512" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74558" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74516">indexLookupJoinItemsHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74305" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinItems</a>, <a href="#74512" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74642" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="74517">predictedHist</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74515" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanOrderLinesHist</a>, <a href="#74516" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinItemsHist</a><span class="delimiter">)</span>
      
      <a href="#69000" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#74517" title="scala.collection.mutable.ArrayBuffer[BigInt]">predictedHist</a>, <a href="#74513" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="74315">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="74688">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>
      
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74689">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74690">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>
      
      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71163" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="74821">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74822">actualHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74297" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">orderDisplayGetOrderLines</a>, <a href="#74821" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="74823">actualQuantile</a> = <a href="#74822" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#74688" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#74689" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#74823" title="=&gt; Long">actualQuantile</a>
        
        <span class="keyword">val</span> <a title="Int" id="74824">predictedQuantile</a> = <a href="#74314" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#74821" title="Int">i</a>, <a href="#74688" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#74690" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#74824" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#74821" title="Int">i</a>, <a href="#74823" title="Int">actualQuantile</a>, <a href="#74824" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      
      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#74689" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#74690" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelProductDetailWI" id="68987">ModelProductDetailWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68973" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68971" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74870">productDetailWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;productDetailWI&quot;)" class="string">&quot;productDetailWI&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="74872">productDetailWIHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74870" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">productDetailWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.productDetailWI.physicalPlan</span>
    <span class="comment">//res17: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: authors&gt;,ArrayBuffer(AttributeValue(0,2)),</span>
    <span class="comment">//                                              IndexLookup(&lt;Namespace: items&gt;,ArrayBuffer(ParameterValue(0))))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74874">indexLookupItems</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupItems&quot;)" class="string">&quot;indexLookupItems&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74876">indexLookupItemsHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74874" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupItems</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#74953" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="74878">indexLookupJoinAuthors</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAuthors&quot;)" class="string">&quot;indexLookupJoinAuthors&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="74880">indexLookupJoinAuthorsHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#74878" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75038" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="74882">predictHist</a> = <span class="delimiter">{</span>
      <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#74876" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupItemsHist</a>, <a href="#74880" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="74883">actual99th</a> = <a href="#74872" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">productDetailWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="74885">predicted99th</a> = <a href="#69000" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#74882" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="74887">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="75085">i</a>: <span title="Int">Int</span>, <a title="Double" id="75086">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75088">indexLookupItemsHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74874" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupItems</a>, <a href="#75085" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75130" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75089">indexLookupJoinAuthorsHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74878" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a>, <a href="#75085" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75214" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="#69000" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#75088" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupItemsHist</a>, <a href="#75089" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>, <a href="#75086" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
        
    <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="74888">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="75260">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">//val numIntervals = 30</span>

      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75261">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75262">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71163" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="75393">i</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75394">actualHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#74870" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">productDetailWI</a>, <a href="#75393" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="75395">actualQuantile</a> = <a href="#75394" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#75260" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#75261" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#75395" title="=&gt; Long">actualQuantile</a>

        <span class="keyword">val</span> <a title="Int" id="75396">predictedQuantile</a> = <a href="#74887" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#75393" title="Int">i</a>, <a href="#75260" title="Double">quantile</a><span class="delimiter">)</span>
        <a href="#75262" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#75396" title="=&gt; Long">predictedQuantile</a>
        
        <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#75393" title="Int">i</a>, <a href="#75395" title="Int">actualQuantile</a>, <a href="#75396" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#75261" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#75262" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>

  <span class="comment">// for some reason, I don't have data on this</span>
  <span class="comment">// will have to figure this out later</span>
  <span class="comment">// probably b/c in TpcwClient, there was no query name passed to toPiql</span>
  <span class="comment">// right now, only have a query description where shopping cart is empty b/c shopping cart is never getting populated</span>
  <span class="comment">// for now, postpone this</span>
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelRetrieveShoppingCart" id="68989">ModelRetrieveShoppingCart</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68973" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68971" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75442">retrieveShoppingCart</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;unnamed&quot;)" class="string">&quot;unnamed&quot;</span>, List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="comment">// &quot;unnamed&quot; b/c of bug in TpcwClient; 0 b/c not getting populated</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75444">retrieveShoppingCartHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75442" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">retrieveShoppingCart</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.retrieveShoppingCart.physicalPlan</span>
    <span class="comment">//res33: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: items&gt;,ArrayBuffer(AttributeValue(0,1)),</span>
    <span class="comment">//                                              LocalStopAfter(FixedLimit(1000),</span>
    <span class="comment">//                                              IndexScan(&lt;Namespace: shoppingCartItems&gt;,ArrayBuffer(ParameterValue(0)),FixedLimit(1000),true)))</span>
    
    
  <span class="delimiter">}</span>

  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelSearchByAuthorWI" id="68991">ModelSearchByAuthorWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68973" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68971" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75472">searchByAuthorWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;searchByAuthorWI&quot;)" class="string">&quot;searchByAuthorWI&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(10)" class="int">10</span><span class="delimiter">)</span> <span class="comment">// only one where requested cardinality = result cardinality</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="75474">searchByAuthorWIHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75472" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">searchByAuthorWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.searchByAuthorWI.physicalPlan</span>
    <span class="comment">//res22: edu.berkeley.cs.scads.piql.QueryPlan = LocalStopAfter(ParameterLimit(1,50),</span>
    <span class="comment">//                                              IndexMergeJoin(&lt;Namespace: items_({&quot;fieldName&quot;: &quot;I_A_ID&quot;},{&quot;fieldName&quot;: &quot;I_TITLE&quot;})&gt;,List(AttributeValue(0,1)),List(AttributeValue(2,1)),ParameterLimit(1,50),true,</span>
    <span class="comment">//                                              IndexLookupJoin(&lt;Namespace: authors&gt;,List(AttributeValue(0,1)),LocalStopAfter(FixedLimit(50),</span>
    <span class="comment">//                                              IndexScan(&lt;Namespace: authors_({&quot;fieldNames&quot;: [&quot;A_FNAME&quot;, &quot;A_LNAME&quot;]})&gt;,List(ParameterValue(0)),FixedLimit(50),true)))))</span>
    
    <span class="comment">// I don't think we have the right benchmarks collected here.</span>
    <span class="comment">// I think we need the following:</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75476">indexScanAuthorsIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanAuthorsIdx&quot;)" class="string">&quot;indexScanAuthorsIdx&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>  <span class="comment">// i have this benchmark already</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75478">indexScanAuthorsIdxHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75476" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanAuthorsIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75559" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75480">indexLookupJoinAuthors</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAuthors&quot;)" class="string">&quot;indexLookupJoinAuthors&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="comment">// i NEED this</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75482">indexLookupJoinAuthorsHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75480" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75644" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="75484">indexMergeJoinItemsIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexMergeJoinItemsIdx&quot;)" class="string">&quot;indexMergeJoinItemsIdx&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>, <span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(10)" class="int">10</span><span class="delimiter">)</span> <span class="comment">// i NEED this</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75486">indexMergeJoinItemsIdxHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#75484" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexMergeJoinItemsIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75729" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="75488">predictHist</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="75776">res1</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#75478" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanAuthorsIdxHist</a>, <a href="#75482" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="75777">res2</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#75776" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#75486" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexMergeJoinItemsIdxHist</a><span class="delimiter">)</span>
      <a href="#75777" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="75489">actual99th</a> = <a href="#75474" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">searchByAuthorWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="75491">predicted99th</a> = <a href="#69000" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#75488" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="75493">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="75778">i</a>: <span title="Int">Int</span>, <a title="Double" id="75779">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75781">indexScanAuthorsIdxHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#75476" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanAuthorsIdx</a>, <a href="#75778" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75826" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75782">indexLookupJoinAuthorsHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#75480" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a>, <a href="#75778" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75910" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="75783">indexMergeJoinItemsIdxHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#75484" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexMergeJoinItemsIdx</a>, <a href="#75778" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#75994" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="75784">res1</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#75781" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanAuthorsIdxHist</a>, <a href="#75782" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[BigInt]" id="75785">res2</a> = <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#75784" title="scala.collection.mutable.ArrayBuffer[BigInt]">res1</a>, <a href="#75783" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexMergeJoinItemsIdxHist</a><span class="delimiter">)</span>
      <a href="#75785" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>

      <a href="#69000" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#75785" title="scala.collection.mutable.ArrayBuffer[BigInt]">res2</a>, <a href="#75779" title="Double">desiredQuantile</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

     <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="75494">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="76075">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
       <span class="comment">//val numIntervals = 30</span>

       <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76076">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
       <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76077">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

       <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

       <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71163" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="76208">i</a> =&gt; <span class="delimiter">{</span>
         <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76209">actualHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#75472" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">searchByAuthorWI</a>, <a href="#76208" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
         <span class="keyword">val</span> <a title="Int" id="76210">actualQuantile</a> = <a href="#76209" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#76075" title="Double">quantile</a><span class="delimiter">)</span>
         <a href="#76076" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#76210" title="=&gt; Long">actualQuantile</a>

         <span class="keyword">val</span> <a title="Int" id="76211">predictedQuantile</a> = <a href="#75493" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#76208" title="Int">i</a>, <a href="#76075" title="Double">quantile</a><span class="delimiter">)</span>
         <a href="#76077" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#76211" title="=&gt; Long">predictedQuantile</a>

         <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#76208" title="Int">i</a>, <a href="#76210" title="Int">actualQuantile</a>, <a href="#76211" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
       <span class="delimiter">}</span><span class="delimiter">)</span>

       <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#76076" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#76077" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
     <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
  
  <span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.ModelSearchByTitleWI" id="68993">ModelSearchByTitleWI</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#68973" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.TpcwData">TpcwData</a>._
    <span class="keyword">import</span> <a href="#68971" title="object edu.berkeley.cs.scads.piql.modeling.TpcwModeling.Util">Util</a>._
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="76257">searchByTitleWI</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;searchByTitleWI&quot;)" class="string">&quot;searchByTitleWI&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>, <span title="Int(7)" class="int">7</span><span class="comment">/*9*/</span><span class="delimiter">)</span>  <span class="comment">// want to make requested, result cardinalities match</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76259">searchByTitleWIHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#76257" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">searchByTitleWI</a><span class="delimiter">)</span>
    
    <span class="comment">//scala&gt; testTpcwClient.searchByTitleWI.physicalPlan</span>
    <span class="comment">//res26: edu.berkeley.cs.scads.piql.QueryPlan = IndexLookupJoin(&lt;Namespace: authors&gt;,List(AttributeValue(0,2)),LocalStopAfter(ParameterLimit(1,50),</span>
    <span class="comment">//                                              IndexScan(&lt;Namespace: items_({&quot;fieldNames&quot;: [&quot;I_TITLE&quot;]},{&quot;fieldName&quot;: &quot;I_TITLE&quot;},{&quot;fieldName&quot;: &quot;I_A_ID&quot;})&gt;,List(ParameterValue(0)),ParameterLimit(1,50),true)))</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="76261">indexScanItemsIdx</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexScanItemsIdx&quot;)" class="string">&quot;indexScanItemsIdx&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(9)" class="int">9</span><span class="delimiter">)</span>, <span title="Int(9)" class="int">9</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76263">indexScanItemsIdxHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#76261" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanItemsIdx</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76340" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.modeling.QueryDescription" id="76265">indexLookupJoinAuthors</a> = <a href="../collection/QueryRunnerTask.scala.html#37854" title="(queryName: String, parameters: Seq[Int], resultCardinality: Int)edu.berkeley.cs.scads.piql.modeling.QueryDescription">QueryDescription</a><span class="delimiter">(</span><span title="java.lang.String(&quot;indexLookupJoinAuthors&quot;)" class="string">&quot;indexLookupJoinAuthors&quot;</span>, <span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><span title="Int(9)" class="int">9</span><span class="delimiter">)</span>, <span title="Int(9)" class="int">9</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76267">indexLookupJoinAuthorsHist</a> = <a href="#71166" title="(key: edu.berkeley.cs.scads.piql.modeling.QueryDescription)edu.berkeley.cs.scads.perf.Histogram">histogramsTpcw</a><span class="delimiter">(</span><a href="#76265" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76421" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]" id="76269">predictHist</a> = <span class="delimiter">{</span>
      <a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#76263" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanItemsIdxHist</a>, <a href="#76267" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Int" id="76270">actual99th</a> = <a href="#76259" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">searchByTitleWIHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="76272">predicted99th</a> = <a href="#69000" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#76269" title="=&gt; scala.collection.mutable.ArrayBuffer[BigInt]">predictHist</a>, <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(i: Int, desiredQuantile: Double)Int" id="76274">predictOneInterval</a><span class="delimiter">(</span><a title="Int" id="76464">i</a>: <span title="Int">Int</span>, <a title="Double" id="76465">desiredQuantile</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76467">indexScanItemsIdxHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#76261" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexScanItemsIdx</a>, <a href="#76464" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76509" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]" id="76468">indexLookupJoinAuthorsHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#76265" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">indexLookupJoinAuthors</a>, <a href="#76464" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</span>.<span title="(f: Long =&gt; scala.math.BigInt)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]])scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,scala.math.BigInt,scala.collection.mutable.ArrayBuffer[scala.math.BigInt]]" class="delimiter">(</span><span title="(l: Long)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#76589" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

       <a href="#69000" title="(hist: scala.collection.mutable.ArrayBuffer[BigInt], quantile: Double)Int">quantile</a><span class="delimiter">(</span><a href="#68997" title="(hist1: scala.collection.mutable.ArrayBuffer[BigInt], hist2: scala.collection.mutable.ArrayBuffer[BigInt])scala.collection.mutable.ArrayBuffer[BigInt]">convolve</a><span class="delimiter">(</span><a href="#76467" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexScanItemsIdxHist</a>, <a href="#76468" title="scala.collection.mutable.ArrayBuffer[scala.math.BigInt]">indexLookupJoinAuthorsHist</a><span class="delimiter">)</span>, <a href="#76465" title="Double">desiredQuantile</a><span class="delimiter">)</span>
     <span class="delimiter">}</span>

     <span class="keyword">def</span> <a title="(quantile: Double)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" id="76275">getPerIntervalPrediction</a><span class="delimiter">(</span><a title="Double" id="76631">quantile</a>: <span title="Double">Double</span> = <span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>:<span title="(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span>Histogram, Histogram<span class="delimiter">)</span> = <span class="delimiter">{</span>
       <span class="comment">//val numIntervals = 30</span>

       <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76632">actualQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
       <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76633">predictedQuantileHist</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>

       <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;interval, actualQuantile, predictedQuantile&quot;)" class="string">&quot;interval, actualQuantile, predictedQuantile&quot;</span><span class="delimiter">)</span>

       <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#71163" title="=&gt; Int">numIntervals</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="76764">i</a> =&gt; <span class="delimiter">{</span>
         <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="76765">actualHist</a> = <a href="#71168" title="(key: (edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int))edu.berkeley.cs.scads.perf.Histogram">perIterationHistograms</a><span class="delimiter">(</span><span title="(_1: edu.berkeley.cs.scads.piql.modeling.QueryDescription, _2: Int)(edu.berkeley.cs.scads.piql.modeling.QueryDescription, Int)" class="delimiter">(</span><a href="#76257" title="=&gt; edu.berkeley.cs.scads.piql.modeling.QueryDescription">searchByTitleWI</a>, <a href="#76764" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
         <span class="keyword">val</span> <a title="Int" id="76766">actualQuantile</a> = <a href="#76765" title="edu.berkeley.cs.scads.perf.Histogram">actualHist</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><a href="#76631" title="Double">quantile</a><span class="delimiter">)</span>
         <a href="#76632" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#76766" title="=&gt; Long">actualQuantile</a>

         <span class="keyword">val</span> <a title="Int" id="76767">predictedQuantile</a> = <a href="#76274" title="(i: Int, desiredQuantile: Double)Int">predictOneInterval</a><span class="delimiter">(</span><a href="#76764" title="Int">i</a>, <a href="#76631" title="Double">quantile</a><span class="delimiter">)</span>
         <a href="#76633" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a> <span title="(value: Long)Unit">+=</span> <a href="#76767" title="=&gt; Long">predictedQuantile</a>

         <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="(xs: Int*)List[Int]">List</span><span class="delimiter">(</span><a href="#76764" title="Int">i</a>, <a href="#76766" title="Int">actualQuantile</a>, <a href="#76767" title="Int">predictedQuantile</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
       <span class="delimiter">}</span><span class="delimiter">)</span>

       <span title="(_1: edu.berkeley.cs.scads.perf.Histogram, _2: edu.berkeley.cs.scads.perf.Histogram)(edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram)" class="delimiter">(</span><a href="#76632" title="edu.berkeley.cs.scads.perf.Histogram">actualQuantileHist</a>, <a href="#76633" title="edu.berkeley.cs.scads.perf.Histogram">predictedQuantileHist</a><span class="delimiter">)</span>
     <span class="delimiter">}</span>
    
  <span class="delimiter">}</span>
<span class="delimiter">}</span>
        </pre>
    </body>
</html>