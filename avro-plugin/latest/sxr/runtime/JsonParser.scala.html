<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>runtime/JsonParser.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs.avro
<span class="keyword">package</span> runtime

<span class="keyword">import</span> org.apache.avro.generic.<span class="delimiter">{</span>GenericData, IndexedRecord<span class="delimiter">}</span>
<span class="keyword">import</span> org.apache.avro.Schema
<span class="keyword">import</span> org.apache.avro.<span title="object org.apache.avro.Schema">Schema</span>.Type
<span class="keyword">import</span> org.apache.avro.util.Utf8

<span class="keyword">import</span> org.codehaus.jackson.<span class="delimiter">{</span>JsonFactory, JsonParser, JsonToken<span class="delimiter">}</span>

<span class="keyword">import</span> scala.collection.<span title="object scala.collection.JavaConversions">JavaConversions</span>._

<span class="keyword">import</span> net.lag.logging.Logger

<span class="keyword">object</span> <a title="object edu.berkeley.cs.avro.runtime.JsonObject" id="9682">JsonObject</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">val</span> <a title="org.codehaus.jackson.JsonFactory" id="70845">factory</a> = <span title="org.codehaus.jackson.JsonFactory" class="keyword">new</span> <span title="org.codehaus.jackson.JsonFactory">JsonFactory</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class JsonObject extends java.lang.Object with ScalaObject" id="9684">JsonObject</a><a href="#9684" title="ScalaObject" class="delimiter">(</a><a title="String" id="61756">json</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="61746">logger</a> = <span title="()net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="[T &lt;: org.apache.avro.generic.IndexedRecord](implicit manifest: Manifest[T])Option[T]" id="61748">toAvro</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: org.apache.avro.generic.IndexedRecord" id="61750">T</a> &lt;: IndexedRecord<span class="delimiter">]</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="Manifest[T]" id="71595">manifest</a>: <span title="Manifest[T]">Manifest</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[T]">Option</span><span class="delimiter">[</span>T<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="org.codehaus.jackson.JsonParser" id="71598">parser</a> = <a href="#9682" title="object edu.berkeley.cs.avro.runtime.JsonObject">JsonObject</a>.<a href="#70845" title="=&gt; org.codehaus.jackson.JsonFactory">factory</a>.<span title="(x$1: java.lang.String)org.codehaus.jackson.JsonParser">createJsonParser</span><span class="delimiter">(</span><a href="#61756" title="String">json</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="T" id="71599">record</a> = <a href="#71595" title="Manifest[T]">manifest</a>.<span title="=&gt; java.lang.Class[_]">erasure</span>.<span title="()_$1">newInstance</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#61750" title="T">T</a><span class="delimiter">]</span>

    <a href="#61746" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Parsing: &quot;)" class="string">&quot;Parsing: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#61756" title="String">json</a><span class="delimiter">)</span>

    <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#71598" title="org.codehaus.jackson.JsonParser">parser</a>.<span title="()org.codehaus.jackson.JsonToken">nextToken</span> <span title="(x$1: AnyRef)Boolean">!=</span> JsonToken.<span title="org.codehaus.jackson.JsonToken(value START_OBJECT)">START_OBJECT</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#61746" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Failed to parse JSON object: &quot;)" class="string">&quot;Failed to parse JSON object: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#61756" title="String">json</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;. Expected START_OBJECT, found &quot;)" class="string">&quot;. Expected START_OBJECT, found &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#71598" title="org.codehaus.jackson.JsonParser">parser</a>.<span title="()org.codehaus.jackson.JsonToken">getCurrentToken</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <span title="object None">None</span>
    <span class="delimiter">}</span>

    <a href="#61753" title="(parser: org.codehaus.jackson.JsonParser, record: T)Option[T]">parseRecord</a><span class="delimiter">(</span><a href="#71598" title="org.codehaus.jackson.JsonParser">parser</a>, <a href="#71599" title="T">record</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(schema: org.apache.avro.Schema, fieldType: org.apache.avro.Schema.Type)Boolean" id="61751">canBe</a><span class="delimiter">(</span><a title="org.apache.avro.Schema" id="71672">schema</a>: <span title="org.apache.avro.Schema">Schema</span>, <a title="org.apache.avro.Schema.Type" id="71673">fieldType</a>: Schema.<span title="org.apache.avro.Schema.Type">Type</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span title="Boolean" class="keyword">if</span><span class="delimiter">(</span><a href="#71673" title="org.apache.avro.Schema.Type">fieldType</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#71672" title="org.apache.avro.Schema">schema</a>.<span title="()org.apache.avro.Schema.Type">getType</span><span class="delimiter">)</span> <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">else</span> <span title="Boolean" class="keyword">if</span><span class="delimiter">(</span><a href="#71672" title="org.apache.avro.Schema">schema</a>.<span title="()org.apache.avro.Schema.Type">getType</span> <span title="(x$1: AnyRef)Boolean">==</span> Type.<span title="org.apache.avro.Schema.Type(value UNION)">UNION</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#71672" title="org.apache.avro.Schema">schema</a>.<span title="(l: java.util.List[org.apache.avro.Schema])scala.collection.mutable.Buffer[org.apache.avro.Schema]">getTypes</span>.<span title="(p: org.apache.avro.Schema =&gt; Boolean)Option[org.apache.avro.Schema]">find</span><span class="delimiter">(</span><a href="#71978" title="org.apache.avro.Schema">_</a>.<span title="()org.apache.avro.Schema.Type">getType</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#71673" title="org.apache.avro.Schema.Type">fieldType</a><span class="delimiter">)</span>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">else</span> <span title="Boolean(false)" class="keyword">false</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(parser: org.codehaus.jackson.JsonParser, schema: org.apache.avro.Schema, fieldname: String)Any" id="61752">parseValue</a><span class="delimiter">(</span><a title="org.codehaus.jackson.JsonParser" id="71984">parser</a>: <span title="org.codehaus.jackson.JsonParser">JsonParser</span>, <a title="org.apache.avro.Schema" id="71985">schema</a>: <span title="org.apache.avro.Schema">Schema</span>, <a title="String" id="71986">fieldname</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Any">Any</span> = <span class="delimiter">{</span>
    <a href="#71984" title="org.codehaus.jackson.JsonParser">parser</a>.<span title="()org.codehaus.jackson.JsonToken">getCurrentToken</span> <span title="Any" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Any">JsonToken</span>.<span title="org.codehaus.jackson.JsonToken(value START_OBJECT)">START_OBJECT</span>     <span class="keyword">if</span><span class="delimiter">(</span><a href="#61751" title="(schema: org.apache.avro.Schema, fieldType: org.apache.avro.Schema.Type)Boolean">canBe</a><span class="delimiter">(</span><a href="#71985" title="org.apache.avro.Schema">schema</a>, Type.<span title="org.apache.avro.Schema.Type(value RECORD)">RECORD</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="org.apache.avro.Schema" id="71988">subRecordSchema</a>: <span title="org.apache.avro.Schema">Schema</span> =
          <span title="org.apache.avro.Schema" class="keyword">if</span><span class="delimiter">(</span><a href="#71985" title="org.apache.avro.Schema">schema</a>.<span title="()org.apache.avro.Schema.Type">getType</span> <span title="(x$1: AnyRef)Boolean">==</span> Type.<span title="org.apache.avro.Schema.Type(value RECORD)">RECORD</span><span class="delimiter">)</span>
            <a href="#71985" title="org.apache.avro.Schema">schema</a>
          <span class="keyword">else</span> <span title="org.apache.avro.Schema" class="keyword">if</span><span class="delimiter">(</span><a href="#71985" title="org.apache.avro.Schema">schema</a>.<span title="()org.apache.avro.Schema.Type">getType</span> <span title="(x$1: AnyRef)Boolean">==</span> Type.<span title="org.apache.avro.Schema.Type(value UNION)">UNION</span><span class="delimiter">)</span>
            <a href="#71985" title="org.apache.avro.Schema">schema</a>.<span title="(l: java.util.List[org.apache.avro.Schema])scala.collection.mutable.Buffer[org.apache.avro.Schema]">getTypes</span>.<span title="(p: org.apache.avro.Schema =&gt; Boolean)Option[org.apache.avro.Schema]">find</span><span class="delimiter">(</span><a href="#72209" title="org.apache.avro.Schema">_</a>.<span title="()org.apache.avro.Schema.Type">getType</span> <span title="(x$1: AnyRef)Boolean">==</span> Type.<span title="org.apache.avro.Schema.Type(value RECORD)">RECORD</span><span class="delimiter">)</span>.<span title="(default: =&gt; org.apache.avro.Schema)org.apache.avro.Schema">getOrElse</span><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Unexpected subrecord&quot;)" class="string">&quot;Unexpected subrecord&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">else</span>
            <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Unexpected sub record&quot;)" class="string">&quot;Unexpected sub record&quot;</span><span class="delimiter">)</span>

        <span class="keyword">val</span> <a title="java.lang.String" id="71989">className</a> = <a href="#71988" title="org.apache.avro.Schema">subRecordSchema</a>.<span title="()java.lang.String">getNamespace</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.&quot;)" class="string">&quot;.&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#71988" title="org.apache.avro.Schema">subRecordSchema</a>.<span title="()java.lang.String">getName</span>
        <span class="keyword">val</span> <a title="Class[org.apache.avro.generic.IndexedRecord]" id="71990">subRecordClass</a> = <span title="object java.lang.Class">Class</span>.<span title="(x$1: java.lang.String)java.lang.Class[_]">forName</span><span class="delimiter">(</span><a href="#71989" title="java.lang.String">className</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Class[org.apache.avro.generic.IndexedRecord]" class="delimiter">[</span><span title="Class[org.apache.avro.generic.IndexedRecord]">Class</span><span class="delimiter">[</span>IndexedRecord<span class="delimiter">]</span><span class="delimiter">]</span>
        <span class="keyword">val</span> <a title="org.apache.avro.generic.IndexedRecord" id="71991">subRecord</a> = <a href="#71990" title="Class[org.apache.avro.generic.IndexedRecord]">subRecordClass</a>.<span title="()org.apache.avro.generic.IndexedRecord">newInstance</span><span class="delimiter">(</span><span class="delimiter">)</span>

        <a href="#61753" title="(parser: org.codehaus.jackson.JsonParser, record: org.apache.avro.generic.IndexedRecord)Option[org.apache.avro.generic.IndexedRecord]">parseRecord</a><span class="delimiter">(</span><a href="#71984" title="org.codehaus.jackson.JsonParser">parser</a>, <a href="#71991" title="org.apache.avro.generic.IndexedRecord">subRecord</a><span class="delimiter">)</span>.<span title="(default: =&gt; Any)Any">getOrElse</span><span class="delimiter">(</span><span class="delimiter">{</span>
          <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#61751" title="(schema: org.apache.avro.Schema, fieldType: org.apache.avro.Schema.Type)Boolean">canBe</a><span class="delimiter">(</span><a href="#71985" title="org.apache.avro.Schema">schema</a>, Type.<span title="org.apache.avro.Schema.Type(value NULL)">NULL</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Null(null)" class="keyword">null</span>
          <span class="keyword">else</span> <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Record cannot be null&quot;)" class="string">&quot;Record cannot be null&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="org.apache.avro.generic.GenericData.Array[Any]">JsonToken</span>.<span title="org.codehaus.jackson.JsonToken(value START_ARRAY)">START_ARRAY</span>      <span class="keyword">if</span><span class="delimiter">(</span><a href="#61751" title="(schema: org.apache.avro.Schema, fieldType: org.apache.avro.Schema.Type)Boolean">canBe</a><span class="delimiter">(</span><a href="#71985" title="org.apache.avro.Schema">schema</a>, Type.<span title="org.apache.avro.Schema.Type(value ARRAY)">ARRAY</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="org.apache.avro.generic.GenericData.Array[Any]" id="72245">array</a> = <span title="org.apache.avro.generic.GenericData.Array[Any]" class="keyword">new</span> GenericData.<span title="org.apache.avro.generic.GenericData.Array[Any]">Array</span><span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>, <a href="#71985" title="org.apache.avro.Schema">schema</a><span class="delimiter">)</span>
        <span title="Unit" class="keyword">while</span><span class="delimiter">(</span><a href="#71984" title="org.codehaus.jackson.JsonParser">parser</a>.<span title="()org.codehaus.jackson.JsonToken">nextToken</span> <span title="(x$1: AnyRef)Boolean">!=</span> JsonToken.<span title="org.codehaus.jackson.JsonToken(value END_ARRAY)">END_ARRAY</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#72245" title="org.apache.avro.generic.GenericData.Array[Any]">array</a>.<span title="(x$1: Any)Boolean">add</span><a href="#72246" title="()Unit" class="delimiter">(</a><a href="#61752" title="(parser: org.codehaus.jackson.JsonParser, schema: org.apache.avro.Schema, fieldname: String)Any">parseValue</a><span class="delimiter">(</span><a href="#71984" title="org.codehaus.jackson.JsonParser">parser</a>, <a href="#71985" title="org.apache.avro.Schema">schema</a>.<span title="()org.apache.avro.Schema">getElementType</span>, <a href="#71986" title="String">fieldname</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#72245" title="org.apache.avro.generic.GenericData.Array[Any]">array</a>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="org.apache.avro.util.Utf8">JsonToken</span>.<span title="org.codehaus.jackson.JsonToken(value VALUE_STRING)">VALUE_STRING</span>       <span class="keyword">if</span><span class="delimiter">(</span><a href="#61751" title="(schema: org.apache.avro.Schema, fieldType: org.apache.avro.Schema.Type)Boolean">canBe</a><span class="delimiter">(</span><a href="#71985" title="org.apache.avro.Schema">schema</a>, Type.<span title="org.apache.avro.Schema.Type(value STRING)">STRING</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span title="(x$1: java.lang.String)org.apache.avro.util.Utf8" class="keyword">new</span> <span title="org.apache.avro.util.Utf8">Utf8</span><span class="delimiter">(</span><a href="#71984" title="org.codehaus.jackson.JsonParser">parser</a>.<span title="()java.lang.String">getText</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Long">JsonToken</span>.<span title="org.codehaus.jackson.JsonToken(value VALUE_NUMBER_INT)">VALUE_NUMBER_INT</span>   <span class="keyword">if</span><span class="delimiter">(</span><a href="#61751" title="(schema: org.apache.avro.Schema, fieldType: org.apache.avro.Schema.Type)Boolean">canBe</a><span class="delimiter">(</span><a href="#71985" title="org.apache.avro.Schema">schema</a>, Type.<span title="org.apache.avro.Schema.Type(value LONG)">LONG</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#71984" title="org.codehaus.jackson.JsonParser">parser</a>.<span title="()Long">getLongValue</span>
      <span class="keyword">case</span> <span title="Int">JsonToken</span>.<span title="org.codehaus.jackson.JsonToken(value VALUE_NUMBER_INT)">VALUE_NUMBER_INT</span>   <span class="keyword">if</span><span class="delimiter">(</span><a href="#61751" title="(schema: org.apache.avro.Schema, fieldType: org.apache.avro.Schema.Type)Boolean">canBe</a><span class="delimiter">(</span><a href="#71985" title="org.apache.avro.Schema">schema</a>, Type.<span title="org.apache.avro.Schema.Type(value INT)">INT</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#71984" title="org.codehaus.jackson.JsonParser">parser</a>.<span title="()Int">getIntValue</span>
      <span class="keyword">case</span> <span title="Double">JsonToken</span>.<span title="org.codehaus.jackson.JsonToken(value VALUE_NUMBER_FLOAT)">VALUE_NUMBER_FLOAT</span> <span class="keyword">if</span><span class="delimiter">(</span><a href="#61751" title="(schema: org.apache.avro.Schema, fieldType: org.apache.avro.Schema.Type)Boolean">canBe</a><span class="delimiter">(</span><a href="#71985" title="org.apache.avro.Schema">schema</a>, Type.<span title="org.apache.avro.Schema.Type(value DOUBLE)">DOUBLE</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#71984" title="org.codehaus.jackson.JsonParser">parser</a>.<span title="()Double">getDoubleValue</span>
      <span class="keyword">case</span> <span title="Boolean(true)">JsonToken</span>.<span title="org.codehaus.jackson.JsonToken(value VALUE_TRUE)">VALUE_TRUE</span>         <span class="keyword">if</span><span class="delimiter">(</span><a href="#61751" title="(schema: org.apache.avro.Schema, fieldType: org.apache.avro.Schema.Type)Boolean">canBe</a><span class="delimiter">(</span><a href="#71985" title="org.apache.avro.Schema">schema</a>, Type.<span title="org.apache.avro.Schema.Type(value BOOLEAN)">BOOLEAN</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
      <span class="keyword">case</span> <span title="Boolean(false)">JsonToken</span>.<span title="org.codehaus.jackson.JsonToken(value VALUE_FALSE)">VALUE_FALSE</span>        <span class="keyword">if</span><span class="delimiter">(</span><a href="#61751" title="(schema: org.apache.avro.Schema, fieldType: org.apache.avro.Schema.Type)Boolean">canBe</a><span class="delimiter">(</span><a href="#71985" title="org.apache.avro.Schema">schema</a>, Type.<span title="org.apache.avro.Schema.Type(value BOOLEAN)">BOOLEAN</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
      <span class="keyword">case</span> <span title="Null(null)">JsonToken</span>.<span title="org.codehaus.jackson.JsonToken(value VALUE_NULL)">VALUE_NULL</span>         <span class="keyword">if</span><span class="delimiter">(</span><a href="#61751" title="(schema: org.apache.avro.Schema, fieldType: org.apache.avro.Schema.Type)Boolean">canBe</a><span class="delimiter">(</span><a href="#71985" title="org.apache.avro.Schema">schema</a>, Type.<span title="org.apache.avro.Schema.Type(value NULL)">NULL</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span title="Null(null)" class="keyword">null</span>
      <span class="keyword">case</span> <a title="Nothing" id="72478">unexp</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="java.lang.String" id="72479">error</a> = <span title="java.lang.String(&quot;Don\'t know how to populate field &quot;)" class="string">&quot;Don't know how to populate field &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#71986" title="String">fieldname</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;. Found: &quot;)" class="string">&quot;. Found: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#71984" title="org.codehaus.jackson.JsonParser">parser</a>.<span title="()org.codehaus.jackson.JsonToken">getCurrentToken</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;, Expected: &quot;)" class="string">&quot;, Expected: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#71985" title="org.apache.avro.Schema">schema</a>
        <a href="#61746" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><a href="#72479" title="java.lang.String">error</a><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><a href="#72479" title="java.lang.String">error</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="[RecType &lt;: org.apache.avro.generic.IndexedRecord](parser: org.codehaus.jackson.JsonParser, record: RecType)Option[RecType]" id="61753">parseRecord</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: org.apache.avro.generic.IndexedRecord" id="61755">RecType</a> &lt;: IndexedRecord<span class="delimiter">]</span><span class="delimiter">(</span><a title="org.codehaus.jackson.JsonParser" id="71662">parser</a>: <span title="org.codehaus.jackson.JsonParser">JsonParser</span>, <a title="RecType" id="71663">record</a>: <a href="#61755" title="RecType">RecType</a><span class="delimiter">)</span>: <span title="Option[RecType]">Option</span><span class="delimiter">[</span>RecType<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="org.apache.avro.Schema" id="72486">schema</a> = <a href="#71663" title="RecType">record</a>.<span title="()org.apache.avro.Schema">getSchema</span>
    <span class="keyword">var</span> <a title="scala.collection.mutable.Buffer[java.lang.String]" id="72487">missingFields</a> = <a href="#72486" title="org.apache.avro.Schema">schema</a>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>.<span title="(p: org.apache.avro.Schema.Field =&gt; Boolean)scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">filter</span><span class="delimiter">(</span><a title="org.apache.avro.Schema.Field" id="72705">f</a> =&gt; <span title="=&gt; Boolean">!</span><a href="#61751" title="(schema: org.apache.avro.Schema, fieldType: org.apache.avro.Schema.Type)Boolean">canBe</a><span class="delimiter">(</span><a href="#72705" title="org.apache.avro.Schema.Field">f</a>.<span title="()org.apache.avro.Schema">schema</span>, Type.<span title="org.apache.avro.Schema.Type(value NULL)">NULL</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: org.apache.avro.Schema.Field =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer[org.apache.avro.Schema.Field],java.lang.String,scala.collection.mutable.Buffer[java.lang.String]])scala.collection.mutable.Buffer[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Buffer.Coll,java.lang.String,scala.collection.mutable.Buffer[java.lang.String]]" class="delimiter">(</span><a href="#72725" title="org.apache.avro.Schema.Field">_</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span>

    <span title="Unit" class="keyword">while</span><span class="delimiter">(</span><a href="#71662" title="org.codehaus.jackson.JsonParser">parser</a>.<span title="()org.codehaus.jackson.JsonToken">nextToken</span> <span title="(x$1: AnyRef)Boolean">!=</span> JsonToken.<span title="org.codehaus.jackson.JsonToken(value END_OBJECT)">END_OBJECT</span><span class="delimiter">)</span> <a href="#72488" title="()Unit" class="delimiter">{</a>
      <span class="keyword">val</span> <a title="java.lang.String" id="72993">fieldname</a> = <a href="#71662" title="org.codehaus.jackson.JsonParser">parser</a>.<span title="()java.lang.String">getCurrentName</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="org.apache.avro.Schema.Field" id="72994">field</a> = <a href="#72486" title="org.apache.avro.Schema">schema</a>.<span title="(x$1: java.lang.String)org.apache.avro.Schema.Field">getField</span><span class="delimiter">(</span><a href="#72993" title="java.lang.String">fieldname</a><span class="delimiter">)</span>
      <a href="#71662" title="org.codehaus.jackson.JsonParser">parser</a>.<span title="()org.codehaus.jackson.JsonToken">nextToken</span>

      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#72994" title="org.apache.avro.Schema.Field">field</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#61746" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Unexpected field: &quot;)" class="string">&quot;Unexpected field: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#72993" title="java.lang.String">fieldname</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; in &quot;)" class="string">&quot; in &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#72486" title="org.apache.avro.Schema">schema</a><span class="delimiter">)</span>
        <a href="#71662" title="org.codehaus.jackson.JsonParser">parser</a>.<span title="()org.codehaus.jackson.JsonToken">nextToken</span>
        <span title="Nothing" class="keyword">return</span> <span title="object None">None</span>
      <span class="delimiter">}</span> <span class="keyword">else</span>  <span class="delimiter">{</span>
        <a href="#72487" title="scala.collection.mutable.Buffer[java.lang.String]">missingFields</a> <span title="(x: java.lang.String)scala.collection.mutable.Buffer[java.lang.String]">-=</span> <a href="#72994" title="org.apache.avro.Schema.Field">field</a>.<span title="()java.lang.String">name</span>
        <span class="keyword">try</span> <span class="delimiter">{</span>
          <a href="#71663" title="RecType">record</a>.<span title="(x$1: Int, x$2: Any)Unit">put</span><span class="delimiter">(</span><a href="#72994" title="org.apache.avro.Schema.Field">field</a>.<span title="()Int">pos</span>, <a href="#61752" title="(parser: org.codehaus.jackson.JsonParser, schema: org.apache.avro.Schema, fieldname: String)Any">parseValue</a><span class="delimiter">(</span><a href="#71662" title="org.codehaus.jackson.JsonParser">parser</a>, <a href="#72994" title="org.apache.avro.Schema.Field">field</a>.<span title="()org.apache.avro.Schema">schema</span>, <a href="#72994" title="org.apache.avro.Schema.Field">field</a>.<span title="()java.lang.String">name</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a title="Nothing" id="73037">e</a>: <span title="Exception">Exception</span> =&gt;
            <a href="#61746" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">error</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Error in parsing value&quot;)" class="string">&quot;Error in parsing value&quot;</span>, <a href="#73037" title="Exception">e</a><span class="delimiter">)</span>
            <span title="Nothing" class="keyword">return</span> <span title="object None">None</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span title="Option[RecType]" class="keyword">if</span><span class="delimiter">(</span><a href="#72487" title="scala.collection.mutable.Buffer[java.lang.String]">missingFields</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#61746" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Invalid record.  The following required fields are missing: &quot;)" class="string">&quot;Invalid record.  The following required fields are missing: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#72487" title="scala.collection.mutable.Buffer[java.lang.String]">missingFields</a><span class="delimiter">)</span>
      <span title="object None">None</span>
    <span class="delimiter">}</span>
    <span class="keyword">else</span>
      <span title="(x: RecType)Some[RecType]">Some</span><span class="delimiter">(</span><a href="#71663" title="RecType">record</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>