<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>runtime/ScalaSpecificRecord.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs.avro
<span class="keyword">package</span> runtime

<span class="keyword">import</span> org.apache.avro.Schema
<span class="keyword">import</span> org.apache.avro.io.<span class="delimiter">{</span>BinaryEncoder, BinaryDecoder, EncoderFactory, DecoderFactory<span class="delimiter">}</span>
<span class="keyword">import</span> org.apache.avro.specific.<span class="delimiter">{</span>SpecificData, SpecificDatumReader, SpecificDatumWriter, SpecificRecord<span class="delimiter">}</span>
<span class="keyword">import</span> org.apache.avro.generic.<span class="delimiter">{</span> GenericRecord, GenericData, IndexedRecord <span class="delimiter">}</span>

<span class="keyword">import</span> collection.<span title="object scala.collection.JavaConversions">JavaConversions</span>._
<span class="keyword">import</span> java.io._

<span class="keyword">private</span><span class="delimiter">[</span>runtime<span class="delimiter">]</span> <span class="keyword">object</span> <a title="object edu.berkeley.cs.avro.runtime.ScalaSpecificRecordHelpers" id="9704">ScalaSpecificRecordHelpers</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="[SR &lt;: org.apache.avro.specific.SpecificRecord](specific: SR, generic: org.apache.avro.generic.IndexedRecord)SR" id="74776">fromGenericRecord</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: org.apache.avro.specific.SpecificRecord" id="74778">SR</a> &lt;: SpecificRecord<span class="delimiter">]</span><span class="delimiter">(</span><a title="SR" id="74779">specific</a>: <a href="#74778" title="SR">SR</a>, <a title="org.apache.avro.generic.IndexedRecord" id="74780">generic</a>: <span title="org.apache.avro.generic.IndexedRecord">IndexedRecord</span><span class="delimiter">)</span>: <a href="#74778" title="SR">SR</a> = <span class="delimiter">{</span>
    <a href="#74779" title="SR">specific</a>.<span title="()org.apache.avro.Schema">getSchema</span>.<span title="(l: java.util.List[org.apache.avro.Schema.Field])scala.collection.mutable.Buffer[org.apache.avro.Schema.Field]">getFields</span>.<span title="(f: org.apache.avro.Schema.Field =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="org.apache.avro.Schema.Field" id="75233">f</a> =&gt; <span class="delimiter">{</span>
      <a href="#74779" title="SR">specific</a>.<span title="(x$1: Int, x$2: Any)Unit">put</span><span class="delimiter">(</span><a href="#75233" title="org.apache.avro.Schema.Field">f</a>.<span title="()Int">pos</span>, <a href="#74780" title="org.apache.avro.generic.IndexedRecord">generic</a>.<span title="(x$1: Int)java.lang.Object">get</span><span class="delimiter">(</span><a href="#75233" title="org.apache.avro.Schema.Field">f</a>.<span title="()Int">pos</span><span class="delimiter">)</span> <span title="Any" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="org.apache.avro.specific.SpecificRecord" id="75234">innerGeneric</a>: GenericData.<span title="org.apache.avro.generic.GenericData.Record">Record</span> =&gt;
          <span class="comment">// create new instance of inner </span>
          <span class="keyword">val</span> <a title="org.apache.avro.specific.SpecificRecord" id="75235">innerSpecific</a> = <span title="object org.apache.avro.specific.SpecificData">SpecificData</span>.<span title="()org.apache.avro.specific.SpecificData">get</span>.<span title="(x$1: org.apache.avro.Schema)java.lang.Class[_]">getClass</span><span class="delimiter">(</span><a href="#75233" title="org.apache.avro.Schema.Field">f</a>.<span title="()org.apache.avro.Schema">schema</span><span class="delimiter">)</span>.<span title="()?0">newInstance</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="org.apache.avro.specific.SpecificRecord" class="delimiter">[</span><span title="org.apache.avro.specific.SpecificRecord">SpecificRecord</span><span class="delimiter">]</span>
          <a href="#74776" title="(specific: org.apache.avro.specific.SpecificRecord, generic: org.apache.avro.generic.IndexedRecord)org.apache.avro.specific.SpecificRecord">fromGenericRecord</a><span class="delimiter">(</span><a href="#75235" title="org.apache.avro.specific.SpecificRecord">innerSpecific</a>, <a href="#75234" title="org.apache.avro.generic.GenericData.Record">innerGeneric</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="java.lang.Object" id="75246">x</a> =&gt; <a href="#75246" title="java.lang.Object">x</a>
      <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
    <a href="#74779" title="SR">specific</a>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object edu.berkeley.cs.avro.runtime.ScalaSpecificRecord" id="9706">ScalaSpecificRecord</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">val</span> <a title="org.apache.avro.Schema.Parser" id="75249">parser</a> = <span title="org.apache.avro.Schema.Parser" class="keyword">new</span> <span title="object org.apache.avro.Schema">Schema</span>.<span title="org.apache.avro.Schema.Parser">Parser</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">//HACK: to deal with multiple compilations phases with same global object in sbt</span>
  <span class="keyword">def</span> <a title="(schema: String)org.apache.avro.Schema" id="75251">parse</a><span class="delimiter">(</span><a title="String" id="75271">schema</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="org.apache.avro.Schema">Schema</span> = <span title="org.apache.avro.Schema.Parser" class="keyword">new</span> <span title="object org.apache.avro.Schema">Schema</span>.<span title="org.apache.avro.Schema.Parser">Parser</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)org.apache.avro.Schema">parse</span><span class="delimiter">(</span><a href="#75271" title="String">schema</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait ScalaSpecificRecord extends java.lang.Object with org.apache.avro.specific.SpecificRecord with ScalaObject" id="9708">ScalaSpecificRecord</a> <span title="ScalaObject" class="keyword">extends</span> <span title="org.apache.avro.specific.SpecificRecord">SpecificRecord</span> <span class="delimiter">{</span>

  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.apache.avro.specific.SpecificDatumWriter[ScalaSpecificRecord.this.type]" id="11053">__writer__</a> = <span title="(x$1: org.apache.avro.Schema)org.apache.avro.specific.SpecificDatumWriter[ScalaSpecificRecord.this.type]" class="keyword">new</span> <span title="org.apache.avro.specific.SpecificDatumWriter[ScalaSpecificRecord.this.type]">SpecificDatumWriter</span><span class="delimiter">[</span><span class="keyword">this</span>.<span class="keyword">type</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="#9708" title="()org.apache.avro.Schema">getSchema</a><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.apache.avro.specific.SpecificDatumReader[ScalaSpecificRecord.this.type]" id="11055">__reader__</a> = <span title="(x$1: org.apache.avro.Schema, x$2: org.apache.avro.Schema, x$3: org.apache.avro.specific.SpecificData)org.apache.avro.specific.SpecificDatumReader[ScalaSpecificRecord.this.type]" class="keyword">new</span> <span title="org.apache.avro.specific.SpecificDatumReader[ScalaSpecificRecord.this.type]">SpecificDatumReader</span><span class="delimiter">[</span><span class="keyword">this</span>.<span class="keyword">type</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="#9708" title="()org.apache.avro.Schema">getSchema</a>, <a href="#9708" title="()org.apache.avro.Schema">getSchema</a>, <span title="(x$1: java.lang.ClassLoader)org.apache.avro.specific.SpecificData" class="keyword">new</span> <span title="org.apache.avro.specific.SpecificData">SpecificData</span><span class="delimiter">(</span><a href="#9708" title="()java.lang.Class[_]">getClass</a>.<span title="()java.lang.ClassLoader">getClassLoader</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="=&gt; Array[Byte]" id="11056">toBytes</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.io.ByteArrayOutputStream" id="75293">out</a> = <span title="(x$1: Int)java.io.ByteArrayOutputStream" class="keyword">new</span> <span title="java.io.ByteArrayOutputStream">ByteArrayOutputStream</span><span class="delimiter">(</span><span title="Int(128)" class="int">128</span><span class="delimiter">)</span>
    <a href="#11057" title="(outputStream: java.io.OutputStream)Unit">toBytes</a><span class="delimiter">(</span><a href="#75293" title="java.io.ByteArrayOutputStream">out</a><span class="delimiter">)</span>
    <a href="#75293" title="java.io.ByteArrayOutputStream">out</a>.<span title="()Array[Byte]">toByteArray</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(outputStream: java.io.OutputStream)Unit" id="11057">toBytes</a><span class="delimiter">(</span><a title="java.io.OutputStream" id="75300">outputStream</a>: <span title="java.io.OutputStream">OutputStream</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="org.apache.avro.io.BinaryEncoder" id="75304">enc</a> = <span title="object org.apache.avro.io.EncoderFactory">EncoderFactory</span>.<span title="()org.apache.avro.io.EncoderFactory">get</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: java.io.OutputStream, x$2: org.apache.avro.io.BinaryEncoder)org.apache.avro.io.BinaryEncoder">binaryEncoder</span><span class="delimiter">(</span><a href="#75300" title="java.io.OutputStream">outputStream</a>,<span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
    <a href="#11052" title="=&gt; org.apache.avro.specific.SpecificDatumWriter[ScalaSpecificRecord.this.type]">__writer__</a>.<span title="(x$1: ScalaSpecificRecord.this.type, x$2: org.apache.avro.io.Encoder)Unit">write</span><span class="delimiter">(</span><a href="#9708" title="ScalaSpecificRecord.this.type" class="keyword">this</a>, <a href="#75304" title="org.apache.avro.io.BinaryEncoder">enc</a><span class="delimiter">)</span>
    <a href="#75304" title="org.apache.avro.io.BinaryEncoder">enc</a>.<span title="()Unit">flush</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(data: Array[Byte])ScalaSpecificRecord.this.type" id="11058">parse</a><span class="delimiter">(</span><a title="Array[Byte]" id="75312">data</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span class="keyword">this</span>.<span class="keyword">type</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.io.ByteArrayInputStream" id="75314">stream</a> = <span title="java.io.ByteArrayInputStream" class="keyword">new</span> <span title="java.io.ByteArrayInputStream">ByteArrayInputStream</span><span class="delimiter">(</span><a href="#75312" title="Array[Byte]">data</a><span class="delimiter">)</span>
    <a href="#11059" title="(inputStream: java.io.InputStream)ScalaSpecificRecord.this.type">parse</a><span class="delimiter">(</span><a href="#75314" title="java.io.ByteArrayInputStream">stream</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(inputStream: java.io.InputStream)ScalaSpecificRecord.this.type" id="11059">parse</a><span class="delimiter">(</span><a title="java.io.InputStream" id="75344">inputStream</a>: <span title="java.io.InputStream">InputStream</span><span class="delimiter">)</span>: <span class="keyword">this</span>.<span class="keyword">type</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="org.apache.avro.io.BinaryDecoder" id="75348">dec</a> = <span title="object org.apache.avro.io.DecoderFactory">DecoderFactory</span>.<span title="()org.apache.avro.io.DecoderFactory">get</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: java.io.InputStream, x$2: org.apache.avro.io.BinaryDecoder)org.apache.avro.io.BinaryDecoder">directBinaryDecoder</span><span class="delimiter">(</span><a href="#75344" title="java.io.InputStream">inputStream</a>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
    <a href="#11054" title="=&gt; org.apache.avro.specific.SpecificDatumReader[ScalaSpecificRecord.this.type]">__reader__</a>.<span title="(x$1: ScalaSpecificRecord.this.type, x$2: org.apache.avro.io.Decoder)ScalaSpecificRecord.this.type">read</span><span class="delimiter">(</span><a href="#9708" title="ScalaSpecificRecord.this.type" class="keyword">this</a>, <a href="#75348" title="org.apache.avro.io.BinaryDecoder">dec</a><span class="delimiter">)</span>
    <a href="#9708" title="ScalaSpecificRecord.this.type" class="keyword">this</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(generic: org.apache.avro.generic.GenericData.Record)ScalaSpecificRecord.this.type" id="11060">fromGenericRecord</a><span class="delimiter">(</span><a title="org.apache.avro.generic.GenericData.Record" id="75356">generic</a>: GenericData.<span title="org.apache.avro.generic.GenericData.Record">Record</span><span class="delimiter">)</span>: <span class="keyword">this</span>.<span class="keyword">type</span> =
    <a href="#9704" title="object edu.berkeley.cs.avro.runtime.ScalaSpecificRecordHelpers">ScalaSpecificRecordHelpers</a>.<a href="#74776" title="(specific: edu.berkeley.cs.avro.runtime.ScalaSpecificRecord, generic: org.apache.avro.generic.IndexedRecord)edu.berkeley.cs.avro.runtime.ScalaSpecificRecord">fromGenericRecord</a><span class="delimiter">(</span><a href="#9708" title="edu.berkeley.cs.avro.runtime.ScalaSpecificRecord" class="keyword">this</a>, <a href="#75356" title="org.apache.avro.generic.GenericData.Record">generic</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="ScalaSpecificRecord.this.type" class="delimiter">[</span><span class="keyword">this</span>.<span class="keyword">type</span><span class="delimiter">]</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class AvroPairGenericRecord extends org.apache.avro.generic.GenericData.Record with ScalaObject" id="9709">AvroPairGenericRecord</a><a href="#9709" title="ScalaObject" class="delimiter">(</a><a title="org.apache.avro.specific.SpecificRecord" id="75378">pair</a>: <span title="org.apache.avro.specific.SpecificRecord">SpecificRecord</span>, <a title="Int" id="75379">offset</a>: <span title="Int">Int</span>, <a title="org.apache.avro.Schema" id="75380">schema</a>: <span title="org.apache.avro.Schema">Schema</span><span class="delimiter">)</span> 
  <span class="keyword">extends</span> <span title="object org.apache.avro.generic.GenericData">GenericData</span>.<span title="org.apache.avro.generic.GenericData.Record">Record</span><span class="delimiter">(</span><a href="#75380" title="org.apache.avro.Schema">schema</a><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(i: Int)java.lang.Object" id="75370">get</a><span class="delimiter">(</span><a title="Int" id="75386">i</a>: <span title="Int">Int</span><span class="delimiter">)</span> = 
    <a href="#75378" title="org.apache.avro.specific.SpecificRecord">pair</a>.<span title="(x$1: Int)java.lang.Object">get</span><span class="delimiter">(</span><a href="#75386" title="Int">i</a> <span title="(x: Int)Int">+</span> <a href="#75379" title="Int">offset</a><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(i: Int, v: Any)Unit" id="75371">put</a><span class="delimiter">(</span><a title="Int" id="75395">i</a>: <span title="Int">Int</span>, <a title="Any" id="75396">v</a>: <span title="Any">Any</span><span class="delimiter">)</span> =
    <a href="#75378" title="org.apache.avro.specific.SpecificRecord">pair</a>.<span title="(x$1: Int, x$2: Any)Unit">put</span><span class="delimiter">(</span><a href="#75395" title="Int">i</a> <span title="(x: Int)Int">+</span> <a href="#75379" title="Int">offset</a>, <a href="#75396" title="Any">v</a><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(s: String)java.lang.Object" id="75372">get</a><span class="delimiter">(</span><a title="String" id="75405">s</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#75380" title="org.apache.avro.Schema">schema</a>.<span title="(x$1: java.lang.String)org.apache.avro.Schema.Field">getField</span><span class="delimiter">(</span><a href="#75405" title="String">s</a><span class="delimiter">)</span> <span title="java.lang.Object" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="Nothing" class="keyword">null</span> =&gt; 
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;No such field: &quot;)" class="string">&quot;No such field: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#75405" title="String">s</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <a title="java.lang.Object" id="75414">field</a> =&gt; <a href="#75370" title="(i: Int)java.lang.Object">get</a><span class="delimiter">(</span><a href="#75414" title="org.apache.avro.Schema.Field">field</a>.<span title="()Int">pos</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(s: String, v: Any)Unit" id="75373">put</a><span class="delimiter">(</span><a title="String" id="75421">s</a>: <span title="String">String</span>, <a title="Any" id="75422">v</a>: <span title="Any">Any</span><span class="delimiter">)</span> = <a href="#75380" title="org.apache.avro.Schema">schema</a>.<span title="(x$1: java.lang.String)org.apache.avro.Schema.Field">getField</span><span class="delimiter">(</span><a href="#75421" title="String">s</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="Nothing" class="keyword">null</span> =&gt; 
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;No such field: &quot;)" class="string">&quot;No such field: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#75421" title="String">s</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <a title="Unit" id="75431">field</a> =&gt; <a href="#75371" title="(i: Int, v: Any)Unit">put</a><span class="delimiter">(</span><a href="#75431" title="org.apache.avro.Schema.Field">field</a>.<span title="()Int">pos</span>, <a href="#75422" title="Any">v</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>