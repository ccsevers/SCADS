<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>plugin/CtorRetype.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs.avro
<span class="keyword">package</span> plugin

<span class="keyword">import</span> scala.tools._
<span class="keyword">import</span> nsc.Global
<span class="keyword">import</span> nsc.Phase
<span class="keyword">import</span> nsc.plugins.Plugin
<span class="keyword">import</span> nsc.plugins.PluginComponent
<span class="keyword">import</span> nsc.transform.Transform
<span class="keyword">import</span> nsc.transform.InfoTransform
<span class="keyword">import</span> nsc.transform.TypingTransformers
<span class="keyword">import</span> nsc.symtab.<span title="object scala.tools.nsc.symtab.Flags">Flags</span>._
<span class="keyword">import</span> nsc.util.Position
<span class="keyword">import</span> nsc.util.NoPosition
<span class="keyword">import</span> nsc.ast.TreeDSL
<span class="keyword">import</span> nsc.typechecker
<span class="keyword">import</span> scala.annotation.tailrec

<span class="keyword">import</span> scala.collection.<span title="object scala.collection.JavaConversions">JavaConversions</span>._

<span class="keyword">trait</span> <a title="trait CtorRetype extends scala.tools.nsc.plugins.PluginComponent with edu.berkeley.cs.avro.plugin.ScalaAvroPluginComponent with scala.tools.nsc.transform.Transform with scala.tools.nsc.transform.TypingTransformers with scala.tools.nsc.ast.TreeDSL with ScalaObject" id="9501">CtorRetype</a>  <span title="ScalaObject" class="keyword">extends</span> <a href="ScalaAvroPlugin.scala.html#9582" title="edu.berkeley.cs.avro.plugin.ScalaAvroPluginComponent">ScalaAvroPluginComponent</a>
                  <span class="keyword">with</span>    <span title="scala.tools.nsc.transform.Transform">Transform</span>
                  <span class="keyword">with</span>    <span title="scala.tools.nsc.transform.TypingTransformers">TypingTransformers</span>
                  <span class="keyword">with</span>    <span title="scala.tools.nsc.ast.TreeDSL">TreeDSL</span> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="#9501" title="=&gt; scala.tools.nsc.Global">global</a>._
  <span class="keyword">import</span> <a href="#9501" title="object CtorRetype.this.global.definitions">definitions</a>._
  	  
  <span class="keyword">val</span> <a title="List[String]" id="21716">runsAfter</a> = <span title="[A](xs: A*)List[A]">List</span><span title="(xs: String*)List[String]" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="java.lang.String(&quot;extender&quot;)" class="string">&quot;extender&quot;</span><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">val</span> <a title="Some[java.lang.String]" id="21718">runsRightAfter</a> = <span title="(x: java.lang.String)Some[java.lang.String]">Some</span><span class="delimiter">(</span><span title="java.lang.String(&quot;extender&quot;)" class="string">&quot;extender&quot;</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="java.lang.String" id="21720">phaseName</a> = <span title="java.lang.String(&quot;ctorretype&quot;)" class="string">&quot;ctorretype&quot;</span>
  <span class="keyword">def</span> <a title="(unit: CtorRetype.this.global.CompilationUnit)CtorRetype.this.CtorRetypeTransformer" id="21722">newTransformer</a><span class="delimiter">(</span><a title="CtorRetype.this.global.CompilationUnit" id="31346">unit</a>: <span title="CtorRetype.this.global.CompilationUnit">CompilationUnit</span><span class="delimiter">)</span> = <span title="CtorRetype.this.CtorRetypeTransformer" class="keyword">new</span> <a href="#21723" title="CtorRetype.this.CtorRetypeTransformer">CtorRetypeTransformer</a><span class="delimiter">(</span><a href="#31346" title="CtorRetype.this.global.CompilationUnit">unit</a><span class="delimiter">)</span>    

  <span class="keyword">class</span> <a title="class CtorRetypeTransformer extends CtorRetype.this.TypingTransformer with ScalaObject" id="21723">CtorRetypeTransformer</a><a href="#21723" title="ScalaObject" class="delimiter">(</a><a title="CtorRetype.this.global.CompilationUnit" id="31355">unit</a>: <span title="CtorRetype.this.global.CompilationUnit">CompilationUnit</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#9501" title="CtorRetype.this.TypingTransformer">TypingTransformer</a><span class="delimiter">(</span><a href="#31355" title="CtorRetype.this.global.CompilationUnit">unit</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#9501" title="object CtorRetype.this.CODE">CODE</a>._

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: CtorRetype.this.global.Tree)CtorRetype.this.global.Tree" id="31354">transform</a><span class="delimiter">(</span><a title="CtorRetype.this.global.Tree" id="31359">tree</a>: <span title="CtorRetype.this.global.Tree">Tree</span><span class="delimiter">)</span> : <span title="CtorRetype.this.global.Tree">Tree</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="CtorRetype.this.global.analyzer.global.Tree" id="31364">newTree</a> = <a href="#31359" title="CtorRetype.this.global.Tree">tree</a> <span title="CtorRetype.this.global.analyzer.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="comment">// REMOVE synthethic hashCode and toString methods generated by typer</span>
        <span class="comment">// for an AvroRecord (we want to use the impl in SpecificRecordBase)</span>
        <span class="keyword">case</span> <a title="CtorRetype.this.global.ClassDef" id="31365">cd</a> @ ClassDef<span class="delimiter">(</span><a title="CtorRetype.this.global.Modifiers" id="31464">mods</a>, <a title="CtorRetype.this.global.TypeName" id="31465">name</a>, <a title="List[CtorRetype.this.global.TypeDef]" id="31466">tparams</a>, <a title="CtorRetype.this.global.Template" id="31467">impl</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="ScalaAvroPlugin.scala.html#21653" title="(tree: CtorRetype.this.global.Tree)Boolean">isMarked</a><span class="delimiter">(</span><a href="#31365" title="CtorRetype.this.global.ClassDef">cd</a><span class="delimiter">)</span> =&gt;
          <a href="ScalaAvroPlugin.scala.html#21648" title="(a: AnyRef)Unit">debug</a><span class="delimiter">(</span><span title="java.lang.String(&quot;removing synthetic methods for: &quot;)" class="string">&quot;removing synthetic methods for: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#21723" title="=&gt; CtorRetype.this.global.Symbol">currentClass</a>.<span title="=&gt; String">fullName</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="List[CtorRetype.this.global.Tree]" id="31598">newBody</a> = <a href="#31467" title="CtorRetype.this.global.Template">impl</a>.<span title="=&gt; List[CtorRetype.this.global.Tree]">body</span>.<span title="(p: CtorRetype.this.global.Tree =&gt; Boolean)List[CtorRetype.this.global.Tree]">filterNot</span> <a href="#34737" title="Boolean" class="delimiter">{</a> 
            <span class="keyword">case</span> <a title="Boolean" id="34738">d</a> @ DefDef<span class="delimiter">(</span>_, _, _, _, _, _<span class="delimiter">)</span> =&gt; 
              <a href="#34738" title="CtorRetype.this.global.DefDef">d</a>.<span title="=&gt; CtorRetype.this.global.Symbol">symbol</span>.<span title="(mask: Long)Boolean">hasFlag</span><span class="delimiter">(</span><span title="Long(2097152L)">SYNTHETIC</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> 
              <span class="delimiter">(</span><a href="#34738" title="CtorRetype.this.global.DefDef">d</a>.<span title="=&gt; CtorRetype.this.global.Symbol">symbol</span>.<span title="=&gt; CtorRetype.this.global.Name">name</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#9501" title="object CtorRetype.this.global.nme">nme</a>.<span title="=&gt; CtorRetype.this.global.nme.NameType">toString_</span> <span title="(x: Boolean)Boolean">||</span> <a href="#34738" title="CtorRetype.this.global.DefDef">d</a>.<span title="=&gt; CtorRetype.this.global.Symbol">symbol</span>.<span title="=&gt; CtorRetype.this.global.Name">name</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#9501" title="object CtorRetype.this.global.nme">nme</a>.<span title="=&gt; CtorRetype.this.global.nme.NameType">hashCode_</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
          <span class="delimiter">}</span>
          <span class="keyword">val</span> <a title="CtorRetype.this.global.Template" id="31599">newImpl</a> = <a href="#21723" title="=&gt; CtorRetype.this.global.TreeCopier">treeCopy</a>.<span title="(tree: CtorRetype.this.global.Tree, parents: List[CtorRetype.this.global.Tree], self: CtorRetype.this.global.ValDef, body: List[CtorRetype.this.global.Tree])CtorRetype.this.global.Template">Template</span><span class="delimiter">(</span><a href="#31467" title="CtorRetype.this.global.Template">impl</a>, <a href="#31467" title="CtorRetype.this.global.Template">impl</a>.<span title="=&gt; List[CtorRetype.this.global.Tree]">parents</span>, <a href="#31467" title="CtorRetype.this.global.Template">impl</a>.<span title="=&gt; CtorRetype.this.global.ValDef">self</span>, <a href="#31598" title="List[CtorRetype.this.global.Tree]">newBody</a><span class="delimiter">)</span>
          <a href="#21723" title="=&gt; CtorRetype.this.global.TreeCopier">treeCopy</a>.<span title="(tree: CtorRetype.this.global.Tree, mods: CtorRetype.this.global.Modifiers, name: CtorRetype.this.global.Name, tparams: List[CtorRetype.this.global.TypeDef], impl: CtorRetype.this.global.Template)CtorRetype.this.global.ClassDef">ClassDef</span><span class="delimiter">(</span><a href="#31359" title="CtorRetype.this.global.Tree">tree</a>, <a href="#31464" title="CtorRetype.this.global.Modifiers">mods</a>, <a href="#31465" title="CtorRetype.this.global.TypeName">name</a>, <a href="#31466" title="List[CtorRetype.this.global.TypeDef]">tparams</a>, <a href="#31599" title="CtorRetype.this.global.Template">newImpl</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="CtorRetype.this.global.analyzer.global.Tree" id="35029">a</a> @ Apply<span class="delimiter">(</span><a title="CtorRetype.this.global.Select" id="35047">sel</a> @ Select<span class="delimiter">(</span><a title="CtorRetype.this.global.Super" id="35054">sup</a> @ Super<span class="delimiter">(</span><a title="CtorRetype.this.global.Tree" id="35061">qual</a>, <a title="CtorRetype.this.global.TypeName" id="35062">name</a><span class="delimiter">)</span>, <a title="CtorRetype.this.global.Name" id="35063">name1</a><span class="delimiter">)</span>, <a title="List[CtorRetype.this.global.Tree]" id="35064">args</a><span class="delimiter">)</span> =&gt; 
          <span title="CtorRetype.this.global.analyzer.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="ScalaAvroPlugin.scala.html#21654" title="(sym: CtorRetype.this.global.Symbol)Boolean">isMarked</a><span class="delimiter">(</span><a href="#21723" title="=&gt; CtorRetype.this.global.Symbol">currentClass</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="ScalaAvroPlugin.scala.html#21648" title="(a: AnyRef)Unit">debug</a><span class="delimiter">(</span><span title="java.lang.String(&quot;retyping ctor reference for: &quot;)" class="string">&quot;retyping ctor reference for: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#21723" title="=&gt; CtorRetype.this.global.Symbol">currentClass</a>.<span title="=&gt; String">fullName</span><span class="delimiter">)</span>
            <a href="#21723" title="=&gt; CtorRetype.this.global.analyzer.Typer">localTyper</a> <span title="(tree: CtorRetype.this.global.analyzer.global.Tree)CtorRetype.this.global.analyzer.global.Tree">typed</span> <span class="delimiter">{</span>
              <a href="#9501" title="(fun: CtorRetype.this.global.Tree, args: List[CtorRetype.this.global.Tree])CtorRetype.this.global.Apply">Apply</a><span class="delimiter">(</span><a href="#9501" title="(qualifier: CtorRetype.this.global.Tree, name: CtorRetype.this.global.Name)CtorRetype.this.global.Select">Select</a><span class="delimiter">(</span><a href="#9501" title="(qual: CtorRetype.this.global.Tree, mix: CtorRetype.this.global.TypeName)CtorRetype.this.global.Super">Super</a><span class="delimiter">(</span><a href="#35061" title="CtorRetype.this.global.Tree">qual</a>, <a href="#35062" title="CtorRetype.this.global.TypeName">name</a><span class="delimiter">)</span> <span title="(pos: scala.tools.nsc.util.Position)CtorRetype.this.global.Super">setPos</span> <a href="#35054" title="CtorRetype.this.global.Super">sup</a>.<span title="=&gt; CtorRetype.this.global.Position">pos</span>, <a href="#35063" title="CtorRetype.this.global.Name">name1</a><span class="delimiter">)</span> <span title="(pos: scala.tools.nsc.util.Position)CtorRetype.this.global.Select">setPos</span> <a href="#35047" title="CtorRetype.this.global.Select">sel</a>.<span title="=&gt; CtorRetype.this.global.Position">pos</span>, <a href="#21723" title="(trees: List[CtorRetype.this.global.Tree])List[CtorRetype.this.global.Tree]">transformTrees</a><span class="delimiter">(</span><a href="#35064" title="List[CtorRetype.this.global.Tree]">args</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(pos: scala.tools.nsc.util.Position)CtorRetype.this.global.Apply">setPos</span> <a href="#31359" title="CtorRetype.this.global.Tree">tree</a>.<span title="=&gt; CtorRetype.this.global.Position">pos</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            <a href="ScalaAvroPlugin.scala.html#21648" title="(a: AnyRef)Unit">debug</a><span class="delimiter">(</span><span title="java.lang.String(&quot;skipping super reference: &quot;)" class="string">&quot;skipping super reference: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#21723" title="=&gt; CtorRetype.this.global.Symbol">currentClass</a>.<span title="=&gt; String">fullName</span><span class="delimiter">)</span>
            <a href="#31359" title="CtorRetype.this.global.Tree">tree</a>
          <span class="delimiter">}</span>
        <span class="keyword">case</span> <span title="CtorRetype.this.global.Tree">_</span> =&gt; <a href="#31359" title="CtorRetype.this.global.Tree">tree</a>
      <span class="delimiter">}</span>
      <a href="#21723" title="CtorRetype.this.CtorRetypeTransformer" class="keyword">super</a>.<span title="(tree: CtorRetype.this.global.Tree)CtorRetype.this.global.Tree">transform</span><span class="delimiter">(</span><a href="#31364" title="CtorRetype.this.global.analyzer.global.Tree">newTree</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>    
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>