<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>Experiment.scala</title>
        <script type="text/javascript" src="jquery-all.js"></script>
        <script type="text/javascript" src="linked.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs.scads.perf

<span class="keyword">import</span> deploylib.ec2._
<span class="keyword">import</span> deploylib.mesos._
<span class="keyword">import</span> edu.berkeley.cs.scads.comm._
<span class="keyword">import</span> edu.berkeley.cs.scads.config._
<span class="keyword">import</span> edu.berkeley.cs.scads.storage._
<span class="keyword">import</span> edu.berkeley.cs.avro.runtime._
<span class="keyword">import</span> edu.berkeley.cs.avro.marker._

<span class="keyword">import</span> org.apache.zookeeper.CreateMode

<span class="keyword">import</span> java.io.File
<span class="keyword">import</span> net.lag.logging.Logger

<span class="keyword">class</span> <a title="class ExperimentalScadsCluster extends edu.berkeley.cs.scads.storage.ScadsCluster with ScalaObject" id="9516">ExperimentalScadsCluster</a><a href="#9516" title="ScalaObject" class="delimiter">(</a><a title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode" id="30893">root</a>: ZooKeeperProxy#<span title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">ZooKeeperNode</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="edu.berkeley.cs.scads.storage.ScadsCluster">ScadsCluster</span><span class="delimiter">(</span><a href="#30893" title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">root</a><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(clusterSize: Int)Unit" id="30886">blockUntilReady</a><span class="delimiter">(</span><a title="Int" id="30898">clusterSize</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">while</span><span class="delimiter">(</span><a href="#9516" title="()List[edu.berkeley.cs.scads.comm.StorageService]">getAvailableServers</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">&lt;</span> <a href="#30898" title="Int">clusterSize</a><span class="delimiter">)</span> <a href="#30900" title="()Unit" class="delimiter">{</a>
      <a href="#9516" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Waiting for cluster to start &quot;)" class="string">&quot;Waiting for cluster to start &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#9516" title="=&gt; edu.berkeley.cs.scads.storage.ScadsCluster">cluster</a>.<span title="()List[edu.berkeley.cs.scads.comm.StorageService]">getAvailableServers</span>.<span title="=&gt; Int">size</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; of &quot;)" class="string">&quot; of &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#30898" title="Int">clusterSize</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; ready.&quot;)" class="string">&quot; ready.&quot;</span><span class="delimiter">)</span>
      <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><span title="Long(1000L)" class="int">1000</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait ExperimentBase extends java.lang.Object with ScalaObject" id="9517">ExperimentBase</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">var</span> <a title="java.lang.String" id="30992">resultClusterAddress</a> = <span title="object edu.berkeley.cs.scads.config.Config">Config</span>.<span title="=&gt; net.lag.configgy.Config">config</span>.<span title="(key: String)Option[String]">getString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;scads.perf.resultZooKeeperAddress&quot;)" class="string">&quot;scads.perf.resultZooKeeperAddress&quot;</span><span class="delimiter">)</span>.<span title="(default: =&gt; String)String">getOrElse</span><span class="delimiter">(</span>sys.<span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="java.lang.String(&quot;need to specify scads.perf.resultZooKeeperAddress&quot;)" class="string">&quot;need to specify scads.perf.resultZooKeeperAddress&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;home/&quot;)" class="string">&quot;home/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="object java.lang.System">System</span>.<span title="(x$1: java.lang.String)java.lang.String">getenv</span><span class="delimiter">(</span><span title="java.lang.String(&quot;USER&quot;)" class="string">&quot;USER&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;/deploylib/&quot;)" class="string">&quot;/deploylib/&quot;</span>
  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.ScadsCluster" id="30994">resultCluster</a> = <span title="edu.berkeley.cs.scads.storage.ScadsCluster" class="keyword">new</span> <span title="edu.berkeley.cs.scads.storage.ScadsCluster">ScadsCluster</span><span class="delimiter">(</span><span title="(uri: String)edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">ZooKeeperNode</span><span class="delimiter">(</span><a href="#30992" title="=&gt; java.lang.String">resultClusterAddress</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit edu.berkeley.cs.scads.perf.ExperimentBase.productSeqToExcel : (lines: Seq[Product])java.lang.Object{def toExcel: Unit}" id="30996">productSeqToExcel</a><span class="delimiter">(</span><a title="Seq[Product]" id="32028">lines</a>: <span title="Seq[Product]">Seq</span><span class="delimiter">[</span>Product<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#32031" title="java.lang.Object{def toExcel: Unit}" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object" id="32031" class="delimiter">{</a>
    <span class="keyword">import</span> java.io._
    <span class="keyword">def</span> <a title="=&gt; Unit" id="32034">toExcel</a>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.io.File" id="32036">file</a> = <span title="object java.io.File">File</span>.<span title="(x$1: java.lang.String, x$2: java.lang.String)java.io.File">createTempFile</span><span class="delimiter">(</span><span title="java.lang.String(&quot;scadsOut&quot;)" class="string">&quot;scadsOut&quot;</span>, <span title="java.lang.String(&quot;.csv&quot;)" class="string">&quot;.csv&quot;</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.io.FileWriter" id="32037">writer</a> = <span title="(x$1: java.io.File)java.io.FileWriter" class="keyword">new</span> <span title="java.io.FileWriter">FileWriter</span><span class="delimiter">(</span><a href="#32036" title="java.io.File">file</a><span class="delimiter">)</span>

      <a href="#32028" title="Seq[Product]">lines</a>.<span title="(f: Product =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[Product],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#32243" title="Product">_</a>.<span title="=&gt; Iterator[Any]">productIterator</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>.<span title="(f: java.lang.String =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#32037" title="java.io.FileWriter">writer</a>.<a href="#32577" title="(x$1: java.lang.String)Unit">write</a><span class="delimiter">)</span>
      <a href="#32037" title="java.io.FileWriter">writer</a>.<span title="()Unit">close</span>

      <span title="object java.lang.Runtime">Runtime</span>.<span title="()java.lang.Runtime">getRuntime</span>.<span title="(x$1: Array[java.lang.String])java.lang.Process">exec</span><span title="Unit" class="delimiter">(</span><span title="(xs: java.lang.String*)(implicit evidence$2: scala.reflect.ClassManifest[java.lang.String])Array[java.lang.String]">Array</span><span title="(clazz: java.lang.Class[_])scala.reflect.ClassManifest[java.lang.String]" class="delimiter">(</span><span title="java.lang.String(&quot;/usr/bin/open&quot;)" class="string">&quot;/usr/bin/open&quot;</span>, <a href="#32036" title="java.io.File">file</a>.<span title="()java.lang.String">getCanonicalPath</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait TaskBase extends java.lang.Object with ScalaObject" id="9518">TaskBase</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(size: Int)(implicit cluster: deploylib.mesos.Cluster, implicit classSource: Seq[edu.berkeley.cs.scads.comm.ClassSource])edu.berkeley.cs.scads.storage.ScadsCluster" id="32689">newScadsCluster</a><span class="delimiter">(</span><a title="Int" id="32692">size</a>: <span title="Int">Int</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="deploylib.mesos.Cluster" id="32693">cluster</a>: <span title="deploylib.mesos.Cluster">Cluster</span>, <a title="Seq[edu.berkeley.cs.scads.comm.ClassSource]" id="32694">classSource</a>: <span title="Seq[edu.berkeley.cs.scads.comm.ClassSource]">Seq</span><span class="delimiter">[</span>ClassSource<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="edu.berkeley.cs.scads.storage.ScadsCluster">ScadsCluster</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode" id="32773">clusterRoot</a> = <a href="#32693" title="deploylib.mesos.Cluster">cluster</a>.<a title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode" id="32809">zooKeeperRoot</a>.<a href="#32809" title="Int" id="32811">getOrCreate</a><a title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode" id="32812" class="delimiter">(</a><a title="java.lang.String(&quot;scads&quot;)" id="32810" class="string">&quot;scads&quot;</a><span class="delimiter">)</span>.<a href="#32812" title="Array[Byte]" id="32815">createChild</a><span class="delimiter">(</span><a title="java.lang.String(&quot;experimentCluster&quot;)" id="32813" class="string">&quot;experimentCluster&quot;</a>, mode = CreateMode.<a title="org.apache.zookeeper.CreateMode(value PERSISTENT_SEQUENTIAL)" id="32814">PERSISTENT_SEQUENTIAL</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Array[edu.berkeley.cs.scads.comm.JvmMainTask]" id="32774">serverProcs</a> = <span title="object Array">Array</span>.<span title="(n: Int)(elem: =&gt; edu.berkeley.cs.scads.comm.JvmMainTask)(implicit evidence$9: scala.reflect.ClassManifest[edu.berkeley.cs.scads.comm.JvmMainTask])Array[edu.berkeley.cs.scads.comm.JvmMainTask]">fill</span><span class="delimiter">(</span><a href="#32692" title="Int">size</a><span class="delimiter">)</span><span title="(clazz: java.lang.Class[_])scala.reflect.ClassManifest[edu.berkeley.cs.scads.comm.JvmMainTask]" class="delimiter">(</span><span title="(clusterAddress: String, dbDir: Option[String], cachePercentage: Option[Int], name: Option[String])edu.berkeley.cs.scads.storage.ScalaEngineTask">ScalaEngineTask</span><span class="delimiter">(</span>clusterAddress=<a href="#32773" title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">clusterRoot</a>.<span title="=&gt; java.lang.String">canonicalAddress</span><span class="delimiter">)</span>.<a href="#32694" title="(implicit classSource: Seq[edu.berkeley.cs.scads.comm.ClassSource])edu.berkeley.cs.scads.comm.JvmMainTask">toJvmTask</a><span class="delimiter">)</span>

    <a href="#32693" title="deploylib.mesos.Cluster">cluster</a>.<span title="=&gt; deploylib.mesos.RemoteServiceScheduler">serviceScheduler</span>.<span title="(processes: Seq[edu.berkeley.cs.scads.comm.JvmTask])Unit">scheduleExperiment</span><span class="delimiter">(</span><a href="#32774" title="(xs: Array[edu.berkeley.cs.scads.comm.JvmMainTask])scala.collection.mutable.WrappedArray[edu.berkeley.cs.scads.comm.JvmMainTask]">serverProcs</a><span class="delimiter">)</span>
    <span title="edu.berkeley.cs.scads.storage.ScadsCluster" class="keyword">new</span> <span title="edu.berkeley.cs.scads.storage.ScadsCluster">ScadsCluster</span><span class="delimiter">(</span><a href="#32773" title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">clusterRoot</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>