<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>IntKeySinglePartition.scala</title>
        <script type="text/javascript" src="jquery-all.js"></script>
        <script type="text/javascript" src="linked.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs
<span class="keyword">package</span> scads
<span class="keyword">package</span> perf
<span class="keyword">package</span> intkey.singlenode

<span class="keyword">import</span> deploylib._
<span class="keyword">import</span> deploylib.mesos._
<span class="keyword">import</span> avro.marker._
<span class="keyword">import</span> comm._
<span class="keyword">import</span> config._
<span class="keyword">import</span> storage._

<span class="keyword">import</span> net.lag.logging.Logger

case <span class="keyword">class</span> <a title="class Result extends org.apache.avro.specific.SpecificRecordBase with edu.berkeley.cs.avro.runtime.HasAvroConversions with edu.berkeley.cs.avro.marker.AvroPair with ScalaObject with Product with Serializable" id="48646">Result</a><a href="#48646" title="ScalaObject" class="delimiter">(</a><a href="#48646" title="()edu.berkeley.cs.scads.perf.intkey.singlenode.Result" id="51441" class="keyword">var</a> <a title="String" id="48422">hostname</a>: <span title="String">String</span>,
		  <span class="keyword">var</span> <a title="Long" id="48423">timestamp</a>: <span title="Long">Long</span>,
		  <span class="keyword">var</span> <a title="Int" id="48424">iteration</a>: <span title="Int">Int</span>,
		  <span class="keyword">var</span> <a title="Int" id="48425">dataSize</a>: <span title="Int">Int</span>,
		  <span class="keyword">var</span> <a title="Int" id="48426">recordCount</a>: <span title="Int">Int</span>,
		  <span class="keyword">var</span> <a title="Int" id="48427">threadCount</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="edu.berkeley.cs.avro.marker.AvroPair">AvroPair</span> <span class="delimiter">{</span>
  <span class="keyword">var</span> <a title="Int" id="44725">lastCount</a>: <span title="Int">Int</span> = _
  <span class="keyword">var</span> <a title="Long" id="44728">loadTimeMs</a>: <span title="Long">Long</span> = _
  <span class="keyword">var</span> <a title="Long" id="44731">runTimeMs</a>: <span title="Long">Long</span> =  _
  <span class="keyword">var</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="44734">responseTimes</a>: <a href="Histogram.scala.html#9528" title="edu.berkeley.cs.scads.perf.Histogram">Histogram</a> = <span title="Null(null)" class="keyword">null</span>
  <span class="keyword">var</span> <a title="Int" id="44737">failures</a>: <span title="Int">Int</span> = _
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.perf.intkey.singlenode.Experiment" id="9576">Experiment</a> <span title="ScalaObject" class="keyword">extends</span> <a href="Experiment.scala.html#9517" title="edu.berkeley.cs.scads.perf.ExperimentBase">ExperimentBase</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(implicit cluster: deploylib.mesos.Cluster, implicit classSource: Seq[edu.berkeley.cs.scads.comm.ClassSource])Unit" id="44877">storageTippingPoint</a><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="deploylib.mesos.Cluster" id="44924">cluster</a>: deploylib.mesos.<span title="deploylib.mesos.Cluster">Cluster</span>, <a title="Seq[edu.berkeley.cs.scads.comm.ClassSource]" id="44925">classSource</a>: <span title="Seq[edu.berkeley.cs.scads.comm.ClassSource]">Seq</span><span class="delimiter">[</span>ClassSource<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.immutable.Set[Int]" id="44927">done</a> = <a href="#44884" title="=&gt; scala.collection.immutable.Iterable[(Int, Int, Int, Int, Long, Int, Int)]">graphPoints</a>.<span title="(f: (Int, Int, Int, Int, Long, Int, Int) =&gt; Int)scala.collection.immutable.Map[Int,scala.collection.immutable.Iterable[(Int, Int, Int, Int, Long, Int, Int)]]">groupBy</span><span class="delimiter">(</span><a href="#45907" title="(Int, Int, Int, Int, Long, Int, Int)">_</a>.<span title="=&gt; Int">_1</span><span class="delimiter">)</span>.<span title="(p: (Int, scala.collection.immutable.Iterable[(Int, Int, Int, Int, Long, Int, Int)]) =&gt; Boolean)scala.collection.immutable.Map[Int,scala.collection.immutable.Iterable[(Int, Int, Int, Int, Long, Int, Int)]]">filter</span><span class="delimiter">(</span><a href="#45934" title="(Int, scala.collection.immutable.Iterable[(Int, Int, Int, Int, Long, Int, Int)])">_</a>.<span title="=&gt; scala.collection.immutable.Iterable[(Int, Int, Int, Int, Long, Int, Int)]">_2</span>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span>.<span title="(f: (Int, scala.collection.immutable.Iterable[(Int, Int, Int, Int, Long, Int, Int)]) =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[Int,scala.collection.immutable.Iterable[(Int, Int, Int, Int, Long, Int, Int)]],Int,scala.collection.immutable.Iterable[Int]])scala.collection.immutable.Iterable[Int]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.Iterable.Coll,Int,scala.collection.immutable.Iterable[Int]]" class="delimiter">(</span><a href="#45958" title="(Int, scala.collection.immutable.Iterable[(Int, Int, Int, Int, Long, Int, Int)])">_</a>.<span title="=&gt; Int">_1</span><span class="delimiter">)</span>.<span title="scala.collection.immutable.Set[Int]">toSet</span>
    <a href="#46415" title="Int" id="46637">Task</a><span class="delimiter">(</span>recordCounts = <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">1</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <span title="Int(9)" class="int">9</span><span class="delimiter">)</span>.<span title="(f: Int =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[Int],Int,scala.collection.immutable.IndexedSeq[Int]])scala.collection.immutable.IndexedSeq[Int]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq.Coll,Int,scala.collection.immutable.IndexedSeq[Int]]" class="delimiter">(</span>math.<span title="(x: Double, y: Double)Double">pow</span><span class="delimiter">(</span><span title="Double(10.0)" class="int">10</span>, <a href="#46582" title="=&gt; Double">_</a><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span><span class="delimiter">)</span>.<span title="(p: Int =&gt; Boolean)scala.collection.immutable.IndexedSeq[Int]">filterNot</span><a title="scala.collection.immutable.IndexedSeq[Int]" id="46632" class="delimiter">(</a><a href="#44927" title="scala.collection.immutable.Set[Int]">done</a>.<a href="#46631" title="(elem: Int)Boolean">contains</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="#46411" title="(resultClusterAddress: String)(implicit cluster: deploylib.mesos.Cluster, implicit classSource: Seq[edu.berkeley.cs.scads.comm.ClassSource])Unit">schedule</a><a href="#44924" title="deploylib.mesos.Cluster" class="delimiter">(</a><a href="Experiment.scala.html#30991" title="=&gt; java.lang.String">resultClusterAddress</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(implicit cluster: deploylib.mesos.Cluster, implicit classSource: Seq[edu.berkeley.cs.scads.comm.ClassSource])Unit" id="44878">zoomIn</a><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="deploylib.mesos.Cluster" id="46642">cluster</a>: deploylib.mesos.<span title="deploylib.mesos.Cluster">Cluster</span>, <a title="Seq[edu.berkeley.cs.scads.comm.ClassSource]" id="46643">classSource</a>: <span title="Seq[edu.berkeley.cs.scads.comm.ClassSource]">Seq</span><span class="delimiter">[</span>ClassSource<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#46415" title="Int" id="46730">Task</a><span class="delimiter">(</span>recordCounts = <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">40000000</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <span title="Int(100000000)" class="int">100000000</span> <a title="scala.collection.immutable.Range" id="46725">by</a> <span title="Int(5000000)" class="int">5000000</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="#46411" title="(resultClusterAddress: String)(implicit cluster: deploylib.mesos.Cluster, implicit classSource: Seq[edu.berkeley.cs.scads.comm.ClassSource])Unit">schedule</a><a href="#46642" title="deploylib.mesos.Cluster" class="delimiter">(</a><a href="Experiment.scala.html#30991" title="=&gt; java.lang.String">resultClusterAddress</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(implicit cluster: deploylib.mesos.Cluster, implicit classSource: Seq[edu.berkeley.cs.scads.comm.ClassSource])Unit" id="44879">biggerRecs</a><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="deploylib.mesos.Cluster" id="46731">cluster</a>: deploylib.mesos.<span title="deploylib.mesos.Cluster">Cluster</span>, <a title="Seq[edu.berkeley.cs.scads.comm.ClassSource]" id="46732">classSource</a>: <span title="Seq[edu.berkeley.cs.scads.comm.ClassSource]">Seq</span><span class="delimiter">[</span>ClassSource<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#46415" title="Int" id="46877">Task</a><span class="delimiter">(</span>recordCounts = <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">1</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <span title="Int(9)" class="int">9</span><span class="delimiter">)</span>.<span title="(f: Int =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[Int],Int,Seq[Int]])Seq[Int]">map</span><a title="Seq[Int]" id="46872" class="delimiter">(</a>math.<span title="(x: Double, y: Double)Double">pow</span><span class="delimiter">(</span><span title="Double(10.0)" class="int">10</span>, <a href="#46845" title="=&gt; Double">_</a><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span><span class="delimiter">)</span>, dataSizes = <span title="(elems: Int*)Seq[Int]">Seq</span><a title="Seq[Int]" id="46873" class="delimiter">(</a><span title="Int(64)" class="int">64</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="#46411" title="(resultClusterAddress: String)(implicit cluster: deploylib.mesos.Cluster, implicit classSource: Seq[edu.berkeley.cs.scads.comm.ClassSource])Unit">schedule</a><a href="#46731" title="deploylib.mesos.Cluster" class="delimiter">(</a><a href="Experiment.scala.html#30991" title="=&gt; java.lang.String">resultClusterAddress</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(implicit cluster: deploylib.mesos.Cluster, implicit classSource: Seq[edu.berkeley.cs.scads.comm.ClassSource])Unit" id="44880">reset</a><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="deploylib.mesos.Cluster" id="46878">cluster</a>: deploylib.mesos.<span title="deploylib.mesos.Cluster">Cluster</span>, <a title="Seq[edu.berkeley.cs.scads.comm.ClassSource]" id="46879">classSource</a>: <span title="Seq[edu.berkeley.cs.scads.comm.ClassSource]">Seq</span><span class="delimiter">[</span>ClassSource<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#44881" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.perf.intkey.singlenode.Result]">results</a>.<span title="()Unit">delete</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#44881" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.perf.intkey.singlenode.Result]">results</a>.<span title="()Unit">open</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#46878" title="deploylib.mesos.Cluster">cluster</a>.<span title="()Unit">restart</span>
  <span class="delimiter">}</span> 

  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.perf.intkey.singlenode.Result]" id="44882">results</a> = <a href="Experiment.scala.html#30994" title="=&gt; edu.berkeley.cs.scads.storage.ScadsCluster">resultCluster</a>.<span title="[PairType &lt;: edu.berkeley.cs.avro.marker.AvroPair](ns: String)(implicit evidence$7: Manifest[PairType])edu.berkeley.cs.scads.storage.PairNamespace[PairType]">getNamespace</span><span title="(ns: String)(implicit evidence$7: Manifest[edu.berkeley.cs.scads.perf.intkey.singlenode.Result])edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.perf.intkey.singlenode.Result]" class="delimiter">[</span><a href="#48646" title="edu.berkeley.cs.scads.perf.intkey.singlenode.Result">Result</a><span class="delimiter">]</span><span title="(clazz: Class[_])scala.reflect.Manifest[edu.berkeley.cs.scads.perf.intkey.singlenode.Result]" class="delimiter">(</span><span title="java.lang.String(&quot;singleNodeResult&quot;)" class="string">&quot;singleNodeResult&quot;</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="=&gt; Iterator[edu.berkeley.cs.scads.perf.intkey.singlenode.Result]" id="44883">goodResults</a> = <a href="#44881" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.perf.intkey.singlenode.Result]">results</a>.<span title="(startKey: Option[org.apache.avro.generic.IndexedRecord], endKey: Option[org.apache.avro.generic.IndexedRecord])Iterator[edu.berkeley.cs.scads.perf.intkey.singlenode.Result]">iterateOverRange</span><span class="delimiter">(</span><span title="object None">None</span>,<span title="object None">None</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="=&gt; scala.collection.immutable.Iterable[(Int, Int, Int, Int, Long, Int, Int)]" id="44884">graphPoints</a> = <span class="delimiter">{</span>
    <a href="#44883" title="=&gt; Iterator[edu.berkeley.cs.scads.perf.intkey.singlenode.Result]">goodResults</a>.<span title="=&gt; Seq[edu.berkeley.cs.scads.perf.intkey.singlenode.Result]">toSeq</span>
      .<span title="(f: edu.berkeley.cs.scads.perf.intkey.singlenode.Result =&gt; (Int, Int))scala.collection.immutable.Map[(Int, Int),Seq[edu.berkeley.cs.scads.perf.intkey.singlenode.Result]]">groupBy</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.perf.intkey.singlenode.Result" id="45077">r</a> =&gt; <span title="(_1: Int, _2: Int)(Int, Int)" class="delimiter">(</span><a href="#45077" title="edu.berkeley.cs.scads.perf.intkey.singlenode.Result">r</a>.<a href="#48426" title="=&gt; Int">recordCount</a>, <a href="#45077" title="edu.berkeley.cs.scads.perf.intkey.singlenode.Result">r</a>.<a href="#48427" title="=&gt; Int">threadCount</a><span class="delimiter">)</span><span class="delimiter">)</span>
      .<span title="(f: ((Int, Int), Seq[edu.berkeley.cs.scads.perf.intkey.singlenode.Result]) =&gt; (Int, Int, Int, Int, Long, Int, Int))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[(Int, Int),Seq[edu.berkeley.cs.scads.perf.intkey.singlenode.Result]],(Int, Int, Int, Int, Long, Int, Int),scala.collection.immutable.Iterable[(Int, Int, Int, Int, Long, Int, Int)]])scala.collection.immutable.Iterable[(Int, Int, Int, Int, Long, Int, Int)]">map</span> <a href="#45401" title="(Int, Int, Int, Int, Long, Int, Int)" class="delimiter">{</a>
	<span class="keyword">case</span> <span title="(Int, Int, Int, Int, Long, Int, Int)" class="delimiter">(</span><span class="delimiter">(</span><a title="Int" id="45406">recs</a>, <a title="Int" id="45407">threads</a><span class="delimiter">)</span>, <a title="Seq[edu.berkeley.cs.scads.perf.intkey.singlenode.Result]" id="45408">results</a><span class="delimiter">)</span> =&gt;
	  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="45409">aggHist</a> = <a href="#45408" title="Seq[edu.berkeley.cs.scads.perf.intkey.singlenode.Result]">results</a>.<span title="(f: edu.berkeley.cs.scads.perf.intkey.singlenode.Result =&gt; edu.berkeley.cs.scads.perf.Histogram)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.perf.intkey.singlenode.Result],edu.berkeley.cs.scads.perf.Histogram,Seq[edu.berkeley.cs.scads.perf.Histogram]])Seq[edu.berkeley.cs.scads.perf.Histogram]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.perf.Histogram,Seq[edu.berkeley.cs.scads.perf.Histogram]]" class="delimiter">(</span><a href="#45426" title="edu.berkeley.cs.scads.perf.intkey.singlenode.Result">_</a>.<a href="#44734" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">responseTimes</a><span class="delimiter">)</span>.<span title="(op: (edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram) =&gt; edu.berkeley.cs.scads.perf.Histogram)edu.berkeley.cs.scads.perf.Histogram">reduceLeft</span><span class="delimiter">(</span><a href="#45454" title="edu.berkeley.cs.scads.perf.Histogram">_</a> <a href="Histogram.scala.html#33405" title="(left: edu.berkeley.cs.scads.perf.Histogram)edu.berkeley.cs.scads.perf.Histogram">+</a> <a href="#45455" title="edu.berkeley.cs.scads.perf.Histogram">_</a><span class="delimiter">)</span>
	  <span title="(_1: Int, _2: Int, _3: Int, _4: Int, _5: Long, _6: Int, _7: Int)(Int, Int, Int, Int, Long, Int, Int)" class="delimiter">(</span><a href="#45406" title="Int">recs</a>, <a href="#45407" title="Int">threads</a>, <a href="#45409" title="edu.berkeley.cs.scads.perf.Histogram">aggHist</a>.<a href="Histogram.scala.html#33410" title="(fraction: Double)Int">quantile</a><span class="delimiter">(</span><span title="Double(0.5)" class="double">0.50</span><span class="delimiter">)</span>, <a href="#45409" title="edu.berkeley.cs.scads.perf.Histogram">aggHist</a>.<a href="Histogram.scala.html#33410" title="(fraction: Double)Int">quantile</a><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span>, <a href="#45409" title="edu.berkeley.cs.scads.perf.Histogram">aggHist</a>.<a href="Histogram.scala.html#33409" title="=&gt; Long">totalRequests</a>, <a href="#45409" title="edu.berkeley.cs.scads.perf.Histogram">aggHist</a>.<a href="Histogram.scala.html#33401" title="=&gt; Int">negative</a>, <a href="#45408" title="Seq[edu.berkeley.cs.scads.perf.intkey.singlenode.Result]">results</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(args: Array[String])Unit" id="44885">main</a><span class="delimiter">(</span><a title="Array[String]" id="46885">args</a>: <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
 <span class="comment">//     val cluster = TestScalaEngine.newScadsCluster(2)</span>
 <span class="comment">//     val task = new Task(cluster.root.canonicalAddress,</span>
<span class="comment">//			  cluster.root.canonicalAddress).run()</span>

      <a href="#44884" title="=&gt; scala.collection.immutable.Iterable[(Int, Int, Int, Int, Long, Int, Int)]">graphPoints</a>.<span title="=&gt; Seq[(Int, Int, Int, Int, Long, Int, Int)]">toSeq</span>.<span title="(f: (Int, Int, Int, Int, Long, Int, Int) =&gt; (Int, Int))(implicit ord: scala.math.Ordering[(Int, Int)])Seq[(Int, Int, Int, Int, Long, Int, Int)]">sortBy</span><span title="(implicit ord1: scala.math.Ordering[Int], implicit ord2: scala.math.Ordering[Int])scala.math.Ordering[(Int, Int)]" class="delimiter">(</span><a title="(Int, Int, Int, Int, Long, Int, Int)" id="46894">r</a> =&gt; <span title="(_1: Int, _2: Int)(Int, Int)" class="delimiter">(</span><a href="#46894" title="(Int, Int, Int, Int, Long, Int, Int)">r</a>.<span title="=&gt; Int">_2</span>, <a href="#46894" title="(Int, Int, Int, Int, Long, Int, Int)">r</a>.<span title="=&gt; Int">_1</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: (Int, Int, Int, Int, Long, Int, Int) =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#47203" title="(x: Any)Unit">println</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>	   
<span class="delimiter">}</span>

case <span class="keyword">class</span> <a title="class Record extends org.apache.avro.specific.SpecificRecordBase with edu.berkeley.cs.avro.runtime.HasAvroConversions with edu.berkeley.cs.avro.marker.AvroPair with ScalaObject with Product with Serializable" id="48642">Record</a><a href="#48642" title="ScalaObject" class="delimiter">(</a><a href="#48642" title="()edu.berkeley.cs.scads.perf.intkey.singlenode.Record" id="51451" class="keyword">var</a> <a title="Int" id="48093">f1</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="edu.berkeley.cs.avro.marker.AvroPair">AvroPair</span> <span class="delimiter">{</span>
  <span class="keyword">var</span> <a title="String" id="47213">f2</a>: <span title="String">String</span>  = <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
<span class="delimiter">}</span>

case <span class="keyword">class</span> <a href="#60620" title="class Task extends org.apache.avro.specific.SpecificRecordBase with edu.berkeley.cs.avro.runtime.HasAvroConversions with deploylib.mesos.AvroTask with edu.berkeley.cs.avro.marker.AvroRecord with edu.berkeley.cs.scads.perf.TaskBase with ScalaObject with Product with Serializable" id="48638">Task</a><a href="#48638" title="ScalaObject" class="delimiter">(</a><a href="#48638" title="()edu.berkeley.cs.scads.perf.intkey.singlenode.Task" id="51461" class="keyword">var</a> <a title="Int" id="46415">replicationFactor</a>: <span title="Int">Int</span> = <span title="Int(2)" class="int">2</span>,
		<span class="keyword">var</span> <a title="Int" id="46416">iterations</a>: <span title="Int">Int</span> = <span title="Int(20)" class="int">20</span>,
		<span class="keyword">var</span> <a title="Int" id="46417">getCount</a>: <span title="Int">Int</span> = <span title="Int(100000)" class="int">100000</span>,
		<span class="keyword">var</span> <a title="Seq[Int]" id="46418">dataSizes</a>: <span title="Seq[Int]">Seq</span><span class="delimiter">[</span>Int<span class="delimiter">]</span> = <span title="(elems: Int*)Seq[Int]">Seq</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>,
		<span class="keyword">var</span> <a title="Seq[Int]" id="46419">recordCounts</a>: <span title="Seq[Int]">Seq</span><span class="delimiter">[</span>Int<span class="delimiter">]</span> = <span title="(elems: Int*)Seq[Int]">Seq</span><span class="delimiter">(</span><span class="int">1024</span><span title="Int(10240)">*</span><span class="int">10</span><span class="delimiter">)</span>,
		<span class="keyword">var</span> <a title="Seq[Int]" id="46420">threadCounts</a>: <span title="Seq[Int]">Seq</span><span class="delimiter">[</span>Int<span class="delimiter">]</span> = <span title="(elems: Int*)Seq[Int]">Seq</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>, <span title="Int(5)" class="int">5</span><span class="delimiter">)</span><span class="delimiter">)</span>
     <span class="keyword">extends</span> <span title="deploylib.mesos.AvroTask">AvroTask</span> <span class="keyword">with</span> <span title="edu.berkeley.cs.avro.marker.AvroRecord">AvroRecord</span> <span class="keyword">with</span> <a href="Experiment.scala.html#9518" title="edu.berkeley.cs.scads.perf.TaskBase">TaskBase</a> <span class="delimiter">{</span>
  
  <span class="keyword">var</span> <a title="String" id="46406">resultClusterAddress</a>: <span title="String">String</span> = _
  <span class="keyword">var</span> <a title="String" id="46409">clusterAddress</a>: <span title="String">String</span> = _

  <span class="keyword">def</span> <a title="(resultClusterAddress: String)(implicit cluster: deploylib.mesos.Cluster, implicit classSource: Seq[edu.berkeley.cs.scads.comm.ClassSource])Unit" id="46411">schedule</a><span class="delimiter">(</span><a title="String" id="46638">resultClusterAddress</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="deploylib.mesos.Cluster" id="46639">cluster</a>: deploylib.mesos.<span title="deploylib.mesos.Cluster">Cluster</span>, <a title="Seq[edu.berkeley.cs.scads.comm.ClassSource]" id="46640">classSource</a>: <span title="Seq[edu.berkeley.cs.scads.comm.ClassSource]">Seq</span><span class="delimiter">[</span>ClassSource<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.ScadsCluster" id="47305">scadsCluster</a> = <a href="Experiment.scala.html#32689" title="(size: Int)(implicit cluster: deploylib.mesos.Cluster, implicit classSource: Seq[edu.berkeley.cs.scads.comm.ClassSource])edu.berkeley.cs.scads.storage.ScadsCluster">newScadsCluster</a><a href="#46639" title="deploylib.mesos.Cluster" class="delimiter">(</a><span title="Int(2)" class="int">2</span><span class="delimiter">)</span>
    <a href="#46409" title="(x$1: String)Unit">clusterAddress</a> = <a href="#47305" title="edu.berkeley.cs.scads.storage.ScadsCluster">scadsCluster</a>.<span title="=&gt; edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">root</span>.<span title="=&gt; java.lang.String">canonicalAddress</span>
    <a href="#48638" title="Task.this.type" class="keyword">this</a>.<a href="#46406" title="(x$1: String)Unit">resultClusterAddress</a> = <a href="#46638" title="String">resultClusterAddress</a>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.JvmMainTask" id="47306">task</a> = <a href="#48638" title="Task.this.type" class="keyword">this</a>.<a href="#46640" title="(implicit classSource: Seq[edu.berkeley.cs.scads.comm.ClassSource])edu.berkeley.cs.scads.comm.JvmMainTask">toJvmTask</a>
    <a href="#46639" title="deploylib.mesos.Cluster">cluster</a>.<span title="=&gt; deploylib.mesos.RemoteServiceScheduler">serviceScheduler</span>.<span title="(processes: Seq[edu.berkeley.cs.scads.comm.JvmTask])Unit">scheduleExperiment</span><span class="delimiter">(</span><a href="#47306" title="edu.berkeley.cs.scads.comm.JvmMainTask">task</a> <a href="#47308" title="(x: edu.berkeley.cs.scads.comm.JvmMainTask)List[edu.berkeley.cs.scads.comm.JvmMainTask]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="46412">run</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="47342">logger</a> = <span title="()net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.ExperimentalScadsCluster" id="47343">cluster</a> = <span title="edu.berkeley.cs.scads.perf.ExperimentalScadsCluster" class="keyword">new</span> <a href="Experiment.scala.html#9516" title="edu.berkeley.cs.scads.perf.ExperimentalScadsCluster">ExperimentalScadsCluster</a><span class="delimiter">(</span><span title="(uri: String)edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">ZooKeeperNode</span><span class="delimiter">(</span><a href="#46409" title="=&gt; String">clusterAddress</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#47343" title="edu.berkeley.cs.scads.perf.ExperimentalScadsCluster">cluster</a>.<a href="Experiment.scala.html#30886" title="(clusterSize: Int)Unit">blockUntilReady</a><span class="delimiter">(</span><a href="#46415" title="=&gt; Int">replicationFactor</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.ScadsCluster" id="47344">resultCluster</a> = <span title="edu.berkeley.cs.scads.storage.ScadsCluster" class="keyword">new</span> <span title="edu.berkeley.cs.scads.storage.ScadsCluster">ScadsCluster</span><span class="delimiter">(</span><span title="(uri: String)edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">ZooKeeperNode</span><span class="delimiter">(</span><a href="#46406" title="=&gt; String">resultClusterAddress</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.perf.intkey.singlenode.Result]" id="47345">results</a> = <a href="#47344" title="edu.berkeley.cs.scads.storage.ScadsCluster">resultCluster</a>.<span title="[PairType &lt;: edu.berkeley.cs.avro.marker.AvroPair](ns: String)(implicit evidence$7: Manifest[PairType])edu.berkeley.cs.scads.storage.PairNamespace[PairType]">getNamespace</span><span title="(ns: String)(implicit evidence$7: Manifest[edu.berkeley.cs.scads.perf.intkey.singlenode.Result])edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.perf.intkey.singlenode.Result]" class="delimiter">[</span><a href="#48646" title="edu.berkeley.cs.scads.perf.intkey.singlenode.Result">Result</a><span class="delimiter">]</span><span title="(clazz: Class[_])scala.reflect.Manifest[edu.berkeley.cs.scads.perf.intkey.singlenode.Result]" class="delimiter">(</span><span title="java.lang.String(&quot;singleNodeResult&quot;)" class="string">&quot;singleNodeResult&quot;</span><span class="delimiter">)</span>

   <span class="comment">/**
     * Create the partition scheme for subscriptions to be a single partition over
     * the specified number of replicas
     */</span>
    <a href="#47342" title="net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Creating partitions&quot;)" class="string">&quot;Creating partitions&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="List[(None.type, List[edu.berkeley.cs.scads.comm.StorageService])]" id="47346">partitions</a> = <span title="(_1: None.type, _2: List[edu.berkeley.cs.scads.comm.StorageService])(None.type, List[edu.berkeley.cs.scads.comm.StorageService])" class="delimiter">(</span><span title="object None">None</span>, <a href="#47343" title="edu.berkeley.cs.scads.perf.ExperimentalScadsCluster">cluster</a>.<span title="()List[edu.berkeley.cs.scads.comm.StorageService]">getAvailableServers</span>.<span title="(n: Int)List[edu.berkeley.cs.scads.comm.StorageService]">take</span><span class="delimiter">(</span><a href="#46415" title="=&gt; Int">replicationFactor</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#47451" title="(x: (None.type, List[edu.berkeley.cs.scads.comm.StorageService]))List[(None.type, List[edu.berkeley.cs.scads.comm.StorageService])]">::</a> <span title="object Nil">Nil</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.perf.intkey.singlenode.Record]" id="47347">ns</a> = <a href="#47343" title="edu.berkeley.cs.scads.perf.ExperimentalScadsCluster">cluster</a>.<span title="[PairType &lt;: edu.berkeley.cs.avro.marker.AvroPair](ns: String, servers: Seq[(Option[org.apache.avro.generic.IndexedRecord], Seq[edu.berkeley.cs.scads.comm.StorageService])])(implicit evidence$8: Manifest[PairType])edu.berkeley.cs.scads.storage.PairNamespace[PairType]">createNamespace</span><span title="(ns: String, servers: Seq[(Option[org.apache.avro.generic.IndexedRecord], Seq[edu.berkeley.cs.scads.comm.StorageService])])(implicit evidence$8: Manifest[edu.berkeley.cs.scads.perf.intkey.singlenode.Record])edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.perf.intkey.singlenode.Record]" class="delimiter">[</span><a href="#48642" title="edu.berkeley.cs.scads.perf.intkey.singlenode.Record">Record</a><span class="delimiter">]</span><span title="(clazz: Class[_])scala.reflect.Manifest[edu.berkeley.cs.scads.perf.intkey.singlenode.Record]" class="delimiter">(</span><a href="#48638" title="Task.this.type" class="keyword">this</a>.<span title="()java.lang.Class[_]">getClass</span>.<span title="()java.lang.String">getName</span>, <a href="#47346" title="List[(None.type, List[edu.berkeley.cs.scads.comm.StorageService])]">partitions</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="java.lang.String" id="47348">hostname</a> = java.net.<span title="object java.net.InetAddress">InetAddress</span>.<span title="()java.net.InetAddress">getLocalHost</span>.<span title="()java.lang.String">getHostName</span>
    <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">1</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#46416" title="=&gt; Int">iterations</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="47768">iteration</a> =&gt; <span class="delimiter">{</span>
      <a href="#46418" title="=&gt; Seq[Int]">dataSizes</a>.<span title="(f: Int =&gt; Unit)Unit">foreach</span> <a href="#47805" title="Unit" class="delimiter">{</a><span class="keyword">case</span> <a title="Unit" id="47806">dataSize</a> =&gt; 
        <a href="#47347" title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.perf.intkey.singlenode.Record]">ns</a>.<span title="(scheme: Seq[(Option[Array[Byte]], Seq[edu.berkeley.cs.scads.comm.StorageService])])Unit">setPartitionScheme</span><span class="delimiter">(</span><a href="#47346" title="List[(None.type, List[edu.berkeley.cs.scads.comm.StorageService])]">partitions</a><span class="delimiter">)</span>
        <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#47347" title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.perf.intkey.singlenode.Record]">ns</a>.<span title="(start: Option[org.apache.avro.generic.IndexedRecord], end: Option[org.apache.avro.generic.IndexedRecord], limit: Option[Int], offset: Option[Int], ascending: Boolean)Seq[edu.berkeley.cs.scads.perf.intkey.singlenode.Record]">getRange</span><span class="delimiter">(</span><span title="object None">None</span>, <span title="object None">None</span>, limit=<span title="(x: Int)Some[Int]">Some</span><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span>, <span title="java.lang.String(&quot;Namespace not empty&quot;)" class="string">&quot;Namespace not empty&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">(</span><span title="Int(0)" class="int">0</span> <a href="#47838" title="(elem: Int)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[Int],Int,Seq[Int]])Seq[Int]">+:</a> <a href="#46419" title="=&gt; Seq[Int]">recordCounts</a><span class="delimiter">)</span>.<span title="(size: Int)Iterator[Seq[Int]]">sliding</span><span class="delimiter">(</span><span title="Int(2)" class="int">2</span><span class="delimiter">)</span>.<span title="(f: Seq[Int] =&gt; Unit)Unit">foreach</span> <a href="#47900" title="Unit" class="delimiter">{</a> <span class="keyword">case</span> <a title="Unit" id="47971">lastCount</a> :: <a title="Int" id="47991">currentCount</a> :: <span title="object Nil">Nil</span> =&gt;
          <a href="#47342" title="net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;loading data from %d to %d&quot;)" class="string">&quot;loading data from %d to %d&quot;</span>, <a href="#47971" title="Int">lastCount</a>, <a href="#47991" title="Int">currentCount</a><span class="delimiter">)</span>
          <span title="(requirement: Boolean, message: =&gt; Any)Unit">require</span><span class="delimiter">(</span><a href="#47971" title="Int">lastCount</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#47991" title="Int">currentCount</a>, <span title="java.lang.String(&quot;record count must me monotonicaly increasing&quot;)" class="string">&quot;record count must me monotonicaly increasing&quot;</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="String" id="47992">data</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;*&quot;</span> <span title="(n: Int)String">*</span> <a href="#47806" title="Int">dataSize</a>
	  <span class="keyword">val</span> <a title="Long" id="47993">loadStart</a> = <span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span>
          <a href="#47347" title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.perf.intkey.singlenode.Record]">ns</a> <span title="(that: TraversableOnce[edu.berkeley.cs.scads.perf.intkey.singlenode.Record])Unit">++=</span> <span class="delimiter">(</span><a href="#47971" title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt">lastCount</a> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#47991" title="Int">currentCount</a><span class="delimiter">)</span>.<span title="=&gt; java.lang.Object with scala.collection.SeqView[Int,scala.collection.immutable.IndexedSeq[Int]]">view</span>.<span title="(f: Int =&gt; edu.berkeley.cs.scads.perf.intkey.singlenode.Record)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.SeqView[Int,scala.collection.immutable.IndexedSeq[Int]],edu.berkeley.cs.scads.perf.intkey.singlenode.Record,TraversableOnce[edu.berkeley.cs.scads.perf.intkey.singlenode.Record]])TraversableOnce[edu.berkeley.cs.scads.perf.intkey.singlenode.Record]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.SeqView.Coll,edu.berkeley.cs.scads.perf.intkey.singlenode.Record,scala.collection.SeqView[edu.berkeley.cs.scads.perf.intkey.singlenode.Record,Seq[_]]]" class="delimiter">(</span><a title="Int" id="48091">i</a> =&gt; <span class="delimiter">{</span><span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.intkey.singlenode.Record" id="48092">r</a> = <a href="#48642" title="(f1: Int)edu.berkeley.cs.scads.perf.intkey.singlenode.Record">Record</a><span class="delimiter">(</span><a href="#48091" title="Int">i</a><span class="delimiter">)</span>; <a href="#48092" title="edu.berkeley.cs.scads.perf.intkey.singlenode.Record">r</a>.<a href="#47213" title="(x$1: String)Unit">f2</a> = <a href="#47992" title="String">data</a>; <a href="#48092" title="edu.berkeley.cs.scads.perf.intkey.singlenode.Record">r</a><span class="delimiter">}</span><span class="delimiter">)</span>  
	  <span class="keyword">val</span> <a title="Long" id="47994">loadEnd</a> = <span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span>
	  <a href="#46420" title="=&gt; Seq[Int]">threadCounts</a>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span> <a title="Int" id="48155">threadCount</a> =&gt; <span class="delimiter">{</span>
	    <a href="#47342" title="net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Begining test: iteration %d, %d records, %d threads&quot;)" class="string">&quot;Begining test: iteration %d, %d records, %d threads&quot;</span>, <a href="#47768" title="Int">iteration</a>, <a href="#47991" title="Int">currentCount</a>, <a href="#48155" title="Int">threadCount</a><span class="delimiter">)</span>
	    <span class="keyword">def</span> <a title="=&gt; Long" id="48156">currentTime</a> = <span title="object java.lang.System">System</span>.<span title="()Long">nanoTime</span> <span title="(x: Int)Long">/</span> <span title="Int(1000)" class="int">1000</span>

   	    <span class="keyword">val</span> <a title="java.util.concurrent.atomic.AtomicInteger" id="48157">failures</a> = <span title="()java.util.concurrent.atomic.AtomicInteger" class="keyword">new</span> java.util.concurrent.atomic.<span title="java.util.concurrent.atomic.AtomicInteger">AtomicInteger</span><span class="delimiter">(</span><span class="delimiter">)</span>
	    <span class="keyword">val</span> <a title="Long" id="48158">startTime</a> = <span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span>
	    <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.perf.Histogram]" id="48159">histograms</a> = <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(itr: Iterable[Int])deploylib.ParallelSeq[Int]">until</span> <a href="#48155" title="Int">threadCount</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; edu.berkeley.cs.scads.perf.Histogram)List[edu.berkeley.cs.scads.perf.Histogram]">pmap</span><span class="delimiter">(</span><a title="Int" id="48361">i</a> =&gt; <span class="delimiter">{</span>
	      <span class="keyword">val</span> <a title="scala.util.Random" id="48362">rand</a> = <span title="()scala.util.Random" class="keyword">new</span> scala.util.<span title="scala.util.Random">Random</span>
	      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="48363">histogram</a> = <a href="Histogram.scala.html#33378" title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</a><span class="delimiter">(</span><span title="Int(10)" class="int">10</span>,<span title="Int(5000)" class="int">5000</span><span class="delimiter">)</span>
	      <span class="keyword">var</span> <a title="Int" id="48364">i</a> = <a href="#46417" title="=&gt; Int">getCount</a>
	      <span class="keyword">var</span> <a title="Long" id="48365">lastTime</a> = <a href="#48156" title="=&gt; Long">currentTime</a>
	      <span title="Unit" class="keyword">while</span><span class="delimiter">(</span><a href="#48364" title="Int">i</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#48366" title="()Unit" class="delimiter">{</a>
	        <a href="#48364" title="Int">i</a> <span title="(x: Int)Int">-=</span> <span title="Int(1)" class="int">1</span>
	        <span class="keyword">try</span> <span class="delimiter">{</span>
		  <a href="#47347" title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.perf.intkey.singlenode.Record]">ns</a>.<span title="(key: org.apache.avro.generic.IndexedRecord)Option[org.apache.avro.generic.IndexedRecord]">get</span><span class="delimiter">(</span><a href="#48642" title="(f1: Int)edu.berkeley.cs.scads.perf.intkey.singlenode.Record">Record</a><span class="delimiter">(</span><a href="#48362" title="scala.util.Random">rand</a>.<span title="(n: Int)Int">nextInt</span><span class="delimiter">(</span><a href="#47991" title="Int">currentCount</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
		  <span class="keyword">val</span> <a title="Long" id="48406">endTime</a> = <a href="#48156" title="=&gt; Long">currentTime</a>
		  <span class="keyword">val</span> <a title="Long" id="48407">respTime</a> = <a href="#48406" title="Long">endTime</a> <span title="(x: Long)Long">-</span> <a href="#48365" title="Long">lastTime</a>
		  <a href="#47342" title="net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Get response time: %d&quot;)" class="string">&quot;Get response time: %d&quot;</span>, <a href="#48407" title="Long">respTime</a><span class="delimiter">)</span>
		  <a href="#48363" title="edu.berkeley.cs.scads.perf.Histogram">histogram</a>.<a href="Histogram.scala.html#33408" title="(value: Long)edu.berkeley.cs.scads.perf.Histogram">add</a><span class="delimiter">(</span><a href="#48407" title="Long">respTime</a><span class="delimiter">)</span>
		  <a href="#48365" title="Long">lastTime</a> = <a href="#48406" title="Long">endTime</a> 
	        <span class="delimiter">}</span>
	        <span class="keyword">catch</span> <span class="delimiter">{</span>
		  <span class="keyword">case</span> <a title="Unit" id="48420">e</a> =&gt; 
		    <a href="#48157" title="java.util.concurrent.atomic.AtomicInteger">failures</a>.<span title="(x$1: Int)Int">getAndAdd</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
		    <a href="#48365" title="Long">lastTime</a> = <a href="#48156" title="=&gt; Long">currentTime</a>
	        <span class="delimiter">}</span>
	      <span class="delimiter">}</span>
	      <a href="#48363" title="edu.berkeley.cs.scads.perf.Histogram">histogram</a>
	    <span class="delimiter">}</span><span class="delimiter">)</span>
	    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.intkey.singlenode.Result" id="48160">result</a> = <a href="#48646" title="(hostname: String, timestamp: Long, iteration: Int, dataSize: Int, recordCount: Int, threadCount: Int)edu.berkeley.cs.scads.perf.intkey.singlenode.Result">Result</a><span class="delimiter">(</span><a href="#47348" title="java.lang.String">hostname</a>, <span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span>, <a href="#47768" title="Int">iteration</a>, <a href="#47806" title="Int">dataSize</a>, <a href="#47991" title="Int">currentCount</a>, <a href="#48155" title="Int">threadCount</a><span class="delimiter">)</span>
	    <a href="#48160" title="edu.berkeley.cs.scads.perf.intkey.singlenode.Result">result</a>.<a href="#44725" title="(x$1: Int)Unit">lastCount</a> = <a href="#47971" title="Int">lastCount</a>
	    <a href="#48160" title="edu.berkeley.cs.scads.perf.intkey.singlenode.Result">result</a>.<a href="#44728" title="(x$1: Long)Unit">loadTimeMs</a> = <a href="#47994" title="Long">loadEnd</a> <span title="(x: Long)Long">-</span> <a href="#47993" title="Long">loadStart</a>
	    <a href="#48160" title="edu.berkeley.cs.scads.perf.intkey.singlenode.Result">result</a>.<a href="#44731" title="(x$1: Long)Unit">runTimeMs</a> = <span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span> <span title="(x: Long)Long">-</span> <a href="#48158" title="Long">startTime</a>
	    <a href="#48160" title="edu.berkeley.cs.scads.perf.intkey.singlenode.Result">result</a>.<a href="#44734" title="(x$1: edu.berkeley.cs.scads.perf.Histogram)Unit">responseTimes</a> = <a href="#48159" title="List[edu.berkeley.cs.scads.perf.Histogram]">histograms</a>.<span title="(f: (edu.berkeley.cs.scads.perf.Histogram, edu.berkeley.cs.scads.perf.Histogram) =&gt; edu.berkeley.cs.scads.perf.Histogram)edu.berkeley.cs.scads.perf.Histogram">reduceLeft</span><span class="delimiter">(</span><a href="#48461" title="edu.berkeley.cs.scads.perf.Histogram">_</a> <a href="Histogram.scala.html#33405" title="(left: edu.berkeley.cs.scads.perf.Histogram)edu.berkeley.cs.scads.perf.Histogram">+</a> <a href="#48462" title="edu.berkeley.cs.scads.perf.Histogram">_</a><span class="delimiter">)</span>
	    <a href="#48160" title="edu.berkeley.cs.scads.perf.intkey.singlenode.Result">result</a>.<a href="#44737" title="(x$1: Int)Unit">failures</a> = <a href="#48157" title="java.util.concurrent.atomic.AtomicInteger">failures</a>.<span title="()Int">get</span><span class="delimiter">(</span><span class="delimiter">)</span>
	    <a href="#47345" title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.perf.intkey.singlenode.Result]">results</a>.<span title="(pairRec: edu.berkeley.cs.scads.perf.intkey.singlenode.Result)Unit">put</span><span class="delimiter">(</span><a href="#48160" title="edu.berkeley.cs.scads.perf.intkey.singlenode.Result">result</a><span class="delimiter">)</span>
	  <span class="delimiter">}</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>			    					  
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>