<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>Histogram.scala</title>
        <script type="text/javascript" src="jquery-all.js"></script>
        <script type="text/javascript" src="linked.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs.scads.perf

<span class="keyword">import</span> edu.berkeley.cs.avro.runtime._
<span class="keyword">import</span> edu.berkeley.cs.avro.marker._

<span class="keyword">import</span> scala.collection.mutable.ArrayBuffer
<span class="keyword">import</span> scala.xml._

<span class="keyword">object</span> <a title="object edu.berkeley.cs.scads.perf.Histogram" id="33922">Histogram</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram" id="33378">apply</a><span class="delimiter">(</span><a title="Int" id="33465">bucketSize</a>: <span title="Int">Int</span>, <a title="Int" id="33466">bucketCount</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="#39295" title="edu.berkeley.cs.scads.perf.Histogram">Histogram</a> =
    <a href="#39145" title="edu.berkeley.cs.scads.perf.Histogram" class="keyword">new</a> <a href="#39295" title="edu.berkeley.cs.scads.perf.Histogram">Histogram</a><span class="delimiter">(</span><a href="#33465" title="Int">bucketSize</a>, <span title="object scala.collection.mutable.ArrayBuffer">ArrayBuffer</span>.<span title="(n: Int)(elem: =&gt; Long)scala.collection.mutable.ArrayBuffer[Long]">fill</span><span class="delimiter">(</span><a href="#33466" title="Int">bucketCount</a><span class="delimiter">)</span><span class="delimiter">(</span><span title="Long(0L)" class="long">0L</span><span class="delimiter">)</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

case <span class="keyword">class</span> <a title="(x$0: edu.berkeley.cs.scads.perf.Histogram)Option[(Int, scala.collection.mutable.ArrayBuffer[Long], Int)]" id="39295">Histogram</a><a href="#39295" title="ScalaObject" class="delimiter">(</a><a href="#39295" title="()edu.berkeley.cs.scads.perf.Histogram" id="51365" class="keyword">var</a> <a title="Int" id="39143">bucketSize</a>: <span title="Int">Int</span>, <span class="keyword">var</span> <a title="scala.collection.mutable.ArrayBuffer[Long]" id="39144">buckets</a>: <span title="scala.collection.mutable.ArrayBuffer[Long]">ArrayBuffer</span><span class="delimiter">[</span>Long<span class="delimiter">]</span>, <span class="keyword">var</span> <a title="=&gt; Int" id="39145">negative</a>: <span title="Int">Int</span> = <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="edu.berkeley.cs.avro.marker.AvroRecord">AvroRecord</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(left: edu.berkeley.cs.scads.perf.Histogram)edu.berkeley.cs.scads.perf.Histogram" id="33405">+</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.perf.Histogram" id="33930">left</a>: <a href="#39295" title="edu.berkeley.cs.scads.perf.Histogram">Histogram</a><span class="delimiter">)</span>: <a href="#39295" title="edu.berkeley.cs.scads.perf.Histogram">Histogram</a> = <span class="delimiter">{</span>
    <span title="(requirement: Boolean)Unit">require</span><span class="delimiter">(</span><a href="#39143" title="=&gt; Int">bucketSize</a> <span title="(x: Int)Boolean">==</span> <a href="#33930" title="edu.berkeley.cs.scads.perf.Histogram">left</a>.<a href="#39143" title="=&gt; Int">bucketSize</a><span class="delimiter">)</span>
    <span title="(requirement: Boolean)Unit">require</span><span class="delimiter">(</span><a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <a href="#33930" title="edu.berkeley.cs.scads.perf.Histogram">left</a>.<a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>

    <a href="#39295" title="(bucketSize: Int, buckets: scala.collection.mutable.ArrayBuffer[Long], negative: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</a><span class="delimiter">(</span><a href="#39143" title="=&gt; Int">bucketSize</a>, <a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>.<span title="(that: scala.collection.GenIterable[Long])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],(Long, Long),scala.collection.mutable.ArrayBuffer[(Long, Long)]])scala.collection.mutable.ArrayBuffer[(Long, Long)]">zip</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,(Long, Long),scala.collection.mutable.ArrayBuffer[(Long, Long)]]" class="delimiter">(</span><a href="#33930" title="edu.berkeley.cs.scads.perf.Histogram">left</a>.<a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a><span class="delimiter">)</span>.<span title="(f: (Long, Long) =&gt; Long)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[(Long, Long)],Long,scala.collection.mutable.ArrayBuffer[Long]])scala.collection.mutable.ArrayBuffer[Long]">map</span> <a href="#34657" title="Long" class="delimiter">{</a> <span class="keyword">case</span> <span title="Long" class="delimiter">(</span><a title="Long" id="34660">a</a>, <a title="Long" id="34661">b</a><span class="delimiter">)</span> =&gt; <a href="#34660" title="Long">a</a> <span title="(x: Long)Long">+</span> <a href="#34661" title="Long">b</a> <span class="delimiter">}</span>, <a href="#39145" title="=&gt; Int">negative</a> <span title="(x: Int)Int">+</span> <a href="#33930" title="edu.berkeley.cs.scads.perf.Histogram">left</a>.<a href="#39145" title="=&gt; Int">negative</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()edu.berkeley.cs.scads.perf.Histogram" id="33406">reset</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="#39295" title="edu.berkeley.cs.scads.perf.Histogram">Histogram</a> = <a href="#39295" title="(x$1: edu.berkeley.cs.scads.perf.Histogram)edu.berkeley.cs.scads.perf.Histogram">synchronized</a> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[Long]" id="34726">oldHist</a> = <a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>
    <a href="#39144" title="(x$1: scala.collection.mutable.ArrayBuffer[Long])Unit">buckets</a> = <span title="object scala.collection.mutable.ArrayBuffer">ArrayBuffer</span>.<span title="(n: Int)(elem: =&gt; Long)scala.collection.mutable.ArrayBuffer[Long]">fill</span><span class="delimiter">(</span><a href="#34726" title="scala.collection.mutable.ArrayBuffer[Long]">oldHist</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span><span class="delimiter">(</span><span title="Long(0L)" class="long">0L</span><span class="delimiter">)</span>
    <a href="#39295" title="(bucketSize: Int, buckets: scala.collection.mutable.ArrayBuffer[Long], negative: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</a><span class="delimiter">(</span><a href="#39143" title="=&gt; Int">bucketSize</a>, <a href="#34726" title="scala.collection.mutable.ArrayBuffer[Long]">oldHist</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(value: Long)Unit" id="33407">+=</a><span class="delimiter">(</span><a title="Long" id="34756">value</a>: <span title="Long">Long</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#33408" title="(value: Long)edu.berkeley.cs.scads.perf.Histogram">add</a><span title="Unit" class="delimiter">(</span><a href="#34756" title="Long">value</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(value: Long)edu.berkeley.cs.scads.perf.Histogram" id="33408">add</a><span class="delimiter">(</span><a title="Long" id="34758">value</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <a href="#39295" title="edu.berkeley.cs.scads.perf.Histogram">Histogram</a> = <a href="#39295" title="(x$1: edu.berkeley.cs.scads.perf.Histogram)edu.berkeley.cs.scads.perf.Histogram">synchronized</a> <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#34758" title="Long">value</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="#39145" title="(x$1: Int)Unit">negative</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="34772">bucket</a> = <span class="delimiter">(</span><a href="#34758" title="Long">value</a> <span title="(x: Int)Long">/</span> <a href="#39143" title="=&gt; Int">bucketSize</a><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#34772" title="Int">bucket</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
	<a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a><span class="delimiter">(</span><a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>.<span title="=&gt; Int">length</span> <a href="#34834" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span title="(x: Int)Long">+=</span> <span title="Int(1)" class="int">1</span>
      <span class="keyword">else</span>
	<a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a><span class="delimiter">(</span><a href="#34772" title="Int">bucket</a><span class="delimiter">)</span> <span title="(x: Int)Long">+=</span> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>
    <a href="#39295" title="edu.berkeley.cs.scads.perf.Histogram" class="keyword">this</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Long" id="33409">totalRequests</a>: <span title="Long">Long</span> = <a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>.<span title="(implicit num: Numeric[Long])Long">sum</span>

  <span class="keyword">def</span> <a title="(fraction: Double)Int" id="33410">quantile</a><span class="delimiter">(</span><a title="Double" id="36791">fraction</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[Long]" id="36793">cumulativeSum</a> = <a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>.<span title="(z: Long)(op: (Long, Long) =&gt; Long)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],Long,scala.collection.mutable.ArrayBuffer[Long]])scala.collection.mutable.ArrayBuffer[Long]">scanLeft</span><span class="delimiter">(</span><span title="Long(0L)" class="long">0L</span><span class="delimiter">)</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer.Coll,Long,scala.collection.mutable.ArrayBuffer[Long]]" class="delimiter">(</span><a href="#36829" title="Long">_</a> <span title="(x: Long)Long">+</span> <a href="#36830" title="Long">_</a><span class="delimiter">)</span>.<span title="(n: Int)scala.collection.mutable.ArrayBuffer[Long]">drop</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span title="Int" class="keyword">if</span><span class="delimiter">(</span><a href="#33409" title="=&gt; Long">totalRequests</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="#36793" title="scala.collection.mutable.ArrayBuffer[Long]">cumulativeSum</a>.<span title="(p: Long =&gt; Boolean)Int">indexWhere</span><span class="delimiter">(</span><a href="#36919" title="Long">_</a> <span title="(x: Double)Boolean">&gt;=</span> <a href="#33409" title="=&gt; Long">totalRequests</a> <span title="(x: Double)Double">*</span> <a href="#36791" title="Double">fraction</a><span class="delimiter">)</span> <span title="(x: Int)Int">*</span> <a href="#39143" title="=&gt; Int">bucketSize</a>
    <span class="keyword">else</span>
      <span title="Int(0)" class="int">0</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Int" id="33411">median</a>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <a href="#33410" title="(fraction: Double)Int">quantile</a><span class="delimiter">(</span><span title="Double(0.5)" class="double">0.5</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Double" id="33412">average</a>: <span title="Double">Double</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Double" id="36936">n</a> = <a href="#33409" title="=&gt; Long">totalRequests</a>.<span title="=&gt; Double">toDouble</span>
    <a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>.<span title="(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],(Long, Int),scala.collection.mutable.ArrayBuffer[(Long, Int)]])scala.collection.mutable.ArrayBuffer[(Long, Int)]">zipWithIndex</span>.<span title="(z: Double)(op: (Double, (Long, Int)) =&gt; Double)Double">foldLeft</span><span class="delimiter">(</span><span title="Double(0.0)" class="double">0.0</span><span class="delimiter">)</span> <a href="#37033" title="Double" class="delimiter">{</a> <span class="keyword">case</span> <span title="Double" class="delimiter">(</span><a title="Double" id="37043">acc</a>, <span class="delimiter">(</span><a title="Long" id="37046">num</a>, <a title="Int" id="37047">idx</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#37043" title="Double">acc</a> <span title="(x: Double)Double">+</span> <a href="#37046" title="Long">num</a>.<span title="=&gt; Double">toDouble</span> <span title="(x: Double)Double">*</span> <a href="#37047" title="Int">idx</a>.<span title="=&gt; Double">toDouble</span> <span title="(x: Double)Double">*</span> <a href="#39143" title="=&gt; Int">bucketSize</a>.<span title="=&gt; Double">toDouble</span> <span title="(x: Double)Double">/</span> <a href="#36936" title="Double">n</a> <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Sample standard deviation based off of sqrt(1/(N-1)*sum((Xi-mean(X))^2))
   */</span>
  <span class="keyword">def</span> <a title="=&gt; Double" id="33413">stddev</a>: <span title="Double">Double</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Double" id="37066">n</a> = <a href="#33409" title="=&gt; Long">totalRequests</a>.<span title="=&gt; Double">toDouble</span>
    <span class="keyword">val</span> <a title="Double" id="37067">xbar</a> = <a href="#33412" title="=&gt; Double">average</a>
    <span class="keyword">import</span> scala.math._
    <span title="(x: Double)Double">sqrt</span><span class="delimiter">(</span><span title="Double(1.0)" class="double">1.0</span> <span title="(x: Double)Double">/</span> <span class="delimiter">(</span><a href="#37066" title="Double">n</a> <span title="(x: Double)Double">-</span> <span title="Double(1.0)" class="double">1.0</span><span class="delimiter">)</span> <span title="(x: Double)Double">*</span> <a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>.<span title="(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[Long],(Long, Int),scala.collection.mutable.ArrayBuffer[(Long, Int)]])scala.collection.mutable.ArrayBuffer[(Long, Int)]">zipWithIndex</span>.<span title="(z: Double)(op: (Double, (Long, Int)) =&gt; Double)Double">foldLeft</span><span class="delimiter">(</span><span title="Double(0.0)" class="double">0.0</span><span class="delimiter">)</span> <a href="#37151" title="Double" class="delimiter">{</a> <span class="keyword">case</span> <span title="Double" class="delimiter">(</span><a title="Double" id="37161">acc</a>, <span class="delimiter">(</span><a title="Long" id="37164">num</a>, <a title="Int" id="37165">idx</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#37161" title="Double">acc</a> <span title="(x: Double)Double">+</span> <a href="#37164" title="Long">num</a>.<span title="=&gt; Double">toDouble</span> <span title="(x: Double)Double">*</span> <span title="(x: Double, y: Double)Double">pow</span><span class="delimiter">(</span><a href="#37165" title="Int">idx</a>.<span title="=&gt; Double">toDouble</span> <span title="(x: Double)Double">*</span> <a href="#39143" title="=&gt; Int">bucketSize</a>.<span title="=&gt; Double">toDouble</span> <span title="(x: Double)Double">-</span> <a href="#37067" title="Double">xbar</a>, <span title="Double(2.0)" class="int">2</span><span class="delimiter">)</span> <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; scala.xml.NodeSeq" id="33414">toHtml</a>: <span title="scala.xml.NodeSeq">NodeSeq</span> =
    &lt;<a title="scala.xml.MetaData" id="37813">script</a> <span class="keyword">type</span>=<span title="scala.xml.Text" class="string">&quot;text/javascript&quot;</span>&gt;
      <span class="delimiter">{</span>
        <span title="java.lang.String(&quot;\012 $(document).ready(function() {\012      var chart1 = new Highcharts.Chart({\012         chart: {\012            renderTo: \'chart\',\012            defaultSeriesType: \'bar\'\012         },\012         title: {\012            text: \'Histogram\'\012         },\012         xAxis: {\012            categories: &quot;)" class="string">&quot;&quot;&quot;
 $(document).ready(function() {
      var chart1 = new Highcharts.Chart({
         chart: {
            renderTo: 'chart',
            defaultSeriesType: 'bar'
         },
         title: {
            text: 'Histogram'
         },
         xAxis: {
            categories: &quot;&quot;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">1</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>.<span title="(f: Int =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[Int],java.lang.String,scala.collection.immutable.IndexedSeq[java.lang.String]])scala.collection.immutable.IndexedSeq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq.Coll,java.lang.String,scala.collection.immutable.IndexedSeq[java.lang.String]]" class="delimiter">(</span><a title="Int" id="37963">i</a> =&gt; <span class="delimiter">{</span> <span title="java.lang.String(&quot;\'&quot;)" class="string">&quot;'&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#37963" title="Int">i</a> <span title="(x: Int)Int">*</span> <a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>.<span title="=&gt; Int">length</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\'&quot;)" class="string">&quot;'&quot;</span> <span class="delimiter">}</span><span class="delimiter">)</span>.<span title="(start: String, sep: String, end: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;[&quot;)" class="string">&quot;[&quot;</span>, <span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span>, <span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012         },\012         yAxis: {\012            title: {\012               text: \'BucketCounts\'\012            }\012         },\012         series: [{\012            data: &quot;)" class="string">&quot;&quot;&quot;
         },
         yAxis: {
            title: {
               text: 'BucketCounts'
            }
         },
         series: [{
            data: &quot;&quot;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>.<span title="(start: String, sep: String, end: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;[&quot;)" class="string">&quot;[&quot;</span>, <span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span>, <span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012         }]\012      });\012   });&quot;)" class="string">&quot;&quot;&quot;
         }]
      });
   });&quot;&quot;&quot;</span><span class="delimiter">}</span>
&lt;/script&gt;

	<span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="33415">toString</a>: <span title="String">String</span> = <span class="delimiter">{</span>
		<a href="#33417" title="=&gt; String">getBucketCounts</a>
	<span class="delimiter">}</span>
	
	<span class="keyword">def</span> <a title="=&gt; String" id="33416">getBucketEndpoints</a>: <span title="String">String</span> = <span class="delimiter">{</span>
		<span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">1</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>.<span title="(f: Int =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq[Int],java.lang.String,scala.collection.immutable.IndexedSeq[java.lang.String]])scala.collection.immutable.IndexedSeq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.IndexedSeq.Coll,java.lang.String,scala.collection.immutable.IndexedSeq[java.lang.String]]" class="delimiter">(</span><a title="Int" id="38142">i</a> =&gt; <span class="delimiter">{</span><span title="java.lang.String(&quot;\'&quot;)" class="string">&quot;'&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#38142" title="Int">i</a> <span title="(x: Int)Int">*</span> <a href="#39143" title="=&gt; Int">bucketSize</a> <span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;\'&quot;)" class="string">&quot;'&quot;</span><span class="delimiter">}</span><span class="delimiter">)</span>.<span title="(start: String, sep: String, end: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;[&quot;)" class="string">&quot;[&quot;</span>, <span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span>, <span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span><span class="delimiter">)</span>
	<span class="delimiter">}</span>
	
	<span class="keyword">def</span> <a title="=&gt; String" id="33417">getBucketCounts</a>: <span title="String">String</span> = <span class="delimiter">{</span>
		<a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span>
	<span class="delimiter">}</span>
	
	<span class="keyword">def</span> <a title="(that: edu.berkeley.cs.scads.perf.Histogram)Boolean" id="33418">sameLength</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.perf.Histogram" id="38179">that</a>: <a href="#39295" title="edu.berkeley.cs.scads.perf.Histogram">Histogram</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
	  <a href="#39295" title="Histogram.this.type" class="keyword">this</a>.<a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>.<span title="(len: Int)Int">lengthCompare</span><span class="delimiter">(</span><a href="#38179" title="edu.berkeley.cs.scads.perf.Histogram">that</a>.<a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span>
	<span class="delimiter">}</span>
	

	<span class="comment">// TODO: write function to decrease the resolution from M to N</span>
	<span class="comment">// NOTE: M must be divisible by N (eg, 1000, 100)</span>
	
	


  <span class="comment">/* confirmed that result is same as that from http://www.ece.unm.edu/signals/signals/Discrete_Convolution/discrete_convolution.html */</span>
	<span class="keyword">def</span> <a title="(that: edu.berkeley.cs.scads.perf.Histogram)edu.berkeley.cs.scads.perf.Histogram" id="33419">convolveWith</a><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.perf.Histogram" id="38188">that</a>: <a href="#39295" title="edu.berkeley.cs.scads.perf.Histogram">Histogram</a><span class="delimiter">)</span>: <a href="#39295" title="edu.berkeley.cs.scads.perf.Histogram">Histogram</a> = <span class="delimiter">{</span>
	  <span class="keyword">var</span> <a title="Int" id="38190">defaultBucketSize</a> = <span title="Int(1)" class="int">1</span>
	  <span class="keyword">var</span> <a title="Int" id="38191">defaultBucketCount</a> = <span title="Int(1000)" class="int">1000</span>
	  <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#39295" title="Histogram.this.type" class="keyword">this</a>.<a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <a href="#38191" title="Int">defaultBucketCount</a>, <span title="java.lang.String(&quot;this must have &quot;)" class="string">&quot;this must have &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#38191" title="Int">defaultBucketCount</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; buckets&quot;)" class="string">&quot; buckets&quot;</span><span class="delimiter">)</span>
	  <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#38188" title="edu.berkeley.cs.scads.perf.Histogram">that</a>.<a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <a href="#38191" title="Int">defaultBucketCount</a>, <span title="java.lang.String(&quot;that must have &quot;)" class="string">&quot;that must have &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#38191" title="Int">defaultBucketCount</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; buckets&quot;)" class="string">&quot; buckets&quot;</span><span class="delimiter">)</span>
	  
	  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="38192">result</a> = <a href="#33378" title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</a><span class="delimiter">(</span><a href="#38190" title="Int">defaultBucketSize</a>, <a href="#38191" title="Int">defaultBucketCount</a><span class="delimiter">)</span>
	  
	  <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#38191" title="Int">defaultBucketCount</a><span title="(x: Int)Int">-</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="38333">i</a> =&gt; <span class="delimiter">{</span>
	    <span class="keyword">var</span> <a title="Long" id="38334">integralOfOverlap</a> = <span title="Long(0L)" class="long">0L</span>

      <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#38333" title="Int">i</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="38447">j</a> =&gt; <span class="delimiter">{</span>
        <a href="#38334" title="Long">integralOfOverlap</a> <span title="(x: Long)Long">+=</span> <a href="#39295" title="Histogram.this.type" class="keyword">this</a>.<a href="#39144" title="(idx: Int)Long">buckets</a><span class="delimiter">(</span><a href="#38333" title="Int">i</a><span title="(x: Int)Int">-</span><a href="#38447" title="Int">j</a><span class="delimiter">)</span> <span title="(x: Long)Long">*</span> <a href="#38188" title="edu.berkeley.cs.scads.perf.Histogram">that</a>.<a href="#39144" title="(idx: Int)Long">buckets</a><span class="delimiter">(</span><a href="#38447" title="Int">j</a><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <a href="#38192" title="edu.berkeley.cs.scads.perf.Histogram">result</a>.<a href="#39144" title="(idx: Int, elem: Long)Unit">buckets</a><span class="delimiter">(</span><a href="#38333" title="Int">i</a><span class="delimiter">)</span> = <a href="#38334" title="Long">integralOfOverlap</a>
	  <span class="delimiter">}</span><span class="delimiter">)</span>
	  
	  <a href="#38192" title="edu.berkeley.cs.scads.perf.Histogram">result</a>
	<span class="delimiter">}</span>
	
	<span class="keyword">def</span> <a title="()edu.berkeley.cs.scads.perf.Histogram" id="33420">histToCDF</a><span class="delimiter">(</span><span class="delimiter">)</span> : <a href="#39295" title="edu.berkeley.cs.scads.perf.Histogram">Histogram</a> = <span class="delimiter">{</span>
	  <span class="keyword">var</span> <a title="Int" id="38490">defaultBucketSize</a> = <span title="Int(1)" class="int">1</span>
	  <span class="keyword">var</span> <a title="Int" id="38491">defaultBucketCount</a> = <span title="Int(10)" class="int">10</span>
	  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="38492">intermResult</a> = <a href="#33378" title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</a><span class="delimiter">(</span><a href="#38490" title="Int">defaultBucketSize</a>, <a href="#38491" title="Int">defaultBucketCount</a><span class="delimiter">)</span>
	  <span class="keyword">var</span> <a title="Double" id="38493">bucketTot</a> : <span title="Double">Double</span> = <span title="Double(0.0)" class="int">0</span>
	  <span class="keyword">var</span> <a title="Double" id="38494">prob</a> : <span title="Double">Double</span> = <span title="Double(0.0)" class="int">0</span>
	  
	  <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#39295" title="Histogram.this.type" class="keyword">this</a>.<a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <a href="#38491" title="Int">defaultBucketCount</a>, <span title="java.lang.String(&quot;histogram must have &quot;)" class="string">&quot;histogram must have &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#38491" title="Int">defaultBucketCount</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; buckets&quot;)" class="string">&quot; buckets&quot;</span><span class="delimiter">)</span>
	  
	  <span class="comment">/*Convert histogram to probability histogram*/</span>
	  <span class="keyword">var</span> <a title="Int" id="38495">max</a> = <a href="#38491" title="Int">defaultBucketCount</a><span title="(x: Int)Int">-</span><span title="Int(1)" class="int">1</span>
	  
	  <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#38495" title="Int">max</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="38630">i</a> =&gt; <span class="delimiter">{</span>
	    <a href="#38493" title="Double">bucketTot</a> = <span class="delimiter">(</span><a href="#39295" title="Histogram.this.type" class="keyword">this</a>.<a href="#39144" title="(idx: Int)Long">buckets</a><span class="delimiter">(</span><a href="#38630" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; Double">toDouble</span>
	    <span class="comment">//System.out.println(&quot;Total in bucket &quot;+ bucketTot)</span>
	    <span class="comment">//System.out.println(&quot;TotalRequests &quot;+ this.totalRequests)</span>
	    <a href="#38494" title="Double">prob</a> = <span class="delimiter">(</span><a href="#38493" title="Double">bucketTot</a><span title="(x: Double)Double">/</span><span class="delimiter">(</span><span class="delimiter">(</span><a href="#39295" title="Histogram.this.type" class="keyword">this</a>.<a href="#33409" title="=&gt; Long">totalRequests</a><span class="delimiter">)</span>.<span title="=&gt; Double">toDouble</span><span class="delimiter">)</span><span class="delimiter">)</span><span title="(x: Int)Double">*</span><span title="Int(100)" class="int">100</span>
	    <span class="comment">//System.out.println(&quot;Prob value &quot; + prob)</span>
	    <a href="#38492" title="edu.berkeley.cs.scads.perf.Histogram">intermResult</a>.<a href="#39144" title="(idx: Int, elem: Long)Unit">buckets</a><span class="delimiter">(</span><a href="#38630" title="Int">i</a><span class="delimiter">)</span> = <a href="#38494" title="Double">prob</a>.<span title="=&gt; Long">toLong</span>
	  <span class="delimiter">}</span><span class="delimiter">)</span>

	  <span class="comment">/*Using probability histogram, create CDF*/</span>
	  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="38496">cdfResult</a> = <a href="#33378" title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</a><span class="delimiter">(</span><a href="#38490" title="Int">defaultBucketSize</a>, <a href="#38491" title="Int">defaultBucketCount</a><span class="delimiter">)</span>
	  <span class="keyword">var</span> <a title="Long" id="38497">totSum</a> : <span title="Long">Long</span> = <span title="Long(0L)" class="int">0</span>
	  <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#38495" title="Int">max</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="38779">i</a>=&gt; <span class="delimiter">{</span>
	    <a href="#38497" title="Long">totSum</a> = <span title="Long(0L)" class="int">0</span>
	    <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(end: Int)scala.collection.immutable.Range.Inclusive">to</span> <a href="#38779" title="Int">i</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="Int" id="38892">j</a>=&gt; <span class="delimiter">{</span>
	      <a href="#38497" title="Long">totSum</a> = <a href="#38492" title="edu.berkeley.cs.scads.perf.Histogram">intermResult</a>.<a href="#39144" title="(idx: Int)Long">buckets</a><span class="delimiter">(</span><a href="#38892" title="Int">j</a><span class="delimiter">)</span> <span title="(x: Long)Long">+</span> <a href="#38497" title="Long">totSum</a>
	    <span class="delimiter">}</span><span class="delimiter">)</span>
	    <a href="#38496" title="edu.berkeley.cs.scads.perf.Histogram">cdfResult</a>.<a href="#39144" title="(idx: Int, elem: Long)Unit">buckets</a><span class="delimiter">(</span><a href="#38779" title="Int">i</a><span class="delimiter">)</span> = <a href="#38497" title="Long">totSum</a>
	  <span class="delimiter">}</span><span class="delimiter">)</span>
	 
	  <a href="#38496" title="edu.berkeley.cs.scads.perf.Histogram">cdfResult</a>
	<span class="delimiter">}</span>
	
  <span class="keyword">def</span> <a title="(newBucketCount: Int)edu.berkeley.cs.scads.perf.Histogram" id="33421">collapseHist</a><span class="delimiter">(</span><a title="Int" id="38918">newBucketCount</a> : <span title="Int">Int</span><span class="delimiter">)</span>: <a href="#39295" title="edu.berkeley.cs.scads.perf.Histogram">Histogram</a> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="38920">defaultBucketSize</a> = <span title="Int(1)" class="int">1</span>
    <span class="keyword">var</span> <a title="Int" id="38921">originalHistLength</a> = <a href="#39295" title="Histogram.this.type" class="keyword">this</a>.<a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>.<span title="=&gt; Int">length</span>    
    <span class="keyword">var</span> <a title="Long" id="38922">total</a> = <span title="Long(0L)" class="long">0L</span>
    
    <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#39295" title="Histogram.this.type" class="keyword">this</a>.<a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>.<span title="=&gt; Int">length</span><span title="(x: Int)Int">%</span><a href="#38918" title="Int">newBucketCount</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span>, <span title="java.lang.String(&quot;The original bucket count (&quot;)" class="string">&quot;The original bucket count (&quot;</span> <span title="(x$1: Any)java.lang.String">+</span><a href="#39295" title="Histogram.this.type" class="keyword">this</a>.<a href="#39144" title="=&gt; scala.collection.mutable.ArrayBuffer[Long]">buckets</a>.<span title="=&gt; Int">length</span><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;) must be divisible by the new bucket count.&quot;)" class="string">&quot;) must be divisible by the new bucket count.&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="38923">collapseAmt</a> = <a href="#38921" title="Int">originalHistLength</a><span title="(x: Int)Int">/</span><a href="#38918" title="Int">newBucketCount</a>
    <span title="object java.lang.System">System</span>.<span title="java.io.PrintStream">out</span>.<span title="(x$1: java.lang.String)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Collapse value is: &quot;)" class="string">&quot;Collapse value is: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#38923" title="Int">collapseAmt</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="38924">collapsedHistogram</a> = <a href="#33378" title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</a><span class="delimiter">(</span><a href="#38920" title="Int">defaultBucketSize</a>, <a href="#38918" title="Int">newBucketCount</a><span class="delimiter">)</span>
    <span class="keyword">var</span> <a title="Int" id="38925">max</a> = <a href="#38918" title="Int">newBucketCount</a><span title="(x: Int)Int">-</span><span title="Int(1)" class="int">1</span>
    <span class="keyword">var</span> <a title="Int" id="38926">collapsedHistogramIndex</a> = <span title="Int(0)" class="int">0</span>
    <span class="keyword">var</span> <a title="Int" id="38927">origIndex</a> = <span title="Int(0)" class="int">0</span>
    <span class="keyword">var</span> <a title="Int" id="38928">collapseVal</a> = <a href="#38923" title="Int">collapseAmt</a>

    <span title="Unit" class="keyword">while</span><span class="delimiter">(</span><a href="#38926" title="Int">collapsedHistogramIndex</a> <span title="(x: Int)Boolean">&lt;=</span> <a href="#38925" title="Int">max</a><span class="delimiter">)</span>
    <a href="#38929" title="()Unit" class="delimiter">{</a>
    	<span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#38927" title="Int">origIndex</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#38928" title="Int">collapseVal</a><span class="delimiter">)</span>
    	<a href="#39099" title="()Unit" class="delimiter">{</a>
    		<a href="#38922" title="Long">total</a> = <a href="#39295" title="Histogram.this.type" class="keyword">this</a>.<a href="#39144" title="(idx: Int)Long">buckets</a><span class="delimiter">(</span><a href="#38927" title="Int">origIndex</a><span class="delimiter">)</span><span title="(x: Long)Long">+</span><a href="#38922" title="Long">total</a>
    		<a href="#38927" title="Int">origIndex</a> = <a href="#38927" title="Int">origIndex</a><span title="(x: Int)Int">+</span><span title="Int(1)" class="int">1</span>
    	<span class="delimiter">}</span>
    	<a href="#38924" title="edu.berkeley.cs.scads.perf.Histogram">collapsedHistogram</a>.<a href="#39144" title="(idx: Int, elem: Long)Unit">buckets</a><span class="delimiter">(</span><a href="#38926" title="Int">collapsedHistogramIndex</a><span class="delimiter">)</span> = <a href="#38922" title="Long">total</a>
    	<a href="#38928" title="Int">collapseVal</a> = <a href="#38928" title="Int">collapseVal</a> <span title="(x: Int)Int">+</span> <a href="#38923" title="Int">collapseAmt</a>
    	<a href="#38922" title="Long">total</a> = <span title="Long(0L)" class="int">0</span>
    	<a href="#38926" title="Int">collapsedHistogramIndex</a> = <a href="#38926" title="Int">collapsedHistogramIndex</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>
        
    <a href="#38924" title="edu.berkeley.cs.scads.perf.Histogram">collapsedHistogram</a>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>