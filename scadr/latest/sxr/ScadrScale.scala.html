<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>ScadrScale.scala</title>
        <script type="text/javascript" src="jquery-all.js"></script>
        <script type="text/javascript" src="linked.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs
<span class="keyword">package</span> scads
<span class="keyword">package</span> perf
<span class="keyword">package</span> scadr
<span class="keyword">package</span> scale

<span class="keyword">import</span> comm._
<span class="keyword">import</span> piql._
<span class="keyword">import</span> piql.scadr._
<span class="keyword">import</span> storage._
<span class="keyword">import</span> avro.runtime._
<span class="keyword">import</span> avro.marker._

<span class="keyword">import</span> deploylib._
<span class="keyword">import</span> deploylib.mesos._
<span class="keyword">import</span> deploylib.ec2._

<span class="keyword">import</span> scala.util.Random

case <span class="keyword">class</span> <a title="class Result extends org.apache.avro.specific.SpecificRecordBase with edu.berkeley.cs.avro.runtime.HasAvroConversions with edu.berkeley.cs.avro.marker.AvroPair with ScalaObject with Product with Serializable" id="39965">Result</a><a href="#39965" title="ScalaObject" class="delimiter">(</a><a href="#39965" title="()edu.berkeley.cs.scads.perf.scadr.scale.Result" id="40351" class="keyword">var</a> <a title="edu.berkeley.cs.scads.perf.scadr.scale.ScadrScaleTask" id="38994">clientConfig</a>: <a href="#39961" title="edu.berkeley.cs.scads.perf.scadr.scale.ScadrScaleTask">ScadrScaleTask</a>,
                  <span class="keyword">var</span> <a title="edu.berkeley.cs.scads.perf.scadr.ScadrLoaderTask" id="38995">loaderConfig</a>: <a href="ScadrLoader.scala.html#9770" title="edu.berkeley.cs.scads.perf.scadr.ScadrLoaderTask">ScadrLoaderTask</a>,
                  <span class="keyword">var</span> <a title="String" id="38996">clusterAddress</a>: <span title="String">String</span>,
                  <span class="keyword">var</span> <a title="Int" id="38997">clientId</a>: <span title="Int">Int</span>,
                  <span class="keyword">var</span> <a title="Int" id="38998">iteration</a>: <span title="Int">Int</span>,
                  <span class="keyword">var</span> <a title="Int" id="38999">threadId</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="edu.berkeley.cs.avro.marker.AvroPair">AvroPair</span> <span class="delimiter">{</span>
  <span class="keyword">var</span> <a title="edu.berkeley.cs.scads.perf.Histogram" id="37359">times</a>: <span title="edu.berkeley.cs.scads.perf.Histogram">Histogram</span> = <span title="Null(null)" class="keyword">null</span>
  <span class="keyword">var</span> <a title="Int" id="37362">skips</a>: <span title="Int">Int</span> = <span title="Int(0)" class="int">0</span>
<span class="delimiter">}</span>

case <span class="keyword">class</span> <a href="#45519" title="class ScadrScaleTask extends org.apache.avro.specific.SpecificRecordBase with edu.berkeley.cs.avro.runtime.HasAvroConversions with edu.berkeley.cs.avro.marker.AvroRecord with edu.berkeley.cs.scads.perf.ReplicatedExperimentTask with ScalaObject with Product with Serializable" id="39961">ScadrScaleTask</a><a href="#39961" title="ScalaObject" class="delimiter">(</a><a href="#39961" title="()edu.berkeley.cs.scads.perf.scadr.scale.ScadrScaleTask" id="40361" class="keyword">var</a> <a title="Int" id="39934">numClients</a>: <span title="Int">Int</span>,
                          <span class="keyword">var</span> <a title="String" id="39935">executorClass</a>: <span title="String">String</span>,
                          <span class="keyword">var</span> <a title="Double" id="39936">writeProbability</a>: <span title="Double">Double</span>,
                          <span class="keyword">var</span> <a title="Int" id="39949">iterations</a>: <span title="Int">Int</span> = <span title="Int(5)" class="int">5</span>,
                          <span class="keyword">var</span> <a title="Int" id="39950">threads</a>: <span title="Int">Int</span> = <span title="Int(50)" class="int">50</span>,
                          <span class="keyword">var</span> <a title="Int" id="39951">runLengthMin</a>: <span title="Int">Int</span> = <span title="Int(5)" class="int">5</span>,
                          <span class="keyword">var</span> <a title="Int" id="39952">resultsPerPage</a>: <span title="Int">Int</span> = <span title="Int(10)" class="int">10</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="edu.berkeley.cs.avro.marker.AvroRecord">AvroRecord</span> <span class="keyword">with</span> <span title="edu.berkeley.cs.scads.perf.ReplicatedExperimentTask">ReplicatedExperimentTask</span> <span class="delimiter">{</span>
  <span class="keyword">var</span> <a title="String" id="37436">clusterAddress</a>: <span title="String">String</span> = _
  <span class="keyword">var</span> <a title="String" id="37439">resultClusterAddress</a>: <span title="String">String</span> = _
  <span class="keyword">var</span> <a title="String" id="37442">experimentAddress</a>: <span title="String">String</span> = _

  <span class="comment">/* True if coin flip with prob succeeds */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(prob: Double)Boolean" id="37444">flipCoin</a><span class="delimiter">(</span><a title="Double" id="37693">prob</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span title="object scala.util.Random">Random</span>.<span title="()Double">nextDouble</span> <span title="(x: Double)Boolean">&lt;</span> <a href="#37693" title="Double">prob</a>

  <span class="keyword">def</span> <a title="()Unit" id="37445">run</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.perf.scadr.scale.Result]" id="37701">results</a> = <span title="edu.berkeley.cs.scads.storage.ScadsCluster" class="keyword">new</span> <span title="edu.berkeley.cs.scads.storage.ScadsCluster">ScadsCluster</span><span class="delimiter">(</span><span title="(uri: String)edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">ZooKeeperNode</span><span class="delimiter">(</span><a href="#37439" title="=&gt; String">resultClusterAddress</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="[PairType &lt;: edu.berkeley.cs.avro.marker.AvroPair](ns: String)(implicit evidence$7: Manifest[PairType])edu.berkeley.cs.scads.storage.PairNamespace[PairType]">getNamespace</span><span title="(ns: String)(implicit evidence$7: Manifest[edu.berkeley.cs.scads.perf.scadr.scale.Result])edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.perf.scadr.scale.Result]" class="delimiter">[</span><a href="#39965" title="edu.berkeley.cs.scads.perf.scadr.scale.Result">Result</a><span class="delimiter">]</span><span title="(clazz: Class[_])scala.reflect.Manifest[edu.berkeley.cs.scads.perf.scadr.scale.Result]" class="delimiter">(</span><span title="java.lang.String(&quot;scadrScaleResults&quot;)" class="string">&quot;scadrScaleResults&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode" id="37702">clusterRoot</a> = <span title="(uri: String)edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">ZooKeeperNode</span><span class="delimiter">(</span><a href="#37436" title="=&gt; String">clusterAddress</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode" id="37703">coordination</a> = <a href="#37702" title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">clusterRoot</a>.<span title="(rpath: java.lang.String, tries: Int)edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">getOrCreate</span><span class="delimiter">(</span><span title="java.lang.String(&quot;coordination/clients&quot;)" class="string">&quot;coordination/clients&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.ScadsCluster" id="37704">cluster</a> = <span title="edu.berkeley.cs.scads.storage.ScadsCluster" class="keyword">new</span> <span title="edu.berkeley.cs.scads.storage.ScadsCluster">ScadsCluster</span><span class="delimiter">(</span><a href="#37702" title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">clusterRoot</a><span class="delimiter">)</span>
    <span class="keyword">var</span> <a title="edu.berkeley.cs.scads.piql.package.QueryExecutor" id="37705">executor</a> = <span title="object java.lang.Class">Class</span>.<span title="(x$1: java.lang.String)java.lang.Class[_]">forName</span><span class="delimiter">(</span><a href="#39935" title="=&gt; String">executorClass</a><span class="delimiter">)</span>.<span title="()?0">newInstance</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.piql.package.QueryExecutor" class="delimiter">[</span><span title="edu.berkeley.cs.scads.piql.package.QueryExecutor">QueryExecutor</span><span class="delimiter">]</span>
    <span class="keyword">val</span> <a title="Int" id="37706">clientId</a> = <a href="#37703" title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">coordination</a>.<span title="(barrierName: String, count: Int, timeout: Long, unit: java.util.concurrent.TimeUnit)Int">registerAndAwait</span><span class="delimiter">(</span><span title="java.lang.String(&quot;clientStart&quot;)" class="string">&quot;clientStart&quot;</span>, <a href="#39934" title="=&gt; Int">numClients</a>, timeout=<span class="int">60</span> * <span class="int">60</span> <span title="Long(3600000L)">*</span> <span class="int">1000</span><span class="delimiter">)</span>

    <a href="#39961" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Waiting for cluster to be ready&quot;)" class="string">&quot;Waiting for cluster to be ready&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode" id="37707">clusterConfig</a> = <a href="#37702" title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">clusterRoot</a>.<a title="Option[Int]" id="38493">awaitChild</a><span class="delimiter">(</span><a title="java.lang.String(&quot;clusterReady&quot;)" id="38490" class="string">&quot;clusterReady&quot;</a>, timeout=<span class="int">60</span>*<span class="int">60</span><a title="Long(3600000L)" id="38491">*</a><span class="int">1000</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.scadr.ScadrLoaderTask" id="37708">loaderConfig</a> = classOf<span title="java.lang.Class[edu.berkeley.cs.scads.perf.scadr.ScadrLoaderTask](classOf[edu.berkeley.cs.scads.perf.scadr.ScadrLoaderTask])" class="delimiter">[</span>ScadrLoaderTask<span class="delimiter">]</span>.<span title="()edu.berkeley.cs.scads.perf.scadr.ScadrLoaderTask">newInstance</span>.<span title="(data: Array[Byte])edu.berkeley.cs.scads.perf.scadr.ScadrLoaderTask">parse</span><span class="delimiter">(</span><a href="#37707" title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">clusterConfig</a>.<span title="=&gt; Array[Byte]">data</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.scadr.ScadrClient" id="37709">scadrClient</a> = <span title="edu.berkeley.cs.scads.piql.scadr.ScadrClient" class="keyword">new</span> <a href="ScadrClient.scala.html#9583" title="edu.berkeley.cs.scads.piql.scadr.ScadrClient">ScadrClient</a><span class="delimiter">(</span><a href="#37704" title="edu.berkeley.cs.scads.storage.ScadsCluster">cluster</a>, <a href="#37705" title="edu.berkeley.cs.scads.piql.package.QueryExecutor">executor</a><span class="delimiter">)</span>


    <span class="comment">//TODO: Seperate ScadrData and ScadrLoader, move this to a function</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.scadr.ScadrLoader" id="37710">loader</a> = <span title="edu.berkeley.cs.scads.piql.scadr.ScadrLoader" class="keyword">new</span> <a href="ScadrData.scala.html#9606" title="edu.berkeley.cs.scads.piql.scadr.ScadrLoader">ScadrLoader</a><span class="delimiter">(</span>
      replicationFactor = <a href="#37708" title="edu.berkeley.cs.scads.perf.scadr.ScadrLoaderTask">loaderConfig</a>.<a href="ScadrLoader.scala.html#36025" title="=&gt; Int">replicationFactor</a>,
      numClients = <a href="#37708" title="edu.berkeley.cs.scads.perf.scadr.ScadrLoaderTask">loaderConfig</a>.<a href="ScadrLoader.scala.html#36019" title="=&gt; Int">numLoaders</a>,
      numUsers = <a href="#37708" title="edu.berkeley.cs.scads.perf.scadr.ScadrLoaderTask">loaderConfig</a>.<a href="ScadrLoader.scala.html#36016" title="=&gt; Int">numServers</a> <span title="(x: Int)Int">*</span> <a href="#37708" title="edu.berkeley.cs.scads.perf.scadr.ScadrLoaderTask">loaderConfig</a>.<a href="ScadrLoader.scala.html#36028" title="=&gt; Int">usersPerServer</a> <span title="(x: Int)Int">/</span> <a href="#37708" title="edu.berkeley.cs.scads.perf.scadr.ScadrLoaderTask">loaderConfig</a>.<a href="ScadrLoader.scala.html#36025" title="=&gt; Int">replicationFactor</a>,
      numThoughtsPerUser = <span title="Int(100)" class="int">100</span>,
      numSubscriptionsPerUser = <a href="#37708" title="edu.berkeley.cs.scads.perf.scadr.ScadrLoaderTask">loaderConfig</a>.<a href="ScadrLoader.scala.html#36022" title="=&gt; Int">followingCardinality</a>,
      numTagsPerThought = <span title="Int(5)" class="int">5</span><span class="delimiter">)</span>

    <span class="keyword">for</span> <span class="delimiter">(</span><a title="Int" id="38672">iteration</a> &lt;- <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">1</span> <span title="(f: Int =&gt; Int)Unit">to</span> <a href="#39949" title="=&gt; Int">iterations</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#39961" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Begining iteration %d&quot;)" class="string">&quot;Begining iteration %d&quot;</span>, <a href="#38672" title="Int">iteration</a><span class="delimiter">)</span>

      <a href="#37701" title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.perf.scadr.scale.Result]">results</a> <span title="(that: TraversableOnce[edu.berkeley.cs.scads.perf.scadr.scale.Result])Unit">++=</span> <span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">1</span> <span title="(itr: Iterable[Int])deploylib.ParallelSeq[Int]">to</span> <a href="#39950" title="=&gt; Int">threads</a><span class="delimiter">)</span>.<span title="(f: Int =&gt; edu.berkeley.cs.scads.perf.scadr.scale.Result)List[edu.berkeley.cs.scads.perf.scadr.scale.Result]">pmap</span><span class="delimiter">(</span><a title="Int" id="38801">threadId</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">def</span> <a title="=&gt; Long" id="38802">getTime</a> = <span title="object java.lang.System">System</span>.<span title="()Long">nanoTime</span> <span title="(x: Int)Long">/</span> <span title="Int(1000000)" class="int">1000000</span>
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.perf.scadr.scale.Result" id="38803">result</a> = <a href="#39965" title="(clientConfig: edu.berkeley.cs.scads.perf.scadr.scale.ScadrScaleTask, loaderConfig: edu.berkeley.cs.scads.perf.scadr.ScadrLoaderTask, clusterAddress: String, clientId: Int, iteration: Int, threadId: Int)edu.berkeley.cs.scads.perf.scadr.scale.Result">Result</a><span class="delimiter">(</span><a href="#39961" title="edu.berkeley.cs.scads.perf.scadr.scale.ScadrScaleTask" class="keyword">this</a>, <a href="#37708" title="edu.berkeley.cs.scads.perf.scadr.ScadrLoaderTask">loaderConfig</a>, <a href="#37702" title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">clusterRoot</a>.<span title="=&gt; java.lang.String">canonicalAddress</span>, <a href="#37706" title="Int">clientId</a>, <a href="#38672" title="Int">iteration</a>, <a href="#38801" title="Int">threadId</a><span class="delimiter">)</span>
        <a href="#38803" title="edu.berkeley.cs.scads.perf.scadr.scale.Result">result</a>.<a href="#37359" title="(x$1: edu.berkeley.cs.scads.perf.Histogram)Unit">times</a> = <span title="(bucketSize: Int, bucketCount: Int)edu.berkeley.cs.scads.perf.Histogram">Histogram</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>, <span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Long" id="38804">runTime</a> = <a href="#39951" title="=&gt; Int">runLengthMin</a> <span title="(x: Int)Int">*</span> <span title="Int(60)" class="int">60</span> <span title="(x: Long)Long">*</span> <span title="Long(1000L)" class="long">1000L</span>
        <span class="keyword">val</span> <a title="Long" id="38805">iterationStartTime</a> = <a href="#38802" title="=&gt; Long">getTime</a>
        <span class="keyword">var</span> <a title="Long" id="38806">endTime</a> = <a href="#38805" title="Long">iterationStartTime</a>
        <span class="keyword">var</span> <a title="Int" id="38807">skips</a> = <span title="Int(0)" class="int">0</span>
        <span class="keyword">var</span> <a title="Int" id="38808">failures</a> = <span title="Int(0)" class="int">0</span>

        <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#38806" title="Long">endTime</a> <span title="(x: Long)Long">-</span> <a href="#38805" title="Long">iterationStartTime</a> <span title="(x: Long)Boolean">&lt;</span> <a href="#38804" title="Long">runTime</a><span class="delimiter">)</span> <a href="#38809" title="()Unit" class="delimiter">{</a>
          <span class="keyword">val</span> <a title="Long" id="39407">startTime</a> = <a href="#38802" title="=&gt; Long">getTime</a>

          <span class="keyword">try</span> <span class="delimiter">{</span>
            <span class="comment">// Here we try to emulate a page load for scadr</span>
            <span class="comment">// the assertions below are to prevent the compiler/jvm from</span>
            <span class="comment">// optimizing away the queries</span>

            <span class="keyword">val</span> <a title="String" id="39408">currentUser</a> = <a href="#37710" title="edu.berkeley.cs.scads.piql.scadr.ScadrLoader">loader</a>.<a href="ScadrData.scala.html#19071" title="=&gt; String">randomUser</a>

            <span class="comment">// 1) load the user's thoughtstream</span>
            <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.package.QueryResult" id="39409">ts</a> = <a href="#37709" title="edu.berkeley.cs.scads.piql.scadr.ScadrClient">scadrClient</a>.<a href="ScadrClient.scala.html#17028" title="(args: Any*)edu.berkeley.cs.scads.piql.package.QueryResult">thoughtstream</a><span class="delimiter">(</span><a href="#39408" title="String">currentUser</a>, <a href="#39952" title="=&gt; Int">resultsPerPage</a><span class="delimiter">)</span>
            <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="#39409" title="edu.berkeley.cs.scads.piql.package.QueryResult">ts</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>

            <span class="comment">// 2) load the user's followers</span>
            <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.package.QueryResult" id="39410">followers</a> = <a href="#37709" title="edu.berkeley.cs.scads.piql.scadr.ScadrClient">scadrClient</a>.<a href="ScadrClient.scala.html#17030" title="(args: Any*)edu.berkeley.cs.scads.piql.package.QueryResult">usersFollowing</a><span class="delimiter">(</span><a href="#39408" title="String">currentUser</a>, <a href="#39952" title="=&gt; Int">resultsPerPage</a><span class="delimiter">)</span>
            <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="#39410" title="edu.berkeley.cs.scads.piql.package.QueryResult">followers</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>

            <span class="comment">// 3) load the user's followings</span>
            <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.package.QueryResult" id="39411">followings</a> = <a href="#37709" title="edu.berkeley.cs.scads.piql.scadr.ScadrClient">scadrClient</a>.<a href="ScadrClient.scala.html#17026" title="(args: Any*)edu.berkeley.cs.scads.piql.package.QueryResult">usersFollowedBy</a><span class="delimiter">(</span><a href="#39408" title="String">currentUser</a>, <a href="#39952" title="=&gt; Int">resultsPerPage</a><span class="delimiter">)</span>
            <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="#39411" title="edu.berkeley.cs.scads.piql.package.QueryResult">followings</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>

            <span class="comment">// 4) make a tweet with some probability</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#37444" title="(prob: Double)Boolean">flipCoin</a><span class="delimiter">(</span><a href="#39936" title="=&gt; Double">writeProbability</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="Int" id="39446">thoughtTime</a> = <a href="#38802" title="=&gt; Long">getTime</a>.<span title="=&gt; Int">toInt</span>
              <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.scadr.Thought" id="39447">thought</a> = <span title="edu.berkeley.cs.scads.piql.scadr.Thought" class="keyword">new</span> <a href="ScadrClient.scala.html#27380" title="edu.berkeley.cs.scads.piql.scadr.Thought">Thought</a><span class="delimiter">(</span><a href="#39408" title="String">currentUser</a>, <a href="#39446" title="Int">thoughtTime</a><span class="delimiter">)</span>
              <a href="#39447" title="edu.berkeley.cs.scads.piql.scadr.Thought">thought</a>.<a href="ScadrClient.scala.html#15458" title="(x$1: String)Unit">text</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;New thought by user %s at time %d&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#39408" title="String">currentUser</a>, <a href="#39446" title="Int">thoughtTime</a><span class="delimiter">)</span>
              <a href="#37709" title="edu.berkeley.cs.scads.piql.scadr.ScadrClient">scadrClient</a>.<a href="ScadrClient.scala.html#17016" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.scadr.Thought]">thoughts</a>.<span title="(key: org.apache.avro.generic.IndexedRecord, value: Option[org.apache.avro.generic.IndexedRecord])Unit">put</span><span class="delimiter">(</span><a href="#39447" title="edu.berkeley.cs.scads.piql.scadr.Thought">thought</a>.<span title="=&gt; org.apache.avro.generic.GenericRecord">key</span>, <a href="#39447" title="edu.berkeley.cs.scads.piql.scadr.Thought">thought</a>.<span title="(a: org.apache.avro.generic.GenericRecord)Option[org.apache.avro.generic.GenericRecord]">value</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>

            <a href="#38806" title="Long">endTime</a> = <a href="#38802" title="=&gt; Long">getTime</a>
            <span class="keyword">val</span> <a title="Long" id="39412">elapsedTime</a> = <a href="#38806" title="Long">endTime</a> <span title="(x: Long)Long">-</span> <a href="#39407" title="Long">startTime</a>
            <a href="#38803" title="edu.berkeley.cs.scads.perf.scadr.scale.Result">result</a>.<a href="#37359" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">times</a> <span title="(value: Long)Unit">+=</span> <a href="#39412" title="Long">elapsedTime</a>
          <span class="delimiter">}</span>
          <span class="keyword">catch</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a title="Unit" id="39585">e</a> =&gt; <span class="delimiter">{</span>
              <a href="#39961" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(thrown: Throwable, msg: String, items: Any*)Unit">warning</span><span class="delimiter">(</span><a href="#39585" title="java.lang.Throwable">e</a>, <span title="java.lang.String(&quot;Execepting generating page&quot;)" class="string">&quot;Execepting generating page&quot;</span><span class="delimiter">)</span>
              <a href="#38807" title="Int">skips</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>

        <a href="#39961" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Thread %d stats 50th: %dms, 90th: %dms, 99th: %dms&quot;)" class="string">&quot;Thread %d stats 50th: %dms, 90th: %dms, 99th: %dms&quot;</span>, <a href="#38801" title="Int">threadId</a>, <a href="#38803" title="edu.berkeley.cs.scads.perf.scadr.scale.Result">result</a>.<a href="#37359" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">times</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.5)" class="double">0.50</span><span class="delimiter">)</span>, <a href="#38803" title="edu.berkeley.cs.scads.perf.scadr.scale.Result">result</a>.<a href="#37359" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">times</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.9)" class="double">0.90</span><span class="delimiter">)</span>, <a href="#38803" title="edu.berkeley.cs.scads.perf.scadr.scale.Result">result</a>.<a href="#37359" title="=&gt; edu.berkeley.cs.scads.perf.Histogram">times</a>.<span title="(fraction: Double)Int">quantile</span><span class="delimiter">(</span><span title="Double(0.99)" class="double">0.99</span><span class="delimiter">)</span><span class="delimiter">)</span>

        <a href="#38803" title="edu.berkeley.cs.scads.perf.scadr.scale.Result">result</a>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <a href="#37703" title="edu.berkeley.cs.scads.comm.ZooKeeperProxy#ZooKeeperNode">coordination</a>.<span title="(barrierName: String, count: Int, timeout: Long, unit: java.util.concurrent.TimeUnit)Int">registerAndAwait</span><span class="delimiter">(</span><span title="java.lang.String(&quot;iteration&quot;)" class="string">&quot;iteration&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#38672" title="Int">iteration</a>, <a href="#39934" title="=&gt; Int">numClients</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#37706" title="Int">clientId</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="object deploylib.ec2.ExperimentNotification">ExperimentNotification</span>.<span title="object deploylib.ec2.ExperimentNotification.completions">completions</span>.<span title="(subject: String, message: String)Unit">publish</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Scadr Scale Experiment Complete&quot;)" class="string">&quot;Scadr Scale Experiment Complete&quot;</span>, <a href="#39961" title="(record: edu.berkeley.cs.scads.perf.scadr.scale.ScadrScaleTask)edu.berkeley.cs.avro.runtime.RichIndexedRecord[edu.berkeley.cs.scads.perf.scadr.scale.ScadrScaleTask]" class="keyword">this</a>.<span title="=&gt; String">toJson</span><span class="delimiter">)</span>
      <a href="#37704" title="edu.berkeley.cs.scads.storage.ScadsCluster">cluster</a>.<span title="=&gt; Unit">shutdown</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>