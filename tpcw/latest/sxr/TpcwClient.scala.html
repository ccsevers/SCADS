<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>TpcwClient.scala</title>
        <script type="text/javascript" src="jquery-all.js"></script>
        <script type="text/javascript" src="linked.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> edu.berkeley.cs
<span class="keyword">package</span> scads
<span class="keyword">package</span> piql
<span class="keyword">package</span> tpcw

<span class="keyword">import</span> net.lag.logging.Logger

<span class="keyword">import</span> opt._
<span class="keyword">import</span> plans._
<span class="keyword">import</span> comm._
<span class="keyword">import</span> storage._
<span class="keyword">import</span> storage.client.index._

<span class="keyword">import</span> ch.ethz.systems.tpcw.populate.data.Utils

<span class="keyword">import</span> java.util.UUID

<span class="keyword">class</span> <a title="class TpcwClient extends java.lang.Object with ScalaObject" id="9653">TpcwClient</a><a href="#9653" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.ScadsCluster" id="28830">cluster</a>: <span title="edu.berkeley.cs.scads.storage.ScadsCluster">ScadsCluster</span>, <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.package.QueryExecutor" id="28831">executor</a>: <span title="edu.berkeley.cs.scads.piql.package.QueryExecutor">QueryExecutor</span><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">protected</span> <span class="keyword">val</span> <a title="net.lag.logging.Logger" id="12891">logger</a> = <span title="(name: String)net.lag.logging.Logger">Logger</span><span class="delimiter">(</span><span title="java.lang.String(&quot;edu.berkeley.cs.scads.piql.TpcwWorkflow&quot;)" class="string">&quot;edu.berkeley.cs.scads.piql.TpcwWorkflow&quot;</span><span class="delimiter">)</span>
  <span class="keyword">protected</span> <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.package.QueryExecutor" id="12893">exec</a> = <a href="#28831" title="=&gt; edu.berkeley.cs.scads.piql.package.QueryExecutor">executor</a>

  <span class="comment">/* Relations */</span>
  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Address]" id="12895">addresses</a> = <a href="#28830" title="=&gt; edu.berkeley.cs.scads.storage.ScadsCluster">cluster</a>.<span title="[PairType &lt;: edu.berkeley.cs.avro.marker.AvroPair](ns: String)(implicit evidence$7: Manifest[PairType])edu.berkeley.cs.scads.storage.PairNamespace[PairType]">getNamespace</span><span title="(ns: String)(implicit evidence$7: Manifest[edu.berkeley.cs.scads.piql.tpcw.Address])edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Address]" class="delimiter">[</span><a href="TpcwSchema.scala.html#9732" title="edu.berkeley.cs.scads.piql.tpcw.Address">Address</a><span class="delimiter">]</span><span title="(clazz: Class[_])scala.reflect.Manifest[edu.berkeley.cs.scads.piql.tpcw.Address]" class="delimiter">(</span><span title="java.lang.String(&quot;addresses&quot;)" class="string">&quot;addresses&quot;</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Author]" id="12897">authors</a> = <a href="#28830" title="=&gt; edu.berkeley.cs.scads.storage.ScadsCluster">cluster</a>.<span title="[PairType &lt;: edu.berkeley.cs.avro.marker.AvroPair](ns: String)(implicit evidence$7: Manifest[PairType])edu.berkeley.cs.scads.storage.PairNamespace[PairType]">getNamespace</span><span title="(ns: String)(implicit evidence$7: Manifest[edu.berkeley.cs.scads.piql.tpcw.Author])edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Author]" class="delimiter">[</span><a href="TpcwSchema.scala.html#9717" title="edu.berkeley.cs.scads.piql.tpcw.Author">Author</a><span class="delimiter">]</span><span title="(clazz: Class[_])scala.reflect.Manifest[edu.berkeley.cs.scads.piql.tpcw.Author]" class="delimiter">(</span><span title="java.lang.String(&quot;authors&quot;)" class="string">&quot;authors&quot;</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.CcXact]" id="12899">xacts</a> = <a href="#28830" title="=&gt; edu.berkeley.cs.scads.storage.ScadsCluster">cluster</a>.<span title="[PairType &lt;: edu.berkeley.cs.avro.marker.AvroPair](ns: String)(implicit evidence$7: Manifest[PairType])edu.berkeley.cs.scads.storage.PairNamespace[PairType]">getNamespace</span><span title="(ns: String)(implicit evidence$7: Manifest[edu.berkeley.cs.scads.piql.tpcw.CcXact])edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.CcXact]" class="delimiter">[</span><a href="TpcwSchema.scala.html#9729" title="edu.berkeley.cs.scads.piql.tpcw.CcXact">CcXact</a><span class="delimiter">]</span><span title="(clazz: Class[_])scala.reflect.Manifest[edu.berkeley.cs.scads.piql.tpcw.CcXact]" class="delimiter">(</span><span title="java.lang.String(&quot;xacts&quot;)" class="string">&quot;xacts&quot;</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Country]" id="12901">countries</a> = <a href="#28830" title="=&gt; edu.berkeley.cs.scads.storage.ScadsCluster">cluster</a>.<span title="[PairType &lt;: edu.berkeley.cs.avro.marker.AvroPair](ns: String)(implicit evidence$7: Manifest[PairType])edu.berkeley.cs.scads.storage.PairNamespace[PairType]">getNamespace</span><span title="(ns: String)(implicit evidence$7: Manifest[edu.berkeley.cs.scads.piql.tpcw.Country])edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Country]" class="delimiter">[</span><a href="TpcwSchema.scala.html#9714" title="edu.berkeley.cs.scads.piql.tpcw.Country">Country</a><span class="delimiter">]</span><span title="(clazz: Class[_])scala.reflect.Manifest[edu.berkeley.cs.scads.piql.tpcw.Country]" class="delimiter">(</span><span title="java.lang.String(&quot;countries&quot;)" class="string">&quot;countries&quot;</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Customer]" id="12903">customers</a> = <a href="#28830" title="=&gt; edu.berkeley.cs.scads.storage.ScadsCluster">cluster</a>.<span title="[PairType &lt;: edu.berkeley.cs.avro.marker.AvroPair](ns: String)(implicit evidence$7: Manifest[PairType])edu.berkeley.cs.scads.storage.PairNamespace[PairType]">getNamespace</span><span title="(ns: String)(implicit evidence$7: Manifest[edu.berkeley.cs.scads.piql.tpcw.Customer])edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Customer]" class="delimiter">[</span><a href="TpcwSchema.scala.html#9720" title="edu.berkeley.cs.scads.piql.tpcw.Customer">Customer</a><span class="delimiter">]</span><span title="(clazz: Class[_])scala.reflect.Manifest[edu.berkeley.cs.scads.piql.tpcw.Customer]" class="delimiter">(</span><span title="java.lang.String(&quot;customers&quot;)" class="string">&quot;customers&quot;</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Item]" id="12905">items</a> = <a href="#28830" title="=&gt; edu.berkeley.cs.scads.storage.ScadsCluster">cluster</a>.<span title="[PairType &lt;: edu.berkeley.cs.avro.marker.AvroPair](ns: String)(implicit evidence$7: Manifest[PairType])edu.berkeley.cs.scads.storage.PairNamespace[PairType]">getNamespace</span><span title="(ns: String)(implicit evidence$7: Manifest[edu.berkeley.cs.scads.piql.tpcw.Item])edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Item]" class="delimiter">[</span><a href="TpcwSchema.scala.html#9711" title="edu.berkeley.cs.scads.piql.tpcw.Item">Item</a><span class="delimiter">]</span><span title="(clazz: Class[_])scala.reflect.Manifest[edu.berkeley.cs.scads.piql.tpcw.Item]" class="delimiter">(</span><span title="java.lang.String(&quot;items&quot;)" class="string">&quot;items&quot;</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.OrderLine]" id="12907">orderLines</a> = <a href="#28830" title="=&gt; edu.berkeley.cs.scads.storage.ScadsCluster">cluster</a>.<span title="[PairType &lt;: edu.berkeley.cs.avro.marker.AvroPair](ns: String)(implicit evidence$7: Manifest[PairType])edu.berkeley.cs.scads.storage.PairNamespace[PairType]">getNamespace</span><span title="(ns: String)(implicit evidence$7: Manifest[edu.berkeley.cs.scads.piql.tpcw.OrderLine])edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.OrderLine]" class="delimiter">[</span><a href="TpcwSchema.scala.html#9726" title="edu.berkeley.cs.scads.piql.tpcw.OrderLine">OrderLine</a><span class="delimiter">]</span><span title="(clazz: Class[_])scala.reflect.Manifest[edu.berkeley.cs.scads.piql.tpcw.OrderLine]" class="delimiter">(</span><span title="java.lang.String(&quot;orderLines&quot;)" class="string">&quot;orderLines&quot;</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Order]" id="12909">orders</a> = <a href="#28830" title="=&gt; edu.berkeley.cs.scads.storage.ScadsCluster">cluster</a>.<span title="[PairType &lt;: edu.berkeley.cs.avro.marker.AvroPair](ns: String)(implicit evidence$7: Manifest[PairType])edu.berkeley.cs.scads.storage.PairNamespace[PairType]">getNamespace</span><span title="(ns: String)(implicit evidence$7: Manifest[edu.berkeley.cs.scads.piql.tpcw.Order])edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Order]" class="delimiter">[</span><a href="TpcwSchema.scala.html#9723" title="edu.berkeley.cs.scads.piql.tpcw.Order">Order</a><span class="delimiter">]</span><span title="(clazz: Class[_])scala.reflect.Manifest[edu.berkeley.cs.scads.piql.tpcw.Order]" class="delimiter">(</span><span title="java.lang.String(&quot;orders&quot;)" class="string">&quot;orders&quot;</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem]" id="12911">shoppingCartItems</a> = <a href="#28830" title="=&gt; edu.berkeley.cs.scads.storage.ScadsCluster">cluster</a>.<span title="[PairType &lt;: edu.berkeley.cs.avro.marker.AvroPair](ns: String)(implicit evidence$7: Manifest[PairType])edu.berkeley.cs.scads.storage.PairNamespace[PairType]">getNamespace</span><span title="(ns: String)(implicit evidence$7: Manifest[edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem])edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem]" class="delimiter">[</span><a href="TpcwSchema.scala.html#9735" title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem">ShoppingCartItem</a><span class="delimiter">]</span><span title="(clazz: Class[_])scala.reflect.Manifest[edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem]" class="delimiter">(</span><span title="java.lang.String(&quot;shoppingCartItems&quot;)" class="string">&quot;shoppingCartItems&quot;</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.storage.PairNamespace[_ &gt;: edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem with edu.berkeley.cs.scads.piql.tpcw.Order with edu.berkeley.cs.scads.piql.tpcw.OrderLine with edu.berkeley.cs.scads.piql.tpcw.Item with edu.berkeley.cs.scads.piql.tpcw.Customer with edu.berkeley.cs.scads.piql.tpcw.Country with edu.berkeley.cs.scads.piql.tpcw.CcXact with edu.berkeley.cs.scads.piql.tpcw.Author with edu.berkeley.cs.scads.piql.tpcw.Address &lt;: edu.berkeley.cs.avro.marker.AvroPair with Product with Serializable]]" id="12913">namespaces</a> = <span title="(xs: edu.berkeley.cs.scads.storage.PairNamespace[_ &gt;: edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem with edu.berkeley.cs.scads.piql.tpcw.Order with edu.berkeley.cs.scads.piql.tpcw.OrderLine with edu.berkeley.cs.scads.piql.tpcw.Item with edu.berkeley.cs.scads.piql.tpcw.Customer with edu.berkeley.cs.scads.piql.tpcw.Country with edu.berkeley.cs.scads.piql.tpcw.CcXact with edu.berkeley.cs.scads.piql.tpcw.Author with edu.berkeley.cs.scads.piql.tpcw.Address &lt;: edu.berkeley.cs.avro.marker.AvroPair with Product with Serializable]*)List[edu.berkeley.cs.scads.storage.PairNamespace[_ &gt;: edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem with edu.berkeley.cs.scads.piql.tpcw.Order with edu.berkeley.cs.scads.piql.tpcw.OrderLine with edu.berkeley.cs.scads.piql.tpcw.Item with edu.berkeley.cs.scads.piql.tpcw.Customer with edu.berkeley.cs.scads.piql.tpcw.Country with edu.berkeley.cs.scads.piql.tpcw.CcXact with edu.berkeley.cs.scads.piql.tpcw.Author with edu.berkeley.cs.scads.piql.tpcw.Address &lt;: edu.berkeley.cs.avro.marker.AvroPair with Product with Serializable]]">List</span><span class="delimiter">(</span><a href="#12895" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Address]">addresses</a>, <a href="#12897" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Author]">authors</a>, <a href="#12899" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.CcXact]">xacts</a>, <a href="#12901" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Country]">countries</a>, <a href="#12903" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Customer]">customers</a>, <a href="#12905" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Item]">items</a>, <a href="#12907" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.OrderLine]">orderLines</a>, <a href="#12909" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Order]">orders</a>, <a href="#12911" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem]">shoppingCartItems</a><span class="delimiter">)</span>
  <span class="comment">//def allNamespaces = namespaces.flatMap(ns =&gt; ns +: ns.listIndexes.map(_._2).toSeq)</span>


  <span class="comment">//TODO: Move to scadr cluster</span>
  <span class="keyword">def</span> <a title="=&gt; Seq[(String, Int)]" id="12915">workloadDistribution</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="List[edu.berkeley.cs.scads.storage.RangeDesc]" id="28835">partitions</a> = <a href="#12913" title="=&gt; List[edu.berkeley.cs.scads.storage.PairNamespace[_ &gt;: edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem with edu.berkeley.cs.scads.piql.tpcw.Order with edu.berkeley.cs.scads.piql.tpcw.OrderLine with edu.berkeley.cs.scads.piql.tpcw.Item with edu.berkeley.cs.scads.piql.tpcw.Customer with edu.berkeley.cs.scads.piql.tpcw.Country with edu.berkeley.cs.scads.piql.tpcw.CcXact with edu.berkeley.cs.scads.piql.tpcw.Author with edu.berkeley.cs.scads.piql.tpcw.Address &lt;: edu.berkeley.cs.avro.marker.AvroPair with Product with Serializable]]">namespaces</a>.<span title="(f: edu.berkeley.cs.scads.storage.PairNamespace[_ &gt;: edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem with edu.berkeley.cs.scads.piql.tpcw.Order with edu.berkeley.cs.scads.piql.tpcw.OrderLine with edu.berkeley.cs.scads.piql.tpcw.Item with edu.berkeley.cs.scads.piql.tpcw.Customer with edu.berkeley.cs.scads.piql.tpcw.Country with edu.berkeley.cs.scads.piql.tpcw.CcXact with edu.berkeley.cs.scads.piql.tpcw.Author with edu.berkeley.cs.scads.piql.tpcw.Address &lt;: edu.berkeley.cs.avro.marker.AvroPair with Product with Serializable] =&gt; scala.collection.GenTraversableOnce[edu.berkeley.cs.scads.storage.RangeDesc])(implicit bf: scala.collection.generic.CanBuildFrom[List[edu.berkeley.cs.scads.storage.PairNamespace[_ &gt;: edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem with edu.berkeley.cs.scads.piql.tpcw.Order with edu.berkeley.cs.scads.piql.tpcw.OrderLine with edu.berkeley.cs.scads.piql.tpcw.Item with edu.berkeley.cs.scads.piql.tpcw.Customer with edu.berkeley.cs.scads.piql.tpcw.Country with edu.berkeley.cs.scads.piql.tpcw.CcXact with edu.berkeley.cs.scads.piql.tpcw.Author with edu.berkeley.cs.scads.piql.tpcw.Address &lt;: edu.berkeley.cs.avro.marker.AvroPair with Product with Serializable]],edu.berkeley.cs.scads.storage.RangeDesc,List[edu.berkeley.cs.scads.storage.RangeDesc]])List[edu.berkeley.cs.scads.storage.RangeDesc]">flatMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,edu.berkeley.cs.scads.storage.RangeDesc,List[edu.berkeley.cs.scads.storage.RangeDesc]]" class="delimiter">(</span><a href="#28853" title="edu.berkeley.cs.scads.storage.PairNamespace[_ &gt;: edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem with edu.berkeley.cs.scads.piql.tpcw.Order with edu.berkeley.cs.scads.piql.tpcw.OrderLine with edu.berkeley.cs.scads.piql.tpcw.Item with edu.berkeley.cs.scads.piql.tpcw.Customer with edu.berkeley.cs.scads.piql.tpcw.Country with edu.berkeley.cs.scads.piql.tpcw.CcXact with edu.berkeley.cs.scads.piql.tpcw.Author with edu.berkeley.cs.scads.piql.tpcw.Address &lt;: edu.berkeley.cs.avro.marker.AvroPair with Product with Serializable]">_</a>.<span title="(startKey: Option[Array[Byte]], endKey: Option[Array[Byte]])Seq[edu.berkeley.cs.scads.storage.RangeDesc]">serversForKeyRange</span><span class="delimiter">(</span><span title="object None">None</span>, <span title="object None">None</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Seq[(String, List[(String, Int)])]" id="28836">workloads</a> = <a href="#28835" title="List[edu.berkeley.cs.scads.storage.RangeDesc]">partitions</a>.<span title="(f: edu.berkeley.cs.scads.storage.RangeDesc =&gt; scala.collection.GenTraversableOnce[(String, edu.berkeley.cs.scads.comm.MessageFuture)])(implicit bf: scala.collection.generic.CanBuildFrom[List[edu.berkeley.cs.scads.storage.RangeDesc],(String, edu.berkeley.cs.scads.comm.MessageFuture),List[(String, edu.berkeley.cs.scads.comm.MessageFuture)]])List[(String, edu.berkeley.cs.scads.comm.MessageFuture)]">flatMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,(String, edu.berkeley.cs.scads.comm.MessageFuture),List[(String, edu.berkeley.cs.scads.comm.MessageFuture)]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.storage.RangeDesc" id="31146">p</a> =&gt; <a href="#31146" title="edu.berkeley.cs.scads.storage.RangeDesc">p</a>.<span title="=&gt; Seq[edu.berkeley.cs.scads.comm.PartitionService]">servers</span>.<span title="(f: edu.berkeley.cs.scads.comm.PartitionService =&gt; (String, edu.berkeley.cs.scads.comm.MessageFuture))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.comm.PartitionService],(String, edu.berkeley.cs.scads.comm.MessageFuture),Seq[(String, edu.berkeley.cs.scads.comm.MessageFuture)]])Seq[(String, edu.berkeley.cs.scads.comm.MessageFuture)]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(String, edu.berkeley.cs.scads.comm.MessageFuture),Seq[(String, edu.berkeley.cs.scads.comm.MessageFuture)]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.comm.PartitionService" id="31229">s</a> =&gt; <span title="(_1: String, _2: edu.berkeley.cs.scads.comm.MessageFuture)(String, edu.berkeley.cs.scads.comm.MessageFuture)" class="delimiter">(</span><a href="#31229" title="edu.berkeley.cs.scads.comm.PartitionService">s</a>.<span title="=&gt; String">host</span>, <a href="#31229" title="edu.berkeley.cs.scads.comm.PartitionService">s</a> <span title="(body: edu.berkeley.cs.scads.comm.MessageBody)edu.berkeley.cs.scads.comm.MessageFuture">!!</span> <span title="()edu.berkeley.cs.scads.comm.GetWorkloadStats">GetWorkloadStats</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                              .<span title="(f: (String, edu.berkeley.cs.scads.comm.MessageFuture) =&gt; (String, edu.berkeley.cs.scads.comm.MessageBody))(implicit bf: scala.collection.generic.CanBuildFrom[List[(String, edu.berkeley.cs.scads.comm.MessageFuture)],(String, edu.berkeley.cs.scads.comm.MessageBody),List[(String, edu.berkeley.cs.scads.comm.MessageBody)]])List[(String, edu.berkeley.cs.scads.comm.MessageBody)]">map</span> <a href="#31986" title="(String, edu.berkeley.cs.scads.comm.MessageBody)" class="delimiter">{</a><span class="keyword">case</span> <span title="(String, edu.berkeley.cs.scads.comm.MessageBody)" class="delimiter">(</span><a title="String" id="31989">h</a>, <a title="edu.berkeley.cs.scads.comm.MessageFuture" id="31990">f</a><span class="delimiter">)</span> =&gt; <span title="(_1: String, _2: edu.berkeley.cs.scads.comm.MessageBody)(String, edu.berkeley.cs.scads.comm.MessageBody)" class="delimiter">(</span><a href="#31989" title="String">h</a>, <a href="#31990" title="()edu.berkeley.cs.scads.comm.MessageBody">f</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">}</span>
                              .<span title="(f: (String, edu.berkeley.cs.scads.comm.MessageBody) =&gt; (String, Int))(implicit bf: scala.collection.generic.CanBuildFrom[List[(String, edu.berkeley.cs.scads.comm.MessageBody)],(String, Int),List[(String, Int)]])List[(String, Int)]">map</span> <a href="#32062" title="(String, Int)" class="delimiter">{</a><span class="keyword">case</span> <span title="(String, Int)" class="delimiter">(</span><a title="String" id="32065">h</a>, GetWorkloadStatsResponse<span class="delimiter">(</span><a title="Int" id="32118">w1</a>, <a title="Int" id="32119">w2</a>, _<span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span title="(_1: String, _2: Int)(String, Int)" class="delimiter">(</span><a href="#32065" title="String">h</a>, <a href="#32118" title="Int">w1</a><span title="(x: Int)Int">+</span><a href="#32119" title="Int">w2</a><span class="delimiter">)</span>; <span class="keyword">case</span> <span title="Nothing" class="delimiter">(</span><a title="String" id="32132">h</a>, _<span class="delimiter">)</span> =&gt; <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.RuntimeException" class="keyword">new</span> <span title="java.lang.RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Invalid response from: &quot;)" class="string">&quot;Invalid response from: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#32132" title="String">h</a><span class="delimiter">)</span><span class="delimiter">}</span>
                              .<span title="(f: (String, Int) =&gt; String)scala.collection.immutable.Map[String,List[(String, Int)]]">groupBy</span><span class="delimiter">(</span><a href="#32423" title="(String, Int)">_</a>.<span title="=&gt; String">_1</span><span class="delimiter">)</span>.<span title="=&gt; Seq[(String, List[(String, Int)])]">toSeq</span>

    <a href="#28836" title="Seq[(String, List[(String, Int)])]">workloads</a>.<span title="(f: (String, List[(String, Int)]) =&gt; (String, Int))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(String, List[(String, Int)])],(String, Int),Seq[(String, Int)]])Seq[(String, Int)]">map</span> <a href="#32757" title="(String, Int)" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="(String, Int)" class="delimiter">(</span><a title="String" id="32760">h</a>, <a title="List[(String, Int)]" id="32761">w</a><span class="delimiter">)</span> =&gt; <span title="(_1: String, _2: Int)(String, Int)" class="delimiter">(</span><a href="#32760" title="String">h</a>, <a href="#32761" title="List[(String, Int)]">w</a>.<span title="(f: (String, Int) =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[List[(String, Int)],Int,List[Int]])List[Int]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,Int,List[Int]]" class="delimiter">(</span><a href="#32782" title="(String, Int)">_</a>.<span title="=&gt; Int">_2</span><span class="delimiter">)</span>.<span title="(implicit num: Numeric[Int])Int">sum</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">// cardinality constraints</span>
  <span class="comment">// TODO: we need to place these in various queries</span>
  <span class="keyword">val</span> <a title="Int" id="12916">maxOrderLinesPerPage</a> = <span title="Int(100)" class="int">100</span>
  <span class="keyword">val</span> <a title="Int" id="12918">maxItemsPerCart</a> = <span title="Int(5000)" class="int">5000</span>

  <span class="comment">/**
   * Home web interaction
   * 
   * Select DISTINCT C_FNAME,C_LNAME
   * from CUSTOMER
   * where C_UNAME=@C_UNAME
   */</span>
  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.opt.OptimizedQuery" id="12920">homeWI</a> = <a href="#12903" title="(ns: edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Customer])edu.berkeley.cs.scads.piql.plans.Relation">customers</a>.<span title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate)edu.berkeley.cs.scads.piql.plans.Selection">where</span><a href="#12893" title="implicit edu.berkeley.cs.scads.piql.package.toPiql : (logicalPlan: edu.berkeley.cs.scads.piql.plans.LogicalPlan)(implicit executor: edu.berkeley.cs.scads.piql.package#QueryExecutor)java.lang.Object{def toPiql(queryName: Option[String]): edu.berkeley.cs.scads.piql.opt.OptimizedQuery; def toPiql$default$1: Option[String]}" class="delimiter">(</a><span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;C_UNAME&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span> <span title="(value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.plans.EqualityPredicate">===</span> <span class="delimiter">(</span><span title="implicit edu.berkeley.cs.scads.piql.package.toParameter : (o: Double)java.lang.Object{def ?: edu.berkeley.cs.scads.piql.plans.ParameterValue}" class="double">0.</span><span title="=&gt; edu.berkeley.cs.scads.piql.plans.ParameterValue">?</span><span class="delimiter">)</span><span class="delimiter">)</span>
		                    .<span title="(queryName: Option[String])edu.berkeley.cs.scads.piql.opt.OptimizedQuery">toPiql</span><span class="delimiter">(</span><span title="(a: java.lang.String)Option[java.lang.String]" class="string">&quot;homeWI&quot;</span><span class="delimiter">)</span>

  <span class="comment">/**
   * New Products web interaction
   * 
   * select top 50 I_ID,I_TITLE,A_FNAME,A_LNAME
   * from ITEM , AUTHOR
   * where A_ID = I_A_ID AND
   *       I_SUBJECT LIKE @CategoryID
   * order by I_PUB_DATE desc,I_TITLE
   */</span>
  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.opt.OptimizedQuery" id="12922">newProductWI</a> =
    <span title="edu.berkeley.cs.scads.piql.opt.OptimizedQuery" class="keyword">new</span> <span title="edu.berkeley.cs.scads.piql.opt.OptimizedQuery">OptimizedQuery</span><span class="delimiter">(</span>
      <span title="(a: java.lang.String)Option[java.lang.String]" class="string">&quot;newProductWI&quot;</span>,
      <span title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, key: edu.berkeley.cs.scads.piql.package.KeyGenerator, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.IndexLookupJoin">IndexLookupJoin</span><span class="delimiter">(</span>
        <a href="#12897" title="(ns: edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Author])edu.berkeley.cs.scads.piql.package#Namespace">authors</a>,
        <span title="(recordPosition: Int, fieldPosition: Int)edu.berkeley.cs.scads.piql.plans.AttributeValue">AttributeValue</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(2)" class="int">2</span><span class="delimiter">)</span> <a href="#27292" title="(x: edu.berkeley.cs.scads.piql.plans.AttributeValue)List[edu.berkeley.cs.scads.piql.plans.AttributeValue]">::</a> <span title="object Nil">Nil</span>,
        <span title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, key: edu.berkeley.cs.scads.piql.package.KeyGenerator, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.IndexLookupJoin">IndexLookupJoin</span><span class="delimiter">(</span>
          <a href="#12905" title="(ns: edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Item])edu.berkeley.cs.scads.piql.package#Namespace">items</a>,
          <span title="(recordPosition: Int, fieldPosition: Int)edu.berkeley.cs.scads.piql.plans.AttributeValue">AttributeValue</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>,<span title="Int(2)" class="int">2</span><span class="delimiter">)</span> <a href="#27607" title="(x: edu.berkeley.cs.scads.piql.plans.AttributeValue)List[edu.berkeley.cs.scads.piql.plans.AttributeValue]">::</a> <span title="object Nil">Nil</span>,
          <span title="(count: edu.berkeley.cs.scads.piql.plans.Limit, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.LocalStopAfter">LocalStopAfter</span><span class="delimiter">(</span>
            <span title="(ordinal: Int, max: Int)edu.berkeley.cs.scads.piql.plans.ParameterLimit">ParameterLimit</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(50)" class="int">50</span><span class="delimiter">)</span>,
            <span title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.plans.Limit, ascending: Boolean)edu.berkeley.cs.scads.piql.plans.IndexScan">IndexScan</span><span class="delimiter">(</span>
              <a href="#12905" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Item]">items</a>.<span title="(fields: Seq[edu.berkeley.cs.scads.storage.client.index.IndexType])edu.berkeley.cs.scads.storage.client.index.IndexNamespace">getOrCreateIndex</span><span class="delimiter">(</span><span title="(fieldNames: Seq[String])edu.berkeley.cs.scads.storage.client.index.TokenIndex">TokenIndex</span><span class="delimiter">(</span><span title="java.lang.String(&quot;I_SUBJECT&quot;)" class="string">&quot;I_SUBJECT&quot;</span> <a href="#27796" title="(x: java.lang.String)List[java.lang.String]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span> <a href="#27755" title="(x: edu.berkeley.cs.avro.runtime.HasAvroConversions with edu.berkeley.cs.avro.marker.AvroRecord with org.apache.avro.specific.SpecificRecordBase with Product with edu.berkeley.cs.scads.storage.client.index.IndexType with Serializable)List[edu.berkeley.cs.avro.runtime.HasAvroConversions with edu.berkeley.cs.avro.marker.AvroRecord with org.apache.avro.specific.SpecificRecordBase with Product with edu.berkeley.cs.scads.storage.client.index.IndexType with Serializable]">::</a> <span title="(fieldName: String)edu.berkeley.cs.scads.storage.client.index.AttributeIndex">AttributeIndex</span><span class="delimiter">(</span><span title="java.lang.String(&quot;I_PUB_DATE&quot;)" class="string">&quot;I_PUB_DATE&quot;</span><span class="delimiter">)</span> <a href="#27800" title="(x: edu.berkeley.cs.scads.storage.client.index.AttributeIndex)List[edu.berkeley.cs.scads.storage.client.index.AttributeIndex]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span>,
              <span class="delimiter">(</span><span title="implicit edu.berkeley.cs.scads.piql.package.toParameter : (o: Double)java.lang.Object{def ?: edu.berkeley.cs.scads.piql.plans.ParameterValue}" class="double">0.</span><span title="=&gt; edu.berkeley.cs.scads.piql.plans.ParameterValue">?</span><span class="delimiter">)</span> <a href="#28126" title="(x: edu.berkeley.cs.scads.piql.plans.ParameterValue)List[edu.berkeley.cs.scads.piql.plans.ParameterValue]">::</a> <span title="object Nil">Nil</span>,
              <span title="(ordinal: Int, max: Int)edu.berkeley.cs.scads.piql.plans.ParameterLimit">ParameterLimit</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>, <span title="Int(50)" class="int">50</span><span class="delimiter">)</span>,
              <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>,
      <a href="#28831" title="=&gt; edu.berkeley.cs.scads.piql.package.QueryExecutor">executor</a>
    <span class="delimiter">)</span>

  <span class="comment">/**
   * Best Sellers web interactio
   *
   *  declare @last_o numeric(10)
   * select top 3333  O_ID into #temp  from ORDERS
   * order by O_DATE desc
   * select @last_o = min(O_ID) from #temp
   * select top 50 I_ID,I_TITLE,A_FNAME,A_LNAME
   * from ITEM, AUTHOR ,ORDER_LINE
   * where OL_O_ID &gt; @last_o AND
   * I_ID = OL_I_ID AND I_A_ID = A_ID AND I_SUBJECT = @CategoryID
   * group by I_ID,I_TITLE,A_FNAME,A_LNAME
   * order by SUM(OL_QTY)  desc
   */</span>

  <span class="comment">//NOT IMPLEMENTED</span>



  <span class="comment">/**
   * Product Detail web interaction
   * 
   * SELECT DISTINCT * FROM ITEM,AUTHOR
   * WHERE AUTHOR.A_ID = ITEM.I_A_ID AND ITEM.I_ID = @BookID
   */</span>
  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.opt.OptimizedQuery" id="12924">productDetailWI</a> =
      <a href="#12905" title="(ns: edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Item])edu.berkeley.cs.scads.piql.plans.Relation">items</a>.<span title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate)edu.berkeley.cs.scads.piql.plans.Selection">where</span><span class="delimiter">(</span><span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;I_ID&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span> <span title="(value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.plans.EqualityPredicate">===</span> <span class="delimiter">(</span><span title="implicit edu.berkeley.cs.scads.piql.package.toParameter : (o: Double)java.lang.Object{def ?: edu.berkeley.cs.scads.piql.plans.ParameterValue}" class="double">0.</span><span title="=&gt; edu.berkeley.cs.scads.piql.plans.ParameterValue">?</span><span class="delimiter">)</span><span class="delimiter">)</span>
			     .<span title="(inner: edu.berkeley.cs.scads.piql.plans.LogicalPlan)edu.berkeley.cs.scads.piql.plans.Join">join</span><span class="delimiter">(</span><a href="#12897" title="(ns: edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Author])edu.berkeley.cs.scads.piql.plans.Relation">authors</a><span class="delimiter">)</span>
			     .<span title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate)edu.berkeley.cs.scads.piql.plans.Selection">where</span><a href="#12893" title="implicit edu.berkeley.cs.scads.piql.package.toPiql : (logicalPlan: edu.berkeley.cs.scads.piql.plans.LogicalPlan)(implicit executor: edu.berkeley.cs.scads.piql.package#QueryExecutor)java.lang.Object{def toPiql(queryName: Option[String]): edu.berkeley.cs.scads.piql.opt.OptimizedQuery; def toPiql$default$1: Option[String]}" class="delimiter">(</a><span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;A_ID&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span> <span title="(value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.plans.EqualityPredicate">===</span> <span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;I_A_ID&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span><span class="delimiter">)</span>
			     .<span title="(queryName: Option[String])edu.berkeley.cs.scads.piql.opt.OptimizedQuery">toPiql</span><span class="delimiter">(</span><span title="(a: java.lang.String)Option[java.lang.String]" class="string">&quot;productDetailWI&quot;</span><span class="delimiter">)</span>
  

  <span class="comment">/**
   * Search Result web interaction (by Author)
   * 
   * SELECT top 50 I_TITLE,I_ID,A_FNAME, A_LNAME
   * FROM ITEM,AUTHOR
   * WHERE I_A_ID = A_ID
   * AND ( A_LNAME LIKE '% ' + @Author + '%' OR A_LNAME LIKE @Author + '%' )
   * order by I_TITLE
  */</span>

  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.opt.OptimizedQuery" id="12926">searchByAuthorWI</a> =
    <span title="edu.berkeley.cs.scads.piql.opt.OptimizedQuery" class="keyword">new</span> <span title="edu.berkeley.cs.scads.piql.opt.OptimizedQuery">OptimizedQuery</span><span class="delimiter">(</span>
      <span title="(a: java.lang.String)Option[java.lang.String]" class="string">&quot;searchByAuthorWI&quot;</span>,
      <span title="(count: edu.berkeley.cs.scads.piql.plans.Limit, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.LocalStopAfter">LocalStopAfter</span><span class="delimiter">(</span>
        <span title="(ordinal: Int, max: Int)edu.berkeley.cs.scads.piql.plans.ParameterLimit">ParameterLimit</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(50)" class="int">50</span><span class="delimiter">)</span>,
        <span title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, sortFields: Seq[edu.berkeley.cs.scads.piql.plans.Value], limit: edu.berkeley.cs.scads.piql.plans.Limit, ascending: Boolean, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.IndexMergeJoin">IndexMergeJoin</span><span class="delimiter">(</span>
          <a href="#12905" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Item]">items</a>.<span title="(fields: Seq[edu.berkeley.cs.scads.storage.client.index.IndexType])edu.berkeley.cs.scads.storage.client.index.IndexNamespace">getOrCreateIndex</span><span class="delimiter">(</span><span title="(fieldName: String)edu.berkeley.cs.scads.storage.client.index.AttributeIndex">AttributeIndex</span><span class="delimiter">(</span><span title="java.lang.String(&quot;I_A_ID&quot;)" class="string">&quot;I_A_ID&quot;</span><span class="delimiter">)</span> <a href="#28296" title="(x: edu.berkeley.cs.scads.storage.client.index.AttributeIndex)List[edu.berkeley.cs.scads.storage.client.index.AttributeIndex]">::</a> <span title="(fieldName: String)edu.berkeley.cs.scads.storage.client.index.AttributeIndex">AttributeIndex</span><span class="delimiter">(</span><span title="java.lang.String(&quot;I_TITLE&quot;)" class="string">&quot;I_TITLE&quot;</span><span class="delimiter">)</span> <a href="#28299" title="(x: edu.berkeley.cs.scads.storage.client.index.AttributeIndex)List[edu.berkeley.cs.scads.storage.client.index.AttributeIndex]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span>,
          <span title="(recordPosition: Int, fieldPosition: Int)edu.berkeley.cs.scads.piql.plans.AttributeValue">AttributeValue</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>,<span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <a href="#28310" title="(x: edu.berkeley.cs.scads.piql.plans.AttributeValue)List[edu.berkeley.cs.scads.piql.plans.AttributeValue]">::</a> <span title="object Nil">Nil</span>,
          <span title="(recordPosition: Int, fieldPosition: Int)edu.berkeley.cs.scads.piql.plans.AttributeValue">AttributeValue</span><span class="delimiter">(</span><span title="Int(2)" class="int">2</span>,<span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <a href="#28320" title="(x: edu.berkeley.cs.scads.piql.plans.AttributeValue)List[edu.berkeley.cs.scads.piql.plans.AttributeValue]">::</a> <span title="object Nil">Nil</span>,
          <span title="(ordinal: Int, max: Int)edu.berkeley.cs.scads.piql.plans.ParameterLimit">ParameterLimit</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(50)" class="int">50</span><span class="delimiter">)</span>,
          <span title="Boolean(true)" class="keyword">true</span>,
          <span title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, key: edu.berkeley.cs.scads.piql.package.KeyGenerator, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.IndexLookupJoin">IndexLookupJoin</span><span class="delimiter">(</span>
            <a href="#12897" title="(ns: edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Author])edu.berkeley.cs.scads.piql.package#Namespace">authors</a>,
            <span title="(recordPosition: Int, fieldPosition: Int)edu.berkeley.cs.scads.piql.plans.AttributeValue">AttributeValue</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>,<span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <a href="#28399" title="(x: edu.berkeley.cs.scads.piql.plans.AttributeValue)List[edu.berkeley.cs.scads.piql.plans.AttributeValue]">::</a> <span title="object Nil">Nil</span>,
            <span title="(count: edu.berkeley.cs.scads.piql.plans.Limit, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.LocalStopAfter">LocalStopAfter</span><span class="delimiter">(</span>
              <span title="(count: Int)edu.berkeley.cs.scads.piql.plans.FixedLimit">FixedLimit</span><span class="delimiter">(</span><span title="Int(50)" class="int">50</span><span class="delimiter">)</span>,
                <span title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.plans.Limit, ascending: Boolean)edu.berkeley.cs.scads.piql.plans.IndexScan">IndexScan</span><span class="delimiter">(</span>
                  <a href="#12897" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Author]">authors</a>.<span title="(fields: Seq[edu.berkeley.cs.scads.storage.client.index.IndexType])edu.berkeley.cs.scads.storage.client.index.IndexNamespace">getOrCreateIndex</span><span class="delimiter">(</span><span title="(fieldNames: Seq[String])edu.berkeley.cs.scads.storage.client.index.TokenIndex">TokenIndex</span><span class="delimiter">(</span><span title="java.lang.String(&quot;A_FNAME&quot;)" class="string">&quot;A_FNAME&quot;</span> <a href="#28448" title="(x: java.lang.String)List[java.lang.String]">::</a> <span title="java.lang.String(&quot;A_LNAME&quot;)" class="string">&quot;A_LNAME&quot;</span> <a href="#28449" title="(x: java.lang.String)List[java.lang.String]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span> <a href="#28445" title="(x: edu.berkeley.cs.scads.storage.client.index.TokenIndex)List[edu.berkeley.cs.scads.storage.client.index.TokenIndex]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span>,
                  <span class="delimiter">(</span><span title="implicit edu.berkeley.cs.scads.piql.package.toParameter : (o: Double)java.lang.Object{def ?: edu.berkeley.cs.scads.piql.plans.ParameterValue}" class="double">0.</span><span title="=&gt; edu.berkeley.cs.scads.piql.plans.ParameterValue">?</span><span class="delimiter">)</span> <a href="#28463" title="(x: edu.berkeley.cs.scads.piql.plans.ParameterValue)List[edu.berkeley.cs.scads.piql.plans.ParameterValue]">::</a> <span title="object Nil">Nil</span>,
                  <span title="(count: Int)edu.berkeley.cs.scads.piql.plans.FixedLimit">FixedLimit</span><span class="delimiter">(</span><span title="Int(50)" class="int">50</span><span class="delimiter">)</span>,
                  <span title="Boolean(true)" class="keyword">true</span>
              <span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>,
      <a href="#28831" title="=&gt; edu.berkeley.cs.scads.piql.package.QueryExecutor">executor</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Search Result web interaction (by Title)
   * 
   * SELECT TOP 50 I_TITLE, I_ID, A_FNAME, A_LNAME
   * FROM ITEM, AUTHOR
   * WHERE I_A_ID = A_ID
   * AND ( I_TITLE LIKE '% ' + @Title + '%' OR I_TITLE LIKE @Title + '%' )
   * order by I_TITLE
   */</span>

  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.opt.OptimizedQuery" id="12928">searchByTitleWI</a> =
    <span title="edu.berkeley.cs.scads.piql.opt.OptimizedQuery" class="keyword">new</span> <span title="edu.berkeley.cs.scads.piql.opt.OptimizedQuery">OptimizedQuery</span><span class="delimiter">(</span>
      <span title="(a: java.lang.String)Option[java.lang.String]" class="string">&quot;searchByTitleWI&quot;</span>,
      <span title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, key: edu.berkeley.cs.scads.piql.package.KeyGenerator, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.IndexLookupJoin">IndexLookupJoin</span><span class="delimiter">(</span>
        <a href="#12897" title="(ns: edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Author])edu.berkeley.cs.scads.piql.package#Namespace">authors</a>,
        <span title="(recordPosition: Int, fieldPosition: Int)edu.berkeley.cs.scads.piql.plans.AttributeValue">AttributeValue</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <span title="Int(2)" class="int">2</span><span class="delimiter">)</span> <a href="#28541" title="(x: edu.berkeley.cs.scads.piql.plans.AttributeValue)List[edu.berkeley.cs.scads.piql.plans.AttributeValue]">::</a> <span title="object Nil">Nil</span>,
        <span title="(count: edu.berkeley.cs.scads.piql.plans.Limit, child: edu.berkeley.cs.scads.piql.plans.QueryPlan)edu.berkeley.cs.scads.piql.plans.LocalStopAfter">LocalStopAfter</span><span class="delimiter">(</span>
          <span title="(ordinal: Int, max: Int)edu.berkeley.cs.scads.piql.plans.ParameterLimit">ParameterLimit</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>,<span title="Int(50)" class="int">50</span><span class="delimiter">)</span>,
          <span title="(namespace: edu.berkeley.cs.scads.piql.package.Namespace, keyPrefix: edu.berkeley.cs.scads.piql.package.KeyGenerator, limit: edu.berkeley.cs.scads.piql.plans.Limit, ascending: Boolean)edu.berkeley.cs.scads.piql.plans.IndexScan">IndexScan</span><span class="delimiter">(</span>
            <a href="#12905" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Item]">items</a>.<span title="(fields: Seq[edu.berkeley.cs.scads.storage.client.index.IndexType])edu.berkeley.cs.scads.storage.client.index.IndexNamespace">getOrCreateIndex</span><span class="delimiter">(</span><span title="(fieldNames: Seq[String])edu.berkeley.cs.scads.storage.client.index.TokenIndex">TokenIndex</span><span class="delimiter">(</span><span title="java.lang.String(&quot;I_TITLE&quot;)" class="string">&quot;I_TITLE&quot;</span> <a href="#28568" title="(x: java.lang.String)List[java.lang.String]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span> <a href="#28565" title="(x: edu.berkeley.cs.avro.runtime.HasAvroConversions with edu.berkeley.cs.avro.marker.AvroRecord with org.apache.avro.specific.SpecificRecordBase with Product with edu.berkeley.cs.scads.storage.client.index.IndexType with Serializable)List[edu.berkeley.cs.avro.runtime.HasAvroConversions with edu.berkeley.cs.avro.marker.AvroRecord with org.apache.avro.specific.SpecificRecordBase with Product with edu.berkeley.cs.scads.storage.client.index.IndexType with Serializable]">::</a> <span title="(fieldName: String)edu.berkeley.cs.scads.storage.client.index.AttributeIndex">AttributeIndex</span><span class="delimiter">(</span><span title="java.lang.String(&quot;I_TITLE&quot;)" class="string">&quot;I_TITLE&quot;</span><span class="delimiter">)</span> <a href="#28572" title="(x: edu.berkeley.cs.scads.storage.client.index.AttributeIndex)List[edu.berkeley.cs.scads.storage.client.index.AttributeIndex]">::</a> <span title="(fieldName: String)edu.berkeley.cs.scads.storage.client.index.AttributeIndex">AttributeIndex</span><span class="delimiter">(</span><span title="java.lang.String(&quot;I_A_ID&quot;)" class="string">&quot;I_A_ID&quot;</span><span class="delimiter">)</span> <a href="#28575" title="(x: edu.berkeley.cs.scads.storage.client.index.AttributeIndex)List[edu.berkeley.cs.scads.storage.client.index.AttributeIndex]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span>,
            <span class="delimiter">(</span><span title="implicit edu.berkeley.cs.scads.piql.package.toParameter : (o: Double)java.lang.Object{def ?: edu.berkeley.cs.scads.piql.plans.ParameterValue}" class="double">0.</span><span title="=&gt; edu.berkeley.cs.scads.piql.plans.ParameterValue">?</span><span class="delimiter">)</span> <a href="#28607" title="(x: edu.berkeley.cs.scads.piql.plans.ParameterValue)List[edu.berkeley.cs.scads.piql.plans.ParameterValue]">::</a> <span title="object Nil">Nil</span>,
            <span title="(ordinal: Int, max: Int)edu.berkeley.cs.scads.piql.plans.ParameterLimit">ParameterLimit</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>, <span title="Int(50)" class="int">50</span><span class="delimiter">)</span>,
            <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>,
      <a href="#28831" title="=&gt; edu.berkeley.cs.scads.piql.package.QueryExecutor">executor</a>
    <span class="delimiter">)</span>
 

  <span class="comment">/**
   * Search Result web interaction (by Subject)
   * 
   * SELECT TOP 50 I_TITLE,I_ID, A_FNAME, A_LNAME
   * FROM ITEM, AUTHOR
   * WHERE I_A_ID = A_ID AND I_SUBJECT LIKE @CategoryID
   * order by I_TITLE
   */</span>
  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.opt.OptimizedQuery" id="12930">searchBySubjectWI</a> = <a href="#12922" title="=&gt; edu.berkeley.cs.scads.piql.opt.OptimizedQuery">newProductWI</a>

  <span class="comment">/**
   * Order Display web interaction
   *
   * FirstQuery:
   * select C_ID from CUSTOMER where C_UNAME=@C_UNAME and C_PASSWD=@C_PASSWD
   * DECLARE @O_ID numeric(10) select @O_ID = max(O_ID)from ORDERS where
   * O_C_ID=@C_ID
   * SELECT
   *   C_FNAME,C_LNAME,C_EMAIL,C_PHONE,
   *   O_ID,O_DATE,O_SUBTOTAL,O_TAX,O_TOTAL,O_SHIP_TYPE,O_SHIP_DATE,
   *   O_BILL_ADDR,O_SHIP_ADDR,O_CC_TYPE,O_STATUS,
   *   ADDR_STREET1,ADDR_STREET2,ADDR_CITY,ADDR_STATE,ADDR_ZIP,CO_NAME
   * FROM CUSTOMER,ADDRESS,COUNTRY,ORDERS
   * where
   *   O_ID=@O_ID and
   *   C_ID=@C_ID and
   *   O_BILL_ADDR=ADDR_ID AND
   *   ADDR_CO_ID=CO_ID
   * Select ADDR_STREET1,ADDR_STREET2,ADDR_CITY,
   * ADDR_STATE,ADDR_ZIP,CO_NAME from ADDRESS,COUNTRYwhere
   * ADDR_ID=@A_ID and ADDR_CO_ID=CO_ID
   *
   * SecondQuery:
   * select OL_I_ID,I_TITLE,I_PUBLISHER,
   * I_COST,OL_QTY,OL_DISCOUNT,OL_COMMENTSfrom ORDER_LINE,ITEM where
   * OL_I_ID=I_ID and OL_O_ID=@O_I
   */</span>
  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.opt.OptimizedQuery" id="12932">orderDisplayGetCustomer</a> =
    <a href="#12903" title="(ns: edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Customer])edu.berkeley.cs.scads.piql.plans.Relation">customers</a>.<span title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate)edu.berkeley.cs.scads.piql.plans.Selection">where</span><a href="#12893" title="implicit edu.berkeley.cs.scads.piql.package.toPiql : (logicalPlan: edu.berkeley.cs.scads.piql.plans.LogicalPlan)(implicit executor: edu.berkeley.cs.scads.piql.package#QueryExecutor)java.lang.Object{def toPiql(queryName: Option[String]): edu.berkeley.cs.scads.piql.opt.OptimizedQuery; def toPiql$default$1: Option[String]}" class="delimiter">(</a><span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;C_UNAME&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span> <span title="(value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.plans.EqualityPredicate">===</span> <span class="delimiter">(</span><span title="implicit edu.berkeley.cs.scads.piql.package.toParameter : (o: Double)java.lang.Object{def ?: edu.berkeley.cs.scads.piql.plans.ParameterValue}" class="double">0.</span><span title="=&gt; edu.berkeley.cs.scads.piql.plans.ParameterValue">?</span><span class="delimiter">)</span><span class="delimiter">)</span>
	     .<span title="(queryName: Option[String])edu.berkeley.cs.scads.piql.opt.OptimizedQuery">toPiql</span><span class="delimiter">(</span><span title="(a: java.lang.String)Option[java.lang.String]" class="string">&quot;orderDisplayGetCustomer&quot;</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.opt.OptimizedQuery" id="12934">orderDisplayGetLastOrder</a> =
    <a href="#12909" title="(ns: edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Order])edu.berkeley.cs.scads.piql.plans.Relation">orders</a>
      .<span title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate)edu.berkeley.cs.scads.piql.plans.Selection">where</span><span class="delimiter">(</span><span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;O_C_UNAME&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span> <span title="(value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.plans.EqualityPredicate">===</span> <span class="delimiter">(</span><span title="implicit edu.berkeley.cs.scads.piql.package.toParameter : (o: Double)java.lang.Object{def ?: edu.berkeley.cs.scads.piql.plans.ParameterValue}" class="double">0.</span><span title="=&gt; edu.berkeley.cs.scads.piql.plans.ParameterValue">?</span><span class="delimiter">)</span><span class="delimiter">)</span>
      .<span title="(attributes: Seq[edu.berkeley.cs.scads.piql.plans.Value], ascending: Boolean)edu.berkeley.cs.scads.piql.plans.Sort">sort</span><span class="delimiter">(</span><span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;O_DATE_Time&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span> <a href="#28642" title="(x: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue)List[edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue]">::</a> <span title="object Nil">Nil</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
      .<span title="(count: Int)edu.berkeley.cs.scads.piql.plans.StopAfter">limit</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      .<span title="(inner: edu.berkeley.cs.scads.piql.plans.LogicalPlan)edu.berkeley.cs.scads.piql.plans.Join">join</span><span class="delimiter">(</span><a href="#12895" title="(ns: edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Address])edu.berkeley.cs.scads.piql.plans.Relation">addresses</a><span class="delimiter">)</span>
      .<span title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate)edu.berkeley.cs.scads.piql.plans.Selection">where</span><span class="delimiter">(</span><span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;ADDR_ID&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span> <span title="(value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.plans.EqualityPredicate">===</span> <span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;O_BILL_ADDR_ID&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span><span class="delimiter">)</span>
      .<span title="(inner: edu.berkeley.cs.scads.piql.plans.LogicalPlan)edu.berkeley.cs.scads.piql.plans.Join">join</span><span class="delimiter">(</span><a href="#12901" title="(ns: edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Country])edu.berkeley.cs.scads.piql.plans.Relation">countries</a><span class="delimiter">)</span>
      .<span title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate)edu.berkeley.cs.scads.piql.plans.Selection">where</span><span class="delimiter">(</span><span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;ADDR_CO_ID&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span> <span title="(value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.plans.EqualityPredicate">===</span> <span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;CO_ID&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span><span class="delimiter">)</span>
      .<span title="(inner: edu.berkeley.cs.scads.piql.plans.LogicalPlan)edu.berkeley.cs.scads.piql.plans.Join">join</span><span class="delimiter">(</span><a href="#12895" title="(ns: edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Address])edu.berkeley.cs.scads.piql.plans.Relation">addresses</a><span class="delimiter">)</span>
      .<span title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate)edu.berkeley.cs.scads.piql.plans.Selection">where</span><span class="delimiter">(</span><span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;ADDR_ID&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span> <span title="(value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.plans.EqualityPredicate">===</span> <span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;O_SHIP_ADDR_ID&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span><span class="delimiter">)</span>
      .<span title="(inner: edu.berkeley.cs.scads.piql.plans.LogicalPlan)edu.berkeley.cs.scads.piql.plans.Join">join</span><span class="delimiter">(</span><a href="#12901" title="(ns: edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Country])edu.berkeley.cs.scads.piql.plans.Relation">countries</a><span class="delimiter">)</span>
      .<span title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate)edu.berkeley.cs.scads.piql.plans.Selection">where</span><a href="#12893" title="implicit edu.berkeley.cs.scads.piql.package.toPiql : (logicalPlan: edu.berkeley.cs.scads.piql.plans.LogicalPlan)(implicit executor: edu.berkeley.cs.scads.piql.package#QueryExecutor)java.lang.Object{def toPiql(queryName: Option[String]): edu.berkeley.cs.scads.piql.opt.OptimizedQuery; def toPiql$default$1: Option[String]}" class="delimiter">(</a><span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;ADDR_CO_ID&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span> <span title="(value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.plans.EqualityPredicate">===</span> <span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;CO_ID&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span><span class="delimiter">)</span>
      .<span title="(queryName: Option[String])edu.berkeley.cs.scads.piql.opt.OptimizedQuery">toPiql</span><span class="delimiter">(</span><span title="(a: java.lang.String)Option[java.lang.String]" class="string">&quot;orderDisplayGetLastOrder&quot;</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.opt.OptimizedQuery" id="12936">orderDisplayGetOrderLines</a> =
    <a href="#12907" title="(ns: edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.OrderLine])edu.berkeley.cs.scads.piql.plans.Relation">orderLines</a>.<span title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate)edu.berkeley.cs.scads.piql.plans.Selection">where</span><span class="delimiter">(</span><span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;OL_O_ID&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span> <span title="(value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.plans.EqualityPredicate">===</span> <span class="delimiter">(</span><span title="implicit edu.berkeley.cs.scads.piql.package.toParameter : (o: Double)java.lang.Object{def ?: edu.berkeley.cs.scads.piql.plans.ParameterValue}" class="double">0.</span><span title="=&gt; edu.berkeley.cs.scads.piql.plans.ParameterValue">?</span><span class="delimiter">)</span><span class="delimiter">)</span>
      .<span title="(parameter: edu.berkeley.cs.scads.piql.plans.ParameterValue, max: Int)edu.berkeley.cs.scads.piql.plans.StopAfter">limit</span><span class="delimiter">(</span><span class="delimiter">(</span><span title="implicit edu.berkeley.cs.scads.piql.package.toParameter : (o: Double)java.lang.Object{def ?: edu.berkeley.cs.scads.piql.plans.ParameterValue}" class="double">1.</span><span title="=&gt; edu.berkeley.cs.scads.piql.plans.ParameterValue">?</span><span class="delimiter">)</span>, <a href="#12916" title="=&gt; Int">maxOrderLinesPerPage</a><span class="delimiter">)</span>
      .<span title="(inner: edu.berkeley.cs.scads.piql.plans.LogicalPlan)edu.berkeley.cs.scads.piql.plans.Join">join</span><span class="delimiter">(</span><a href="#12905" title="(ns: edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Item])edu.berkeley.cs.scads.piql.plans.Relation">items</a><span class="delimiter">)</span>
      .<span title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate)edu.berkeley.cs.scads.piql.plans.Selection">where</span><a href="#12893" title="implicit edu.berkeley.cs.scads.piql.package.toPiql : (logicalPlan: edu.berkeley.cs.scads.piql.plans.LogicalPlan)(implicit executor: edu.berkeley.cs.scads.piql.package#QueryExecutor)java.lang.Object{def toPiql(queryName: Option[String]): edu.berkeley.cs.scads.piql.opt.OptimizedQuery; def toPiql$default$1: Option[String]}" class="delimiter">(</a><span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;OL_I_ID&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span> <span title="(value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.plans.EqualityPredicate">===</span> <span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;I_ID&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span><span class="delimiter">)</span>
      .<span title="(queryName: Option[String])edu.berkeley.cs.scads.piql.opt.OptimizedQuery">toPiql</span><span class="delimiter">(</span><span title="(a: java.lang.String)Option[java.lang.String]" class="string">&quot;orderDisplayGetOrderLines&quot;</span><span class="delimiter">)</span>


  <span class="keyword">def</span> <a title="(c_uname: String, c_passwd: String, numOrderLinesPerPage: Int)(edu.berkeley.cs.scads.piql.tpcw.Customer, Option[edu.berkeley.cs.scads.piql.tpcw.Order], Option[edu.berkeley.cs.scads.piql.package.QueryResult])" id="12938">orderDisplayWI</a><span class="delimiter">(</span><a title="String" id="34748">c_uname</a>: <span title="String">String</span>, <a title="String" id="34749">c_passwd</a>: <span title="String">String</span>, <a title="Int" id="34750">numOrderLinesPerPage</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.tpcw.Customer" id="34753">cust</a> = <a href="#12932" title="(args: Any*)edu.berkeley.cs.scads.piql.package.QueryResult">orderDisplayGetCustomer</a><span class="delimiter">(</span><a href="#34748" title="String">c_uname</a><span class="delimiter">)</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.package.Tuple">head</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.package.Record">head</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.piql.tpcw.Customer" class="delimiter">[</span><a href="TpcwSchema.scala.html#9720" title="edu.berkeley.cs.scads.piql.tpcw.Customer">Customer</a><span class="delimiter">]</span>
    <span class="comment">//assert(cust.C_PASSWD == c_passwd, &quot;Passwords don't match&quot;)</span>

    <span class="keyword">val</span> <a title="Option[edu.berkeley.cs.scads.piql.package.Tuple]" id="34754">lastOrderDetails</a> = <a href="#12934" title="(args: Any*)edu.berkeley.cs.scads.piql.package.QueryResult">orderDisplayGetLastOrder</a><span class="delimiter">(</span><a href="#34748" title="String">c_uname</a><span class="delimiter">)</span>.<span title="=&gt; Option[edu.berkeley.cs.scads.piql.package.Tuple]">headOption</span>
    <span class="keyword">val</span> <a title="Option[edu.berkeley.cs.scads.piql.tpcw.Order]" id="34755">lastOrder</a> = <a href="#34754" title="Option[edu.berkeley.cs.scads.piql.package.Tuple]">lastOrderDetails</a>.<span title="(f: edu.berkeley.cs.scads.piql.package.Tuple =&gt; edu.berkeley.cs.scads.piql.tpcw.Order)Option[edu.berkeley.cs.scads.piql.tpcw.Order]">map</span><span class="delimiter">(</span><a href="#34810" title="edu.berkeley.cs.scads.piql.package.Tuple">_</a>.<span title="(idx: Int)edu.berkeley.cs.scads.piql.package.Record">apply</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.piql.tpcw.Order" class="delimiter">[</span><a href="TpcwSchema.scala.html#9723" title="edu.berkeley.cs.scads.piql.tpcw.Order">Order</a><span class="delimiter">]</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Option[edu.berkeley.cs.scads.piql.package.QueryResult]" id="34756">lines</a> = <a href="#34755" title="Option[edu.berkeley.cs.scads.piql.tpcw.Order]">lastOrder</a>.<span title="(f: edu.berkeley.cs.scads.piql.tpcw.Order =&gt; edu.berkeley.cs.scads.piql.package.QueryResult)Option[edu.berkeley.cs.scads.piql.package.QueryResult]">map</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.tpcw.Order" id="34822">o</a> =&gt; <a href="#12936" title="(args: Any*)edu.berkeley.cs.scads.piql.package.QueryResult">orderDisplayGetOrderLines</a><span class="delimiter">(</span><a href="#34822" title="edu.berkeley.cs.scads.piql.tpcw.Order">o</a>.<a href="TpcwSchema.scala.html#21460" title="=&gt; String">O_ID</a>, <a href="#34750" title="Int">numOrderLinesPerPage</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span title="(_1: edu.berkeley.cs.scads.piql.tpcw.Customer, _2: Option[edu.berkeley.cs.scads.piql.tpcw.Order], _3: Option[edu.berkeley.cs.scads.piql.package.QueryResult])(edu.berkeley.cs.scads.piql.tpcw.Customer, Option[edu.berkeley.cs.scads.piql.tpcw.Order], Option[edu.berkeley.cs.scads.piql.package.QueryResult])" class="delimiter">(</span><a href="#34753" title="edu.berkeley.cs.scads.piql.tpcw.Customer">cust</a>, <a href="#34755" title="Option[edu.berkeley.cs.scads.piql.tpcw.Order]">lastOrder</a>, <a href="#34756" title="Option[edu.berkeley.cs.scads.piql.package.QueryResult]">lines</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Shopping Cart Interations
   *
   * Add to cart
   * Insert into SHOPPING_CART values(@Session,0,@BookID,1, @Title,@SRP,@COST,@Backing,GetDate())
   *
   * Refresh Display
   * Update SHOPPING_CART set SC_QTY=@QTY where SC_ID=@UserID and SC_I_ID=@BookID
   * Delete from SHOPPING_CART where SC_ID=@UserID and SC_I_ID=@BookID
   */</span>

  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.opt.OptimizedQuery" id="12939">retrieveShoppingCart</a> =
    <a href="#12911" title="(ns: edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem])edu.berkeley.cs.scads.piql.plans.Relation">shoppingCartItems</a>.<span title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate)edu.berkeley.cs.scads.piql.plans.Selection">where</span><span class="delimiter">(</span><span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;SCL_C_UNAME&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span> <span title="(value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.plans.EqualityPredicate">===</span> <span class="delimiter">(</span><span title="implicit edu.berkeley.cs.scads.piql.package.toParameter : (o: Double)java.lang.Object{def ?: edu.berkeley.cs.scads.piql.plans.ParameterValue}" class="double">0.</span><span title="=&gt; edu.berkeley.cs.scads.piql.plans.ParameterValue">?</span><span class="delimiter">)</span><span class="delimiter">)</span>
                     .<span title="(count: Int)edu.berkeley.cs.scads.piql.plans.StopAfter">limit</span><span class="delimiter">(</span><span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>
                     .<span title="(inner: edu.berkeley.cs.scads.piql.plans.LogicalPlan)edu.berkeley.cs.scads.piql.plans.Join">join</span><span class="delimiter">(</span><a href="#12905" title="(ns: edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Item])edu.berkeley.cs.scads.piql.plans.Relation">items</a><span class="delimiter">)</span>
                     .<span title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate)edu.berkeley.cs.scads.piql.plans.Selection">where</span><a href="#12893" title="implicit edu.berkeley.cs.scads.piql.package.toPiql : (logicalPlan: edu.berkeley.cs.scads.piql.plans.LogicalPlan)(implicit executor: edu.berkeley.cs.scads.piql.package#QueryExecutor)java.lang.Object{def toPiql(queryName: Option[String]): edu.berkeley.cs.scads.piql.opt.OptimizedQuery; def toPiql$default$1: Option[String]}" class="delimiter">(</a><span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;SCL_I_ID&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span> <span title="(value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.plans.EqualityPredicate">===</span> <span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;I_ID&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span><span class="delimiter">)</span>
                     .<span title="(queryName: Option[String])edu.berkeley.cs.scads.piql.opt.OptimizedQuery">toPiql</span><span class="delimiter">(</span><span title="(a: java.lang.String)Option[java.lang.String]" class="string">&quot;retrieveShoppingCart&quot;</span><span class="delimiter">)</span>

  <span class="comment">/**
   * This is a very simplified shopping cart WI.
   * Given a c_uname, items will be added to the cart, or the
   * quantity will be updated. this is not really conformant to the TPC-W
   * benchmark spec */</span>

   <span class="keyword">def</span> <a title="(c_uname: String, newItems: Seq[(String, Int)])Unit" id="12941">shoppingCartWI</a><span class="delimiter">(</span><a title="String" id="34833">c_uname</a>: <span title="String">String</span>, <a title="Seq[(String, Int)]" id="34834">newItems</a>: <span title="Seq[(String, Int)]">Seq</span><span class="delimiter">[</span><span class="delimiter">(</span>String, Int<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem]" id="34837">cart</a> = <a href="#12939" title="(args: Any*)edu.berkeley.cs.scads.piql.package.QueryResult">retrieveShoppingCart</a><span class="delimiter">(</span><a href="#34833" title="String">c_uname</a><span class="delimiter">)</span>.<span title="(f: edu.berkeley.cs.scads.piql.package.Tuple =&gt; edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.package.Tuple],edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem,Seq[edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem]])Seq[edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem,Seq[edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem]]" class="delimiter">(</span><a href="#34859" title="edu.berkeley.cs.scads.piql.package.Tuple">_</a>.<span title="=&gt; edu.berkeley.cs.scads.piql.package.Record">head</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem" class="delimiter">[</span><a href="TpcwSchema.scala.html#9735" title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem">ShoppingCartItem</a><span class="delimiter">]</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Seq[(String, Int)]" id="34838">currentItems</a> = <a href="#34837" title="Seq[edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem]">cart</a>.<span title="(f: edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem =&gt; (String, Int))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem],(String, Int),Seq[(String, Int)]])Seq[(String, Int)]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(String, Int),Seq[(String, Int)]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem" id="34923">c</a> =&gt; <span title="(_1: String, _2: Int)(String, Int)" class="delimiter">(</span><a href="#34923" title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem">c</a>.<a href="TpcwSchema.scala.html#21513" title="=&gt; String">SCL_I_ID</a>, <a href="#34923" title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem">c</a>.<a href="TpcwSchema.scala.html#21517" title="=&gt; Int">SCL_QTY</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="scala.collection.immutable.Map[String,Int]" id="34839">updatedItems</a> = <span class="delimiter">(</span><a href="#34838" title="Seq[(String, Int)]">currentItems</a> <span title="(that: scala.collection.GenTraversableOnce[(String, Int)])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(String, Int)],(String, Int),Seq[(String, Int)]])Seq[(String, Int)]">++</span> <a href="#34834" title="Seq[(String, Int)]">newItems</a><span class="delimiter">)</span>.<span title="(f: (String, Int) =&gt; String)scala.collection.immutable.Map[String,Seq[(String, Int)]]">groupBy</span><span class="delimiter">(</span><a href="#35013" title="(String, Int)">_</a>.<span title="=&gt; String">_1</span><span class="delimiter">)</span>.<span title="(f: (String, Seq[(String, Int)]) =&gt; (String, Int))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[String,Seq[(String, Int)]],(String, Int),scala.collection.immutable.Map[String,Int]])scala.collection.immutable.Map[String,Int]">map</span> <a href="#35054" title="(String, Int)" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="(String, Int)" class="delimiter">(</span><a title="String" id="35057">id</a>, <a title="Seq[(String, Int)]" id="35058">qtys</a><span class="delimiter">)</span> =&gt; <span title="(_1: String, _2: Int)(String, Int)" class="delimiter">(</span><a href="#35057" title="String">id</a>, <a href="#35058" title="Seq[(String, Int)]">qtys</a>.<span title="(f: (String, Int) =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(String, Int)],Int,Seq[Int]])Seq[Int]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,Int,Seq[Int]]" class="delimiter">(</span><a href="#35079" title="(String, Int)">_</a>.<span title="=&gt; Int">_2</span><span class="delimiter">)</span>.<span title="(implicit num: Numeric[Int])Int">sum</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#34839" title="scala.collection.immutable.Map[String,Int]">updatedItems</a>.<span title="(f: (String, Int) =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="(String, Int)" id="35578">i</a> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem" id="35579">scl</a> = <span title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem" class="keyword">new</span> <a href="TpcwSchema.scala.html#9735" title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem">ShoppingCartItem</a><span class="delimiter">(</span><a href="#34833" title="String">c_uname</a>, <a href="#35578" title="(String, Int)">i</a>.<span title="=&gt; String">_1</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#35578" title="(String, Int)">i</a>.<span title="=&gt; Int">_2</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#35579" title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem">scl</a>.<a href="TpcwSchema.scala.html#21518" title="(x$1: Int)Unit">SCL_QTY</a> = <a href="#35578" title="(String, Int)">i</a>.<span title="=&gt; Int">_2</span>
        <a href="#12911" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem]">shoppingCartItems</a>.<span title="(pairRec: edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem)Unit">put</span><span class="delimiter">(</span><a href="#35579" title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem">scl</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#12911" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem]">shoppingCartItems</a>.<span title="(pairRec: edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem)Unit">delete</span><span class="delimiter">(</span><a href="#35579" title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem">scl</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Buy Request web interaction (Existing Customer)
   *
   * select C_ID from CUSTOMER where C_UNAME=@C_UNAME and
   * C_PASSWD=@C_PASSWD

   * SELECT C_UNAME,C_PASSWD,C_FNAME,C_LNAME,C_PHONE,
   * C_EMAIL,C_BIRTHDATE,C_DATA1,C_DATA2,ADDR_STREET1,
   * ADDR_STREET2,ADDR_CITY,ADDR_STATE,ADDR_ZIP,CO_NAME
   * FROM CUSTOMER,ADDRESS,COUNTRY
   * where C_ADDR_ID=ADDR_ID and ADDR_CO_ID=CO_ID and C_ID = @C_ID
   */</span>

  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.opt.OptimizedQuery" id="12942">buyRequestExistingCustomerWI</a> =
    <a href="#12903" title="(ns: edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Customer])edu.berkeley.cs.scads.piql.plans.Relation">customers</a>.<span title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate)edu.berkeley.cs.scads.piql.plans.Selection">where</span><span class="delimiter">(</span><span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;C_UNAME&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span> <span title="(value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.plans.EqualityPredicate">===</span> <span class="delimiter">(</span><span title="implicit edu.berkeley.cs.scads.piql.package.toParameter : (o: Double)java.lang.Object{def ?: edu.berkeley.cs.scads.piql.plans.ParameterValue}" class="double">0.</span><span title="=&gt; edu.berkeley.cs.scads.piql.plans.ParameterValue">?</span><span class="delimiter">)</span><span class="delimiter">)</span>
             .<span title="(inner: edu.berkeley.cs.scads.piql.plans.LogicalPlan)edu.berkeley.cs.scads.piql.plans.Join">join</span><span class="delimiter">(</span><a href="#12895" title="(ns: edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Address])edu.berkeley.cs.scads.piql.plans.Relation">addresses</a><span class="delimiter">)</span>
             .<span title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate)edu.berkeley.cs.scads.piql.plans.Selection">where</span><span class="delimiter">(</span><span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;C_ADDR_ID&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span> <span title="(value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.plans.EqualityPredicate">===</span> <span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;ADDR_ID&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span><span class="delimiter">)</span>
             .<span title="(inner: edu.berkeley.cs.scads.piql.plans.LogicalPlan)edu.berkeley.cs.scads.piql.plans.Join">join</span><span class="delimiter">(</span><a href="#12901" title="(ns: edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Country])edu.berkeley.cs.scads.piql.plans.Relation">countries</a><span class="delimiter">)</span>
             .<span title="(predicate: edu.berkeley.cs.scads.piql.plans.Predicate)edu.berkeley.cs.scads.piql.plans.Selection">where</span><a href="#12893" title="implicit edu.berkeley.cs.scads.piql.package.toPiql : (logicalPlan: edu.berkeley.cs.scads.piql.plans.LogicalPlan)(implicit executor: edu.berkeley.cs.scads.piql.package#QueryExecutor)java.lang.Object{def toPiql(queryName: Option[String]): edu.berkeley.cs.scads.piql.opt.OptimizedQuery; def toPiql$default$1: Option[String]}" class="delimiter">(</a><span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;ADDR_CO_ID&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span> <span title="(value: edu.berkeley.cs.scads.piql.plans.Value)edu.berkeley.cs.scads.piql.plans.EqualityPredicate">===</span> <span title="implicit edu.berkeley.cs.scads.piql.package.toAttr : (s: String)java.lang.Object{def a: edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue}" class="string">&quot;CO_ID&quot;</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.plans.UnboundAttributeValue">a</span><span class="delimiter">)</span>
             .<span title="(queryName: Option[String])edu.berkeley.cs.scads.piql.opt.OptimizedQuery">toPiql</span><span class="delimiter">(</span><span title="(a: java.lang.String)Option[java.lang.String]" class="string">&quot;buyRequestExistingCustomerWI&quot;</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Buy Confirm Web Interation
   * DECLARE @CO_ID numeric(4)
   * DECLARE @ADDR_ID numeric(10)
   *
   * Select @CO_ID = CO_ID from COUNTRY where CO_NAME=@CO_NAME
   *
   * SELECT ADDR_ID
   * FROM ADDRESS
   * WHERE
   * ADDR_STREET1=@ADDR_STREET1 and
   * ADDR_STREET2=@ADDR_STREET2 and
   * ADDR_CITY=@ADDR_CITY and
   * ADDR_STATE=@ADDR_STATE and
   * ADDR_ZIP=@ADDR_ZIP and
   * ADDR_CO_ID=@CO_ID
   *
   * Select @CO_ID = CO_ID
   * from COUNTRY
   * where CO_NAME=@CO_NAME
   *
   * Insert into ADDRESS values(@ADDR_STREET1,
   * @ADDR_STREET2,@ADDR_CITY,@ADDR_STATE,@ADDR_ZIP,
   * @CO_ID)
   *
   * select @ADDR_ID = @@identity
   *
   * select C_ID,C_DISCOUNT,C_ADDR_ID
   * from CUSTOMER
   * where C_UNAME=@UserID
   *
   * DECLARE @O_ID numeric(9)
   *
   * Insert into ORDERS values (@O_C_ID,getdate(),@O_SUBTOTAL,
   * @O_TAX,@O_TOTAL,@O_SHIP_TYPE,NULL,@O_BILL_ADDR,
   * @O_SHIP_ADDR,@O_CC_TYPE,@O_CC_NUM,@O_CC_NAME,
   * @O_CC_EXP,'Pending')
   *
   * select @O_ID = @@identity
   *
   * Insert ORDER_LINE (OL_O_ID,OL_I_ID,OL_QTY,
   * OL_DISCOUNT,OL_COMMENTS)
   *
   * Select @O_ID,SC_I_ID,SC_QTY,1,'comment' from SHOPPING_CART
   *
   * update ITEM     set I_STOCK = I_STOCK - SCL_I_QTY + case when (I_STOCK -
   * SCL_I_QTY &lt; 10) then 21 else 0 end
   * from SHOPPING_BASKET
   * where SC_SHOPPING_ID=@Session and SC_HOST=@SC_HOST and SCL_I_ID =
   * I_ID
   *
   * Delete from SHOPPING_CART where SC_ID=@Session
   *
   * Insert into CC_XACTS
   * values(@O_ID,@O_CC_TYPE,@O_CC_EXP,@O_CC_AUTH,@O_TOTAL,getdate(),@CO_ID)
   */</span>

  <span class="comment">//TODO: Async put?</span>
  <span class="keyword">def</span> <a title="(c_uname: String, cc_type: String, cc_number: Int, cc_name: String, cc_expiry: Long, shipping: String)String" id="12944">buyConfirmWI</a><span class="delimiter">(</span><a title="String" id="35598">c_uname</a>: <span title="String">String</span>,
                   <a title="String" id="35599">cc_type</a>: <span title="String">String</span>,
                   <a title="Int" id="35600">cc_number</a>: <span title="Int">Int</span>,
                   <a title="String" id="35601">cc_name</a>: <span title="String">String</span>,
                   <a title="Long" id="35602">cc_expiry</a>: <span title="Long">Long</span>,
                   <a title="String" id="35603">shipping</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.tpcw.Customer" id="35605">customer</a> = <a href="#12920" title="(args: Any*)edu.berkeley.cs.scads.piql.package.QueryResult">homeWI</a><span class="delimiter">(</span><a href="#35598" title="String">c_uname</a><span class="delimiter">)</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.package.Tuple">head</span>.<span title="=&gt; edu.berkeley.cs.scads.piql.package.Record">head</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.piql.tpcw.Customer" class="delimiter">[</span><a href="TpcwSchema.scala.html#9720" title="edu.berkeley.cs.scads.piql.tpcw.Customer">Customer</a><span class="delimiter">]</span>
    <span class="keyword">val</span> <a title="Seq[(edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item)]" id="35606">cart</a> = <a href="#12939" title="(args: Any*)edu.berkeley.cs.scads.piql.package.QueryResult">retrieveShoppingCart</a><span class="delimiter">(</span><a href="#35598" title="String">c_uname</a><span class="delimiter">)</span>.<span title="(f: edu.berkeley.cs.scads.piql.package.Tuple =&gt; (edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.piql.package.Tuple],(edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item),Seq[(edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item)]])Seq[(edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item)]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item),Seq[(edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item)]]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.package.Tuple" id="35639">sl</a> =&gt; <span title="(_1: edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, _2: edu.berkeley.cs.scads.piql.tpcw.Item)(edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item)" class="delimiter">(</span><a href="#35639" title="(idx: Int)edu.berkeley.cs.scads.piql.package.Record">sl</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem" class="delimiter">[</span><a href="TpcwSchema.scala.html#9735" title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem">ShoppingCartItem</a><span class="delimiter">]</span>, <a href="#35639" title="(idx: Int)edu.berkeley.cs.scads.piql.package.Record">sl</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="edu.berkeley.cs.scads.piql.tpcw.Item" class="delimiter">[</span><a href="TpcwSchema.scala.html#9711" title="edu.berkeley.cs.scads.piql.tpcw.Item">Item</a><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="comment">// calculate costs</span>
    <span class="keyword">val</span> <a title="Double" id="35607">sc_sub_total</a> = <a href="#35606" title="Seq[(edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item)]">cart</a>.<span title="(f: (edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item) =&gt; Double)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item)],Double,Seq[Double]])Seq[Double]">map</span> <a href="#35714" title="Double" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="Double" class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem" id="35717">scl</a>, <a title="edu.berkeley.cs.scads.piql.tpcw.Item" id="35718">itm</a><span class="delimiter">)</span> =&gt; <a href="#35718" title="edu.berkeley.cs.scads.piql.tpcw.Item">itm</a>.<a href="TpcwSchema.scala.html#21389" title="=&gt; Double">I_COST</a> <span title="(x: Int)Double">*</span> <a href="#35717" title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem">scl</a>.<a href="TpcwSchema.scala.html#21517" title="=&gt; Int">SCL_QTY</a>
    <span class="delimiter">}</span>.<span title="(implicit num: Numeric[Double])Double">sum</span> <span title="(x: Double)Double">*</span> <span class="delimiter">(</span><span title="Double(1.0)" class="double">1.0</span> <span title="(x: Double)Double">-</span> <a href="#35605" title="edu.berkeley.cs.scads.piql.tpcw.Customer">customer</a>.<a href="TpcwSchema.scala.html#21313" title="=&gt; Double">C_DISCOUNT</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Double" id="35608">sc_tax</a> = <a href="#35607" title="Double">sc_sub_total</a> <span title="(x: Double)Double">*</span> <span title="Double(0.0825)" class="double">0.0825</span>
    <span class="keyword">val</span> <a title="Double" id="35609">sc_ship_cost</a> = <span title="Double(3.0)" class="double">3.0</span> <span title="(x: Double)Double">+</span> <span class="delimiter">(</span><span title="Double(1.0)" class="double">1.0</span> <span title="(x: Double)Double">*</span> <a href="#35606" title="Seq[(edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item)]">cart</a>.<span title="=&gt; Int">size</span>.<span title="=&gt; Double">toDouble</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Double" id="35610">sc_total</a> = <a href="#35607" title="Double">sc_sub_total</a> <span title="(x: Double)Double">+</span> <a href="#35608" title="Double">sc_tax</a> <span title="(x: Double)Double">+</span> <a href="#35609" title="Double">sc_ship_cost</a>

    <span class="keyword">def</span> <a title="=&gt; java.lang.String" id="35611">newUUID</a> =
      <span title="object java.util.UUID">UUID</span>.<span title="()java.util.UUID">randomUUID</span>.<span title="()java.lang.String">toString</span>

    <span class="comment">// make order</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.tpcw.Order" id="35612">order</a> = <a href="TpcwSchema.scala.html#35820" title="(O_ID: String)edu.berkeley.cs.scads.piql.tpcw.Order">Order</a><span class="delimiter">(</span><a href="#35611" title="=&gt; java.lang.String">newUUID</a><span class="delimiter">)</span>
    <a href="#35612" title="edu.berkeley.cs.scads.piql.tpcw.Order">order</a>.<a href="TpcwSchema.scala.html#21465" title="(x$1: String)Unit">O_C_UNAME</a> = <a href="#35598" title="String">c_uname</a>
    <a href="#35612" title="edu.berkeley.cs.scads.piql.tpcw.Order">order</a>.<a href="TpcwSchema.scala.html#21468" title="(x$1: Long)Unit">O_DATE_Time</a> = <span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span>
    <a href="#35612" title="edu.berkeley.cs.scads.piql.tpcw.Order">order</a>.<a href="TpcwSchema.scala.html#21471" title="(x$1: Double)Unit">O_SUB_TOTAL</a> = <a href="#35607" title="Double">sc_sub_total</a>
    <a href="#35612" title="edu.berkeley.cs.scads.piql.tpcw.Order">order</a>.<a href="TpcwSchema.scala.html#21474" title="(x$1: Double)Unit">O_TAX</a> = <a href="#35608" title="Double">sc_tax</a>
    <a href="#35612" title="edu.berkeley.cs.scads.piql.tpcw.Order">order</a>.<a href="TpcwSchema.scala.html#21477" title="(x$1: Double)Unit">O_TOTAL</a> = <a href="#35610" title="Double">sc_total</a>
    <a href="#35612" title="edu.berkeley.cs.scads.piql.tpcw.Order">order</a>.<a href="TpcwSchema.scala.html#21480" title="(x$1: String)Unit">O_SHIP_TYPE</a> = <a href="#35603" title="String">shipping</a>
    <a href="#35612" title="edu.berkeley.cs.scads.piql.tpcw.Order">order</a>.<a href="TpcwSchema.scala.html#21483" title="(x$1: Long)Unit">O_SHIP_DATE</a> = <span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span> <span title="(x: Long)Long">+</span> <span class="delimiter">(</span>scala.util.<span title="object scala.util.Random">Random</span>.<span title="(n: Int)Int">nextInt</span><span class="delimiter">(</span><span title="Int(7)" class="int">7</span><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="=&gt; Long">toLong</span> <span title="(x: Long)Long">*</span> <span title="Long(86400L)" class="long">86400L</span> <span class="comment">// [1..7] days later</span>
    <a href="#35612" title="edu.berkeley.cs.scads.piql.tpcw.Order">order</a>.<a href="TpcwSchema.scala.html#21486" title="(x$1: String)Unit">O_BILL_ADDR_ID</a> = <a href="#35605" title="edu.berkeley.cs.scads.piql.tpcw.Customer">customer</a>.<a href="TpcwSchema.scala.html#21292" title="=&gt; String">C_ADDR_ID</a>
    <a href="#35612" title="edu.berkeley.cs.scads.piql.tpcw.Order">order</a>.<a href="TpcwSchema.scala.html#21489" title="(x$1: String)Unit">O_SHIP_ADDR_ID</a> = <a href="#35605" title="edu.berkeley.cs.scads.piql.tpcw.Customer">customer</a>.<a href="TpcwSchema.scala.html#21292" title="=&gt; String">C_ADDR_ID</a>
    <a href="#35612" title="edu.berkeley.cs.scads.piql.tpcw.Order">order</a>.<a href="TpcwSchema.scala.html#21492" title="(x$1: String)Unit">O_STATUS</a> = <span title="java.lang.String(&quot;PENDING&quot;)" class="string">&quot;PENDING&quot;</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.comm.ScadsFuture[Unit]" id="35613">orderPut</a> = <a href="#12909" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Order]">orders</a>.<span title="(key: org.apache.avro.generic.IndexedRecord, value: Option[org.apache.avro.generic.IndexedRecord])edu.berkeley.cs.scads.comm.ScadsFuture[Unit]">asyncPut</span><span class="delimiter">(</span><a href="#35612" title="edu.berkeley.cs.scads.piql.tpcw.Order">order</a>.<span title="=&gt; org.apache.avro.generic.GenericRecord">key</span>, <a href="#35612" title="edu.berkeley.cs.scads.piql.tpcw.Order">order</a>.<span title="(a: org.apache.avro.generic.GenericRecord)Option[org.apache.avro.generic.GenericRecord]">value</span><span class="delimiter">)</span>

    <span class="comment">// make order lines</span>
    <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]]" id="35614">orderLinePuts</a> = <a href="#35606" title="Seq[(edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item)]">cart</a>.<span title="(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item)],((edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item), Int),Seq[((edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item), Int)]])Seq[((edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item), Int)]">zipWithIndex</span>.<span title="(f: ((edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item), Int) =&gt; edu.berkeley.cs.scads.comm.ScadsFuture[Unit])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[((edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item), Int)],edu.berkeley.cs.scads.comm.ScadsFuture[Unit],Seq[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]]])Seq[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]]">map</span> <a href="#36254" title="edu.berkeley.cs.scads.comm.ScadsFuture[Unit]" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.comm.ScadsFuture[Unit]" class="delimiter">(</span><span class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem" id="36259">scl</a>, <a title="edu.berkeley.cs.scads.piql.tpcw.Item" id="36260">itm</a><span class="delimiter">)</span>, <a title="Int" id="36261">idx</a><span class="delimiter">)</span> =&gt;
        <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.tpcw.OrderLine" id="36262">ol</a> = <span title="edu.berkeley.cs.scads.piql.tpcw.OrderLine" class="keyword">new</span> <a href="TpcwSchema.scala.html#9726" title="edu.berkeley.cs.scads.piql.tpcw.OrderLine">OrderLine</a><span class="delimiter">(</span><a href="#35612" title="edu.berkeley.cs.scads.piql.tpcw.Order">order</a>.<a href="TpcwSchema.scala.html#21460" title="=&gt; String">O_ID</a>, <a href="#36261" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
        <a href="#36262" title="edu.berkeley.cs.scads.piql.tpcw.OrderLine">ol</a>.<a href="TpcwSchema.scala.html#21434" title="(x$1: String)Unit">OL_I_ID</a> = <a href="#36260" title="edu.berkeley.cs.scads.piql.tpcw.Item">itm</a>.<a href="TpcwSchema.scala.html#21343" title="=&gt; String">I_ID</a>
        <a href="#36262" title="edu.berkeley.cs.scads.piql.tpcw.OrderLine">ol</a>.<a href="TpcwSchema.scala.html#21437" title="(x$1: Int)Unit">OL_QTY</a> = <a href="#36259" title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem">scl</a>.<a href="TpcwSchema.scala.html#21517" title="=&gt; Int">SCL_QTY</a>
        <a href="#36262" title="edu.berkeley.cs.scads.piql.tpcw.OrderLine">ol</a>.<a href="TpcwSchema.scala.html#21440" title="(x$1: Double)Unit">OL_DISCOUNT</a> = <a href="#35605" title="edu.berkeley.cs.scads.piql.tpcw.Customer">customer</a>.<a href="TpcwSchema.scala.html#21313" title="=&gt; Double">C_DISCOUNT</a>
        <a href="#36262" title="edu.berkeley.cs.scads.piql.tpcw.OrderLine">ol</a>.<a href="TpcwSchema.scala.html#21443" title="(x$1: String)Unit">OL_COMMENT</a> = <a href="Utils.java.html#9140" title="object ch.ethz.systems.tpcw.populate.data.Utils">Utils</a>.<a href="Utils.java.html#36313" title="(min: Int, max: Int)java.lang.String">getRandomAString</a><span class="delimiter">(</span><span title="Int(20)" class="int">20</span>, <span title="Int(100)" class="int">100</span><span class="delimiter">)</span>
        <a href="#12907" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.OrderLine]">orderLines</a>.<span title="(key: org.apache.avro.generic.IndexedRecord, value: Option[org.apache.avro.generic.IndexedRecord])edu.berkeley.cs.scads.comm.ScadsFuture[Unit]">asyncPut</span><span class="delimiter">(</span><a href="#36262" title="edu.berkeley.cs.scads.piql.tpcw.OrderLine">ol</a>.<span title="=&gt; org.apache.avro.generic.GenericRecord">key</span>, <a href="#36262" title="edu.berkeley.cs.scads.piql.tpcw.OrderLine">ol</a>.<span title="(a: org.apache.avro.generic.GenericRecord)Option[org.apache.avro.generic.GenericRecord]">value</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">// make item stocks updates</span>
    <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]]" id="35615">stockUpdatePuts</a> = <a href="#35606" title="Seq[(edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item)]">cart</a>.<span title="(f: (edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item) =&gt; edu.berkeley.cs.scads.comm.ScadsFuture[Unit])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item)],edu.berkeley.cs.scads.comm.ScadsFuture[Unit],Seq[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]]])Seq[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]]">map</span> <a href="#36380" title="edu.berkeley.cs.scads.comm.ScadsFuture[Unit]" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.comm.ScadsFuture[Unit]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem" id="36383">scl</a>, <a title="edu.berkeley.cs.scads.piql.tpcw.Item" id="36384">itm</a><span class="delimiter">)</span> =&gt;
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#36384" title="edu.berkeley.cs.scads.piql.tpcw.Item">itm</a>.<a href="TpcwSchema.scala.html#21395" title="=&gt; Int">I_STOCK</a> <span title="(x: Int)Int">-</span> <a href="#36383" title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem">scl</a>.<a href="TpcwSchema.scala.html#21517" title="=&gt; Int">SCL_QTY</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(10)" class="int">10</span><span class="delimiter">)</span>
        <a href="#36384" title="edu.berkeley.cs.scads.piql.tpcw.Item">itm</a>.<a href="TpcwSchema.scala.html#21396" title="(x$1: Int)Unit">I_STOCK</a> = <a href="#36384" title="edu.berkeley.cs.scads.piql.tpcw.Item">itm</a>.<a href="TpcwSchema.scala.html#21395" title="=&gt; Int">I_STOCK</a> <span title="(x: Int)Int">-</span> <a href="#36383" title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem">scl</a>.<a href="TpcwSchema.scala.html#21517" title="=&gt; Int">SCL_QTY</a>
      <span class="keyword">else</span>
        <a href="#36384" title="edu.berkeley.cs.scads.piql.tpcw.Item">itm</a>.<a href="TpcwSchema.scala.html#21396" title="(x$1: Int)Unit">I_STOCK</a> = scala.math.<span title="(x: Int, y: Int)Int">min</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <span class="delimiter">(</span><a href="#36384" title="edu.berkeley.cs.scads.piql.tpcw.Item">itm</a>.<a href="TpcwSchema.scala.html#21395" title="=&gt; Int">I_STOCK</a> <span title="(x: Int)Int">-</span> <a href="#36383" title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem">scl</a>.<a href="TpcwSchema.scala.html#21517" title="=&gt; Int">SCL_QTY</a><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <span title="Int(21)" class="int">21</span><span class="delimiter">)</span> <span class="comment">// ... uhh, what happens if this goes negative??? that's why i put the min condition there (it's not given in the spec)</span>

      <a href="#12905" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.Item]">items</a>.<span title="(key: org.apache.avro.generic.IndexedRecord, value: Option[org.apache.avro.generic.IndexedRecord])edu.berkeley.cs.scads.comm.ScadsFuture[Unit]">asyncPut</span><span class="delimiter">(</span><a href="#36384" title="edu.berkeley.cs.scads.piql.tpcw.Item">itm</a>.<span title="=&gt; org.apache.avro.generic.GenericRecord">key</span>, <a href="#36384" title="edu.berkeley.cs.scads.piql.tpcw.Item">itm</a>.<span title="(a: org.apache.avro.generic.GenericRecord)Option[org.apache.avro.generic.GenericRecord]">value</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">// credit card (PGE) auth stuff ignored...</span>

    <span class="comment">// make cc txn</span>
    <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.tpcw.CcXact" id="35616">ccXact</a> = <a href="TpcwSchema.scala.html#36442" title="(CX_O_ID: String)edu.berkeley.cs.scads.piql.tpcw.CcXact">CcXact</a><span class="delimiter">(</span><a href="#35612" title="edu.berkeley.cs.scads.piql.tpcw.Order">order</a>.<a href="TpcwSchema.scala.html#21460" title="=&gt; String">O_ID</a><span class="delimiter">)</span>
    <a href="#35616" title="edu.berkeley.cs.scads.piql.tpcw.CcXact">ccXact</a>.<a href="TpcwSchema.scala.html#21213" title="(x$1: String)Unit">CX_TYPE</a> = <a href="#35599" title="String">cc_type</a>
    <a href="#35616" title="edu.berkeley.cs.scads.piql.tpcw.CcXact">ccXact</a>.<a href="TpcwSchema.scala.html#21216" title="(x$1: Int)Unit">CX_NUM</a> = <a href="#35600" title="Int">cc_number</a>
    <a href="#35616" title="edu.berkeley.cs.scads.piql.tpcw.CcXact">ccXact</a>.<a href="TpcwSchema.scala.html#21219" title="(x$1: String)Unit">CX_NAME</a> = <a href="#35601" title="String">cc_name</a>
    <a href="#35616" title="edu.berkeley.cs.scads.piql.tpcw.CcXact">ccXact</a>.<a href="TpcwSchema.scala.html#21222" title="(x$1: Long)Unit">CX_EXPIRY</a> = <a href="#35602" title="Long">cc_expiry</a>
    <a href="#35616" title="edu.berkeley.cs.scads.piql.tpcw.CcXact">ccXact</a>.<a href="TpcwSchema.scala.html#21225" title="(x$1: String)Unit">CX_AUTH_ID</a> = <a href="Utils.java.html#9140" title="object ch.ethz.systems.tpcw.populate.data.Utils">Utils</a>.<a href="Utils.java.html#36314" title="(length: Int)java.lang.String">getRandomAString</a><span class="delimiter">(</span><span title="Int(15)" class="int">15</span><span class="delimiter">)</span>
    <a href="#35616" title="edu.berkeley.cs.scads.piql.tpcw.CcXact">ccXact</a>.<a href="TpcwSchema.scala.html#21228" title="(x$1: Double)Unit">CX_XACT_AMT</a> = <a href="#35610" title="Double">sc_total</a>
    <a href="#35616" title="edu.berkeley.cs.scads.piql.tpcw.CcXact">ccXact</a>.<a href="TpcwSchema.scala.html#21231" title="(x$1: Long)Unit">CX_XACT_DATE</a> = <span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span>
    <a href="#35616" title="edu.berkeley.cs.scads.piql.tpcw.CcXact">ccXact</a>.<a href="TpcwSchema.scala.html#21234" title="(x$1: Int)Unit">CX_CO_ID</a> = <a href="Utils.java.html#9140" title="object ch.ethz.systems.tpcw.populate.data.Utils">Utils</a>.<a href="Utils.java.html#36317" title="(lower: Int, upper: Int)Int">getRandomInt</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>, <span title="Int(92)" class="int">92</span><span class="delimiter">)</span>

    <span class="comment">// clear shopping cart. unfortunately BulkPut does not support deletion,</span>
    <span class="comment">// so we do this inefficiently by looping. if our numbers are not good we</span>
    <span class="comment">// could try to make this more efficient, but since max cart size is 100,</span>
    <span class="comment">// this shouldn't be THAT bad</span>
    <span class="keyword">val</span> <a title="Seq[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]]" id="35617">clearCartPuts</a> = <a href="#35606" title="Seq[(edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item)]">cart</a> <span title="(f: (edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item) =&gt; edu.berkeley.cs.scads.comm.ScadsFuture[Unit])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item)],edu.berkeley.cs.scads.comm.ScadsFuture[Unit],Seq[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]]])Seq[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]]">map</span> <a href="#36471" title="edu.berkeley.cs.scads.comm.ScadsFuture[Unit]" class="delimiter">{</a> <span class="keyword">case</span> <span title="edu.berkeley.cs.scads.comm.ScadsFuture[Unit]" class="delimiter">(</span><a title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem" id="36474">scl</a>, _<span class="delimiter">)</span> =&gt;
      <a href="#12911" title="=&gt; edu.berkeley.cs.scads.storage.PairNamespace[edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem]">shoppingCartItems</a>.<span title="(key: org.apache.avro.generic.IndexedRecord, value: Option[org.apache.avro.generic.IndexedRecord])edu.berkeley.cs.scads.comm.ScadsFuture[Unit]">asyncPut</span><span class="delimiter">(</span><a href="#36474" title="edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem">scl</a>.<span title="=&gt; org.apache.avro.generic.GenericRecord">key</span>, <span title="object None">None</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">/* Block until puts complete */</span>
    <span class="delimiter">(</span><a href="#35614" title="Seq[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]]">orderLinePuts</a> <span title="(that: scala.collection.GenTraversableOnce[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]],edu.berkeley.cs.scads.comm.ScadsFuture[Unit],Seq[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]]])Seq[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]]">++</span> <a href="#35615" title="Seq[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]]">stockUpdatePuts</a> <span title="(that: scala.collection.GenTraversableOnce[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]],edu.berkeley.cs.scads.comm.ScadsFuture[Unit],Seq[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]]])Seq[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]]">++</span> <a href="#35617" title="Seq[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]]">clearCartPuts</a> <span title="(elem: edu.berkeley.cs.scads.comm.ScadsFuture[Unit])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]],edu.berkeley.cs.scads.comm.ScadsFuture[Unit],Seq[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]]])Seq[edu.berkeley.cs.scads.comm.ScadsFuture[Unit]]">:+</span> <a href="#35613" title="edu.berkeley.cs.scads.comm.ScadsFuture[Unit]">orderPut</a><span class="delimiter">)</span>.<span title="(f: edu.berkeley.cs.scads.comm.ScadsFuture[Unit] =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#36654" title="()Unit">_</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <a href="#12891" title="=&gt; net.lag.logging.Logger">logger</a>.<span title="(msg: String, items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;finished buy confirmation of %d items&quot;)" class="string">&quot;finished buy confirmation of %d items&quot;</span>, <a href="#35606" title="Seq[(edu.berkeley.cs.scads.piql.tpcw.ShoppingCartItem, edu.berkeley.cs.scads.piql.tpcw.Item)]">cart</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>

    <a href="#35612" title="edu.berkeley.cs.scads.piql.tpcw.Order">order</a>.<a href="TpcwSchema.scala.html#21460" title="=&gt; String">O_ID</a>
  <span class="delimiter">}</span>

  <span class="keyword">val</span> <a title="edu.berkeley.cs.scads.piql.opt.OptimizedQuery" id="12945">adminRequestWI</a> = <a href="#12924" title="=&gt; edu.berkeley.cs.scads.piql.opt.OptimizedQuery">productDetailWI</a>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>